"use strict";(self.webpackChunk_ant_design_web3_docs=self.webpackChunk_ant_design_web3_docs||[]).push([[3010],{15890:function(St,q,O){O.r(q),O.d(q,{IEvents:function(){return ee.q}});var ee=O(36900)},15782:function(St,q,O){Object.defineProperty(q,"__esModule",{value:!0}),q.HEARTBEAT_EVENTS=q.HEARTBEAT_INTERVAL=void 0;const ee=O(46196);q.HEARTBEAT_INTERVAL=ee.FIVE_SECONDS,q.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"}},95635:function(St,q,O){Object.defineProperty(q,"__esModule",{value:!0}),O(43868).__exportStar(O(15782),q)},20538:function(St,q,O){Object.defineProperty(q,"__esModule",{value:!0}),q.HeartBeat=void 0;const ee=O(43868),yt=O(72100),ci=O(46196),mt=O(88490),J=O(95635);class Xe extends mt.IHeartBeat{constructor(se){super(se),this.events=new yt.EventEmitter,this.interval=J.HEARTBEAT_INTERVAL,this.interval=(se==null?void 0:se.interval)||J.HEARTBEAT_INTERVAL}static init(se){return ee.__awaiter(this,void 0,void 0,function*(){const _e=new Xe(se);return yield _e.init(),_e})}init(){return ee.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(se,_e){this.events.on(se,_e)}once(se,_e){this.events.once(se,_e)}off(se,_e){this.events.off(se,_e)}removeListener(se,_e){this.events.removeListener(se,_e)}initialize(){return ee.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),ci.toMiliseconds(this.interval))})}pulse(){this.events.emit(J.HEARTBEAT_EVENTS.pulse)}}q.HeartBeat=Xe},37875:function(St,q,O){Object.defineProperty(q,"__esModule",{value:!0});const ee=O(43868);ee.__exportStar(O(20538),q),ee.__exportStar(O(88490),q),ee.__exportStar(O(95635),q)},54554:function(St,q,O){Object.defineProperty(q,"__esModule",{value:!0}),q.IHeartBeat=void 0;const ee=O(15890);class yt extends ee.IEvents{constructor(mt){super()}}q.IHeartBeat=yt},88490:function(St,q,O){Object.defineProperty(q,"__esModule",{value:!0}),O(43868).__exportStar(O(54554),q)},42392:function(St,q){Object.defineProperty(q,"__esModule",{value:!0}),q.PINO_CUSTOM_CONTEXT_KEY=q.PINO_LOGGER_DEFAULTS=void 0,q.PINO_LOGGER_DEFAULTS={level:"info"},q.PINO_CUSTOM_CONTEXT_KEY="custom_context"},71315:function(St,q,O){Object.defineProperty(q,"__esModule",{value:!0}),q.pino=void 0;const ee=O(43868),yt=ee.__importDefault(O(86984));Object.defineProperty(q,"pino",{enumerable:!0,get:function(){return yt.default}}),ee.__exportStar(O(42392),q),ee.__exportStar(O(48992),q)},48992:function(St,q,O){Object.defineProperty(q,"__esModule",{value:!0}),q.generateChildLogger=q.formatChildLoggerContext=q.getLoggerContext=q.setBrowserLoggerContext=q.getBrowserLoggerContext=q.getDefaultLoggerOptions=void 0;const ee=O(42392);function yt(se){return Object.assign(Object.assign({},se),{level:(se==null?void 0:se.level)||ee.PINO_LOGGER_DEFAULTS.level})}q.getDefaultLoggerOptions=yt;function ci(se,_e=ee.PINO_CUSTOM_CONTEXT_KEY){return se[_e]||""}q.getBrowserLoggerContext=ci;function mt(se,_e,at=ee.PINO_CUSTOM_CONTEXT_KEY){return se[at]=_e,se}q.setBrowserLoggerContext=mt;function J(se,_e=ee.PINO_CUSTOM_CONTEXT_KEY){let at="";return typeof se.bindings>"u"?at=ci(se,_e):at=se.bindings().context||"",at}q.getLoggerContext=J;function Xe(se,_e,at=ee.PINO_CUSTOM_CONTEXT_KEY){const ui=J(se,at);return ui.trim()?`${ui}/${_e}`:_e}q.formatChildLoggerContext=Xe;function qs(se,_e,at=ee.PINO_CUSTOM_CONTEXT_KEY){const ui=Xe(se,_e,at),Or=se.child({context:ui});return mt(Or,ui,at)}q.generateChildLogger=qs},3010:function(St,q,O){O.r(q),O.d(q,{UniversalProvider:function(){return ov},default:function(){return Vr}});var ee=O(72100),yt=O.n(ee),ci=O(53070),mt=O(37875),J=O(56526),Xe=O(36900);class qs extends Xe.q{constructor(s){super(),this.opts=s,this.protocol="wc",this.version=2}}class se{constructor(s,r,o){this.core=s,this.logger=r}}class _e extends Xe.q{constructor(s,r){super(),this.core=s,this.logger=r,this.records=new Map}}class at{constructor(s,r){this.logger=s,this.core=r}}class ui extends Xe.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class Or extends Xe.q{constructor(s){super()}}class Gh{constructor(s,r,o,a){this.core=s,this.logger=r,this.name=o}}class iE{constructor(){this.map=new Map}}class Jh extends Xe.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class rE{constructor(s,r){this.core=s,this.logger=r}}class Wh extends Xe.q{constructor(s,r){super(),this.core=s,this.logger=r}}class sE{constructor(s,r){this.logger=s,this.core=r}}class Qh{constructor(s,r){this.projectId=s,this.logger=r}}class Yh{constructor(s,r){this.projectId=s,this.logger=r}}class nE extends null{constructor(){super()}}class Zh{constructor(s){this.opts=s,this.protocol="wc",this.version=2}}class oE extends null{constructor(){super()}}class Xh{constructor(s){this.client=s}}var Yi=O(41926),Nr=O(88614),Lo=O(11541),el=O(45306),Uo=O(54889),Ls=O(76846),Mo=O(9267),ge=O(5105),tl=O(81365),U=O(46196),Zi=O(73079),il=O(42669),Cr=O(66271),rl=O(55722),Us=O(14224);const Ar=":";function zo(u){const[s,r]=u.split(Ar);return{namespace:s,reference:r}}function sl(u){const{namespace:s,reference:r}=u;return[s,r].join(Ar)}function ko(u){const[s,r,o]=u.split(Ar);return{namespace:s,reference:r,address:o}}function nl(u){const{namespace:s,reference:r,address:o}=u;return[s,r,o].join(Ar)}function Vo(u,s){const r=[];return u.forEach(o=>{const a=s(o);r.includes(a)||r.push(a)}),r}function ol(u){const{address:s}=ko(u);return s}function al(u){const{namespace:s,reference:r}=ko(u);return sl({namespace:s,reference:r})}function aE(u,s){const{namespace:r,reference:o}=zo(s);return nl({namespace:r,reference:o,address:u})}function cE(u){return Vo(u,ol)}function cl(u){return Vo(u,al)}function uE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...a.accounts)}),r}function hE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...cl(a.accounts))}),r}function lE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...Ms(o,a))}),r}function Ms(u,s){return u.includes(":")?[u]:s.chains||[]}const zs=u=>u==null?void 0:u.split(":"),ul=u=>{const s=u&&zs(u);if(s)return s[3]},pE=u=>{const s=u&&zs(u);if(s)return s[2]+":"+s[3]},hl=u=>{const s=u&&zs(u);if(s)return s.pop()},dE=(u,s)=>{const r=`${u.domain} wants you to sign in with your Ethereum account:`,o=hl(s),a=u.statement,p=`URI: ${u.aud}`,g=`Version: ${u.version}`,m=`Chain ID: ${ul(s)}`,b=`Nonce: ${u.nonce}`,x=`Issued At: ${u.iat}`,C=u.resources&&u.resources.length>0?`Resources:
${u.resources.map(N=>`- ${N}`).join(`
`)}`:void 0;return[r,o,"",a,"",p,g,m,b,x,C].filter(N=>N!=null).join(`
`)},Ho="base10",Me="base16",ks="base64pad",Vs="utf8",Ko=0,hi=1,ll=0,Bo=1,Hs=12,Ks=32;function pl(){const u=Mo.Au();return{privateKey:(0,ge.BB)(u.secretKey,Me),publicKey:(0,ge.BB)(u.publicKey,Me)}}function Bs(){const u=(0,Uo.randomBytes)(Ks);return(0,ge.BB)(u,Me)}function dl(u,s){const r=Mo.gi((0,ge.mL)(u,Me),(0,ge.mL)(s,Me),!0),o=new el.t(Ls.mE,r).expand(Ks);return(0,ge.BB)(o,Me)}function fl(u){const s=(0,Ls.vp)((0,ge.mL)(u,Me));return(0,ge.BB)(s,Me)}function xi(u){const s=(0,Ls.vp)((0,ge.mL)(u,Vs));return(0,ge.BB)(s,Me)}function gl(u){return(0,ge.mL)(`${u}`,Ho)}function Xi(u){return Number((0,ge.BB)(u,Ho))}function vl(u){const s=gl(typeof u.type<"u"?u.type:Ko);if(Xi(s)===hi&&typeof u.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof u.senderPublicKey<"u"?(0,ge.mL)(u.senderPublicKey,Me):void 0,o=typeof u.iv<"u"?(0,ge.mL)(u.iv,Me):(0,Uo.randomBytes)(Hs),a=new Lo.OK((0,ge.mL)(u.symKey,Me)).seal(o,(0,ge.mL)(u.message,Vs));return ml({type:s,sealed:a,iv:o,senderPublicKey:r})}function yl(u){const s=new Lo.OK((0,ge.mL)(u.symKey,Me)),{sealed:r,iv:o}=Tr(u.encoded),a=s.open(o,r);if(a===null)throw new Error("Failed to decrypt");return(0,ge.BB)(a,Vs)}function ml(u){if(Xi(u.type)===hi){if(typeof u.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,ge.BB)((0,ge.zo)([u.type,u.senderPublicKey,u.iv,u.sealed]),ks)}return(0,ge.BB)((0,ge.zo)([u.type,u.iv,u.sealed]),ks)}function Tr(u){const s=(0,ge.mL)(u,ks),r=s.slice(ll,Bo),o=Bo;if(Xi(r)===hi){const m=o+Ks,b=m+Hs,x=s.slice(o,m),C=s.slice(m,b),N=s.slice(b);return{type:r,sealed:N,iv:C,senderPublicKey:x}}const a=o+Hs,p=s.slice(o,a),g=s.slice(a);return{type:r,sealed:g,iv:p}}function wl(u,s){const r=Tr(u);return Go({type:Xi(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?(0,ge.BB)(r.senderPublicKey,Me):void 0,receiverPublicKey:s==null?void 0:s.receiverPublicKey})}function Go(u){const s=(u==null?void 0:u.type)||Ko;if(s===hi){if(typeof(u==null?void 0:u.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(u==null?void 0:u.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:s,senderPublicKey:u==null?void 0:u.senderPublicKey,receiverPublicKey:u==null?void 0:u.receiverPublicKey}}function Jo(u){return u.type===hi&&typeof u.senderPublicKey=="string"&&typeof u.receiverPublicKey=="string"}var _l=Object.defineProperty,Wo=Object.getOwnPropertySymbols,bl=Object.prototype.hasOwnProperty,El=Object.prototype.propertyIsEnumerable,Qo=(u,s,r)=>s in u?_l(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Yo=(u,s)=>{for(var r in s||(s={}))bl.call(s,r)&&Qo(u,r,s[r]);if(Wo)for(var r of Wo(s))El.call(s,r)&&Qo(u,r,s[r]);return u};const Il="ReactNative",Ge={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Gs=" ",fE=":",Pl="/",Zo=2,gE=1e3,xl="js";function Js(){return typeof Us<"u"&&typeof Us.versions<"u"&&typeof Us.versions.node<"u"}function Si(){return!(0,Zi.getDocument)()&&!!(0,Zi.getNavigator)()&&navigator.product===Il}function Ri(){return!Js()&&!!(0,Zi.getNavigator)()&&!!(0,Zi.getDocument)()}function Oi(){return Si()?Ge.reactNative:Js()?Ge.node:Ri()?Ge.browser:Ge.unknown}function Sl(){var u;try{return Si()&&typeof O.g<"u"&&typeof(O.g==null?void 0:O.g.Application)<"u"?(u=O.g.Application)==null?void 0:u.applicationId:void 0}catch{return}}function Rl(u,s){let r=Cr.parse(u);return r=Yo(Yo({},r),s),u=Cr.stringify(r),u}function Ol(){return(0,il.D)()||{name:"",description:"",url:"",icons:[""]}}function vE(u,s){var r;const o=Oi(),a={protocol:u,version:s,env:o};return o==="browser"&&(a.host=((r=he())==null?void 0:r.host)||"unknown"),a}function Nl(){if(Oi()===Ge.reactNative&&typeof O.g<"u"&&typeof(O.g==null?void 0:O.g.Platform)<"u"){const{OS:r,Version:o}=O.g.Platform;return[r,o].join("-")}const u=(0,tl.qY)();if(u===null)return"unknown";const s=u.os?u.os.replace(" ","").toLowerCase():"unknown";return u.type==="browser"?[s,u.name,u.version].join("-"):[s,u.version].join("-")}function Cl(){var u;const s=Oi();return s===Ge.browser?[s,((u=(0,Zi.getLocation)())==null?void 0:u.host)||"unknown"].join(":"):s}function Al(u,s,r){const o=Nl(),a=Cl();return[[u,s].join("-"),[xl,r].join("-"),o,a].join("/")}function Tl({protocol:u,version:s,relayUrl:r,sdkVersion:o,auth:a,projectId:p,useOnCloseEvent:g,bundleId:m}){const b=r.split("?"),x=Al(u,s,o),C={auth:a,ua:x,projectId:p,useOnCloseEvent:g||void 0,origin:m||void 0},N=Rl(b[1]||"",C);return b[0]+"?"+N}function yE(u){let s=(u.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const r=typeof s<"u"?u.split("://")[1]:u;return s=s==="wss"?"https":"http",[s,r].join("://")}function mE(u,s,r){if(!u[s]||typeof u[s]!==r)throw new Error(`Missing or invalid "${s}" param`)}function Dl(u,s=Zo){return Fl(u.split(Pl),s)}function wE(u){return Dl(u).join(Gs)}function li(u,s){return u.filter(r=>s.includes(r)).length===u.length}function Fl(u,s=Zo){return u.slice(Math.max(u.length-s,0))}function Xo(u){return Object.fromEntries(u.entries())}function ea(u){return new Map(Object.entries(u))}function _E(u,s){const r={};return Object.keys(u).forEach(o=>{r[o]=s(u[o])}),r}const bE=u=>u;function jl(u){return u.trim().replace(/^\w/,s=>s.toUpperCase())}function EE(u){return u.split(Gs).map(s=>jl(s)).join(Gs)}function Ni(u=U.FIVE_MINUTES,s){const r=(0,U.toMiliseconds)(u||U.FIVE_MINUTES);let o,a,p;return{resolve:g=>{p&&o&&(clearTimeout(p),o(g))},reject:g=>{p&&a&&(clearTimeout(p),a(g))},done:()=>new Promise((g,m)=>{p=setTimeout(()=>{m(new Error(s))},r),o=g,a=m})}}function er(u,s,r){return new Promise(async(o,a)=>{const p=setTimeout(()=>a(new Error(r)),s);try{const g=await u;o(g)}catch(g){a(g)}clearTimeout(p)})}function ta(u,s){if(typeof s=="string"&&s.startsWith(`${u}:`))return s;if(u.toLowerCase()==="topic"){if(typeof s!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${s}`}else if(u.toLowerCase()==="id"){if(typeof s!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${s}`}throw new Error(`Unknown expirer target type: ${u}`)}function $l(u){return ta("topic",u)}function ql(u){return ta("id",u)}function ia(u){const[s,r]=u.split(":"),o={id:void 0,topic:void 0};if(s==="topic"&&typeof r=="string")o.topic=r;else if(s==="id"&&Number.isInteger(Number(r)))o.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${s}:${r}`);return o}function et(u,s){return(0,U.fromMiliseconds)((s||Date.now())+(0,U.toMiliseconds)(u))}function Jt(u){return Date.now()>=(0,U.toMiliseconds)(u)}function Pe(u,s){return`${u}${s?`:${s}`:""}`}function Rt(u=[],s=[]){return[...new Set([...u,...s])]}async function Ll({id:u,topic:s,wcDeepLink:r}){try{if(!r)return;const o=typeof r=="string"?JSON.parse(r):r;let a=o==null?void 0:o.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const p=`${a}/wc?requestId=${u}&sessionTopic=${s}`,g=Oi();g===Ge.browser?p.startsWith("https://")?window.open(p,"_blank","noreferrer noopener"):window.open(p,"_self","noreferrer noopener"):g===Ge.reactNative&&typeof(O.g==null?void 0:O.g.Linking)<"u"&&await O.g.Linking.openURL(p)}catch(o){console.error(o)}}async function Ul(u,s){try{return await u.getItem(s)||(Ri()?localStorage.getItem(s):void 0)}catch(r){console.error(r)}}const Ml="irn";function Ws(u){return(u==null?void 0:u.relay)||{protocol:Ml}}function Dr(u){const s=rl.iO[u];if(typeof s>"u")throw new Error(`Relay Protocol not supported: ${u}`);return s}var zl=Object.defineProperty,kl=Object.defineProperties,Vl=Object.getOwnPropertyDescriptors,ra=Object.getOwnPropertySymbols,Hl=Object.prototype.hasOwnProperty,Kl=Object.prototype.propertyIsEnumerable,sa=(u,s,r)=>s in u?zl(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Bl=(u,s)=>{for(var r in s||(s={}))Hl.call(s,r)&&sa(u,r,s[r]);if(ra)for(var r of ra(s))Kl.call(s,r)&&sa(u,r,s[r]);return u},Gl=(u,s)=>kl(u,Vl(s));function Jl(u,s="-"){const r={},o="relay"+s;return Object.keys(u).forEach(a=>{if(a.startsWith(o)){const p=a.replace(o,""),g=u[a];r[p]=g}}),r}function na(u){u=u.includes("wc://")?u.replace("wc://",""):u,u=u.includes("wc:")?u.replace("wc:",""):u;const s=u.indexOf(":"),r=u.indexOf("?")!==-1?u.indexOf("?"):void 0,o=u.substring(0,s),a=u.substring(s+1,r).split("@"),p=typeof r<"u"?u.substring(r):"",g=Cr.parse(p);return{protocol:o,topic:Wl(a[0]),version:parseInt(a[1],10),symKey:g.symKey,relay:Jl(g),expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function Wl(u){return u.startsWith("//")?u.substring(2):u}function Ql(u,s="-"){const r="relay",o={};return Object.keys(u).forEach(a=>{const p=r+s+a;u[a]&&(o[p]=u[a])}),o}function Yl(u){return`${u.protocol}:${u.topic}@${u.version}?`+Cr.stringify(Gl(Bl({symKey:u.symKey},Ql(u.relay)),{expiryTimestamp:u.expiryTimestamp}))}var Zl=Object.defineProperty,Xl=Object.defineProperties,ep=Object.getOwnPropertyDescriptors,oa=Object.getOwnPropertySymbols,tp=Object.prototype.hasOwnProperty,ip=Object.prototype.propertyIsEnumerable,aa=(u,s,r)=>s in u?Zl(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,rp=(u,s)=>{for(var r in s||(s={}))tp.call(s,r)&&aa(u,r,s[r]);if(oa)for(var r of oa(s))ip.call(s,r)&&aa(u,r,s[r]);return u},sp=(u,s)=>Xl(u,ep(s));function Ci(u){const s=[];return u.forEach(r=>{const[o,a]=r.split(":");s.push(`${o}:${a}`)}),s}function np(u){const s=[];return Object.values(u).forEach(r=>{s.push(...Ci(r.accounts))}),s}function op(u,s){const r=[];return Object.values(u).forEach(o=>{Ci(o.accounts).includes(s)&&r.push(...o.methods)}),r}function ap(u,s){const r=[];return Object.values(u).forEach(o=>{Ci(o.accounts).includes(s)&&r.push(...o.events)}),r}function IE(u,s){const r=$r(u,s);if(r)throw new Error(r.message);const o={};for(const[a,p]of Object.entries(u))o[a]={methods:p.methods,events:p.events,chains:p.accounts.map(g=>`${g.split(":")[0]}:${g.split(":")[1]}`)};return o}function PE(u){const{proposal:{requiredNamespaces:s,optionalNamespaces:r={}},supportedNamespaces:o}=u,a=ca(s),p=ca(r),g={};Object.keys(o).forEach(x=>{const C=o[x].chains,N=o[x].methods,$=o[x].events,ce=o[x].accounts;C.forEach(F=>{if(!ce.some(H=>H.includes(F)))throw new Error(`No accounts provided for chain ${F} in namespace ${x}`)}),g[x]={chains:C,methods:N,events:$,accounts:ce}});const m=Ys(s,g,"approve()");if(m)throw new Error(m.message);const b={};return!Object.keys(s).length&&!Object.keys(r).length?g:(Object.keys(a).forEach(x=>{const C=o[x].chains.filter(F=>{var H,Z;return(Z=(H=a[x])==null?void 0:H.chains)==null?void 0:Z.includes(F)}),N=o[x].methods.filter(F=>{var H,Z;return(Z=(H=a[x])==null?void 0:H.methods)==null?void 0:Z.includes(F)}),$=o[x].events.filter(F=>{var H,Z;return(Z=(H=a[x])==null?void 0:H.events)==null?void 0:Z.includes(F)}),ce=C.map(F=>o[x].accounts.filter(H=>H.includes(`${F}:`))).flat();b[x]={chains:C,methods:N,events:$,accounts:ce}}),Object.keys(p).forEach(x=>{var C,N,$,ce,F,H;if(!o[x])return;const Z=(N=(C=p[x])==null?void 0:C.chains)==null?void 0:N.filter(ne=>o[x].chains.includes(ne)),le=o[x].methods.filter(ne=>{var Q,me;return(me=(Q=p[x])==null?void 0:Q.methods)==null?void 0:me.includes(ne)}),De=o[x].events.filter(ne=>{var Q,me;return(me=(Q=p[x])==null?void 0:Q.events)==null?void 0:me.includes(ne)}),de=Z==null?void 0:Z.map(ne=>o[x].accounts.filter(Q=>Q.includes(`${ne}:`))).flat();b[x]={chains:Rt(($=b[x])==null?void 0:$.chains,Z),methods:Rt((ce=b[x])==null?void 0:ce.methods,le),events:Rt((F=b[x])==null?void 0:F.events,De),accounts:Rt((H=b[x])==null?void 0:H.accounts,de)}}),b)}function Fr(u){return u.includes(":")}function Ai(u){return Fr(u)?u.split(":")[0]:u}function ca(u){var s,r,o;const a={};if(!Ti(u))return a;for(const[p,g]of Object.entries(u)){const m=Fr(p)?[p]:g.chains,b=g.methods||[],x=g.events||[],C=Ai(p);a[C]=sp(rp({},a[C]),{chains:Rt(m,(s=a[C])==null?void 0:s.chains),methods:Rt(b,(r=a[C])==null?void 0:r.methods),events:Rt(x,(o=a[C])==null?void 0:o.events)})}return a}const cp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},up={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function A(u,s){const{message:r,code:o}=up[u];return{message:s?`${r} ${s}`:r,code:o}}function be(u,s){const{message:r,code:o}=cp[u];return{message:s?`${r} ${s}`:r,code:o}}function pi(u,s){return Array.isArray(u)?typeof s<"u"&&u.length?u.every(s):!0:!1}function Ti(u){return Object.getPrototypeOf(u)===Object.prototype&&Object.keys(u).length}function ze(u){return typeof u>"u"}function Ce(u,s){return s&&ze(u)?!0:typeof u=="string"&&!!u.trim().length}function Qs(u,s){return s&&ze(u)?!0:typeof u=="number"&&!isNaN(u)}function hp(u,s){const{requiredNamespaces:r}=s,o=Object.keys(u.namespaces),a=Object.keys(r);let p=!0;return li(a,o)?(o.forEach(g=>{const{accounts:m,methods:b,events:x}=u.namespaces[g],C=Ci(m),N=r[g];(!li(Ms(g,N),C)||!li(N.methods,b)||!li(N.events,x))&&(p=!1)}),p):!1}function jr(u){return Ce(u,!1)&&u.includes(":")?u.split(":").length===2:!1}function lp(u){if(Ce(u,!1)&&u.includes(":")){const s=u.split(":");if(s.length===3){const r=s[0]+":"+s[1];return!!s[2]&&jr(r)}}return!1}function pp(u){if(Ce(u,!1))try{return typeof new URL(u)<"u"}catch{return!1}return!1}function dp(u){var s;return(s=u==null?void 0:u.proposer)==null?void 0:s.publicKey}function fp(u){return u==null?void 0:u.topic}function gp(u,s){let r=null;return Ce(u==null?void 0:u.publicKey,!1)||(r=A("MISSING_OR_INVALID",`${s} controller public key should be a string`)),r}function ua(u){let s=!0;return pi(u)?u.length&&(s=u.every(r=>Ce(r,!1))):s=!1,s}function vp(u,s,r){let o=null;return pi(s)&&s.length?s.forEach(a=>{o||jr(a)||(o=be("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):jr(u)||(o=be("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),o}function yp(u,s,r){let o=null;return Object.entries(u).forEach(([a,p])=>{if(o)return;const g=vp(a,Ms(a,p),`${s} ${r}`);g&&(o=g)}),o}function mp(u,s){let r=null;return pi(u)?u.forEach(o=>{r||lp(o)||(r=be("UNSUPPORTED_ACCOUNTS",`${s}, account ${o} should be a string and conform to "namespace:chainId:address" format`))}):r=be("UNSUPPORTED_ACCOUNTS",`${s}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function wp(u,s){let r=null;return Object.values(u).forEach(o=>{if(r)return;const a=mp(o==null?void 0:o.accounts,`${s} namespace`);a&&(r=a)}),r}function _p(u,s){let r=null;return ua(u==null?void 0:u.methods)?ua(u==null?void 0:u.events)||(r=be("UNSUPPORTED_EVENTS",`${s}, events should be an array of strings or empty array for no events`)):r=be("UNSUPPORTED_METHODS",`${s}, methods should be an array of strings or empty array for no methods`),r}function ha(u,s){let r=null;return Object.values(u).forEach(o=>{if(r)return;const a=_p(o,`${s}, namespace`);a&&(r=a)}),r}function bp(u,s,r){let o=null;if(u&&Ti(u)){const a=ha(u,s);a&&(o=a);const p=yp(u,s,r);p&&(o=p)}else o=A("MISSING_OR_INVALID",`${s}, ${r} should be an object with data`);return o}function $r(u,s){let r=null;if(u&&Ti(u)){const o=ha(u,s);o&&(r=o);const a=wp(u,s);a&&(r=a)}else r=A("MISSING_OR_INVALID",`${s}, namespaces should be an object with data`);return r}function la(u){return Ce(u.protocol,!0)}function Ep(u,s){let r=!1;return s&&!u?r=!0:u&&pi(u)&&u.length&&u.forEach(o=>{r=la(o)}),r}function Ip(u){return typeof u=="number"}function Je(u){return typeof u<"u"&&typeof u!==null}function Pp(u){return!(!u||typeof u!="object"||!u.code||!Qs(u.code,!1)||!u.message||!Ce(u.message,!1))}function xp(u){return!(ze(u)||!Ce(u.method,!1))}function Sp(u){return!(ze(u)||ze(u.result)&&ze(u.error)||!Qs(u.id,!1)||!Ce(u.jsonrpc,!1))}function Rp(u){return!(ze(u)||!Ce(u.name,!1))}function pa(u,s){return!(!jr(s)||!np(u).includes(s))}function Op(u,s,r){return Ce(r,!1)?op(u,s).includes(r):!1}function Np(u,s,r){return Ce(r,!1)?ap(u,s).includes(r):!1}function Ys(u,s,r){let o=null;const a=Cp(u),p=Ap(s),g=Object.keys(a),m=Object.keys(p),b=da(Object.keys(u)),x=da(Object.keys(s)),C=b.filter(N=>!x.includes(N));return C.length&&(o=A("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${C.toString()}
      Received: ${Object.keys(s).toString()}`)),li(g,m)||(o=A("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${g.toString()}
      Approved: ${m.toString()}`)),Object.keys(s).forEach(N=>{if(!N.includes(":")||o)return;const $=Ci(s[N].accounts);$.includes(N)||(o=A("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${N}
        Required: ${N}
        Approved: ${$.toString()}`))}),g.forEach(N=>{o||(li(a[N].methods,p[N].methods)?li(a[N].events,p[N].events)||(o=A("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${N}`)):o=A("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${N}`))}),o}function Cp(u){const s={};return Object.keys(u).forEach(r=>{var o;r.includes(":")?s[r]=u[r]:(o=u[r].chains)==null||o.forEach(a=>{s[a]={methods:u[r].methods,events:u[r].events}})}),s}function da(u){return[...new Set(u.map(s=>s.includes(":")?s.split(":")[0]:s))]}function Ap(u){const s={};return Object.keys(u).forEach(r=>{if(r.includes(":"))s[r]=u[r];else{const o=Ci(u[r].accounts);o==null||o.forEach(a=>{s[a]={accounts:u[r].accounts.filter(p=>p.includes(`${a}:`)),methods:u[r].methods,events:u[r].events}})}}),s}function Tp(u,s){return Qs(u,!1)&&u<=s.max&&u>=s.min}function fa(){const u=Oi();return new Promise(s=>{switch(u){case Ge.browser:s(Dp());break;case Ge.reactNative:s(Fp());break;case Ge.node:s(jp());break;default:s(!0)}})}function Dp(){return Ri()&&(navigator==null?void 0:navigator.onLine)}async function Fp(){if(Si()&&typeof O.g<"u"&&O.g!=null&&O.g.NetInfo){const u=await(O.g==null?void 0:O.g.NetInfo.fetch());return u==null?void 0:u.isConnected}return!0}function jp(){return!0}function $p(u){switch(Oi()){case Ge.browser:qp(u);break;case Ge.reactNative:Lp(u);break;case Ge.node:break}}function qp(u){!Si()&&Ri()&&(window.addEventListener("online",()=>u(!0)),window.addEventListener("offline",()=>u(!1)))}function Lp(u){var s;Si()&&typeof O.g<"u"&&O.g!=null&&O.g.NetInfo&&((s=O.g)==null||s.NetInfo.addEventListener(r=>u(r==null?void 0:r.isConnected)))}const Zs={};class qr{static get(s){return Zs[s]}static set(s,r){Zs[s]=r}static delete(s){delete Zs[s]}}var V=O(23700);class Dt extends V.IJsonRpcProvider{constructor(s){super(s),this.events=new ee.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(s),this.connection.connected&&this.registerEventListeners()}async connect(s=this.connection){await this.open(s)}async disconnect(){await this.close()}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}off(s,r){this.events.off(s,r)}removeListener(s,r){this.events.removeListener(s,r)}async request(s,r){return this.requestStrict((0,V.formatJsonRpcRequest)(s.method,s.params||[],s.id||(0,V.getBigIntRpcId)().toString()),r)}async requestStrict(s,r){return new Promise(async(o,a)=>{if(!this.connection.connected)try{await this.open()}catch(p){a(p)}this.events.on(`${s.id}`,p=>{(0,V.isJsonRpcError)(p)?a(p.error):o(p.result)});try{await this.connection.send(s,r)}catch(p){a(p)}})}setConnection(s=this.connection){return s}onPayload(s){this.events.emit("payload",s),(0,V.isJsonRpcResponse)(s)?this.events.emit(`${s.id}`,s):this.events.emit("message",{type:s.method,data:s.params})}onClose(s){s&&s.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${s.code} ${s.reason?`(${s.reason})`:""}`)),this.events.emit("disconnect")}async open(s=this.connection){this.connection===s&&this.connection.connected||(this.connection.connected&&this.close(),typeof s=="string"&&(await this.connection.open(s),s=this.connection),this.connection=this.setConnection(s),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",s=>this.onPayload(s)),this.connection.on("close",s=>this.onClose(s)),this.connection.on("error",s=>this.events.emit("error",s)),this.connection.on("register_error",s=>this.onClose()),this.hasRegisteredEventListeners=!0)}}var xE=null,SE=null,Up=O(66865),Mp=O(5899),zp=O.n(Mp),kp=O(51538),Vp=O.n(kp);function Hp(u,s){if(u.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),o=0;o<r.length;o++)r[o]=255;for(var a=0;a<u.length;a++){var p=u.charAt(a),g=p.charCodeAt(0);if(r[g]!==255)throw new TypeError(p+" is ambiguous");r[g]=a}var m=u.length,b=u.charAt(0),x=Math.log(m)/Math.log(256),C=Math.log(256)/Math.log(m);function N(F){if(F instanceof Uint8Array||(ArrayBuffer.isView(F)?F=new Uint8Array(F.buffer,F.byteOffset,F.byteLength):Array.isArray(F)&&(F=Uint8Array.from(F))),!(F instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(F.length===0)return"";for(var H=0,Z=0,le=0,De=F.length;le!==De&&F[le]===0;)le++,H++;for(var de=(De-le)*C+1>>>0,ne=new Uint8Array(de);le!==De;){for(var Q=F[le],me=0,xe=de-1;(Q!==0||me<Z)&&xe!==-1;xe--,me++)Q+=256*ne[xe]>>>0,ne[xe]=Q%m>>>0,Q=Q/m>>>0;if(Q!==0)throw new Error("Non-zero carry");Z=me,le++}for(var Ve=de-Z;Ve!==de&&ne[Ve]===0;)Ve++;for(var Yt=b.repeat(H);Ve<de;++Ve)Yt+=u.charAt(ne[Ve]);return Yt}function $(F){if(typeof F!="string")throw new TypeError("Expected String");if(F.length===0)return new Uint8Array;var H=0;if(F[H]!==" "){for(var Z=0,le=0;F[H]===b;)Z++,H++;for(var De=(F.length-H)*x+1>>>0,de=new Uint8Array(De);F[H];){var ne=r[F.charCodeAt(H)];if(ne===255)return;for(var Q=0,me=De-1;(ne!==0||Q<le)&&me!==-1;me--,Q++)ne+=m*de[me]>>>0,de[me]=ne%256>>>0,ne=ne/256>>>0;if(ne!==0)throw new Error("Non-zero carry");le=Q,H++}if(F[H]!==" "){for(var xe=De-le;xe!==De&&de[xe]===0;)xe++;for(var Ve=new Uint8Array(Z+(De-xe)),Yt=Z;xe!==De;)Ve[Yt++]=de[xe++];return Ve}}}function ce(F){var H=$(F);if(H)return H;throw new Error(`Non-${s} character`)}return{encode:N,decodeUnsafe:$,decode:ce}}var Kp=Hp,Bp=Kp;const ga=u=>{if(u instanceof Uint8Array&&u.constructor.name==="Uint8Array")return u;if(u instanceof ArrayBuffer)return new Uint8Array(u);if(ArrayBuffer.isView(u))return new Uint8Array(u.buffer,u.byteOffset,u.byteLength);throw new Error("Unknown type, must be binary type")},Gp=u=>new TextEncoder().encode(u),Jp=u=>new TextDecoder().decode(u);class Wp{constructor(s,r,o){this.name=s,this.prefix=r,this.baseEncode=o}encode(s){if(s instanceof Uint8Array)return`${this.prefix}${this.baseEncode(s)}`;throw Error("Unknown type, must be binary type")}}class Qp{constructor(s,r,o){if(this.name=s,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=o}decode(s){if(typeof s=="string"){if(s.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(s)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(s.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(s){return va(this,s)}}class Yp{constructor(s){this.decoders=s}or(s){return va(this,s)}decode(s){const r=s[0],o=this.decoders[r];if(o)return o.decode(s);throw RangeError(`Unable to decode multibase string ${JSON.stringify(s)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const va=(u,s)=>new Yp({...u.decoders||{[u.prefix]:u},...s.decoders||{[s.prefix]:s}});class Zp{constructor(s,r,o,a){this.name=s,this.prefix=r,this.baseEncode=o,this.baseDecode=a,this.encoder=new Wp(s,r,o),this.decoder=new Qp(s,r,a)}encode(s){return this.encoder.encode(s)}decode(s){return this.decoder.decode(s)}}const Lr=({name:u,prefix:s,encode:r,decode:o})=>new Zp(u,s,r,o),tr=({prefix:u,name:s,alphabet:r})=>{const{encode:o,decode:a}=Bp(r,s);return Lr({prefix:u,name:s,encode:o,decode:p=>ga(a(p))})},Xp=(u,s,r,o)=>{const a={};for(let C=0;C<s.length;++C)a[s[C]]=C;let p=u.length;for(;u[p-1]==="=";)--p;const g=new Uint8Array(p*r/8|0);let m=0,b=0,x=0;for(let C=0;C<p;++C){const N=a[u[C]];if(N===void 0)throw new SyntaxError(`Non-${o} character`);b=b<<r|N,m+=r,m>=8&&(m-=8,g[x++]=255&b>>m)}if(m>=r||255&b<<8-m)throw new SyntaxError("Unexpected end of data");return g},ed=(u,s,r)=>{const o=s[s.length-1]==="=",a=(1<<r)-1;let p="",g=0,m=0;for(let b=0;b<u.length;++b)for(m=m<<8|u[b],g+=8;g>r;)g-=r,p+=s[a&m>>g];if(g&&(p+=s[a&m<<r-g]),o)for(;p.length*r&7;)p+="=";return p},Te=({name:u,prefix:s,bitsPerChar:r,alphabet:o})=>Lr({prefix:s,name:u,encode(a){return ed(a,o,r)},decode(a){return Xp(a,o,r,u)}}),td=Lr({prefix:"\0",name:"identity",encode:u=>Jp(u),decode:u=>Gp(u)});var id=Object.freeze({__proto__:null,identity:td});const rd=Te({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var sd=Object.freeze({__proto__:null,base2:rd});const nd=Te({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var od=Object.freeze({__proto__:null,base8:nd});const ad=tr({prefix:"9",name:"base10",alphabet:"0123456789"});var cd=Object.freeze({__proto__:null,base10:ad});const ud=Te({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),hd=Te({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ld=Object.freeze({__proto__:null,base16:ud,base16upper:hd});const pd=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),dd=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fd=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gd=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),vd=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yd=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),md=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),wd=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),_d=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var bd=Object.freeze({__proto__:null,base32:pd,base32upper:dd,base32pad:fd,base32padupper:gd,base32hex:vd,base32hexupper:yd,base32hexpad:md,base32hexpadupper:wd,base32z:_d});const Ed=tr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Id=tr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Pd=Object.freeze({__proto__:null,base36:Ed,base36upper:Id});const xd=tr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Sd=tr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Rd=Object.freeze({__proto__:null,base58btc:xd,base58flickr:Sd});const Od=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Nd=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Cd=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ad=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Td=Object.freeze({__proto__:null,base64:Od,base64pad:Nd,base64url:Cd,base64urlpad:Ad});const ya=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Dd=ya.reduce((u,s,r)=>(u[r]=s,u),[]),Fd=ya.reduce((u,s,r)=>(u[s.codePointAt(0)]=r,u),[]);function jd(u){return u.reduce((s,r)=>(s+=Dd[r],s),"")}function $d(u){const s=[];for(const r of u){const o=Fd[r.codePointAt(0)];if(o===void 0)throw new Error(`Non-base256emoji character: ${r}`);s.push(o)}return new Uint8Array(s)}const qd=Lr({prefix:"\u{1F680}",name:"base256emoji",encode:jd,decode:$d});var Ld=Object.freeze({__proto__:null,base256emoji:qd}),Ud=wa,ma=128,Md=127,zd=~Md,kd=Math.pow(2,31);function wa(u,s,r){s=s||[],r=r||0;for(var o=r;u>=kd;)s[r++]=u&255|ma,u/=128;for(;u&zd;)s[r++]=u&255|ma,u>>>=7;return s[r]=u|0,wa.bytes=r-o+1,s}var Vd=Xs,Hd=128,_a=127;function Xs(u,o){var r=0,o=o||0,a=0,p=o,g,m=u.length;do{if(p>=m)throw Xs.bytes=0,new RangeError("Could not decode varint");g=u[p++],r+=a<28?(g&_a)<<a:(g&_a)*Math.pow(2,a),a+=7}while(g>=Hd);return Xs.bytes=p-o,r}var Kd=Math.pow(2,7),Bd=Math.pow(2,14),Gd=Math.pow(2,21),Jd=Math.pow(2,28),Wd=Math.pow(2,35),Qd=Math.pow(2,42),Yd=Math.pow(2,49),Zd=Math.pow(2,56),Xd=Math.pow(2,63),ef=function(u){return u<Kd?1:u<Bd?2:u<Gd?3:u<Jd?4:u<Wd?5:u<Qd?6:u<Yd?7:u<Zd?8:u<Xd?9:10},tf={encode:Ud,decode:Vd,encodingLength:ef},ba=tf;const Ea=(u,s,r=0)=>(ba.encode(u,s,r),s),Ia=u=>ba.encodingLength(u),en=(u,s)=>{const r=s.byteLength,o=Ia(u),a=o+Ia(r),p=new Uint8Array(a+r);return Ea(u,p,0),Ea(r,p,o),p.set(s,a),new rf(u,r,s,p)};class rf{constructor(s,r,o,a){this.code=s,this.size=r,this.digest=o,this.bytes=a}}const Pa=({name:u,code:s,encode:r})=>new sf(u,s,r);class sf{constructor(s,r,o){this.name=s,this.code=r,this.encode=o}digest(s){if(s instanceof Uint8Array){const r=this.encode(s);return r instanceof Uint8Array?en(this.code,r):r.then(o=>en(this.code,o))}else throw Error("Unknown type, must be binary type")}}const xa=u=>async s=>new Uint8Array(await crypto.subtle.digest(u,s)),nf=Pa({name:"sha2-256",code:18,encode:xa("SHA-256")}),of=Pa({name:"sha2-512",code:19,encode:xa("SHA-512")});var af=Object.freeze({__proto__:null,sha256:nf,sha512:of});const Sa=0,cf="identity",Ra=ga;var uf=Object.freeze({__proto__:null,identity:{code:Sa,name:cf,encode:Ra,digest:u=>en(Sa,Ra(u))}});new TextEncoder,new TextDecoder;const Oa={...id,...sd,...od,...cd,...ld,...bd,...Pd,...Rd,...Td,...Ld};({...af,...uf});function Na(u){return globalThis.Buffer!=null?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):u}function hf(u=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Na(globalThis.Buffer.allocUnsafe(u)):new Uint8Array(u)}function Ca(u,s,r,o){return{name:u,prefix:s,encoder:{name:u,prefix:s,encode:r},decoder:{decode:o}}}const Aa=Ca("utf8","u",u=>"u"+new TextDecoder("utf8").decode(u),u=>new TextEncoder().encode(u.substring(1))),tn=Ca("ascii","a",u=>{let s="a";for(let r=0;r<u.length;r++)s+=String.fromCharCode(u[r]);return s},u=>{u=u.substring(1);const s=hf(u.length);for(let r=0;r<u.length;r++)s[r]=u.charCodeAt(r);return s}),lf={utf8:Aa,"utf-8":Aa,hex:Oa.base16,latin1:tn,ascii:tn,binary:tn,...Oa};function pf(u,s="utf8"){const r=lf[s];if(!r)throw new Error(`Unsupported encoding "${s}"`);return(s==="utf8"||s==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Na(globalThis.Buffer.from(u,"utf-8")):r.decoder.decode(`${r.prefix}${u}`)}const Ta="wc",df=2,rn="core",Wt=`${Ta}@2:${rn}:`,ff={name:rn,logger:"error"},gf={database:":memory:"},vf="crypto",Da="client_ed25519_seed",yf=U.ONE_DAY,mf="keychain",wf="0.3",_f="messages",bf="0.3",Ef=U.SIX_HOURS,If="publisher",Fa="irn",Pf="error",ja="wss://relay.walletconnect.com",$a="wss://relay.walletconnect.org",xf="relayer",qe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Sf="_subscription",Ft={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Rf=U.ONE_SECOND,NE={database:":memory:"},Of="2.11.2",Nf=1e4,Cf="0.3",Af="WALLETCONNECT_CLIENT_ID",wt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},CE=null,Tf="subscription",Df="0.3",Ff=U.FIVE_SECONDS*1e3,jf="pairing",$f="0.3",AE=null,ir={wc_pairingDelete:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:U.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:U.ONE_DAY,prompt:!1,tag:0},res:{ttl:U.ONE_DAY,prompt:!1,tag:0}}},rr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Ot={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},qf="history",Lf="0.3",Uf="expirer",ct={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Mf="0.3",TE=null,sn="verify-api",Di="https://verify.walletconnect.com",nn="https://verify.walletconnect.org",zf=[Di,nn],kf="echo",Vf="https://echo.walletconnect.com";class Hf{constructor(s,r){this.core=s,this.logger=r,this.keychain=new Map,this.name=mf,this.version=wf,this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{if(!this.initialized){const o=await this.getKeyChain();typeof o<"u"&&(this.keychain=o),this.initialized=!0}},this.has=o=>(this.isInitialized(),this.keychain.has(o)),this.set=async(o,a)=>{this.isInitialized(),this.keychain.set(o,a),await this.persist()},this.get=o=>{this.isInitialized();const a=this.keychain.get(o);if(typeof a>"u"){const{message:p}=A("NO_MATCHING_KEY",`${this.name}: ${o}`);throw new Error(p)}return a},this.del=async o=>{this.isInitialized(),this.keychain.delete(o),await this.persist()},this.core=s,this.logger=(0,J.Ep)(r,this.name)}get context(){return(0,J.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(s){await this.core.storage.setItem(this.storageKey,Xo(s))}async getKeyChain(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?ea(s):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Kf{constructor(s,r,o){this.core=s,this.logger=r,this.name=vf,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),p=Nr.generateKeyPair(a);return Nr.encodeIss(p.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=pl();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const p=await this.getClientSeed(),g=Nr.generateKeyPair(p),m=Bs(),b=yf;return await Nr.signJWT(m,a,b,g)},this.generateSharedKey=(a,p,g)=>{this.isInitialized();const m=this.getPrivateKey(a),b=dl(m,p);return this.setSymKey(b,g)},this.setSymKey=async(a,p)=>{this.isInitialized();const g=p||fl(a);return await this.keychain.set(g,a),g},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,p,g)=>{this.isInitialized();const m=Go(g),b=(0,Yi.u)(p);if(Jo(m)){const $=m.senderPublicKey,ce=m.receiverPublicKey;a=await this.generateSharedKey($,ce)}const x=this.getSymKey(a),{type:C,senderPublicKey:N}=m;return vl({type:C,symKey:x,message:b,senderPublicKey:N})},this.decode=async(a,p,g)=>{this.isInitialized();const m=wl(p,g);if(Jo(m)){const b=m.receiverPublicKey,x=m.senderPublicKey;a=await this.generateSharedKey(b,x)}try{const b=this.getSymKey(a),x=yl({symKey:b,encoded:p});return(0,Yi.D)(x)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}},this.getPayloadType=a=>{const p=Tr(a);return Xi(p.type)},this.getPayloadSenderPublicKey=a=>{const p=Tr(a);return p.senderPublicKey?(0,ge.BB)(p.senderPublicKey,Me):void 0},this.core=s,this.logger=(0,J.Ep)(r,this.name),this.keychain=o||new Hf(this.core,this.logger)}get context(){return(0,J.Fd)(this.logger)}async setPrivateKey(s,r){return await this.keychain.set(s,r),s}getPrivateKey(s){return this.keychain.get(s)}async getClientSeed(){let s="";try{s=this.keychain.get(Da)}catch{s=Bs(),await this.keychain.set(Da,s)}return pf(s,"base16")}getSymKey(s){return this.keychain.get(s)}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Bf extends at{constructor(s,r){super(s,r),this.logger=s,this.core=r,this.messages=new Map,this.name=_f,this.version=bf,this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const o=await this.getRelayerMessages();typeof o<"u"&&(this.messages=o),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(o){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(o)}finally{this.initialized=!0}}},this.set=async(o,a)=>{this.isInitialized();const p=xi(a);let g=this.messages.get(o);return typeof g>"u"&&(g={}),typeof g[p]<"u"||(g[p]=a,this.messages.set(o,g),await this.persist()),p},this.get=o=>{this.isInitialized();let a=this.messages.get(o);return typeof a>"u"&&(a={}),a},this.has=(o,a)=>{this.isInitialized();const p=this.get(o),g=xi(a);return typeof p[g]<"u"},this.del=async o=>{this.isInitialized(),this.messages.delete(o),await this.persist()},this.logger=(0,J.Ep)(s,this.name),this.core=r}get context(){return(0,J.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(s){await this.core.storage.setItem(this.storageKey,Xo(s))}async getRelayerMessages(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?ea(s):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Gf extends ui{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.events=new ee.EventEmitter,this.name=If,this.queue=new Map,this.publishTimeout=(0,U.toMiliseconds)(U.TEN_SECONDS*2),this.needsTransportRestart=!1,this.publish=async(o,a,p)=>{var g;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:p}});try{const m=(p==null?void 0:p.ttl)||Ef,b=Ws(p),x=(p==null?void 0:p.prompt)||!1,C=(p==null?void 0:p.tag)||0,N=(p==null?void 0:p.id)||(0,V.getBigIntRpcId)().toString(),$={topic:o,message:a,opts:{ttl:m,relay:b,prompt:x,tag:C,id:N}},ce=setTimeout(()=>this.queue.set(N,$),this.publishTimeout);try{await await er(this.rpcPublish(o,a,m,b,x,C,N),this.publishTimeout,`Failed to publish payload, please try again. id:${N} tag:${C}`),this.removeRequestFromQueue(N),this.relayer.events.emit(qe.publish,$)}catch(F){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(g=p==null?void 0:p.internal)!=null&&g.throwOnFailedPublish)throw this.removeRequestFromQueue(N),F;return}finally{clearTimeout(ce)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:p}})}catch(m){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(m),m}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.relayer=s,this.logger=(0,J.Ep)(r,this.name),this.registerEventListeners()}get context(){return(0,J.Fd)(this.logger)}rpcPublish(s,r,o,a,p,g,m){var b,x,C,N;const $={method:Dr(a.protocol).publish,params:{topic:s,message:r,ttl:o,prompt:p,tag:g},id:m};return ze((b=$.params)==null?void 0:b.prompt)&&((x=$.params)==null||delete x.prompt),ze((C=$.params)==null?void 0:C.tag)&&((N=$.params)==null||delete N.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:$}),this.relayer.request($)}removeRequestFromQueue(s){this.queue.delete(s)}checkQueue(){this.queue.forEach(async s=>{const{topic:r,message:o,opts:a}=s;await this.publish(r,o,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(mt.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(qe.connection_stalled);return}this.checkQueue()}),this.relayer.on(qe.message_ack,s=>{this.removeRequestFromQueue(s.id.toString())})}}class Jf{constructor(){this.map=new Map,this.set=(s,r)=>{const o=this.get(s);this.exists(s,r)||this.map.set(s,[...o,r])},this.get=s=>this.map.get(s)||[],this.exists=(s,r)=>this.get(s).includes(r),this.delete=(s,r)=>{if(typeof r>"u"){this.map.delete(s);return}if(!this.map.has(s))return;const o=this.get(s);if(!this.exists(s,r))return;const a=o.filter(p=>p!==r);if(!a.length){this.map.delete(s);return}this.map.set(s,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Wf=Object.defineProperty,Qf=Object.defineProperties,Yf=Object.getOwnPropertyDescriptors,qa=Object.getOwnPropertySymbols,Zf=Object.prototype.hasOwnProperty,Xf=Object.prototype.propertyIsEnumerable,La=(u,s,r)=>s in u?Wf(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,sr=(u,s)=>{for(var r in s||(s={}))Zf.call(s,r)&&La(u,r,s[r]);if(qa)for(var r of qa(s))Xf.call(s,r)&&La(u,r,s[r]);return u},on=(u,s)=>Qf(u,Yf(s));class eg extends Jh{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.subscriptions=new Map,this.topicMap=new Jf,this.events=new ee.EventEmitter,this.name=Tf,this.version=Df,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Wt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const p=Ws(a),g={topic:o,relay:p};this.pending.set(o,g);const m=await this.rpcSubscribe(o,p);return this.onSubscribe(m,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}}),m}catch(p){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(p),p}},this.unsubscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(o,a.id,a):await this.unsubscribeByTopic(o,a)},this.isSubscribed=async o=>{if(this.topics.includes(o))return!0;const a=`${this.pendingSubscriptionWatchLabel}_${o}`;return await new Promise((p,g)=>{const m=new U.Watch;m.start(a);const b=setInterval(()=>{!this.pending.has(o)&&this.topics.includes(o)&&(clearInterval(b),m.stop(a),p(!0)),m.elapsed(a)>=Ff&&(clearInterval(b),m.stop(a),g(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=s,this.logger=(0,J.Ep)(r,this.name),this.clientId=""}get context(){return(0,J.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(s,r){let o=!1;try{o=this.getSubscription(s).topic===r}catch{}return o}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(s,r){const o=this.topicMap.get(s);await Promise.all(o.map(async a=>await this.unsubscribeById(s,a,r)))}async unsubscribeById(s,r,o){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}});try{const a=Ws(o);await this.rpcUnsubscribe(s,r,a);const p=be("USER_DISCONNECTED",`${this.name}, ${s}`);await this.onUnsubscribe(s,r,p),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(s,r){const o={method:Dr(r.protocol).subscribe,params:{topic:s}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{await await er(this.relayer.request(o),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(qe.connection_stalled)}return xi(s+this.clientId)}async rpcBatchSubscribe(s){if(!s.length)return;const r=s[0].relay,o={method:Dr(r.protocol).batchSubscribe,params:{topics:s.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await er(this.relayer.request(o),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(qe.connection_stalled)}}rpcUnsubscribe(s,r,o){const a={method:Dr(o.protocol).unsubscribe,params:{topic:s,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(s,r){this.setSubscription(s,on(sr({},r),{id:s})),this.pending.delete(r.topic)}onBatchSubscribe(s){s.length&&s.forEach(r=>{this.setSubscription(r.id,sr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(s,r,o){this.events.removeAllListeners(r),this.hasSubscription(r,s)&&this.deleteSubscription(r,o),await this.relayer.messages.del(s)}async setRelayerSubscriptions(s){await this.relayer.core.storage.setItem(this.storageKey,s)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(s,r){this.subscriptions.has(s)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:s,subscription:r}),this.addSubscription(s,r))}addSubscription(s,r){this.subscriptions.set(s,sr({},r)),this.topicMap.set(r.topic,s),this.events.emit(wt.created,r)}getSubscription(s){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:s});const r=this.subscriptions.get(s);if(!r){const{message:o}=A("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}deleteSubscription(s,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:s,reason:r});const o=this.getSubscription(s);this.subscriptions.delete(s),this.topicMap.delete(o.topic,s),this.events.emit(wt.deleted,on(sr({},o),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(wt.sync)}async reset(){if(this.cached.length){const s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<s;r++){const o=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(o)}}this.events.emit(wt.resubscribed)}async restore(){try{const s=await this.getRelayerSubscriptions();if(typeof s>"u"||!s.length)return;if(this.subscriptions.size){const{message:r}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(s){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(s)}}async batchSubscribe(s){if(!s.length)return;const r=await this.rpcBatchSubscribe(s);pi(r)&&this.onBatchSubscribe(r.map((o,a)=>on(sr({},s[a]),{id:o})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const s=[];this.pending.forEach(r=>{s.push(r)}),await this.batchSubscribe(s)}registerEventListeners(){this.relayer.core.heartbeat.on(mt.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(qe.connect,async()=>{await this.onConnect()}),this.relayer.on(qe.disconnect,()=>{this.onDisconnect()}),this.events.on(wt.created,async s=>{const r=wt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()}),this.events.on(wt.deleted,async s=>{const r=wt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}async restartToComplete(){this.restartInProgress&&await new Promise(s=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),s())},this.pollingInterval)})}}var tg=Object.defineProperty,Ua=Object.getOwnPropertySymbols,ig=Object.prototype.hasOwnProperty,rg=Object.prototype.propertyIsEnumerable,Ma=(u,s,r)=>s in u?tg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,sg=(u,s)=>{for(var r in s||(s={}))ig.call(s,r)&&Ma(u,r,s[r]);if(Ua)for(var r of Ua(s))rg.call(s,r)&&Ma(u,r,s[r]);return u};class ng extends Or{constructor(s){super(s),this.protocol="wc",this.version=2,this.events=new ee.EventEmitter,this.name=xf,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.request=async r=>{this.logger.debug("Publishing Request Payload");const o=r.id;try{await this.toEstablishConnection();const a=this.provider.request(r);return this.requestsInFlight.set(o,{promise:a,request:r}),await a}catch(a){throw this.logger.debug("Failed to Publish Request"),this.logger.error(a),a}finally{this.requestsInFlight.delete(o)}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(qe.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(qe.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Ft.payload,this.onPayloadHandler),this.provider.on(Ft.connect,this.onConnectHandler),this.provider.on(Ft.disconnect,this.onDisconnectHandler),this.provider.on(Ft.error,this.onProviderErrorHandler)},this.core=s.core,this.logger=typeof s.logger<"u"&&typeof s.logger!="string"?(0,J.Ep)(s.logger,this.name):(0,J.gw)((0,J.jI)({level:s.logger||Pf})),this.messages=new Bf(this.logger,s.core),this.subscriber=new eg(this,this.logger),this.publisher=new Gf(this,this.logger),this.relayUrl=(s==null?void 0:s.relayUrl)||ja,this.projectId=s.projectId,this.bundleId=Sl(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${$a}...`),await this.restartTransport($a)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Nf)}get context(){return(0,J.Fd)(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(s,r,o){this.isInitialized(),await this.publisher.publish(s,r,o),await this.recordMessageEvent({topic:s,message:r,publishedAt:Date.now()})}async subscribe(s,r){var o;this.isInitialized();let a=((o=this.subscriber.topicMap.get(s))==null?void 0:o[0])||"";if(a)return a;let p;const g=m=>{m.topic===s&&(this.subscriber.off(wt.created,g),p())};return await Promise.all([new Promise(m=>{p=m,this.subscriber.on(wt.created,g)}),new Promise(async m=>{a=await this.subscriber.subscribe(s,r),m()})]),a}async unsubscribe(s,r){this.isInitialized(),await this.subscriber.unsubscribe(s,r)}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}off(s,r){this.events.off(s,r)}removeListener(s,r){this.events.removeListener(s,r)}async transportClose(){this.requestsInFlight.size>0&&(this.logger.debug("Waiting for all in-flight requests to finish before closing transport..."),this.requestsInFlight.forEach(async s=>{await s.promise})),this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await er(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(s){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){s&&s!==this.relayUrl&&(this.relayUrl=s,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(wt.resubscribed,()=>{r()})}),new Promise(async(r,o)=>{try{await er(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){o(a);return}r()})])}catch(r){this.logger.error(r);const o=r;if(!this.isConnectionStalled(o.message))throw r;this.provider.events.emit(Ft.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(s){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=s||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await fa())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(s){return this.staleConnectionErrors.some(r=>s.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const s=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Dt(new Up.Z(Tl({sdkVersion:Of,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:s,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(s){const{topic:r,message:o}=s;await this.messages.set(r,o)}async shouldIgnoreMessageEvent(s){const{topic:r,message:o}=s;if(!o||o.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${o}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,o);return a&&this.logger.debug(`Ignoring duplicate message: ${o}`),a}async onProviderPayload(s){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:s}),(0,V.isJsonRpcRequest)(s)){if(!s.method.endsWith(Sf))return;const r=s.params,{topic:o,message:a,publishedAt:p}=r.data,g={topic:o,message:a,publishedAt:p};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(sg({type:"event",event:r.id},g)),this.events.emit(r.id,g),await this.acknowledgePayload(s),await this.onMessageEvent(g)}else(0,V.isJsonRpcResponse)(s)&&this.events.emit(qe.message_ack,s)}async onMessageEvent(s){await this.shouldIgnoreMessageEvent(s)||(this.events.emit(qe.message,s),await this.recordMessageEvent(s))}async acknowledgePayload(s){const r=(0,V.formatJsonRpcResult)(s.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Ft.payload,this.onPayloadHandler),this.provider.off(Ft.connect,this.onConnectHandler),this.provider.off(Ft.disconnect,this.onDisconnectHandler),this.provider.off(Ft.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(qe.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let s=await fa();$p(async r=>{this.initialized&&s!==r&&(s=r,r?await this.restartTransport().catch(o=>this.logger.error(o)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(o=>this.logger.error(o))))})}onProviderDisconnect(){this.events.emit(qe.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(s=>this.logger.error(s))},(0,U.toMiliseconds)(Rf)))}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(s=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),s())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var og=Object.defineProperty,za=Object.getOwnPropertySymbols,ag=Object.prototype.hasOwnProperty,cg=Object.prototype.propertyIsEnumerable,ka=(u,s,r)=>s in u?og(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Va=(u,s)=>{for(var r in s||(s={}))ag.call(s,r)&&ka(u,r,s[r]);if(za)for(var r of za(s))cg.call(s,r)&&ka(u,r,s[r]);return u};class Ur extends Gh{constructor(s,r,o,a=Wt,p=void 0){super(s,r,o,a),this.core=s,this.logger=r,this.name=o,this.map=new Map,this.version=Cf,this.cached=[],this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!ze(g)?this.map.set(this.getKey(g),g):dp(g)?this.map.set(g.id,g):fp(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,m)=>{this.isInitialized(),this.map.has(g)?await this.update(g,m):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:m}),this.map.set(g,m),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(m=>Object.keys(g).every(b=>zp()(m[b],g[b]))):this.values),this.update=async(g,m)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:m});const b=Va(Va({},this.getData(g)),m);this.map.set(g,b),await this.persist()},this.delete=async(g,m)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:m}),this.map.delete(g),await this.persist())},this.logger=(0,J.Ep)(r,this.name),this.storagePrefix=a,this.getKey=p}get context(){return(0,J.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(s){await this.core.storage.setItem(this.storageKey,s)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(s){const r=this.map.get(s);if(!r){const{message:o}=A("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.error(o),new Error(o)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const s=await this.getDataStore();if(typeof s>"u"||!s.length)return;if(this.map.size){const{message:r}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(s){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(s)}}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}}class ug{constructor(s,r){this.core=s,this.logger=r,this.name=jf,this.version=$f,this.events=new(yt()),this.initialized=!1,this.storagePrefix=Wt,this.ignoredPayloadTypes=[hi],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:o})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...o])]},this.create=async()=>{this.isInitialized();const o=Bs(),a=await this.core.crypto.setSymKey(o),p=et(U.FIVE_MINUTES),g={protocol:Fa},m={topic:a,expiry:p,relay:g,active:!1},b=Yl({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:o,relay:g,expiryTimestamp:p});return await this.pairings.set(a,m),await this.core.relayer.subscribe(a),this.core.expirer.set(a,p),{topic:a,uri:b}},this.pair=async o=>{this.isInitialized(),this.isValidPair(o);const{topic:a,symKey:p,relay:g,expiryTimestamp:m}=na(o.uri);let b;if(this.pairings.keys.includes(a)&&(b=this.pairings.get(a),b.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const x=m||et(U.FIVE_MINUTES),C={topic:a,relay:g,expiry:x,active:!1};return await this.pairings.set(a,C),this.core.expirer.set(a,x),o.activatePairing&&await this.activate({topic:a}),this.events.emit(rr.create,C),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(p,a),await this.core.relayer.subscribe(a,{relay:g})),C},this.activate=async({topic:o})=>{this.isInitialized();const a=et(U.THIRTY_DAYS);await this.pairings.update(o,{active:!0,expiry:a}),this.core.expirer.set(o,a)},this.ping=async o=>{this.isInitialized(),await this.isValidPing(o);const{topic:a}=o;if(this.pairings.keys.includes(a)){const p=await this.sendRequest(a,"wc_pairingPing",{}),{done:g,resolve:m,reject:b}=Ni();this.events.once(Pe("pairing_ping",p),({error:x})=>{x?b(x):m()}),await g()}},this.updateExpiry=async({topic:o,expiry:a})=>{this.isInitialized(),await this.pairings.update(o,{expiry:a})},this.updateMetadata=async({topic:o,metadata:a})=>{this.isInitialized(),await this.pairings.update(o,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async o=>{this.isInitialized(),await this.isValidDisconnect(o);const{topic:a}=o;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",be("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(o,a,p)=>{const g=(0,V.formatJsonRpcRequest)(a,p),m=await this.core.crypto.encode(o,g),b=ir[a].req;return this.core.history.set(o,g),this.core.relayer.publish(o,m,b),g.id},this.sendResult=async(o,a,p)=>{const g=(0,V.formatJsonRpcResult)(o,p),m=await this.core.crypto.encode(a,g),b=await this.core.history.get(a,o),x=ir[b.request.method].res;await this.core.relayer.publish(a,m,x),await this.core.history.resolve(g)},this.sendError=async(o,a,p)=>{const g=(0,V.formatJsonRpcError)(o,p),m=await this.core.crypto.encode(a,g),b=await this.core.history.get(a,o),x=ir[b.request.method]?ir[b.request.method].res:ir.unregistered_method.res;await this.core.relayer.publish(a,m,x),await this.core.history.resolve(g)},this.deletePairing=async(o,a)=>{await this.core.relayer.unsubscribe(o),await Promise.all([this.pairings.delete(o,be("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(o),a?Promise.resolve():this.core.expirer.del(o)])},this.cleanup=async()=>{const o=this.pairings.getAll().filter(a=>Jt(a.expiry));await Promise.all(o.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=o=>{const{topic:a,payload:p}=o;switch(p.method){case"wc_pairingPing":return this.onPairingPingRequest(a,p);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,p);default:return this.onUnknownRpcMethodRequest(a,p)}},this.onRelayEventResponse=async o=>{const{topic:a,payload:p}=o,g=(await this.core.history.get(a,p.id)).request.method;switch(g){case"wc_pairingPing":return this.onPairingPingResponse(a,p);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(o,a)=>{const{id:p}=a;try{this.isValidPing({topic:o}),await this.sendResult(p,o,!0),this.events.emit(rr.ping,{id:p,topic:o})}catch(g){await this.sendError(p,o,g),this.logger.error(g)}},this.onPairingPingResponse=(o,a)=>{const{id:p}=a;setTimeout(()=>{(0,V.isJsonRpcResult)(a)?this.events.emit(Pe("pairing_ping",p),{}):(0,V.isJsonRpcError)(a)&&this.events.emit(Pe("pairing_ping",p),{error:a.error})},500)},this.onPairingDeleteRequest=async(o,a)=>{const{id:p}=a;try{this.isValidDisconnect({topic:o}),await this.deletePairing(o),this.events.emit(rr.delete,{id:p,topic:o})}catch(g){await this.sendError(p,o,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(o,a)=>{const{id:p,method:g}=a;try{if(this.registeredMethods.includes(g))return;const m=be("WC_METHOD_UNSUPPORTED",g);await this.sendError(p,o,m),this.logger.error(m)}catch(m){await this.sendError(p,o,m),this.logger.error(m)}},this.onUnknownRpcMethodResponse=o=>{this.registeredMethods.includes(o)||this.logger.error(be("WC_METHOD_UNSUPPORTED",o))},this.isValidPair=o=>{var a;if(!Je(o)){const{message:g}=A("MISSING_OR_INVALID",`pair() params: ${o}`);throw new Error(g)}if(!pp(o.uri)){const{message:g}=A("MISSING_OR_INVALID",`pair() uri: ${o.uri}`);throw new Error(g)}const p=na(o.uri);if(!((a=p==null?void 0:p.relay)!=null&&a.protocol)){const{message:g}=A("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(g)}if(!(p!=null&&p.symKey)){const{message:g}=A("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(g)}if(p!=null&&p.expiryTimestamp&&(0,U.toMiliseconds)(p==null?void 0:p.expiryTimestamp)<Date.now()){const{message:g}=A("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(g)}},this.isValidPing=async o=>{if(!Je(o)){const{message:p}=A("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(p)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidDisconnect=async o=>{if(!Je(o)){const{message:p}=A("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(p)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async o=>{if(!Ce(o,!1)){const{message:a}=A("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!this.pairings.keys.includes(o)){const{message:a}=A("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if(Jt(this.pairings.get(o).expiry)){await this.deletePairing(o);const{message:a}=A("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}},this.core=s,this.logger=(0,J.Ep)(r,this.name),this.pairings=new Ur(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,J.Fd)(this.logger)}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}registerRelayerEvents(){this.core.relayer.on(qe.message,async s=>{const{topic:r,message:o}=s;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(o)))return;const a=await this.core.crypto.decode(r,o);try{(0,V.isJsonRpcRequest)(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):(0,V.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(p){this.logger.error(p)}})}registerExpirerEvents(){this.core.expirer.on(ct.expired,async s=>{const{topic:r}=ia(s.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(rr.expire,{topic:r}))})}}class hg extends _e{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.records=new Map,this.events=new ee.EventEmitter,this.name=qf,this.version=Lf,this.cached=[],this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.records.set(o.id,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(o,a,p)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:o,request:a,chainId:p}),this.records.has(a.id))return;const g={id:a.id,topic:o,request:{method:a.method,params:a.params||null},chainId:p,expiry:et(U.THIRTY_DAYS)};this.records.set(g.id,g),this.events.emit(Ot.created,g)},this.resolve=async o=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:o}),!this.records.has(o.id))return;const a=await this.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,V.isJsonRpcError)(o)?{error:o.error}:{result:o.result},this.records.set(a.id,a),this.events.emit(Ot.updated,a))},this.get=async(o,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:o,id:a}),await this.getRecord(a)),this.delete=(o,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(p=>{if(p.topic===o){if(typeof a<"u"&&p.id!==a)return;this.records.delete(p.id),this.events.emit(Ot.deleted,p)}})},this.exists=async(o,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===o:!1),this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,J.Ep)(r,this.name)}get context(){return(0,J.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const s=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const o={topic:r.topic,request:(0,V.formatJsonRpcRequest)(r.request.method,r.request.params,r.id),chainId:r.chainId};return s.push(o)}),s}async setJsonRpcRecords(s){await this.core.storage.setItem(this.storageKey,s)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(s){this.isInitialized();const r=this.records.get(s);if(!r){const{message:o}=A("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Ot.sync)}async restore(){try{const s=await this.getJsonRpcRecords();if(typeof s>"u"||!s.length)return;if(this.records.size){const{message:r}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}}registerEventListeners(){this.events.on(Ot.created,s=>{const r=Ot.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.events.on(Ot.updated,s=>{const r=Ot.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.events.on(Ot.deleted,s=>{const r=Ot.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.core.heartbeat.on(mt.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(s=>{(0,U.toMiliseconds)(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.delete(s.topic,s.id))})}catch(s){this.logger.warn(s)}}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}}class lg extends Wh{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.expirations=new Map,this.events=new ee.EventEmitter,this.name=Uf,this.version=Mf,this.cached=[],this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.expirations.set(o.target,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=o=>{try{const a=this.formatTarget(o);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(o,a)=>{this.isInitialized();const p=this.formatTarget(o),g={target:p,expiry:a};this.expirations.set(p,g),this.checkExpiry(p,g),this.events.emit(ct.created,{target:p,expiration:g})},this.get=o=>{this.isInitialized();const a=this.formatTarget(o);return this.getExpiration(a)},this.del=o=>{if(this.isInitialized(),this.has(o)){const a=this.formatTarget(o),p=this.getExpiration(a);this.expirations.delete(a),this.events.emit(ct.deleted,{target:a,expiration:p})}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,J.Ep)(r,this.name)}get context(){return(0,J.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(s){if(typeof s=="string")return $l(s);if(typeof s=="number")return ql(s);const{message:r}=A("UNKNOWN_TYPE",`Target type: ${typeof s}`);throw new Error(r)}async setExpirations(s){await this.core.storage.setItem(this.storageKey,s)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ct.sync)}async restore(){try{const s=await this.getExpirations();if(typeof s>"u"||!s.length)return;if(this.expirations.size){const{message:r}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(s){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(s)}}getExpiration(s){const r=this.expirations.get(s);if(!r){const{message:o}=A("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.error(o),new Error(o)}return r}checkExpiry(s,r){const{expiry:o}=r;(0,U.toMiliseconds)(o)-Date.now()<=0&&this.expire(s,r)}expire(s,r){this.expirations.delete(s),this.events.emit(ct.expired,{target:s,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((s,r)=>this.checkExpiry(r,s))}registerEventListeners(){this.core.heartbeat.on(mt.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(ct.created,s=>{const r=ct.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(ct.expired,s=>{const r=ct.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(ct.deleted,s=>{const r=ct.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}}}class pg extends Qh{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.name=sn,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async o=>{if(this.verifyDisabled||Si()||!Ri())return;const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(p){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(p)}if(!this.initialized){this.removeIframe(),this.verifyUrl=nn;try{await this.createIframe()}catch(p){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(p),this.verifyDisabled=!0}}},this.register=async o=>{this.initialized?this.sendPost(o.attestationId):(this.addToQueue(o.attestationId),await this.init())},this.resolve=async o=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);let p;try{p=await this.fetchAttestation(o.attestationId,a)}catch(g){this.logger.info(`failed to resolve attestation: ${o.attestationId} from url: ${a}`),this.logger.info(g),p=await this.fetchAttestation(o.attestationId,nn)}return p},this.fetchAttestation=async(o,a)=>{this.logger.info(`resolving attestation: ${o} from url: ${a}`);const p=this.startAbortTimer(U.ONE_SECOND*2),g=await fetch(`${a}/attestation/${o}`,{signal:this.abortController.signal});return clearTimeout(p),g.status===200?await g.json():void 0},this.addToQueue=o=>{this.queue.push(o)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(o=>this.sendPost(o)),this.queue=[])},this.sendPost=o=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(o,"*"),this.logger.info(`postMessage sent: ${o} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let o;const a=p=>{p.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),o())};await Promise.race([new Promise(p=>{if(document.getElementById(sn))return p();window.addEventListener("message",a);const g=document.createElement("iframe");g.id=sn,g.src=`${this.verifyUrl}/${this.projectId}`,g.style.display="none",document.body.append(g),this.iframe=g,o=p}),new Promise((p,g)=>setTimeout(()=>{window.removeEventListener("message",a),g("verify iframe load timeout")},(0,U.toMiliseconds)(U.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=o=>{let a=o||Di;return zf.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Di}`),a=Di),a},this.logger=(0,J.Ep)(r,this.name),this.verifyUrl=Di,this.abortController=new AbortController,this.isDevEnv=Js()&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST}get context(){return(0,J.Fd)(this.logger)}startAbortTimer(s){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,U.toMiliseconds)(s))}}class dg extends Yh{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.context=kf,this.registerDeviceToken=async o=>{const{clientId:a,token:p,notificationType:g,enableEncrypted:m=!1}=o,b=`${Vf}/${this.projectId}/clients`;await Vp()(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:g,token:p,always_raw:m})})},this.logger=(0,J.Ep)(r,this.context)}}var fg=Object.defineProperty,Ha=Object.getOwnPropertySymbols,gg=Object.prototype.hasOwnProperty,vg=Object.prototype.propertyIsEnumerable,Ka=(u,s,r)=>s in u?fg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Ba=(u,s)=>{for(var r in s||(s={}))gg.call(s,r)&&Ka(u,r,s[r]);if(Ha)for(var r of Ha(s))vg.call(s,r)&&Ka(u,r,s[r]);return u};class an extends qs{constructor(s){super(s),this.protocol=Ta,this.version=df,this.name=rn,this.events=new ee.EventEmitter,this.initialized=!1,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.projectId=s==null?void 0:s.projectId,this.relayUrl=(s==null?void 0:s.relayUrl)||ja,this.customStoragePrefix=s!=null&&s.customStoragePrefix?`:${s.customStoragePrefix}`:"";const r=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,J.gw)((0,J.jI)({level:(s==null?void 0:s.logger)||ff.logger}));this.logger=(0,J.Ep)(r,this.name),this.heartbeat=new mt.HeartBeat,this.crypto=new Kf(this,this.logger,s==null?void 0:s.keychain),this.history=new hg(this,this.logger),this.expirer=new lg(this,this.logger),this.storage=s!=null&&s.storage?s.storage:new ci.Z(Ba(Ba({},gf),s==null?void 0:s.storageOptions)),this.relayer=new ng({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ug(this,this.logger),this.verify=new pg(this.projectId||"",this.logger),this.echoClient=new dg(this.projectId||"",this.logger)}static async init(s){const r=new an(s);await r.initialize();const o=await r.crypto.getClientId();return await r.storage.setItem(Af,o),r}get context(){return(0,J.Fd)(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(s){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,s),this.logger.error(s.message),s}}}const yg=an,Ga="wc",Ja=2,Wa="client",cn=`${Ga}@${Ja}:${Wa}:`,un={name:Wa,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},DE={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_request_expire:"session_request_expire"},FE={database:":memory:"},Qa="WALLETCONNECT_DEEPLINK_CHOICE",jE={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},$E="history",qE="0.3",mg="proposal",LE=null,Ya="Proposal expired",wg="session",Mr=U.SEVEN_DAYS,_g="engine",jt={wc_sessionPropose:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1104},res:{ttl:U.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1106},res:{ttl:U.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1112},res:{ttl:U.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1115}}},hn={min:U.FIVE_MINUTES,max:U.SEVEN_DAYS},$t={idle:"IDLE",active:"ACTIVE"},bg="request",Eg=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Ig=Object.defineProperty,Pg=Object.defineProperties,xg=Object.getOwnPropertyDescriptors,Za=Object.getOwnPropertySymbols,Sg=Object.prototype.hasOwnProperty,Rg=Object.prototype.propertyIsEnumerable,Xa=(u,s,r)=>s in u?Ig(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,ke=(u,s)=>{for(var r in s||(s={}))Sg.call(s,r)&&Xa(u,r,s[r]);if(Za)for(var r of Za(s))Rg.call(s,r)&&Xa(u,r,s[r]);return u},Fi=(u,s)=>Pg(u,xg(s));class Og extends Xh{constructor(s){super(s),this.name=_g,this.events=new(yt()),this.initialized=!1,this.ignoredPayloadTypes=[hi],this.requestQueue={state:$t.idle,queue:[]},this.sessionRequestQueue={state:$t.idle,queue:[]},this.requestQueueDelay=U.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(jt)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,U.toMiliseconds)(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const o=Fi(ke({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(o);const{pairingTopic:a,requiredNamespaces:p,optionalNamespaces:g,sessionProperties:m,relays:b}=o;let x=a,C,N=!1;if(x&&(N=this.client.core.pairing.pairings.get(x).active),!x||!N){const{topic:ne,uri:Q}=await this.client.core.pairing.create();x=ne,C=Q}const $=await this.client.core.crypto.generateKeyPair(),ce=jt.wc_sessionPropose.req.ttl||U.FIVE_MINUTES,F=et(ce),H=ke({requiredNamespaces:p,optionalNamespaces:g,relays:b??[{protocol:Fa}],proposer:{publicKey:$,metadata:this.client.metadata},expiryTimestamp:F},m&&{sessionProperties:m}),{reject:Z,resolve:le,done:De}=Ni(ce,Ya);if(this.events.once(Pe("session_connect"),async({error:ne,session:Q})=>{if(ne)Z(ne);else if(Q){Q.self.publicKey=$;const me=Fi(ke({},Q),{requiredNamespaces:H.requiredNamespaces,optionalNamespaces:H.optionalNamespaces});await this.client.session.set(Q.topic,me),await this.setExpiry(Q.topic,Q.expiry),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:Q.peer.metadata}),le(me)}}),!x){const{message:ne}=A("NO_MATCHING_KEY",`connect() pairing topic: ${x}`);throw new Error(ne)}const de=await this.sendRequest({topic:x,method:"wc_sessionPropose",params:H,throwOnFailedPublish:!0});return await this.setProposal(de,ke({id:de},H)),{uri:C,approval:De}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:o,relayProtocol:a,namespaces:p,sessionProperties:g}=r,m=this.client.proposal.get(o);let{pairingTopic:b,proposer:x,requiredNamespaces:C,optionalNamespaces:N}=m;b=b||"";const $=await this.client.core.crypto.generateKeyPair(),ce=x.publicKey,F=await this.client.core.crypto.generateSharedKey($,ce);b&&o&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:x.metadata}),await this.sendResult({id:o,topic:b,result:{relay:{protocol:a??"irn"},responderPublicKey:$}}),await this.client.proposal.delete(o,be("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const H=ke({relay:{protocol:a??"irn"},namespaces:p,pairingTopic:b,controller:{publicKey:$,metadata:this.client.metadata},expiry:et(Mr)},g&&{sessionProperties:g});await this.client.core.relayer.subscribe(F);const Z=Fi(ke({},H),{topic:F,requiredNamespaces:C,optionalNamespaces:N,pairingTopic:b,acknowledged:!1,self:H.controller,peer:{publicKey:x.publicKey,metadata:x.metadata},controller:$});await this.client.session.set(F,Z);try{await this.sendRequest({topic:F,method:"wc_sessionSettle",params:H,throwOnFailedPublish:!0})}catch(le){throw this.client.logger.error(le),this.client.session.delete(F,be("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(F),le}return await this.setExpiry(F,et(Mr)),{topic:F,acknowledged:()=>new Promise(le=>setTimeout(()=>le(this.client.session.get(F)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:o,reason:a}=r,{pairingTopic:p}=this.client.proposal.get(o);p&&(await this.sendError(o,p,a),await this.client.proposal.delete(o,be("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:o,namespaces:a}=r,p=await this.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:g,resolve:m,reject:b}=Ni();return this.events.once(Pe("session_update",p),({error:x})=>{x?b(x):m()}),await this.client.session.update(o,{namespaces:a}),{acknowledged:g}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:o}=r,a=await this.sendRequest({topic:o,method:"wc_sessionExtend",params:{}}),{done:p,resolve:g,reject:m}=Ni();return this.events.once(Pe("session_extend",a),({error:b})=>{b?m(b):g()}),await this.setExpiry(o,et(Mr)),{acknowledged:p}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:o,request:a,topic:p,expiry:g=jt.wc_sessionRequest.req.ttl}=r,m=(0,V.payloadId)(),{done:b,resolve:x,reject:C}=Ni(g,"Request expired. Please try again.");return this.events.once(Pe("session_request",m),({error:N,result:$})=>{N?C(N):x($)}),await Promise.all([new Promise(async N=>{await this.sendRequest({clientRpcId:m,topic:p,method:"wc_sessionRequest",params:{request:Fi(ke({},a),{expiryTimestamp:et(g)}),chainId:o},expiry:g,throwOnFailedPublish:!0}).catch($=>C($)),this.client.events.emit("session_request_sent",{topic:p,request:a,chainId:o,id:m}),N()}),new Promise(async N=>{const $=await Ul(this.client.core.storage,Qa);Ll({id:m,topic:p,wcDeepLink:$}),N()}),b()]).then(N=>N[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:o,response:a}=r,{id:p}=a;(0,V.isJsonRpcResult)(a)?await this.sendResult({id:p,topic:o,result:a.result,throwOnFailedPublish:!0}):(0,V.isJsonRpcError)(a)&&await this.sendError(p,o,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:o}=r;if(this.client.session.keys.includes(o)){const a=await this.sendRequest({topic:o,method:"wc_sessionPing",params:{}}),{done:p,resolve:g,reject:m}=Ni();this.events.once(Pe("session_ping",a),({error:b})=>{b?m(b):g()}),await p()}else this.client.core.pairing.pairings.keys.includes(o)&&await this.client.core.pairing.ping({topic:o})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:o,event:a,chainId:p}=r;await this.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:p}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:o}=r;if(this.client.session.keys.includes(o))await this.sendRequest({topic:o,method:"wc_sessionDelete",params:be("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:o,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(o))await this.client.core.pairing.disconnect({topic:o});else{const{message:a}=A("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(o=>hp(o,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const o=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(p=>{var g,m;return((g=p.peerMetadata)==null?void 0:g.url)&&((m=p.peerMetadata)==null?void 0:m.url)===r.peer.metadata.url&&p.topic&&p.topic!==o.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(p=>this.client.core.pairing.disconnect({topic:p.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(o){this.client.logger.error(o)}},this.deleteSession=async r=>{const{topic:o,expirerHasDeleted:a=!1,emitEvent:p=!0,id:g=0}=r,{self:m}=this.client.session.get(o);await this.client.core.relayer.unsubscribe(o),await this.client.session.delete(o,be("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(m.publicKey)&&await this.client.core.crypto.deleteKeyPair(m.publicKey),this.client.core.crypto.keychain.has(o)&&await this.client.core.crypto.deleteSymKey(o),a||this.client.core.expirer.del(o),this.client.core.storage.removeItem(Qa).catch(b=>this.client.logger.warn(b)),this.getPendingSessionRequests().forEach(b=>{b.topic===o&&this.deletePendingSessionRequest(b.id,be("USER_DISCONNECTED"))}),p&&this.client.events.emit("session_delete",{id:g,topic:o})},this.deleteProposal=async(r,o)=>{await Promise.all([this.client.proposal.delete(r,be("USER_DISCONNECTED")),o?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,o,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,o),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(p=>p.id!==r),a&&(this.sessionRequestQueue.state=$t.idle,this.client.events.emit("session_request_expire",{id:r}))},this.setExpiry=async(r,o)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:o}),this.client.core.expirer.set(r,o)},this.setProposal=async(r,o)=>{await this.client.proposal.set(r,o),this.client.core.expirer.set(r,et(jt.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async r=>{const{id:o,topic:a,params:p,verifyContext:g}=r,m=p.request.expiryTimestamp||et(jt.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(o,{id:o,topic:a,params:p,verifyContext:g}),m&&this.client.core.expirer.set(o,m)},this.sendRequest=async r=>{const{topic:o,method:a,params:p,expiry:g,relayRpcId:m,clientRpcId:b,throwOnFailedPublish:x}=r,C=(0,V.formatJsonRpcRequest)(a,p,b);if(Ri()&&Eg.includes(a)){const ce=xi(JSON.stringify(C));this.client.core.verify.register({attestationId:ce})}const N=await this.client.core.crypto.encode(o,C),$=jt[a].req;return g&&($.ttl=g),m&&($.id=m),this.client.core.history.set(o,C),x?($.internal=Fi(ke({},$.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,N,$)):this.client.core.relayer.publish(o,N,$).catch(ce=>this.client.logger.error(ce)),C.id},this.sendResult=async r=>{const{id:o,topic:a,result:p,throwOnFailedPublish:g}=r,m=(0,V.formatJsonRpcResult)(o,p),b=await this.client.core.crypto.encode(a,m),x=await this.client.core.history.get(a,o),C=jt[x.request.method].res;g?(C.internal=Fi(ke({},C.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,b,C)):this.client.core.relayer.publish(a,b,C).catch(N=>this.client.logger.error(N)),await this.client.core.history.resolve(m)},this.sendError=async(r,o,a)=>{const p=(0,V.formatJsonRpcError)(r,a),g=await this.client.core.crypto.encode(o,p),m=await this.client.core.history.get(o,r),b=jt[m.request.method].res;this.client.core.relayer.publish(o,g,b),await this.client.core.history.resolve(p)},this.cleanup=async()=>{const r=[],o=[];this.client.session.getAll().forEach(a=>{let p=!1;Jt(a.expiry)&&(p=!0),this.client.core.crypto.keychain.has(a.topic)||(p=!0),p&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Jt(a.expiryTimestamp)&&o.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession({topic:a})),...o.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===$t.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=$t.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(o=>setTimeout(o,300))}catch(o){this.client.logger.warn(o)}}this.requestQueue.state=$t.idle},this.processRequest=r=>{const{topic:o,payload:a}=r,p=a.method;switch(p){case"wc_sessionPropose":return this.onSessionProposeRequest(o,a);case"wc_sessionSettle":return this.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return this.onSessionExtendRequest(o,a);case"wc_sessionPing":return this.onSessionPingRequest(o,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return this.onSessionRequest(o,a);case"wc_sessionEvent":return this.onSessionEventRequest(o,a);default:return this.client.logger.info(`Unsupported request method ${p}`)}},this.onRelayEventResponse=async r=>{const{topic:o,payload:a}=r,p=(await this.client.core.history.get(o,a.id)).request.method;switch(p){case"wc_sessionPropose":return this.onSessionProposeResponse(o,a);case"wc_sessionSettle":return this.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return this.onSessionExtendResponse(o,a);case"wc_sessionPing":return this.onSessionPingResponse(o,a);case"wc_sessionRequest":return this.onSessionRequestResponse(o,a);default:return this.client.logger.info(`Unsupported response method ${p}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:o}=r,{message:a}=A("MISSING_OR_INVALID",`Decoded payload on topic ${o} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,o)=>{const{params:a,id:p}=o;try{this.isValidConnect(ke({},o.params));const g=a.expiryTimestamp||et(jt.wc_sessionPropose.req.ttl),m=ke({id:p,pairingTopic:r,expiryTimestamp:g},a);await this.setProposal(p,m);const b=xi(JSON.stringify(o)),x=await this.getVerifyContext(b,m.proposer.metadata);this.client.events.emit("session_proposal",{id:p,params:m,verifyContext:x})}catch(g){await this.sendError(p,r,g),this.client.logger.error(g)}},this.onSessionProposeResponse=async(r,o)=>{const{id:a}=o;if((0,V.isJsonRpcResult)(o)){const{result:p}=o;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:p});const g=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const m=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:m});const b=p.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const x=await this.client.core.crypto.generateSharedKey(m,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:x});const C=await this.client.core.relayer.subscribe(x);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:C}),await this.client.core.pairing.activate({topic:r})}else(0,V.isJsonRpcError)(o)&&(await this.client.proposal.delete(a,be("USER_DISCONNECTED")),this.events.emit(Pe("session_connect"),{error:o.error}))},this.onSessionSettleRequest=async(r,o)=>{const{id:a,params:p}=o;try{this.isValidSessionSettleRequest(p);const{relay:g,controller:m,expiry:b,namespaces:x,sessionProperties:C,pairingTopic:N}=o.params,$=ke({topic:r,relay:g,expiry:b,namespaces:x,acknowledged:!0,pairingTopic:N,requiredNamespaces:{},optionalNamespaces:{},controller:m.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:m.publicKey,metadata:m.metadata}},C&&{sessionProperties:C});await this.sendResult({id:o.id,topic:r,result:!0}),this.events.emit(Pe("session_connect"),{session:$}),this.cleanupDuplicatePairings($)}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.onSessionSettleResponse=async(r,o)=>{const{id:a}=o;(0,V.isJsonRpcResult)(o)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Pe("session_approve",a),{})):(0,V.isJsonRpcError)(o)&&(await this.client.session.delete(r,be("USER_DISCONNECTED")),this.events.emit(Pe("session_approve",a),{error:o.error}))},this.onSessionUpdateRequest=async(r,o)=>{const{params:a,id:p}=o;try{const g=`${r}_session_update`,m=qr.get(g);if(m&&this.isRequestOutOfSync(m,p)){this.client.logger.info(`Discarding out of sync request - ${p}`);return}this.isValidUpdate(ke({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:p,topic:r,result:!0}),this.client.events.emit("session_update",{id:p,topic:r,params:a}),qr.set(g,p)}catch(g){await this.sendError(p,r,g),this.client.logger.error(g)}},this.isRequestOutOfSync=(r,o)=>parseInt(o.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,o)=>{const{id:a}=o;(0,V.isJsonRpcResult)(o)?this.events.emit(Pe("session_update",a),{}):(0,V.isJsonRpcError)(o)&&this.events.emit(Pe("session_update",a),{error:o.error})},this.onSessionExtendRequest=async(r,o)=>{const{id:a}=o;try{this.isValidExtend({topic:r}),await this.setExpiry(r,et(Mr)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionExtendResponse=(r,o)=>{const{id:a}=o;(0,V.isJsonRpcResult)(o)?this.events.emit(Pe("session_extend",a),{}):(0,V.isJsonRpcError)(o)&&this.events.emit(Pe("session_extend",a),{error:o.error})},this.onSessionPingRequest=async(r,o)=>{const{id:a}=o;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionPingResponse=(r,o)=>{const{id:a}=o;setTimeout(()=>{(0,V.isJsonRpcResult)(o)?this.events.emit(Pe("session_ping",a),{}):(0,V.isJsonRpcError)(o)&&this.events.emit(Pe("session_ping",a),{error:o.error})},500)},this.onSessionDeleteRequest=async(r,o)=>{const{id:a}=o;try{this.isValidDisconnect({topic:r,reason:o.params}),await Promise.all([new Promise(p=>{this.client.core.relayer.once(qe.publish,async()=>{p(await this.deleteSession({topic:r,id:a}))})}),this.sendResult({id:a,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:be("USER_DISCONNECTED")})])}catch(p){this.client.logger.error(p)}},this.onSessionRequest=async(r,o)=>{const{id:a,params:p}=o;try{this.isValidRequest(ke({topic:r},p));const g=xi(JSON.stringify((0,V.formatJsonRpcRequest)("wc_sessionRequest",p,a))),m=this.client.session.get(r),b=await this.getVerifyContext(g,m.peer.metadata),x={id:a,topic:r,params:p,verifyContext:b};await this.setPendingSessionRequest(x),this.addSessionRequestToSessionRequestQueue(x),this.processSessionRequestQueue()}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.onSessionRequestResponse=(r,o)=>{const{id:a}=o;(0,V.isJsonRpcResult)(o)?this.events.emit(Pe("session_request",a),{result:o.result}):(0,V.isJsonRpcError)(o)&&this.events.emit(Pe("session_request",a),{error:o.error})},this.onSessionEventRequest=async(r,o)=>{const{id:a,params:p}=o;try{const g=`${r}_session_event_${p.event.name}`,m=qr.get(g);if(m&&this.isRequestOutOfSync(m,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(ke({topic:r},p)),this.client.events.emit("session_event",{id:a,topic:r,params:p}),qr.set(g,a)}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=$t.idle,this.processSessionRequestQueue()},(0,U.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:o})=>{const a=this.client.core.history.pending;a.length>0&&a.filter(p=>p.topic===r&&p.request.method==="wc_sessionRequest").forEach(p=>{this.events.emit(Pe("session_request",p.request.id),{error:o})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===$t.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=$t.active,this.client.events.emit("session_request",r)}catch(o){this.client.logger.error(o)}},this.onPairingCreated=r=>{if(r.active)return;const o=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);o&&this.onSessionProposeRequest(r.topic,(0,V.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,relays:o.relays,proposer:o.proposer,sessionProperties:o.sessionProperties},o.id))},this.isValidConnect=async r=>{if(!Je(r)){const{message:b}=A("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(b)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:p,sessionProperties:g,relays:m}=r;if(ze(o)||await this.isValidPairingTopic(o),!Ep(m,!0)){const{message:b}=A("MISSING_OR_INVALID",`connect() relays: ${m}`);throw new Error(b)}!ze(a)&&Ti(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ze(p)&&Ti(p)!==0&&this.validateNamespaces(p,"optionalNamespaces"),ze(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(r,o)=>{const a=bp(r,"connect()",o);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!Je(r))throw new Error(A("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:o,namespaces:a,relayProtocol:p,sessionProperties:g}=r;await this.isValidProposalId(o);const m=this.client.proposal.get(o),b=$r(a,"approve()");if(b)throw new Error(b.message);const x=Ys(m.requiredNamespaces,a,"approve()");if(x)throw new Error(x.message);if(!Ce(p,!0)){const{message:C}=A("MISSING_OR_INVALID",`approve() relayProtocol: ${p}`);throw new Error(C)}ze(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async r=>{if(!Je(r)){const{message:p}=A("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(p)}const{id:o,reason:a}=r;if(await this.isValidProposalId(o),!Pp(a)){const{message:p}=A("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(p)}},this.isValidSessionSettleRequest=r=>{if(!Je(r)){const{message:x}=A("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(x)}const{relay:o,controller:a,namespaces:p,expiry:g}=r;if(!la(o)){const{message:x}=A("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(x)}const m=gp(a,"onSessionSettleRequest()");if(m)throw new Error(m.message);const b=$r(p,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(Jt(g)){const{message:x}=A("EXPIRED","onSessionSettleRequest()");throw new Error(x)}},this.isValidUpdate=async r=>{if(!Je(r)){const{message:b}=A("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(b)}const{topic:o,namespaces:a}=r;await this.isValidSessionTopic(o);const p=this.client.session.get(o),g=$r(a,"update()");if(g)throw new Error(g.message);const m=Ys(p.requiredNamespaces,a,"update()");if(m)throw new Error(m.message)},this.isValidExtend=async r=>{if(!Je(r)){const{message:a}=A("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionTopic(o)},this.isValidRequest=async r=>{if(!Je(r)){const{message:b}=A("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(b)}const{topic:o,request:a,chainId:p,expiry:g}=r;await this.isValidSessionTopic(o);const{namespaces:m}=this.client.session.get(o);if(!pa(m,p)){const{message:b}=A("MISSING_OR_INVALID",`request() chainId: ${p}`);throw new Error(b)}if(!xp(a)){const{message:b}=A("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(b)}if(!Op(m,p,a.method)){const{message:b}=A("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(b)}if(g&&!Tp(g,hn)){const{message:b}=A("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${hn.min} and ${hn.max}`);throw new Error(b)}},this.isValidRespond=async r=>{var o;if(!Je(r)){const{message:g}=A("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(g)}const{topic:a,response:p}=r;try{await this.isValidSessionTopic(a)}catch(g){throw(o=r==null?void 0:r.response)!=null&&o.id&&this.cleanupAfterResponse(r),g}if(!Sp(p)){const{message:g}=A("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(p)}`);throw new Error(g)}},this.isValidPing=async r=>{if(!Je(r)){const{message:a}=A("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.isValidEmit=async r=>{if(!Je(r)){const{message:m}=A("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(m)}const{topic:o,event:a,chainId:p}=r;await this.isValidSessionTopic(o);const{namespaces:g}=this.client.session.get(o);if(!pa(g,p)){const{message:m}=A("MISSING_OR_INVALID",`emit() chainId: ${p}`);throw new Error(m)}if(!Rp(a)){const{message:m}=A("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(m)}if(!Np(g,p,a.name)){const{message:m}=A("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(m)}},this.isValidDisconnect=async r=>{if(!Je(r)){const{message:a}=A("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.getVerifyContext=async(r,o)=>{const a={verified:{verifyUrl:o.verifyUrl||Di,validation:"UNKNOWN",origin:o.url||""}};try{const p=await this.client.core.verify.resolve({attestationId:r,verifyUrl:o.verifyUrl});p&&(a.verified.origin=p.origin,a.verified.isScam=p.isScam,a.verified.validation=p.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(p){this.client.logger.info(p)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,o)=>{Object.values(r).forEach(a=>{if(!Ce(a,!1)){const{message:p}=A("MISSING_OR_INVALID",`${o} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(p)}})}}async isInitialized(){if(!this.initialized){const{message:s}=A("NOT_INITIALIZED",this.name);throw new Error(s)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(qe.message,async s=>{const{topic:r,message:o}=s;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(o)))return;const a=await this.client.core.crypto.decode(r,o);try{(0,V.isJsonRpcRequest)(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):(0,V.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(p){this.client.logger.error(p)}})}registerExpirerEvents(){this.client.core.expirer.on(ct.expired,async s=>{const{topic:r,id:o}=ia(s.target);if(o&&this.client.pendingRequest.keys.includes(o))return await this.deletePendingSessionRequest(o,A("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):o&&(await this.deleteProposal(o,!0),this.client.events.emit("proposal_expire",{id:o}))})}registerPairingEvents(){this.client.core.pairing.events.on(rr.create,s=>this.onPairingCreated(s))}isValidPairingTopic(s){if(!Ce(s,!1)){const{message:r}=A("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(s)){const{message:r}=A("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if(Jt(this.client.core.pairing.pairings.get(s).expiry)){const{message:r}=A("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}}async isValidSessionTopic(s){if(!Ce(s,!1)){const{message:r}=A("MISSING_OR_INVALID",`session topic should be a string: ${s}`);throw new Error(r)}if(!this.client.session.keys.includes(s)){const{message:r}=A("NO_MATCHING_KEY",`session topic doesn't exist: ${s}`);throw new Error(r)}if(Jt(this.client.session.get(s).expiry)){await this.deleteSession({topic:s});const{message:r}=A("EXPIRED",`session topic: ${s}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(s)){const{message:r}=A("MISSING_OR_INVALID",`session topic does not exist in keychain: ${s}`);throw await this.deleteSession({topic:s}),new Error(r)}}async isValidSessionOrPairingTopic(s){if(this.client.session.keys.includes(s))await this.isValidSessionTopic(s);else if(this.client.core.pairing.pairings.keys.includes(s))this.isValidPairingTopic(s);else if(Ce(s,!1)){const{message:r}=A("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${s}`);throw new Error(r)}else{const{message:r}=A("MISSING_OR_INVALID",`session or pairing topic should be a string: ${s}`);throw new Error(r)}}async isValidProposalId(s){if(!Ip(s)){const{message:r}=A("MISSING_OR_INVALID",`proposal id should be a number: ${s}`);throw new Error(r)}if(!this.client.proposal.keys.includes(s)){const{message:r}=A("NO_MATCHING_KEY",`proposal id doesn't exist: ${s}`);throw new Error(r)}if(Jt(this.client.proposal.get(s).expiryTimestamp)){await this.deleteProposal(s);const{message:r}=A("EXPIRED",`proposal id: ${s}`);throw new Error(r)}}}class Ng extends Ur{constructor(s,r){super(s,r,mg,cn),this.core=s,this.logger=r}}class Cg extends Ur{constructor(s,r){super(s,r,wg,cn),this.core=s,this.logger=r}}class Ag extends Ur{constructor(s,r){super(s,r,bg,cn,o=>o.id),this.core=s,this.logger=r}}class ln extends Zh{constructor(s){super(s),this.protocol=Ga,this.version=Ja,this.name=un.name,this.events=new ee.EventEmitter,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.removeAllListeners=o=>this.events.removeAllListeners(o),this.connect=async o=>{try{return await this.engine.connect(o)}catch(a){throw this.logger.error(a.message),a}},this.pair=async o=>{try{return await this.engine.pair(o)}catch(a){throw this.logger.error(a.message),a}},this.approve=async o=>{try{return await this.engine.approve(o)}catch(a){throw this.logger.error(a.message),a}},this.reject=async o=>{try{return await this.engine.reject(o)}catch(a){throw this.logger.error(a.message),a}},this.update=async o=>{try{return await this.engine.update(o)}catch(a){throw this.logger.error(a.message),a}},this.extend=async o=>{try{return await this.engine.extend(o)}catch(a){throw this.logger.error(a.message),a}},this.request=async o=>{try{return await this.engine.request(o)}catch(a){throw this.logger.error(a.message),a}},this.respond=async o=>{try{return await this.engine.respond(o)}catch(a){throw this.logger.error(a.message),a}},this.ping=async o=>{try{return await this.engine.ping(o)}catch(a){throw this.logger.error(a.message),a}},this.emit=async o=>{try{return await this.engine.emit(o)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async o=>{try{return await this.engine.disconnect(o)}catch(a){throw this.logger.error(a.message),a}},this.find=o=>{try{return this.engine.find(o)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(o){throw this.logger.error(o.message),o}},this.name=(s==null?void 0:s.name)||un.name,this.metadata=(s==null?void 0:s.metadata)||Ol();const r=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,J.gw)((0,J.jI)({level:(s==null?void 0:s.logger)||un.logger}));this.core=(s==null?void 0:s.core)||new yg(s),this.logger=(0,J.Ep)(r,this.name),this.session=new Cg(this.core,this.logger),this.proposal=new Ng(this.core,this.logger),this.pendingRequest=new Ag(this.core,this.logger),this.engine=new Og(this)}static async init(s){const r=new ln(s);return await r.initialize(),r}get context(){return(0,J.Fd)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(s){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(s.message),s}}}const UE=null,ME=null;var ec=O(71315),Tg=O(52830),tc=O.n(Tg);const ic={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"},rc=10;class sc{constructor(s,r=!1){if(this.url=s,this.disableProviderPing=r,this.events=new ee.EventEmitter,this.isAvailable=!1,this.registering=!1,!(0,V.isHttpUrl)(s))throw new Error(`Provided URL is not compatible with HTTP connection: ${s}`);this.url=s,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}off(s,r){this.events.off(s,r)}removeListener(s,r){this.events.removeListener(s,r)}async open(s=this.url){await this.register(s)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(s,r){this.isAvailable||await this.register();try{const o=(0,Yi.u)(s),p=await(await tc()(this.url,Object.assign(Object.assign({},ic),{body:o}))).json();this.onPayload({data:p})}catch(o){this.onError(s.id,o)}}async register(s=this.url){if(!(0,V.isHttpUrl)(s))throw new Error(`Provided URL is not compatible with HTTP connection: ${s}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((o,a)=>{this.events.once("register_error",p=>{this.resetMaxListeners(),a(p)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));o()})})}this.url=s,this.registering=!0;try{if(!this.disableProviderPing){const r=(0,Yi.u)({id:1,jsonrpc:"2.0",method:"test",params:[]});await tc()(s,Object.assign(Object.assign({},ic),{body:r}))}this.onOpen()}catch(r){const o=this.parseError(r);throw this.events.emit("register_error",o),this.onClose(),o}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(s){if(typeof s.data>"u")return;const r=typeof s.data=="string"?(0,Yi.D)(s.data):s.data;this.events.emit("payload",r)}onError(s,r){const o=this.parseError(r),a=o.message||o.toString(),p=(0,V.formatJsonRpcError)(s,a);this.events.emit("payload",p)}parseError(s,r=this.url){return(0,V.parseConnectionError)(s,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>rc&&this.events.setMaxListeners(rc)}}var Dg=sc,di=Dg;const nc="error",Fg="wss://relay.walletconnect.com",jg="wc",$g="universal_provider",oc=`${jg}@2:${$g}:`,qg="https://rpc.walletconnect.com/v1/",qt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var nr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof O.g<"u"?O.g:typeof self<"u"?self:{},pn={exports:{}};(function(u,s){(function(){var r,o="4.17.21",a=200,p="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",m="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",x=500,C="__lodash_placeholder__",N=1,$=2,ce=4,F=1,H=2,Z=1,le=2,De=4,de=8,ne=16,Q=32,me=64,xe=128,Ve=256,Yt=512,av=30,cv="...",uv=800,hv=16,gc=1,lv=2,pv=3,gi=1/0,Zt=9007199254740991,dv=17976931348623157e292,Hr=0/0,Nt=4294967295,fv=Nt-1,gv=Nt>>>1,vv=[["ary",xe],["bind",Z],["bindKey",le],["curry",de],["curryRight",ne],["flip",Yt],["partial",Q],["partialRight",me],["rearg",Ve]],ji="[object Arguments]",Kr="[object Array]",yv="[object AsyncFunction]",or="[object Boolean]",ar="[object Date]",mv="[object DOMException]",Br="[object Error]",Gr="[object Function]",vc="[object GeneratorFunction]",_t="[object Map]",cr="[object Number]",wv="[object Null]",Lt="[object Object]",yc="[object Promise]",_v="[object Proxy]",ur="[object RegExp]",bt="[object Set]",hr="[object String]",Jr="[object Symbol]",bv="[object Undefined]",lr="[object WeakMap]",Ev="[object WeakSet]",pr="[object ArrayBuffer]",$i="[object DataView]",vn="[object Float32Array]",yn="[object Float64Array]",mn="[object Int8Array]",wn="[object Int16Array]",_n="[object Int32Array]",bn="[object Uint8Array]",En="[object Uint8ClampedArray]",In="[object Uint16Array]",Pn="[object Uint32Array]",Iv=/\b__p \+= '';/g,Pv=/\b(__p \+=) '' \+/g,xv=/(__e\(.*?\)|\b__t\)) \+\n'';/g,mc=/&(?:amp|lt|gt|quot|#39);/g,wc=/[&<>"']/g,Sv=RegExp(mc.source),Rv=RegExp(wc.source),Ov=/<%-([\s\S]+?)%>/g,Nv=/<%([\s\S]+?)%>/g,_c=/<%=([\s\S]+?)%>/g,Cv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Av=/^\w*$/,Tv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xn=/[\\^$.*+?()[\]{}|]/g,Dv=RegExp(xn.source),Sn=/^\s+/,Fv=/\s/,jv=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,$v=/\{\n\/\* \[wrapped with (.+)\] \*/,qv=/,? & /,Lv=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Uv=/[()=,{}\[\]\/\s]/,Mv=/\\(\\)?/g,zv=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,bc=/\w*$/,kv=/^[-+]0x[0-9a-f]+$/i,Vv=/^0b[01]+$/i,Hv=/^\[object .+?Constructor\]$/,Kv=/^0o[0-7]+$/i,Bv=/^(?:0|[1-9]\d*)$/,Gv=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Wr=/($^)/,Jv=/['\n\r\u2028\u2029\\]/g,Qr="\\ud800-\\udfff",Wv="\\u0300-\\u036f",Qv="\\ufe20-\\ufe2f",Yv="\\u20d0-\\u20ff",Ec=Wv+Qv+Yv,Ic="\\u2700-\\u27bf",Pc="a-z\\xdf-\\xf6\\xf8-\\xff",Zv="\\xac\\xb1\\xd7\\xf7",Xv="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ey="\\u2000-\\u206f",ty=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xc="A-Z\\xc0-\\xd6\\xd8-\\xde",Sc="\\ufe0e\\ufe0f",Rc=Zv+Xv+ey+ty,Rn="['\u2019]",iy="["+Qr+"]",Oc="["+Rc+"]",Yr="["+Ec+"]",Nc="\\d+",ry="["+Ic+"]",Cc="["+Pc+"]",Ac="[^"+Qr+Rc+Nc+Ic+Pc+xc+"]",On="\\ud83c[\\udffb-\\udfff]",sy="(?:"+Yr+"|"+On+")",Tc="[^"+Qr+"]",Nn="(?:\\ud83c[\\udde6-\\uddff]){2}",Cn="[\\ud800-\\udbff][\\udc00-\\udfff]",qi="["+xc+"]",Dc="\\u200d",Fc="(?:"+Cc+"|"+Ac+")",ny="(?:"+qi+"|"+Ac+")",jc="(?:"+Rn+"(?:d|ll|m|re|s|t|ve))?",$c="(?:"+Rn+"(?:D|LL|M|RE|S|T|VE))?",qc=sy+"?",Lc="["+Sc+"]?",oy="(?:"+Dc+"(?:"+[Tc,Nn,Cn].join("|")+")"+Lc+qc+")*",ay="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",cy="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Uc=Lc+qc+oy,uy="(?:"+[ry,Nn,Cn].join("|")+")"+Uc,hy="(?:"+[Tc+Yr+"?",Yr,Nn,Cn,iy].join("|")+")",ly=RegExp(Rn,"g"),py=RegExp(Yr,"g"),An=RegExp(On+"(?="+On+")|"+hy+Uc,"g"),dy=RegExp([qi+"?"+Cc+"+"+jc+"(?="+[Oc,qi,"$"].join("|")+")",ny+"+"+$c+"(?="+[Oc,qi+Fc,"$"].join("|")+")",qi+"?"+Fc+"+"+jc,qi+"+"+$c,cy,ay,Nc,uy].join("|"),"g"),fy=RegExp("["+Dc+Qr+Ec+Sc+"]"),gy=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,vy=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],yy=-1,ve={};ve[vn]=ve[yn]=ve[mn]=ve[wn]=ve[_n]=ve[bn]=ve[En]=ve[In]=ve[Pn]=!0,ve[ji]=ve[Kr]=ve[pr]=ve[or]=ve[$i]=ve[ar]=ve[Br]=ve[Gr]=ve[_t]=ve[cr]=ve[Lt]=ve[ur]=ve[bt]=ve[hr]=ve[lr]=!1;var fe={};fe[ji]=fe[Kr]=fe[pr]=fe[$i]=fe[or]=fe[ar]=fe[vn]=fe[yn]=fe[mn]=fe[wn]=fe[_n]=fe[_t]=fe[cr]=fe[Lt]=fe[ur]=fe[bt]=fe[hr]=fe[Jr]=fe[bn]=fe[En]=fe[In]=fe[Pn]=!0,fe[Br]=fe[Gr]=fe[lr]=!1;var my={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},wy={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_y={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},by={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ey=parseFloat,Iy=parseInt,Mc=typeof nr=="object"&&nr&&nr.Object===Object&&nr,Py=typeof self=="object"&&self&&self.Object===Object&&self,je=Mc||Py||Function("return this")(),Tn=s&&!s.nodeType&&s,vi=Tn&&!0&&u&&!u.nodeType&&u,zc=vi&&vi.exports===Tn,Dn=zc&&Mc.process,ut=function(){try{var w=vi&&vi.require&&vi.require("util").types;return w||Dn&&Dn.binding&&Dn.binding("util")}catch{}}(),kc=ut&&ut.isArrayBuffer,Vc=ut&&ut.isDate,Hc=ut&&ut.isMap,Kc=ut&&ut.isRegExp,Bc=ut&&ut.isSet,Gc=ut&&ut.isTypedArray;function tt(w,I,E){switch(E.length){case 0:return w.call(I);case 1:return w.call(I,E[0]);case 2:return w.call(I,E[0],E[1]);case 3:return w.call(I,E[0],E[1],E[2])}return w.apply(I,E)}function xy(w,I,E,D){for(var K=-1,oe=w==null?0:w.length;++K<oe;){var Oe=w[K];I(D,Oe,E(Oe),w)}return D}function ht(w,I){for(var E=-1,D=w==null?0:w.length;++E<D&&I(w[E],E,w)!==!1;);return w}function Sy(w,I){for(var E=w==null?0:w.length;E--&&I(w[E],E,w)!==!1;);return w}function Jc(w,I){for(var E=-1,D=w==null?0:w.length;++E<D;)if(!I(w[E],E,w))return!1;return!0}function Xt(w,I){for(var E=-1,D=w==null?0:w.length,K=0,oe=[];++E<D;){var Oe=w[E];I(Oe,E,w)&&(oe[K++]=Oe)}return oe}function Zr(w,I){var E=w==null?0:w.length;return!!E&&Li(w,I,0)>-1}function Fn(w,I,E){for(var D=-1,K=w==null?0:w.length;++D<K;)if(E(I,w[D]))return!0;return!1}function we(w,I){for(var E=-1,D=w==null?0:w.length,K=Array(D);++E<D;)K[E]=I(w[E],E,w);return K}function ei(w,I){for(var E=-1,D=I.length,K=w.length;++E<D;)w[K+E]=I[E];return w}function jn(w,I,E,D){var K=-1,oe=w==null?0:w.length;for(D&&oe&&(E=w[++K]);++K<oe;)E=I(E,w[K],K,w);return E}function Ry(w,I,E,D){var K=w==null?0:w.length;for(D&&K&&(E=w[--K]);K--;)E=I(E,w[K],K,w);return E}function $n(w,I){for(var E=-1,D=w==null?0:w.length;++E<D;)if(I(w[E],E,w))return!0;return!1}var Oy=qn("length");function Ny(w){return w.split("")}function Cy(w){return w.match(Lv)||[]}function Wc(w,I,E){var D;return E(w,function(K,oe,Oe){if(I(K,oe,Oe))return D=oe,!1}),D}function Xr(w,I,E,D){for(var K=w.length,oe=E+(D?1:-1);D?oe--:++oe<K;)if(I(w[oe],oe,w))return oe;return-1}function Li(w,I,E){return I===I?ky(w,I,E):Xr(w,Qc,E)}function Ay(w,I,E,D){for(var K=E-1,oe=w.length;++K<oe;)if(D(w[K],I))return K;return-1}function Qc(w){return w!==w}function Yc(w,I){var E=w==null?0:w.length;return E?Un(w,I)/E:Hr}function qn(w){return function(I){return I==null?r:I[w]}}function Ln(w){return function(I){return w==null?r:w[I]}}function Zc(w,I,E,D,K){return K(w,function(oe,Oe,pe){E=D?(D=!1,oe):I(E,oe,Oe,pe)}),E}function Ty(w,I){var E=w.length;for(w.sort(I);E--;)w[E]=w[E].value;return w}function Un(w,I){for(var E,D=-1,K=w.length;++D<K;){var oe=I(w[D]);oe!==r&&(E=E===r?oe:E+oe)}return E}function Mn(w,I){for(var E=-1,D=Array(w);++E<w;)D[E]=I(E);return D}function Dy(w,I){return we(I,function(E){return[E,w[E]]})}function Xc(w){return w&&w.slice(0,ru(w)+1).replace(Sn,"")}function it(w){return function(I){return w(I)}}function zn(w,I){return we(I,function(E){return w[E]})}function dr(w,I){return w.has(I)}function eu(w,I){for(var E=-1,D=w.length;++E<D&&Li(I,w[E],0)>-1;);return E}function tu(w,I){for(var E=w.length;E--&&Li(I,w[E],0)>-1;);return E}function Fy(w,I){for(var E=w.length,D=0;E--;)w[E]===I&&++D;return D}var jy=Ln(my),$y=Ln(wy);function qy(w){return"\\"+by[w]}function Ly(w,I){return w==null?r:w[I]}function Ui(w){return fy.test(w)}function Uy(w){return gy.test(w)}function My(w){for(var I,E=[];!(I=w.next()).done;)E.push(I.value);return E}function kn(w){var I=-1,E=Array(w.size);return w.forEach(function(D,K){E[++I]=[K,D]}),E}function iu(w,I){return function(E){return w(I(E))}}function ti(w,I){for(var E=-1,D=w.length,K=0,oe=[];++E<D;){var Oe=w[E];(Oe===I||Oe===C)&&(w[E]=C,oe[K++]=E)}return oe}function es(w){var I=-1,E=Array(w.size);return w.forEach(function(D){E[++I]=D}),E}function zy(w){var I=-1,E=Array(w.size);return w.forEach(function(D){E[++I]=[D,D]}),E}function ky(w,I,E){for(var D=E-1,K=w.length;++D<K;)if(w[D]===I)return D;return-1}function Vy(w,I,E){for(var D=E+1;D--;)if(w[D]===I)return D;return D}function Mi(w){return Ui(w)?Ky(w):Oy(w)}function Et(w){return Ui(w)?By(w):Ny(w)}function ru(w){for(var I=w.length;I--&&Fv.test(w.charAt(I)););return I}var Hy=Ln(_y);function Ky(w){for(var I=An.lastIndex=0;An.test(w);)++I;return I}function By(w){return w.match(An)||[]}function Gy(w){return w.match(dy)||[]}var Jy=function w(I){I=I==null?je:zi.defaults(je.Object(),I,zi.pick(je,vy));var E=I.Array,D=I.Date,K=I.Error,oe=I.Function,Oe=I.Math,pe=I.Object,Vn=I.RegExp,Wy=I.String,lt=I.TypeError,ts=E.prototype,Qy=oe.prototype,ki=pe.prototype,is=I["__core-js_shared__"],rs=Qy.toString,ue=ki.hasOwnProperty,Yy=0,su=function(){var e=/[^.]+$/.exec(is&&is.keys&&is.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ss=ki.toString,Zy=rs.call(pe),Xy=je._,em=Vn("^"+rs.call(ue).replace(xn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ns=zc?I.Buffer:r,ii=I.Symbol,os=I.Uint8Array,nu=ns?ns.allocUnsafe:r,as=iu(pe.getPrototypeOf,pe),ou=pe.create,au=ki.propertyIsEnumerable,cs=ts.splice,cu=ii?ii.isConcatSpreadable:r,fr=ii?ii.iterator:r,yi=ii?ii.toStringTag:r,us=function(){try{var e=Ei(pe,"defineProperty");return e({},"",{}),e}catch{}}(),tm=I.clearTimeout!==je.clearTimeout&&I.clearTimeout,im=D&&D.now!==je.Date.now&&D.now,rm=I.setTimeout!==je.setTimeout&&I.setTimeout,hs=Oe.ceil,ls=Oe.floor,Hn=pe.getOwnPropertySymbols,sm=ns?ns.isBuffer:r,uu=I.isFinite,nm=ts.join,om=iu(pe.keys,pe),Ne=Oe.max,Le=Oe.min,am=D.now,cm=I.parseInt,hu=Oe.random,um=ts.reverse,Kn=Ei(I,"DataView"),gr=Ei(I,"Map"),Bn=Ei(I,"Promise"),Vi=Ei(I,"Set"),vr=Ei(I,"WeakMap"),yr=Ei(pe,"create"),ps=vr&&new vr,Hi={},hm=Ii(Kn),lm=Ii(gr),pm=Ii(Bn),dm=Ii(Vi),fm=Ii(vr),ds=ii?ii.prototype:r,mr=ds?ds.valueOf:r,lu=ds?ds.toString:r;function d(e){if(Ie(e)&&!B(e)&&!(e instanceof ie)){if(e instanceof pt)return e;if(ue.call(e,"__wrapped__"))return ph(e)}return new pt(e)}var Ki=function(){function e(){}return function(t){if(!Ee(t))return{};if(ou)return ou(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function fs(){}function pt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}d.templateSettings={escape:Ov,evaluate:Nv,interpolate:_c,variable:"",imports:{_:d}},d.prototype=fs.prototype,d.prototype.constructor=d,pt.prototype=Ki(fs.prototype),pt.prototype.constructor=pt;function ie(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Nt,this.__views__=[]}function gm(){var e=new ie(this.__wrapped__);return e.__actions__=We(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=We(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=We(this.__views__),e}function vm(){if(this.__filtered__){var e=new ie(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function ym(){var e=this.__wrapped__.value(),t=this.__dir__,n=B(e),h=t<0,l=n?e.length:0,f=N0(0,l,this.__views__),v=f.start,y=f.end,_=y-v,P=h?y:v-1,S=this.__iteratees__,R=S.length,T=0,j=Le(_,this.__takeCount__);if(!n||!h&&l==_&&j==_)return ju(e,this.__actions__);var z=[];e:for(;_--&&T<j;){P+=t;for(var W=-1,k=e[P];++W<R;){var te=S[W],re=te.iteratee,nt=te.type,Be=re(k);if(nt==lv)k=Be;else if(!Be){if(nt==gc)continue e;break e}}z[T++]=k}return z}ie.prototype=Ki(fs.prototype),ie.prototype.constructor=ie;function mi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function mm(){this.__data__=yr?yr(null):{},this.size=0}function wm(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function _m(e){var t=this.__data__;if(yr){var n=t[e];return n===b?r:n}return ue.call(t,e)?t[e]:r}function bm(e){var t=this.__data__;return yr?t[e]!==r:ue.call(t,e)}function Em(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=yr&&t===r?b:t,this}mi.prototype.clear=mm,mi.prototype.delete=wm,mi.prototype.get=_m,mi.prototype.has=bm,mi.prototype.set=Em;function Ut(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Im(){this.__data__=[],this.size=0}function Pm(e){var t=this.__data__,n=gs(t,e);if(n<0)return!1;var h=t.length-1;return n==h?t.pop():cs.call(t,n,1),--this.size,!0}function xm(e){var t=this.__data__,n=gs(t,e);return n<0?r:t[n][1]}function Sm(e){return gs(this.__data__,e)>-1}function Rm(e,t){var n=this.__data__,h=gs(n,e);return h<0?(++this.size,n.push([e,t])):n[h][1]=t,this}Ut.prototype.clear=Im,Ut.prototype.delete=Pm,Ut.prototype.get=xm,Ut.prototype.has=Sm,Ut.prototype.set=Rm;function Mt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Om(){this.size=0,this.__data__={hash:new mi,map:new(gr||Ut),string:new mi}}function Nm(e){var t=Rs(this,e).delete(e);return this.size-=t?1:0,t}function Cm(e){return Rs(this,e).get(e)}function Am(e){return Rs(this,e).has(e)}function Tm(e,t){var n=Rs(this,e),h=n.size;return n.set(e,t),this.size+=n.size==h?0:1,this}Mt.prototype.clear=Om,Mt.prototype.delete=Nm,Mt.prototype.get=Cm,Mt.prototype.has=Am,Mt.prototype.set=Tm;function wi(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Mt;++t<n;)this.add(e[t])}function Dm(e){return this.__data__.set(e,b),this}function Fm(e){return this.__data__.has(e)}wi.prototype.add=wi.prototype.push=Dm,wi.prototype.has=Fm;function It(e){var t=this.__data__=new Ut(e);this.size=t.size}function jm(){this.__data__=new Ut,this.size=0}function $m(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function qm(e){return this.__data__.get(e)}function Lm(e){return this.__data__.has(e)}function Um(e,t){var n=this.__data__;if(n instanceof Ut){var h=n.__data__;if(!gr||h.length<a-1)return h.push([e,t]),this.size=++n.size,this;n=this.__data__=new Mt(h)}return n.set(e,t),this.size=n.size,this}It.prototype.clear=jm,It.prototype.delete=$m,It.prototype.get=qm,It.prototype.has=Lm,It.prototype.set=Um;function pu(e,t){var n=B(e),h=!n&&Pi(e),l=!n&&!h&&ai(e),f=!n&&!h&&!l&&Wi(e),v=n||h||l||f,y=v?Mn(e.length,Wy):[],_=y.length;for(var P in e)(t||ue.call(e,P))&&!(v&&(P=="length"||l&&(P=="offset"||P=="parent")||f&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||Ht(P,_)))&&y.push(P);return y}function du(e){var t=e.length;return t?e[ro(0,t-1)]:r}function Mm(e,t){return Os(We(e),_i(t,0,e.length))}function zm(e){return Os(We(e))}function Gn(e,t,n){(n!==r&&!Pt(e[t],n)||n===r&&!(t in e))&&zt(e,t,n)}function wr(e,t,n){var h=e[t];(!(ue.call(e,t)&&Pt(h,n))||n===r&&!(t in e))&&zt(e,t,n)}function gs(e,t){for(var n=e.length;n--;)if(Pt(e[n][0],t))return n;return-1}function km(e,t,n,h){return ri(e,function(l,f,v){t(h,l,n(l),v)}),h}function fu(e,t){return e&&At(t,Ae(t),e)}function Vm(e,t){return e&&At(t,Ye(t),e)}function zt(e,t,n){t=="__proto__"&&us?us(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Jn(e,t){for(var n=-1,h=t.length,l=E(h),f=e==null;++n<h;)l[n]=f?r:No(e,t[n]);return l}function _i(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function dt(e,t,n,h,l,f){var v,y=t&N,_=t&$,P=t&ce;if(n&&(v=l?n(e,h,l,f):n(e)),v!==r)return v;if(!Ee(e))return e;var S=B(e);if(S){if(v=A0(e),!y)return We(e,v)}else{var R=Ue(e),T=R==Gr||R==vc;if(ai(e))return Lu(e,y);if(R==Lt||R==ji||T&&!l){if(v=_||T?{}:rh(e),!y)return _?_0(e,Vm(v,e)):w0(e,fu(v,e))}else{if(!fe[R])return l?e:{};v=T0(e,R,y)}}f||(f=new It);var j=f.get(e);if(j)return j;f.set(e,v),Th(e)?e.forEach(function(k){v.add(dt(k,t,n,k,e,f))}):Ch(e)&&e.forEach(function(k,te){v.set(te,dt(k,t,n,te,e,f))});var z=P?_?go:fo:_?Ye:Ae,W=S?r:z(e);return ht(W||e,function(k,te){W&&(te=k,k=e[te]),wr(v,te,dt(k,t,n,te,e,f))}),v}function Hm(e){var t=Ae(e);return function(n){return gu(n,e,t)}}function gu(e,t,n){var h=n.length;if(e==null)return!h;for(e=pe(e);h--;){var l=n[h],f=t[l],v=e[l];if(v===r&&!(l in e)||!f(v))return!1}return!0}function vu(e,t,n){if(typeof e!="function")throw new lt(g);return Sr(function(){e.apply(r,n)},t)}function _r(e,t,n,h){var l=-1,f=Zr,v=!0,y=e.length,_=[],P=t.length;if(!y)return _;n&&(t=we(t,it(n))),h?(f=Fn,v=!1):t.length>=a&&(f=dr,v=!1,t=new wi(t));e:for(;++l<y;){var S=e[l],R=n==null?S:n(S);if(S=h||S!==0?S:0,v&&R===R){for(var T=P;T--;)if(t[T]===R)continue e;_.push(S)}else f(t,R,h)||_.push(S)}return _}var ri=Vu(Ct),yu=Vu(Qn,!0);function Km(e,t){var n=!0;return ri(e,function(h,l,f){return n=!!t(h,l,f),n}),n}function vs(e,t,n){for(var h=-1,l=e.length;++h<l;){var f=e[h],v=t(f);if(v!=null&&(y===r?v===v&&!st(v):n(v,y)))var y=v,_=f}return _}function Bm(e,t,n,h){var l=e.length;for(n=G(n),n<0&&(n=-n>l?0:l+n),h=h===r||h>l?l:G(h),h<0&&(h+=l),h=n>h?0:Fh(h);n<h;)e[n++]=t;return e}function mu(e,t){var n=[];return ri(e,function(h,l,f){t(h,l,f)&&n.push(h)}),n}function $e(e,t,n,h,l){var f=-1,v=e.length;for(n||(n=F0),l||(l=[]);++f<v;){var y=e[f];t>0&&n(y)?t>1?$e(y,t-1,n,h,l):ei(l,y):h||(l[l.length]=y)}return l}var Wn=Hu(),wu=Hu(!0);function Ct(e,t){return e&&Wn(e,t,Ae)}function Qn(e,t){return e&&wu(e,t,Ae)}function ys(e,t){return Xt(t,function(n){return Kt(e[n])})}function bi(e,t){t=ni(t,e);for(var n=0,h=t.length;e!=null&&n<h;)e=e[Tt(t[n++])];return n&&n==h?e:r}function _u(e,t,n){var h=t(e);return B(e)?h:ei(h,n(e))}function He(e){return e==null?e===r?bv:wv:yi&&yi in pe(e)?O0(e):z0(e)}function Yn(e,t){return e>t}function Gm(e,t){return e!=null&&ue.call(e,t)}function Jm(e,t){return e!=null&&t in pe(e)}function Wm(e,t,n){return e>=Le(t,n)&&e<Ne(t,n)}function Zn(e,t,n){for(var h=n?Fn:Zr,l=e[0].length,f=e.length,v=f,y=E(f),_=1/0,P=[];v--;){var S=e[v];v&&t&&(S=we(S,it(t))),_=Le(S.length,_),y[v]=!n&&(t||l>=120&&S.length>=120)?new wi(v&&S):r}S=e[0];var R=-1,T=y[0];e:for(;++R<l&&P.length<_;){var j=S[R],z=t?t(j):j;if(j=n||j!==0?j:0,!(T?dr(T,z):h(P,z,n))){for(v=f;--v;){var W=y[v];if(!(W?dr(W,z):h(e[v],z,n)))continue e}T&&T.push(z),P.push(j)}}return P}function Qm(e,t,n,h){return Ct(e,function(l,f,v){t(h,n(l),f,v)}),h}function br(e,t,n){t=ni(t,e),e=ah(e,t);var h=e==null?e:e[Tt(gt(t))];return h==null?r:tt(h,e,n)}function bu(e){return Ie(e)&&He(e)==ji}function Ym(e){return Ie(e)&&He(e)==pr}function Zm(e){return Ie(e)&&He(e)==ar}function Er(e,t,n,h,l){return e===t?!0:e==null||t==null||!Ie(e)&&!Ie(t)?e!==e&&t!==t:Xm(e,t,n,h,Er,l)}function Xm(e,t,n,h,l,f){var v=B(e),y=B(t),_=v?Kr:Ue(e),P=y?Kr:Ue(t);_=_==ji?Lt:_,P=P==ji?Lt:P;var S=_==Lt,R=P==Lt,T=_==P;if(T&&ai(e)){if(!ai(t))return!1;v=!0,S=!1}if(T&&!S)return f||(f=new It),v||Wi(e)?eh(e,t,n,h,l,f):S0(e,t,_,n,h,l,f);if(!(n&F)){var j=S&&ue.call(e,"__wrapped__"),z=R&&ue.call(t,"__wrapped__");if(j||z){var W=j?e.value():e,k=z?t.value():t;return f||(f=new It),l(W,k,n,h,f)}}return T?(f||(f=new It),R0(e,t,n,h,l,f)):!1}function e0(e){return Ie(e)&&Ue(e)==_t}function Xn(e,t,n,h){var l=n.length,f=l,v=!h;if(e==null)return!f;for(e=pe(e);l--;){var y=n[l];if(v&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++l<f;){y=n[l];var _=y[0],P=e[_],S=y[1];if(v&&y[2]){if(P===r&&!(_ in e))return!1}else{var R=new It;if(h)var T=h(P,S,_,e,t,R);if(!(T===r?Er(S,P,F|H,h,R):T))return!1}}return!0}function Eu(e){if(!Ee(e)||$0(e))return!1;var t=Kt(e)?em:Hv;return t.test(Ii(e))}function t0(e){return Ie(e)&&He(e)==ur}function i0(e){return Ie(e)&&Ue(e)==bt}function r0(e){return Ie(e)&&Fs(e.length)&&!!ve[He(e)]}function Iu(e){return typeof e=="function"?e:e==null?Ze:typeof e=="object"?B(e)?Su(e[0],e[1]):xu(e):Kh(e)}function eo(e){if(!xr(e))return om(e);var t=[];for(var n in pe(e))ue.call(e,n)&&n!="constructor"&&t.push(n);return t}function s0(e){if(!Ee(e))return M0(e);var t=xr(e),n=[];for(var h in e)h=="constructor"&&(t||!ue.call(e,h))||n.push(h);return n}function to(e,t){return e<t}function Pu(e,t){var n=-1,h=Qe(e)?E(e.length):[];return ri(e,function(l,f,v){h[++n]=t(l,f,v)}),h}function xu(e){var t=yo(e);return t.length==1&&t[0][2]?nh(t[0][0],t[0][1]):function(n){return n===e||Xn(n,e,t)}}function Su(e,t){return wo(e)&&sh(t)?nh(Tt(e),t):function(n){var h=No(n,e);return h===r&&h===t?Co(n,e):Er(t,h,F|H)}}function ms(e,t,n,h,l){e!==t&&Wn(t,function(f,v){if(l||(l=new It),Ee(f))n0(e,t,v,n,ms,h,l);else{var y=h?h(bo(e,v),f,v+"",e,t,l):r;y===r&&(y=f),Gn(e,v,y)}},Ye)}function n0(e,t,n,h,l,f,v){var y=bo(e,n),_=bo(t,n),P=v.get(_);if(P){Gn(e,n,P);return}var S=f?f(y,_,n+"",e,t,v):r,R=S===r;if(R){var T=B(_),j=!T&&ai(_),z=!T&&!j&&Wi(_);S=_,T||j||z?B(y)?S=y:Se(y)?S=We(y):j?(R=!1,S=Lu(_,!0)):z?(R=!1,S=Uu(_,!0)):S=[]:Rr(_)||Pi(_)?(S=y,Pi(y)?S=jh(y):(!Ee(y)||Kt(y))&&(S=rh(_))):R=!1}R&&(v.set(_,S),l(S,_,h,f,v),v.delete(_)),Gn(e,n,S)}function Ru(e,t){var n=e.length;if(n)return t+=t<0?n:0,Ht(t,n)?e[t]:r}function Ou(e,t,n){t.length?t=we(t,function(f){return B(f)?function(v){return bi(v,f.length===1?f[0]:f)}:f}):t=[Ze];var h=-1;t=we(t,it(M()));var l=Pu(e,function(f,v,y){var _=we(t,function(P){return P(f)});return{criteria:_,index:++h,value:f}});return Ty(l,function(f,v){return m0(f,v,n)})}function o0(e,t){return Nu(e,t,function(n,h){return Co(e,h)})}function Nu(e,t,n){for(var h=-1,l=t.length,f={};++h<l;){var v=t[h],y=bi(e,v);n(y,v)&&Ir(f,ni(v,e),y)}return f}function a0(e){return function(t){return bi(t,e)}}function io(e,t,n,h){var l=h?Ay:Li,f=-1,v=t.length,y=e;for(e===t&&(t=We(t)),n&&(y=we(e,it(n)));++f<v;)for(var _=0,P=t[f],S=n?n(P):P;(_=l(y,S,_,h))>-1;)y!==e&&cs.call(y,_,1),cs.call(e,_,1);return e}function Cu(e,t){for(var n=e?t.length:0,h=n-1;n--;){var l=t[n];if(n==h||l!==f){var f=l;Ht(l)?cs.call(e,l,1):oo(e,l)}}return e}function ro(e,t){return e+ls(hu()*(t-e+1))}function c0(e,t,n,h){for(var l=-1,f=Ne(hs((t-e)/(n||1)),0),v=E(f);f--;)v[h?f:++l]=e,e+=n;return v}function so(e,t){var n="";if(!e||t<1||t>Zt)return n;do t%2&&(n+=e),t=ls(t/2),t&&(e+=e);while(t);return n}function Y(e,t){return Eo(oh(e,t,Ze),e+"")}function u0(e){return du(Qi(e))}function h0(e,t){var n=Qi(e);return Os(n,_i(t,0,n.length))}function Ir(e,t,n,h){if(!Ee(e))return e;t=ni(t,e);for(var l=-1,f=t.length,v=f-1,y=e;y!=null&&++l<f;){var _=Tt(t[l]),P=n;if(_==="__proto__"||_==="constructor"||_==="prototype")return e;if(l!=v){var S=y[_];P=h?h(S,_,y):r,P===r&&(P=Ee(S)?S:Ht(t[l+1])?[]:{})}wr(y,_,P),y=y[_]}return e}var Au=ps?function(e,t){return ps.set(e,t),e}:Ze,l0=us?function(e,t){return us(e,"toString",{configurable:!0,enumerable:!1,value:To(t),writable:!0})}:Ze;function p0(e){return Os(Qi(e))}function ft(e,t,n){var h=-1,l=e.length;t<0&&(t=-t>l?0:l+t),n=n>l?l:n,n<0&&(n+=l),l=t>n?0:n-t>>>0,t>>>=0;for(var f=E(l);++h<l;)f[h]=e[h+t];return f}function d0(e,t){var n;return ri(e,function(h,l,f){return n=t(h,l,f),!n}),!!n}function ws(e,t,n){var h=0,l=e==null?h:e.length;if(typeof t=="number"&&t===t&&l<=gv){for(;h<l;){var f=h+l>>>1,v=e[f];v!==null&&!st(v)&&(n?v<=t:v<t)?h=f+1:l=f}return l}return no(e,t,Ze,n)}function no(e,t,n,h){var l=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var v=t!==t,y=t===null,_=st(t),P=t===r;l<f;){var S=ls((l+f)/2),R=n(e[S]),T=R!==r,j=R===null,z=R===R,W=st(R);if(v)var k=h||z;else P?k=z&&(h||T):y?k=z&&T&&(h||!j):_?k=z&&T&&!j&&(h||!W):j||W?k=!1:k=h?R<=t:R<t;k?l=S+1:f=S}return Le(f,fv)}function Tu(e,t){for(var n=-1,h=e.length,l=0,f=[];++n<h;){var v=e[n],y=t?t(v):v;if(!n||!Pt(y,_)){var _=y;f[l++]=v===0?0:v}}return f}function Du(e){return typeof e=="number"?e:st(e)?Hr:+e}function rt(e){if(typeof e=="string")return e;if(B(e))return we(e,rt)+"";if(st(e))return lu?lu.call(e):"";var t=e+"";return t=="0"&&1/e==-gi?"-0":t}function si(e,t,n){var h=-1,l=Zr,f=e.length,v=!0,y=[],_=y;if(n)v=!1,l=Fn;else if(f>=a){var P=t?null:P0(e);if(P)return es(P);v=!1,l=dr,_=new wi}else _=t?[]:y;e:for(;++h<f;){var S=e[h],R=t?t(S):S;if(S=n||S!==0?S:0,v&&R===R){for(var T=_.length;T--;)if(_[T]===R)continue e;t&&_.push(R),y.push(S)}else l(_,R,n)||(_!==y&&_.push(R),y.push(S))}return y}function oo(e,t){return t=ni(t,e),e=ah(e,t),e==null||delete e[Tt(gt(t))]}function Fu(e,t,n,h){return Ir(e,t,n(bi(e,t)),h)}function _s(e,t,n,h){for(var l=e.length,f=h?l:-1;(h?f--:++f<l)&&t(e[f],f,e););return n?ft(e,h?0:f,h?f+1:l):ft(e,h?f+1:0,h?l:f)}function ju(e,t){var n=e;return n instanceof ie&&(n=n.value()),jn(t,function(h,l){return l.func.apply(l.thisArg,ei([h],l.args))},n)}function ao(e,t,n){var h=e.length;if(h<2)return h?si(e[0]):[];for(var l=-1,f=E(h);++l<h;)for(var v=e[l],y=-1;++y<h;)y!=l&&(f[l]=_r(f[l]||v,e[y],t,n));return si($e(f,1),t,n)}function $u(e,t,n){for(var h=-1,l=e.length,f=t.length,v={};++h<l;){var y=h<f?t[h]:r;n(v,e[h],y)}return v}function co(e){return Se(e)?e:[]}function uo(e){return typeof e=="function"?e:Ze}function ni(e,t){return B(e)?e:wo(e,t)?[e]:lh(ae(e))}var f0=Y;function oi(e,t,n){var h=e.length;return n=n===r?h:n,!t&&n>=h?e:ft(e,t,n)}var qu=tm||function(e){return je.clearTimeout(e)};function Lu(e,t){if(t)return e.slice();var n=e.length,h=nu?nu(n):new e.constructor(n);return e.copy(h),h}function ho(e){var t=new e.constructor(e.byteLength);return new os(t).set(new os(e)),t}function g0(e,t){var n=t?ho(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function v0(e){var t=new e.constructor(e.source,bc.exec(e));return t.lastIndex=e.lastIndex,t}function y0(e){return mr?pe(mr.call(e)):{}}function Uu(e,t){var n=t?ho(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Mu(e,t){if(e!==t){var n=e!==r,h=e===null,l=e===e,f=st(e),v=t!==r,y=t===null,_=t===t,P=st(t);if(!y&&!P&&!f&&e>t||f&&v&&_&&!y&&!P||h&&v&&_||!n&&_||!l)return 1;if(!h&&!f&&!P&&e<t||P&&n&&l&&!h&&!f||y&&n&&l||!v&&l||!_)return-1}return 0}function m0(e,t,n){for(var h=-1,l=e.criteria,f=t.criteria,v=l.length,y=n.length;++h<v;){var _=Mu(l[h],f[h]);if(_){if(h>=y)return _;var P=n[h];return _*(P=="desc"?-1:1)}}return e.index-t.index}function zu(e,t,n,h){for(var l=-1,f=e.length,v=n.length,y=-1,_=t.length,P=Ne(f-v,0),S=E(_+P),R=!h;++y<_;)S[y]=t[y];for(;++l<v;)(R||l<f)&&(S[n[l]]=e[l]);for(;P--;)S[y++]=e[l++];return S}function ku(e,t,n,h){for(var l=-1,f=e.length,v=-1,y=n.length,_=-1,P=t.length,S=Ne(f-y,0),R=E(S+P),T=!h;++l<S;)R[l]=e[l];for(var j=l;++_<P;)R[j+_]=t[_];for(;++v<y;)(T||l<f)&&(R[j+n[v]]=e[l++]);return R}function We(e,t){var n=-1,h=e.length;for(t||(t=E(h));++n<h;)t[n]=e[n];return t}function At(e,t,n,h){var l=!n;n||(n={});for(var f=-1,v=t.length;++f<v;){var y=t[f],_=h?h(n[y],e[y],y,n,e):r;_===r&&(_=e[y]),l?zt(n,y,_):wr(n,y,_)}return n}function w0(e,t){return At(e,mo(e),t)}function _0(e,t){return At(e,th(e),t)}function bs(e,t){return function(n,h){var l=B(n)?xy:km,f=t?t():{};return l(n,e,M(h,2),f)}}function Bi(e){return Y(function(t,n){var h=-1,l=n.length,f=l>1?n[l-1]:r,v=l>2?n[2]:r;for(f=e.length>3&&typeof f=="function"?(l--,f):r,v&&Ke(n[0],n[1],v)&&(f=l<3?r:f,l=1),t=pe(t);++h<l;){var y=n[h];y&&e(t,y,h,f)}return t})}function Vu(e,t){return function(n,h){if(n==null)return n;if(!Qe(n))return e(n,h);for(var l=n.length,f=t?l:-1,v=pe(n);(t?f--:++f<l)&&h(v[f],f,v)!==!1;);return n}}function Hu(e){return function(t,n,h){for(var l=-1,f=pe(t),v=h(t),y=v.length;y--;){var _=v[e?y:++l];if(n(f[_],_,f)===!1)break}return t}}function b0(e,t,n){var h=t&Z,l=Pr(e);function f(){var v=this&&this!==je&&this instanceof f?l:e;return v.apply(h?n:this,arguments)}return f}function Ku(e){return function(t){t=ae(t);var n=Ui(t)?Et(t):r,h=n?n[0]:t.charAt(0),l=n?oi(n,1).join(""):t.slice(1);return h[e]()+l}}function Gi(e){return function(t){return jn(Vh(kh(t).replace(ly,"")),e,"")}}function Pr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Ki(e.prototype),h=e.apply(n,t);return Ee(h)?h:n}}function E0(e,t,n){var h=Pr(e);function l(){for(var f=arguments.length,v=E(f),y=f,_=Ji(l);y--;)v[y]=arguments[y];var P=f<3&&v[0]!==_&&v[f-1]!==_?[]:ti(v,_);if(f-=P.length,f<n)return Qu(e,t,Es,l.placeholder,r,v,P,r,r,n-f);var S=this&&this!==je&&this instanceof l?h:e;return tt(S,this,v)}return l}function Bu(e){return function(t,n,h){var l=pe(t);if(!Qe(t)){var f=M(n,3);t=Ae(t),n=function(y){return f(l[y],y,l)}}var v=e(t,n,h);return v>-1?l[f?t[v]:v]:r}}function Gu(e){return Vt(function(t){var n=t.length,h=n,l=pt.prototype.thru;for(e&&t.reverse();h--;){var f=t[h];if(typeof f!="function")throw new lt(g);if(l&&!v&&Ss(f)=="wrapper")var v=new pt([],!0)}for(h=v?h:n;++h<n;){f=t[h];var y=Ss(f),_=y=="wrapper"?vo(f):r;_&&_o(_[0])&&_[1]==(xe|de|Q|Ve)&&!_[4].length&&_[9]==1?v=v[Ss(_[0])].apply(v,_[3]):v=f.length==1&&_o(f)?v[y]():v.thru(f)}return function(){var P=arguments,S=P[0];if(v&&P.length==1&&B(S))return v.plant(S).value();for(var R=0,T=n?t[R].apply(this,P):S;++R<n;)T=t[R].call(this,T);return T}})}function Es(e,t,n,h,l,f,v,y,_,P){var S=t&xe,R=t&Z,T=t&le,j=t&(de|ne),z=t&Yt,W=T?r:Pr(e);function k(){for(var te=arguments.length,re=E(te),nt=te;nt--;)re[nt]=arguments[nt];if(j)var Be=Ji(k),ot=Fy(re,Be);if(h&&(re=zu(re,h,l,j)),f&&(re=ku(re,f,v,j)),te-=ot,j&&te<P){var Re=ti(re,Be);return Qu(e,t,Es,k.placeholder,n,re,Re,y,_,P-te)}var xt=R?n:this,Gt=T?xt[e]:e;return te=re.length,y?re=k0(re,y):z&&te>1&&re.reverse(),S&&_<te&&(re.length=_),this&&this!==je&&this instanceof k&&(Gt=W||Pr(Gt)),Gt.apply(xt,re)}return k}function Ju(e,t){return function(n,h){return Qm(n,e,t(h),{})}}function Is(e,t){return function(n,h){var l;if(n===r&&h===r)return t;if(n!==r&&(l=n),h!==r){if(l===r)return h;typeof n=="string"||typeof h=="string"?(n=rt(n),h=rt(h)):(n=Du(n),h=Du(h)),l=e(n,h)}return l}}function lo(e){return Vt(function(t){return t=we(t,it(M())),Y(function(n){var h=this;return e(t,function(l){return tt(l,h,n)})})})}function Ps(e,t){t=t===r?" ":rt(t);var n=t.length;if(n<2)return n?so(t,e):t;var h=so(t,hs(e/Mi(t)));return Ui(t)?oi(Et(h),0,e).join(""):h.slice(0,e)}function I0(e,t,n,h){var l=t&Z,f=Pr(e);function v(){for(var y=-1,_=arguments.length,P=-1,S=h.length,R=E(S+_),T=this&&this!==je&&this instanceof v?f:e;++P<S;)R[P]=h[P];for(;_--;)R[P++]=arguments[++y];return tt(T,l?n:this,R)}return v}function Wu(e){return function(t,n,h){return h&&typeof h!="number"&&Ke(t,n,h)&&(n=h=r),t=Bt(t),n===r?(n=t,t=0):n=Bt(n),h=h===r?t<n?1:-1:Bt(h),c0(t,n,h,e)}}function xs(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=vt(t),n=vt(n)),e(t,n)}}function Qu(e,t,n,h,l,f,v,y,_,P){var S=t&de,R=S?v:r,T=S?r:v,j=S?f:r,z=S?r:f;t|=S?Q:me,t&=~(S?me:Q),t&De||(t&=~(Z|le));var W=[e,t,l,j,R,z,T,y,_,P],k=n.apply(r,W);return _o(e)&&ch(k,W),k.placeholder=h,uh(k,e,t)}function po(e){var t=Oe[e];return function(n,h){if(n=vt(n),h=h==null?0:Le(G(h),292),h&&uu(n)){var l=(ae(n)+"e").split("e"),f=t(l[0]+"e"+(+l[1]+h));return l=(ae(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-h))}return t(n)}}var P0=Vi&&1/es(new Vi([,-0]))[1]==gi?function(e){return new Vi(e)}:jo;function Yu(e){return function(t){var n=Ue(t);return n==_t?kn(t):n==bt?zy(t):Dy(t,e(t))}}function kt(e,t,n,h,l,f,v,y){var _=t&le;if(!_&&typeof e!="function")throw new lt(g);var P=h?h.length:0;if(P||(t&=~(Q|me),h=l=r),v=v===r?v:Ne(G(v),0),y=y===r?y:G(y),P-=l?l.length:0,t&me){var S=h,R=l;h=l=r}var T=_?r:vo(e),j=[e,t,n,h,l,S,R,f,v,y];if(T&&U0(j,T),e=j[0],t=j[1],n=j[2],h=j[3],l=j[4],y=j[9]=j[9]===r?_?0:e.length:Ne(j[9]-P,0),!y&&t&(de|ne)&&(t&=~(de|ne)),!t||t==Z)var z=b0(e,t,n);else t==de||t==ne?z=E0(e,t,y):(t==Q||t==(Z|Q))&&!l.length?z=I0(e,t,n,h):z=Es.apply(r,j);var W=T?Au:ch;return uh(W(z,j),e,t)}function Zu(e,t,n,h){return e===r||Pt(e,ki[n])&&!ue.call(h,n)?t:e}function Xu(e,t,n,h,l,f){return Ee(e)&&Ee(t)&&(f.set(t,e),ms(e,t,r,Xu,f),f.delete(t)),e}function x0(e){return Rr(e)?r:e}function eh(e,t,n,h,l,f){var v=n&F,y=e.length,_=t.length;if(y!=_&&!(v&&_>y))return!1;var P=f.get(e),S=f.get(t);if(P&&S)return P==t&&S==e;var R=-1,T=!0,j=n&H?new wi:r;for(f.set(e,t),f.set(t,e);++R<y;){var z=e[R],W=t[R];if(h)var k=v?h(W,z,R,t,e,f):h(z,W,R,e,t,f);if(k!==r){if(k)continue;T=!1;break}if(j){if(!$n(t,function(te,re){if(!dr(j,re)&&(z===te||l(z,te,n,h,f)))return j.push(re)})){T=!1;break}}else if(!(z===W||l(z,W,n,h,f))){T=!1;break}}return f.delete(e),f.delete(t),T}function S0(e,t,n,h,l,f,v){switch(n){case $i:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case pr:return!(e.byteLength!=t.byteLength||!f(new os(e),new os(t)));case or:case ar:case cr:return Pt(+e,+t);case Br:return e.name==t.name&&e.message==t.message;case ur:case hr:return e==t+"";case _t:var y=kn;case bt:var _=h&F;if(y||(y=es),e.size!=t.size&&!_)return!1;var P=v.get(e);if(P)return P==t;h|=H,v.set(e,t);var S=eh(y(e),y(t),h,l,f,v);return v.delete(e),S;case Jr:if(mr)return mr.call(e)==mr.call(t)}return!1}function R0(e,t,n,h,l,f){var v=n&F,y=fo(e),_=y.length,P=fo(t),S=P.length;if(_!=S&&!v)return!1;for(var R=_;R--;){var T=y[R];if(!(v?T in t:ue.call(t,T)))return!1}var j=f.get(e),z=f.get(t);if(j&&z)return j==t&&z==e;var W=!0;f.set(e,t),f.set(t,e);for(var k=v;++R<_;){T=y[R];var te=e[T],re=t[T];if(h)var nt=v?h(re,te,T,t,e,f):h(te,re,T,e,t,f);if(!(nt===r?te===re||l(te,re,n,h,f):nt)){W=!1;break}k||(k=T=="constructor")}if(W&&!k){var Be=e.constructor,ot=t.constructor;Be!=ot&&"constructor"in e&&"constructor"in t&&!(typeof Be=="function"&&Be instanceof Be&&typeof ot=="function"&&ot instanceof ot)&&(W=!1)}return f.delete(e),f.delete(t),W}function Vt(e){return Eo(oh(e,r,gh),e+"")}function fo(e){return _u(e,Ae,mo)}function go(e){return _u(e,Ye,th)}var vo=ps?function(e){return ps.get(e)}:jo;function Ss(e){for(var t=e.name+"",n=Hi[t],h=ue.call(Hi,t)?n.length:0;h--;){var l=n[h],f=l.func;if(f==null||f==e)return l.name}return t}function Ji(e){var t=ue.call(d,"placeholder")?d:e;return t.placeholder}function M(){var e=d.iteratee||Do;return e=e===Do?Iu:e,arguments.length?e(arguments[0],arguments[1]):e}function Rs(e,t){var n=e.__data__;return j0(t)?n[typeof t=="string"?"string":"hash"]:n.map}function yo(e){for(var t=Ae(e),n=t.length;n--;){var h=t[n],l=e[h];t[n]=[h,l,sh(l)]}return t}function Ei(e,t){var n=Ly(e,t);return Eu(n)?n:r}function O0(e){var t=ue.call(e,yi),n=e[yi];try{e[yi]=r;var h=!0}catch{}var l=ss.call(e);return h&&(t?e[yi]=n:delete e[yi]),l}var mo=Hn?function(e){return e==null?[]:(e=pe(e),Xt(Hn(e),function(t){return au.call(e,t)}))}:$o,th=Hn?function(e){for(var t=[];e;)ei(t,mo(e)),e=as(e);return t}:$o,Ue=He;(Kn&&Ue(new Kn(new ArrayBuffer(1)))!=$i||gr&&Ue(new gr)!=_t||Bn&&Ue(Bn.resolve())!=yc||Vi&&Ue(new Vi)!=bt||vr&&Ue(new vr)!=lr)&&(Ue=function(e){var t=He(e),n=t==Lt?e.constructor:r,h=n?Ii(n):"";if(h)switch(h){case hm:return $i;case lm:return _t;case pm:return yc;case dm:return bt;case fm:return lr}return t});function N0(e,t,n){for(var h=-1,l=n.length;++h<l;){var f=n[h],v=f.size;switch(f.type){case"drop":e+=v;break;case"dropRight":t-=v;break;case"take":t=Le(t,e+v);break;case"takeRight":e=Ne(e,t-v);break}}return{start:e,end:t}}function C0(e){var t=e.match($v);return t?t[1].split(qv):[]}function ih(e,t,n){t=ni(t,e);for(var h=-1,l=t.length,f=!1;++h<l;){var v=Tt(t[h]);if(!(f=e!=null&&n(e,v)))break;e=e[v]}return f||++h!=l?f:(l=e==null?0:e.length,!!l&&Fs(l)&&Ht(v,l)&&(B(e)||Pi(e)))}function A0(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&ue.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function rh(e){return typeof e.constructor=="function"&&!xr(e)?Ki(as(e)):{}}function T0(e,t,n){var h=e.constructor;switch(t){case pr:return ho(e);case or:case ar:return new h(+e);case $i:return g0(e,n);case vn:case yn:case mn:case wn:case _n:case bn:case En:case In:case Pn:return Uu(e,n);case _t:return new h;case cr:case hr:return new h(e);case ur:return v0(e);case bt:return new h;case Jr:return y0(e)}}function D0(e,t){var n=t.length;if(!n)return e;var h=n-1;return t[h]=(n>1?"& ":"")+t[h],t=t.join(n>2?", ":" "),e.replace(jv,`{
/* [wrapped with `+t+`] */
`)}function F0(e){return B(e)||Pi(e)||!!(cu&&e&&e[cu])}function Ht(e,t){var n=typeof e;return t=t??Zt,!!t&&(n=="number"||n!="symbol"&&Bv.test(e))&&e>-1&&e%1==0&&e<t}function Ke(e,t,n){if(!Ee(n))return!1;var h=typeof t;return(h=="number"?Qe(n)&&Ht(t,n.length):h=="string"&&t in n)?Pt(n[t],e):!1}function wo(e,t){if(B(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||st(e)?!0:Av.test(e)||!Cv.test(e)||t!=null&&e in pe(t)}function j0(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function _o(e){var t=Ss(e),n=d[t];if(typeof n!="function"||!(t in ie.prototype))return!1;if(e===n)return!0;var h=vo(n);return!!h&&e===h[0]}function $0(e){return!!su&&su in e}var q0=is?Kt:qo;function xr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||ki;return e===n}function sh(e){return e===e&&!Ee(e)}function nh(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in pe(n))}}function L0(e){var t=Ts(e,function(h){return n.size===x&&n.clear(),h}),n=t.cache;return t}function U0(e,t){var n=e[1],h=t[1],l=n|h,f=l<(Z|le|xe),v=h==xe&&n==de||h==xe&&n==Ve&&e[7].length<=t[8]||h==(xe|Ve)&&t[7].length<=t[8]&&n==de;if(!(f||v))return e;h&Z&&(e[2]=t[2],l|=n&Z?0:De);var y=t[3];if(y){var _=e[3];e[3]=_?zu(_,y,t[4]):y,e[4]=_?ti(e[3],C):t[4]}return y=t[5],y&&(_=e[5],e[5]=_?ku(_,y,t[6]):y,e[6]=_?ti(e[5],C):t[6]),y=t[7],y&&(e[7]=y),h&xe&&(e[8]=e[8]==null?t[8]:Le(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function M0(e){var t=[];if(e!=null)for(var n in pe(e))t.push(n);return t}function z0(e){return ss.call(e)}function oh(e,t,n){return t=Ne(t===r?e.length-1:t,0),function(){for(var h=arguments,l=-1,f=Ne(h.length-t,0),v=E(f);++l<f;)v[l]=h[t+l];l=-1;for(var y=E(t+1);++l<t;)y[l]=h[l];return y[t]=n(v),tt(e,this,y)}}function ah(e,t){return t.length<2?e:bi(e,ft(t,0,-1))}function k0(e,t){for(var n=e.length,h=Le(t.length,n),l=We(e);h--;){var f=t[h];e[h]=Ht(f,n)?l[f]:r}return e}function bo(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var ch=hh(Au),Sr=rm||function(e,t){return je.setTimeout(e,t)},Eo=hh(l0);function uh(e,t,n){var h=t+"";return Eo(e,D0(h,V0(C0(h),n)))}function hh(e){var t=0,n=0;return function(){var h=am(),l=hv-(h-n);if(n=h,l>0){if(++t>=uv)return arguments[0]}else t=0;return e.apply(r,arguments)}}function Os(e,t){var n=-1,h=e.length,l=h-1;for(t=t===r?h:t;++n<t;){var f=ro(n,l),v=e[f];e[f]=e[n],e[n]=v}return e.length=t,e}var lh=L0(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Tv,function(n,h,l,f){t.push(l?f.replace(Mv,"$1"):h||n)}),t});function Tt(e){if(typeof e=="string"||st(e))return e;var t=e+"";return t=="0"&&1/e==-gi?"-0":t}function Ii(e){if(e!=null){try{return rs.call(e)}catch{}try{return e+""}catch{}}return""}function V0(e,t){return ht(vv,function(n){var h="_."+n[0];t&n[1]&&!Zr(e,h)&&e.push(h)}),e.sort()}function ph(e){if(e instanceof ie)return e.clone();var t=new pt(e.__wrapped__,e.__chain__);return t.__actions__=We(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function H0(e,t,n){(n?Ke(e,t,n):t===r)?t=1:t=Ne(G(t),0);var h=e==null?0:e.length;if(!h||t<1)return[];for(var l=0,f=0,v=E(hs(h/t));l<h;)v[f++]=ft(e,l,l+=t);return v}function K0(e){for(var t=-1,n=e==null?0:e.length,h=0,l=[];++t<n;){var f=e[t];f&&(l[h++]=f)}return l}function B0(){var e=arguments.length;if(!e)return[];for(var t=E(e-1),n=arguments[0],h=e;h--;)t[h-1]=arguments[h];return ei(B(n)?We(n):[n],$e(t,1))}var G0=Y(function(e,t){return Se(e)?_r(e,$e(t,1,Se,!0)):[]}),J0=Y(function(e,t){var n=gt(t);return Se(n)&&(n=r),Se(e)?_r(e,$e(t,1,Se,!0),M(n,2)):[]}),W0=Y(function(e,t){var n=gt(t);return Se(n)&&(n=r),Se(e)?_r(e,$e(t,1,Se,!0),r,n):[]});function Q0(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:G(t),ft(e,t<0?0:t,h)):[]}function Y0(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:G(t),t=h-t,ft(e,0,t<0?0:t)):[]}function Z0(e,t){return e&&e.length?_s(e,M(t,3),!0,!0):[]}function X0(e,t){return e&&e.length?_s(e,M(t,3),!0):[]}function ew(e,t,n,h){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Ke(e,t,n)&&(n=0,h=l),Bm(e,t,n,h)):[]}function dh(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:G(n);return l<0&&(l=Ne(h+l,0)),Xr(e,M(t,3),l)}function fh(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h-1;return n!==r&&(l=G(n),l=n<0?Ne(h+l,0):Le(l,h-1)),Xr(e,M(t,3),l,!0)}function gh(e){var t=e==null?0:e.length;return t?$e(e,1):[]}function tw(e){var t=e==null?0:e.length;return t?$e(e,gi):[]}function iw(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:G(t),$e(e,t)):[]}function rw(e){for(var t=-1,n=e==null?0:e.length,h={};++t<n;){var l=e[t];h[l[0]]=l[1]}return h}function vh(e){return e&&e.length?e[0]:r}function sw(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:G(n);return l<0&&(l=Ne(h+l,0)),Li(e,t,l)}function nw(e){var t=e==null?0:e.length;return t?ft(e,0,-1):[]}var ow=Y(function(e){var t=we(e,co);return t.length&&t[0]===e[0]?Zn(t):[]}),aw=Y(function(e){var t=gt(e),n=we(e,co);return t===gt(n)?t=r:n.pop(),n.length&&n[0]===e[0]?Zn(n,M(t,2)):[]}),cw=Y(function(e){var t=gt(e),n=we(e,co);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?Zn(n,r,t):[]});function uw(e,t){return e==null?"":nm.call(e,t)}function gt(e){var t=e==null?0:e.length;return t?e[t-1]:r}function hw(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h;return n!==r&&(l=G(n),l=l<0?Ne(h+l,0):Le(l,h-1)),t===t?Vy(e,t,l):Xr(e,Qc,l,!0)}function lw(e,t){return e&&e.length?Ru(e,G(t)):r}var pw=Y(yh);function yh(e,t){return e&&e.length&&t&&t.length?io(e,t):e}function dw(e,t,n){return e&&e.length&&t&&t.length?io(e,t,M(n,2)):e}function fw(e,t,n){return e&&e.length&&t&&t.length?io(e,t,r,n):e}var gw=Vt(function(e,t){var n=e==null?0:e.length,h=Jn(e,t);return Cu(e,we(t,function(l){return Ht(l,n)?+l:l}).sort(Mu)),h});function vw(e,t){var n=[];if(!(e&&e.length))return n;var h=-1,l=[],f=e.length;for(t=M(t,3);++h<f;){var v=e[h];t(v,h,e)&&(n.push(v),l.push(h))}return Cu(e,l),n}function Io(e){return e==null?e:um.call(e)}function yw(e,t,n){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Ke(e,t,n)?(t=0,n=h):(t=t==null?0:G(t),n=n===r?h:G(n)),ft(e,t,n)):[]}function mw(e,t){return ws(e,t)}function ww(e,t,n){return no(e,t,M(n,2))}function _w(e,t){var n=e==null?0:e.length;if(n){var h=ws(e,t);if(h<n&&Pt(e[h],t))return h}return-1}function bw(e,t){return ws(e,t,!0)}function Ew(e,t,n){return no(e,t,M(n,2),!0)}function Iw(e,t){var n=e==null?0:e.length;if(n){var h=ws(e,t,!0)-1;if(Pt(e[h],t))return h}return-1}function Pw(e){return e&&e.length?Tu(e):[]}function xw(e,t){return e&&e.length?Tu(e,M(t,2)):[]}function Sw(e){var t=e==null?0:e.length;return t?ft(e,1,t):[]}function Rw(e,t,n){return e&&e.length?(t=n||t===r?1:G(t),ft(e,0,t<0?0:t)):[]}function Ow(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:G(t),t=h-t,ft(e,t<0?0:t,h)):[]}function Nw(e,t){return e&&e.length?_s(e,M(t,3),!1,!0):[]}function Cw(e,t){return e&&e.length?_s(e,M(t,3)):[]}var Aw=Y(function(e){return si($e(e,1,Se,!0))}),Tw=Y(function(e){var t=gt(e);return Se(t)&&(t=r),si($e(e,1,Se,!0),M(t,2))}),Dw=Y(function(e){var t=gt(e);return t=typeof t=="function"?t:r,si($e(e,1,Se,!0),r,t)});function Fw(e){return e&&e.length?si(e):[]}function jw(e,t){return e&&e.length?si(e,M(t,2)):[]}function $w(e,t){return t=typeof t=="function"?t:r,e&&e.length?si(e,r,t):[]}function Po(e){if(!(e&&e.length))return[];var t=0;return e=Xt(e,function(n){if(Se(n))return t=Ne(n.length,t),!0}),Mn(t,function(n){return we(e,qn(n))})}function mh(e,t){if(!(e&&e.length))return[];var n=Po(e);return t==null?n:we(n,function(h){return tt(t,r,h)})}var qw=Y(function(e,t){return Se(e)?_r(e,t):[]}),Lw=Y(function(e){return ao(Xt(e,Se))}),Uw=Y(function(e){var t=gt(e);return Se(t)&&(t=r),ao(Xt(e,Se),M(t,2))}),Mw=Y(function(e){var t=gt(e);return t=typeof t=="function"?t:r,ao(Xt(e,Se),r,t)}),zw=Y(Po);function kw(e,t){return $u(e||[],t||[],wr)}function Vw(e,t){return $u(e||[],t||[],Ir)}var Hw=Y(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,mh(e,n)});function wh(e){var t=d(e);return t.__chain__=!0,t}function Kw(e,t){return t(e),e}function Ns(e,t){return t(e)}var Bw=Vt(function(e){var t=e.length,n=t?e[0]:0,h=this.__wrapped__,l=function(f){return Jn(f,e)};return t>1||this.__actions__.length||!(h instanceof ie)||!Ht(n)?this.thru(l):(h=h.slice(n,+n+(t?1:0)),h.__actions__.push({func:Ns,args:[l],thisArg:r}),new pt(h,this.__chain__).thru(function(f){return t&&!f.length&&f.push(r),f}))});function Gw(){return wh(this)}function Jw(){return new pt(this.value(),this.__chain__)}function Ww(){this.__values__===r&&(this.__values__=Dh(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Qw(){return this}function Yw(e){for(var t,n=this;n instanceof fs;){var h=ph(n);h.__index__=0,h.__values__=r,t?l.__wrapped__=h:t=h;var l=h;n=n.__wrapped__}return l.__wrapped__=e,t}function Zw(){var e=this.__wrapped__;if(e instanceof ie){var t=e;return this.__actions__.length&&(t=new ie(this)),t=t.reverse(),t.__actions__.push({func:Ns,args:[Io],thisArg:r}),new pt(t,this.__chain__)}return this.thru(Io)}function Xw(){return ju(this.__wrapped__,this.__actions__)}var e_=bs(function(e,t,n){ue.call(e,n)?++e[n]:zt(e,n,1)});function t_(e,t,n){var h=B(e)?Jc:Km;return n&&Ke(e,t,n)&&(t=r),h(e,M(t,3))}function i_(e,t){var n=B(e)?Xt:mu;return n(e,M(t,3))}var r_=Bu(dh),s_=Bu(fh);function n_(e,t){return $e(Cs(e,t),1)}function o_(e,t){return $e(Cs(e,t),gi)}function a_(e,t,n){return n=n===r?1:G(n),$e(Cs(e,t),n)}function _h(e,t){var n=B(e)?ht:ri;return n(e,M(t,3))}function bh(e,t){var n=B(e)?Sy:yu;return n(e,M(t,3))}var c_=bs(function(e,t,n){ue.call(e,n)?e[n].push(t):zt(e,n,[t])});function u_(e,t,n,h){e=Qe(e)?e:Qi(e),n=n&&!h?G(n):0;var l=e.length;return n<0&&(n=Ne(l+n,0)),js(e)?n<=l&&e.indexOf(t,n)>-1:!!l&&Li(e,t,n)>-1}var h_=Y(function(e,t,n){var h=-1,l=typeof t=="function",f=Qe(e)?E(e.length):[];return ri(e,function(v){f[++h]=l?tt(t,v,n):br(v,t,n)}),f}),l_=bs(function(e,t,n){zt(e,n,t)});function Cs(e,t){var n=B(e)?we:Pu;return n(e,M(t,3))}function p_(e,t,n,h){return e==null?[]:(B(t)||(t=t==null?[]:[t]),n=h?r:n,B(n)||(n=n==null?[]:[n]),Ou(e,t,n))}var d_=bs(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function f_(e,t,n){var h=B(e)?jn:Zc,l=arguments.length<3;return h(e,M(t,4),n,l,ri)}function g_(e,t,n){var h=B(e)?Ry:Zc,l=arguments.length<3;return h(e,M(t,4),n,l,yu)}function v_(e,t){var n=B(e)?Xt:mu;return n(e,Ds(M(t,3)))}function y_(e){var t=B(e)?du:u0;return t(e)}function m_(e,t,n){(n?Ke(e,t,n):t===r)?t=1:t=G(t);var h=B(e)?Mm:h0;return h(e,t)}function w_(e){var t=B(e)?zm:p0;return t(e)}function __(e){if(e==null)return 0;if(Qe(e))return js(e)?Mi(e):e.length;var t=Ue(e);return t==_t||t==bt?e.size:eo(e).length}function b_(e,t,n){var h=B(e)?$n:d0;return n&&Ke(e,t,n)&&(t=r),h(e,M(t,3))}var E_=Y(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Ke(e,t[0],t[1])?t=[]:n>2&&Ke(t[0],t[1],t[2])&&(t=[t[0]]),Ou(e,$e(t,1),[])}),As=im||function(){return je.Date.now()};function I_(e,t){if(typeof t!="function")throw new lt(g);return e=G(e),function(){if(--e<1)return t.apply(this,arguments)}}function Eh(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,kt(e,xe,r,r,r,r,t)}function Ih(e,t){var n;if(typeof t!="function")throw new lt(g);return e=G(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var xo=Y(function(e,t,n){var h=Z;if(n.length){var l=ti(n,Ji(xo));h|=Q}return kt(e,h,t,n,l)}),Ph=Y(function(e,t,n){var h=Z|le;if(n.length){var l=ti(n,Ji(Ph));h|=Q}return kt(t,h,e,n,l)});function xh(e,t,n){t=n?r:t;var h=kt(e,de,r,r,r,r,r,t);return h.placeholder=xh.placeholder,h}function Sh(e,t,n){t=n?r:t;var h=kt(e,ne,r,r,r,r,r,t);return h.placeholder=Sh.placeholder,h}function Rh(e,t,n){var h,l,f,v,y,_,P=0,S=!1,R=!1,T=!0;if(typeof e!="function")throw new lt(g);t=vt(t)||0,Ee(n)&&(S=!!n.leading,R="maxWait"in n,f=R?Ne(vt(n.maxWait)||0,t):f,T="trailing"in n?!!n.trailing:T);function j(Re){var xt=h,Gt=l;return h=l=r,P=Re,v=e.apply(Gt,xt),v}function z(Re){return P=Re,y=Sr(te,t),S?j(Re):v}function W(Re){var xt=Re-_,Gt=Re-P,Bh=t-xt;return R?Le(Bh,f-Gt):Bh}function k(Re){var xt=Re-_,Gt=Re-P;return _===r||xt>=t||xt<0||R&&Gt>=f}function te(){var Re=As();if(k(Re))return re(Re);y=Sr(te,W(Re))}function re(Re){return y=r,T&&h?j(Re):(h=l=r,v)}function nt(){y!==r&&qu(y),P=0,h=_=l=y=r}function Be(){return y===r?v:re(As())}function ot(){var Re=As(),xt=k(Re);if(h=arguments,l=this,_=Re,xt){if(y===r)return z(_);if(R)return qu(y),y=Sr(te,t),j(_)}return y===r&&(y=Sr(te,t)),v}return ot.cancel=nt,ot.flush=Be,ot}var P_=Y(function(e,t){return vu(e,1,t)}),x_=Y(function(e,t,n){return vu(e,vt(t)||0,n)});function S_(e){return kt(e,Yt)}function Ts(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new lt(g);var n=function(){var h=arguments,l=t?t.apply(this,h):h[0],f=n.cache;if(f.has(l))return f.get(l);var v=e.apply(this,h);return n.cache=f.set(l,v)||f,v};return n.cache=new(Ts.Cache||Mt),n}Ts.Cache=Mt;function Ds(e){if(typeof e!="function")throw new lt(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function R_(e){return Ih(2,e)}var O_=f0(function(e,t){t=t.length==1&&B(t[0])?we(t[0],it(M())):we($e(t,1),it(M()));var n=t.length;return Y(function(h){for(var l=-1,f=Le(h.length,n);++l<f;)h[l]=t[l].call(this,h[l]);return tt(e,this,h)})}),So=Y(function(e,t){var n=ti(t,Ji(So));return kt(e,Q,r,t,n)}),Oh=Y(function(e,t){var n=ti(t,Ji(Oh));return kt(e,me,r,t,n)}),N_=Vt(function(e,t){return kt(e,Ve,r,r,r,t)});function C_(e,t){if(typeof e!="function")throw new lt(g);return t=t===r?t:G(t),Y(e,t)}function A_(e,t){if(typeof e!="function")throw new lt(g);return t=t==null?0:Ne(G(t),0),Y(function(n){var h=n[t],l=oi(n,0,t);return h&&ei(l,h),tt(e,this,l)})}function T_(e,t,n){var h=!0,l=!0;if(typeof e!="function")throw new lt(g);return Ee(n)&&(h="leading"in n?!!n.leading:h,l="trailing"in n?!!n.trailing:l),Rh(e,t,{leading:h,maxWait:t,trailing:l})}function D_(e){return Eh(e,1)}function F_(e,t){return So(uo(t),e)}function j_(){if(!arguments.length)return[];var e=arguments[0];return B(e)?e:[e]}function $_(e){return dt(e,ce)}function q_(e,t){return t=typeof t=="function"?t:r,dt(e,ce,t)}function L_(e){return dt(e,N|ce)}function U_(e,t){return t=typeof t=="function"?t:r,dt(e,N|ce,t)}function M_(e,t){return t==null||gu(e,t,Ae(t))}function Pt(e,t){return e===t||e!==e&&t!==t}var z_=xs(Yn),k_=xs(function(e,t){return e>=t}),Pi=bu(function(){return arguments}())?bu:function(e){return Ie(e)&&ue.call(e,"callee")&&!au.call(e,"callee")},B=E.isArray,V_=kc?it(kc):Ym;function Qe(e){return e!=null&&Fs(e.length)&&!Kt(e)}function Se(e){return Ie(e)&&Qe(e)}function H_(e){return e===!0||e===!1||Ie(e)&&He(e)==or}var ai=sm||qo,K_=Vc?it(Vc):Zm;function B_(e){return Ie(e)&&e.nodeType===1&&!Rr(e)}function G_(e){if(e==null)return!0;if(Qe(e)&&(B(e)||typeof e=="string"||typeof e.splice=="function"||ai(e)||Wi(e)||Pi(e)))return!e.length;var t=Ue(e);if(t==_t||t==bt)return!e.size;if(xr(e))return!eo(e).length;for(var n in e)if(ue.call(e,n))return!1;return!0}function J_(e,t){return Er(e,t)}function W_(e,t,n){n=typeof n=="function"?n:r;var h=n?n(e,t):r;return h===r?Er(e,t,r,n):!!h}function Ro(e){if(!Ie(e))return!1;var t=He(e);return t==Br||t==mv||typeof e.message=="string"&&typeof e.name=="string"&&!Rr(e)}function Q_(e){return typeof e=="number"&&uu(e)}function Kt(e){if(!Ee(e))return!1;var t=He(e);return t==Gr||t==vc||t==yv||t==_v}function Nh(e){return typeof e=="number"&&e==G(e)}function Fs(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Zt}function Ee(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ie(e){return e!=null&&typeof e=="object"}var Ch=Hc?it(Hc):e0;function Y_(e,t){return e===t||Xn(e,t,yo(t))}function Z_(e,t,n){return n=typeof n=="function"?n:r,Xn(e,t,yo(t),n)}function X_(e){return Ah(e)&&e!=+e}function e1(e){if(q0(e))throw new K(p);return Eu(e)}function t1(e){return e===null}function i1(e){return e==null}function Ah(e){return typeof e=="number"||Ie(e)&&He(e)==cr}function Rr(e){if(!Ie(e)||He(e)!=Lt)return!1;var t=as(e);if(t===null)return!0;var n=ue.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&rs.call(n)==Zy}var Oo=Kc?it(Kc):t0;function r1(e){return Nh(e)&&e>=-Zt&&e<=Zt}var Th=Bc?it(Bc):i0;function js(e){return typeof e=="string"||!B(e)&&Ie(e)&&He(e)==hr}function st(e){return typeof e=="symbol"||Ie(e)&&He(e)==Jr}var Wi=Gc?it(Gc):r0;function s1(e){return e===r}function n1(e){return Ie(e)&&Ue(e)==lr}function o1(e){return Ie(e)&&He(e)==Ev}var a1=xs(to),c1=xs(function(e,t){return e<=t});function Dh(e){if(!e)return[];if(Qe(e))return js(e)?Et(e):We(e);if(fr&&e[fr])return My(e[fr]());var t=Ue(e),n=t==_t?kn:t==bt?es:Qi;return n(e)}function Bt(e){if(!e)return e===0?e:0;if(e=vt(e),e===gi||e===-gi){var t=e<0?-1:1;return t*dv}return e===e?e:0}function G(e){var t=Bt(e),n=t%1;return t===t?n?t-n:t:0}function Fh(e){return e?_i(G(e),0,Nt):0}function vt(e){if(typeof e=="number")return e;if(st(e))return Hr;if(Ee(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ee(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Xc(e);var n=Vv.test(e);return n||Kv.test(e)?Iy(e.slice(2),n?2:8):kv.test(e)?Hr:+e}function jh(e){return At(e,Ye(e))}function u1(e){return e?_i(G(e),-Zt,Zt):e===0?e:0}function ae(e){return e==null?"":rt(e)}var h1=Bi(function(e,t){if(xr(t)||Qe(t)){At(t,Ae(t),e);return}for(var n in t)ue.call(t,n)&&wr(e,n,t[n])}),$h=Bi(function(e,t){At(t,Ye(t),e)}),$s=Bi(function(e,t,n,h){At(t,Ye(t),e,h)}),l1=Bi(function(e,t,n,h){At(t,Ae(t),e,h)}),p1=Vt(Jn);function d1(e,t){var n=Ki(e);return t==null?n:fu(n,t)}var f1=Y(function(e,t){e=pe(e);var n=-1,h=t.length,l=h>2?t[2]:r;for(l&&Ke(t[0],t[1],l)&&(h=1);++n<h;)for(var f=t[n],v=Ye(f),y=-1,_=v.length;++y<_;){var P=v[y],S=e[P];(S===r||Pt(S,ki[P])&&!ue.call(e,P))&&(e[P]=f[P])}return e}),g1=Y(function(e){return e.push(r,Xu),tt(qh,r,e)});function v1(e,t){return Wc(e,M(t,3),Ct)}function y1(e,t){return Wc(e,M(t,3),Qn)}function m1(e,t){return e==null?e:Wn(e,M(t,3),Ye)}function w1(e,t){return e==null?e:wu(e,M(t,3),Ye)}function _1(e,t){return e&&Ct(e,M(t,3))}function b1(e,t){return e&&Qn(e,M(t,3))}function E1(e){return e==null?[]:ys(e,Ae(e))}function I1(e){return e==null?[]:ys(e,Ye(e))}function No(e,t,n){var h=e==null?r:bi(e,t);return h===r?n:h}function P1(e,t){return e!=null&&ih(e,t,Gm)}function Co(e,t){return e!=null&&ih(e,t,Jm)}var x1=Ju(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=ss.call(t)),e[t]=n},To(Ze)),S1=Ju(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=ss.call(t)),ue.call(e,t)?e[t].push(n):e[t]=[n]},M),R1=Y(br);function Ae(e){return Qe(e)?pu(e):eo(e)}function Ye(e){return Qe(e)?pu(e,!0):s0(e)}function O1(e,t){var n={};return t=M(t,3),Ct(e,function(h,l,f){zt(n,t(h,l,f),h)}),n}function N1(e,t){var n={};return t=M(t,3),Ct(e,function(h,l,f){zt(n,l,t(h,l,f))}),n}var C1=Bi(function(e,t,n){ms(e,t,n)}),qh=Bi(function(e,t,n,h){ms(e,t,n,h)}),A1=Vt(function(e,t){var n={};if(e==null)return n;var h=!1;t=we(t,function(f){return f=ni(f,e),h||(h=f.length>1),f}),At(e,go(e),n),h&&(n=dt(n,N|$|ce,x0));for(var l=t.length;l--;)oo(n,t[l]);return n});function T1(e,t){return Lh(e,Ds(M(t)))}var D1=Vt(function(e,t){return e==null?{}:o0(e,t)});function Lh(e,t){if(e==null)return{};var n=we(go(e),function(h){return[h]});return t=M(t),Nu(e,n,function(h,l){return t(h,l[0])})}function F1(e,t,n){t=ni(t,e);var h=-1,l=t.length;for(l||(l=1,e=r);++h<l;){var f=e==null?r:e[Tt(t[h])];f===r&&(h=l,f=n),e=Kt(f)?f.call(e):f}return e}function j1(e,t,n){return e==null?e:Ir(e,t,n)}function $1(e,t,n,h){return h=typeof h=="function"?h:r,e==null?e:Ir(e,t,n,h)}var Uh=Yu(Ae),Mh=Yu(Ye);function q1(e,t,n){var h=B(e),l=h||ai(e)||Wi(e);if(t=M(t,4),n==null){var f=e&&e.constructor;l?n=h?new f:[]:Ee(e)?n=Kt(f)?Ki(as(e)):{}:n={}}return(l?ht:Ct)(e,function(v,y,_){return t(n,v,y,_)}),n}function L1(e,t){return e==null?!0:oo(e,t)}function U1(e,t,n){return e==null?e:Fu(e,t,uo(n))}function M1(e,t,n,h){return h=typeof h=="function"?h:r,e==null?e:Fu(e,t,uo(n),h)}function Qi(e){return e==null?[]:zn(e,Ae(e))}function z1(e){return e==null?[]:zn(e,Ye(e))}function k1(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=vt(n),n=n===n?n:0),t!==r&&(t=vt(t),t=t===t?t:0),_i(vt(e),t,n)}function V1(e,t,n){return t=Bt(t),n===r?(n=t,t=0):n=Bt(n),e=vt(e),Wm(e,t,n)}function H1(e,t,n){if(n&&typeof n!="boolean"&&Ke(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Bt(e),t===r?(t=e,e=0):t=Bt(t)),e>t){var h=e;e=t,t=h}if(n||e%1||t%1){var l=hu();return Le(e+l*(t-e+Ey("1e-"+((l+"").length-1))),t)}return ro(e,t)}var K1=Gi(function(e,t,n){return t=t.toLowerCase(),e+(n?zh(t):t)});function zh(e){return Ao(ae(e).toLowerCase())}function kh(e){return e=ae(e),e&&e.replace(Gv,jy).replace(py,"")}function B1(e,t,n){e=ae(e),t=rt(t);var h=e.length;n=n===r?h:_i(G(n),0,h);var l=n;return n-=t.length,n>=0&&e.slice(n,l)==t}function G1(e){return e=ae(e),e&&Rv.test(e)?e.replace(wc,$y):e}function J1(e){return e=ae(e),e&&Dv.test(e)?e.replace(xn,"\\$&"):e}var W1=Gi(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Q1=Gi(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Y1=Ku("toLowerCase");function Z1(e,t,n){e=ae(e),t=G(t);var h=t?Mi(e):0;if(!t||h>=t)return e;var l=(t-h)/2;return Ps(ls(l),n)+e+Ps(hs(l),n)}function X1(e,t,n){e=ae(e),t=G(t);var h=t?Mi(e):0;return t&&h<t?e+Ps(t-h,n):e}function eb(e,t,n){e=ae(e),t=G(t);var h=t?Mi(e):0;return t&&h<t?Ps(t-h,n)+e:e}function tb(e,t,n){return n||t==null?t=0:t&&(t=+t),cm(ae(e).replace(Sn,""),t||0)}function ib(e,t,n){return(n?Ke(e,t,n):t===r)?t=1:t=G(t),so(ae(e),t)}function rb(){var e=arguments,t=ae(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var sb=Gi(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function nb(e,t,n){return n&&typeof n!="number"&&Ke(e,t,n)&&(t=n=r),n=n===r?Nt:n>>>0,n?(e=ae(e),e&&(typeof t=="string"||t!=null&&!Oo(t))&&(t=rt(t),!t&&Ui(e))?oi(Et(e),0,n):e.split(t,n)):[]}var ob=Gi(function(e,t,n){return e+(n?" ":"")+Ao(t)});function ab(e,t,n){return e=ae(e),n=n==null?0:_i(G(n),0,e.length),t=rt(t),e.slice(n,n+t.length)==t}function cb(e,t,n){var h=d.templateSettings;n&&Ke(e,t,n)&&(t=r),e=ae(e),t=$s({},t,h,Zu);var l=$s({},t.imports,h.imports,Zu),f=Ae(l),v=zn(l,f),y,_,P=0,S=t.interpolate||Wr,R="__p += '",T=Vn((t.escape||Wr).source+"|"+S.source+"|"+(S===_c?zv:Wr).source+"|"+(t.evaluate||Wr).source+"|$","g"),j="//# sourceURL="+(ue.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++yy+"]")+`
`;e.replace(T,function(k,te,re,nt,Be,ot){return re||(re=nt),R+=e.slice(P,ot).replace(Jv,qy),te&&(y=!0,R+=`' +
__e(`+te+`) +
'`),Be&&(_=!0,R+=`';
`+Be+`;
__p += '`),re&&(R+=`' +
((__t = (`+re+`)) == null ? '' : __t) +
'`),P=ot+k.length,k}),R+=`';
`;var z=ue.call(t,"variable")&&t.variable;if(!z)R=`with (obj) {
`+R+`
}
`;else if(Uv.test(z))throw new K(m);R=(_?R.replace(Iv,""):R).replace(Pv,"$1").replace(xv,"$1;"),R="function("+(z||"obj")+`) {
`+(z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(_?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var W=Hh(function(){return oe(f,j+"return "+R).apply(r,v)});if(W.source=R,Ro(W))throw W;return W}function ub(e){return ae(e).toLowerCase()}function hb(e){return ae(e).toUpperCase()}function lb(e,t,n){if(e=ae(e),e&&(n||t===r))return Xc(e);if(!e||!(t=rt(t)))return e;var h=Et(e),l=Et(t),f=eu(h,l),v=tu(h,l)+1;return oi(h,f,v).join("")}function pb(e,t,n){if(e=ae(e),e&&(n||t===r))return e.slice(0,ru(e)+1);if(!e||!(t=rt(t)))return e;var h=Et(e),l=tu(h,Et(t))+1;return oi(h,0,l).join("")}function db(e,t,n){if(e=ae(e),e&&(n||t===r))return e.replace(Sn,"");if(!e||!(t=rt(t)))return e;var h=Et(e),l=eu(h,Et(t));return oi(h,l).join("")}function fb(e,t){var n=av,h=cv;if(Ee(t)){var l="separator"in t?t.separator:l;n="length"in t?G(t.length):n,h="omission"in t?rt(t.omission):h}e=ae(e);var f=e.length;if(Ui(e)){var v=Et(e);f=v.length}if(n>=f)return e;var y=n-Mi(h);if(y<1)return h;var _=v?oi(v,0,y).join(""):e.slice(0,y);if(l===r)return _+h;if(v&&(y+=_.length-y),Oo(l)){if(e.slice(y).search(l)){var P,S=_;for(l.global||(l=Vn(l.source,ae(bc.exec(l))+"g")),l.lastIndex=0;P=l.exec(S);)var R=P.index;_=_.slice(0,R===r?y:R)}}else if(e.indexOf(rt(l),y)!=y){var T=_.lastIndexOf(l);T>-1&&(_=_.slice(0,T))}return _+h}function gb(e){return e=ae(e),e&&Sv.test(e)?e.replace(mc,Hy):e}var vb=Gi(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Ao=Ku("toUpperCase");function Vh(e,t,n){return e=ae(e),t=n?r:t,t===r?Uy(e)?Gy(e):Cy(e):e.match(t)||[]}var Hh=Y(function(e,t){try{return tt(e,r,t)}catch(n){return Ro(n)?n:new K(n)}}),yb=Vt(function(e,t){return ht(t,function(n){n=Tt(n),zt(e,n,xo(e[n],e))}),e});function mb(e){var t=e==null?0:e.length,n=M();return e=t?we(e,function(h){if(typeof h[1]!="function")throw new lt(g);return[n(h[0]),h[1]]}):[],Y(function(h){for(var l=-1;++l<t;){var f=e[l];if(tt(f[0],this,h))return tt(f[1],this,h)}})}function wb(e){return Hm(dt(e,N))}function To(e){return function(){return e}}function _b(e,t){return e==null||e!==e?t:e}var bb=Gu(),Eb=Gu(!0);function Ze(e){return e}function Do(e){return Iu(typeof e=="function"?e:dt(e,N))}function Ib(e){return xu(dt(e,N))}function Pb(e,t){return Su(e,dt(t,N))}var xb=Y(function(e,t){return function(n){return br(n,e,t)}}),Sb=Y(function(e,t){return function(n){return br(e,n,t)}});function Fo(e,t,n){var h=Ae(t),l=ys(t,h);n==null&&!(Ee(t)&&(l.length||!h.length))&&(n=t,t=e,e=this,l=ys(t,Ae(t)));var f=!(Ee(n)&&"chain"in n)||!!n.chain,v=Kt(e);return ht(l,function(y){var _=t[y];e[y]=_,v&&(e.prototype[y]=function(){var P=this.__chain__;if(f||P){var S=e(this.__wrapped__),R=S.__actions__=We(this.__actions__);return R.push({func:_,args:arguments,thisArg:e}),S.__chain__=P,S}return _.apply(e,ei([this.value()],arguments))})}),e}function Rb(){return je._===this&&(je._=Xy),this}function jo(){}function Ob(e){return e=G(e),Y(function(t){return Ru(t,e)})}var Nb=lo(we),Cb=lo(Jc),Ab=lo($n);function Kh(e){return wo(e)?qn(Tt(e)):a0(e)}function Tb(e){return function(t){return e==null?r:bi(e,t)}}var Db=Wu(),Fb=Wu(!0);function $o(){return[]}function qo(){return!1}function jb(){return{}}function $b(){return""}function qb(){return!0}function Lb(e,t){if(e=G(e),e<1||e>Zt)return[];var n=Nt,h=Le(e,Nt);t=M(t),e-=Nt;for(var l=Mn(h,t);++n<e;)t(n);return l}function Ub(e){return B(e)?we(e,Tt):st(e)?[e]:We(lh(ae(e)))}function Mb(e){var t=++Yy;return ae(e)+t}var zb=Is(function(e,t){return e+t},0),kb=po("ceil"),Vb=Is(function(e,t){return e/t},1),Hb=po("floor");function Kb(e){return e&&e.length?vs(e,Ze,Yn):r}function Bb(e,t){return e&&e.length?vs(e,M(t,2),Yn):r}function Gb(e){return Yc(e,Ze)}function Jb(e,t){return Yc(e,M(t,2))}function Wb(e){return e&&e.length?vs(e,Ze,to):r}function Qb(e,t){return e&&e.length?vs(e,M(t,2),to):r}var Yb=Is(function(e,t){return e*t},1),Zb=po("round"),Xb=Is(function(e,t){return e-t},0);function eE(e){return e&&e.length?Un(e,Ze):0}function tE(e,t){return e&&e.length?Un(e,M(t,2)):0}return d.after=I_,d.ary=Eh,d.assign=h1,d.assignIn=$h,d.assignInWith=$s,d.assignWith=l1,d.at=p1,d.before=Ih,d.bind=xo,d.bindAll=yb,d.bindKey=Ph,d.castArray=j_,d.chain=wh,d.chunk=H0,d.compact=K0,d.concat=B0,d.cond=mb,d.conforms=wb,d.constant=To,d.countBy=e_,d.create=d1,d.curry=xh,d.curryRight=Sh,d.debounce=Rh,d.defaults=f1,d.defaultsDeep=g1,d.defer=P_,d.delay=x_,d.difference=G0,d.differenceBy=J0,d.differenceWith=W0,d.drop=Q0,d.dropRight=Y0,d.dropRightWhile=Z0,d.dropWhile=X0,d.fill=ew,d.filter=i_,d.flatMap=n_,d.flatMapDeep=o_,d.flatMapDepth=a_,d.flatten=gh,d.flattenDeep=tw,d.flattenDepth=iw,d.flip=S_,d.flow=bb,d.flowRight=Eb,d.fromPairs=rw,d.functions=E1,d.functionsIn=I1,d.groupBy=c_,d.initial=nw,d.intersection=ow,d.intersectionBy=aw,d.intersectionWith=cw,d.invert=x1,d.invertBy=S1,d.invokeMap=h_,d.iteratee=Do,d.keyBy=l_,d.keys=Ae,d.keysIn=Ye,d.map=Cs,d.mapKeys=O1,d.mapValues=N1,d.matches=Ib,d.matchesProperty=Pb,d.memoize=Ts,d.merge=C1,d.mergeWith=qh,d.method=xb,d.methodOf=Sb,d.mixin=Fo,d.negate=Ds,d.nthArg=Ob,d.omit=A1,d.omitBy=T1,d.once=R_,d.orderBy=p_,d.over=Nb,d.overArgs=O_,d.overEvery=Cb,d.overSome=Ab,d.partial=So,d.partialRight=Oh,d.partition=d_,d.pick=D1,d.pickBy=Lh,d.property=Kh,d.propertyOf=Tb,d.pull=pw,d.pullAll=yh,d.pullAllBy=dw,d.pullAllWith=fw,d.pullAt=gw,d.range=Db,d.rangeRight=Fb,d.rearg=N_,d.reject=v_,d.remove=vw,d.rest=C_,d.reverse=Io,d.sampleSize=m_,d.set=j1,d.setWith=$1,d.shuffle=w_,d.slice=yw,d.sortBy=E_,d.sortedUniq=Pw,d.sortedUniqBy=xw,d.split=nb,d.spread=A_,d.tail=Sw,d.take=Rw,d.takeRight=Ow,d.takeRightWhile=Nw,d.takeWhile=Cw,d.tap=Kw,d.throttle=T_,d.thru=Ns,d.toArray=Dh,d.toPairs=Uh,d.toPairsIn=Mh,d.toPath=Ub,d.toPlainObject=jh,d.transform=q1,d.unary=D_,d.union=Aw,d.unionBy=Tw,d.unionWith=Dw,d.uniq=Fw,d.uniqBy=jw,d.uniqWith=$w,d.unset=L1,d.unzip=Po,d.unzipWith=mh,d.update=U1,d.updateWith=M1,d.values=Qi,d.valuesIn=z1,d.without=qw,d.words=Vh,d.wrap=F_,d.xor=Lw,d.xorBy=Uw,d.xorWith=Mw,d.zip=zw,d.zipObject=kw,d.zipObjectDeep=Vw,d.zipWith=Hw,d.entries=Uh,d.entriesIn=Mh,d.extend=$h,d.extendWith=$s,Fo(d,d),d.add=zb,d.attempt=Hh,d.camelCase=K1,d.capitalize=zh,d.ceil=kb,d.clamp=k1,d.clone=$_,d.cloneDeep=L_,d.cloneDeepWith=U_,d.cloneWith=q_,d.conformsTo=M_,d.deburr=kh,d.defaultTo=_b,d.divide=Vb,d.endsWith=B1,d.eq=Pt,d.escape=G1,d.escapeRegExp=J1,d.every=t_,d.find=r_,d.findIndex=dh,d.findKey=v1,d.findLast=s_,d.findLastIndex=fh,d.findLastKey=y1,d.floor=Hb,d.forEach=_h,d.forEachRight=bh,d.forIn=m1,d.forInRight=w1,d.forOwn=_1,d.forOwnRight=b1,d.get=No,d.gt=z_,d.gte=k_,d.has=P1,d.hasIn=Co,d.head=vh,d.identity=Ze,d.includes=u_,d.indexOf=sw,d.inRange=V1,d.invoke=R1,d.isArguments=Pi,d.isArray=B,d.isArrayBuffer=V_,d.isArrayLike=Qe,d.isArrayLikeObject=Se,d.isBoolean=H_,d.isBuffer=ai,d.isDate=K_,d.isElement=B_,d.isEmpty=G_,d.isEqual=J_,d.isEqualWith=W_,d.isError=Ro,d.isFinite=Q_,d.isFunction=Kt,d.isInteger=Nh,d.isLength=Fs,d.isMap=Ch,d.isMatch=Y_,d.isMatchWith=Z_,d.isNaN=X_,d.isNative=e1,d.isNil=i1,d.isNull=t1,d.isNumber=Ah,d.isObject=Ee,d.isObjectLike=Ie,d.isPlainObject=Rr,d.isRegExp=Oo,d.isSafeInteger=r1,d.isSet=Th,d.isString=js,d.isSymbol=st,d.isTypedArray=Wi,d.isUndefined=s1,d.isWeakMap=n1,d.isWeakSet=o1,d.join=uw,d.kebabCase=W1,d.last=gt,d.lastIndexOf=hw,d.lowerCase=Q1,d.lowerFirst=Y1,d.lt=a1,d.lte=c1,d.max=Kb,d.maxBy=Bb,d.mean=Gb,d.meanBy=Jb,d.min=Wb,d.minBy=Qb,d.stubArray=$o,d.stubFalse=qo,d.stubObject=jb,d.stubString=$b,d.stubTrue=qb,d.multiply=Yb,d.nth=lw,d.noConflict=Rb,d.noop=jo,d.now=As,d.pad=Z1,d.padEnd=X1,d.padStart=eb,d.parseInt=tb,d.random=H1,d.reduce=f_,d.reduceRight=g_,d.repeat=ib,d.replace=rb,d.result=F1,d.round=Zb,d.runInContext=w,d.sample=y_,d.size=__,d.snakeCase=sb,d.some=b_,d.sortedIndex=mw,d.sortedIndexBy=ww,d.sortedIndexOf=_w,d.sortedLastIndex=bw,d.sortedLastIndexBy=Ew,d.sortedLastIndexOf=Iw,d.startCase=ob,d.startsWith=ab,d.subtract=Xb,d.sum=eE,d.sumBy=tE,d.template=cb,d.times=Lb,d.toFinite=Bt,d.toInteger=G,d.toLength=Fh,d.toLower=ub,d.toNumber=vt,d.toSafeInteger=u1,d.toString=ae,d.toUpper=hb,d.trim=lb,d.trimEnd=pb,d.trimStart=db,d.truncate=fb,d.unescape=gb,d.uniqueId=Mb,d.upperCase=vb,d.upperFirst=Ao,d.each=_h,d.eachRight=bh,d.first=vh,Fo(d,function(){var e={};return Ct(d,function(t,n){ue.call(d.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),d.VERSION=o,ht(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),ht(["drop","take"],function(e,t){ie.prototype[e]=function(n){n=n===r?1:Ne(G(n),0);var h=this.__filtered__&&!t?new ie(this):this.clone();return h.__filtered__?h.__takeCount__=Le(n,h.__takeCount__):h.__views__.push({size:Le(n,Nt),type:e+(h.__dir__<0?"Right":"")}),h},ie.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),ht(["filter","map","takeWhile"],function(e,t){var n=t+1,h=n==gc||n==pv;ie.prototype[e]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:M(l,3),type:n}),f.__filtered__=f.__filtered__||h,f}}),ht(["head","last"],function(e,t){var n="take"+(t?"Right":"");ie.prototype[e]=function(){return this[n](1).value()[0]}}),ht(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");ie.prototype[e]=function(){return this.__filtered__?new ie(this):this[n](1)}}),ie.prototype.compact=function(){return this.filter(Ze)},ie.prototype.find=function(e){return this.filter(e).head()},ie.prototype.findLast=function(e){return this.reverse().find(e)},ie.prototype.invokeMap=Y(function(e,t){return typeof e=="function"?new ie(this):this.map(function(n){return br(n,e,t)})}),ie.prototype.reject=function(e){return this.filter(Ds(M(e)))},ie.prototype.slice=function(e,t){e=G(e);var n=this;return n.__filtered__&&(e>0||t<0)?new ie(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=G(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},ie.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ie.prototype.toArray=function(){return this.take(Nt)},Ct(ie.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),h=/^(?:head|last)$/.test(t),l=d[h?"take"+(t=="last"?"Right":""):t],f=h||/^find/.test(t);l&&(d.prototype[t]=function(){var v=this.__wrapped__,y=h?[1]:arguments,_=v instanceof ie,P=y[0],S=_||B(v),R=function(te){var re=l.apply(d,ei([te],y));return h&&T?re[0]:re};S&&n&&typeof P=="function"&&P.length!=1&&(_=S=!1);var T=this.__chain__,j=!!this.__actions__.length,z=f&&!T,W=_&&!j;if(!f&&S){v=W?v:new ie(this);var k=e.apply(v,y);return k.__actions__.push({func:Ns,args:[R],thisArg:r}),new pt(k,T)}return z&&W?e.apply(this,y):(k=this.thru(R),z?h?k.value()[0]:k.value():k)})}),ht(["pop","push","shift","sort","splice","unshift"],function(e){var t=ts[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",h=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(h&&!this.__chain__){var f=this.value();return t.apply(B(f)?f:[],l)}return this[n](function(v){return t.apply(B(v)?v:[],l)})}}),Ct(ie.prototype,function(e,t){var n=d[t];if(n){var h=n.name+"";ue.call(Hi,h)||(Hi[h]=[]),Hi[h].push({name:t,func:n})}}),Hi[Es(r,le).name]=[{name:"wrapper",func:r}],ie.prototype.clone=gm,ie.prototype.reverse=vm,ie.prototype.value=ym,d.prototype.at=Bw,d.prototype.chain=Gw,d.prototype.commit=Jw,d.prototype.next=Ww,d.prototype.plant=Yw,d.prototype.reverse=Zw,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Xw,d.prototype.first=d.prototype.head,fr&&(d.prototype[fr]=Qw),d},zi=Jy();vi?((vi.exports=zi)._=zi,Tn._=zi):je._=zi}).call(nr)})(pn,pn.exports);var Lg=Object.defineProperty,Ug=Object.defineProperties,Mg=Object.getOwnPropertyDescriptors,ac=Object.getOwnPropertySymbols,zg=Object.prototype.hasOwnProperty,kg=Object.prototype.propertyIsEnumerable,cc=(u,s,r)=>s in u?Lg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,zr=(u,s)=>{for(var r in s||(s={}))zg.call(s,r)&&cc(u,r,s[r]);if(ac)for(var r of ac(s))kg.call(s,r)&&cc(u,r,s[r]);return u},Vg=(u,s)=>Ug(u,Mg(s));function Qt(u,s,r){var o;const a=zo(u);return((o=s.rpcMap)==null?void 0:o[a.reference])||`${qg}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function fi(u){return u.includes(":")?u.split(":")[1]:u}function uc(u){return u.map(s=>`${s.split(":")[0]}:${s.split(":")[1]}`)}function Hg(u,s){const r=Object.keys(s.namespaces).filter(a=>a.includes(u));if(!r.length)return[];const o=[];return r.forEach(a=>{const p=s.namespaces[a].accounts;o.push(...p)}),o}function hc(u={},s={}){const r=lc(u),o=lc(s);return pn.exports.merge(r,o)}function lc(u){var s,r,o,a;const p={};if(!Ti(u))return p;for(const[g,m]of Object.entries(u)){const b=Fr(g)?[g]:m.chains,x=m.methods||[],C=m.events||[],N=m.rpcMap||{},$=Ai(g);p[$]=Vg(zr(zr({},p[$]),m),{chains:Rt(b,(s=p[$])==null?void 0:s.chains),methods:Rt(x,(r=p[$])==null?void 0:r.methods),events:Rt(C,(o=p[$])==null?void 0:o.events),rpcMap:zr(zr({},N),(a=p[$])==null?void 0:a.rpcMap)})}return p}function Kg(u){return u.includes(":")?u.split(":")[2]:u}function Bg(u){const s={};for(const[r,o]of Object.entries(u)){const a=o.methods||[],p=o.events||[],g=o.accounts||[],m=Fr(r)?[r]:o.chains?o.chains:uc(o.accounts);s[r]={chains:m,methods:a,events:p,accounts:g}}return s}function dn(u){return typeof u=="number"?u:u.includes("0x")?parseInt(u,16):(u=u.includes(":")?u.split(":")[1]:u,isNaN(Number(u))?u:Number(u))}const pc={},ye=u=>pc[u],fn=(u,s)=>{pc[u]=s};class Gg{constructor(s){this.name="polkadot",this.namespace=s.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=fi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Qt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Dt(new di(o,ye("disableProviderPing")))}}class Jg{constructor(s){this.name="eip155",this.namespace=s.namespace,this.events=ye("events"),this.client=ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(s){switch(s.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(s);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(s.request.method)?await this.client.request(s):this.getHttpProvider().request(s.request)}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(parseInt(s),r),this.chainId=parseInt(s),this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}createHttpProvider(s,r){const o=r||Qt(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Dt(new sc(o,ye("disableProviderPing")))}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=parseInt(fi(r));s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const s=this.chainId,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}async handleSwitchChain(s){var r,o;let a=s.request.params?(r=s.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const p=parseInt(a,16);if(this.isChainApproved(p))this.setDefaultChain(`${p}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:s.topic,request:{method:s.request.method,params:[{chainId:a}]},chainId:(o=this.namespace.chains)==null?void 0:o[0]}),this.setDefaultChain(`${p}`);else throw new Error(`Failed to switch to chain 'eip155:${p}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(s){return this.namespace.chains.includes(`${this.name}:${s}`)}}class Wg{constructor(s){this.name="solana",this.namespace=s.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=fi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Qt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Dt(new di(o,ye("disableProviderPing")))}}class Qg{constructor(s){this.name="cosmos",this.namespace=s.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=fi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Qt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Dt(new di(o,ye("disableProviderPing")))}}class Yg{constructor(s){this.name="cip34",this.namespace=s.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{const o=this.getCardanoRPCUrl(r),a=fi(r);s[a]=this.createHttpProvider(a,o)}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}getCardanoRPCUrl(s){const r=this.namespace.rpcMap;if(r)return r[s]}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||this.getCardanoRPCUrl(s);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Dt(new di(o,ye("disableProviderPing")))}}class Zg{constructor(s){this.name="elrond",this.namespace=s.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=fi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Qt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Dt(new di(o,ye("disableProviderPing")))}}class Xg{constructor(s){this.name="multiversx",this.namespace=s.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=fi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Qt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Dt(new di(o,ye("disableProviderPing")))}}class ev{constructor(s){this.name="near",this.namespace=s.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){if(this.chainId=s,!this.httpProviders[s]){const o=r||Qt(`${this.name}:${s}`,this.namespace);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,o)}this.events.emit(qt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;s[r]=this.createHttpProvider(r,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Qt(s,this.namespace);return typeof o>"u"?void 0:new Dt(new di(o,ye("disableProviderPing")))}}var tv=Object.defineProperty,iv=Object.defineProperties,rv=Object.getOwnPropertyDescriptors,dc=Object.getOwnPropertySymbols,sv=Object.prototype.hasOwnProperty,nv=Object.prototype.propertyIsEnumerable,fc=(u,s,r)=>s in u?tv(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,kr=(u,s)=>{for(var r in s||(s={}))sv.call(s,r)&&fc(u,r,s[r]);if(dc)for(var r of dc(s))nv.call(s,r)&&fc(u,r,s[r]);return u},gn=(u,s)=>iv(u,rv(s));class Vr{constructor(s){this.events=new(yt()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=s,this.logger=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ec.pino)((0,ec.getDefaultLoggerOptions)({level:(s==null?void 0:s.logger)||nc})),this.disableProviderPing=(s==null?void 0:s.disableProviderPing)||!1}static async init(s){const r=new Vr(s);return await r.initialize(),r}async request(s,r,o){const[a,p]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:kr({},s),chainId:`${a}:${p}`,topic:this.session.topic,expiry:o})}sendAsync(s,r,o,a){const p=new Date().getTime();this.request(s,o,a).then(g=>r(null,(0,V.formatJsonRpcResult)(p,g))).catch(g=>r(g,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var s;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(s=this.session)==null?void 0:s.topic,reason:be("USER_DISCONNECTED")}),await this.cleanup()}async connect(s){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(s),await this.cleanupPendingPairings(),!s.skipPairing)return await this.pair(s.pairingTopic)}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}removeListener(s,r){this.events.removeListener(s,r)}off(s,r){this.events.off(s,r)}get isWalletConnect(){return!0}async pair(s){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:o,approval:a}=await this.client.connect({pairingTopic:s,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});o&&(this.uri=o,this.events.emit("display_uri",o)),await a().then(p=>{this.session=p;const g=Bg(p.namespaces);this.namespaces=hc(this.namespaces,g),this.persist("namespaces",this.namespaces)}).catch(p=>{if(p.message!==Ya)throw p;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(s,r){try{if(!this.session)return;const[o,a]=this.validateChain(s);this.getProvider(o).setDefaultChain(a,r)}catch(o){if(!/Please call connect/.test(o.message))throw o}}async cleanupPendingPairings(s={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(pi(r)){for(const o of r)s.deletePairings?this.client.core.expirer.set(o.topic,0):await this.client.core.relayer.subscriber.unsubscribe(o.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const s=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[s]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ln.init({logger:this.providerOpts.logger||nc,relayUrl:this.providerOpts.relayUrl||Fg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const s=[...new Set(Object.keys(this.session.namespaces).map(r=>Ai(r)))];fn("client",this.client),fn("events",this.events),fn("disableProviderPing",this.disableProviderPing),s.forEach(r=>{if(!this.session)return;const o=Hg(r,this.session),a=uc(o),p=hc(this.namespaces,this.optionalNamespaces),g=gn(kr({},p[r]),{accounts:o,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new Jg({namespace:g});break;case"solana":this.rpcProviders[r]=new Wg({namespace:g});break;case"cosmos":this.rpcProviders[r]=new Qg({namespace:g});break;case"polkadot":this.rpcProviders[r]=new Gg({namespace:g});break;case"cip34":this.rpcProviders[r]=new Yg({namespace:g});break;case"elrond":this.rpcProviders[r]=new Zg({namespace:g});break;case"multiversx":this.rpcProviders[r]=new Xg({namespace:g});break;case"near":this.rpcProviders[r]=new ev({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",s=>{this.events.emit("session_ping",s)}),this.client.on("session_event",s=>{const{params:r}=s,{event:o}=r;if(o.name==="accountsChanged"){const a=o.data;a&&pi(a)&&this.events.emit("accountsChanged",a.map(Kg))}else if(o.name==="chainChanged"){const a=r.chainId,p=r.event.data,g=Ai(a),m=dn(a)!==dn(p)?`${g}:${dn(p)}`:a;this.onChainChanged(m)}else this.events.emit(o.name,o.data);this.events.emit("session_event",s)}),this.client.on("session_update",({topic:s,params:r})=>{var o;const{namespaces:a}=r,p=(o=this.client)==null?void 0:o.session.get(s);this.session=gn(kr({},p),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:s,params:r})}),this.client.on("session_delete",async s=>{await this.cleanup(),this.events.emit("session_delete",s),this.events.emit("disconnect",gn(kr({},be("USER_DISCONNECTED")),{data:s.topic}))}),this.on(qt.DEFAULT_CHAIN_CHANGED,s=>{this.onChainChanged(s,!0)})}getProvider(s){if(!this.rpcProviders[s])throw new Error(`Provider not found: ${s}`);return this.rpcProviders[s]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(s=>{var r;this.getProvider(s).updateNamespace((r=this.session)==null?void 0:r.namespaces[s])})}setNamespaces(s){const{namespaces:r,optionalNamespaces:o,sessionProperties:a}=s;r&&Object.keys(r).length&&(this.namespaces=r),o&&Object.keys(o).length&&(this.optionalNamespaces=o),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",o)}validateChain(s){const[r,o]=(s==null?void 0:s.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,o];if(r&&!Object.keys(this.namespaces||{}).map(g=>Ai(g)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&o)return[r,o];const a=Ai(Object.keys(this.namespaces)[0]),p=this.rpcProviders[a].getDefaultChain();return[a,p]}async requestAccounts(){const[s]=this.validateChain();return await this.getProvider(s).requestAccounts()}onChainChanged(s,r=!1){if(!this.namespaces)return;const[o,a]=this.validateChain(s);a&&(r||this.getProvider(o).setDefaultChain(a),this.namespaces[o]?this.namespaces[o].defaultChain=a:this.namespaces[`${o}:${a}`]?this.namespaces[`${o}:${a}`].defaultChain=a:this.namespaces[`${o}:${a}`]={defaultChain:a},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(s,r){this.client.core.storage.setItem(`${oc}/${s}`,r)}async getFromStore(s){return await this.client.core.storage.getItem(`${oc}/${s}`)}}const ov=Vr}}]);
