"use strict";(self.webpackChunk_ant_design_web3_docs=self.webpackChunk_ant_design_web3_docs||[]).push([[8729],{58729:function(f_,Rh,le){le.d(Rh,{EthereumProvider:function(){return Rd}});var Et=le(72100),ar=le.n(Et),d=le(53956),qh=le(53070),Ai=le(19994),ee=le(56526),hi=le(36900);class Dh extends hi.q{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class y_{constructor(r,s,o){this.core=r,this.logger=s}}class Ah extends hi.q{constructor(r,s){super(),this.core=r,this.logger=s,this.records=new Map}}class Oh{constructor(r,s){this.logger=r,this.core=s}}class Fh extends hi.q{constructor(r,s){super(),this.relayer=r,this.logger=s}}class Nh extends hi.q{constructor(r){super()}}class Th{constructor(r,s,o,a){this.core=r,this.logger=s,this.name=o}}class m_{constructor(){this.map=new Map}}class $h extends hi.q{constructor(r,s){super(),this.relayer=r,this.logger=s}}class v_{constructor(r,s){this.core=r,this.logger=s}}class kh extends hi.q{constructor(r,s){super(),this.core=r,this.logger=s}}class w_{constructor(r,s){this.logger=r,this.core=s}}class Mh{constructor(r,s){this.projectId=r,this.logger=s}}class jh{constructor(r,s){this.projectId=r,this.logger=s}}class __ extends null{constructor(){super()}}class zh{constructor(r){this.opts=r,this.protocol="wc",this.version=2}}class b_ extends null{constructor(){super()}}class Uh{constructor(r){this.client=r}}var Xn=le(41926),as=le(70083),Lh=le(90032),k=le(46196),It=le(56390),L=le(23700),Hh=le(66865),Bh=le(5899),Vh=le.n(Bh),Kh=le(51538),Jh=le.n(Kh);function Gh(y,r){if(y.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),o=0;o<s.length;o++)s[o]=255;for(var a=0;a<y.length;a++){var u=y.charAt(a),g=u.charCodeAt(0);if(s[g]!==255)throw new TypeError(u+" is ambiguous");s[g]=a}var v=y.length,E=y.charAt(0),x=Math.log(v)/Math.log(256),q=Math.log(256)/Math.log(v);function A(F){if(F instanceof Uint8Array||(ArrayBuffer.isView(F)?F=new Uint8Array(F.buffer,F.byteOffset,F.byteLength):Array.isArray(F)&&(F=Uint8Array.from(F))),!(F instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(F.length===0)return"";for(var H=0,K=0,Y=0,ae=F.length;Y!==ae&&F[Y]===0;)Y++,H++;for(var ie=(ae-Y)*q+1>>>0,re=new Uint8Array(ie);Y!==ae;){for(var se=F[Y],_e=0,ge=ie-1;(se!==0||_e<K)&&ge!==-1;ge--,_e++)se+=256*re[ge]>>>0,re[ge]=se%v>>>0,se=se/v>>>0;if(se!==0)throw new Error("Non-zero carry");K=_e,Y++}for(var Ee=ie-K;Ee!==ie&&re[Ee]===0;)Ee++;for(var Le=E.repeat(H);Ee<ie;++Ee)Le+=y.charAt(re[Ee]);return Le}function N(F){if(typeof F!="string")throw new TypeError("Expected String");if(F.length===0)return new Uint8Array;var H=0;if(F[H]!==" "){for(var K=0,Y=0;F[H]===E;)K++,H++;for(var ae=(F.length-H)*x+1>>>0,ie=new Uint8Array(ae);F[H];){var re=s[F.charCodeAt(H)];if(re===255)return;for(var se=0,_e=ae-1;(re!==0||se<Y)&&_e!==-1;_e--,se++)re+=v*ie[_e]>>>0,ie[_e]=re%256>>>0,re=re/256>>>0;if(re!==0)throw new Error("Non-zero carry");Y=se,H++}if(F[H]!==" "){for(var ge=ae-Y;ge!==ae&&ie[ge]===0;)ge++;for(var Ee=new Uint8Array(K+(ae-ge)),Le=K;ge!==ae;)Ee[Le++]=ie[ge++];return Ee}}}function M(F){var H=N(F);if(H)return H;throw new Error(`Non-${r} character`)}return{encode:A,decodeUnsafe:N,decode:M}}var Wh=Gh,Qh=Wh;const eo=y=>{if(y instanceof Uint8Array&&y.constructor.name==="Uint8Array")return y;if(y instanceof ArrayBuffer)return new Uint8Array(y);if(ArrayBuffer.isView(y))return new Uint8Array(y.buffer,y.byteOffset,y.byteLength);throw new Error("Unknown type, must be binary type")},Yh=y=>new TextEncoder().encode(y),Zh=y=>new TextDecoder().decode(y);class Xh{constructor(r,s,o){this.name=r,this.prefix=s,this.baseEncode=o}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class eu{constructor(r,s,o){if(this.name=r,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=o}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return to(this,r)}}class tu{constructor(r){this.decoders=r}or(r){return to(this,r)}decode(r){const s=r[0],o=this.decoders[s];if(o)return o.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const to=(y,r)=>new tu({...y.decoders||{[y.prefix]:y},...r.decoders||{[r.prefix]:r}});class iu{constructor(r,s,o,a){this.name=r,this.prefix=s,this.baseEncode=o,this.baseDecode=a,this.encoder=new Xh(r,s,o),this.decoder=new eu(r,s,a)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const cs=({name:y,prefix:r,encode:s,decode:o})=>new iu(y,r,s,o),Oi=({prefix:y,name:r,alphabet:s})=>{const{encode:o,decode:a}=Qh(s,r);return cs({prefix:y,name:r,encode:o,decode:u=>eo(a(u))})},su=(y,r,s,o)=>{const a={};for(let q=0;q<r.length;++q)a[r[q]]=q;let u=y.length;for(;y[u-1]==="=";)--u;const g=new Uint8Array(u*s/8|0);let v=0,E=0,x=0;for(let q=0;q<u;++q){const A=a[y[q]];if(A===void 0)throw new SyntaxError(`Non-${o} character`);E=E<<s|A,v+=s,v>=8&&(v-=8,g[x++]=255&E>>v)}if(v>=s||255&E<<8-v)throw new SyntaxError("Unexpected end of data");return g},ru=(y,r,s)=>{const o=r[r.length-1]==="=",a=(1<<s)-1;let u="",g=0,v=0;for(let E=0;E<y.length;++E)for(v=v<<8|y[E],g+=8;g>s;)g-=s,u+=r[a&v>>g];if(g&&(u+=r[a&v<<s-g]),o)for(;u.length*s&7;)u+="=";return u},xe=({name:y,prefix:r,bitsPerChar:s,alphabet:o})=>cs({prefix:r,name:y,encode(a){return ru(a,o,s)},decode(a){return su(a,o,s,y)}}),nu=cs({prefix:"\0",name:"identity",encode:y=>Zh(y),decode:y=>Yh(y)});var ou=Object.freeze({__proto__:null,identity:nu});const au=xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var cu=Object.freeze({__proto__:null,base2:au});const hu=xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var uu=Object.freeze({__proto__:null,base8:hu});const lu=Oi({prefix:"9",name:"base10",alphabet:"0123456789"});var pu=Object.freeze({__proto__:null,base10:lu});const du=xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gu=xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var fu=Object.freeze({__proto__:null,base16:du,base16upper:gu});const yu=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mu=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),vu=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),wu=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_u=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),bu=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Eu=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Iu=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Pu=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Su=Object.freeze({__proto__:null,base32:yu,base32upper:mu,base32pad:vu,base32padupper:wu,base32hex:_u,base32hexupper:bu,base32hexpad:Eu,base32hexpadupper:Iu,base32z:Pu});const Cu=Oi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),xu=Oi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ru=Object.freeze({__proto__:null,base36:Cu,base36upper:xu});const qu=Oi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Du=Oi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Au=Object.freeze({__proto__:null,base58btc:qu,base58flickr:Du});const Ou=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fu=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Nu=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Tu=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var $u=Object.freeze({__proto__:null,base64:Ou,base64pad:Fu,base64url:Nu,base64urlpad:Tu});const io=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ku=io.reduce((y,r,s)=>(y[s]=r,y),[]),Mu=io.reduce((y,r,s)=>(y[r.codePointAt(0)]=s,y),[]);function ju(y){return y.reduce((r,s)=>(r+=ku[s],r),"")}function zu(y){const r=[];for(const s of y){const o=Mu[s.codePointAt(0)];if(o===void 0)throw new Error(`Non-base256emoji character: ${s}`);r.push(o)}return new Uint8Array(r)}const Uu=cs({prefix:"\u{1F680}",name:"base256emoji",encode:ju,decode:zu});var Lu=Object.freeze({__proto__:null,base256emoji:Uu}),Hu=ro,so=128,Bu=127,Vu=~Bu,Ku=Math.pow(2,31);function ro(y,r,s){r=r||[],s=s||0;for(var o=s;y>=Ku;)r[s++]=y&255|so,y/=128;for(;y&Vu;)r[s++]=y&255|so,y>>>=7;return r[s]=y|0,ro.bytes=s-o+1,r}var Ju=cr,Gu=128,no=127;function cr(y,o){var s=0,o=o||0,a=0,u=o,g,v=y.length;do{if(u>=v)throw cr.bytes=0,new RangeError("Could not decode varint");g=y[u++],s+=a<28?(g&no)<<a:(g&no)*Math.pow(2,a),a+=7}while(g>=Gu);return cr.bytes=u-o,s}var Wu=Math.pow(2,7),Qu=Math.pow(2,14),Yu=Math.pow(2,21),Zu=Math.pow(2,28),Xu=Math.pow(2,35),el=Math.pow(2,42),tl=Math.pow(2,49),il=Math.pow(2,56),sl=Math.pow(2,63),rl=function(y){return y<Wu?1:y<Qu?2:y<Yu?3:y<Zu?4:y<Xu?5:y<el?6:y<tl?7:y<il?8:y<sl?9:10},nl={encode:Hu,decode:Ju,encodingLength:rl},oo=nl;const ao=(y,r,s=0)=>(oo.encode(y,r,s),r),co=y=>oo.encodingLength(y),hr=(y,r)=>{const s=r.byteLength,o=co(y),a=o+co(s),u=new Uint8Array(a+s);return ao(y,u,0),ao(s,u,o),u.set(r,a),new ol(y,s,r,u)};class ol{constructor(r,s,o,a){this.code=r,this.size=s,this.digest=o,this.bytes=a}}const ho=({name:y,code:r,encode:s})=>new al(y,r,s);class al{constructor(r,s,o){this.name=r,this.code=s,this.encode=o}digest(r){if(r instanceof Uint8Array){const s=this.encode(r);return s instanceof Uint8Array?hr(this.code,s):s.then(o=>hr(this.code,o))}else throw Error("Unknown type, must be binary type")}}const uo=y=>async r=>new Uint8Array(await crypto.subtle.digest(y,r)),cl=ho({name:"sha2-256",code:18,encode:uo("SHA-256")}),hl=ho({name:"sha2-512",code:19,encode:uo("SHA-512")});var ul=Object.freeze({__proto__:null,sha256:cl,sha512:hl});const lo=0,ll="identity",po=eo;var pl=Object.freeze({__proto__:null,identity:{code:lo,name:ll,encode:po,digest:y=>hr(lo,po(y))}});new TextEncoder,new TextDecoder;const go={...ou,...cu,...uu,...pu,...fu,...Su,...Ru,...Au,...$u,...Lu};({...ul,...pl});function dl(y=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(y):new Uint8Array(y)}function fo(y,r,s,o){return{name:y,prefix:r,encoder:{name:y,prefix:r,encode:s},decoder:{decode:o}}}const yo=fo("utf8","u",y=>"u"+new TextDecoder("utf8").decode(y),y=>new TextEncoder().encode(y.substring(1))),ur=fo("ascii","a",y=>{let r="a";for(let s=0;s<y.length;s++)r+=String.fromCharCode(y[s]);return r},y=>{y=y.substring(1);const r=dl(y.length);for(let s=0;s<y.length;s++)r[s]=y.charCodeAt(s);return r}),gl={utf8:yo,"utf-8":yo,hex:go.base16,latin1:ur,ascii:ur,binary:ur,...go};function fl(y,r="utf8"){const s=gl[r];if(!s)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(y,"utf8"):s.decoder.decode(`${s.prefix}${y}`)}const mo="wc",yl=2,lr="core",$t=`${mo}@2:${lr}:`,ml={name:lr,logger:"error"},vl={database:":memory:"},wl="crypto",vo="client_ed25519_seed",_l=k.ONE_DAY,bl="keychain",El="0.3",Il="messages",Pl="0.3",Sl=k.SIX_HOURS,Cl="publisher",wo="irn",xl="error",_o="wss://relay.walletconnect.com",bo="wss://relay.walletconnect.org",Rl="relayer",Te={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ql="_subscription",Ye={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Dl=k.ONE_SECOND,P_={database:":memory:"},Al="2.13.0",Ol=1e4,Fl="0.3",Nl="WALLETCONNECT_CLIENT_ID",gt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},S_=null,Tl="subscription",$l="0.3",kl=k.FIVE_SECONDS*1e3,Ml="pairing",jl="0.3",C_=null,Fi={wc_pairingDelete:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:k.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:k.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:k.ONE_DAY,prompt:!1,tag:0},res:{ttl:k.ONE_DAY,prompt:!1,tag:0}}},ui={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},at={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},zl="history",Ul="0.3",Ll="expirer",Ze={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Hl="0.3",x_=null,pr="verify-api",li="https://verify.walletconnect.com",dr="https://verify.walletconnect.org",Bl=[li,dr],Vl="echo",Kl="https://echo.walletconnect.com";class Jl{constructor(r,s){this.core=r,this.logger=s,this.keychain=new Map,this.name=bl,this.version=El,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){const o=await this.getKeyChain();typeof o<"u"&&(this.keychain=o),this.initialized=!0}},this.has=o=>(this.isInitialized(),this.keychain.has(o)),this.set=async(o,a)=>{this.isInitialized(),this.keychain.set(o,a),await this.persist()},this.get=o=>{this.isInitialized();const a=this.keychain.get(o);if(typeof a>"u"){const{message:u}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${o}`);throw new Error(u)}return a},this.del=async o=>{this.isInitialized(),this.keychain.delete(o),await this.persist()},this.core=r,this.logger=(0,ee.Ep)(s,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,(0,d.KCv)(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?(0,d.IPd)(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Gl{constructor(r,s,o){this.core=r,this.logger=s,this.name=wl,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=as.generateKeyPair(a);return as.encodeIss(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=(0,d.Au2)();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),g=as.generateKeyPair(u),v=(0,d.jdp)(),E=_l;return await as.signJWT(v,a,E,g)},this.generateSharedKey=(a,u,g)=>{this.isInitialized();const v=this.getPrivateKey(a),E=(0,d.m$A)(v,u);return this.setSymKey(E,g)},this.setSymKey=async(a,u)=>{this.isInitialized();const g=u||(0,d.YmJ)(a);return await this.keychain.set(g,a),g},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,g)=>{this.isInitialized();const v=(0,d.ENt)(g),E=(0,Xn.u)(u);if((0,d.Q8x)(v)){const N=v.senderPublicKey,M=v.receiverPublicKey;a=await this.generateSharedKey(N,M)}const x=this.getSymKey(a),{type:q,senderPublicKey:A}=v;return(0,d.HIp)({type:q,symKey:x,message:E,senderPublicKey:A})},this.decode=async(a,u,g)=>{this.isInitialized();const v=(0,d.Llj)(u,g);if((0,d.Q8x)(v)){const E=v.receiverPublicKey,x=v.senderPublicKey;a=await this.generateSharedKey(E,x)}try{const E=this.getSymKey(a),x=(0,d.peR)({symKey:E,encoded:u});return(0,Xn.D)(x)}catch(E){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(E)}},this.getPayloadType=a=>{const u=(0,d.vBi)(a);return(0,d.WGe)(u.type)},this.getPayloadSenderPublicKey=a=>{const u=(0,d.vBi)(a);return u.senderPublicKey?(0,Lh.BB)(u.senderPublicKey,d.AWt):void 0},this.core=r,this.logger=(0,ee.Ep)(s,this.name),this.keychain=o||new Jl(this.core,this.logger)}get context(){return(0,ee.Fd)(this.logger)}async setPrivateKey(r,s){return await this.keychain.set(r,s),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(vo)}catch{r=(0,d.jdp)(),await this.keychain.set(vo,r)}return fl(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Wl extends Oh{constructor(r,s){super(r,s),this.logger=r,this.core=s,this.messages=new Map,this.name=Il,this.version=Pl,this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const o=await this.getRelayerMessages();typeof o<"u"&&(this.messages=o),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(o){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(o)}finally{this.initialized=!0}}},this.set=async(o,a)=>{this.isInitialized();const u=(0,d.rjm)(a);let g=this.messages.get(o);return typeof g>"u"&&(g={}),typeof g[u]<"u"||(g[u]=a,this.messages.set(o,g),await this.persist()),u},this.get=o=>{this.isInitialized();let a=this.messages.get(o);return typeof a>"u"&&(a={}),a},this.has=(o,a)=>{this.isInitialized();const u=this.get(o),g=(0,d.rjm)(a);return typeof u[g]<"u"},this.del=async o=>{this.isInitialized(),this.messages.delete(o),await this.persist()},this.logger=(0,ee.Ep)(r,this.name),this.core=s}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,(0,d.KCv)(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?(0,d.IPd)(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Ql extends Fh{constructor(r,s){super(r,s),this.relayer=r,this.logger=s,this.events=new Et.EventEmitter,this.name=Cl,this.queue=new Map,this.publishTimeout=(0,k.toMiliseconds)(k.ONE_MINUTE),this.failedPublishTimeout=(0,k.toMiliseconds)(k.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(o,a,u)=>{var g;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:u}});const v=(u==null?void 0:u.ttl)||Sl,E=(0,d._HE)(u),x=(u==null?void 0:u.prompt)||!1,q=(u==null?void 0:u.tag)||0,A=(u==null?void 0:u.id)||(0,L.getBigIntRpcId)().toString(),N={topic:o,message:a,opts:{ttl:v,relay:E,prompt:x,tag:q,id:A}},M=`Failed to publish payload, please try again. id:${A} tag:${q}`,F=Date.now();let H,K=1;try{for(;H===void 0;){if(Date.now()-F>this.publishTimeout)throw new Error(M);this.logger.trace({id:A,attempts:K},`publisher.publish - attempt ${K}`),H=await await(0,d.hFY)(this.rpcPublish(o,a,v,E,x,q,A).catch(Y=>this.logger.warn(Y)),this.publishTimeout,M),K++,H||await new Promise(Y=>setTimeout(Y,this.failedPublishTimeout))}this.relayer.events.emit(Te.publish,N),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:A,topic:o,message:a,opts:u}})}catch(Y){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(Y),(g=u==null?void 0:u.internal)!=null&&g.throwOnFailedPublish)throw Y;this.queue.set(A,N)}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.relayer=r,this.logger=(0,ee.Ep)(s,this.name),this.registerEventListeners()}get context(){return(0,ee.Fd)(this.logger)}rpcPublish(r,s,o,a,u,g,v){var E,x,q,A;const N={method:(0,d.cOS)(a.protocol).publish,params:{topic:r,message:s,ttl:o,prompt:u,tag:g},id:v};return(0,d.o8e)((E=N.params)==null?void 0:E.prompt)&&((x=N.params)==null||delete x.prompt),(0,d.o8e)((q=N.params)==null?void 0:q.tag)&&((A=N.params)==null||delete A.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:s,message:o,opts:a}=r;await this.publish(s,o,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ai.Lx.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Te.connection_stalled);return}this.checkQueue()}),this.relayer.on(Te.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class Yl{constructor(){this.map=new Map,this.set=(r,s)=>{const o=this.get(r);this.exists(r,s)||this.map.set(r,[...o,s])},this.get=r=>this.map.get(r)||[],this.exists=(r,s)=>this.get(r).includes(s),this.delete=(r,s)=>{if(typeof s>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const o=this.get(r);if(!this.exists(r,s))return;const a=o.filter(u=>u!==s);if(!a.length){this.map.delete(r);return}this.map.set(r,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Zl=Object.defineProperty,Xl=Object.defineProperties,ep=Object.getOwnPropertyDescriptors,Eo=Object.getOwnPropertySymbols,tp=Object.prototype.hasOwnProperty,ip=Object.prototype.propertyIsEnumerable,Io=(y,r,s)=>r in y?Zl(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,Ni=(y,r)=>{for(var s in r||(r={}))tp.call(r,s)&&Io(y,s,r[s]);if(Eo)for(var s of Eo(r))ip.call(r,s)&&Io(y,s,r[s]);return y},gr=(y,r)=>Xl(y,ep(r));class sp extends $h{constructor(r,s){super(r,s),this.relayer=r,this.logger=s,this.subscriptions=new Map,this.topicMap=new Yl,this.events=new Et.EventEmitter,this.name=Tl,this.version=$l,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=$t,this.subscribeTimeout=(0,k.toMiliseconds)(k.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.pendingBatchMessages=[],this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const u=(0,d._HE)(a),g={topic:o,relay:u};this.pending.set(o,g);const v=await this.rpcSubscribe(o,u);return typeof v=="string"&&(this.onSubscribe(v,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}})),v}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(o,a.id,a):await this.unsubscribeByTopic(o,a)},this.isSubscribed=async o=>{if(this.topics.includes(o))return!0;const a=`${this.pendingSubscriptionWatchLabel}_${o}`;return await new Promise((u,g)=>{const v=new k.Watch;v.start(a);const E=setInterval(()=>{!this.pending.has(o)&&this.topics.includes(o)&&(clearInterval(E),v.stop(a),u(!0)),v.elapsed(a)>=kl&&(clearInterval(E),v.stop(a),g(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=(0,ee.Ep)(s,this.name),this.clientId=""}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,s){let o=!1;try{o=this.getSubscription(r).topic===s}catch{}return o}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,s){const o=this.topicMap.get(r);await Promise.all(o.map(async a=>await this.unsubscribeById(r,a,s)))}async unsubscribeById(r,s,o){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:s,opts:o}});try{const a=(0,d._HE)(o);await this.rpcUnsubscribe(r,s,a);const u=(0,d.D6H)("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,s,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:s,opts:o}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(r,s){const o={method:(0,d.cOS)(s.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await(0,d.hFY)(this.relayer.request(o).catch(a=>this.logger.warn(a)),this.subscribeTimeout)?(0,d.rjm)(r+this.clientId):null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Te.connection_stalled)}return null}async rpcBatchSubscribe(r){if(!r.length)return;const s=r[0].relay,o={method:(0,d.cOS)(s.protocol).batchSubscribe,params:{topics:r.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await(0,d.hFY)(this.relayer.request(o).catch(a=>this.logger.warn(a)),this.subscribeTimeout)}catch{this.relayer.events.emit(Te.connection_stalled)}}async rpcBatchFetchMessages(r){if(!r.length)return;const s=r[0].relay,o={method:(0,d.cOS)(s.protocol).batchFetchMessages,params:{topics:r.map(u=>u.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});let a;try{a=await await(0,d.hFY)(this.relayer.request(o).catch(u=>this.logger.warn(u)),this.subscribeTimeout)}catch{this.relayer.events.emit(Te.connection_stalled)}return a}rpcUnsubscribe(r,s,o){const a={method:(0,d.cOS)(o.protocol).unsubscribe,params:{topic:r,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(r,s){this.setSubscription(r,gr(Ni({},s),{id:r})),this.pending.delete(s.topic)}onBatchSubscribe(r){r.length&&r.forEach(s=>{this.setSubscription(s.id,Ni({},s)),this.pending.delete(s.topic)})}async onUnsubscribe(r,s,o){this.events.removeAllListeners(s),this.hasSubscription(s,r)&&this.deleteSubscription(s,o),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,s){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:s}),this.addSubscription(r,s)}addSubscription(r,s){this.subscriptions.set(r,Ni({},s)),this.topicMap.set(s.topic,r),this.events.emit(gt.created,s)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const s=this.subscriptions.get(r);if(!s){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s}deleteSubscription(r,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:s});const o=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(o.topic,r),this.events.emit(gt.deleted,gr(Ni({},o),{reason:s}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(gt.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<r;s++){const o=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchFetchMessages(o),await this.batchSubscribe(o)}}this.events.emit(gt.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:s}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const s=await this.rpcBatchSubscribe(r);(0,d.qt8)(s)&&this.onBatchSubscribe(s.map((o,a)=>gr(Ni({},r[a]),{id:o})))}async batchFetchMessages(r){if(!r.length)return;this.logger.trace(`Fetching batch messages for ${r.length} subscriptions`);const s=await this.rpcBatchFetchMessages(r);s&&s.messages&&(this.pendingBatchMessages=this.pendingBatchMessages.concat(s.messages))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const r=[];this.pending.forEach(s=>{r.push(s)}),await this.batchSubscribe(r),this.pendingBatchMessages.length&&(await this.relayer.handleBatchMessageEvents(this.pendingBatchMessages),this.pendingBatchMessages=[])}registerEventListeners(){this.relayer.core.heartbeat.on(Ai.Lx.pulse,async()=>{await this.checkPending()}),this.events.on(gt.created,async r=>{const s=gt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()}),this.events.on(gt.deleted,async r=>{const s=gt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const s=setInterval(()=>{this.restartInProgress||(clearInterval(s),r())},this.pollingInterval)})}}var rp=Object.defineProperty,Po=Object.getOwnPropertySymbols,np=Object.prototype.hasOwnProperty,op=Object.prototype.propertyIsEnumerable,So=(y,r,s)=>r in y?rp(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,ap=(y,r)=>{for(var s in r||(r={}))np.call(r,s)&&So(y,s,r[s]);if(Po)for(var s of Po(r))op.call(r,s)&&So(y,s,r[s]);return y};class cp extends Nh{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Et.EventEmitter,this.name=Rl,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=(0,k.toMiliseconds)(k.THIRTY_SECONDS+k.ONE_SECOND),this.request=async s=>{var o,a;this.logger.debug("Publishing Request Payload");const u=s.id||(0,L.getBigIntRpcId)().toString();await this.toEstablishConnection();try{const g=this.provider.request(s);this.requestsInFlight.set(u,{promise:g,request:s}),this.logger.trace({id:u,method:s.method,topic:(o=s.params)==null?void 0:o.topic},"relayer.request - attempt to publish...");const v=await new Promise(async(E,x)=>{const q=()=>{x(new Error(`relayer.request - publish interrupted, id: ${u}`))};this.provider.on(Ye.disconnect,q);const A=await g;this.provider.off(Ye.disconnect,q),E(A)});return this.logger.trace({id:u,method:s.method,topic:(a=s.params)==null?void 0:a.topic},"relayer.request - published"),v}catch(g){throw this.logger.debug(`Failed to Publish Request: ${u}`),g}finally{this.requestsInFlight.delete(u)}},this.resetPingTimeout=()=>{if((0,d.UGU)())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var s,o,a;(a=(o=(s=this.provider)==null?void 0:s.connection)==null?void 0:o.socket)==null||a.terminate()},this.heartBeatTimeout)}catch(s){this.logger.warn(s)}},this.onPayloadHandler=s=>{this.onProviderPayload(s),this.resetPingTimeout()},this.onConnectHandler=()=>{this.startPingTimeout(),this.events.emit(Te.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=s=>{this.logger.error(s),this.events.emit(Te.error,s),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Ye.payload,this.onPayloadHandler),this.provider.on(Ye.connect,this.onConnectHandler),this.provider.on(Ye.disconnect,this.onDisconnectHandler),this.provider.on(Ye.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?(0,ee.Ep)(r.logger,this.name):(0,ee.gw)((0,ee.jI)({level:r.logger||xl})),this.messages=new Wl(this.logger,r.core),this.subscriber=new sp(this,this.logger),this.publisher=new Ql(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||_o,this.projectId=r.projectId,this.bundleId=(0,d.X_B)(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${bo}...`),await this.restartTransport(bo)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&this.subscriber.pending.size===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Ol)}get context(){return(0,ee.Fd)(this.logger)}get connected(){var r,s,o;return((o=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null?void 0:o.readyState)===1}get connecting(){var r,s,o;return((o=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null?void 0:o.readyState)===0}async publish(r,s,o){this.isInitialized(),await this.publisher.publish(r,s,o),await this.recordMessageEvent({topic:r,message:s,publishedAt:Date.now()})}async subscribe(r,s){var o;this.isInitialized();let a=((o=this.subscriber.topicMap.get(r))==null?void 0:o[0])||"",u;const g=v=>{v.topic===r&&(this.subscriber.off(gt.created,g),u())};return await Promise.all([new Promise(v=>{u=v,this.subscriber.on(gt.created,g)}),new Promise(async v=>{a=await this.subscriber.subscribe(r,s)||a,v()})]),a}async unsubscribe(r,s){this.isInitialized(),await this.subscriber.unsubscribe(r,s)}on(r,s){this.events.on(r,s)}once(r,s){this.events.once(r,s)}off(r,s){this.events.off(r,s)}removeListener(r,s){this.events.removeListener(r,s)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(r=>r.promise))}catch(r){this.logger.warn(r)}this.hasExperiencedNetworkDisruption||this.connected?await(0,d.hFY)(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(r){await this.confirmOnlineStateOrThrow(),r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportDisconnect()),await this.createProvider(),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(s,o)=>{const a=()=>{this.provider.off(Ye.disconnect,a),o(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(Ye.disconnect,a),await(0,d.hFY)(this.provider.connect(),(0,k.toMiliseconds)(k.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(u=>{o(u)}),await this.subscriber.start(),this.hasExperiencedNetworkDisruption=!1,s()})}catch(s){this.logger.error(s);const o=s;if(this.hasExperiencedNetworkDisruption=!0,!this.isConnectionStalled(o.message))throw s}finally{this.connectionAttemptInProgress=!1}}async restartTransport(r){this.connectionAttemptInProgress||(this.relayUrl=r||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await(0,d.Ggh)())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(r){if((r==null?void 0:r.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const s=r.sort((o,a)=>o.publishedAt-a.publishedAt);this.logger.trace(`Batch of ${s.length} message events sorted`);for(const o of s)try{await this.onMessageEvent(o)}catch(a){this.logger.warn(a)}this.logger.trace(`Batch of ${s.length} message events processed`)}startPingTimeout(){var r,s,o,a,u;if((0,d.UGU)())try{(s=(r=this.provider)==null?void 0:r.connection)!=null&&s.socket&&((u=(a=(o=this.provider)==null?void 0:o.connection)==null?void 0:a.socket)==null||u.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(g){this.logger.warn(g)}}isConnectionStalled(r){return this.staleConnectionErrors.some(s=>r.includes(s))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new It.r(new Hh.Z((0,d.$0m)({sdkVersion:Al,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:s,message:o}=r;await this.messages.set(s,o)}async shouldIgnoreMessageEvent(r){const{topic:s,message:o}=r;if(!o||o.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${o}`),!0;if(!await this.subscriber.isSubscribed(s))return this.logger.debug(`Ignoring message for non-subscribed topic ${s}`),!0;const a=this.messages.has(s,o);return a&&this.logger.debug(`Ignoring duplicate message: ${o}`),a}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),(0,L.isJsonRpcRequest)(r)){if(!r.method.endsWith(ql))return;const s=r.params,{topic:o,message:a,publishedAt:u}=s.data,g={topic:o,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ap({type:"event",event:s.id},g)),this.events.emit(s.id,g),await this.acknowledgePayload(r),await this.onMessageEvent(g)}else(0,L.isJsonRpcResponse)(r)&&this.events.emit(Te.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Te.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const s=(0,L.formatJsonRpcResult)(r.id,!0);await this.provider.connection.send(s)}unregisterProviderListeners(){this.provider.off(Ye.payload,this.onPayloadHandler),this.provider.off(Ye.connect,this.onConnectHandler),this.provider.off(Ye.disconnect,this.onDisconnectHandler),this.provider.off(Ye.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let r=await(0,d.Ggh)();(0,d.uwg)(async s=>{r!==s&&(r=s,s?await this.restartTransport().catch(o=>this.logger.error(o)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.requestsInFlight.clear(),clearTimeout(this.pingTimeout),this.events.emit(Te.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&setTimeout(async()=>{await this.transportOpen().catch(r=>this.logger.error(r))},(0,k.toMiliseconds)(Dl))}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(r=>{const s=setInterval(()=>{this.connected&&(clearInterval(s),r())},this.connectionStatusPollingInterval)}),await this.transportOpen())}}var hp=Object.defineProperty,Co=Object.getOwnPropertySymbols,up=Object.prototype.hasOwnProperty,lp=Object.prototype.propertyIsEnumerable,xo=(y,r,s)=>r in y?hp(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,Ro=(y,r)=>{for(var s in r||(r={}))up.call(r,s)&&xo(y,s,r[s]);if(Co)for(var s of Co(r))lp.call(r,s)&&xo(y,s,r[s]);return y};class Wt extends Th{constructor(r,s,o,a=$t,u=void 0){super(r,s,o,a),this.core=r,this.logger=s,this.name=o,this.map=new Map,this.version=Fl,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!(0,d.o8e)(g)?this.map.set(this.getKey(g),g):(0,d.xWS)(g)?this.map.set(g.id,g):(0,d.h1R)(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,v)=>{this.isInitialized(),this.map.has(g)?await this.update(g,v):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:v}),this.map.set(g,v),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(v=>Object.keys(g).every(E=>Vh()(v[E],g[E]))):this.values),this.update=async(g,v)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:v});const E=Ro(Ro({},this.getData(g)),v);this.map.set(g,E),await this.persist()},this.delete=async(g,v)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:v}),this.map.delete(g),this.addToRecentlyDeleted(g),await this.persist())},this.logger=(0,ee.Ep)(s,this.name),this.storagePrefix=a,this.getKey=u}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(r){this.recentlyDeleted.push(r),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const s=this.map.get(r);if(!s){if(this.recentlyDeleted.includes(r)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${r}`);throw this.logger.error(a),new Error(a)}const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(o),new Error(o)}return s}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:s}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class pp{constructor(r,s){this.core=r,this.logger=s,this.name=Ml,this.version=jl,this.events=new(ar()),this.initialized=!1,this.storagePrefix=$t,this.ignoredPayloadTypes=[d.rVF],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:o})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...o])]},this.create=async o=>{this.isInitialized();const a=(0,d.jdp)(),u=await this.core.crypto.setSymKey(a),g=(0,d.gn4)(k.FIVE_MINUTES),v={protocol:wo},E={topic:u,expiry:g,relay:v,active:!1},x=(0,d.Bvr)({protocol:this.core.protocol,version:this.core.version,topic:u,symKey:a,relay:v,expiryTimestamp:g,methods:o==null?void 0:o.methods});return this.core.expirer.set(u,g),await this.pairings.set(u,E),await this.core.relayer.subscribe(u),{topic:u,uri:x}},this.pair=async o=>{this.isInitialized(),this.isValidPair(o);const{topic:a,symKey:u,relay:g,expiryTimestamp:v,methods:E}=(0,d.heJ)(o.uri);let x;if(this.pairings.keys.includes(a)&&(x=this.pairings.get(a),x.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const q=v||(0,d.gn4)(k.FIVE_MINUTES),A={topic:a,relay:g,expiry:q,active:!1,methods:E};return this.core.expirer.set(a,q),await this.pairings.set(a,A),o.activatePairing&&await this.activate({topic:a}),this.events.emit(ui.create,A),this.core.crypto.keychain.has(a)||await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:g}),A},this.activate=async({topic:o})=>{this.isInitialized();const a=(0,d.gn4)(k.THIRTY_DAYS);this.core.expirer.set(o,a),await this.pairings.update(o,{active:!0,expiry:a})},this.ping=async o=>{this.isInitialized(),await this.isValidPing(o);const{topic:a}=o;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:g,resolve:v,reject:E}=(0,d.H1S)();this.events.once((0,d.E0T)("pairing_ping",u),({error:x})=>{x?E(x):v()}),await g()}},this.updateExpiry=async({topic:o,expiry:a})=>{this.isInitialized(),await this.pairings.update(o,{expiry:a})},this.updateMetadata=async({topic:o,metadata:a})=>{this.isInitialized(),await this.pairings.update(o,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async o=>{this.isInitialized(),await this.isValidDisconnect(o);const{topic:a}=o;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",(0,d.D6H)("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(o,a,u)=>{const g=(0,L.formatJsonRpcRequest)(a,u),v=await this.core.crypto.encode(o,g),E=Fi[a].req;return this.core.history.set(o,g),this.core.relayer.publish(o,v,E),g.id},this.sendResult=async(o,a,u)=>{const g=(0,L.formatJsonRpcResult)(o,u),v=await this.core.crypto.encode(a,g),E=await this.core.history.get(a,o),x=Fi[E.request.method].res;await this.core.relayer.publish(a,v,x),await this.core.history.resolve(g)},this.sendError=async(o,a,u)=>{const g=(0,L.formatJsonRpcError)(o,u),v=await this.core.crypto.encode(a,g),E=await this.core.history.get(a,o),x=Fi[E.request.method]?Fi[E.request.method].res:Fi.unregistered_method.res;await this.core.relayer.publish(a,v,x),await this.core.history.resolve(g)},this.deletePairing=async(o,a)=>{await this.core.relayer.unsubscribe(o),await Promise.all([this.pairings.delete(o,(0,d.D6H)("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(o),a?Promise.resolve():this.core.expirer.del(o)])},this.cleanup=async()=>{const o=this.pairings.getAll().filter(a=>(0,d.BwD)(a.expiry));await Promise.all(o.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=o=>{const{topic:a,payload:u}=o;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async o=>{const{topic:a,payload:u}=o,g=(await this.core.history.get(a,u.id)).request.method;switch(g){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(o,a)=>{const{id:u}=a;try{this.isValidPing({topic:o}),await this.sendResult(u,o,!0),this.events.emit(ui.ping,{id:u,topic:o})}catch(g){await this.sendError(u,o,g),this.logger.error(g)}},this.onPairingPingResponse=(o,a)=>{const{id:u}=a;setTimeout(()=>{(0,L.isJsonRpcResult)(a)?this.events.emit((0,d.E0T)("pairing_ping",u),{}):(0,L.isJsonRpcError)(a)&&this.events.emit((0,d.E0T)("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(o,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:o}),await this.deletePairing(o),this.events.emit(ui.delete,{id:u,topic:o})}catch(g){await this.sendError(u,o,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(o,a)=>{const{id:u,method:g}=a;try{if(this.registeredMethods.includes(g))return;const v=(0,d.D6H)("WC_METHOD_UNSUPPORTED",g);await this.sendError(u,o,v),this.logger.error(v)}catch(v){await this.sendError(u,o,v),this.logger.error(v)}},this.onUnknownRpcMethodResponse=o=>{this.registeredMethods.includes(o)||this.logger.error((0,d.D6H)("WC_METHOD_UNSUPPORTED",o))},this.isValidPair=o=>{var a;if(!(0,d.EJd)(o)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`pair() params: ${o}`);throw new Error(g)}if(!(0,d.jvJ)(o.uri)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`pair() uri: ${o.uri}`);throw new Error(g)}const u=(0,d.heJ)(o.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(g)}if(!(u!=null&&u.symKey)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(g)}if(u!=null&&u.expiryTimestamp&&(0,k.toMiliseconds)(u==null?void 0:u.expiryTimestamp)<Date.now()){const{message:g}=(0,d.kCb)("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(g)}},this.isValidPing=async o=>{if(!(0,d.EJd)(o)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(u)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidDisconnect=async o=>{if(!(0,d.EJd)(o)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(u)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async o=>{if(!(0,d.M_r)(o,!1)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!this.pairings.keys.includes(o)){const{message:a}=(0,d.kCb)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if((0,d.BwD)(this.pairings.get(o).expiry)){await this.deletePairing(o);const{message:a}=(0,d.kCb)("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}},this.core=r,this.logger=(0,ee.Ep)(s,this.name),this.pairings=new Wt(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,ee.Fd)(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Te.message,async r=>{const{topic:s,message:o}=r;if(!this.pairings.keys.includes(s)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(o)))return;const a=await this.core.crypto.decode(s,o);try{(0,L.isJsonRpcRequest)(a)?(this.core.history.set(s,a),this.onRelayEventRequest({topic:s,payload:a})):(0,L.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:s,payload:a}),this.core.history.delete(s,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(Ze.expired,async r=>{const{topic:s}=(0,d.iPz)(r.target);s&&this.pairings.keys.includes(s)&&(await this.deletePairing(s,!0),this.events.emit(ui.expire,{topic:s}))})}}class dp extends Ah{constructor(r,s){super(r,s),this.core=r,this.logger=s,this.records=new Map,this.events=new Et.EventEmitter,this.name=zl,this.version=Ul,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.records.set(o.id,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(o,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:o,request:a,chainId:u}),this.records.has(a.id))return;const g={id:a.id,topic:o,request:{method:a.method,params:a.params||null},chainId:u,expiry:(0,d.gn4)(k.THIRTY_DAYS)};this.records.set(g.id,g),this.persist(),this.events.emit(at.created,g)},this.resolve=async o=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:o}),!this.records.has(o.id))return;const a=await this.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,L.isJsonRpcError)(o)?{error:o.error}:{result:o.result},this.records.set(a.id,a),this.persist(),this.events.emit(at.updated,a))},this.get=async(o,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:o,id:a}),await this.getRecord(a)),this.delete=(o,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===o){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(at.deleted,u)}}),this.persist()},this.exists=async(o,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===o:!1),this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,ee.Ep)(s,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;const o={topic:s.topic,request:(0,L.formatJsonRpcRequest)(s.request.method,s.request.params,s.id),chainId:s.chainId};return r.push(o)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const s=this.records.get(r);if(!s){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(at.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:s}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(at.created,r=>{const s=at.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r})}),this.events.on(at.updated,r=>{const s=at.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r})}),this.events.on(at.deleted,r=>{const s=at.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r})}),this.core.heartbeat.on(Ai.Lx.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let r=!1;this.records.forEach(s=>{(0,k.toMiliseconds)(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.records.delete(s.id),this.events.emit(at.deleted,s,!1),r=!0)}),r&&this.persist()}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class gp extends kh{constructor(r,s){super(r,s),this.core=r,this.logger=s,this.expirations=new Map,this.events=new Et.EventEmitter,this.name=Ll,this.version=Hl,this.cached=[],this.initialized=!1,this.storagePrefix=$t,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.expirations.set(o.target,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=o=>{try{const a=this.formatTarget(o);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(o,a)=>{this.isInitialized();const u=this.formatTarget(o),g={target:u,expiry:a};this.expirations.set(u,g),this.checkExpiry(u,g),this.events.emit(Ze.created,{target:u,expiration:g})},this.get=o=>{this.isInitialized();const a=this.formatTarget(o);return this.getExpiration(a)},this.del=o=>{if(this.isInitialized(),this.has(o)){const a=this.formatTarget(o),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ze.deleted,{target:a,expiration:u})}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,ee.Ep)(s,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return(0,d.Z42)(r);if(typeof r=="number")return(0,d.GqV)(r);const{message:s}=(0,d.kCb)("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(s)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ze.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:s}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const s=this.expirations.get(r);if(!s){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.warn(o),new Error(o)}return s}checkExpiry(r,s){const{expiry:o}=s;(0,k.toMiliseconds)(o)-Date.now()<=0&&this.expire(r,s)}expire(r,s){this.expirations.delete(r),this.events.emit(Ze.expired,{target:r,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,s)=>this.checkExpiry(s,r))}registerEventListeners(){this.core.heartbeat.on(Ai.Lx.pulse,()=>this.checkExpirations()),this.events.on(Ze.created,r=>{const s=Ze.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()}),this.events.on(Ze.expired,r=>{const s=Ze.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()}),this.events.on(Ze.deleted,r=>{const s=Ze.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class fp extends Mh{constructor(r,s){super(r,s),this.projectId=r,this.logger=s,this.name=pr,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async o=>{if(this.verifyDisabled||(0,d.b$m)()||!(0,d.jUY)())return;const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=dr;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async o=>{this.initialized?this.sendPost(o.attestationId):(this.addToQueue(o.attestationId),await this.init())},this.resolve=async o=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);let u;try{u=await this.fetchAttestation(o.attestationId,a)}catch(g){this.logger.info(`failed to resolve attestation: ${o.attestationId} from url: ${a}`),this.logger.info(g),u=await this.fetchAttestation(o.attestationId,dr)}return u},this.fetchAttestation=async(o,a)=>{this.logger.info(`resolving attestation: ${o} from url: ${a}`);const u=this.startAbortTimer(k.ONE_SECOND*2),g=await fetch(`${a}/attestation/${o}`,{signal:this.abortController.signal});return clearTimeout(u),g.status===200?await g.json():void 0},this.addToQueue=o=>{this.queue.push(o)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(o=>this.sendPost(o)),this.queue=[])},this.sendPost=o=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(o,"*"),this.logger.info(`postMessage sent: ${o} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let o;const a=u=>{u.data==="verify_ready"&&(this.onInit(),window.removeEventListener("message",a),o())};await Promise.race([new Promise(u=>{const g=document.getElementById(pr);if(g)return this.iframe=g,this.onInit(),u();window.addEventListener("message",a);const v=document.createElement("iframe");v.id=pr,v.src=`${this.verifyUrl}/${this.projectId}`,v.style.display="none",document.body.append(v),this.iframe=v,o=u}),new Promise((u,g)=>setTimeout(()=>{window.removeEventListener("message",a),g("verify iframe load timeout")},(0,k.toMiliseconds)(k.FIVE_SECONDS)))])},this.onInit=()=>{this.initialized=!0,this.processQueue()},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=o=>{let a=o||li;return Bl.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${li}`),a=li),a},this.logger=(0,ee.Ep)(s,this.name),this.verifyUrl=li,this.abortController=new AbortController,this.isDevEnv=(0,d.UGU)()&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST}get context(){return(0,ee.Fd)(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,k.toMiliseconds)(r))}}class yp extends jh{constructor(r,s){super(r,s),this.projectId=r,this.logger=s,this.context=Vl,this.registerDeviceToken=async o=>{const{clientId:a,token:u,notificationType:g,enableEncrypted:v=!1}=o,E=`${Kl}/${this.projectId}/clients`;await Jh()(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:g,token:u,always_raw:v})})},this.logger=(0,ee.Ep)(s,this.context)}}var mp=Object.defineProperty,qo=Object.getOwnPropertySymbols,vp=Object.prototype.hasOwnProperty,wp=Object.prototype.propertyIsEnumerable,Do=(y,r,s)=>r in y?mp(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,Ao=(y,r)=>{for(var s in r||(r={}))vp.call(r,s)&&Do(y,s,r[s]);if(qo)for(var s of qo(r))wp.call(r,s)&&Do(y,s,r[s]);return y};class fr extends Dh{constructor(r){var s;super(r),this.protocol=mo,this.version=yl,this.name=lr,this.events=new Et.EventEmitter,this.initialized=!1,this.on=(g,v)=>this.events.on(g,v),this.once=(g,v)=>this.events.once(g,v),this.off=(g,v)=>this.events.off(g,v),this.removeListener=(g,v)=>this.events.removeListener(g,v),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||_o,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const o=(0,ee.jI)({level:typeof(r==null?void 0:r.logger)=="string"&&r.logger?r.logger:ml.logger}),{logger:a,chunkLoggerController:u}=(0,ee.Rt)({opts:o,maxSizeInBytes:r==null?void 0:r.maxLogBlobSizeInBytes,loggerOverride:r==null?void 0:r.logger});this.logChunkController=u,(s=this.logChunkController)!=null&&s.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var g,v;(g=this.logChunkController)!=null&&g.downloadLogsBlobInBrowser&&((v=this.logChunkController)==null||v.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,ee.Ep)(a,this.name),this.heartbeat=new Ai.C$,this.crypto=new Gl(this,this.logger,r==null?void 0:r.keychain),this.history=new dp(this,this.logger),this.expirer=new gp(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new qh.Z(Ao(Ao({},vl),r==null?void 0:r.storageOptions)),this.relayer=new cp({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new pp(this,this.logger),this.verify=new fp(this.projectId||"",this.logger),this.echoClient=new yp(this.projectId||"",this.logger)}static async init(r){const s=new fr(r);await s.initialize();const o=await s.crypto.getClientId();return await s.storage.setItem(Nl,o),s}get context(){return(0,ee.Fd)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var r;return(r=this.logChunkController)==null?void 0:r.logsToBlob({clientId:await this.crypto.getClientId()})}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const _p=fr,Oo="wc",Fo=2,No="client",yr=`${Oo}@${Fo}:${No}:`,mr={name:No,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},R_={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire"},q_={database:":memory:"},To="WALLETCONNECT_DEEPLINK_CHOICE",D_={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},A_="history",O_="0.3",bp="proposal",F_=null,$o="Proposal expired",Ep="session",pi=k.SEVEN_DAYS,Ip="engine",Ue={wc_sessionPropose:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1104},res:{ttl:k.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1106},res:{ttl:k.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:k.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:k.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1112},res:{ttl:k.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:k.ONE_DAY,prompt:!1,tag:1114},res:{ttl:k.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:k.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:k.ONE_HOUR,prompt:!1,tag:1117}}},vr={min:k.FIVE_MINUTES,max:k.SEVEN_DAYS},Pt={idle:"IDLE",active:"ACTIVE"},Pp="request",Sp=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"],Cp="wc",N_=1.5,xp="auth",Rp="authKeys",qp="pairingTopics",Dp="requests",hs=`${Cp}@${1.5}:${xp}:`,us=`${hs}:PUB_KEY`;var Ap=Object.defineProperty,Op=Object.defineProperties,Fp=Object.getOwnPropertyDescriptors,ko=Object.getOwnPropertySymbols,Np=Object.prototype.hasOwnProperty,Tp=Object.prototype.propertyIsEnumerable,Mo=(y,r,s)=>r in y?Ap(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,be=(y,r)=>{for(var s in r||(r={}))Np.call(r,s)&&Mo(y,s,r[s]);if(ko)for(var s of ko(r))Tp.call(r,s)&&Mo(y,s,r[s]);return y},Qt=(y,r)=>Op(y,Fp(r));class $p extends Uh{constructor(r){super(r),this.name=Ip,this.events=new(ar()),this.initialized=!1,this.requestQueue={state:Pt.idle,queue:[]},this.sessionRequestQueue={state:Pt.idle,queue:[]},this.requestQueueDelay=k.ONE_SECOND,this.expectedPairingMethodMap=new Map,this.recentlyDeletedMap=new Map,this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ue)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,k.toMiliseconds)(this.requestQueueDelay)))},this.connect=async s=>{await this.isInitialized();const o=Qt(be({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});await this.isValidConnect(o);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:g,sessionProperties:v,relays:E}=o;let x=a,q,A=!1;try{x&&(A=this.client.core.pairing.pairings.get(x).active)}catch(re){throw this.client.logger.error(`connect() -> pairing.get(${x}) failed`),re}if(!x||!A){const{topic:re,uri:se}=await this.client.core.pairing.create();x=re,q=se}if(!x){const{message:re}=(0,d.kCb)("NO_MATCHING_KEY",`connect() pairing topic: ${x}`);throw new Error(re)}const N=await this.client.core.crypto.generateKeyPair(),M=Ue.wc_sessionPropose.req.ttl||k.FIVE_MINUTES,F=(0,d.gn4)(M),H=be({requiredNamespaces:u,optionalNamespaces:g,relays:E??[{protocol:wo}],proposer:{publicKey:N,metadata:this.client.metadata},expiryTimestamp:F},v&&{sessionProperties:v}),{reject:K,resolve:Y,done:ae}=(0,d.H1S)(M,$o);this.events.once((0,d.E0T)("session_connect"),async({error:re,session:se})=>{if(re)K(re);else if(se){se.self.publicKey=N;const _e=Qt(be({},se),{requiredNamespaces:H.requiredNamespaces,optionalNamespaces:H.optionalNamespaces});await this.client.session.set(se.topic,_e),await this.setExpiry(se.topic,se.expiry),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:se.peer.metadata}),Y(_e)}});const ie=await this.sendRequest({topic:x,method:"wc_sessionPropose",params:H,throwOnFailedPublish:!0});return await this.setProposal(ie,be({id:ie},H)),{uri:q,approval:ae}},this.pair=async s=>{await this.isInitialized();try{return await this.client.core.pairing.pair(s)}catch(o){throw this.client.logger.error("pair() failed"),o}},this.approve=async s=>{await this.isInitialized();try{await this.isValidApprove(s)}catch(ae){throw this.client.logger.error("approve() -> isValidApprove() failed"),ae}const{id:o,relayProtocol:a,namespaces:u,sessionProperties:g,sessionConfig:v}=s;let E;try{E=this.client.proposal.get(o)}catch(ae){throw this.client.logger.error(`approve() -> proposal.get(${o}) failed`),ae}let{pairingTopic:x,proposer:q,requiredNamespaces:A,optionalNamespaces:N}=E;x=x||"";const M=await this.client.core.crypto.generateKeyPair(),F=q.publicKey,H=await this.client.core.crypto.generateSharedKey(M,F),K=be(be({relay:{protocol:a??"irn"},namespaces:u,pairingTopic:x,controller:{publicKey:M,metadata:this.client.metadata},expiry:(0,d.gn4)(pi)},g&&{sessionProperties:g}),v&&{sessionConfig:v});await this.client.core.relayer.subscribe(H);const Y=Qt(be({},K),{topic:H,requiredNamespaces:A,optionalNamespaces:N,pairingTopic:x,acknowledged:!1,self:K.controller,peer:{publicKey:q.publicKey,metadata:q.metadata},controller:M});await this.client.session.set(H,Y);try{await this.sendResult({id:o,topic:x,result:{relay:{protocol:a??"irn"},responderPublicKey:M},throwOnFailedPublish:!0}),await this.sendRequest({topic:H,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0})}catch(ae){throw this.client.logger.error(ae),this.client.session.delete(H,(0,d.D6H)("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(H),ae}return await this.client.core.pairing.updateMetadata({topic:x,metadata:q.metadata}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:x}),await this.setExpiry(H,(0,d.gn4)(pi)),{topic:H,acknowledged:()=>new Promise(ae=>setTimeout(()=>ae(this.client.session.get(H)),500))}},this.reject=async s=>{await this.isInitialized();try{await this.isValidReject(s)}catch(g){throw this.client.logger.error("reject() -> isValidReject() failed"),g}const{id:o,reason:a}=s;let u;try{u=this.client.proposal.get(o).pairingTopic}catch(g){throw this.client.logger.error(`reject() -> proposal.get(${o}) failed`),g}u&&(await this.sendError({id:o,topic:u,error:a}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED")))},this.update=async s=>{await this.isInitialized();try{await this.isValidUpdate(s)}catch(A){throw this.client.logger.error("update() -> isValidUpdate() failed"),A}const{topic:o,namespaces:a}=s,{done:u,resolve:g,reject:v}=(0,d.H1S)(),E=(0,L.payloadId)(),x=(0,L.getBigIntRpcId)().toString(),q=this.client.session.get(o).namespaces;return this.events.once((0,d.E0T)("session_update",E),({error:A})=>{A?v(A):g()}),await this.client.session.update(o,{namespaces:a}),await this.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a},throwOnFailedPublish:!0,clientRpcId:E,relayRpcId:x}).catch(A=>{this.client.logger.error(A),this.client.session.update(o,{namespaces:q}),v(A)}),{acknowledged:u}},this.extend=async s=>{await this.isInitialized();try{await this.isValidExtend(s)}catch(E){throw this.client.logger.error("extend() -> isValidExtend() failed"),E}const{topic:o}=s,a=(0,L.payloadId)(),{done:u,resolve:g,reject:v}=(0,d.H1S)();return this.events.once((0,d.E0T)("session_extend",a),({error:E})=>{E?v(E):g()}),await this.setExpiry(o,(0,d.gn4)(pi)),this.sendRequest({topic:o,method:"wc_sessionExtend",params:{},clientRpcId:a,throwOnFailedPublish:!0}).catch(E=>{v(E)}),{acknowledged:u}},this.request=async s=>{await this.isInitialized();try{await this.isValidRequest(s)}catch(M){throw this.client.logger.error("request() -> isValidRequest() failed"),M}const{chainId:o,request:a,topic:u,expiry:g=Ue.wc_sessionRequest.req.ttl}=s,v=this.client.session.get(u),E=(0,L.payloadId)(),x=(0,L.getBigIntRpcId)().toString(),{done:q,resolve:A,reject:N}=(0,d.H1S)(g,"Request expired. Please try again.");return this.events.once((0,d.E0T)("session_request",E),({error:M,result:F})=>{M?N(M):A(F)}),await Promise.all([new Promise(async M=>{await this.sendRequest({clientRpcId:E,relayRpcId:x,topic:u,method:"wc_sessionRequest",params:{request:Qt(be({},a),{expiryTimestamp:(0,d.gn4)(g)}),chainId:o},expiry:g,throwOnFailedPublish:!0}).catch(F=>N(F)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:o,id:E}),M()}),new Promise(async M=>{var F;if(!((F=v.sessionConfig)!=null&&F.disableDeepLink)){const H=await(0,d.bW6)(this.client.core.storage,To);(0,d.HhN)({id:E,topic:u,wcDeepLink:H})}M()}),q()]).then(M=>M[2])},this.respond=async s=>{await this.isInitialized(),await this.isValidRespond(s);const{topic:o,response:a}=s,{id:u}=a;(0,L.isJsonRpcResult)(a)?await this.sendResult({id:u,topic:o,result:a.result,throwOnFailedPublish:!0}):(0,L.isJsonRpcError)(a)&&await this.sendError({id:u,topic:o,error:a.error}),this.cleanupAfterResponse(s)},this.ping=async s=>{await this.isInitialized();try{await this.isValidPing(s)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}const{topic:o}=s;if(this.client.session.keys.includes(o)){const a=(0,L.payloadId)(),u=(0,L.getBigIntRpcId)().toString(),{done:g,resolve:v,reject:E}=(0,d.H1S)();this.events.once((0,d.E0T)("session_ping",a),({error:x})=>{x?E(x):v()}),await Promise.all([this.sendRequest({topic:o,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:u}),g()])}else this.client.core.pairing.pairings.keys.includes(o)&&await this.client.core.pairing.ping({topic:o})},this.emit=async s=>{await this.isInitialized(),await this.isValidEmit(s);const{topic:o,event:a,chainId:u}=s,g=(0,L.getBigIntRpcId)().toString();await this.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:u},throwOnFailedPublish:!0,relayRpcId:g})},this.disconnect=async s=>{await this.isInitialized(),await this.isValidDisconnect(s);const{topic:o}=s;if(this.client.session.keys.includes(o))await this.sendRequest({topic:o,method:"wc_sessionDelete",params:(0,d.D6H)("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:o,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(o))await this.client.core.pairing.disconnect({topic:o});else{const{message:a}=(0,d.kCb)("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}},this.find=s=>(this.isInitialized(),this.client.session.getAll().filter(o=>(0,d.Ih8)(o,s))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.authenticate=async s=>{this.isInitialized(),this.isValidAuthenticate(s);const{chains:o,statement:a="",uri:u,domain:g,nonce:v,type:E,exp:x,nbf:q,methods:A=[],expiry:N}=s,M=[...s.resources||[]],{topic:F,uri:H}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"]});this.client.logger.info({message:"Generated new pairing",pairing:{topic:F,uri:H}});const K=await this.client.core.crypto.generateKeyPair(),Y=(0,d.YmJ)(K);if(await Promise.all([this.client.auth.authKeys.set(us,{responseTopic:Y,publicKey:K}),this.client.auth.pairingTopics.set(Y,{topic:Y,pairingTopic:F})]),await this.client.core.relayer.subscribe(Y),this.client.logger.info(`sending request to new pairing topic: ${F}`),A.length>0){const{namespace:He}=(0,d.DQe)(o[0]);let Se=(0,d.IkP)(He,"request",A);(0,d.hA9)(M)&&(Se=(0,d.qJM)(Se,M.pop())),M.push(Se)}const ae=N&&N>Ue.wc_sessionAuthenticate.req.ttl?N:Ue.wc_sessionAuthenticate.req.ttl,ie={authPayload:{type:E??"caip122",chains:o,statement:a,aud:u,domain:g,version:"1",nonce:v,iat:new Date().toISOString(),exp:x,nbf:q,resources:M},requester:{publicKey:K,metadata:this.client.metadata},expiryTimestamp:(0,d.gn4)(ae)},re={eip155:{chains:o,methods:[...new Set(["personal_sign",...A])],events:["chainChanged","accountsChanged"]}},se={requiredNamespaces:{},optionalNamespaces:re,relays:[{protocol:"irn"}],proposer:{publicKey:K,metadata:this.client.metadata},expiryTimestamp:(0,d.gn4)(Ue.wc_sessionPropose.req.ttl)},{done:_e,resolve:ge,reject:Ee}=(0,d.H1S)(ae,"Request expired"),Le=async({error:He,session:Se})=>{if(this.events.off((0,d.E0T)("session_request",jt),$i),He)Ee(He);else if(Se){Se.self.publicKey=K,await this.client.session.set(Se.topic,Se),await this.setExpiry(Se.topic,Se.expiry),F&&await this.client.core.pairing.updateMetadata({topic:F,metadata:Se.peer.metadata});const Xt=this.client.session.get(Se.topic);await this.deleteProposal(Zt),ge({session:Xt})}},$i=async He=>{if(await this.deletePendingAuthRequest(jt,{message:"fulfilled",code:0}),He.error){const yt=(0,d.D6H)("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return He.error.code===yt.code?void 0:(this.events.off((0,d.E0T)("session_connect"),Le),Ee(He.error.message))}await this.deleteProposal(Zt),this.events.off((0,d.E0T)("session_connect"),Le);const{cacaos:Se,responder:Xt}=He.result,ki=[],ft=[];for(const yt of Se){await(0,d.c4l)({cacao:yt,projectId:this.client.core.projectId})||(this.client.logger.error(yt,"Signature verification failed"),Ee((0,d.D6H)("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:$e}=yt,Mi=(0,d.hA9)($e.resources),fs=[(0,d.DJo)($e.iss)],Dr=(0,d.NmC)($e.iss);if(Mi){const mt=(0,d.Y31)(Mi),fi=(0,d.ouN)(Mi);ki.push(...mt),fs.push(...fi)}for(const mt of fs)ft.push(`${mt}:${Dr}`)}const Be=await this.client.core.crypto.generateSharedKey(K,Xt.publicKey);let gi;ki.length>0&&(gi={topic:Be,acknowledged:!0,self:{publicKey:K,metadata:this.client.metadata},peer:Xt,controller:Xt.publicKey,expiry:(0,d.gn4)(pi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:F,namespaces:(0,d.E12)([...new Set(ki)],[...new Set(ft)])},await this.client.core.relayer.subscribe(Be),await this.client.session.set(Be,gi),gi=this.client.session.get(Be)),ge({auths:Se,session:gi})},jt=(0,L.payloadId)(),Zt=(0,L.payloadId)();this.events.once((0,d.E0T)("session_connect"),Le),this.events.once((0,d.E0T)("session_request",jt),$i);try{await Promise.all([this.sendRequest({topic:F,method:"wc_sessionAuthenticate",params:ie,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:jt}),this.sendRequest({topic:F,method:"wc_sessionPropose",params:se,expiry:Ue.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:Zt})])}catch(He){throw this.events.off((0,d.E0T)("session_connect"),Le),this.events.off((0,d.E0T)("session_request",jt),$i),He}return await this.setProposal(Zt,be({id:Zt},se)),await this.setAuthRequest(jt,{request:Qt(be({},ie),{verifyContext:{}}),pairingTopic:F}),{uri:H,response:_e}},this.approveSessionAuthenticate=async s=>{this.isInitialized();const{id:o,auths:a}=s,u=this.getPendingAuthRequest(o);if(!u)throw new Error(`Could not find pending auth request with id ${o}`);const g=u.requester.publicKey,v=await this.client.core.crypto.generateKeyPair(),E=(0,d.YmJ)(g),x={type:d.rVF,receiverPublicKey:g,senderPublicKey:v},q=[],A=[];for(const F of a){if(!await(0,d.c4l)({cacao:F,projectId:this.client.core.projectId})){const ie=(0,d.D6H)("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:o,topic:E,error:ie,encodeOpts:x}),new Error(ie.message)}const{p:H}=F,K=(0,d.hA9)(H.resources),Y=[(0,d.DJo)(H.iss)],ae=(0,d.NmC)(H.iss);if(K){const ie=(0,d.Y31)(K),re=(0,d.ouN)(K);q.push(...ie),Y.push(...re)}for(const ie of Y)A.push(`${ie}:${ae}`)}const N=await this.client.core.crypto.generateSharedKey(v,g);let M;return(q==null?void 0:q.length)>0&&(M={topic:N,acknowledged:!0,self:{publicKey:v,metadata:this.client.metadata},peer:{publicKey:g,metadata:u.requester.metadata},controller:g,expiry:(0,d.gn4)(pi),authentication:a,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:"",namespaces:(0,d.E12)([...new Set(q)],[...new Set(A)])},await this.client.core.relayer.subscribe(N),await this.client.session.set(N,M)),await this.sendResult({topic:E,id:o,result:{cacaos:a,responder:{publicKey:v,metadata:this.client.metadata}},encodeOpts:x,throwOnFailedPublish:!0}),await this.client.auth.requests.delete(o,{message:"fullfilled",code:0}),await this.client.core.pairing.activate({topic:u.pairingTopic}),{session:M}},this.rejectSessionAuthenticate=async s=>{await this.isInitialized();const{id:o,reason:a}=s,u=this.getPendingAuthRequest(o);if(!u)throw new Error(`Could not find pending auth request with id ${o}`);const g=u.requester.publicKey,v=await this.client.core.crypto.generateKeyPair(),E=(0,d.YmJ)(g),x={type:d.rVF,receiverPublicKey:g,senderPublicKey:v};await this.sendError({id:o,topic:E,error:a,encodeOpts:x}),await this.client.auth.requests.delete(o,{message:"rejected",code:0}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED"))},this.formatAuthMessage=s=>{this.isInitialized();const{request:o,iss:a}=s;return(0,d.wvx)(o,a)},this.cleanupDuplicatePairings=async s=>{if(s.pairingTopic)try{const o=this.client.core.pairing.pairings.get(s.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var g,v;return((g=u.peerMetadata)==null?void 0:g.url)&&((v=u.peerMetadata)==null?void 0:v.url)===s.peer.metadata.url&&u.topic&&u.topic!==o.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(o){this.client.logger.error(o)}},this.deleteSession=async s=>{const{topic:o,expirerHasDeleted:a=!1,emitEvent:u=!0,id:g=0}=s,{self:v}=this.client.session.get(o);await this.client.core.relayer.unsubscribe(o),await this.client.session.delete(o,(0,d.D6H)("USER_DISCONNECTED")),this.addToRecentlyDeleted(o,"session"),this.client.core.crypto.keychain.has(v.publicKey)&&await this.client.core.crypto.deleteKeyPair(v.publicKey),this.client.core.crypto.keychain.has(o)&&await this.client.core.crypto.deleteSymKey(o),a||this.client.core.expirer.del(o),this.client.core.storage.removeItem(To).catch(E=>this.client.logger.warn(E)),this.getPendingSessionRequests().forEach(E=>{E.topic===o&&this.deletePendingSessionRequest(E.id,(0,d.D6H)("USER_DISCONNECTED"))}),u&&this.client.events.emit("session_delete",{id:g,topic:o})},this.deleteProposal=async(s,o)=>{await Promise.all([this.client.proposal.delete(s,(0,d.D6H)("USER_DISCONNECTED")),o?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"proposal")},this.deletePendingSessionRequest=async(s,o,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(s,o),a?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==s),a&&(this.sessionRequestQueue.state=Pt.idle,this.client.events.emit("session_request_expire",{id:s}))},this.deletePendingAuthRequest=async(s,o,a=!1)=>{await Promise.all([this.client.auth.requests.delete(s,o),a?Promise.resolve():this.client.core.expirer.del(s)])},this.setExpiry=async(s,o)=>{this.client.session.keys.includes(s)&&(this.client.core.expirer.set(s,o),await this.client.session.update(s,{expiry:o}))},this.setProposal=async(s,o)=>{this.client.core.expirer.set(s,(0,d.gn4)(Ue.wc_sessionPropose.req.ttl)),await this.client.proposal.set(s,o)},this.setAuthRequest=async(s,o)=>{const{request:a,pairingTopic:u}=o;this.client.core.expirer.set(s,a.expiryTimestamp),await this.client.auth.requests.set(s,{authPayload:a.authPayload,requester:a.requester,expiryTimestamp:a.expiryTimestamp,id:s,pairingTopic:u,verifyContext:a.verifyContext})},this.setPendingSessionRequest=async s=>{const{id:o,topic:a,params:u,verifyContext:g}=s,v=u.request.expiryTimestamp||(0,d.gn4)(Ue.wc_sessionRequest.req.ttl);this.client.core.expirer.set(o,v),await this.client.pendingRequest.set(o,{id:o,topic:a,params:u,verifyContext:g})},this.sendRequest=async s=>{const{topic:o,method:a,params:u,expiry:g,relayRpcId:v,clientRpcId:E,throwOnFailedPublish:x}=s,q=(0,L.formatJsonRpcRequest)(a,u,E);if((0,d.jUY)()&&Sp.includes(a)){const M=(0,d.rjm)(JSON.stringify(q));this.client.core.verify.register({attestationId:M})}let A;try{A=await this.client.core.crypto.encode(o,q)}catch(M){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${o} failed`),M}const N=Ue[a].req;return g&&(N.ttl=g),v&&(N.id=v),this.client.core.history.set(o,q),x?(N.internal=Qt(be({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,A,N)):this.client.core.relayer.publish(o,A,N).catch(M=>this.client.logger.error(M)),q.id},this.sendResult=async s=>{const{id:o,topic:a,result:u,throwOnFailedPublish:g,encodeOpts:v}=s,E=(0,L.formatJsonRpcResult)(o,u);let x;try{x=await this.client.core.crypto.encode(a,E,v)}catch(N){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),N}let q;try{q=await this.client.core.history.get(a,o)}catch(N){throw this.client.logger.error(`sendResult() -> history.get(${a}, ${o}) failed`),N}const A=Ue[q.request.method].res;g?(A.internal=Qt(be({},A.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,x,A)):this.client.core.relayer.publish(a,x,A).catch(N=>this.client.logger.error(N)),await this.client.core.history.resolve(E)},this.sendError=async s=>{const{id:o,topic:a,error:u,encodeOpts:g}=s,v=(0,L.formatJsonRpcError)(o,u);let E;try{E=await this.client.core.crypto.encode(a,v,g)}catch(A){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${a} failed`),A}let x;try{x=await this.client.core.history.get(a,o)}catch(A){throw this.client.logger.error(`sendError() -> history.get(${a}, ${o}) failed`),A}const q=Ue[x.request.method].res;this.client.core.relayer.publish(a,E,q),await this.client.core.history.resolve(v)},this.cleanup=async()=>{const s=[],o=[];this.client.session.getAll().forEach(a=>{let u=!1;(0,d.BwD)(a.expiry)&&(u=!0),this.client.core.crypto.keychain.has(a.topic)||(u=!0),u&&s.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{(0,d.BwD)(a.expiryTimestamp)&&o.push(a.id)}),await Promise.all([...s.map(a=>this.deleteSession({topic:a})),...o.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async s=>{this.requestQueue.queue.push(s),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Pt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Pt.active;const s=this.requestQueue.queue.shift();if(s)try{this.processRequest(s),await new Promise(o=>setTimeout(o,300))}catch(o){this.client.logger.warn(o)}}this.requestQueue.state=Pt.idle},this.processRequest=s=>{const{topic:o,payload:a}=s,u=a.method;if(!this.shouldIgnorePairingRequest({topic:o,requestMethod:u}))switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(o,a);case"wc_sessionSettle":return this.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return this.onSessionExtendRequest(o,a);case"wc_sessionPing":return this.onSessionPingRequest(o,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return this.onSessionRequest(o,a);case"wc_sessionEvent":return this.onSessionEventRequest(o,a);case"wc_sessionAuthenticate":return this.onSessionAuthenticateRequest(o,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:a}=s,u=(await this.client.core.history.get(o,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(o,a);case"wc_sessionSettle":return this.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return this.onSessionExtendResponse(o,a);case"wc_sessionPing":return this.onSessionPingResponse(o,a);case"wc_sessionRequest":return this.onSessionRequestResponse(o,a);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(o,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=s=>{const{topic:o}=s,{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Decoded payload on topic ${o} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.shouldIgnorePairingRequest=s=>{const{topic:o,requestMethod:a}=s,u=this.expectedPairingMethodMap.get(o);return!u||u.includes(a)?!1:!!(u.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)},this.onSessionProposeRequest=async(s,o)=>{const{params:a,id:u}=o;try{this.isValidConnect(be({},o.params));const g=a.expiryTimestamp||(0,d.gn4)(Ue.wc_sessionPropose.req.ttl),v=be({id:u,pairingTopic:s,expiryTimestamp:g},a);await this.setProposal(u,v);const E=(0,d.rjm)(JSON.stringify(o)),x=await this.getVerifyContext(E,v.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:v,verifyContext:x})}catch(g){await this.sendError({id:u,topic:s,error:g}),this.client.logger.error(g)}},this.onSessionProposeResponse=async(s,o)=>{const{id:a}=o;if((0,L.isJsonRpcResult)(o)){const{result:u}=o;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const g=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const v=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:v});const E=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:E});const x=await this.client.core.crypto.generateSharedKey(v,E);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:x});const q=await this.client.core.relayer.subscribe(x);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:q}),await this.client.core.pairing.activate({topic:s})}else if((0,L.isJsonRpcError)(o)){await this.client.proposal.delete(a,(0,d.D6H)("USER_DISCONNECTED"));const u=(0,d.E0T)("session_connect");if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners, 954`);this.events.emit((0,d.E0T)("session_connect"),{error:o.error})}},this.onSessionSettleRequest=async(s,o)=>{const{id:a,params:u}=o;try{this.isValidSessionSettleRequest(u);const{relay:g,controller:v,expiry:E,namespaces:x,sessionProperties:q,pairingTopic:A,sessionConfig:N}=o.params,M=be(be({topic:s,relay:g,expiry:E,namespaces:x,acknowledged:!0,pairingTopic:A,requiredNamespaces:{},optionalNamespaces:{},controller:v.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:v.publicKey,metadata:v.metadata}},q&&{sessionProperties:q}),N&&{sessionConfig:N});await this.sendResult({id:o.id,topic:s,result:!0,throwOnFailedPublish:!0});const F=(0,d.E0T)("session_connect");if(this.events.listenerCount(F)===0)throw new Error(`emitting ${F} without any listeners 997`);this.events.emit((0,d.E0T)("session_connect"),{session:M}),this.cleanupDuplicatePairings(M)}catch(g){await this.sendError({id:a,topic:s,error:g}),this.client.logger.error(g)}},this.onSessionSettleResponse=async(s,o)=>{const{id:a}=o;(0,L.isJsonRpcResult)(o)?(await this.client.session.update(s,{acknowledged:!0}),this.events.emit((0,d.E0T)("session_approve",a),{})):(0,L.isJsonRpcError)(o)&&(await this.client.session.delete(s,(0,d.D6H)("USER_DISCONNECTED")),this.events.emit((0,d.E0T)("session_approve",a),{error:o.error}))},this.onSessionUpdateRequest=async(s,o)=>{const{params:a,id:u}=o;try{const g=`${s}_session_update`,v=d.O6B.get(g);if(v&&this.isRequestOutOfSync(v,u)){this.client.logger.info(`Discarding out of sync request - ${u}`),this.sendError({id:u,topic:s,error:(0,d.D6H)("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(be({topic:s},a));try{d.O6B.set(g,u),await this.client.session.update(s,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:s,result:!0,throwOnFailedPublish:!0})}catch(E){throw d.O6B.delete(g),E}this.client.events.emit("session_update",{id:u,topic:s,params:a})}catch(g){await this.sendError({id:u,topic:s,error:g}),this.client.logger.error(g)}},this.isRequestOutOfSync=(s,o)=>parseInt(o.toString().slice(0,-3))<=parseInt(s.toString().slice(0,-3)),this.onSessionUpdateResponse=(s,o)=>{const{id:a}=o,u=(0,d.E0T)("session_update",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_update",a),{}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_update",a),{error:o.error})},this.onSessionExtendRequest=async(s,o)=>{const{id:a}=o;try{this.isValidExtend({topic:s}),await this.setExpiry(s,(0,d.gn4)(pi)),await this.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:a,topic:s})}catch(u){await this.sendError({id:a,topic:s,error:u}),this.client.logger.error(u)}},this.onSessionExtendResponse=(s,o)=>{const{id:a}=o,u=(0,d.E0T)("session_extend",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_extend",a),{}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_extend",a),{error:o.error})},this.onSessionPingRequest=async(s,o)=>{const{id:a}=o;try{this.isValidPing({topic:s}),await this.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:a,topic:s})}catch(u){await this.sendError({id:a,topic:s,error:u}),this.client.logger.error(u)}},this.onSessionPingResponse=(s,o)=>{const{id:a}=o,u=(0,d.E0T)("session_ping",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);setTimeout(()=>{(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_ping",a),{}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_ping",a),{error:o.error})},500)},this.onSessionDeleteRequest=async(s,o)=>{const{id:a}=o;try{this.isValidDisconnect({topic:s,reason:o.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Te.publish,async()=>{u(await this.deleteSession({topic:s,id:a}))})}),this.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:s,error:(0,d.D6H)("USER_DISCONNECTED")})])}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(s,o)=>{var a;const{id:u,params:g}=o;try{await this.isValidRequest(be({topic:s},g));const v=(0,d.rjm)(JSON.stringify((0,L.formatJsonRpcRequest)("wc_sessionRequest",g,u))),E=this.client.session.get(s),x=await this.getVerifyContext(v,E.peer.metadata),q={id:u,topic:s,params:g,verifyContext:x};await this.setPendingSessionRequest(q),(a=this.client.signConfig)!=null&&a.disableRequestQueue?this.emitSessionRequest(q):(this.addSessionRequestToSessionRequestQueue(q),this.processSessionRequestQueue())}catch(v){await this.sendError({id:u,topic:s,error:v}),this.client.logger.error(v)}},this.onSessionRequestResponse=(s,o)=>{const{id:a}=o,u=(0,d.E0T)("session_request",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_request",a),{result:o.result}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_request",a),{error:o.error})},this.onSessionEventRequest=async(s,o)=>{const{id:a,params:u}=o;try{const g=`${s}_session_event_${u.event.name}`,v=d.O6B.get(g);if(v&&this.isRequestOutOfSync(v,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(be({topic:s},u)),this.client.events.emit("session_event",{id:a,topic:s,params:u}),d.O6B.set(g,a)}catch(g){await this.sendError({id:a,topic:s,error:g}),this.client.logger.error(g)}},this.onSessionAuthenticateResponse=(s,o)=>{const{id:a}=o;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:s,payload:o}),(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_request",a),{result:o.result}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_request",a),{error:o.error})},this.onSessionAuthenticateRequest=async(s,o)=>{const{requester:a,authPayload:u,expiryTimestamp:g}=o.params,v=(0,d.rjm)(JSON.stringify(o)),E=await this.getVerifyContext(v,this.client.metadata),x={requester:a,pairingTopic:s,id:o.id,authPayload:u,verifyContext:E,expiryTimestamp:g};await this.setAuthRequest(o.id,{request:x,pairingTopic:s}),this.client.events.emit("session_authenticate",{topic:s,params:o.params,id:o.id})},this.addSessionRequestToSessionRequestQueue=s=>{this.sessionRequestQueue.queue.push(s)},this.cleanupAfterResponse=s=>{this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Pt.idle,this.processSessionRequestQueue()},(0,k.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:s,error:o})=>{const a=this.client.core.history.pending;a.length>0&&a.filter(u=>u.topic===s&&u.request.method==="wc_sessionRequest").forEach(u=>{const g=u.request.id,v=(0,d.E0T)("session_request",g);if(this.events.listenerCount(v)===0)throw new Error(`emitting ${v} without any listeners`);this.events.emit((0,d.E0T)("session_request",u.request.id),{error:o})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Pt.active){this.client.logger.info("session request queue is already active.");return}const s=this.sessionRequestQueue.queue[0];if(!s){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Pt.active,this.emitSessionRequest(s)}catch(o){this.client.logger.error(o)}},this.emitSessionRequest=s=>{this.client.events.emit("session_request",s)},this.onPairingCreated=s=>{if(s.methods&&this.expectedPairingMethodMap.set(s.topic,s.methods),s.active)return;const o=this.client.proposal.getAll().find(a=>a.pairingTopic===s.topic);o&&this.onSessionProposeRequest(s.topic,(0,L.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,relays:o.relays,proposer:o.proposer,sessionProperties:o.sessionProperties},o.id))},this.isValidConnect=async s=>{if(!(0,d.EJd)(s)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(E)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:g,relays:v}=s;if((0,d.o8e)(o)||await this.isValidPairingTopic(o),!(0,d.PMr)(v,!0)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`connect() relays: ${v}`);throw new Error(E)}!(0,d.o8e)(a)&&(0,d.L5o)(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!(0,d.o8e)(u)&&(0,d.L5o)(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),(0,d.o8e)(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(s,o)=>{const a=(0,d.naP)(s,"connect()",o);if(a)throw new Error(a.message)},this.isValidApprove=async s=>{if(!(0,d.EJd)(s))throw new Error((0,d.kCb)("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:o,namespaces:a,relayProtocol:u,sessionProperties:g}=s;this.checkRecentlyDeleted(o),await this.isValidProposalId(o);const v=this.client.proposal.get(o),E=(0,d.ing)(a,"approve()");if(E)throw new Error(E.message);const x=(0,d.rFo)(v.requiredNamespaces,a,"approve()");if(x)throw new Error(x.message);if(!(0,d.M_r)(u,!0)){const{message:q}=(0,d.kCb)("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(q)}(0,d.o8e)(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async s=>{if(!(0,d.EJd)(s)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(u)}const{id:o,reason:a}=s;if(this.checkRecentlyDeleted(o),await this.isValidProposalId(o),!(0,d.H4H)(a)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=s=>{if(!(0,d.EJd)(s)){const{message:x}=(0,d.kCb)("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(x)}const{relay:o,controller:a,namespaces:u,expiry:g}=s;if(!(0,d.Z26)(o)){const{message:x}=(0,d.kCb)("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(x)}const v=(0,d.DdM)(a,"onSessionSettleRequest()");if(v)throw new Error(v.message);const E=(0,d.ing)(u,"onSessionSettleRequest()");if(E)throw new Error(E.message);if((0,d.BwD)(g)){const{message:x}=(0,d.kCb)("EXPIRED","onSessionSettleRequest()");throw new Error(x)}},this.isValidUpdate=async s=>{if(!(0,d.EJd)(s)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(E)}const{topic:o,namespaces:a}=s;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o);const u=this.client.session.get(o),g=(0,d.ing)(a,"update()");if(g)throw new Error(g.message);const v=(0,d.rFo)(u.requiredNamespaces,a,"update()");if(v)throw new Error(v.message)},this.isValidExtend=async s=>{if(!(0,d.EJd)(s)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(a)}const{topic:o}=s;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o)},this.isValidRequest=async s=>{if(!(0,d.EJd)(s)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(E)}const{topic:o,request:a,chainId:u,expiry:g}=s;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o);const{namespaces:v}=this.client.session.get(o);if(!(0,d.p8o)(v,u)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(E)}if(!(0,d.hHR)(a)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(E)}if(!(0,d.alS)(v,u,a.method)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(E)}if(g&&!(0,d.ONw)(g,vr)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${vr.min} and ${vr.max}`);throw new Error(E)}},this.isValidRespond=async s=>{var o;if(!(0,d.EJd)(s)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(g)}const{topic:a,response:u}=s;try{await this.isValidSessionTopic(a)}catch(g){throw(o=s==null?void 0:s.response)!=null&&o.id&&this.cleanupAfterResponse(s),g}if(!(0,d.JTI)(u)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(g)}},this.isValidPing=async s=>{if(!(0,d.EJd)(s)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(a)}const{topic:o}=s;await this.isValidSessionOrPairingTopic(o)},this.isValidEmit=async s=>{if(!(0,d.EJd)(s)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(v)}const{topic:o,event:a,chainId:u}=s;await this.isValidSessionTopic(o);const{namespaces:g}=this.client.session.get(o);if(!(0,d.p8o)(g,u)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(v)}if(!(0,d.nfW)(a)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}if(!(0,d.B95)(g,u,a.name)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}},this.isValidDisconnect=async s=>{if(!(0,d.EJd)(s)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(a)}const{topic:o}=s;await this.isValidSessionOrPairingTopic(o)},this.isValidAuthenticate=s=>{const{chains:o,uri:a,domain:u,nonce:g}=s;if(!Array.isArray(o)||o.length===0)throw new Error("chains is required and must be a non-empty array");if(!(0,d.M_r)(a,!1))throw new Error("uri is required parameter");if(!(0,d.M_r)(u,!1))throw new Error("domain is required parameter");if(!(0,d.M_r)(g,!1))throw new Error("nonce is required parameter");if([...new Set(o.map(E=>(0,d.DQe)(E).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:v}=(0,d.DQe)(o[0]);if(v!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")},this.getVerifyContext=async(s,o)=>{const a={verified:{verifyUrl:o.verifyUrl||li,validation:"UNKNOWN",origin:o.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:s,verifyUrl:o.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(s,o)=>{Object.values(s).forEach(a=>{if(!(0,d.M_r)(a,!1)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`${o} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})},this.getPendingAuthRequest=s=>{const o=this.client.auth.requests.get(s);return typeof o=="object"?o:void 0},this.addToRecentlyDeleted=(s,o)=>{if(this.recentlyDeletedMap.set(s,o),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0;const u=this.recentlyDeletedLimit/2;for(const g of this.recentlyDeletedMap.keys()){if(a++>=u)break;this.recentlyDeletedMap.delete(g)}}},this.checkRecentlyDeleted=s=>{const o=this.recentlyDeletedMap.get(s);if(o){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Record was recently deleted - ${o}: ${s}`);throw new Error(a)}}}async isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Te.message,async r=>{const{topic:s,message:o}=r,{publicKey:a}=this.client.auth.authKeys.keys.includes(us)?this.client.auth.authKeys.get(us):{responseTopic:void 0,publicKey:void 0},u=await this.client.core.crypto.decode(s,o,{receiverPublicKey:a});try{(0,L.isJsonRpcRequest)(u)?(this.client.core.history.set(s,u),this.onRelayEventRequest({topic:s,payload:u})):(0,L.isJsonRpcResponse)(u)?(await this.client.core.history.resolve(u),await this.onRelayEventResponse({topic:s,payload:u}),this.client.core.history.delete(s,u.id)):this.onRelayEventUnknownPayload({topic:s,payload:u})}catch(g){this.client.logger.error(g)}})}registerExpirerEvents(){this.client.core.expirer.on(Ze.expired,async r=>{const{topic:s,id:o}=(0,d.iPz)(r.target);if(o&&this.client.pendingRequest.keys.includes(o))return await this.deletePendingSessionRequest(o,(0,d.kCb)("EXPIRED"),!0);if(o&&this.client.auth.requests.keys.includes(o))return await this.deletePendingAuthRequest(o,(0,d.kCb)("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(await this.deleteSession({topic:s,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:s})):o&&(await this.deleteProposal(o,!0),this.client.events.emit("proposal_expire",{id:o}))})}registerPairingEvents(){this.client.core.pairing.events.on(ui.create,r=>this.onPairingCreated(r)),this.client.core.pairing.events.on(ui.delete,r=>{this.addToRecentlyDeleted(r.topic,"pairing")})}isValidPairingTopic(r){if(!(0,d.M_r)(r,!1)){const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:s}=(0,d.kCb)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if((0,d.BwD)(this.client.core.pairing.pairings.get(r).expiry)){const{message:s}=(0,d.kCb)("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}}async isValidSessionTopic(r){if(!(0,d.M_r)(r,!1)){const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(s)}if(this.checkRecentlyDeleted(r),!this.client.session.keys.includes(r)){const{message:s}=(0,d.kCb)("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(s)}if((0,d.BwD)(this.client.session.get(r).expiry)){await this.deleteSession({topic:r});const{message:s}=(0,d.kCb)("EXPIRED",`session topic: ${r}`);throw new Error(s)}if(!this.client.core.crypto.keychain.has(r)){const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`session topic does not exist in keychain: ${r}`);throw await this.deleteSession({topic:r}),new Error(s)}}async isValidSessionOrPairingTopic(r){if(this.checkRecentlyDeleted(r),this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if((0,d.M_r)(r,!1)){const{message:s}=(0,d.kCb)("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(s)}else{const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(s)}}async isValidProposalId(r){if(!(0,d.Q01)(r)){const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(s)}if(!this.client.proposal.keys.includes(r)){const{message:s}=(0,d.kCb)("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(s)}if((0,d.BwD)(this.client.proposal.get(r).expiryTimestamp)){await this.deleteProposal(r);const{message:s}=(0,d.kCb)("EXPIRED",`proposal id: ${r}`);throw new Error(s)}}}class kp extends Wt{constructor(r,s){super(r,s,bp,yr),this.core=r,this.logger=s}}class Mp extends Wt{constructor(r,s){super(r,s,Ep,yr),this.core=r,this.logger=s}}class jp extends Wt{constructor(r,s){super(r,s,Pp,yr,o=>o.id),this.core=r,this.logger=s}}class zp extends Wt{constructor(r,s){super(r,s,Rp,hs,()=>us),this.core=r,this.logger=s}}class Up extends Wt{constructor(r,s){super(r,s,qp,hs),this.core=r,this.logger=s}}class Lp extends Wt{constructor(r,s){super(r,s,Dp,hs,o=>o.id),this.core=r,this.logger=s}}class Hp{constructor(r,s){this.core=r,this.logger=s,this.authKeys=new zp(this.core,this.logger),this.pairingTopics=new Up(this.core,this.logger),this.requests=new Lp(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}class wr extends zh{constructor(r){super(r),this.protocol=Oo,this.version=Fo,this.name=mr.name,this.events=new Et.EventEmitter,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.removeAllListeners=o=>this.events.removeAllListeners(o),this.connect=async o=>{try{return await this.engine.connect(o)}catch(a){throw this.logger.error(a.message),a}},this.pair=async o=>{try{return await this.engine.pair(o)}catch(a){throw this.logger.error(a.message),a}},this.approve=async o=>{try{return await this.engine.approve(o)}catch(a){throw this.logger.error(a.message),a}},this.reject=async o=>{try{return await this.engine.reject(o)}catch(a){throw this.logger.error(a.message),a}},this.update=async o=>{try{return await this.engine.update(o)}catch(a){throw this.logger.error(a.message),a}},this.extend=async o=>{try{return await this.engine.extend(o)}catch(a){throw this.logger.error(a.message),a}},this.request=async o=>{try{return await this.engine.request(o)}catch(a){throw this.logger.error(a.message),a}},this.respond=async o=>{try{return await this.engine.respond(o)}catch(a){throw this.logger.error(a.message),a}},this.ping=async o=>{try{return await this.engine.ping(o)}catch(a){throw this.logger.error(a.message),a}},this.emit=async o=>{try{return await this.engine.emit(o)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async o=>{try{return await this.engine.disconnect(o)}catch(a){throw this.logger.error(a.message),a}},this.find=o=>{try{return this.engine.find(o)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(o){throw this.logger.error(o.message),o}},this.authenticate=async o=>{try{return await this.engine.authenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.formatAuthMessage=o=>{try{return this.engine.formatAuthMessage(o)}catch(a){throw this.logger.error(a.message),a}},this.approveSessionAuthenticate=async o=>{try{return await this.engine.approveSessionAuthenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.rejectSessionAuthenticate=async o=>{try{return await this.engine.rejectSessionAuthenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.name=(r==null?void 0:r.name)||mr.name,this.metadata=(r==null?void 0:r.metadata)||(0,d.DaH)(),this.signConfig=r==null?void 0:r.signConfig;const s=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:(0,ee.gw)((0,ee.jI)({level:(r==null?void 0:r.logger)||mr.logger}));this.core=(r==null?void 0:r.core)||new _p(r),this.logger=(0,ee.Ep)(s,this.name),this.session=new Mp(this.core,this.logger),this.proposal=new kp(this.core,this.logger),this.pendingRequest=new jp(this.core,this.logger),this.engine=new $p(this),this.auth=new Hp(this.core,this.logger)}static async init(r){const s=new wr(r);return await s.initialize(),s}get context(){return(0,ee.Fd)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),await this.auth.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}}const T_=null,$_=null;var kt=le(51916);const jo="error",Bp="wss://relay.walletconnect.com",Vp="wc",Kp="universal_provider",zo=`${Vp}@2:${Kp}:`,Jp="https://rpc.walletconnect.com/v1/",St={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof le.g<"u"?le.g:typeof self<"u"?self:{},_r={exports:{}};(function(y,r){(function(){var s,o="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",v="Invalid `variable` option passed into `_.template`",E="__lodash_hash_undefined__",x=500,q="__lodash_placeholder__",A=1,N=2,M=4,F=1,H=2,K=1,Y=2,ae=4,ie=8,re=16,se=32,_e=64,ge=128,Ee=256,Le=512,$i=30,jt="...",Zt=800,He=16,Se=1,Xt=2,ki=3,ft=1/0,Be=9007199254740991,gi=17976931348623157e292,yt=0/0,$e=4294967295,Mi=$e-1,fs=$e>>>1,Dr=[["ary",ge],["bind",K],["bindKey",Y],["curry",ie],["curryRight",re],["flip",Le],["partial",se],["partialRight",_e],["rearg",Ee]],mt="[object Arguments]",fi="[object Array]",qd="[object AsyncFunction]",ji="[object Boolean]",zi="[object Date]",Dd="[object DOMException]",ys="[object Error]",ms="[object Function]",Yo="[object GeneratorFunction]",ct="[object Map]",Ui="[object Number]",Ad="[object Null]",Ct="[object Object]",Zo="[object Promise]",Od="[object Proxy]",Li="[object RegExp]",ht="[object Set]",Hi="[object String]",vs="[object Symbol]",Fd="[object Undefined]",Bi="[object WeakMap]",Nd="[object WeakSet]",Vi="[object ArrayBuffer]",yi="[object DataView]",Ar="[object Float32Array]",Or="[object Float64Array]",Fr="[object Int8Array]",Nr="[object Int16Array]",Tr="[object Int32Array]",$r="[object Uint8Array]",kr="[object Uint8ClampedArray]",Mr="[object Uint16Array]",jr="[object Uint32Array]",Td=/\b__p \+= '';/g,$d=/\b(__p \+=) '' \+/g,kd=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Xo=/&(?:amp|lt|gt|quot|#39);/g,ea=/[&<>"']/g,Md=RegExp(Xo.source),jd=RegExp(ea.source),zd=/<%-([\s\S]+?)%>/g,Ud=/<%([\s\S]+?)%>/g,ta=/<%=([\s\S]+?)%>/g,Ld=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hd=/^\w*$/,Bd=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zr=/[\\^$.*+?()[\]{}|]/g,Vd=RegExp(zr.source),Ur=/^\s+/,Kd=/\s/,Jd=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Gd=/\{\n\/\* \[wrapped with (.+)\] \*/,Wd=/,? & /,Qd=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Yd=/[()=,{}\[\]\/\s]/,Zd=/\\(\\)?/g,Xd=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ia=/\w*$/,eg=/^[-+]0x[0-9a-f]+$/i,tg=/^0b[01]+$/i,ig=/^\[object .+?Constructor\]$/,sg=/^0o[0-7]+$/i,rg=/^(?:0|[1-9]\d*)$/,ng=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ws=/($^)/,og=/['\n\r\u2028\u2029\\]/g,_s="\\ud800-\\udfff",ag="\\u0300-\\u036f",cg="\\ufe20-\\ufe2f",hg="\\u20d0-\\u20ff",sa=ag+cg+hg,ra="\\u2700-\\u27bf",na="a-z\\xdf-\\xf6\\xf8-\\xff",ug="\\xac\\xb1\\xd7\\xf7",lg="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",pg="\\u2000-\\u206f",dg=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",oa="A-Z\\xc0-\\xd6\\xd8-\\xde",aa="\\ufe0e\\ufe0f",ca=ug+lg+pg+dg,Lr="['\u2019]",gg="["+_s+"]",ha="["+ca+"]",bs="["+sa+"]",ua="\\d+",fg="["+ra+"]",la="["+na+"]",pa="[^"+_s+ca+ua+ra+na+oa+"]",Hr="\\ud83c[\\udffb-\\udfff]",yg="(?:"+bs+"|"+Hr+")",da="[^"+_s+"]",Br="(?:\\ud83c[\\udde6-\\uddff]){2}",Vr="[\\ud800-\\udbff][\\udc00-\\udfff]",mi="["+oa+"]",ga="\\u200d",fa="(?:"+la+"|"+pa+")",mg="(?:"+mi+"|"+pa+")",ya="(?:"+Lr+"(?:d|ll|m|re|s|t|ve))?",ma="(?:"+Lr+"(?:D|LL|M|RE|S|T|VE))?",va=yg+"?",wa="["+aa+"]?",vg="(?:"+ga+"(?:"+[da,Br,Vr].join("|")+")"+wa+va+")*",wg="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_g="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",_a=wa+va+vg,bg="(?:"+[fg,Br,Vr].join("|")+")"+_a,Eg="(?:"+[da+bs+"?",bs,Br,Vr,gg].join("|")+")",Ig=RegExp(Lr,"g"),Pg=RegExp(bs,"g"),Kr=RegExp(Hr+"(?="+Hr+")|"+Eg+_a,"g"),Sg=RegExp([mi+"?"+la+"+"+ya+"(?="+[ha,mi,"$"].join("|")+")",mg+"+"+ma+"(?="+[ha,mi+fa,"$"].join("|")+")",mi+"?"+fa+"+"+ya,mi+"+"+ma,_g,wg,ua,bg].join("|"),"g"),Cg=RegExp("["+ga+_s+sa+aa+"]"),xg=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Rg=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],qg=-1,pe={};pe[Ar]=pe[Or]=pe[Fr]=pe[Nr]=pe[Tr]=pe[$r]=pe[kr]=pe[Mr]=pe[jr]=!0,pe[mt]=pe[fi]=pe[Vi]=pe[ji]=pe[yi]=pe[zi]=pe[ys]=pe[ms]=pe[ct]=pe[Ui]=pe[Ct]=pe[Li]=pe[ht]=pe[Hi]=pe[Bi]=!1;var ue={};ue[mt]=ue[fi]=ue[Vi]=ue[yi]=ue[ji]=ue[zi]=ue[Ar]=ue[Or]=ue[Fr]=ue[Nr]=ue[Tr]=ue[ct]=ue[Ui]=ue[Ct]=ue[Li]=ue[ht]=ue[Hi]=ue[vs]=ue[$r]=ue[kr]=ue[Mr]=ue[jr]=!0,ue[ys]=ue[ms]=ue[Bi]=!1;var Dg={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Ag={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Og={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Fg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ng=parseFloat,Tg=parseInt,ba=typeof Ti=="object"&&Ti&&Ti.Object===Object&&Ti,$g=typeof self=="object"&&self&&self.Object===Object&&self,Re=ba||$g||Function("return this")(),Jr=r&&!r.nodeType&&r,ei=Jr&&!0&&y&&!y.nodeType&&y,Ea=ei&&ei.exports===Jr,Gr=Ea&&ba.process,Xe=function(){try{var _=ei&&ei.require&&ei.require("util").types;return _||Gr&&Gr.binding&&Gr.binding("util")}catch{}}(),Ia=Xe&&Xe.isArrayBuffer,Pa=Xe&&Xe.isDate,Sa=Xe&&Xe.isMap,Ca=Xe&&Xe.isRegExp,xa=Xe&&Xe.isSet,Ra=Xe&&Xe.isTypedArray;function Ve(_,P,I){switch(I.length){case 0:return _.call(P);case 1:return _.call(P,I[0]);case 2:return _.call(P,I[0],I[1]);case 3:return _.call(P,I[0],I[1],I[2])}return _.apply(P,I)}function kg(_,P,I,O){for(var B=-1,ne=_==null?0:_.length;++B<ne;){var Ie=_[B];P(O,Ie,I(Ie),_)}return O}function et(_,P){for(var I=-1,O=_==null?0:_.length;++I<O&&P(_[I],I,_)!==!1;);return _}function Mg(_,P){for(var I=_==null?0:_.length;I--&&P(_[I],I,_)!==!1;);return _}function qa(_,P){for(var I=-1,O=_==null?0:_.length;++I<O;)if(!P(_[I],I,_))return!1;return!0}function zt(_,P){for(var I=-1,O=_==null?0:_.length,B=0,ne=[];++I<O;){var Ie=_[I];P(Ie,I,_)&&(ne[B++]=Ie)}return ne}function Es(_,P){var I=_==null?0:_.length;return!!I&&vi(_,P,0)>-1}function Wr(_,P,I){for(var O=-1,B=_==null?0:_.length;++O<B;)if(I(P,_[O]))return!0;return!1}function fe(_,P){for(var I=-1,O=_==null?0:_.length,B=Array(O);++I<O;)B[I]=P(_[I],I,_);return B}function Ut(_,P){for(var I=-1,O=P.length,B=_.length;++I<O;)_[B+I]=P[I];return _}function Qr(_,P,I,O){var B=-1,ne=_==null?0:_.length;for(O&&ne&&(I=_[++B]);++B<ne;)I=P(I,_[B],B,_);return I}function jg(_,P,I,O){var B=_==null?0:_.length;for(O&&B&&(I=_[--B]);B--;)I=P(I,_[B],B,_);return I}function Yr(_,P){for(var I=-1,O=_==null?0:_.length;++I<O;)if(P(_[I],I,_))return!0;return!1}var zg=Zr("length");function Ug(_){return _.split("")}function Lg(_){return _.match(Qd)||[]}function Da(_,P,I){var O;return I(_,function(B,ne,Ie){if(P(B,ne,Ie))return O=ne,!1}),O}function Is(_,P,I,O){for(var B=_.length,ne=I+(O?1:-1);O?ne--:++ne<B;)if(P(_[ne],ne,_))return ne;return-1}function vi(_,P,I){return P===P?ef(_,P,I):Is(_,Aa,I)}function Hg(_,P,I,O){for(var B=I-1,ne=_.length;++B<ne;)if(O(_[B],P))return B;return-1}function Aa(_){return _!==_}function Oa(_,P){var I=_==null?0:_.length;return I?en(_,P)/I:yt}function Zr(_){return function(P){return P==null?s:P[_]}}function Xr(_){return function(P){return _==null?s:_[P]}}function Fa(_,P,I,O,B){return B(_,function(ne,Ie,he){I=O?(O=!1,ne):P(I,ne,Ie,he)}),I}function Bg(_,P){var I=_.length;for(_.sort(P);I--;)_[I]=_[I].value;return _}function en(_,P){for(var I,O=-1,B=_.length;++O<B;){var ne=P(_[O]);ne!==s&&(I=I===s?ne:I+ne)}return I}function tn(_,P){for(var I=-1,O=Array(_);++I<_;)O[I]=P(I);return O}function Vg(_,P){return fe(P,function(I){return[I,_[I]]})}function Na(_){return _&&_.slice(0,Ma(_)+1).replace(Ur,"")}function Ke(_){return function(P){return _(P)}}function sn(_,P){return fe(P,function(I){return _[I]})}function Ki(_,P){return _.has(P)}function Ta(_,P){for(var I=-1,O=_.length;++I<O&&vi(P,_[I],0)>-1;);return I}function $a(_,P){for(var I=_.length;I--&&vi(P,_[I],0)>-1;);return I}function Kg(_,P){for(var I=_.length,O=0;I--;)_[I]===P&&++O;return O}var Jg=Xr(Dg),Gg=Xr(Ag);function Wg(_){return"\\"+Fg[_]}function Qg(_,P){return _==null?s:_[P]}function wi(_){return Cg.test(_)}function Yg(_){return xg.test(_)}function Zg(_){for(var P,I=[];!(P=_.next()).done;)I.push(P.value);return I}function rn(_){var P=-1,I=Array(_.size);return _.forEach(function(O,B){I[++P]=[B,O]}),I}function ka(_,P){return function(I){return _(P(I))}}function Lt(_,P){for(var I=-1,O=_.length,B=0,ne=[];++I<O;){var Ie=_[I];(Ie===P||Ie===q)&&(_[I]=q,ne[B++]=I)}return ne}function Ps(_){var P=-1,I=Array(_.size);return _.forEach(function(O){I[++P]=O}),I}function Xg(_){var P=-1,I=Array(_.size);return _.forEach(function(O){I[++P]=[O,O]}),I}function ef(_,P,I){for(var O=I-1,B=_.length;++O<B;)if(_[O]===P)return O;return-1}function tf(_,P,I){for(var O=I+1;O--;)if(_[O]===P)return O;return O}function _i(_){return wi(_)?rf(_):zg(_)}function ut(_){return wi(_)?nf(_):Ug(_)}function Ma(_){for(var P=_.length;P--&&Kd.test(_.charAt(P)););return P}var sf=Xr(Og);function rf(_){for(var P=Kr.lastIndex=0;Kr.test(_);)++P;return P}function nf(_){return _.match(Kr)||[]}function of(_){return _.match(Sg)||[]}var af=function _(P){P=P==null?Re:bi.defaults(Re.Object(),P,bi.pick(Re,Rg));var I=P.Array,O=P.Date,B=P.Error,ne=P.Function,Ie=P.Math,he=P.Object,nn=P.RegExp,cf=P.String,tt=P.TypeError,Ss=I.prototype,hf=ne.prototype,Ei=he.prototype,Cs=P["__core-js_shared__"],xs=hf.toString,ce=Ei.hasOwnProperty,uf=0,ja=function(){var e=/[^.]+$/.exec(Cs&&Cs.keys&&Cs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Rs=Ei.toString,lf=xs.call(he),pf=Re._,df=nn("^"+xs.call(ce).replace(zr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qs=Ea?P.Buffer:s,Ht=P.Symbol,Ds=P.Uint8Array,za=qs?qs.allocUnsafe:s,As=ka(he.getPrototypeOf,he),Ua=he.create,La=Ei.propertyIsEnumerable,Os=Ss.splice,Ha=Ht?Ht.isConcatSpreadable:s,Ji=Ht?Ht.iterator:s,ti=Ht?Ht.toStringTag:s,Fs=function(){try{var e=oi(he,"defineProperty");return e({},"",{}),e}catch{}}(),gf=P.clearTimeout!==Re.clearTimeout&&P.clearTimeout,ff=O&&O.now!==Re.Date.now&&O.now,yf=P.setTimeout!==Re.setTimeout&&P.setTimeout,Ns=Ie.ceil,Ts=Ie.floor,on=he.getOwnPropertySymbols,mf=qs?qs.isBuffer:s,Ba=P.isFinite,vf=Ss.join,wf=ka(he.keys,he),Pe=Ie.max,De=Ie.min,_f=O.now,bf=P.parseInt,Va=Ie.random,Ef=Ss.reverse,an=oi(P,"DataView"),Gi=oi(P,"Map"),cn=oi(P,"Promise"),Ii=oi(P,"Set"),Wi=oi(P,"WeakMap"),Qi=oi(he,"create"),$s=Wi&&new Wi,Pi={},If=ai(an),Pf=ai(Gi),Sf=ai(cn),Cf=ai(Ii),xf=ai(Wi),ks=Ht?Ht.prototype:s,Yi=ks?ks.valueOf:s,Ka=ks?ks.toString:s;function p(e){if(me(e)&&!V(e)&&!(e instanceof X)){if(e instanceof it)return e;if(ce.call(e,"__wrapped__"))return Jc(e)}return new it(e)}var Si=function(){function e(){}return function(t){if(!ye(t))return{};if(Ua)return Ua(t);e.prototype=t;var n=new e;return e.prototype=s,n}}();function Ms(){}function it(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=s}p.templateSettings={escape:zd,evaluate:Ud,interpolate:ta,variable:"",imports:{_:p}},p.prototype=Ms.prototype,p.prototype.constructor=p,it.prototype=Si(Ms.prototype),it.prototype.constructor=it;function X(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=$e,this.__views__=[]}function Rf(){var e=new X(this.__wrapped__);return e.__actions__=ke(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ke(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ke(this.__views__),e}function qf(){if(this.__filtered__){var e=new X(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Df(){var e=this.__wrapped__.value(),t=this.__dir__,n=V(e),h=t<0,l=n?e.length:0,f=Ly(0,l,this.__views__),m=f.start,w=f.end,b=w-m,S=h?w:m-1,C=this.__iteratees__,R=C.length,D=0,T=De(b,this.__takeCount__);if(!n||!h&&l==b&&T==b)return yc(e,this.__actions__);var z=[];e:for(;b--&&D<T;){S+=t;for(var G=-1,U=e[S];++G<R;){var Z=C[G],te=Z.iteratee,We=Z.type,Ne=te(U);if(We==Xt)U=Ne;else if(!Ne){if(We==Se)continue e;break e}}z[D++]=U}return z}X.prototype=Si(Ms.prototype),X.prototype.constructor=X;function ii(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Af(){this.__data__=Qi?Qi(null):{},this.size=0}function Of(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Ff(e){var t=this.__data__;if(Qi){var n=t[e];return n===E?s:n}return ce.call(t,e)?t[e]:s}function Nf(e){var t=this.__data__;return Qi?t[e]!==s:ce.call(t,e)}function Tf(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Qi&&t===s?E:t,this}ii.prototype.clear=Af,ii.prototype.delete=Of,ii.prototype.get=Ff,ii.prototype.has=Nf,ii.prototype.set=Tf;function xt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function $f(){this.__data__=[],this.size=0}function kf(e){var t=this.__data__,n=js(t,e);if(n<0)return!1;var h=t.length-1;return n==h?t.pop():Os.call(t,n,1),--this.size,!0}function Mf(e){var t=this.__data__,n=js(t,e);return n<0?s:t[n][1]}function jf(e){return js(this.__data__,e)>-1}function zf(e,t){var n=this.__data__,h=js(n,e);return h<0?(++this.size,n.push([e,t])):n[h][1]=t,this}xt.prototype.clear=$f,xt.prototype.delete=kf,xt.prototype.get=Mf,xt.prototype.has=jf,xt.prototype.set=zf;function Rt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Uf(){this.size=0,this.__data__={hash:new ii,map:new(Gi||xt),string:new ii}}function Lf(e){var t=Ys(this,e).delete(e);return this.size-=t?1:0,t}function Hf(e){return Ys(this,e).get(e)}function Bf(e){return Ys(this,e).has(e)}function Vf(e,t){var n=Ys(this,e),h=n.size;return n.set(e,t),this.size+=n.size==h?0:1,this}Rt.prototype.clear=Uf,Rt.prototype.delete=Lf,Rt.prototype.get=Hf,Rt.prototype.has=Bf,Rt.prototype.set=Vf;function si(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Rt;++t<n;)this.add(e[t])}function Kf(e){return this.__data__.set(e,E),this}function Jf(e){return this.__data__.has(e)}si.prototype.add=si.prototype.push=Kf,si.prototype.has=Jf;function lt(e){var t=this.__data__=new xt(e);this.size=t.size}function Gf(){this.__data__=new xt,this.size=0}function Wf(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Qf(e){return this.__data__.get(e)}function Yf(e){return this.__data__.has(e)}function Zf(e,t){var n=this.__data__;if(n instanceof xt){var h=n.__data__;if(!Gi||h.length<a-1)return h.push([e,t]),this.size=++n.size,this;n=this.__data__=new Rt(h)}return n.set(e,t),this.size=n.size,this}lt.prototype.clear=Gf,lt.prototype.delete=Wf,lt.prototype.get=Qf,lt.prototype.has=Yf,lt.prototype.set=Zf;function Ja(e,t){var n=V(e),h=!n&&ci(e),l=!n&&!h&&Gt(e),f=!n&&!h&&!l&&qi(e),m=n||h||l||f,w=m?tn(e.length,cf):[],b=w.length;for(var S in e)(t||ce.call(e,S))&&!(m&&(S=="length"||l&&(S=="offset"||S=="parent")||f&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||Ot(S,b)))&&w.push(S);return w}function Ga(e){var t=e.length;return t?e[wn(0,t-1)]:s}function Xf(e,t){return Zs(ke(e),ri(t,0,e.length))}function ey(e){return Zs(ke(e))}function hn(e,t,n){(n!==s&&!pt(e[t],n)||n===s&&!(t in e))&&qt(e,t,n)}function Zi(e,t,n){var h=e[t];(!(ce.call(e,t)&&pt(h,n))||n===s&&!(t in e))&&qt(e,t,n)}function js(e,t){for(var n=e.length;n--;)if(pt(e[n][0],t))return n;return-1}function ty(e,t,n,h){return Bt(e,function(l,f,m){t(h,l,n(l),m)}),h}function Wa(e,t){return e&&wt(t,Ce(t),e)}function iy(e,t){return e&&wt(t,je(t),e)}function qt(e,t,n){t=="__proto__"&&Fs?Fs(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function un(e,t){for(var n=-1,h=t.length,l=I(h),f=e==null;++n<h;)l[n]=f?s:Bn(e,t[n]);return l}function ri(e,t,n){return e===e&&(n!==s&&(e=e<=n?e:n),t!==s&&(e=e>=t?e:t)),e}function st(e,t,n,h,l,f){var m,w=t&A,b=t&N,S=t&M;if(n&&(m=l?n(e,h,l,f):n(e)),m!==s)return m;if(!ye(e))return e;var C=V(e);if(C){if(m=By(e),!w)return ke(e,m)}else{var R=Ae(e),D=R==ms||R==Yo;if(Gt(e))return wc(e,w);if(R==Ct||R==mt||D&&!l){if(m=b||D?{}:Mc(e),!w)return b?Fy(e,iy(m,e)):Oy(e,Wa(m,e))}else{if(!ue[R])return l?e:{};m=Vy(e,R,w)}}f||(f=new lt);var T=f.get(e);if(T)return T;f.set(e,m),dh(e)?e.forEach(function(U){m.add(st(U,t,n,U,e,f))}):lh(e)&&e.forEach(function(U,Z){m.set(Z,st(U,t,n,Z,e,f))});var z=S?b?Dn:qn:b?je:Ce,G=C?s:z(e);return et(G||e,function(U,Z){G&&(Z=U,U=e[Z]),Zi(m,Z,st(U,t,n,Z,e,f))}),m}function sy(e){var t=Ce(e);return function(n){return Qa(n,e,t)}}function Qa(e,t,n){var h=n.length;if(e==null)return!h;for(e=he(e);h--;){var l=n[h],f=t[l],m=e[l];if(m===s&&!(l in e)||!f(m))return!1}return!0}function Ya(e,t,n){if(typeof e!="function")throw new tt(g);return ns(function(){e.apply(s,n)},t)}function Xi(e,t,n,h){var l=-1,f=Es,m=!0,w=e.length,b=[],S=t.length;if(!w)return b;n&&(t=fe(t,Ke(n))),h?(f=Wr,m=!1):t.length>=a&&(f=Ki,m=!1,t=new si(t));e:for(;++l<w;){var C=e[l],R=n==null?C:n(C);if(C=h||C!==0?C:0,m&&R===R){for(var D=S;D--;)if(t[D]===R)continue e;b.push(C)}else f(t,R,h)||b.push(C)}return b}var Bt=Pc(vt),Za=Pc(pn,!0);function ry(e,t){var n=!0;return Bt(e,function(h,l,f){return n=!!t(h,l,f),n}),n}function zs(e,t,n){for(var h=-1,l=e.length;++h<l;){var f=e[h],m=t(f);if(m!=null&&(w===s?m===m&&!Ge(m):n(m,w)))var w=m,b=f}return b}function ny(e,t,n,h){var l=e.length;for(n=J(n),n<0&&(n=-n>l?0:l+n),h=h===s||h>l?l:J(h),h<0&&(h+=l),h=n>h?0:fh(h);n<h;)e[n++]=t;return e}function Xa(e,t){var n=[];return Bt(e,function(h,l,f){t(h,l,f)&&n.push(h)}),n}function qe(e,t,n,h,l){var f=-1,m=e.length;for(n||(n=Jy),l||(l=[]);++f<m;){var w=e[f];t>0&&n(w)?t>1?qe(w,t-1,n,h,l):Ut(l,w):h||(l[l.length]=w)}return l}var ln=Sc(),ec=Sc(!0);function vt(e,t){return e&&ln(e,t,Ce)}function pn(e,t){return e&&ec(e,t,Ce)}function Us(e,t){return zt(t,function(n){return Ft(e[n])})}function ni(e,t){t=Kt(t,e);for(var n=0,h=t.length;e!=null&&n<h;)e=e[_t(t[n++])];return n&&n==h?e:s}function tc(e,t,n){var h=t(e);return V(e)?h:Ut(h,n(e))}function Oe(e){return e==null?e===s?Fd:Ad:ti&&ti in he(e)?Uy(e):em(e)}function dn(e,t){return e>t}function oy(e,t){return e!=null&&ce.call(e,t)}function ay(e,t){return e!=null&&t in he(e)}function cy(e,t,n){return e>=De(t,n)&&e<Pe(t,n)}function gn(e,t,n){for(var h=n?Wr:Es,l=e[0].length,f=e.length,m=f,w=I(f),b=1/0,S=[];m--;){var C=e[m];m&&t&&(C=fe(C,Ke(t))),b=De(C.length,b),w[m]=!n&&(t||l>=120&&C.length>=120)?new si(m&&C):s}C=e[0];var R=-1,D=w[0];e:for(;++R<l&&S.length<b;){var T=C[R],z=t?t(T):T;if(T=n||T!==0?T:0,!(D?Ki(D,z):h(S,z,n))){for(m=f;--m;){var G=w[m];if(!(G?Ki(G,z):h(e[m],z,n)))continue e}D&&D.push(z),S.push(T)}}return S}function hy(e,t,n,h){return vt(e,function(l,f,m){t(h,n(l),f,m)}),h}function es(e,t,n){t=Kt(t,e),e=Lc(e,t);var h=e==null?e:e[_t(nt(t))];return h==null?s:Ve(h,e,n)}function ic(e){return me(e)&&Oe(e)==mt}function uy(e){return me(e)&&Oe(e)==Vi}function ly(e){return me(e)&&Oe(e)==zi}function ts(e,t,n,h,l){return e===t?!0:e==null||t==null||!me(e)&&!me(t)?e!==e&&t!==t:py(e,t,n,h,ts,l)}function py(e,t,n,h,l,f){var m=V(e),w=V(t),b=m?fi:Ae(e),S=w?fi:Ae(t);b=b==mt?Ct:b,S=S==mt?Ct:S;var C=b==Ct,R=S==Ct,D=b==S;if(D&&Gt(e)){if(!Gt(t))return!1;m=!0,C=!1}if(D&&!C)return f||(f=new lt),m||qi(e)?Tc(e,t,n,h,l,f):jy(e,t,b,n,h,l,f);if(!(n&F)){var T=C&&ce.call(e,"__wrapped__"),z=R&&ce.call(t,"__wrapped__");if(T||z){var G=T?e.value():e,U=z?t.value():t;return f||(f=new lt),l(G,U,n,h,f)}}return D?(f||(f=new lt),zy(e,t,n,h,l,f)):!1}function dy(e){return me(e)&&Ae(e)==ct}function fn(e,t,n,h){var l=n.length,f=l,m=!h;if(e==null)return!f;for(e=he(e);l--;){var w=n[l];if(m&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++l<f;){w=n[l];var b=w[0],S=e[b],C=w[1];if(m&&w[2]){if(S===s&&!(b in e))return!1}else{var R=new lt;if(h)var D=h(S,C,b,e,t,R);if(!(D===s?ts(C,S,F|H,h,R):D))return!1}}return!0}function sc(e){if(!ye(e)||Wy(e))return!1;var t=Ft(e)?df:ig;return t.test(ai(e))}function gy(e){return me(e)&&Oe(e)==Li}function fy(e){return me(e)&&Ae(e)==ht}function yy(e){return me(e)&&rr(e.length)&&!!pe[Oe(e)]}function rc(e){return typeof e=="function"?e:e==null?ze:typeof e=="object"?V(e)?ac(e[0],e[1]):oc(e):Ch(e)}function yn(e){if(!rs(e))return wf(e);var t=[];for(var n in he(e))ce.call(e,n)&&n!="constructor"&&t.push(n);return t}function my(e){if(!ye(e))return Xy(e);var t=rs(e),n=[];for(var h in e)h=="constructor"&&(t||!ce.call(e,h))||n.push(h);return n}function mn(e,t){return e<t}function nc(e,t){var n=-1,h=Me(e)?I(e.length):[];return Bt(e,function(l,f,m){h[++n]=t(l,f,m)}),h}function oc(e){var t=On(e);return t.length==1&&t[0][2]?zc(t[0][0],t[0][1]):function(n){return n===e||fn(n,e,t)}}function ac(e,t){return Nn(e)&&jc(t)?zc(_t(e),t):function(n){var h=Bn(n,e);return h===s&&h===t?Vn(n,e):ts(t,h,F|H)}}function Ls(e,t,n,h,l){e!==t&&ln(t,function(f,m){if(l||(l=new lt),ye(f))vy(e,t,m,n,Ls,h,l);else{var w=h?h($n(e,m),f,m+"",e,t,l):s;w===s&&(w=f),hn(e,m,w)}},je)}function vy(e,t,n,h,l,f,m){var w=$n(e,n),b=$n(t,n),S=m.get(b);if(S){hn(e,n,S);return}var C=f?f(w,b,n+"",e,t,m):s,R=C===s;if(R){var D=V(b),T=!D&&Gt(b),z=!D&&!T&&qi(b);C=b,D||T||z?V(w)?C=w:ve(w)?C=ke(w):T?(R=!1,C=wc(b,!0)):z?(R=!1,C=_c(b,!0)):C=[]:os(b)||ci(b)?(C=w,ci(w)?C=yh(w):(!ye(w)||Ft(w))&&(C=Mc(b))):R=!1}R&&(m.set(b,C),l(C,b,h,f,m),m.delete(b)),hn(e,n,C)}function cc(e,t){var n=e.length;if(n)return t+=t<0?n:0,Ot(t,n)?e[t]:s}function hc(e,t,n){t.length?t=fe(t,function(f){return V(f)?function(m){return ni(m,f.length===1?f[0]:f)}:f}):t=[ze];var h=-1;t=fe(t,Ke(j()));var l=nc(e,function(f,m,w){var b=fe(t,function(S){return S(f)});return{criteria:b,index:++h,value:f}});return Bg(l,function(f,m){return Ay(f,m,n)})}function wy(e,t){return uc(e,t,function(n,h){return Vn(e,h)})}function uc(e,t,n){for(var h=-1,l=t.length,f={};++h<l;){var m=t[h],w=ni(e,m);n(w,m)&&is(f,Kt(m,e),w)}return f}function _y(e){return function(t){return ni(t,e)}}function vn(e,t,n,h){var l=h?Hg:vi,f=-1,m=t.length,w=e;for(e===t&&(t=ke(t)),n&&(w=fe(e,Ke(n)));++f<m;)for(var b=0,S=t[f],C=n?n(S):S;(b=l(w,C,b,h))>-1;)w!==e&&Os.call(w,b,1),Os.call(e,b,1);return e}function lc(e,t){for(var n=e?t.length:0,h=n-1;n--;){var l=t[n];if(n==h||l!==f){var f=l;Ot(l)?Os.call(e,l,1):En(e,l)}}return e}function wn(e,t){return e+Ts(Va()*(t-e+1))}function by(e,t,n,h){for(var l=-1,f=Pe(Ns((t-e)/(n||1)),0),m=I(f);f--;)m[h?f:++l]=e,e+=n;return m}function _n(e,t){var n="";if(!e||t<1||t>Be)return n;do t%2&&(n+=e),t=Ts(t/2),t&&(e+=e);while(t);return n}function Q(e,t){return kn(Uc(e,t,ze),e+"")}function Ey(e){return Ga(Di(e))}function Iy(e,t){var n=Di(e);return Zs(n,ri(t,0,n.length))}function is(e,t,n,h){if(!ye(e))return e;t=Kt(t,e);for(var l=-1,f=t.length,m=f-1,w=e;w!=null&&++l<f;){var b=_t(t[l]),S=n;if(b==="__proto__"||b==="constructor"||b==="prototype")return e;if(l!=m){var C=w[b];S=h?h(C,b,w):s,S===s&&(S=ye(C)?C:Ot(t[l+1])?[]:{})}Zi(w,b,S),w=w[b]}return e}var pc=$s?function(e,t){return $s.set(e,t),e}:ze,Py=Fs?function(e,t){return Fs(e,"toString",{configurable:!0,enumerable:!1,value:Jn(t),writable:!0})}:ze;function Sy(e){return Zs(Di(e))}function rt(e,t,n){var h=-1,l=e.length;t<0&&(t=-t>l?0:l+t),n=n>l?l:n,n<0&&(n+=l),l=t>n?0:n-t>>>0,t>>>=0;for(var f=I(l);++h<l;)f[h]=e[h+t];return f}function Cy(e,t){var n;return Bt(e,function(h,l,f){return n=t(h,l,f),!n}),!!n}function Hs(e,t,n){var h=0,l=e==null?h:e.length;if(typeof t=="number"&&t===t&&l<=fs){for(;h<l;){var f=h+l>>>1,m=e[f];m!==null&&!Ge(m)&&(n?m<=t:m<t)?h=f+1:l=f}return l}return bn(e,t,ze,n)}function bn(e,t,n,h){var l=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var m=t!==t,w=t===null,b=Ge(t),S=t===s;l<f;){var C=Ts((l+f)/2),R=n(e[C]),D=R!==s,T=R===null,z=R===R,G=Ge(R);if(m)var U=h||z;else S?U=z&&(h||D):w?U=z&&D&&(h||!T):b?U=z&&D&&!T&&(h||!G):T||G?U=!1:U=h?R<=t:R<t;U?l=C+1:f=C}return De(f,Mi)}function dc(e,t){for(var n=-1,h=e.length,l=0,f=[];++n<h;){var m=e[n],w=t?t(m):m;if(!n||!pt(w,b)){var b=w;f[l++]=m===0?0:m}}return f}function gc(e){return typeof e=="number"?e:Ge(e)?yt:+e}function Je(e){if(typeof e=="string")return e;if(V(e))return fe(e,Je)+"";if(Ge(e))return Ka?Ka.call(e):"";var t=e+"";return t=="0"&&1/e==-ft?"-0":t}function Vt(e,t,n){var h=-1,l=Es,f=e.length,m=!0,w=[],b=w;if(n)m=!1,l=Wr;else if(f>=a){var S=t?null:ky(e);if(S)return Ps(S);m=!1,l=Ki,b=new si}else b=t?[]:w;e:for(;++h<f;){var C=e[h],R=t?t(C):C;if(C=n||C!==0?C:0,m&&R===R){for(var D=b.length;D--;)if(b[D]===R)continue e;t&&b.push(R),w.push(C)}else l(b,R,n)||(b!==w&&b.push(R),w.push(C))}return w}function En(e,t){return t=Kt(t,e),e=Lc(e,t),e==null||delete e[_t(nt(t))]}function fc(e,t,n,h){return is(e,t,n(ni(e,t)),h)}function Bs(e,t,n,h){for(var l=e.length,f=h?l:-1;(h?f--:++f<l)&&t(e[f],f,e););return n?rt(e,h?0:f,h?f+1:l):rt(e,h?f+1:0,h?l:f)}function yc(e,t){var n=e;return n instanceof X&&(n=n.value()),Qr(t,function(h,l){return l.func.apply(l.thisArg,Ut([h],l.args))},n)}function In(e,t,n){var h=e.length;if(h<2)return h?Vt(e[0]):[];for(var l=-1,f=I(h);++l<h;)for(var m=e[l],w=-1;++w<h;)w!=l&&(f[l]=Xi(f[l]||m,e[w],t,n));return Vt(qe(f,1),t,n)}function mc(e,t,n){for(var h=-1,l=e.length,f=t.length,m={};++h<l;){var w=h<f?t[h]:s;n(m,e[h],w)}return m}function Pn(e){return ve(e)?e:[]}function Sn(e){return typeof e=="function"?e:ze}function Kt(e,t){return V(e)?e:Nn(e,t)?[e]:Kc(oe(e))}var xy=Q;function Jt(e,t,n){var h=e.length;return n=n===s?h:n,!t&&n>=h?e:rt(e,t,n)}var vc=gf||function(e){return Re.clearTimeout(e)};function wc(e,t){if(t)return e.slice();var n=e.length,h=za?za(n):new e.constructor(n);return e.copy(h),h}function Cn(e){var t=new e.constructor(e.byteLength);return new Ds(t).set(new Ds(e)),t}function Ry(e,t){var n=t?Cn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function qy(e){var t=new e.constructor(e.source,ia.exec(e));return t.lastIndex=e.lastIndex,t}function Dy(e){return Yi?he(Yi.call(e)):{}}function _c(e,t){var n=t?Cn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function bc(e,t){if(e!==t){var n=e!==s,h=e===null,l=e===e,f=Ge(e),m=t!==s,w=t===null,b=t===t,S=Ge(t);if(!w&&!S&&!f&&e>t||f&&m&&b&&!w&&!S||h&&m&&b||!n&&b||!l)return 1;if(!h&&!f&&!S&&e<t||S&&n&&l&&!h&&!f||w&&n&&l||!m&&l||!b)return-1}return 0}function Ay(e,t,n){for(var h=-1,l=e.criteria,f=t.criteria,m=l.length,w=n.length;++h<m;){var b=bc(l[h],f[h]);if(b){if(h>=w)return b;var S=n[h];return b*(S=="desc"?-1:1)}}return e.index-t.index}function Ec(e,t,n,h){for(var l=-1,f=e.length,m=n.length,w=-1,b=t.length,S=Pe(f-m,0),C=I(b+S),R=!h;++w<b;)C[w]=t[w];for(;++l<m;)(R||l<f)&&(C[n[l]]=e[l]);for(;S--;)C[w++]=e[l++];return C}function Ic(e,t,n,h){for(var l=-1,f=e.length,m=-1,w=n.length,b=-1,S=t.length,C=Pe(f-w,0),R=I(C+S),D=!h;++l<C;)R[l]=e[l];for(var T=l;++b<S;)R[T+b]=t[b];for(;++m<w;)(D||l<f)&&(R[T+n[m]]=e[l++]);return R}function ke(e,t){var n=-1,h=e.length;for(t||(t=I(h));++n<h;)t[n]=e[n];return t}function wt(e,t,n,h){var l=!n;n||(n={});for(var f=-1,m=t.length;++f<m;){var w=t[f],b=h?h(n[w],e[w],w,n,e):s;b===s&&(b=e[w]),l?qt(n,w,b):Zi(n,w,b)}return n}function Oy(e,t){return wt(e,Fn(e),t)}function Fy(e,t){return wt(e,$c(e),t)}function Vs(e,t){return function(n,h){var l=V(n)?kg:ty,f=t?t():{};return l(n,e,j(h,2),f)}}function Ci(e){return Q(function(t,n){var h=-1,l=n.length,f=l>1?n[l-1]:s,m=l>2?n[2]:s;for(f=e.length>3&&typeof f=="function"?(l--,f):s,m&&Fe(n[0],n[1],m)&&(f=l<3?s:f,l=1),t=he(t);++h<l;){var w=n[h];w&&e(t,w,h,f)}return t})}function Pc(e,t){return function(n,h){if(n==null)return n;if(!Me(n))return e(n,h);for(var l=n.length,f=t?l:-1,m=he(n);(t?f--:++f<l)&&h(m[f],f,m)!==!1;);return n}}function Sc(e){return function(t,n,h){for(var l=-1,f=he(t),m=h(t),w=m.length;w--;){var b=m[e?w:++l];if(n(f[b],b,f)===!1)break}return t}}function Ny(e,t,n){var h=t&K,l=ss(e);function f(){var m=this&&this!==Re&&this instanceof f?l:e;return m.apply(h?n:this,arguments)}return f}function Cc(e){return function(t){t=oe(t);var n=wi(t)?ut(t):s,h=n?n[0]:t.charAt(0),l=n?Jt(n,1).join(""):t.slice(1);return h[e]()+l}}function xi(e){return function(t){return Qr(Ph(Ih(t).replace(Ig,"")),e,"")}}function ss(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Si(e.prototype),h=e.apply(n,t);return ye(h)?h:n}}function Ty(e,t,n){var h=ss(e);function l(){for(var f=arguments.length,m=I(f),w=f,b=Ri(l);w--;)m[w]=arguments[w];var S=f<3&&m[0]!==b&&m[f-1]!==b?[]:Lt(m,b);if(f-=S.length,f<n)return Ac(e,t,Ks,l.placeholder,s,m,S,s,s,n-f);var C=this&&this!==Re&&this instanceof l?h:e;return Ve(C,this,m)}return l}function xc(e){return function(t,n,h){var l=he(t);if(!Me(t)){var f=j(n,3);t=Ce(t),n=function(w){return f(l[w],w,l)}}var m=e(t,n,h);return m>-1?l[f?t[m]:m]:s}}function Rc(e){return At(function(t){var n=t.length,h=n,l=it.prototype.thru;for(e&&t.reverse();h--;){var f=t[h];if(typeof f!="function")throw new tt(g);if(l&&!m&&Qs(f)=="wrapper")var m=new it([],!0)}for(h=m?h:n;++h<n;){f=t[h];var w=Qs(f),b=w=="wrapper"?An(f):s;b&&Tn(b[0])&&b[1]==(ge|ie|se|Ee)&&!b[4].length&&b[9]==1?m=m[Qs(b[0])].apply(m,b[3]):m=f.length==1&&Tn(f)?m[w]():m.thru(f)}return function(){var S=arguments,C=S[0];if(m&&S.length==1&&V(C))return m.plant(C).value();for(var R=0,D=n?t[R].apply(this,S):C;++R<n;)D=t[R].call(this,D);return D}})}function Ks(e,t,n,h,l,f,m,w,b,S){var C=t&ge,R=t&K,D=t&Y,T=t&(ie|re),z=t&Le,G=D?s:ss(e);function U(){for(var Z=arguments.length,te=I(Z),We=Z;We--;)te[We]=arguments[We];if(T)var Ne=Ri(U),Qe=Kg(te,Ne);if(h&&(te=Ec(te,h,l,T)),f&&(te=Ic(te,f,m,T)),Z-=Qe,T&&Z<S){var we=Lt(te,Ne);return Ac(e,t,Ks,U.placeholder,n,te,we,w,b,S-Z)}var dt=R?n:this,Tt=D?dt[e]:e;return Z=te.length,w?te=tm(te,w):z&&Z>1&&te.reverse(),C&&b<Z&&(te.length=b),this&&this!==Re&&this instanceof U&&(Tt=G||ss(Tt)),Tt.apply(dt,te)}return U}function qc(e,t){return function(n,h){return hy(n,e,t(h),{})}}function Js(e,t){return function(n,h){var l;if(n===s&&h===s)return t;if(n!==s&&(l=n),h!==s){if(l===s)return h;typeof n=="string"||typeof h=="string"?(n=Je(n),h=Je(h)):(n=gc(n),h=gc(h)),l=e(n,h)}return l}}function xn(e){return At(function(t){return t=fe(t,Ke(j())),Q(function(n){var h=this;return e(t,function(l){return Ve(l,h,n)})})})}function Gs(e,t){t=t===s?" ":Je(t);var n=t.length;if(n<2)return n?_n(t,e):t;var h=_n(t,Ns(e/_i(t)));return wi(t)?Jt(ut(h),0,e).join(""):h.slice(0,e)}function $y(e,t,n,h){var l=t&K,f=ss(e);function m(){for(var w=-1,b=arguments.length,S=-1,C=h.length,R=I(C+b),D=this&&this!==Re&&this instanceof m?f:e;++S<C;)R[S]=h[S];for(;b--;)R[S++]=arguments[++w];return Ve(D,l?n:this,R)}return m}function Dc(e){return function(t,n,h){return h&&typeof h!="number"&&Fe(t,n,h)&&(n=h=s),t=Nt(t),n===s?(n=t,t=0):n=Nt(n),h=h===s?t<n?1:-1:Nt(h),by(t,n,h,e)}}function Ws(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=ot(t),n=ot(n)),e(t,n)}}function Ac(e,t,n,h,l,f,m,w,b,S){var C=t&ie,R=C?m:s,D=C?s:m,T=C?f:s,z=C?s:f;t|=C?se:_e,t&=~(C?_e:se),t&ae||(t&=~(K|Y));var G=[e,t,l,T,R,z,D,w,b,S],U=n.apply(s,G);return Tn(e)&&Hc(U,G),U.placeholder=h,Bc(U,e,t)}function Rn(e){var t=Ie[e];return function(n,h){if(n=ot(n),h=h==null?0:De(J(h),292),h&&Ba(n)){var l=(oe(n)+"e").split("e"),f=t(l[0]+"e"+(+l[1]+h));return l=(oe(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-h))}return t(n)}}var ky=Ii&&1/Ps(new Ii([,-0]))[1]==ft?function(e){return new Ii(e)}:Qn;function Oc(e){return function(t){var n=Ae(t);return n==ct?rn(t):n==ht?Xg(t):Vg(t,e(t))}}function Dt(e,t,n,h,l,f,m,w){var b=t&Y;if(!b&&typeof e!="function")throw new tt(g);var S=h?h.length:0;if(S||(t&=~(se|_e),h=l=s),m=m===s?m:Pe(J(m),0),w=w===s?w:J(w),S-=l?l.length:0,t&_e){var C=h,R=l;h=l=s}var D=b?s:An(e),T=[e,t,n,h,l,C,R,f,m,w];if(D&&Zy(T,D),e=T[0],t=T[1],n=T[2],h=T[3],l=T[4],w=T[9]=T[9]===s?b?0:e.length:Pe(T[9]-S,0),!w&&t&(ie|re)&&(t&=~(ie|re)),!t||t==K)var z=Ny(e,t,n);else t==ie||t==re?z=Ty(e,t,w):(t==se||t==(K|se))&&!l.length?z=$y(e,t,n,h):z=Ks.apply(s,T);var G=D?pc:Hc;return Bc(G(z,T),e,t)}function Fc(e,t,n,h){return e===s||pt(e,Ei[n])&&!ce.call(h,n)?t:e}function Nc(e,t,n,h,l,f){return ye(e)&&ye(t)&&(f.set(t,e),Ls(e,t,s,Nc,f),f.delete(t)),e}function My(e){return os(e)?s:e}function Tc(e,t,n,h,l,f){var m=n&F,w=e.length,b=t.length;if(w!=b&&!(m&&b>w))return!1;var S=f.get(e),C=f.get(t);if(S&&C)return S==t&&C==e;var R=-1,D=!0,T=n&H?new si:s;for(f.set(e,t),f.set(t,e);++R<w;){var z=e[R],G=t[R];if(h)var U=m?h(G,z,R,t,e,f):h(z,G,R,e,t,f);if(U!==s){if(U)continue;D=!1;break}if(T){if(!Yr(t,function(Z,te){if(!Ki(T,te)&&(z===Z||l(z,Z,n,h,f)))return T.push(te)})){D=!1;break}}else if(!(z===G||l(z,G,n,h,f))){D=!1;break}}return f.delete(e),f.delete(t),D}function jy(e,t,n,h,l,f,m){switch(n){case yi:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Vi:return!(e.byteLength!=t.byteLength||!f(new Ds(e),new Ds(t)));case ji:case zi:case Ui:return pt(+e,+t);case ys:return e.name==t.name&&e.message==t.message;case Li:case Hi:return e==t+"";case ct:var w=rn;case ht:var b=h&F;if(w||(w=Ps),e.size!=t.size&&!b)return!1;var S=m.get(e);if(S)return S==t;h|=H,m.set(e,t);var C=Tc(w(e),w(t),h,l,f,m);return m.delete(e),C;case vs:if(Yi)return Yi.call(e)==Yi.call(t)}return!1}function zy(e,t,n,h,l,f){var m=n&F,w=qn(e),b=w.length,S=qn(t),C=S.length;if(b!=C&&!m)return!1;for(var R=b;R--;){var D=w[R];if(!(m?D in t:ce.call(t,D)))return!1}var T=f.get(e),z=f.get(t);if(T&&z)return T==t&&z==e;var G=!0;f.set(e,t),f.set(t,e);for(var U=m;++R<b;){D=w[R];var Z=e[D],te=t[D];if(h)var We=m?h(te,Z,D,t,e,f):h(Z,te,D,e,t,f);if(!(We===s?Z===te||l(Z,te,n,h,f):We)){G=!1;break}U||(U=D=="constructor")}if(G&&!U){var Ne=e.constructor,Qe=t.constructor;Ne!=Qe&&"constructor"in e&&"constructor"in t&&!(typeof Ne=="function"&&Ne instanceof Ne&&typeof Qe=="function"&&Qe instanceof Qe)&&(G=!1)}return f.delete(e),f.delete(t),G}function At(e){return kn(Uc(e,s,Qc),e+"")}function qn(e){return tc(e,Ce,Fn)}function Dn(e){return tc(e,je,$c)}var An=$s?function(e){return $s.get(e)}:Qn;function Qs(e){for(var t=e.name+"",n=Pi[t],h=ce.call(Pi,t)?n.length:0;h--;){var l=n[h],f=l.func;if(f==null||f==e)return l.name}return t}function Ri(e){var t=ce.call(p,"placeholder")?p:e;return t.placeholder}function j(){var e=p.iteratee||Gn;return e=e===Gn?rc:e,arguments.length?e(arguments[0],arguments[1]):e}function Ys(e,t){var n=e.__data__;return Gy(t)?n[typeof t=="string"?"string":"hash"]:n.map}function On(e){for(var t=Ce(e),n=t.length;n--;){var h=t[n],l=e[h];t[n]=[h,l,jc(l)]}return t}function oi(e,t){var n=Qg(e,t);return sc(n)?n:s}function Uy(e){var t=ce.call(e,ti),n=e[ti];try{e[ti]=s;var h=!0}catch{}var l=Rs.call(e);return h&&(t?e[ti]=n:delete e[ti]),l}var Fn=on?function(e){return e==null?[]:(e=he(e),zt(on(e),function(t){return La.call(e,t)}))}:Yn,$c=on?function(e){for(var t=[];e;)Ut(t,Fn(e)),e=As(e);return t}:Yn,Ae=Oe;(an&&Ae(new an(new ArrayBuffer(1)))!=yi||Gi&&Ae(new Gi)!=ct||cn&&Ae(cn.resolve())!=Zo||Ii&&Ae(new Ii)!=ht||Wi&&Ae(new Wi)!=Bi)&&(Ae=function(e){var t=Oe(e),n=t==Ct?e.constructor:s,h=n?ai(n):"";if(h)switch(h){case If:return yi;case Pf:return ct;case Sf:return Zo;case Cf:return ht;case xf:return Bi}return t});function Ly(e,t,n){for(var h=-1,l=n.length;++h<l;){var f=n[h],m=f.size;switch(f.type){case"drop":e+=m;break;case"dropRight":t-=m;break;case"take":t=De(t,e+m);break;case"takeRight":e=Pe(e,t-m);break}}return{start:e,end:t}}function Hy(e){var t=e.match(Gd);return t?t[1].split(Wd):[]}function kc(e,t,n){t=Kt(t,e);for(var h=-1,l=t.length,f=!1;++h<l;){var m=_t(t[h]);if(!(f=e!=null&&n(e,m)))break;e=e[m]}return f||++h!=l?f:(l=e==null?0:e.length,!!l&&rr(l)&&Ot(m,l)&&(V(e)||ci(e)))}function By(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&ce.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Mc(e){return typeof e.constructor=="function"&&!rs(e)?Si(As(e)):{}}function Vy(e,t,n){var h=e.constructor;switch(t){case Vi:return Cn(e);case ji:case zi:return new h(+e);case yi:return Ry(e,n);case Ar:case Or:case Fr:case Nr:case Tr:case $r:case kr:case Mr:case jr:return _c(e,n);case ct:return new h;case Ui:case Hi:return new h(e);case Li:return qy(e);case ht:return new h;case vs:return Dy(e)}}function Ky(e,t){var n=t.length;if(!n)return e;var h=n-1;return t[h]=(n>1?"& ":"")+t[h],t=t.join(n>2?", ":" "),e.replace(Jd,`{
/* [wrapped with `+t+`] */
`)}function Jy(e){return V(e)||ci(e)||!!(Ha&&e&&e[Ha])}function Ot(e,t){var n=typeof e;return t=t??Be,!!t&&(n=="number"||n!="symbol"&&rg.test(e))&&e>-1&&e%1==0&&e<t}function Fe(e,t,n){if(!ye(n))return!1;var h=typeof t;return(h=="number"?Me(n)&&Ot(t,n.length):h=="string"&&t in n)?pt(n[t],e):!1}function Nn(e,t){if(V(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Ge(e)?!0:Hd.test(e)||!Ld.test(e)||t!=null&&e in he(t)}function Gy(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Tn(e){var t=Qs(e),n=p[t];if(typeof n!="function"||!(t in X.prototype))return!1;if(e===n)return!0;var h=An(n);return!!h&&e===h[0]}function Wy(e){return!!ja&&ja in e}var Qy=Cs?Ft:Zn;function rs(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Ei;return e===n}function jc(e){return e===e&&!ye(e)}function zc(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==s||e in he(n))}}function Yy(e){var t=ir(e,function(h){return n.size===x&&n.clear(),h}),n=t.cache;return t}function Zy(e,t){var n=e[1],h=t[1],l=n|h,f=l<(K|Y|ge),m=h==ge&&n==ie||h==ge&&n==Ee&&e[7].length<=t[8]||h==(ge|Ee)&&t[7].length<=t[8]&&n==ie;if(!(f||m))return e;h&K&&(e[2]=t[2],l|=n&K?0:ae);var w=t[3];if(w){var b=e[3];e[3]=b?Ec(b,w,t[4]):w,e[4]=b?Lt(e[3],q):t[4]}return w=t[5],w&&(b=e[5],e[5]=b?Ic(b,w,t[6]):w,e[6]=b?Lt(e[5],q):t[6]),w=t[7],w&&(e[7]=w),h&ge&&(e[8]=e[8]==null?t[8]:De(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function Xy(e){var t=[];if(e!=null)for(var n in he(e))t.push(n);return t}function em(e){return Rs.call(e)}function Uc(e,t,n){return t=Pe(t===s?e.length-1:t,0),function(){for(var h=arguments,l=-1,f=Pe(h.length-t,0),m=I(f);++l<f;)m[l]=h[t+l];l=-1;for(var w=I(t+1);++l<t;)w[l]=h[l];return w[t]=n(m),Ve(e,this,w)}}function Lc(e,t){return t.length<2?e:ni(e,rt(t,0,-1))}function tm(e,t){for(var n=e.length,h=De(t.length,n),l=ke(e);h--;){var f=t[h];e[h]=Ot(f,n)?l[f]:s}return e}function $n(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Hc=Vc(pc),ns=yf||function(e,t){return Re.setTimeout(e,t)},kn=Vc(Py);function Bc(e,t,n){var h=t+"";return kn(e,Ky(h,im(Hy(h),n)))}function Vc(e){var t=0,n=0;return function(){var h=_f(),l=He-(h-n);if(n=h,l>0){if(++t>=Zt)return arguments[0]}else t=0;return e.apply(s,arguments)}}function Zs(e,t){var n=-1,h=e.length,l=h-1;for(t=t===s?h:t;++n<t;){var f=wn(n,l),m=e[f];e[f]=e[n],e[n]=m}return e.length=t,e}var Kc=Yy(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Bd,function(n,h,l,f){t.push(l?f.replace(Zd,"$1"):h||n)}),t});function _t(e){if(typeof e=="string"||Ge(e))return e;var t=e+"";return t=="0"&&1/e==-ft?"-0":t}function ai(e){if(e!=null){try{return xs.call(e)}catch{}try{return e+""}catch{}}return""}function im(e,t){return et(Dr,function(n){var h="_."+n[0];t&n[1]&&!Es(e,h)&&e.push(h)}),e.sort()}function Jc(e){if(e instanceof X)return e.clone();var t=new it(e.__wrapped__,e.__chain__);return t.__actions__=ke(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function sm(e,t,n){(n?Fe(e,t,n):t===s)?t=1:t=Pe(J(t),0);var h=e==null?0:e.length;if(!h||t<1)return[];for(var l=0,f=0,m=I(Ns(h/t));l<h;)m[f++]=rt(e,l,l+=t);return m}function rm(e){for(var t=-1,n=e==null?0:e.length,h=0,l=[];++t<n;){var f=e[t];f&&(l[h++]=f)}return l}function nm(){var e=arguments.length;if(!e)return[];for(var t=I(e-1),n=arguments[0],h=e;h--;)t[h-1]=arguments[h];return Ut(V(n)?ke(n):[n],qe(t,1))}var om=Q(function(e,t){return ve(e)?Xi(e,qe(t,1,ve,!0)):[]}),am=Q(function(e,t){var n=nt(t);return ve(n)&&(n=s),ve(e)?Xi(e,qe(t,1,ve,!0),j(n,2)):[]}),cm=Q(function(e,t){var n=nt(t);return ve(n)&&(n=s),ve(e)?Xi(e,qe(t,1,ve,!0),s,n):[]});function hm(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===s?1:J(t),rt(e,t<0?0:t,h)):[]}function um(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===s?1:J(t),t=h-t,rt(e,0,t<0?0:t)):[]}function lm(e,t){return e&&e.length?Bs(e,j(t,3),!0,!0):[]}function pm(e,t){return e&&e.length?Bs(e,j(t,3),!0):[]}function dm(e,t,n,h){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Fe(e,t,n)&&(n=0,h=l),ny(e,t,n,h)):[]}function Gc(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:J(n);return l<0&&(l=Pe(h+l,0)),Is(e,j(t,3),l)}function Wc(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h-1;return n!==s&&(l=J(n),l=n<0?Pe(h+l,0):De(l,h-1)),Is(e,j(t,3),l,!0)}function Qc(e){var t=e==null?0:e.length;return t?qe(e,1):[]}function gm(e){var t=e==null?0:e.length;return t?qe(e,ft):[]}function fm(e,t){var n=e==null?0:e.length;return n?(t=t===s?1:J(t),qe(e,t)):[]}function ym(e){for(var t=-1,n=e==null?0:e.length,h={};++t<n;){var l=e[t];h[l[0]]=l[1]}return h}function Yc(e){return e&&e.length?e[0]:s}function mm(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:J(n);return l<0&&(l=Pe(h+l,0)),vi(e,t,l)}function vm(e){var t=e==null?0:e.length;return t?rt(e,0,-1):[]}var wm=Q(function(e){var t=fe(e,Pn);return t.length&&t[0]===e[0]?gn(t):[]}),_m=Q(function(e){var t=nt(e),n=fe(e,Pn);return t===nt(n)?t=s:n.pop(),n.length&&n[0]===e[0]?gn(n,j(t,2)):[]}),bm=Q(function(e){var t=nt(e),n=fe(e,Pn);return t=typeof t=="function"?t:s,t&&n.pop(),n.length&&n[0]===e[0]?gn(n,s,t):[]});function Em(e,t){return e==null?"":vf.call(e,t)}function nt(e){var t=e==null?0:e.length;return t?e[t-1]:s}function Im(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h;return n!==s&&(l=J(n),l=l<0?Pe(h+l,0):De(l,h-1)),t===t?tf(e,t,l):Is(e,Aa,l,!0)}function Pm(e,t){return e&&e.length?cc(e,J(t)):s}var Sm=Q(Zc);function Zc(e,t){return e&&e.length&&t&&t.length?vn(e,t):e}function Cm(e,t,n){return e&&e.length&&t&&t.length?vn(e,t,j(n,2)):e}function xm(e,t,n){return e&&e.length&&t&&t.length?vn(e,t,s,n):e}var Rm=At(function(e,t){var n=e==null?0:e.length,h=un(e,t);return lc(e,fe(t,function(l){return Ot(l,n)?+l:l}).sort(bc)),h});function qm(e,t){var n=[];if(!(e&&e.length))return n;var h=-1,l=[],f=e.length;for(t=j(t,3);++h<f;){var m=e[h];t(m,h,e)&&(n.push(m),l.push(h))}return lc(e,l),n}function Mn(e){return e==null?e:Ef.call(e)}function Dm(e,t,n){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Fe(e,t,n)?(t=0,n=h):(t=t==null?0:J(t),n=n===s?h:J(n)),rt(e,t,n)):[]}function Am(e,t){return Hs(e,t)}function Om(e,t,n){return bn(e,t,j(n,2))}function Fm(e,t){var n=e==null?0:e.length;if(n){var h=Hs(e,t);if(h<n&&pt(e[h],t))return h}return-1}function Nm(e,t){return Hs(e,t,!0)}function Tm(e,t,n){return bn(e,t,j(n,2),!0)}function $m(e,t){var n=e==null?0:e.length;if(n){var h=Hs(e,t,!0)-1;if(pt(e[h],t))return h}return-1}function km(e){return e&&e.length?dc(e):[]}function Mm(e,t){return e&&e.length?dc(e,j(t,2)):[]}function jm(e){var t=e==null?0:e.length;return t?rt(e,1,t):[]}function zm(e,t,n){return e&&e.length?(t=n||t===s?1:J(t),rt(e,0,t<0?0:t)):[]}function Um(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===s?1:J(t),t=h-t,rt(e,t<0?0:t,h)):[]}function Lm(e,t){return e&&e.length?Bs(e,j(t,3),!1,!0):[]}function Hm(e,t){return e&&e.length?Bs(e,j(t,3)):[]}var Bm=Q(function(e){return Vt(qe(e,1,ve,!0))}),Vm=Q(function(e){var t=nt(e);return ve(t)&&(t=s),Vt(qe(e,1,ve,!0),j(t,2))}),Km=Q(function(e){var t=nt(e);return t=typeof t=="function"?t:s,Vt(qe(e,1,ve,!0),s,t)});function Jm(e){return e&&e.length?Vt(e):[]}function Gm(e,t){return e&&e.length?Vt(e,j(t,2)):[]}function Wm(e,t){return t=typeof t=="function"?t:s,e&&e.length?Vt(e,s,t):[]}function jn(e){if(!(e&&e.length))return[];var t=0;return e=zt(e,function(n){if(ve(n))return t=Pe(n.length,t),!0}),tn(t,function(n){return fe(e,Zr(n))})}function Xc(e,t){if(!(e&&e.length))return[];var n=jn(e);return t==null?n:fe(n,function(h){return Ve(t,s,h)})}var Qm=Q(function(e,t){return ve(e)?Xi(e,t):[]}),Ym=Q(function(e){return In(zt(e,ve))}),Zm=Q(function(e){var t=nt(e);return ve(t)&&(t=s),In(zt(e,ve),j(t,2))}),Xm=Q(function(e){var t=nt(e);return t=typeof t=="function"?t:s,In(zt(e,ve),s,t)}),e0=Q(jn);function t0(e,t){return mc(e||[],t||[],Zi)}function i0(e,t){return mc(e||[],t||[],is)}var s0=Q(function(e){var t=e.length,n=t>1?e[t-1]:s;return n=typeof n=="function"?(e.pop(),n):s,Xc(e,n)});function eh(e){var t=p(e);return t.__chain__=!0,t}function r0(e,t){return t(e),e}function Xs(e,t){return t(e)}var n0=At(function(e){var t=e.length,n=t?e[0]:0,h=this.__wrapped__,l=function(f){return un(f,e)};return t>1||this.__actions__.length||!(h instanceof X)||!Ot(n)?this.thru(l):(h=h.slice(n,+n+(t?1:0)),h.__actions__.push({func:Xs,args:[l],thisArg:s}),new it(h,this.__chain__).thru(function(f){return t&&!f.length&&f.push(s),f}))});function o0(){return eh(this)}function a0(){return new it(this.value(),this.__chain__)}function c0(){this.__values__===s&&(this.__values__=gh(this.value()));var e=this.__index__>=this.__values__.length,t=e?s:this.__values__[this.__index__++];return{done:e,value:t}}function h0(){return this}function u0(e){for(var t,n=this;n instanceof Ms;){var h=Jc(n);h.__index__=0,h.__values__=s,t?l.__wrapped__=h:t=h;var l=h;n=n.__wrapped__}return l.__wrapped__=e,t}function l0(){var e=this.__wrapped__;if(e instanceof X){var t=e;return this.__actions__.length&&(t=new X(this)),t=t.reverse(),t.__actions__.push({func:Xs,args:[Mn],thisArg:s}),new it(t,this.__chain__)}return this.thru(Mn)}function p0(){return yc(this.__wrapped__,this.__actions__)}var d0=Vs(function(e,t,n){ce.call(e,n)?++e[n]:qt(e,n,1)});function g0(e,t,n){var h=V(e)?qa:ry;return n&&Fe(e,t,n)&&(t=s),h(e,j(t,3))}function f0(e,t){var n=V(e)?zt:Xa;return n(e,j(t,3))}var y0=xc(Gc),m0=xc(Wc);function v0(e,t){return qe(er(e,t),1)}function w0(e,t){return qe(er(e,t),ft)}function _0(e,t,n){return n=n===s?1:J(n),qe(er(e,t),n)}function th(e,t){var n=V(e)?et:Bt;return n(e,j(t,3))}function ih(e,t){var n=V(e)?Mg:Za;return n(e,j(t,3))}var b0=Vs(function(e,t,n){ce.call(e,n)?e[n].push(t):qt(e,n,[t])});function E0(e,t,n,h){e=Me(e)?e:Di(e),n=n&&!h?J(n):0;var l=e.length;return n<0&&(n=Pe(l+n,0)),nr(e)?n<=l&&e.indexOf(t,n)>-1:!!l&&vi(e,t,n)>-1}var I0=Q(function(e,t,n){var h=-1,l=typeof t=="function",f=Me(e)?I(e.length):[];return Bt(e,function(m){f[++h]=l?Ve(t,m,n):es(m,t,n)}),f}),P0=Vs(function(e,t,n){qt(e,n,t)});function er(e,t){var n=V(e)?fe:nc;return n(e,j(t,3))}function S0(e,t,n,h){return e==null?[]:(V(t)||(t=t==null?[]:[t]),n=h?s:n,V(n)||(n=n==null?[]:[n]),hc(e,t,n))}var C0=Vs(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function x0(e,t,n){var h=V(e)?Qr:Fa,l=arguments.length<3;return h(e,j(t,4),n,l,Bt)}function R0(e,t,n){var h=V(e)?jg:Fa,l=arguments.length<3;return h(e,j(t,4),n,l,Za)}function q0(e,t){var n=V(e)?zt:Xa;return n(e,sr(j(t,3)))}function D0(e){var t=V(e)?Ga:Ey;return t(e)}function A0(e,t,n){(n?Fe(e,t,n):t===s)?t=1:t=J(t);var h=V(e)?Xf:Iy;return h(e,t)}function O0(e){var t=V(e)?ey:Sy;return t(e)}function F0(e){if(e==null)return 0;if(Me(e))return nr(e)?_i(e):e.length;var t=Ae(e);return t==ct||t==ht?e.size:yn(e).length}function N0(e,t,n){var h=V(e)?Yr:Cy;return n&&Fe(e,t,n)&&(t=s),h(e,j(t,3))}var T0=Q(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Fe(e,t[0],t[1])?t=[]:n>2&&Fe(t[0],t[1],t[2])&&(t=[t[0]]),hc(e,qe(t,1),[])}),tr=ff||function(){return Re.Date.now()};function $0(e,t){if(typeof t!="function")throw new tt(g);return e=J(e),function(){if(--e<1)return t.apply(this,arguments)}}function sh(e,t,n){return t=n?s:t,t=e&&t==null?e.length:t,Dt(e,ge,s,s,s,s,t)}function rh(e,t){var n;if(typeof t!="function")throw new tt(g);return e=J(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=s),n}}var zn=Q(function(e,t,n){var h=K;if(n.length){var l=Lt(n,Ri(zn));h|=se}return Dt(e,h,t,n,l)}),nh=Q(function(e,t,n){var h=K|Y;if(n.length){var l=Lt(n,Ri(nh));h|=se}return Dt(t,h,e,n,l)});function oh(e,t,n){t=n?s:t;var h=Dt(e,ie,s,s,s,s,s,t);return h.placeholder=oh.placeholder,h}function ah(e,t,n){t=n?s:t;var h=Dt(e,re,s,s,s,s,s,t);return h.placeholder=ah.placeholder,h}function ch(e,t,n){var h,l,f,m,w,b,S=0,C=!1,R=!1,D=!0;if(typeof e!="function")throw new tt(g);t=ot(t)||0,ye(n)&&(C=!!n.leading,R="maxWait"in n,f=R?Pe(ot(n.maxWait)||0,t):f,D="trailing"in n?!!n.trailing:D);function T(we){var dt=h,Tt=l;return h=l=s,S=we,m=e.apply(Tt,dt),m}function z(we){return S=we,w=ns(Z,t),C?T(we):m}function G(we){var dt=we-b,Tt=we-S,xh=t-dt;return R?De(xh,f-Tt):xh}function U(we){var dt=we-b,Tt=we-S;return b===s||dt>=t||dt<0||R&&Tt>=f}function Z(){var we=tr();if(U(we))return te(we);w=ns(Z,G(we))}function te(we){return w=s,D&&h?T(we):(h=l=s,m)}function We(){w!==s&&vc(w),S=0,h=b=l=w=s}function Ne(){return w===s?m:te(tr())}function Qe(){var we=tr(),dt=U(we);if(h=arguments,l=this,b=we,dt){if(w===s)return z(b);if(R)return vc(w),w=ns(Z,t),T(b)}return w===s&&(w=ns(Z,t)),m}return Qe.cancel=We,Qe.flush=Ne,Qe}var k0=Q(function(e,t){return Ya(e,1,t)}),M0=Q(function(e,t,n){return Ya(e,ot(t)||0,n)});function j0(e){return Dt(e,Le)}function ir(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new tt(g);var n=function(){var h=arguments,l=t?t.apply(this,h):h[0],f=n.cache;if(f.has(l))return f.get(l);var m=e.apply(this,h);return n.cache=f.set(l,m)||f,m};return n.cache=new(ir.Cache||Rt),n}ir.Cache=Rt;function sr(e){if(typeof e!="function")throw new tt(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function z0(e){return rh(2,e)}var U0=xy(function(e,t){t=t.length==1&&V(t[0])?fe(t[0],Ke(j())):fe(qe(t,1),Ke(j()));var n=t.length;return Q(function(h){for(var l=-1,f=De(h.length,n);++l<f;)h[l]=t[l].call(this,h[l]);return Ve(e,this,h)})}),Un=Q(function(e,t){var n=Lt(t,Ri(Un));return Dt(e,se,s,t,n)}),hh=Q(function(e,t){var n=Lt(t,Ri(hh));return Dt(e,_e,s,t,n)}),L0=At(function(e,t){return Dt(e,Ee,s,s,s,t)});function H0(e,t){if(typeof e!="function")throw new tt(g);return t=t===s?t:J(t),Q(e,t)}function B0(e,t){if(typeof e!="function")throw new tt(g);return t=t==null?0:Pe(J(t),0),Q(function(n){var h=n[t],l=Jt(n,0,t);return h&&Ut(l,h),Ve(e,this,l)})}function V0(e,t,n){var h=!0,l=!0;if(typeof e!="function")throw new tt(g);return ye(n)&&(h="leading"in n?!!n.leading:h,l="trailing"in n?!!n.trailing:l),ch(e,t,{leading:h,maxWait:t,trailing:l})}function K0(e){return sh(e,1)}function J0(e,t){return Un(Sn(t),e)}function G0(){if(!arguments.length)return[];var e=arguments[0];return V(e)?e:[e]}function W0(e){return st(e,M)}function Q0(e,t){return t=typeof t=="function"?t:s,st(e,M,t)}function Y0(e){return st(e,A|M)}function Z0(e,t){return t=typeof t=="function"?t:s,st(e,A|M,t)}function X0(e,t){return t==null||Qa(e,t,Ce(t))}function pt(e,t){return e===t||e!==e&&t!==t}var ev=Ws(dn),tv=Ws(function(e,t){return e>=t}),ci=ic(function(){return arguments}())?ic:function(e){return me(e)&&ce.call(e,"callee")&&!La.call(e,"callee")},V=I.isArray,iv=Ia?Ke(Ia):uy;function Me(e){return e!=null&&rr(e.length)&&!Ft(e)}function ve(e){return me(e)&&Me(e)}function sv(e){return e===!0||e===!1||me(e)&&Oe(e)==ji}var Gt=mf||Zn,rv=Pa?Ke(Pa):ly;function nv(e){return me(e)&&e.nodeType===1&&!os(e)}function ov(e){if(e==null)return!0;if(Me(e)&&(V(e)||typeof e=="string"||typeof e.splice=="function"||Gt(e)||qi(e)||ci(e)))return!e.length;var t=Ae(e);if(t==ct||t==ht)return!e.size;if(rs(e))return!yn(e).length;for(var n in e)if(ce.call(e,n))return!1;return!0}function av(e,t){return ts(e,t)}function cv(e,t,n){n=typeof n=="function"?n:s;var h=n?n(e,t):s;return h===s?ts(e,t,s,n):!!h}function Ln(e){if(!me(e))return!1;var t=Oe(e);return t==ys||t==Dd||typeof e.message=="string"&&typeof e.name=="string"&&!os(e)}function hv(e){return typeof e=="number"&&Ba(e)}function Ft(e){if(!ye(e))return!1;var t=Oe(e);return t==ms||t==Yo||t==qd||t==Od}function uh(e){return typeof e=="number"&&e==J(e)}function rr(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Be}function ye(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function me(e){return e!=null&&typeof e=="object"}var lh=Sa?Ke(Sa):dy;function uv(e,t){return e===t||fn(e,t,On(t))}function lv(e,t,n){return n=typeof n=="function"?n:s,fn(e,t,On(t),n)}function pv(e){return ph(e)&&e!=+e}function dv(e){if(Qy(e))throw new B(u);return sc(e)}function gv(e){return e===null}function fv(e){return e==null}function ph(e){return typeof e=="number"||me(e)&&Oe(e)==Ui}function os(e){if(!me(e)||Oe(e)!=Ct)return!1;var t=As(e);if(t===null)return!0;var n=ce.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&xs.call(n)==lf}var Hn=Ca?Ke(Ca):gy;function yv(e){return uh(e)&&e>=-Be&&e<=Be}var dh=xa?Ke(xa):fy;function nr(e){return typeof e=="string"||!V(e)&&me(e)&&Oe(e)==Hi}function Ge(e){return typeof e=="symbol"||me(e)&&Oe(e)==vs}var qi=Ra?Ke(Ra):yy;function mv(e){return e===s}function vv(e){return me(e)&&Ae(e)==Bi}function wv(e){return me(e)&&Oe(e)==Nd}var _v=Ws(mn),bv=Ws(function(e,t){return e<=t});function gh(e){if(!e)return[];if(Me(e))return nr(e)?ut(e):ke(e);if(Ji&&e[Ji])return Zg(e[Ji]());var t=Ae(e),n=t==ct?rn:t==ht?Ps:Di;return n(e)}function Nt(e){if(!e)return e===0?e:0;if(e=ot(e),e===ft||e===-ft){var t=e<0?-1:1;return t*gi}return e===e?e:0}function J(e){var t=Nt(e),n=t%1;return t===t?n?t-n:t:0}function fh(e){return e?ri(J(e),0,$e):0}function ot(e){if(typeof e=="number")return e;if(Ge(e))return yt;if(ye(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ye(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Na(e);var n=tg.test(e);return n||sg.test(e)?Tg(e.slice(2),n?2:8):eg.test(e)?yt:+e}function yh(e){return wt(e,je(e))}function Ev(e){return e?ri(J(e),-Be,Be):e===0?e:0}function oe(e){return e==null?"":Je(e)}var Iv=Ci(function(e,t){if(rs(t)||Me(t)){wt(t,Ce(t),e);return}for(var n in t)ce.call(t,n)&&Zi(e,n,t[n])}),mh=Ci(function(e,t){wt(t,je(t),e)}),or=Ci(function(e,t,n,h){wt(t,je(t),e,h)}),Pv=Ci(function(e,t,n,h){wt(t,Ce(t),e,h)}),Sv=At(un);function Cv(e,t){var n=Si(e);return t==null?n:Wa(n,t)}var xv=Q(function(e,t){e=he(e);var n=-1,h=t.length,l=h>2?t[2]:s;for(l&&Fe(t[0],t[1],l)&&(h=1);++n<h;)for(var f=t[n],m=je(f),w=-1,b=m.length;++w<b;){var S=m[w],C=e[S];(C===s||pt(C,Ei[S])&&!ce.call(e,S))&&(e[S]=f[S])}return e}),Rv=Q(function(e){return e.push(s,Nc),Ve(vh,s,e)});function qv(e,t){return Da(e,j(t,3),vt)}function Dv(e,t){return Da(e,j(t,3),pn)}function Av(e,t){return e==null?e:ln(e,j(t,3),je)}function Ov(e,t){return e==null?e:ec(e,j(t,3),je)}function Fv(e,t){return e&&vt(e,j(t,3))}function Nv(e,t){return e&&pn(e,j(t,3))}function Tv(e){return e==null?[]:Us(e,Ce(e))}function $v(e){return e==null?[]:Us(e,je(e))}function Bn(e,t,n){var h=e==null?s:ni(e,t);return h===s?n:h}function kv(e,t){return e!=null&&kc(e,t,oy)}function Vn(e,t){return e!=null&&kc(e,t,ay)}var Mv=qc(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Rs.call(t)),e[t]=n},Jn(ze)),jv=qc(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Rs.call(t)),ce.call(e,t)?e[t].push(n):e[t]=[n]},j),zv=Q(es);function Ce(e){return Me(e)?Ja(e):yn(e)}function je(e){return Me(e)?Ja(e,!0):my(e)}function Uv(e,t){var n={};return t=j(t,3),vt(e,function(h,l,f){qt(n,t(h,l,f),h)}),n}function Lv(e,t){var n={};return t=j(t,3),vt(e,function(h,l,f){qt(n,l,t(h,l,f))}),n}var Hv=Ci(function(e,t,n){Ls(e,t,n)}),vh=Ci(function(e,t,n,h){Ls(e,t,n,h)}),Bv=At(function(e,t){var n={};if(e==null)return n;var h=!1;t=fe(t,function(f){return f=Kt(f,e),h||(h=f.length>1),f}),wt(e,Dn(e),n),h&&(n=st(n,A|N|M,My));for(var l=t.length;l--;)En(n,t[l]);return n});function Vv(e,t){return wh(e,sr(j(t)))}var Kv=At(function(e,t){return e==null?{}:wy(e,t)});function wh(e,t){if(e==null)return{};var n=fe(Dn(e),function(h){return[h]});return t=j(t),uc(e,n,function(h,l){return t(h,l[0])})}function Jv(e,t,n){t=Kt(t,e);var h=-1,l=t.length;for(l||(l=1,e=s);++h<l;){var f=e==null?s:e[_t(t[h])];f===s&&(h=l,f=n),e=Ft(f)?f.call(e):f}return e}function Gv(e,t,n){return e==null?e:is(e,t,n)}function Wv(e,t,n,h){return h=typeof h=="function"?h:s,e==null?e:is(e,t,n,h)}var _h=Oc(Ce),bh=Oc(je);function Qv(e,t,n){var h=V(e),l=h||Gt(e)||qi(e);if(t=j(t,4),n==null){var f=e&&e.constructor;l?n=h?new f:[]:ye(e)?n=Ft(f)?Si(As(e)):{}:n={}}return(l?et:vt)(e,function(m,w,b){return t(n,m,w,b)}),n}function Yv(e,t){return e==null?!0:En(e,t)}function Zv(e,t,n){return e==null?e:fc(e,t,Sn(n))}function Xv(e,t,n,h){return h=typeof h=="function"?h:s,e==null?e:fc(e,t,Sn(n),h)}function Di(e){return e==null?[]:sn(e,Ce(e))}function ew(e){return e==null?[]:sn(e,je(e))}function tw(e,t,n){return n===s&&(n=t,t=s),n!==s&&(n=ot(n),n=n===n?n:0),t!==s&&(t=ot(t),t=t===t?t:0),ri(ot(e),t,n)}function iw(e,t,n){return t=Nt(t),n===s?(n=t,t=0):n=Nt(n),e=ot(e),cy(e,t,n)}function sw(e,t,n){if(n&&typeof n!="boolean"&&Fe(e,t,n)&&(t=n=s),n===s&&(typeof t=="boolean"?(n=t,t=s):typeof e=="boolean"&&(n=e,e=s)),e===s&&t===s?(e=0,t=1):(e=Nt(e),t===s?(t=e,e=0):t=Nt(t)),e>t){var h=e;e=t,t=h}if(n||e%1||t%1){var l=Va();return De(e+l*(t-e+Ng("1e-"+((l+"").length-1))),t)}return wn(e,t)}var rw=xi(function(e,t,n){return t=t.toLowerCase(),e+(n?Eh(t):t)});function Eh(e){return Kn(oe(e).toLowerCase())}function Ih(e){return e=oe(e),e&&e.replace(ng,Jg).replace(Pg,"")}function nw(e,t,n){e=oe(e),t=Je(t);var h=e.length;n=n===s?h:ri(J(n),0,h);var l=n;return n-=t.length,n>=0&&e.slice(n,l)==t}function ow(e){return e=oe(e),e&&jd.test(e)?e.replace(ea,Gg):e}function aw(e){return e=oe(e),e&&Vd.test(e)?e.replace(zr,"\\$&"):e}var cw=xi(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),hw=xi(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),uw=Cc("toLowerCase");function lw(e,t,n){e=oe(e),t=J(t);var h=t?_i(e):0;if(!t||h>=t)return e;var l=(t-h)/2;return Gs(Ts(l),n)+e+Gs(Ns(l),n)}function pw(e,t,n){e=oe(e),t=J(t);var h=t?_i(e):0;return t&&h<t?e+Gs(t-h,n):e}function dw(e,t,n){e=oe(e),t=J(t);var h=t?_i(e):0;return t&&h<t?Gs(t-h,n)+e:e}function gw(e,t,n){return n||t==null?t=0:t&&(t=+t),bf(oe(e).replace(Ur,""),t||0)}function fw(e,t,n){return(n?Fe(e,t,n):t===s)?t=1:t=J(t),_n(oe(e),t)}function yw(){var e=arguments,t=oe(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var mw=xi(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function vw(e,t,n){return n&&typeof n!="number"&&Fe(e,t,n)&&(t=n=s),n=n===s?$e:n>>>0,n?(e=oe(e),e&&(typeof t=="string"||t!=null&&!Hn(t))&&(t=Je(t),!t&&wi(e))?Jt(ut(e),0,n):e.split(t,n)):[]}var ww=xi(function(e,t,n){return e+(n?" ":"")+Kn(t)});function _w(e,t,n){return e=oe(e),n=n==null?0:ri(J(n),0,e.length),t=Je(t),e.slice(n,n+t.length)==t}function bw(e,t,n){var h=p.templateSettings;n&&Fe(e,t,n)&&(t=s),e=oe(e),t=or({},t,h,Fc);var l=or({},t.imports,h.imports,Fc),f=Ce(l),m=sn(l,f),w,b,S=0,C=t.interpolate||ws,R="__p += '",D=nn((t.escape||ws).source+"|"+C.source+"|"+(C===ta?Xd:ws).source+"|"+(t.evaluate||ws).source+"|$","g"),T="//# sourceURL="+(ce.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++qg+"]")+`
`;e.replace(D,function(U,Z,te,We,Ne,Qe){return te||(te=We),R+=e.slice(S,Qe).replace(og,Wg),Z&&(w=!0,R+=`' +
__e(`+Z+`) +
'`),Ne&&(b=!0,R+=`';
`+Ne+`;
__p += '`),te&&(R+=`' +
((__t = (`+te+`)) == null ? '' : __t) +
'`),S=Qe+U.length,U}),R+=`';
`;var z=ce.call(t,"variable")&&t.variable;if(!z)R=`with (obj) {
`+R+`
}
`;else if(Yd.test(z))throw new B(v);R=(b?R.replace(Td,""):R).replace($d,"$1").replace(kd,"$1;"),R="function("+(z||"obj")+`) {
`+(z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(b?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var G=Sh(function(){return ne(f,T+"return "+R).apply(s,m)});if(G.source=R,Ln(G))throw G;return G}function Ew(e){return oe(e).toLowerCase()}function Iw(e){return oe(e).toUpperCase()}function Pw(e,t,n){if(e=oe(e),e&&(n||t===s))return Na(e);if(!e||!(t=Je(t)))return e;var h=ut(e),l=ut(t),f=Ta(h,l),m=$a(h,l)+1;return Jt(h,f,m).join("")}function Sw(e,t,n){if(e=oe(e),e&&(n||t===s))return e.slice(0,Ma(e)+1);if(!e||!(t=Je(t)))return e;var h=ut(e),l=$a(h,ut(t))+1;return Jt(h,0,l).join("")}function Cw(e,t,n){if(e=oe(e),e&&(n||t===s))return e.replace(Ur,"");if(!e||!(t=Je(t)))return e;var h=ut(e),l=Ta(h,ut(t));return Jt(h,l).join("")}function xw(e,t){var n=$i,h=jt;if(ye(t)){var l="separator"in t?t.separator:l;n="length"in t?J(t.length):n,h="omission"in t?Je(t.omission):h}e=oe(e);var f=e.length;if(wi(e)){var m=ut(e);f=m.length}if(n>=f)return e;var w=n-_i(h);if(w<1)return h;var b=m?Jt(m,0,w).join(""):e.slice(0,w);if(l===s)return b+h;if(m&&(w+=b.length-w),Hn(l)){if(e.slice(w).search(l)){var S,C=b;for(l.global||(l=nn(l.source,oe(ia.exec(l))+"g")),l.lastIndex=0;S=l.exec(C);)var R=S.index;b=b.slice(0,R===s?w:R)}}else if(e.indexOf(Je(l),w)!=w){var D=b.lastIndexOf(l);D>-1&&(b=b.slice(0,D))}return b+h}function Rw(e){return e=oe(e),e&&Md.test(e)?e.replace(Xo,sf):e}var qw=xi(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Kn=Cc("toUpperCase");function Ph(e,t,n){return e=oe(e),t=n?s:t,t===s?Yg(e)?of(e):Lg(e):e.match(t)||[]}var Sh=Q(function(e,t){try{return Ve(e,s,t)}catch(n){return Ln(n)?n:new B(n)}}),Dw=At(function(e,t){return et(t,function(n){n=_t(n),qt(e,n,zn(e[n],e))}),e});function Aw(e){var t=e==null?0:e.length,n=j();return e=t?fe(e,function(h){if(typeof h[1]!="function")throw new tt(g);return[n(h[0]),h[1]]}):[],Q(function(h){for(var l=-1;++l<t;){var f=e[l];if(Ve(f[0],this,h))return Ve(f[1],this,h)}})}function Ow(e){return sy(st(e,A))}function Jn(e){return function(){return e}}function Fw(e,t){return e==null||e!==e?t:e}var Nw=Rc(),Tw=Rc(!0);function ze(e){return e}function Gn(e){return rc(typeof e=="function"?e:st(e,A))}function $w(e){return oc(st(e,A))}function kw(e,t){return ac(e,st(t,A))}var Mw=Q(function(e,t){return function(n){return es(n,e,t)}}),jw=Q(function(e,t){return function(n){return es(e,n,t)}});function Wn(e,t,n){var h=Ce(t),l=Us(t,h);n==null&&!(ye(t)&&(l.length||!h.length))&&(n=t,t=e,e=this,l=Us(t,Ce(t)));var f=!(ye(n)&&"chain"in n)||!!n.chain,m=Ft(e);return et(l,function(w){var b=t[w];e[w]=b,m&&(e.prototype[w]=function(){var S=this.__chain__;if(f||S){var C=e(this.__wrapped__),R=C.__actions__=ke(this.__actions__);return R.push({func:b,args:arguments,thisArg:e}),C.__chain__=S,C}return b.apply(e,Ut([this.value()],arguments))})}),e}function zw(){return Re._===this&&(Re._=pf),this}function Qn(){}function Uw(e){return e=J(e),Q(function(t){return cc(t,e)})}var Lw=xn(fe),Hw=xn(qa),Bw=xn(Yr);function Ch(e){return Nn(e)?Zr(_t(e)):_y(e)}function Vw(e){return function(t){return e==null?s:ni(e,t)}}var Kw=Dc(),Jw=Dc(!0);function Yn(){return[]}function Zn(){return!1}function Gw(){return{}}function Ww(){return""}function Qw(){return!0}function Yw(e,t){if(e=J(e),e<1||e>Be)return[];var n=$e,h=De(e,$e);t=j(t),e-=$e;for(var l=tn(h,t);++n<e;)t(n);return l}function Zw(e){return V(e)?fe(e,_t):Ge(e)?[e]:ke(Kc(oe(e)))}function Xw(e){var t=++uf;return oe(e)+t}var e_=Js(function(e,t){return e+t},0),t_=Rn("ceil"),i_=Js(function(e,t){return e/t},1),s_=Rn("floor");function r_(e){return e&&e.length?zs(e,ze,dn):s}function n_(e,t){return e&&e.length?zs(e,j(t,2),dn):s}function o_(e){return Oa(e,ze)}function a_(e,t){return Oa(e,j(t,2))}function c_(e){return e&&e.length?zs(e,ze,mn):s}function h_(e,t){return e&&e.length?zs(e,j(t,2),mn):s}var u_=Js(function(e,t){return e*t},1),l_=Rn("round"),p_=Js(function(e,t){return e-t},0);function d_(e){return e&&e.length?en(e,ze):0}function g_(e,t){return e&&e.length?en(e,j(t,2)):0}return p.after=$0,p.ary=sh,p.assign=Iv,p.assignIn=mh,p.assignInWith=or,p.assignWith=Pv,p.at=Sv,p.before=rh,p.bind=zn,p.bindAll=Dw,p.bindKey=nh,p.castArray=G0,p.chain=eh,p.chunk=sm,p.compact=rm,p.concat=nm,p.cond=Aw,p.conforms=Ow,p.constant=Jn,p.countBy=d0,p.create=Cv,p.curry=oh,p.curryRight=ah,p.debounce=ch,p.defaults=xv,p.defaultsDeep=Rv,p.defer=k0,p.delay=M0,p.difference=om,p.differenceBy=am,p.differenceWith=cm,p.drop=hm,p.dropRight=um,p.dropRightWhile=lm,p.dropWhile=pm,p.fill=dm,p.filter=f0,p.flatMap=v0,p.flatMapDeep=w0,p.flatMapDepth=_0,p.flatten=Qc,p.flattenDeep=gm,p.flattenDepth=fm,p.flip=j0,p.flow=Nw,p.flowRight=Tw,p.fromPairs=ym,p.functions=Tv,p.functionsIn=$v,p.groupBy=b0,p.initial=vm,p.intersection=wm,p.intersectionBy=_m,p.intersectionWith=bm,p.invert=Mv,p.invertBy=jv,p.invokeMap=I0,p.iteratee=Gn,p.keyBy=P0,p.keys=Ce,p.keysIn=je,p.map=er,p.mapKeys=Uv,p.mapValues=Lv,p.matches=$w,p.matchesProperty=kw,p.memoize=ir,p.merge=Hv,p.mergeWith=vh,p.method=Mw,p.methodOf=jw,p.mixin=Wn,p.negate=sr,p.nthArg=Uw,p.omit=Bv,p.omitBy=Vv,p.once=z0,p.orderBy=S0,p.over=Lw,p.overArgs=U0,p.overEvery=Hw,p.overSome=Bw,p.partial=Un,p.partialRight=hh,p.partition=C0,p.pick=Kv,p.pickBy=wh,p.property=Ch,p.propertyOf=Vw,p.pull=Sm,p.pullAll=Zc,p.pullAllBy=Cm,p.pullAllWith=xm,p.pullAt=Rm,p.range=Kw,p.rangeRight=Jw,p.rearg=L0,p.reject=q0,p.remove=qm,p.rest=H0,p.reverse=Mn,p.sampleSize=A0,p.set=Gv,p.setWith=Wv,p.shuffle=O0,p.slice=Dm,p.sortBy=T0,p.sortedUniq=km,p.sortedUniqBy=Mm,p.split=vw,p.spread=B0,p.tail=jm,p.take=zm,p.takeRight=Um,p.takeRightWhile=Lm,p.takeWhile=Hm,p.tap=r0,p.throttle=V0,p.thru=Xs,p.toArray=gh,p.toPairs=_h,p.toPairsIn=bh,p.toPath=Zw,p.toPlainObject=yh,p.transform=Qv,p.unary=K0,p.union=Bm,p.unionBy=Vm,p.unionWith=Km,p.uniq=Jm,p.uniqBy=Gm,p.uniqWith=Wm,p.unset=Yv,p.unzip=jn,p.unzipWith=Xc,p.update=Zv,p.updateWith=Xv,p.values=Di,p.valuesIn=ew,p.without=Qm,p.words=Ph,p.wrap=J0,p.xor=Ym,p.xorBy=Zm,p.xorWith=Xm,p.zip=e0,p.zipObject=t0,p.zipObjectDeep=i0,p.zipWith=s0,p.entries=_h,p.entriesIn=bh,p.extend=mh,p.extendWith=or,Wn(p,p),p.add=e_,p.attempt=Sh,p.camelCase=rw,p.capitalize=Eh,p.ceil=t_,p.clamp=tw,p.clone=W0,p.cloneDeep=Y0,p.cloneDeepWith=Z0,p.cloneWith=Q0,p.conformsTo=X0,p.deburr=Ih,p.defaultTo=Fw,p.divide=i_,p.endsWith=nw,p.eq=pt,p.escape=ow,p.escapeRegExp=aw,p.every=g0,p.find=y0,p.findIndex=Gc,p.findKey=qv,p.findLast=m0,p.findLastIndex=Wc,p.findLastKey=Dv,p.floor=s_,p.forEach=th,p.forEachRight=ih,p.forIn=Av,p.forInRight=Ov,p.forOwn=Fv,p.forOwnRight=Nv,p.get=Bn,p.gt=ev,p.gte=tv,p.has=kv,p.hasIn=Vn,p.head=Yc,p.identity=ze,p.includes=E0,p.indexOf=mm,p.inRange=iw,p.invoke=zv,p.isArguments=ci,p.isArray=V,p.isArrayBuffer=iv,p.isArrayLike=Me,p.isArrayLikeObject=ve,p.isBoolean=sv,p.isBuffer=Gt,p.isDate=rv,p.isElement=nv,p.isEmpty=ov,p.isEqual=av,p.isEqualWith=cv,p.isError=Ln,p.isFinite=hv,p.isFunction=Ft,p.isInteger=uh,p.isLength=rr,p.isMap=lh,p.isMatch=uv,p.isMatchWith=lv,p.isNaN=pv,p.isNative=dv,p.isNil=fv,p.isNull=gv,p.isNumber=ph,p.isObject=ye,p.isObjectLike=me,p.isPlainObject=os,p.isRegExp=Hn,p.isSafeInteger=yv,p.isSet=dh,p.isString=nr,p.isSymbol=Ge,p.isTypedArray=qi,p.isUndefined=mv,p.isWeakMap=vv,p.isWeakSet=wv,p.join=Em,p.kebabCase=cw,p.last=nt,p.lastIndexOf=Im,p.lowerCase=hw,p.lowerFirst=uw,p.lt=_v,p.lte=bv,p.max=r_,p.maxBy=n_,p.mean=o_,p.meanBy=a_,p.min=c_,p.minBy=h_,p.stubArray=Yn,p.stubFalse=Zn,p.stubObject=Gw,p.stubString=Ww,p.stubTrue=Qw,p.multiply=u_,p.nth=Pm,p.noConflict=zw,p.noop=Qn,p.now=tr,p.pad=lw,p.padEnd=pw,p.padStart=dw,p.parseInt=gw,p.random=sw,p.reduce=x0,p.reduceRight=R0,p.repeat=fw,p.replace=yw,p.result=Jv,p.round=l_,p.runInContext=_,p.sample=D0,p.size=F0,p.snakeCase=mw,p.some=N0,p.sortedIndex=Am,p.sortedIndexBy=Om,p.sortedIndexOf=Fm,p.sortedLastIndex=Nm,p.sortedLastIndexBy=Tm,p.sortedLastIndexOf=$m,p.startCase=ww,p.startsWith=_w,p.subtract=p_,p.sum=d_,p.sumBy=g_,p.template=bw,p.times=Yw,p.toFinite=Nt,p.toInteger=J,p.toLength=fh,p.toLower=Ew,p.toNumber=ot,p.toSafeInteger=Ev,p.toString=oe,p.toUpper=Iw,p.trim=Pw,p.trimEnd=Sw,p.trimStart=Cw,p.truncate=xw,p.unescape=Rw,p.uniqueId=Xw,p.upperCase=qw,p.upperFirst=Kn,p.each=th,p.eachRight=ih,p.first=Yc,Wn(p,function(){var e={};return vt(p,function(t,n){ce.call(p.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),p.VERSION=o,et(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),et(["drop","take"],function(e,t){X.prototype[e]=function(n){n=n===s?1:Pe(J(n),0);var h=this.__filtered__&&!t?new X(this):this.clone();return h.__filtered__?h.__takeCount__=De(n,h.__takeCount__):h.__views__.push({size:De(n,$e),type:e+(h.__dir__<0?"Right":"")}),h},X.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),et(["filter","map","takeWhile"],function(e,t){var n=t+1,h=n==Se||n==ki;X.prototype[e]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:j(l,3),type:n}),f.__filtered__=f.__filtered__||h,f}}),et(["head","last"],function(e,t){var n="take"+(t?"Right":"");X.prototype[e]=function(){return this[n](1).value()[0]}}),et(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");X.prototype[e]=function(){return this.__filtered__?new X(this):this[n](1)}}),X.prototype.compact=function(){return this.filter(ze)},X.prototype.find=function(e){return this.filter(e).head()},X.prototype.findLast=function(e){return this.reverse().find(e)},X.prototype.invokeMap=Q(function(e,t){return typeof e=="function"?new X(this):this.map(function(n){return es(n,e,t)})}),X.prototype.reject=function(e){return this.filter(sr(j(e)))},X.prototype.slice=function(e,t){e=J(e);var n=this;return n.__filtered__&&(e>0||t<0)?new X(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==s&&(t=J(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},X.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},X.prototype.toArray=function(){return this.take($e)},vt(X.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),h=/^(?:head|last)$/.test(t),l=p[h?"take"+(t=="last"?"Right":""):t],f=h||/^find/.test(t);l&&(p.prototype[t]=function(){var m=this.__wrapped__,w=h?[1]:arguments,b=m instanceof X,S=w[0],C=b||V(m),R=function(Z){var te=l.apply(p,Ut([Z],w));return h&&D?te[0]:te};C&&n&&typeof S=="function"&&S.length!=1&&(b=C=!1);var D=this.__chain__,T=!!this.__actions__.length,z=f&&!D,G=b&&!T;if(!f&&C){m=G?m:new X(this);var U=e.apply(m,w);return U.__actions__.push({func:Xs,args:[R],thisArg:s}),new it(U,D)}return z&&G?e.apply(this,w):(U=this.thru(R),z?h?U.value()[0]:U.value():U)})}),et(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ss[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",h=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(h&&!this.__chain__){var f=this.value();return t.apply(V(f)?f:[],l)}return this[n](function(m){return t.apply(V(m)?m:[],l)})}}),vt(X.prototype,function(e,t){var n=p[t];if(n){var h=n.name+"";ce.call(Pi,h)||(Pi[h]=[]),Pi[h].push({name:t,func:n})}}),Pi[Ks(s,Y).name]=[{name:"wrapper",func:s}],X.prototype.clone=Rf,X.prototype.reverse=qf,X.prototype.value=Df,p.prototype.at=n0,p.prototype.chain=o0,p.prototype.commit=a0,p.prototype.next=c0,p.prototype.plant=u0,p.prototype.reverse=l0,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=p0,p.prototype.first=p.prototype.head,Ji&&(p.prototype[Ji]=h0),p},bi=af();ei?((ei.exports=bi)._=bi,Jr._=bi):Re._=bi}).call(Ti)})(_r,_r.exports);var Gp=Object.defineProperty,Wp=Object.defineProperties,Qp=Object.getOwnPropertyDescriptors,Uo=Object.getOwnPropertySymbols,Yp=Object.prototype.hasOwnProperty,Zp=Object.prototype.propertyIsEnumerable,Lo=(y,r,s)=>r in y?Gp(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,ls=(y,r)=>{for(var s in r||(r={}))Yp.call(r,s)&&Lo(y,s,r[s]);if(Uo)for(var s of Uo(r))Zp.call(r,s)&&Lo(y,s,r[s]);return y},Xp=(y,r)=>Wp(y,Qp(r));function Mt(y,r,s){var o;const a=(0,d.DQe)(y);return((o=r.rpcMap)==null?void 0:o[a.reference])||`${Jp}?chainId=${a.namespace}:${a.reference}&projectId=${s}`}function Yt(y){return y.includes(":")?y.split(":")[1]:y}function Ho(y){return y.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function ed(y,r){const s=Object.keys(r.namespaces).filter(a=>a.includes(y));if(!s.length)return[];const o=[];return s.forEach(a=>{const u=r.namespaces[a].accounts;o.push(...u)}),o}function br(y={},r={}){const s=Bo(y),o=Bo(r);return _r.exports.merge(s,o)}function Bo(y){var r,s,o,a;const u={};if(!(0,d.L5o)(y))return u;for(const[g,v]of Object.entries(y)){const E=(0,d.gpE)(g)?[g]:v.chains,x=v.methods||[],q=v.events||[],A=v.rpcMap||{},N=(0,d.Maj)(g);u[N]=Xp(ls(ls({},u[N]),v),{chains:(0,d.eGA)(E,(r=u[N])==null?void 0:r.chains),methods:(0,d.eGA)(x,(s=u[N])==null?void 0:s.methods),events:(0,d.eGA)(q,(o=u[N])==null?void 0:o.events),rpcMap:ls(ls({},A),(a=u[N])==null?void 0:a.rpcMap)})}return u}function td(y){return y.includes(":")?y.split(":")[2]:y}function Vo(y){const r={};for(const[s,o]of Object.entries(y)){const a=o.methods||[],u=o.events||[],g=o.accounts||[],v=(0,d.gpE)(s)?[s]:o.chains?o.chains:Ho(o.accounts);r[s]={chains:v,methods:a,events:u,accounts:g}}return r}function Er(y){return typeof y=="number"?y:y.includes("0x")?parseInt(y,16):(y=y.includes(":")?y.split(":")[1]:y,isNaN(Number(y))?y:Number(y))}const Ko={},de=y=>Ko[y],Ir=(y,r)=>{Ko[y]=r};class id{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(St.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Yt(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||Mt(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new It.r(new kt.Z(o,de("disableProviderPing")))}}class sd{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(parseInt(r),s),this.chainId=parseInt(r),this.events.emit(St.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,s){const o=s||Mt(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new It.r(new kt.k(o,de("disableProviderPing")))}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=parseInt(Yt(s));r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}async handleSwitchChain(r){var s,o;let a=r.request.params?(s=r.request.params[0])==null?void 0:s.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:a}]},chainId:(o=this.namespace.chains)==null?void 0:o[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class rd{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(St.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Yt(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||Mt(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new It.r(new kt.Z(o,de("disableProviderPing")))}}class nd{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(St.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Yt(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||Mt(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new It.r(new kt.Z(o,de("disableProviderPing")))}}class od{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(St.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{const o=this.getCardanoRPCUrl(s),a=Yt(s);r[a]=this.createHttpProvider(a,o)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}getCardanoRPCUrl(r){const s=this.namespace.rpcMap;if(s)return s[r]}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||this.getCardanoRPCUrl(r);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new It.r(new kt.Z(o,de("disableProviderPing")))}}class ad{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(St.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Yt(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||Mt(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new It.r(new kt.Z(o,de("disableProviderPing")))}}class cd{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(St.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Yt(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||Mt(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new It.r(new kt.Z(o,de("disableProviderPing")))}}class hd{constructor(r){this.name="near",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){if(this.chainId=r,!this.httpProviders[r]){const o=s||Mt(`${this.name}:${r}`,this.namespace);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,o)}this.events.emit(St.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;r[s]=this.createHttpProvider(s,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||Mt(r,this.namespace);return typeof o>"u"?void 0:new It.r(new kt.Z(o,de("disableProviderPing")))}}var ud=Object.defineProperty,ld=Object.defineProperties,pd=Object.getOwnPropertyDescriptors,Jo=Object.getOwnPropertySymbols,dd=Object.prototype.hasOwnProperty,gd=Object.prototype.propertyIsEnumerable,Go=(y,r,s)=>r in y?ud(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,ps=(y,r)=>{for(var s in r||(r={}))dd.call(r,s)&&Go(y,s,r[s]);if(Jo)for(var s of Jo(r))gd.call(r,s)&&Go(y,s,r[s]);return y},Pr=(y,r)=>ld(y,pd(r));class Sr{constructor(r){this.events=new(ar()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:(0,ee.gw)((0,ee.jI)({level:(r==null?void 0:r.logger)||jo})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const s=new Sr(r);return await s.initialize(),s}async request(r,s,o){const[a,u]=this.validateChain(s);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:ps({},r),chainId:`${a}:${u}`,topic:this.session.topic,expiry:o})}sendAsync(r,s,o,a){const u=new Date().getTime();this.request(r,o,a).then(g=>s(null,(0,L.formatJsonRpcResult)(u,g))).catch(g=>s(g,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:(0,d.D6H)("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}async authenticate(r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(r),await this.cleanupPendingPairings();const{uri:s,response:o}=await this.client.authenticate(r);s&&(this.uri=s,this.events.emit("display_uri",s));const a=await o();if(this.session=a.session,this.session){const u=Vo(this.session.namespaces);this.namespaces=br(this.namespaces,u),this.persist("namespaces",this.namespaces),this.onConnect()}return a}on(r,s){this.events.on(r,s)}once(r,s){this.events.once(r,s)}removeListener(r,s){this.events.removeListener(r,s)}off(r,s){this.events.off(r,s)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let s=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(s>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:o,approval:a}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});o&&(this.uri=o,this.events.emit("display_uri",o)),await a().then(u=>{this.session=u;const g=Vo(u.namespaces);this.namespaces=br(this.namespaces,g),this.persist("namespaces",this.namespaces)}).catch(u=>{if(u.message!==$o)throw u;s++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,s){try{if(!this.session)return;const[o,a]=this.validateChain(r);this.getProvider(o).setDefaultChain(a,s)}catch(o){if(!/Please call connect/.test(o.message))throw o}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const s=this.client.pairing.getAll();if((0,d.qt8)(s)){for(const o of s)r.deletePairings?this.client.core.expirer.set(o.topic,0):await this.client.core.relayer.subscriber.unsubscribe(o.topic);this.logger.info(`Inactive pairings cleared: ${s.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await wr.init({logger:this.providerOpts.logger||jo,relayUrl:this.providerOpts.relayUrl||Bp,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(s=>(0,d.Maj)(s)))];Ir("client",this.client),Ir("events",this.events),Ir("disableProviderPing",this.disableProviderPing),r.forEach(s=>{if(!this.session)return;const o=ed(s,this.session),a=Ho(o),u=br(this.namespaces,this.optionalNamespaces),g=Pr(ps({},u[s]),{accounts:o,chains:a});switch(s){case"eip155":this.rpcProviders[s]=new sd({namespace:g});break;case"solana":this.rpcProviders[s]=new rd({namespace:g});break;case"cosmos":this.rpcProviders[s]=new nd({namespace:g});break;case"polkadot":this.rpcProviders[s]=new id({namespace:g});break;case"cip34":this.rpcProviders[s]=new od({namespace:g});break;case"elrond":this.rpcProviders[s]=new ad({namespace:g});break;case"multiversx":this.rpcProviders[s]=new cd({namespace:g});break;case"near":this.rpcProviders[s]=new hd({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:s}=r,{event:o}=s;if(o.name==="accountsChanged"){const a=o.data;a&&(0,d.qt8)(a)&&this.events.emit("accountsChanged",a.map(td))}else if(o.name==="chainChanged"){const a=s.chainId,u=s.event.data,g=(0,d.Maj)(a),v=Er(a)!==Er(u)?`${g}:${Er(u)}`:a;this.onChainChanged(v)}else this.events.emit(o.name,o.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:s})=>{var o;const{namespaces:a}=s,u=(o=this.client)==null?void 0:o.session.get(r);this.session=Pr(ps({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:s})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",Pr(ps({},(0,d.D6H)("USER_DISCONNECTED")),{data:r.topic}))}),this.on(St.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var s;this.getProvider(r).updateNamespace((s=this.session)==null?void 0:s.namespaces[r])})}setNamespaces(r){const{namespaces:s,optionalNamespaces:o,sessionProperties:a}=r;s&&Object.keys(s).length&&(this.namespaces=s),o&&Object.keys(o).length&&(this.optionalNamespaces=o),this.sessionProperties=a,this.persist("namespaces",s),this.persist("optionalNamespaces",o)}validateChain(r){const[s,o]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[s,o];if(s&&!Object.keys(this.namespaces||{}).map(g=>(0,d.Maj)(g)).includes(s))throw new Error(`Namespace '${s}' is not configured. Please call connect() first with namespace config.`);if(s&&o)return[s,o];const a=(0,d.Maj)(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,s=!1){if(!this.namespaces)return;const[o,a]=this.validateChain(r);a&&(s||this.getProvider(o).setDefaultChain(a),this.namespaces[o]?this.namespaces[o].defaultChain=a:this.namespaces[`${o}:${a}`]?this.namespaces[`${o}:${a}`].defaultChain=a:this.namespaces[`${o}:${a}`]={defaultChain:a},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,s){this.client.core.storage.setItem(`${zo}/${r}`,s)}async getFromStore(r){return await this.client.core.storage.getItem(`${zo}/${r}`)}}const fd=Sr,yd="wc",md="ethereum_provider",vd=`${yd}@2:${md}:`,wd="https://rpc.walletconnect.com/v1/",Cr=["eth_sendTransaction","personal_sign"],_d=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],xr=["chainChanged","accountsChanged"],bd=["chainChanged","accountsChanged","message","disconnect","connect"];var Ed=Object.defineProperty,Id=Object.defineProperties,Pd=Object.getOwnPropertyDescriptors,Wo=Object.getOwnPropertySymbols,Sd=Object.prototype.hasOwnProperty,Cd=Object.prototype.propertyIsEnumerable,Qo=(y,r,s)=>r in y?Ed(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,di=(y,r)=>{for(var s in r||(r={}))Sd.call(r,s)&&Qo(y,s,r[s]);if(Wo)for(var s of Wo(r))Cd.call(r,s)&&Qo(y,s,r[s]);return y},Rr=(y,r)=>Id(y,Pd(r));function ds(y){return Number(y[0].split(":")[1])}function gs(y){return`0x${y.toString(16)}`}function xd(y){const{chains:r,optionalChains:s,methods:o,optionalMethods:a,events:u,optionalEvents:g,rpcMap:v}=y;if(!(0,d.qt8)(r))throw new Error("Invalid chains");const E={chains:r,methods:o||Cr,events:u||xr,rpcMap:di({},r.length?{[ds(r)]:v[ds(r)]}:{})},x=u==null?void 0:u.filter(M=>!xr.includes(M)),q=o==null?void 0:o.filter(M=>!Cr.includes(M));if(!s&&!g&&!a&&!(x!=null&&x.length)&&!(q!=null&&q.length))return{required:r.length?E:void 0};const A=(x==null?void 0:x.length)&&(q==null?void 0:q.length)||!s,N={chains:[...new Set(A?E.chains.concat(s||[]):s)],methods:[...new Set(E.methods.concat(a!=null&&a.length?a:_d))],events:[...new Set(E.events.concat(g!=null&&g.length?g:bd))],rpcMap:v};return{required:r.length?E:void 0,optional:s.length?N:void 0}}class qr{constructor(){this.events=new Et.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=vd,this.on=(r,s)=>(this.events.on(r,s),this),this.once=(r,s)=>(this.events.once(r,s),this),this.removeListener=(r,s)=>(this.events.removeListener(r,s),this),this.off=(r,s)=>(this.events.off(r,s),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const s=new qr;return await s.initialize(r),s}async request(r,s){return await this.signer.request(r,this.formatChainId(this.chainId),s)}sendAsync(r,s,o){this.signer.sendAsync(r,s,this.formatChainId(this.chainId),o)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:s,optional:o}=xd(this.rpc);try{const a=await new Promise(async(g,v)=>{var E;this.rpc.showQrModal&&((E=this.modal)==null||E.subscribeModal(x=>{!x.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),v(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Rr(di({namespaces:di({},s&&{[this.namespace]:s})},o&&{optionalNamespaces:{[this.namespace]:o}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(x=>{g(x)}).catch(x=>{v(new Error(x.message))})});if(!a)return;const u=(0,d.guN)(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:gs(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async authenticate(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:r==null?void 0:r.chains});try{const s=await new Promise(async(a,u)=>{var g;this.rpc.showQrModal&&((g=this.modal)==null||g.subscribeModal(v=>{!v.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),u(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Rr(di({},r),{chains:this.rpc.chains})).then(v=>{a(v)}).catch(v=>{u(new Error(v.message))})}),o=s.session;if(o){const a=(0,d.guN)(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:a),this.setAccounts(a),this.events.emit("connect",{chainId:gs(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:s}=r,{event:o}=s;o.name==="accountsChanged"?(this.accounts=this.parseAccounts(o.data),this.events.emit("accountsChanged",this.accounts)):o.name==="chainChanged"?this.setChainId(this.formatChainId(o.data)):this.events.emit(o.name,o.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const s=parseInt(r);this.chainId=s,this.events.emit("chainChanged",gs(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",Rr(di({},(0,d.D6H)("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var s,o;this.rpc.showQrModal&&((s=this.modal)==null||s.closeModal(),(o=this.modal)==null||o.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const s=r.filter(o=>this.isCompatibleChainId(o)).map(o=>this.parseChainId(o));s.length&&(this.chainId=s[0],this.events.emit("chainChanged",gs(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const s=this.parseChainId(r);this.chainId=s,this.switchEthereumChain(s)}}parseAccountId(r){const[s,o,a]=r.split(":");return{chainId:`${s}:${o}`,address:a}}setAccounts(r){this.accounts=r.filter(s=>this.parseChainId(this.parseAccountId(s).chainId)===this.chainId).map(s=>this.parseAccountId(s).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var s,o;const a=(s=r==null?void 0:r.chains)!=null?s:[],u=(o=r==null?void 0:r.optionalChains)!=null?o:[],g=a.concat(u);if(!g.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const v=a.length?(r==null?void 0:r.methods)||Cr:[],E=a.length?(r==null?void 0:r.events)||xr:[],x=(r==null?void 0:r.optionalMethods)||[],q=(r==null?void 0:r.optionalEvents)||[],A=(r==null?void 0:r.rpcMap)||this.buildRpcMap(g,r.projectId),N=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(M=>this.formatChainId(M)),optionalChains:u.map(M=>this.formatChainId(M)),methods:v,events:E,optionalMethods:x,optionalEvents:q,rpcMap:A,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:N,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,s){const o={};return r.forEach(a=>{o[a]=this.getRpcUrl(a,s)}),o}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?ds(this.rpc.chains):ds(this.rpc.optionalChains),this.signer=await fd.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let s;try{const{WalletConnectModal:o}=await le.e(5707).then(le.bind(le,5707));s=o}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(s)try{this.modal=new s(di({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(o){throw this.signer.logger.error(o),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:s,optionalChains:o,rpcMap:a}=r;s&&(0,d.qt8)(s)&&(this.rpc.chains=s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),o&&(0,d.qt8)(o)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=o==null?void 0:o.map(u=>this.formatChainId(u)),o.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(r,s){var o;return((o=this.rpc.rpcMap)==null?void 0:o[r])||`${wd}?chainId=eip155:${r}&projectId=${s||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),s=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:s==null?void 0:s.accounts),this.setAccounts(s==null?void 0:s.accounts)}catch(r){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(r),await this.disconnect().catch(s=>this.signer.logger.warn(s))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(s=>this.parseAccount(s))}}const Rd=qr}}]);
