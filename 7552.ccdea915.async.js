"use strict";(self.webpackChunk_ant_design_web3_docs=self.webpackChunk_ant_design_web3_docs||[]).push([[7552],{17552:function(Cs,Jt,me){me.d(Jt,{EthereumProvider:function(){return Td}});var He=me(72100),Hi=me.n(He),d=me(53956),pe=me(53070),Gt=me(74735),ee=me(56526),Ft=me(36900);class wr extends Ft.q{constructor(s){super(),this.opts=s,this.protocol="wc",this.version=2}}class _o{constructor(s,r,o){this.core=s,this.logger=r}}class _r extends Ft.q{constructor(s,r){super(),this.core=s,this.logger=r,this.records=new Map}}class br{constructor(s,r){this.logger=s,this.core=r}}class Er extends Ft.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class Ir extends Ft.q{constructor(s){super()}}class Ss{constructor(s,r,o,a){this.core=s,this.logger=r,this.name=o}}class bo{constructor(){this.map=new Map}}class xs extends Ft.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class Eo{constructor(s,r){this.core=s,this.logger=r}}class Pr extends Ft.q{constructor(s,r){super(),this.core=s,this.logger=r}}class A{constructor(s,r){this.logger=s,this.core=r}}class O{constructor(s,r){this.projectId=s,this.logger=r}}class N{constructor(s,r){this.projectId=s,this.logger=r}}class U extends null{constructor(){super()}}class G{constructor(s){this.opts=s,this.protocol="wc",this.version=2}}class ye extends null{constructor(){super()}}class se{constructor(s){this.client=s}}var Be=me(41926),Ct=me(70083),Cr=me(90032),M=me(46196),Nt=me(56390),K=me(23700),Qh=me(47029),Yh=me(5899),Zh=me.n(Yh),Xh=me(51538),eu=me.n(Xh);function tu(m,s){if(m.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),o=0;o<r.length;o++)r[o]=255;for(var a=0;a<m.length;a++){var u=m.charAt(a),g=u.charCodeAt(0);if(r[g]!==255)throw new TypeError(u+" is ambiguous");r[g]=a}var v=m.length,E=m.charAt(0),x=Math.log(v)/Math.log(256),q=Math.log(256)/Math.log(v);function F(k){if(k instanceof Uint8Array||(ArrayBuffer.isView(k)?k=new Uint8Array(k.buffer,k.byteOffset,k.byteLength):Array.isArray(k)&&(k=Uint8Array.from(k))),!(k instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(k.length===0)return"";for(var J=0,Z=0,re=0,ge=k.length;re!==ge&&k[re]===0;)re++,J++;for(var ce=(ge-re)*q+1>>>0,ue=new Uint8Array(ce);re!==ge;){for(var he=k[re],Re=0,Ee=ce-1;(he!==0||Re<Z)&&Ee!==-1;Ee--,Re++)he+=256*ue[Ee]>>>0,ue[Ee]=he%v>>>0,he=he/v>>>0;if(he!==0)throw new Error("Non-zero carry");Z=Re,re++}for(var qe=ce-Z;qe!==ce&&ue[qe]===0;)qe++;for(var Ze=E.repeat(J);qe<ce;++qe)Ze+=m.charAt(ue[qe]);return Ze}function j(k){if(typeof k!="string")throw new TypeError("Expected String");if(k.length===0)return new Uint8Array;var J=0;if(k[J]!==" "){for(var Z=0,re=0;k[J]===E;)Z++,J++;for(var ge=(k.length-J)*x+1>>>0,ce=new Uint8Array(ge);k[J];){var ue=r[k.charCodeAt(J)];if(ue===255)return;for(var he=0,Re=ge-1;(ue!==0||he<re)&&Re!==-1;Re--,he++)ue+=v*ce[Re]>>>0,ce[Re]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");re=he,J++}if(k[J]!==" "){for(var Ee=ge-re;Ee!==ge&&ce[Ee]===0;)Ee++;for(var qe=new Uint8Array(Z+(ge-Ee)),Ze=Z;Ee!==ge;)qe[Ze++]=ce[Ee++];return qe}}}function z(k){var J=j(k);if(J)return J;throw new Error(`Non-${s} character`)}return{encode:F,decodeUnsafe:j,decode:z}}var iu=tu,ru=iu;const Io=m=>{if(m instanceof Uint8Array&&m.constructor.name==="Uint8Array")return m;if(m instanceof ArrayBuffer)return new Uint8Array(m);if(ArrayBuffer.isView(m))return new Uint8Array(m.buffer,m.byteOffset,m.byteLength);throw new Error("Unknown type, must be binary type")},su=m=>new TextEncoder().encode(m),nu=m=>new TextDecoder().decode(m);class ou{constructor(s,r,o){this.name=s,this.prefix=r,this.baseEncode=o}encode(s){if(s instanceof Uint8Array)return`${this.prefix}${this.baseEncode(s)}`;throw Error("Unknown type, must be binary type")}}class au{constructor(s,r,o){if(this.name=s,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=o}decode(s){if(typeof s=="string"){if(s.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(s)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(s.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(s){return Po(this,s)}}class cu{constructor(s){this.decoders=s}or(s){return Po(this,s)}decode(s){const r=s[0],o=this.decoders[r];if(o)return o.decode(s);throw RangeError(`Unable to decode multibase string ${JSON.stringify(s)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Po=(m,s)=>new cu({...m.decoders||{[m.prefix]:m},...s.decoders||{[s.prefix]:s}});class hu{constructor(s,r,o,a){this.name=s,this.prefix=r,this.baseEncode=o,this.baseDecode=a,this.encoder=new ou(s,r,o),this.decoder=new au(s,r,a)}encode(s){return this.encoder.encode(s)}decode(s){return this.decoder.decode(s)}}const Sr=({name:m,prefix:s,encode:r,decode:o})=>new hu(m,s,r,o),Bi=({prefix:m,name:s,alphabet:r})=>{const{encode:o,decode:a}=ru(r,s);return Sr({prefix:m,name:s,encode:o,decode:u=>Io(a(u))})},uu=(m,s,r,o)=>{const a={};for(let q=0;q<s.length;++q)a[s[q]]=q;let u=m.length;for(;m[u-1]==="=";)--u;const g=new Uint8Array(u*r/8|0);let v=0,E=0,x=0;for(let q=0;q<u;++q){const F=a[m[q]];if(F===void 0)throw new SyntaxError(`Non-${o} character`);E=E<<r|F,v+=r,v>=8&&(v-=8,g[x++]=255&E>>v)}if(v>=r||255&E<<8-v)throw new SyntaxError("Unexpected end of data");return g},lu=(m,s,r)=>{const o=s[s.length-1]==="=",a=(1<<r)-1;let u="",g=0,v=0;for(let E=0;E<m.length;++E)for(v=v<<8|m[E],g+=8;g>r;)g-=r,u+=s[a&v>>g];if(g&&(u+=s[a&v<<r-g]),o)for(;u.length*r&7;)u+="=";return u},Te=({name:m,prefix:s,bitsPerChar:r,alphabet:o})=>Sr({prefix:s,name:m,encode(a){return lu(a,o,r)},decode(a){return uu(a,o,r,m)}}),pu=Sr({prefix:"\0",name:"identity",encode:m=>nu(m),decode:m=>su(m)});var du=Object.freeze({__proto__:null,identity:pu});const gu=Te({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var fu=Object.freeze({__proto__:null,base2:gu});const mu=Te({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var yu=Object.freeze({__proto__:null,base8:mu});const vu=Bi({prefix:"9",name:"base10",alphabet:"0123456789"});var wu=Object.freeze({__proto__:null,base10:vu});const _u=Te({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),bu=Te({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Eu=Object.freeze({__proto__:null,base16:_u,base16upper:bu});const Iu=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Pu=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Cu=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Su=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xu=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ru=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ou=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),qu=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Au=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Du=Object.freeze({__proto__:null,base32:Iu,base32upper:Pu,base32pad:Cu,base32padupper:Su,base32hex:xu,base32hexupper:Ru,base32hexpad:Ou,base32hexpadupper:qu,base32z:Au});const Fu=Bi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Nu=Bi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Tu=Object.freeze({__proto__:null,base36:Fu,base36upper:Nu});const Mu=Bi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),$u=Bi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ku=Object.freeze({__proto__:null,base58btc:Mu,base58flickr:$u});const ju=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Lu=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zu=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Uu=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Hu=Object.freeze({__proto__:null,base64:ju,base64pad:Lu,base64url:zu,base64urlpad:Uu});const Co=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Bu=Co.reduce((m,s,r)=>(m[r]=s,m),[]),Vu=Co.reduce((m,s,r)=>(m[s.codePointAt(0)]=r,m),[]);function Ku(m){return m.reduce((s,r)=>(s+=Bu[r],s),"")}function Ju(m){const s=[];for(const r of m){const o=Vu[r.codePointAt(0)];if(o===void 0)throw new Error(`Non-base256emoji character: ${r}`);s.push(o)}return new Uint8Array(s)}const Gu=Sr({prefix:"\u{1F680}",name:"base256emoji",encode:Ku,decode:Ju});var Wu=Object.freeze({__proto__:null,base256emoji:Gu}),Qu=xo,So=128,Yu=127,Zu=~Yu,Xu=Math.pow(2,31);function xo(m,s,r){s=s||[],r=r||0;for(var o=r;m>=Xu;)s[r++]=m&255|So,m/=128;for(;m&Zu;)s[r++]=m&255|So,m>>>=7;return s[r]=m|0,xo.bytes=r-o+1,s}var el=Rs,tl=128,Ro=127;function Rs(m,o){var r=0,o=o||0,a=0,u=o,g,v=m.length;do{if(u>=v)throw Rs.bytes=0,new RangeError("Could not decode varint");g=m[u++],r+=a<28?(g&Ro)<<a:(g&Ro)*Math.pow(2,a),a+=7}while(g>=tl);return Rs.bytes=u-o,r}var il=Math.pow(2,7),rl=Math.pow(2,14),sl=Math.pow(2,21),nl=Math.pow(2,28),ol=Math.pow(2,35),al=Math.pow(2,42),cl=Math.pow(2,49),hl=Math.pow(2,56),ul=Math.pow(2,63),ll=function(m){return m<il?1:m<rl?2:m<sl?3:m<nl?4:m<ol?5:m<al?6:m<cl?7:m<hl?8:m<ul?9:10},pl={encode:Qu,decode:el,encodingLength:ll},Oo=pl;const qo=(m,s,r=0)=>(Oo.encode(m,s,r),s),Ao=m=>Oo.encodingLength(m),Os=(m,s)=>{const r=s.byteLength,o=Ao(m),a=o+Ao(r),u=new Uint8Array(a+r);return qo(m,u,0),qo(r,u,o),u.set(s,a),new dl(m,r,s,u)};class dl{constructor(s,r,o,a){this.code=s,this.size=r,this.digest=o,this.bytes=a}}const Do=({name:m,code:s,encode:r})=>new gl(m,s,r);class gl{constructor(s,r,o){this.name=s,this.code=r,this.encode=o}digest(s){if(s instanceof Uint8Array){const r=this.encode(s);return r instanceof Uint8Array?Os(this.code,r):r.then(o=>Os(this.code,o))}else throw Error("Unknown type, must be binary type")}}const Fo=m=>async s=>new Uint8Array(await crypto.subtle.digest(m,s)),fl=Do({name:"sha2-256",code:18,encode:Fo("SHA-256")}),ml=Do({name:"sha2-512",code:19,encode:Fo("SHA-512")});var yl=Object.freeze({__proto__:null,sha256:fl,sha512:ml});const No=0,vl="identity",To=Io;var wl=Object.freeze({__proto__:null,identity:{code:No,name:vl,encode:To,digest:m=>Os(No,To(m))}});new TextEncoder,new TextDecoder;const Mo={...du,...fu,...yu,...wu,...Eu,...Du,...Tu,...ku,...Hu,...Wu};({...yl,...wl});function _l(m=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(m):new Uint8Array(m)}function $o(m,s,r,o){return{name:m,prefix:s,encoder:{name:m,prefix:s,encode:r},decoder:{decode:o}}}const ko=$o("utf8","u",m=>"u"+new TextDecoder("utf8").decode(m),m=>new TextEncoder().encode(m.substring(1))),qs=$o("ascii","a",m=>{let s="a";for(let r=0;r<m.length;r++)s+=String.fromCharCode(m[r]);return s},m=>{m=m.substring(1);const s=_l(m.length);for(let r=0;r<m.length;r++)s[r]=m.charCodeAt(r);return s}),bl={utf8:ko,"utf-8":ko,hex:Mo.base16,latin1:qs,ascii:qs,binary:qs,...Mo};function El(m,s="utf8"){const r=bl[s];if(!r)throw new Error(`Unsupported encoding "${s}"`);return(s==="utf8"||s==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(m,"utf8"):r.decoder.decode(`${r.prefix}${m}`)}const jo="wc",Il=2,As="core",Wt=`${jo}@2:${As}:`,Pl={name:As,logger:"error"},Cl={database:":memory:"},Sl="crypto",Lo="client_ed25519_seed",xl=M.ONE_DAY,Rl="keychain",Ol="0.3",ql="messages",Al="0.3",Dl=M.SIX_HOURS,Fl="publisher",zo="irn",Nl="error",Uo="wss://relay.walletconnect.com",Ho="wss://relay.walletconnect.org",Tl="relayer",Ve={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Ml="_subscription",at={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},$l=M.ONE_SECOND,P_={database:":memory:"},kl="2.13.0",jl=1e4,Ll="0.3",zl="WALLETCONNECT_CLIENT_ID",St={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},C_=null,Ul="subscription",Hl="0.3",Bl=M.FIVE_SECONDS*1e3,Vl="pairing",Kl="0.3",S_=null,Vi={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},Ei={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},yt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Jl="history",Gl="0.3",Wl="expirer",ct={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ql="0.3",x_=null,Ds="verify-api",Ii="https://verify.walletconnect.com",Fs="https://verify.walletconnect.org",Yl=[Ii,Fs],Zl="echo",Xl="https://echo.walletconnect.com";class ep{constructor(s,r){this.core=s,this.logger=r,this.keychain=new Map,this.name=Rl,this.version=Ol,this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{if(!this.initialized){const o=await this.getKeyChain();typeof o<"u"&&(this.keychain=o),this.initialized=!0}},this.has=o=>(this.isInitialized(),this.keychain.has(o)),this.set=async(o,a)=>{this.isInitialized(),this.keychain.set(o,a),await this.persist()},this.get=o=>{this.isInitialized();const a=this.keychain.get(o);if(typeof a>"u"){const{message:u}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${o}`);throw new Error(u)}return a},this.del=async o=>{this.isInitialized(),this.keychain.delete(o),await this.persist()},this.core=s,this.logger=(0,ee.Ep)(r,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(s){await this.core.storage.setItem(this.storageKey,(0,d.KCv)(s))}async getKeyChain(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?(0,d.IPd)(s):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class tp{constructor(s,r,o){this.core=s,this.logger=r,this.name=Sl,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=Ct.generateKeyPair(a);return Ct.encodeIss(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=(0,d.Au2)();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),g=Ct.generateKeyPair(u),v=(0,d.jdp)(),E=xl;return await Ct.signJWT(v,a,E,g)},this.generateSharedKey=(a,u,g)=>{this.isInitialized();const v=this.getPrivateKey(a),E=(0,d.m$A)(v,u);return this.setSymKey(E,g)},this.setSymKey=async(a,u)=>{this.isInitialized();const g=u||(0,d.YmJ)(a);return await this.keychain.set(g,a),g},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,g)=>{this.isInitialized();const v=(0,d.ENt)(g),E=(0,Be.u)(u);if((0,d.Q8x)(v)){const j=v.senderPublicKey,z=v.receiverPublicKey;a=await this.generateSharedKey(j,z)}const x=this.getSymKey(a),{type:q,senderPublicKey:F}=v;return(0,d.HIp)({type:q,symKey:x,message:E,senderPublicKey:F})},this.decode=async(a,u,g)=>{this.isInitialized();const v=(0,d.Llj)(u,g);if((0,d.Q8x)(v)){const E=v.receiverPublicKey,x=v.senderPublicKey;a=await this.generateSharedKey(E,x)}try{const E=this.getSymKey(a),x=(0,d.peR)({symKey:E,encoded:u});return(0,Be.D)(x)}catch(E){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(E)}},this.getPayloadType=a=>{const u=(0,d.vBi)(a);return(0,d.WGe)(u.type)},this.getPayloadSenderPublicKey=a=>{const u=(0,d.vBi)(a);return u.senderPublicKey?(0,Cr.BB)(u.senderPublicKey,d.AWt):void 0},this.core=s,this.logger=(0,ee.Ep)(r,this.name),this.keychain=o||new ep(this.core,this.logger)}get context(){return(0,ee.Fd)(this.logger)}async setPrivateKey(s,r){return await this.keychain.set(s,r),s}getPrivateKey(s){return this.keychain.get(s)}async getClientSeed(){let s="";try{s=this.keychain.get(Lo)}catch{s=(0,d.jdp)(),await this.keychain.set(Lo,s)}return El(s,"base16")}getSymKey(s){return this.keychain.get(s)}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class ip extends br{constructor(s,r){super(s,r),this.logger=s,this.core=r,this.messages=new Map,this.name=ql,this.version=Al,this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const o=await this.getRelayerMessages();typeof o<"u"&&(this.messages=o),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(o){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(o)}finally{this.initialized=!0}}},this.set=async(o,a)=>{this.isInitialized();const u=(0,d.rjm)(a);let g=this.messages.get(o);return typeof g>"u"&&(g={}),typeof g[u]<"u"||(g[u]=a,this.messages.set(o,g),await this.persist()),u},this.get=o=>{this.isInitialized();let a=this.messages.get(o);return typeof a>"u"&&(a={}),a},this.has=(o,a)=>{this.isInitialized();const u=this.get(o),g=(0,d.rjm)(a);return typeof u[g]<"u"},this.del=async o=>{this.isInitialized(),this.messages.delete(o),await this.persist()},this.logger=(0,ee.Ep)(s,this.name),this.core=r}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(s){await this.core.storage.setItem(this.storageKey,(0,d.KCv)(s))}async getRelayerMessages(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?(0,d.IPd)(s):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class rp extends Er{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.events=new He.EventEmitter,this.name=Fl,this.queue=new Map,this.publishTimeout=(0,M.toMiliseconds)(M.ONE_MINUTE),this.failedPublishTimeout=(0,M.toMiliseconds)(M.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(o,a,u)=>{var g;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:u}});const v=(u==null?void 0:u.ttl)||Dl,E=(0,d._HE)(u),x=(u==null?void 0:u.prompt)||!1,q=(u==null?void 0:u.tag)||0,F=(u==null?void 0:u.id)||(0,K.getBigIntRpcId)().toString(),j={topic:o,message:a,opts:{ttl:v,relay:E,prompt:x,tag:q,id:F}},z=`Failed to publish payload, please try again. id:${F} tag:${q}`,k=Date.now();let J,Z=1;try{for(;J===void 0;){if(Date.now()-k>this.publishTimeout)throw new Error(z);this.logger.trace({id:F,attempts:Z},`publisher.publish - attempt ${Z}`),J=await await(0,d.hFY)(this.rpcPublish(o,a,v,E,x,q,F).catch(re=>this.logger.warn(re)),this.publishTimeout,z),Z++,J||await new Promise(re=>setTimeout(re,this.failedPublishTimeout))}this.relayer.events.emit(Ve.publish,j),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:F,topic:o,message:a,opts:u}})}catch(re){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(re),(g=u==null?void 0:u.internal)!=null&&g.throwOnFailedPublish)throw re;this.queue.set(F,j)}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.relayer=s,this.logger=(0,ee.Ep)(r,this.name),this.registerEventListeners()}get context(){return(0,ee.Fd)(this.logger)}rpcPublish(s,r,o,a,u,g,v){var E,x,q,F;const j={method:(0,d.cOS)(a.protocol).publish,params:{topic:s,message:r,ttl:o,prompt:u,tag:g},id:v};return(0,d.o8e)((E=j.params)==null?void 0:E.prompt)&&((x=j.params)==null||delete x.prompt),(0,d.o8e)((q=j.params)==null?void 0:q.tag)&&((F=j.params)==null||delete F.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:j}),this.relayer.request(j)}removeRequestFromQueue(s){this.queue.delete(s)}checkQueue(){this.queue.forEach(async s=>{const{topic:r,message:o,opts:a}=s;await this.publish(r,o,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Gt.Lx.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ve.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ve.message_ack,s=>{this.removeRequestFromQueue(s.id.toString())})}}class sp{constructor(){this.map=new Map,this.set=(s,r)=>{const o=this.get(s);this.exists(s,r)||this.map.set(s,[...o,r])},this.get=s=>this.map.get(s)||[],this.exists=(s,r)=>this.get(s).includes(r),this.delete=(s,r)=>{if(typeof r>"u"){this.map.delete(s);return}if(!this.map.has(s))return;const o=this.get(s);if(!this.exists(s,r))return;const a=o.filter(u=>u!==r);if(!a.length){this.map.delete(s);return}this.map.set(s,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var np=Object.defineProperty,op=Object.defineProperties,ap=Object.getOwnPropertyDescriptors,Bo=Object.getOwnPropertySymbols,cp=Object.prototype.hasOwnProperty,hp=Object.prototype.propertyIsEnumerable,Vo=(m,s,r)=>s in m?np(m,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[s]=r,Ki=(m,s)=>{for(var r in s||(s={}))cp.call(s,r)&&Vo(m,r,s[r]);if(Bo)for(var r of Bo(s))hp.call(s,r)&&Vo(m,r,s[r]);return m},Ns=(m,s)=>op(m,ap(s));class up extends xs{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.subscriptions=new Map,this.topicMap=new sp,this.events=new He.EventEmitter,this.name=Ul,this.version=Hl,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Wt,this.subscribeTimeout=(0,M.toMiliseconds)(M.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.pendingBatchMessages=[],this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const u=(0,d._HE)(a),g={topic:o,relay:u};this.pending.set(o,g);const v=await this.rpcSubscribe(o,u);return typeof v=="string"&&(this.onSubscribe(v,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}})),v}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(o,a.id,a):await this.unsubscribeByTopic(o,a)},this.isSubscribed=async o=>{if(this.topics.includes(o))return!0;const a=`${this.pendingSubscriptionWatchLabel}_${o}`;return await new Promise((u,g)=>{const v=new M.Watch;v.start(a);const E=setInterval(()=>{!this.pending.has(o)&&this.topics.includes(o)&&(clearInterval(E),v.stop(a),u(!0)),v.elapsed(a)>=Bl&&(clearInterval(E),v.stop(a),g(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=s,this.logger=(0,ee.Ep)(r,this.name),this.clientId=""}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(s,r){let o=!1;try{o=this.getSubscription(s).topic===r}catch{}return o}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(s,r){const o=this.topicMap.get(s);await Promise.all(o.map(async a=>await this.unsubscribeById(s,a,r)))}async unsubscribeById(s,r,o){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}});try{const a=(0,d._HE)(o);await this.rpcUnsubscribe(s,r,a);const u=(0,d.D6H)("USER_DISCONNECTED",`${this.name}, ${s}`);await this.onUnsubscribe(s,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(s,r){const o={method:(0,d.cOS)(r.protocol).subscribe,params:{topic:s}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await(0,d.hFY)(this.relayer.request(o).catch(a=>this.logger.warn(a)),this.subscribeTimeout)?(0,d.rjm)(s+this.clientId):null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ve.connection_stalled)}return null}async rpcBatchSubscribe(s){if(!s.length)return;const r=s[0].relay,o={method:(0,d.cOS)(r.protocol).batchSubscribe,params:{topics:s.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await(0,d.hFY)(this.relayer.request(o).catch(a=>this.logger.warn(a)),this.subscribeTimeout)}catch{this.relayer.events.emit(Ve.connection_stalled)}}async rpcBatchFetchMessages(s){if(!s.length)return;const r=s[0].relay,o={method:(0,d.cOS)(r.protocol).batchFetchMessages,params:{topics:s.map(u=>u.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});let a;try{a=await await(0,d.hFY)(this.relayer.request(o).catch(u=>this.logger.warn(u)),this.subscribeTimeout)}catch{this.relayer.events.emit(Ve.connection_stalled)}return a}rpcUnsubscribe(s,r,o){const a={method:(0,d.cOS)(o.protocol).unsubscribe,params:{topic:s,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(s,r){this.setSubscription(s,Ns(Ki({},r),{id:s})),this.pending.delete(r.topic)}onBatchSubscribe(s){s.length&&s.forEach(r=>{this.setSubscription(r.id,Ki({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(s,r,o){this.events.removeAllListeners(r),this.hasSubscription(r,s)&&this.deleteSubscription(r,o),await this.relayer.messages.del(s)}async setRelayerSubscriptions(s){await this.relayer.core.storage.setItem(this.storageKey,s)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(s,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:s,subscription:r}),this.addSubscription(s,r)}addSubscription(s,r){this.subscriptions.set(s,Ki({},r)),this.topicMap.set(r.topic,s),this.events.emit(St.created,r)}getSubscription(s){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:s});const r=this.subscriptions.get(s);if(!r){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}deleteSubscription(s,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:s,reason:r});const o=this.getSubscription(s);this.subscriptions.delete(s),this.topicMap.delete(o.topic,s),this.events.emit(St.deleted,Ns(Ki({},o),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(St.sync)}async reset(){if(this.cached.length){const s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<s;r++){const o=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchFetchMessages(o),await this.batchSubscribe(o)}}this.events.emit(St.resubscribed)}async restore(){try{const s=await this.getRelayerSubscriptions();if(typeof s>"u"||!s.length)return;if(this.subscriptions.size){const{message:r}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(s){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(s)}}async batchSubscribe(s){if(!s.length)return;const r=await this.rpcBatchSubscribe(s);(0,d.qt8)(r)&&this.onBatchSubscribe(r.map((o,a)=>Ns(Ki({},s[a]),{id:o})))}async batchFetchMessages(s){if(!s.length)return;this.logger.trace(`Fetching batch messages for ${s.length} subscriptions`);const r=await this.rpcBatchFetchMessages(s);r&&r.messages&&(this.pendingBatchMessages=this.pendingBatchMessages.concat(r.messages))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const s=[];this.pending.forEach(r=>{s.push(r)}),await this.batchSubscribe(s),this.pendingBatchMessages.length&&(await this.relayer.handleBatchMessageEvents(this.pendingBatchMessages),this.pendingBatchMessages=[])}registerEventListeners(){this.relayer.core.heartbeat.on(Gt.Lx.pulse,async()=>{await this.checkPending()}),this.events.on(St.created,async s=>{const r=St.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()}),this.events.on(St.deleted,async s=>{const r=St.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}async restartToComplete(){this.restartInProgress&&await new Promise(s=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),s())},this.pollingInterval)})}}var lp=Object.defineProperty,Ko=Object.getOwnPropertySymbols,pp=Object.prototype.hasOwnProperty,dp=Object.prototype.propertyIsEnumerable,Jo=(m,s,r)=>s in m?lp(m,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[s]=r,gp=(m,s)=>{for(var r in s||(s={}))pp.call(s,r)&&Jo(m,r,s[r]);if(Ko)for(var r of Ko(s))dp.call(s,r)&&Jo(m,r,s[r]);return m};class fp extends Ir{constructor(s){super(s),this.protocol="wc",this.version=2,this.events=new He.EventEmitter,this.name=Tl,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=(0,M.toMiliseconds)(M.THIRTY_SECONDS+M.ONE_SECOND),this.request=async r=>{var o,a;this.logger.debug("Publishing Request Payload");const u=r.id||(0,K.getBigIntRpcId)().toString();await this.toEstablishConnection();try{const g=this.provider.request(r);this.requestsInFlight.set(u,{promise:g,request:r}),this.logger.trace({id:u,method:r.method,topic:(o=r.params)==null?void 0:o.topic},"relayer.request - attempt to publish...");const v=await new Promise(async(E,x)=>{const q=()=>{x(new Error(`relayer.request - publish interrupted, id: ${u}`))};this.provider.on(at.disconnect,q);const F=await g;this.provider.off(at.disconnect,q),E(F)});return this.logger.trace({id:u,method:r.method,topic:(a=r.params)==null?void 0:a.topic},"relayer.request - published"),v}catch(g){throw this.logger.debug(`Failed to Publish Request: ${u}`),g}finally{this.requestsInFlight.delete(u)}},this.resetPingTimeout=()=>{if((0,d.UGU)())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,o,a;(a=(o=(r=this.provider)==null?void 0:r.connection)==null?void 0:o.socket)==null||a.terminate()},this.heartBeatTimeout)}catch(r){this.logger.warn(r)}},this.onPayloadHandler=r=>{this.onProviderPayload(r),this.resetPingTimeout()},this.onConnectHandler=()=>{this.startPingTimeout(),this.events.emit(Ve.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Ve.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(at.payload,this.onPayloadHandler),this.provider.on(at.connect,this.onConnectHandler),this.provider.on(at.disconnect,this.onDisconnectHandler),this.provider.on(at.error,this.onProviderErrorHandler)},this.core=s.core,this.logger=typeof s.logger<"u"&&typeof s.logger!="string"?(0,ee.Ep)(s.logger,this.name):(0,ee.gw)((0,ee.jI)({level:s.logger||Nl})),this.messages=new ip(this.logger,s.core),this.subscriber=new up(this,this.logger),this.publisher=new rp(this,this.logger),this.relayUrl=(s==null?void 0:s.relayUrl)||Uo,this.projectId=s.projectId,this.bundleId=(0,d.X_B)(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Ho}...`),await this.restartTransport(Ho)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&this.subscriber.pending.size===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},jl)}get context(){return(0,ee.Fd)(this.logger)}get connected(){var s,r,o;return((o=(r=(s=this.provider)==null?void 0:s.connection)==null?void 0:r.socket)==null?void 0:o.readyState)===1}get connecting(){var s,r,o;return((o=(r=(s=this.provider)==null?void 0:s.connection)==null?void 0:r.socket)==null?void 0:o.readyState)===0}async publish(s,r,o){this.isInitialized(),await this.publisher.publish(s,r,o),await this.recordMessageEvent({topic:s,message:r,publishedAt:Date.now()})}async subscribe(s,r){var o;this.isInitialized();let a=((o=this.subscriber.topicMap.get(s))==null?void 0:o[0])||"",u;const g=v=>{v.topic===s&&(this.subscriber.off(St.created,g),u())};return await Promise.all([new Promise(v=>{u=v,this.subscriber.on(St.created,g)}),new Promise(async v=>{a=await this.subscriber.subscribe(s,r)||a,v()})]),a}async unsubscribe(s,r){this.isInitialized(),await this.subscriber.unsubscribe(s,r)}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}off(s,r){this.events.off(s,r)}removeListener(s,r){this.events.removeListener(s,r)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(s=>s.promise))}catch(s){this.logger.warn(s)}this.hasExperiencedNetworkDisruption||this.connected?await(0,d.hFY)(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(s){await this.confirmOnlineStateOrThrow(),s&&s!==this.relayUrl&&(this.relayUrl=s,await this.transportDisconnect()),await this.createProvider(),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(r,o)=>{const a=()=>{this.provider.off(at.disconnect,a),o(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(at.disconnect,a),await(0,d.hFY)(this.provider.connect(),(0,M.toMiliseconds)(M.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(u=>{o(u)}),await this.subscriber.start(),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){this.logger.error(r);const o=r;if(this.hasExperiencedNetworkDisruption=!0,!this.isConnectionStalled(o.message))throw r}finally{this.connectionAttemptInProgress=!1}}async restartTransport(s){this.connectionAttemptInProgress||(this.relayUrl=s||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await(0,d.Ggh)())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(s){if((s==null?void 0:s.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=s.sort((o,a)=>o.publishedAt-a.publishedAt);this.logger.trace(`Batch of ${r.length} message events sorted`);for(const o of r)try{await this.onMessageEvent(o)}catch(a){this.logger.warn(a)}this.logger.trace(`Batch of ${r.length} message events processed`)}startPingTimeout(){var s,r,o,a,u;if((0,d.UGU)())try{(r=(s=this.provider)==null?void 0:s.connection)!=null&&r.socket&&((u=(a=(o=this.provider)==null?void 0:o.connection)==null?void 0:a.socket)==null||u.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(g){this.logger.warn(g)}}isConnectionStalled(s){return this.staleConnectionErrors.some(r=>s.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const s=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Nt.r(new Qh.Z((0,d.$0m)({sdkVersion:kl,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:s,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(s){const{topic:r,message:o}=s;await this.messages.set(r,o)}async shouldIgnoreMessageEvent(s){const{topic:r,message:o}=s;if(!o||o.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${o}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,o);return a&&this.logger.debug(`Ignoring duplicate message: ${o}`),a}async onProviderPayload(s){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:s}),(0,K.isJsonRpcRequest)(s)){if(!s.method.endsWith(Ml))return;const r=s.params,{topic:o,message:a,publishedAt:u}=r.data,g={topic:o,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(gp({type:"event",event:r.id},g)),this.events.emit(r.id,g),await this.acknowledgePayload(s),await this.onMessageEvent(g)}else(0,K.isJsonRpcResponse)(s)&&this.events.emit(Ve.message_ack,s)}async onMessageEvent(s){await this.shouldIgnoreMessageEvent(s)||(this.events.emit(Ve.message,s),await this.recordMessageEvent(s))}async acknowledgePayload(s){const r=(0,K.formatJsonRpcResult)(s.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(at.payload,this.onPayloadHandler),this.provider.off(at.connect,this.onConnectHandler),this.provider.off(at.disconnect,this.onDisconnectHandler),this.provider.off(at.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let s=await(0,d.Ggh)();(0,d.uwg)(async r=>{s!==r&&(s=r,r?await this.restartTransport().catch(o=>this.logger.error(o)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.requestsInFlight.clear(),clearTimeout(this.pingTimeout),this.events.emit(Ve.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&setTimeout(async()=>{await this.transportOpen().catch(s=>this.logger.error(s))},(0,M.toMiliseconds)($l))}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(s=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),s())},this.connectionStatusPollingInterval)}),await this.transportOpen())}}var mp=Object.defineProperty,Go=Object.getOwnPropertySymbols,yp=Object.prototype.hasOwnProperty,vp=Object.prototype.propertyIsEnumerable,Wo=(m,s,r)=>s in m?mp(m,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[s]=r,Qo=(m,s)=>{for(var r in s||(s={}))yp.call(s,r)&&Wo(m,r,s[r]);if(Go)for(var r of Go(s))vp.call(s,r)&&Wo(m,r,s[r]);return m};class ci extends Ss{constructor(s,r,o,a=Wt,u=void 0){super(s,r,o,a),this.core=s,this.logger=r,this.name=o,this.map=new Map,this.version=Ll,this.cached=[],this.initialized=!1,this.storagePrefix=Wt,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!(0,d.o8e)(g)?this.map.set(this.getKey(g),g):(0,d.xWS)(g)?this.map.set(g.id,g):(0,d.h1R)(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,v)=>{this.isInitialized(),this.map.has(g)?await this.update(g,v):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:v}),this.map.set(g,v),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(v=>Object.keys(g).every(E=>Zh()(v[E],g[E]))):this.values),this.update=async(g,v)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:v});const E=Qo(Qo({},this.getData(g)),v);this.map.set(g,E),await this.persist()},this.delete=async(g,v)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:v}),this.map.delete(g),this.addToRecentlyDeleted(g),await this.persist())},this.logger=(0,ee.Ep)(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(s){this.recentlyDeleted.push(s),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(s){await this.core.storage.setItem(this.storageKey,s)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(s){const r=this.map.get(s);if(!r){if(this.recentlyDeleted.includes(s)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${s}`);throw this.logger.error(a),new Error(a)}const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.error(o),new Error(o)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const s=await this.getDataStore();if(typeof s>"u"||!s.length)return;if(this.map.size){const{message:r}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(s){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(s)}}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class wp{constructor(s,r){this.core=s,this.logger=r,this.name=Vl,this.version=Kl,this.events=new(Hi()),this.initialized=!1,this.storagePrefix=Wt,this.ignoredPayloadTypes=[d.rVF],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:o})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...o])]},this.create=async o=>{this.isInitialized();const a=(0,d.jdp)(),u=await this.core.crypto.setSymKey(a),g=(0,d.gn4)(M.FIVE_MINUTES),v={protocol:zo},E={topic:u,expiry:g,relay:v,active:!1},x=(0,d.Bvr)({protocol:this.core.protocol,version:this.core.version,topic:u,symKey:a,relay:v,expiryTimestamp:g,methods:o==null?void 0:o.methods});return this.core.expirer.set(u,g),await this.pairings.set(u,E),await this.core.relayer.subscribe(u),{topic:u,uri:x}},this.pair=async o=>{this.isInitialized(),this.isValidPair(o);const{topic:a,symKey:u,relay:g,expiryTimestamp:v,methods:E}=(0,d.heJ)(o.uri);let x;if(this.pairings.keys.includes(a)&&(x=this.pairings.get(a),x.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const q=v||(0,d.gn4)(M.FIVE_MINUTES),F={topic:a,relay:g,expiry:q,active:!1,methods:E};return this.core.expirer.set(a,q),await this.pairings.set(a,F),o.activatePairing&&await this.activate({topic:a}),this.events.emit(Ei.create,F),this.core.crypto.keychain.has(a)||await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:g}),F},this.activate=async({topic:o})=>{this.isInitialized();const a=(0,d.gn4)(M.THIRTY_DAYS);this.core.expirer.set(o,a),await this.pairings.update(o,{active:!0,expiry:a})},this.ping=async o=>{this.isInitialized(),await this.isValidPing(o);const{topic:a}=o;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:g,resolve:v,reject:E}=(0,d.H1S)();this.events.once((0,d.E0T)("pairing_ping",u),({error:x})=>{x?E(x):v()}),await g()}},this.updateExpiry=async({topic:o,expiry:a})=>{this.isInitialized(),await this.pairings.update(o,{expiry:a})},this.updateMetadata=async({topic:o,metadata:a})=>{this.isInitialized(),await this.pairings.update(o,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async o=>{this.isInitialized(),await this.isValidDisconnect(o);const{topic:a}=o;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",(0,d.D6H)("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(o,a,u)=>{const g=(0,K.formatJsonRpcRequest)(a,u),v=await this.core.crypto.encode(o,g),E=Vi[a].req;return this.core.history.set(o,g),this.core.relayer.publish(o,v,E),g.id},this.sendResult=async(o,a,u)=>{const g=(0,K.formatJsonRpcResult)(o,u),v=await this.core.crypto.encode(a,g),E=await this.core.history.get(a,o),x=Vi[E.request.method].res;await this.core.relayer.publish(a,v,x),await this.core.history.resolve(g)},this.sendError=async(o,a,u)=>{const g=(0,K.formatJsonRpcError)(o,u),v=await this.core.crypto.encode(a,g),E=await this.core.history.get(a,o),x=Vi[E.request.method]?Vi[E.request.method].res:Vi.unregistered_method.res;await this.core.relayer.publish(a,v,x),await this.core.history.resolve(g)},this.deletePairing=async(o,a)=>{await this.core.relayer.unsubscribe(o),await Promise.all([this.pairings.delete(o,(0,d.D6H)("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(o),a?Promise.resolve():this.core.expirer.del(o)])},this.cleanup=async()=>{const o=this.pairings.getAll().filter(a=>(0,d.BwD)(a.expiry));await Promise.all(o.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=o=>{const{topic:a,payload:u}=o;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async o=>{const{topic:a,payload:u}=o,g=(await this.core.history.get(a,u.id)).request.method;switch(g){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(o,a)=>{const{id:u}=a;try{this.isValidPing({topic:o}),await this.sendResult(u,o,!0),this.events.emit(Ei.ping,{id:u,topic:o})}catch(g){await this.sendError(u,o,g),this.logger.error(g)}},this.onPairingPingResponse=(o,a)=>{const{id:u}=a;setTimeout(()=>{(0,K.isJsonRpcResult)(a)?this.events.emit((0,d.E0T)("pairing_ping",u),{}):(0,K.isJsonRpcError)(a)&&this.events.emit((0,d.E0T)("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(o,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:o}),await this.deletePairing(o),this.events.emit(Ei.delete,{id:u,topic:o})}catch(g){await this.sendError(u,o,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(o,a)=>{const{id:u,method:g}=a;try{if(this.registeredMethods.includes(g))return;const v=(0,d.D6H)("WC_METHOD_UNSUPPORTED",g);await this.sendError(u,o,v),this.logger.error(v)}catch(v){await this.sendError(u,o,v),this.logger.error(v)}},this.onUnknownRpcMethodResponse=o=>{this.registeredMethods.includes(o)||this.logger.error((0,d.D6H)("WC_METHOD_UNSUPPORTED",o))},this.isValidPair=o=>{var a;if(!(0,d.EJd)(o)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`pair() params: ${o}`);throw new Error(g)}if(!(0,d.jvJ)(o.uri)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`pair() uri: ${o.uri}`);throw new Error(g)}const u=(0,d.heJ)(o.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(g)}if(!(u!=null&&u.symKey)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(g)}if(u!=null&&u.expiryTimestamp&&(0,M.toMiliseconds)(u==null?void 0:u.expiryTimestamp)<Date.now()){const{message:g}=(0,d.kCb)("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(g)}},this.isValidPing=async o=>{if(!(0,d.EJd)(o)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(u)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidDisconnect=async o=>{if(!(0,d.EJd)(o)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(u)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async o=>{if(!(0,d.M_r)(o,!1)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!this.pairings.keys.includes(o)){const{message:a}=(0,d.kCb)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if((0,d.BwD)(this.pairings.get(o).expiry)){await this.deletePairing(o);const{message:a}=(0,d.kCb)("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}},this.core=s,this.logger=(0,ee.Ep)(r,this.name),this.pairings=new ci(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,ee.Fd)(this.logger)}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}registerRelayerEvents(){this.core.relayer.on(Ve.message,async s=>{const{topic:r,message:o}=s;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(o)))return;const a=await this.core.crypto.decode(r,o);try{(0,K.isJsonRpcRequest)(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):(0,K.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(ct.expired,async s=>{const{topic:r}=(0,d.iPz)(s.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ei.expire,{topic:r}))})}}class _p extends _r{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.records=new Map,this.events=new He.EventEmitter,this.name=Jl,this.version=Gl,this.cached=[],this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.records.set(o.id,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(o,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:o,request:a,chainId:u}),this.records.has(a.id))return;const g={id:a.id,topic:o,request:{method:a.method,params:a.params||null},chainId:u,expiry:(0,d.gn4)(M.THIRTY_DAYS)};this.records.set(g.id,g),this.persist(),this.events.emit(yt.created,g)},this.resolve=async o=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:o}),!this.records.has(o.id))return;const a=await this.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,K.isJsonRpcError)(o)?{error:o.error}:{result:o.result},this.records.set(a.id,a),this.persist(),this.events.emit(yt.updated,a))},this.get=async(o,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:o,id:a}),await this.getRecord(a)),this.delete=(o,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===o){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(yt.deleted,u)}}),this.persist()},this.exists=async(o,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===o:!1),this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,ee.Ep)(r,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const s=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const o={topic:r.topic,request:(0,K.formatJsonRpcRequest)(r.request.method,r.request.params,r.id),chainId:r.chainId};return s.push(o)}),s}async setJsonRpcRecords(s){await this.core.storage.setItem(this.storageKey,s)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(s){this.isInitialized();const r=this.records.get(s);if(!r){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(yt.sync)}async restore(){try{const s=await this.getJsonRpcRecords();if(typeof s>"u"||!s.length)return;if(this.records.size){const{message:r}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}}registerEventListeners(){this.events.on(yt.created,s=>{const r=yt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s})}),this.events.on(yt.updated,s=>{const r=yt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s})}),this.events.on(yt.deleted,s=>{const r=yt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s})}),this.core.heartbeat.on(Gt.Lx.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let s=!1;this.records.forEach(r=>{(0,M.toMiliseconds)(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(yt.deleted,r,!1),s=!0)}),s&&this.persist()}catch(s){this.logger.warn(s)}}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class bp extends Pr{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.expirations=new Map,this.events=new He.EventEmitter,this.name=Wl,this.version=Ql,this.cached=[],this.initialized=!1,this.storagePrefix=Wt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.expirations.set(o.target,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=o=>{try{const a=this.formatTarget(o);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(o,a)=>{this.isInitialized();const u=this.formatTarget(o),g={target:u,expiry:a};this.expirations.set(u,g),this.checkExpiry(u,g),this.events.emit(ct.created,{target:u,expiration:g})},this.get=o=>{this.isInitialized();const a=this.formatTarget(o);return this.getExpiration(a)},this.del=o=>{if(this.isInitialized(),this.has(o)){const a=this.formatTarget(o),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(ct.deleted,{target:a,expiration:u})}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,ee.Ep)(r,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(s){if(typeof s=="string")return(0,d.Z42)(s);if(typeof s=="number")return(0,d.GqV)(s);const{message:r}=(0,d.kCb)("UNKNOWN_TYPE",`Target type: ${typeof s}`);throw new Error(r)}async setExpirations(s){await this.core.storage.setItem(this.storageKey,s)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ct.sync)}async restore(){try{const s=await this.getExpirations();if(typeof s>"u"||!s.length)return;if(this.expirations.size){const{message:r}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(s){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(s)}}getExpiration(s){const r=this.expirations.get(s);if(!r){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.warn(o),new Error(o)}return r}checkExpiry(s,r){const{expiry:o}=r;(0,M.toMiliseconds)(o)-Date.now()<=0&&this.expire(s,r)}expire(s,r){this.expirations.delete(s),this.events.emit(ct.expired,{target:s,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((s,r)=>this.checkExpiry(r,s))}registerEventListeners(){this.core.heartbeat.on(Gt.Lx.pulse,()=>this.checkExpirations()),this.events.on(ct.created,s=>{const r=ct.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(ct.expired,s=>{const r=ct.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(ct.deleted,s=>{const r=ct.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Ep extends O{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.name=Ds,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async o=>{if(this.verifyDisabled||(0,d.b$m)()||!(0,d.jUY)())return;const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Fs;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async o=>{this.initialized?this.sendPost(o.attestationId):(this.addToQueue(o.attestationId),await this.init())},this.resolve=async o=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);let u;try{u=await this.fetchAttestation(o.attestationId,a)}catch(g){this.logger.info(`failed to resolve attestation: ${o.attestationId} from url: ${a}`),this.logger.info(g),u=await this.fetchAttestation(o.attestationId,Fs)}return u},this.fetchAttestation=async(o,a)=>{this.logger.info(`resolving attestation: ${o} from url: ${a}`);const u=this.startAbortTimer(M.ONE_SECOND*2),g=await fetch(`${a}/attestation/${o}`,{signal:this.abortController.signal});return clearTimeout(u),g.status===200?await g.json():void 0},this.addToQueue=o=>{this.queue.push(o)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(o=>this.sendPost(o)),this.queue=[])},this.sendPost=o=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(o,"*"),this.logger.info(`postMessage sent: ${o} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let o;const a=u=>{u.data==="verify_ready"&&(this.onInit(),window.removeEventListener("message",a),o())};await Promise.race([new Promise(u=>{const g=document.getElementById(Ds);if(g)return this.iframe=g,this.onInit(),u();window.addEventListener("message",a);const v=document.createElement("iframe");v.id=Ds,v.src=`${this.verifyUrl}/${this.projectId}`,v.style.display="none",document.body.append(v),this.iframe=v,o=u}),new Promise((u,g)=>setTimeout(()=>{window.removeEventListener("message",a),g("verify iframe load timeout")},(0,M.toMiliseconds)(M.FIVE_SECONDS)))])},this.onInit=()=>{this.initialized=!0,this.processQueue()},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=o=>{let a=o||Ii;return Yl.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Ii}`),a=Ii),a},this.logger=(0,ee.Ep)(r,this.name),this.verifyUrl=Ii,this.abortController=new AbortController,this.isDevEnv=(0,d.UGU)()&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST}get context(){return(0,ee.Fd)(this.logger)}startAbortTimer(s){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,M.toMiliseconds)(s))}}class Ip extends N{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.context=Zl,this.registerDeviceToken=async o=>{const{clientId:a,token:u,notificationType:g,enableEncrypted:v=!1}=o,E=`${Xl}/${this.projectId}/clients`;await eu()(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:g,token:u,always_raw:v})})},this.logger=(0,ee.Ep)(r,this.context)}}var Pp=Object.defineProperty,Yo=Object.getOwnPropertySymbols,Cp=Object.prototype.hasOwnProperty,Sp=Object.prototype.propertyIsEnumerable,Zo=(m,s,r)=>s in m?Pp(m,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[s]=r,Xo=(m,s)=>{for(var r in s||(s={}))Cp.call(s,r)&&Zo(m,r,s[r]);if(Yo)for(var r of Yo(s))Sp.call(s,r)&&Zo(m,r,s[r]);return m};class Ts extends wr{constructor(s){var r;super(s),this.protocol=jo,this.version=Il,this.name=As,this.events=new He.EventEmitter,this.initialized=!1,this.on=(g,v)=>this.events.on(g,v),this.once=(g,v)=>this.events.once(g,v),this.off=(g,v)=>this.events.off(g,v),this.removeListener=(g,v)=>this.events.removeListener(g,v),this.projectId=s==null?void 0:s.projectId,this.relayUrl=(s==null?void 0:s.relayUrl)||Uo,this.customStoragePrefix=s!=null&&s.customStoragePrefix?`:${s.customStoragePrefix}`:"";const o=(0,ee.jI)({level:typeof(s==null?void 0:s.logger)=="string"&&s.logger?s.logger:Pl.logger}),{logger:a,chunkLoggerController:u}=(0,ee.Rt)({opts:o,maxSizeInBytes:s==null?void 0:s.maxLogBlobSizeInBytes,loggerOverride:s==null?void 0:s.logger});this.logChunkController=u,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var g,v;(g=this.logChunkController)!=null&&g.downloadLogsBlobInBrowser&&((v=this.logChunkController)==null||v.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,ee.Ep)(a,this.name),this.heartbeat=new Gt.C$,this.crypto=new tp(this,this.logger,s==null?void 0:s.keychain),this.history=new _p(this,this.logger),this.expirer=new bp(this,this.logger),this.storage=s!=null&&s.storage?s.storage:new pe.Z(Xo(Xo({},Cl),s==null?void 0:s.storageOptions)),this.relayer=new fp({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new wp(this,this.logger),this.verify=new Ep(this.projectId||"",this.logger),this.echoClient=new Ip(this.projectId||"",this.logger)}static async init(s){const r=new Ts(s);await r.initialize();const o=await r.crypto.getClientId();return await r.storage.setItem(zl,o),r}get context(){return(0,ee.Fd)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var s;return(s=this.logChunkController)==null?void 0:s.logsToBlob({clientId:await this.crypto.getClientId()})}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(s){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,s),this.logger.error(s.message),s}}}const xp=Ts,ea="wc",ta=2,ia="client",Ms=`${ea}@${ta}:${ia}:`,$s={name:ia,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},R_={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire"},O_={database:":memory:"},ra="WALLETCONNECT_DEEPLINK_CHOICE",q_={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},A_="history",D_="0.3",Rp="proposal",F_=null,sa="Proposal expired",Op="session",Pi=M.SEVEN_DAYS,qp="engine",Ye={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1114},res:{ttl:M.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:M.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:M.ONE_HOUR,prompt:!1,tag:1117}}},ks={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},Tt={idle:"IDLE",active:"ACTIVE"},Ap="request",Dp=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"],Fp="wc",N_=1.5,Np="auth",Tp="authKeys",Mp="pairingTopics",$p="requests",xr=`${Fp}@${1.5}:${Np}:`,Rr=`${xr}:PUB_KEY`;var kp=Object.defineProperty,jp=Object.defineProperties,Lp=Object.getOwnPropertyDescriptors,na=Object.getOwnPropertySymbols,zp=Object.prototype.hasOwnProperty,Up=Object.prototype.propertyIsEnumerable,oa=(m,s,r)=>s in m?kp(m,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[s]=r,Oe=(m,s)=>{for(var r in s||(s={}))zp.call(s,r)&&oa(m,r,s[r]);if(na)for(var r of na(s))Up.call(s,r)&&oa(m,r,s[r]);return m},hi=(m,s)=>jp(m,Lp(s));class Hp extends se{constructor(s){super(s),this.name=qp,this.events=new(Hi()),this.initialized=!1,this.requestQueue={state:Tt.idle,queue:[]},this.sessionRequestQueue={state:Tt.idle,queue:[]},this.requestQueueDelay=M.ONE_SECOND,this.expectedPairingMethodMap=new Map,this.recentlyDeletedMap=new Map,this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ye)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,M.toMiliseconds)(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const o=hi(Oe({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(o);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:g,sessionProperties:v,relays:E}=o;let x=a,q,F=!1;try{x&&(F=this.client.core.pairing.pairings.get(x).active)}catch(ue){throw this.client.logger.error(`connect() -> pairing.get(${x}) failed`),ue}if(!x||!F){const{topic:ue,uri:he}=await this.client.core.pairing.create();x=ue,q=he}if(!x){const{message:ue}=(0,d.kCb)("NO_MATCHING_KEY",`connect() pairing topic: ${x}`);throw new Error(ue)}const j=await this.client.core.crypto.generateKeyPair(),z=Ye.wc_sessionPropose.req.ttl||M.FIVE_MINUTES,k=(0,d.gn4)(z),J=Oe({requiredNamespaces:u,optionalNamespaces:g,relays:E??[{protocol:zo}],proposer:{publicKey:j,metadata:this.client.metadata},expiryTimestamp:k},v&&{sessionProperties:v}),{reject:Z,resolve:re,done:ge}=(0,d.H1S)(z,sa);this.events.once((0,d.E0T)("session_connect"),async({error:ue,session:he})=>{if(ue)Z(ue);else if(he){he.self.publicKey=j;const Re=hi(Oe({},he),{requiredNamespaces:J.requiredNamespaces,optionalNamespaces:J.optionalNamespaces});await this.client.session.set(he.topic,Re),await this.setExpiry(he.topic,he.expiry),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:he.peer.metadata}),re(Re)}});const ce=await this.sendRequest({topic:x,method:"wc_sessionPropose",params:J,throwOnFailedPublish:!0});return await this.setProposal(ce,Oe({id:ce},J)),{uri:q,approval:ge}},this.pair=async r=>{await this.isInitialized();try{return await this.client.core.pairing.pair(r)}catch(o){throw this.client.logger.error("pair() failed"),o}},this.approve=async r=>{await this.isInitialized();try{await this.isValidApprove(r)}catch(ge){throw this.client.logger.error("approve() -> isValidApprove() failed"),ge}const{id:o,relayProtocol:a,namespaces:u,sessionProperties:g,sessionConfig:v}=r;let E;try{E=this.client.proposal.get(o)}catch(ge){throw this.client.logger.error(`approve() -> proposal.get(${o}) failed`),ge}let{pairingTopic:x,proposer:q,requiredNamespaces:F,optionalNamespaces:j}=E;x=x||"";const z=await this.client.core.crypto.generateKeyPair(),k=q.publicKey,J=await this.client.core.crypto.generateSharedKey(z,k),Z=Oe(Oe({relay:{protocol:a??"irn"},namespaces:u,pairingTopic:x,controller:{publicKey:z,metadata:this.client.metadata},expiry:(0,d.gn4)(Pi)},g&&{sessionProperties:g}),v&&{sessionConfig:v});await this.client.core.relayer.subscribe(J);const re=hi(Oe({},Z),{topic:J,requiredNamespaces:F,optionalNamespaces:j,pairingTopic:x,acknowledged:!1,self:Z.controller,peer:{publicKey:q.publicKey,metadata:q.metadata},controller:z});await this.client.session.set(J,re);try{await this.sendResult({id:o,topic:x,result:{relay:{protocol:a??"irn"},responderPublicKey:z},throwOnFailedPublish:!0}),await this.sendRequest({topic:J,method:"wc_sessionSettle",params:Z,throwOnFailedPublish:!0})}catch(ge){throw this.client.logger.error(ge),this.client.session.delete(J,(0,d.D6H)("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(J),ge}return await this.client.core.pairing.updateMetadata({topic:x,metadata:q.metadata}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:x}),await this.setExpiry(J,(0,d.gn4)(Pi)),{topic:J,acknowledged:()=>new Promise(ge=>setTimeout(()=>ge(this.client.session.get(J)),500))}},this.reject=async r=>{await this.isInitialized();try{await this.isValidReject(r)}catch(g){throw this.client.logger.error("reject() -> isValidReject() failed"),g}const{id:o,reason:a}=r;let u;try{u=this.client.proposal.get(o).pairingTopic}catch(g){throw this.client.logger.error(`reject() -> proposal.get(${o}) failed`),g}u&&(await this.sendError({id:o,topic:u,error:a}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized();try{await this.isValidUpdate(r)}catch(F){throw this.client.logger.error("update() -> isValidUpdate() failed"),F}const{topic:o,namespaces:a}=r,{done:u,resolve:g,reject:v}=(0,d.H1S)(),E=(0,K.payloadId)(),x=(0,K.getBigIntRpcId)().toString(),q=this.client.session.get(o).namespaces;return this.events.once((0,d.E0T)("session_update",E),({error:F})=>{F?v(F):g()}),await this.client.session.update(o,{namespaces:a}),await this.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a},throwOnFailedPublish:!0,clientRpcId:E,relayRpcId:x}).catch(F=>{this.client.logger.error(F),this.client.session.update(o,{namespaces:q}),v(F)}),{acknowledged:u}},this.extend=async r=>{await this.isInitialized();try{await this.isValidExtend(r)}catch(E){throw this.client.logger.error("extend() -> isValidExtend() failed"),E}const{topic:o}=r,a=(0,K.payloadId)(),{done:u,resolve:g,reject:v}=(0,d.H1S)();return this.events.once((0,d.E0T)("session_extend",a),({error:E})=>{E?v(E):g()}),await this.setExpiry(o,(0,d.gn4)(Pi)),this.sendRequest({topic:o,method:"wc_sessionExtend",params:{},clientRpcId:a,throwOnFailedPublish:!0}).catch(E=>{v(E)}),{acknowledged:u}},this.request=async r=>{await this.isInitialized();try{await this.isValidRequest(r)}catch(z){throw this.client.logger.error("request() -> isValidRequest() failed"),z}const{chainId:o,request:a,topic:u,expiry:g=Ye.wc_sessionRequest.req.ttl}=r,v=this.client.session.get(u),E=(0,K.payloadId)(),x=(0,K.getBigIntRpcId)().toString(),{done:q,resolve:F,reject:j}=(0,d.H1S)(g,"Request expired. Please try again.");return this.events.once((0,d.E0T)("session_request",E),({error:z,result:k})=>{z?j(z):F(k)}),await Promise.all([new Promise(async z=>{await this.sendRequest({clientRpcId:E,relayRpcId:x,topic:u,method:"wc_sessionRequest",params:{request:hi(Oe({},a),{expiryTimestamp:(0,d.gn4)(g)}),chainId:o},expiry:g,throwOnFailedPublish:!0}).catch(k=>j(k)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:o,id:E}),z()}),new Promise(async z=>{var k;if(!((k=v.sessionConfig)!=null&&k.disableDeepLink)){const J=await(0,d.bW6)(this.client.core.storage,ra);(0,d.HhN)({id:E,topic:u,wcDeepLink:J})}z()}),q()]).then(z=>z[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:o,response:a}=r,{id:u}=a;(0,K.isJsonRpcResult)(a)?await this.sendResult({id:u,topic:o,result:a.result,throwOnFailedPublish:!0}):(0,K.isJsonRpcError)(a)&&await this.sendError({id:u,topic:o,error:a.error}),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized();try{await this.isValidPing(r)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}const{topic:o}=r;if(this.client.session.keys.includes(o)){const a=(0,K.payloadId)(),u=(0,K.getBigIntRpcId)().toString(),{done:g,resolve:v,reject:E}=(0,d.H1S)();this.events.once((0,d.E0T)("session_ping",a),({error:x})=>{x?E(x):v()}),await Promise.all([this.sendRequest({topic:o,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:u}),g()])}else this.client.core.pairing.pairings.keys.includes(o)&&await this.client.core.pairing.ping({topic:o})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:o,event:a,chainId:u}=r,g=(0,K.getBigIntRpcId)().toString();await this.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:u},throwOnFailedPublish:!0,relayRpcId:g})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:o}=r;if(this.client.session.keys.includes(o))await this.sendRequest({topic:o,method:"wc_sessionDelete",params:(0,d.D6H)("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:o,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(o))await this.client.core.pairing.disconnect({topic:o});else{const{message:a}=(0,d.kCb)("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(o=>(0,d.Ih8)(o,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.authenticate=async r=>{this.isInitialized(),this.isValidAuthenticate(r);const{chains:o,statement:a="",uri:u,domain:g,nonce:v,type:E,exp:x,nbf:q,methods:F=[],expiry:j}=r,z=[...r.resources||[]],{topic:k,uri:J}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"]});this.client.logger.info({message:"Generated new pairing",pairing:{topic:k,uri:J}});const Z=await this.client.core.crypto.generateKeyPair(),re=(0,d.YmJ)(Z);if(await Promise.all([this.client.auth.authKeys.set(Rr,{responseTopic:re,publicKey:Z}),this.client.auth.pairingTopics.set(re,{topic:re,pairingTopic:k})]),await this.client.core.relayer.subscribe(re),this.client.logger.info(`sending request to new pairing topic: ${k}`),F.length>0){const{namespace:Xe}=(0,d.DQe)(o[0]);let Fe=(0,d.IkP)(Xe,"request",F);(0,d.hA9)(z)&&(Fe=(0,d.qJM)(Fe,z.pop())),z.push(Fe)}const ge=j&&j>Ye.wc_sessionAuthenticate.req.ttl?j:Ye.wc_sessionAuthenticate.req.ttl,ce={authPayload:{type:E??"caip122",chains:o,statement:a,aud:u,domain:g,version:"1",nonce:v,iat:new Date().toISOString(),exp:x,nbf:q,resources:z},requester:{publicKey:Z,metadata:this.client.metadata},expiryTimestamp:(0,d.gn4)(ge)},ue={eip155:{chains:o,methods:[...new Set(["personal_sign",...F])],events:["chainChanged","accountsChanged"]}},he={requiredNamespaces:{},optionalNamespaces:ue,relays:[{protocol:"irn"}],proposer:{publicKey:Z,metadata:this.client.metadata},expiryTimestamp:(0,d.gn4)(Ye.wc_sessionPropose.req.ttl)},{done:Re,resolve:Ee,reject:qe}=(0,d.H1S)(ge,"Request expired"),Ze=async({error:Xe,session:Fe})=>{if(this.events.off((0,d.E0T)("session_request",Zt),Gi),Xe)qe(Xe);else if(Fe){Fe.self.publicKey=Z,await this.client.session.set(Fe.topic,Fe),await this.setExpiry(Fe.topic,Fe.expiry),k&&await this.client.core.pairing.updateMetadata({topic:k,metadata:Fe.peer.metadata});const pi=this.client.session.get(Fe.topic);await this.deleteProposal(li),Ee({session:pi})}},Gi=async Xe=>{if(await this.deletePendingAuthRequest(Zt,{message:"fulfilled",code:0}),Xe.error){const Rt=(0,d.D6H)("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return Xe.error.code===Rt.code?void 0:(this.events.off((0,d.E0T)("session_connect"),Ze),qe(Xe.error.message))}await this.deleteProposal(li),this.events.off((0,d.E0T)("session_connect"),Ze);const{cacaos:Fe,responder:pi}=Xe.result,Wi=[],xt=[];for(const Rt of Fe){await(0,d.c4l)({cacao:Rt,projectId:this.client.core.projectId})||(this.client.logger.error(Rt,"Signature verification failed"),qe((0,d.D6H)("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Ke}=Rt,Qi=(0,d.hA9)(Ke.resources),Fr=[(0,d.DJo)(Ke.iss)],Qs=(0,d.NmC)(Ke.iss);if(Qi){const Ot=(0,d.Y31)(Qi),xi=(0,d.ouN)(Qi);Wi.push(...Ot),Fr.push(...xi)}for(const Ot of Fr)xt.push(`${Ot}:${Qs}`)}const et=await this.client.core.crypto.generateSharedKey(Z,pi.publicKey);let Si;Wi.length>0&&(Si={topic:et,acknowledged:!0,self:{publicKey:Z,metadata:this.client.metadata},peer:pi,controller:pi.publicKey,expiry:(0,d.gn4)(Pi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:k,namespaces:(0,d.E12)([...new Set(Wi)],[...new Set(xt)])},await this.client.core.relayer.subscribe(et),await this.client.session.set(et,Si),Si=this.client.session.get(et)),Ee({auths:Fe,session:Si})},Zt=(0,K.payloadId)(),li=(0,K.payloadId)();this.events.once((0,d.E0T)("session_connect"),Ze),this.events.once((0,d.E0T)("session_request",Zt),Gi);try{await Promise.all([this.sendRequest({topic:k,method:"wc_sessionAuthenticate",params:ce,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:Zt}),this.sendRequest({topic:k,method:"wc_sessionPropose",params:he,expiry:Ye.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:li})])}catch(Xe){throw this.events.off((0,d.E0T)("session_connect"),Ze),this.events.off((0,d.E0T)("session_request",Zt),Gi),Xe}return await this.setProposal(li,Oe({id:li},he)),await this.setAuthRequest(Zt,{request:hi(Oe({},ce),{verifyContext:{}}),pairingTopic:k}),{uri:J,response:Re}},this.approveSessionAuthenticate=async r=>{this.isInitialized();const{id:o,auths:a}=r,u=this.getPendingAuthRequest(o);if(!u)throw new Error(`Could not find pending auth request with id ${o}`);const g=u.requester.publicKey,v=await this.client.core.crypto.generateKeyPair(),E=(0,d.YmJ)(g),x={type:d.rVF,receiverPublicKey:g,senderPublicKey:v},q=[],F=[];for(const k of a){if(!await(0,d.c4l)({cacao:k,projectId:this.client.core.projectId})){const ce=(0,d.D6H)("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:o,topic:E,error:ce,encodeOpts:x}),new Error(ce.message)}const{p:J}=k,Z=(0,d.hA9)(J.resources),re=[(0,d.DJo)(J.iss)],ge=(0,d.NmC)(J.iss);if(Z){const ce=(0,d.Y31)(Z),ue=(0,d.ouN)(Z);q.push(...ce),re.push(...ue)}for(const ce of re)F.push(`${ce}:${ge}`)}const j=await this.client.core.crypto.generateSharedKey(v,g);let z;return(q==null?void 0:q.length)>0&&(z={topic:j,acknowledged:!0,self:{publicKey:v,metadata:this.client.metadata},peer:{publicKey:g,metadata:u.requester.metadata},controller:g,expiry:(0,d.gn4)(Pi),authentication:a,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:"",namespaces:(0,d.E12)([...new Set(q)],[...new Set(F)])},await this.client.core.relayer.subscribe(j),await this.client.session.set(j,z)),await this.sendResult({topic:E,id:o,result:{cacaos:a,responder:{publicKey:v,metadata:this.client.metadata}},encodeOpts:x,throwOnFailedPublish:!0}),await this.client.auth.requests.delete(o,{message:"fullfilled",code:0}),await this.client.core.pairing.activate({topic:u.pairingTopic}),{session:z}},this.rejectSessionAuthenticate=async r=>{await this.isInitialized();const{id:o,reason:a}=r,u=this.getPendingAuthRequest(o);if(!u)throw new Error(`Could not find pending auth request with id ${o}`);const g=u.requester.publicKey,v=await this.client.core.crypto.generateKeyPair(),E=(0,d.YmJ)(g),x={type:d.rVF,receiverPublicKey:g,senderPublicKey:v};await this.sendError({id:o,topic:E,error:a,encodeOpts:x}),await this.client.auth.requests.delete(o,{message:"rejected",code:0}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED"))},this.formatAuthMessage=r=>{this.isInitialized();const{request:o,iss:a}=r;return(0,d.wvx)(o,a)},this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const o=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var g,v;return((g=u.peerMetadata)==null?void 0:g.url)&&((v=u.peerMetadata)==null?void 0:v.url)===r.peer.metadata.url&&u.topic&&u.topic!==o.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(o){this.client.logger.error(o)}},this.deleteSession=async r=>{const{topic:o,expirerHasDeleted:a=!1,emitEvent:u=!0,id:g=0}=r,{self:v}=this.client.session.get(o);await this.client.core.relayer.unsubscribe(o),await this.client.session.delete(o,(0,d.D6H)("USER_DISCONNECTED")),this.addToRecentlyDeleted(o,"session"),this.client.core.crypto.keychain.has(v.publicKey)&&await this.client.core.crypto.deleteKeyPair(v.publicKey),this.client.core.crypto.keychain.has(o)&&await this.client.core.crypto.deleteSymKey(o),a||this.client.core.expirer.del(o),this.client.core.storage.removeItem(ra).catch(E=>this.client.logger.warn(E)),this.getPendingSessionRequests().forEach(E=>{E.topic===o&&this.deletePendingSessionRequest(E.id,(0,d.D6H)("USER_DISCONNECTED"))}),u&&this.client.events.emit("session_delete",{id:g,topic:o})},this.deleteProposal=async(r,o)=>{await Promise.all([this.client.proposal.delete(r,(0,d.D6H)("USER_DISCONNECTED")),o?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")},this.deletePendingSessionRequest=async(r,o,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,o),a?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=Tt.idle,this.client.events.emit("session_request_expire",{id:r}))},this.deletePendingAuthRequest=async(r,o,a=!1)=>{await Promise.all([this.client.auth.requests.delete(r,o),a?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,o)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,o),await this.client.session.update(r,{expiry:o}))},this.setProposal=async(r,o)=>{this.client.core.expirer.set(r,(0,d.gn4)(Ye.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,o)},this.setAuthRequest=async(r,o)=>{const{request:a,pairingTopic:u}=o;this.client.core.expirer.set(r,a.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:a.authPayload,requester:a.requester,expiryTimestamp:a.expiryTimestamp,id:r,pairingTopic:u,verifyContext:a.verifyContext})},this.setPendingSessionRequest=async r=>{const{id:o,topic:a,params:u,verifyContext:g}=r,v=u.request.expiryTimestamp||(0,d.gn4)(Ye.wc_sessionRequest.req.ttl);this.client.core.expirer.set(o,v),await this.client.pendingRequest.set(o,{id:o,topic:a,params:u,verifyContext:g})},this.sendRequest=async r=>{const{topic:o,method:a,params:u,expiry:g,relayRpcId:v,clientRpcId:E,throwOnFailedPublish:x}=r,q=(0,K.formatJsonRpcRequest)(a,u,E);if((0,d.jUY)()&&Dp.includes(a)){const z=(0,d.rjm)(JSON.stringify(q));this.client.core.verify.register({attestationId:z})}let F;try{F=await this.client.core.crypto.encode(o,q)}catch(z){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${o} failed`),z}const j=Ye[a].req;return g&&(j.ttl=g),v&&(j.id=v),this.client.core.history.set(o,q),x?(j.internal=hi(Oe({},j.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,F,j)):this.client.core.relayer.publish(o,F,j).catch(z=>this.client.logger.error(z)),q.id},this.sendResult=async r=>{const{id:o,topic:a,result:u,throwOnFailedPublish:g,encodeOpts:v}=r,E=(0,K.formatJsonRpcResult)(o,u);let x;try{x=await this.client.core.crypto.encode(a,E,v)}catch(j){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),j}let q;try{q=await this.client.core.history.get(a,o)}catch(j){throw this.client.logger.error(`sendResult() -> history.get(${a}, ${o}) failed`),j}const F=Ye[q.request.method].res;g?(F.internal=hi(Oe({},F.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,x,F)):this.client.core.relayer.publish(a,x,F).catch(j=>this.client.logger.error(j)),await this.client.core.history.resolve(E)},this.sendError=async r=>{const{id:o,topic:a,error:u,encodeOpts:g}=r,v=(0,K.formatJsonRpcError)(o,u);let E;try{E=await this.client.core.crypto.encode(a,v,g)}catch(F){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${a} failed`),F}let x;try{x=await this.client.core.history.get(a,o)}catch(F){throw this.client.logger.error(`sendError() -> history.get(${a}, ${o}) failed`),F}const q=Ye[x.request.method].res;this.client.core.relayer.publish(a,E,q),await this.client.core.history.resolve(v)},this.cleanup=async()=>{const r=[],o=[];this.client.session.getAll().forEach(a=>{let u=!1;(0,d.BwD)(a.expiry)&&(u=!0),this.client.core.crypto.keychain.has(a.topic)||(u=!0),u&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{(0,d.BwD)(a.expiryTimestamp)&&o.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession({topic:a})),...o.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Tt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Tt.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(o=>setTimeout(o,300))}catch(o){this.client.logger.warn(o)}}this.requestQueue.state=Tt.idle},this.processRequest=r=>{const{topic:o,payload:a}=r,u=a.method;if(!this.shouldIgnorePairingRequest({topic:o,requestMethod:u}))switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(o,a);case"wc_sessionSettle":return this.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return this.onSessionExtendRequest(o,a);case"wc_sessionPing":return this.onSessionPingRequest(o,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return this.onSessionRequest(o,a);case"wc_sessionEvent":return this.onSessionEventRequest(o,a);case"wc_sessionAuthenticate":return this.onSessionAuthenticateRequest(o,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:o,payload:a}=r,u=(await this.client.core.history.get(o,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(o,a);case"wc_sessionSettle":return this.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return this.onSessionExtendResponse(o,a);case"wc_sessionPing":return this.onSessionPingResponse(o,a);case"wc_sessionRequest":return this.onSessionRequestResponse(o,a);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(o,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:o}=r,{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Decoded payload on topic ${o} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.shouldIgnorePairingRequest=r=>{const{topic:o,requestMethod:a}=r,u=this.expectedPairingMethodMap.get(o);return!u||u.includes(a)?!1:!!(u.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)},this.onSessionProposeRequest=async(r,o)=>{const{params:a,id:u}=o;try{this.isValidConnect(Oe({},o.params));const g=a.expiryTimestamp||(0,d.gn4)(Ye.wc_sessionPropose.req.ttl),v=Oe({id:u,pairingTopic:r,expiryTimestamp:g},a);await this.setProposal(u,v);const E=(0,d.rjm)(JSON.stringify(o)),x=await this.getVerifyContext(E,v.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:v,verifyContext:x})}catch(g){await this.sendError({id:u,topic:r,error:g}),this.client.logger.error(g)}},this.onSessionProposeResponse=async(r,o)=>{const{id:a}=o;if((0,K.isJsonRpcResult)(o)){const{result:u}=o;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const g=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const v=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:v});const E=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:E});const x=await this.client.core.crypto.generateSharedKey(v,E);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:x});const q=await this.client.core.relayer.subscribe(x);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:q}),await this.client.core.pairing.activate({topic:r})}else if((0,K.isJsonRpcError)(o)){await this.client.proposal.delete(a,(0,d.D6H)("USER_DISCONNECTED"));const u=(0,d.E0T)("session_connect");if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners, 954`);this.events.emit((0,d.E0T)("session_connect"),{error:o.error})}},this.onSessionSettleRequest=async(r,o)=>{const{id:a,params:u}=o;try{this.isValidSessionSettleRequest(u);const{relay:g,controller:v,expiry:E,namespaces:x,sessionProperties:q,pairingTopic:F,sessionConfig:j}=o.params,z=Oe(Oe({topic:r,relay:g,expiry:E,namespaces:x,acknowledged:!0,pairingTopic:F,requiredNamespaces:{},optionalNamespaces:{},controller:v.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:v.publicKey,metadata:v.metadata}},q&&{sessionProperties:q}),j&&{sessionConfig:j});await this.sendResult({id:o.id,topic:r,result:!0,throwOnFailedPublish:!0});const k=(0,d.E0T)("session_connect");if(this.events.listenerCount(k)===0)throw new Error(`emitting ${k} without any listeners 997`);this.events.emit((0,d.E0T)("session_connect"),{session:z}),this.cleanupDuplicatePairings(z)}catch(g){await this.sendError({id:a,topic:r,error:g}),this.client.logger.error(g)}},this.onSessionSettleResponse=async(r,o)=>{const{id:a}=o;(0,K.isJsonRpcResult)(o)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit((0,d.E0T)("session_approve",a),{})):(0,K.isJsonRpcError)(o)&&(await this.client.session.delete(r,(0,d.D6H)("USER_DISCONNECTED")),this.events.emit((0,d.E0T)("session_approve",a),{error:o.error}))},this.onSessionUpdateRequest=async(r,o)=>{const{params:a,id:u}=o;try{const g=`${r}_session_update`,v=d.O6B.get(g);if(v&&this.isRequestOutOfSync(v,u)){this.client.logger.info(`Discarding out of sync request - ${u}`),this.sendError({id:u,topic:r,error:(0,d.D6H)("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Oe({topic:r},a));try{d.O6B.set(g,u),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0,throwOnFailedPublish:!0})}catch(E){throw d.O6B.delete(g),E}this.client.events.emit("session_update",{id:u,topic:r,params:a})}catch(g){await this.sendError({id:u,topic:r,error:g}),this.client.logger.error(g)}},this.isRequestOutOfSync=(r,o)=>parseInt(o.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,o)=>{const{id:a}=o,u=(0,d.E0T)("session_update",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,K.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_update",a),{}):(0,K.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_update",a),{error:o.error})},this.onSessionExtendRequest=async(r,o)=>{const{id:a}=o;try{this.isValidExtend({topic:r}),await this.setExpiry(r,(0,d.gn4)(Pi)),await this.sendResult({id:a,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError({id:a,topic:r,error:u}),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,o)=>{const{id:a}=o,u=(0,d.E0T)("session_extend",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,K.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_extend",a),{}):(0,K.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_extend",a),{error:o.error})},this.onSessionPingRequest=async(r,o)=>{const{id:a}=o;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError({id:a,topic:r,error:u}),this.client.logger.error(u)}},this.onSessionPingResponse=(r,o)=>{const{id:a}=o,u=(0,d.E0T)("session_ping",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);setTimeout(()=>{(0,K.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_ping",a),{}):(0,K.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_ping",a),{error:o.error})},500)},this.onSessionDeleteRequest=async(r,o)=>{const{id:a}=o;try{this.isValidDisconnect({topic:r,reason:o.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Ve.publish,async()=>{u(await this.deleteSession({topic:r,id:a}))})}),this.sendResult({id:a,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:(0,d.D6H)("USER_DISCONNECTED")})])}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,o)=>{var a;const{id:u,params:g}=o;try{await this.isValidRequest(Oe({topic:r},g));const v=(0,d.rjm)(JSON.stringify((0,K.formatJsonRpcRequest)("wc_sessionRequest",g,u))),E=this.client.session.get(r),x=await this.getVerifyContext(v,E.peer.metadata),q={id:u,topic:r,params:g,verifyContext:x};await this.setPendingSessionRequest(q),(a=this.client.signConfig)!=null&&a.disableRequestQueue?this.emitSessionRequest(q):(this.addSessionRequestToSessionRequestQueue(q),this.processSessionRequestQueue())}catch(v){await this.sendError({id:u,topic:r,error:v}),this.client.logger.error(v)}},this.onSessionRequestResponse=(r,o)=>{const{id:a}=o,u=(0,d.E0T)("session_request",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,K.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_request",a),{result:o.result}):(0,K.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_request",a),{error:o.error})},this.onSessionEventRequest=async(r,o)=>{const{id:a,params:u}=o;try{const g=`${r}_session_event_${u.event.name}`,v=d.O6B.get(g);if(v&&this.isRequestOutOfSync(v,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Oe({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),d.O6B.set(g,a)}catch(g){await this.sendError({id:a,topic:r,error:g}),this.client.logger.error(g)}},this.onSessionAuthenticateResponse=(r,o)=>{const{id:a}=o;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:o}),(0,K.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_request",a),{result:o.result}):(0,K.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_request",a),{error:o.error})},this.onSessionAuthenticateRequest=async(r,o)=>{const{requester:a,authPayload:u,expiryTimestamp:g}=o.params,v=(0,d.rjm)(JSON.stringify(o)),E=await this.getVerifyContext(v,this.client.metadata),x={requester:a,pairingTopic:r,id:o.id,authPayload:u,verifyContext:E,expiryTimestamp:g};await this.setAuthRequest(o.id,{request:x,pairingTopic:r}),this.client.events.emit("session_authenticate",{topic:r,params:o.params,id:o.id})},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Tt.idle,this.processSessionRequestQueue()},(0,M.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:o})=>{const a=this.client.core.history.pending;a.length>0&&a.filter(u=>u.topic===r&&u.request.method==="wc_sessionRequest").forEach(u=>{const g=u.request.id,v=(0,d.E0T)("session_request",g);if(this.events.listenerCount(v)===0)throw new Error(`emitting ${v} without any listeners`);this.events.emit((0,d.E0T)("session_request",u.request.id),{error:o})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Tt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Tt.active,this.emitSessionRequest(r)}catch(o){this.client.logger.error(o)}},this.emitSessionRequest=r=>{this.client.events.emit("session_request",r)},this.onPairingCreated=r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const o=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);o&&this.onSessionProposeRequest(r.topic,(0,K.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,relays:o.relays,proposer:o.proposer,sessionProperties:o.sessionProperties},o.id))},this.isValidConnect=async r=>{if(!(0,d.EJd)(r)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(E)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:g,relays:v}=r;if((0,d.o8e)(o)||await this.isValidPairingTopic(o),!(0,d.PMr)(v,!0)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`connect() relays: ${v}`);throw new Error(E)}!(0,d.o8e)(a)&&(0,d.L5o)(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!(0,d.o8e)(u)&&(0,d.L5o)(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),(0,d.o8e)(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(r,o)=>{const a=(0,d.naP)(r,"connect()",o);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!(0,d.EJd)(r))throw new Error((0,d.kCb)("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:o,namespaces:a,relayProtocol:u,sessionProperties:g}=r;this.checkRecentlyDeleted(o),await this.isValidProposalId(o);const v=this.client.proposal.get(o),E=(0,d.ing)(a,"approve()");if(E)throw new Error(E.message);const x=(0,d.rFo)(v.requiredNamespaces,a,"approve()");if(x)throw new Error(x.message);if(!(0,d.M_r)(u,!0)){const{message:q}=(0,d.kCb)("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(q)}(0,d.o8e)(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async r=>{if(!(0,d.EJd)(r)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:o,reason:a}=r;if(this.checkRecentlyDeleted(o),await this.isValidProposalId(o),!(0,d.H4H)(a)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!(0,d.EJd)(r)){const{message:x}=(0,d.kCb)("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(x)}const{relay:o,controller:a,namespaces:u,expiry:g}=r;if(!(0,d.Z26)(o)){const{message:x}=(0,d.kCb)("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(x)}const v=(0,d.DdM)(a,"onSessionSettleRequest()");if(v)throw new Error(v.message);const E=(0,d.ing)(u,"onSessionSettleRequest()");if(E)throw new Error(E.message);if((0,d.BwD)(g)){const{message:x}=(0,d.kCb)("EXPIRED","onSessionSettleRequest()");throw new Error(x)}},this.isValidUpdate=async r=>{if(!(0,d.EJd)(r)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(E)}const{topic:o,namespaces:a}=r;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o);const u=this.client.session.get(o),g=(0,d.ing)(a,"update()");if(g)throw new Error(g.message);const v=(0,d.rFo)(u.requiredNamespaces,a,"update()");if(v)throw new Error(v.message)},this.isValidExtend=async r=>{if(!(0,d.EJd)(r)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:o}=r;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o)},this.isValidRequest=async r=>{if(!(0,d.EJd)(r)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(E)}const{topic:o,request:a,chainId:u,expiry:g}=r;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o);const{namespaces:v}=this.client.session.get(o);if(!(0,d.p8o)(v,u)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(E)}if(!(0,d.hHR)(a)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(E)}if(!(0,d.alS)(v,u,a.method)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(E)}if(g&&!(0,d.ONw)(g,ks)){const{message:E}=(0,d.kCb)("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${ks.min} and ${ks.max}`);throw new Error(E)}},this.isValidRespond=async r=>{var o;if(!(0,d.EJd)(r)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(g)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(g){throw(o=r==null?void 0:r.response)!=null&&o.id&&this.cleanupAfterResponse(r),g}if(!(0,d.JTI)(u)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(g)}},this.isValidPing=async r=>{if(!(0,d.EJd)(r)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.isValidEmit=async r=>{if(!(0,d.EJd)(r)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(v)}const{topic:o,event:a,chainId:u}=r;await this.isValidSessionTopic(o);const{namespaces:g}=this.client.session.get(o);if(!(0,d.p8o)(g,u)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(v)}if(!(0,d.nfW)(a)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}if(!(0,d.B95)(g,u,a.name)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}},this.isValidDisconnect=async r=>{if(!(0,d.EJd)(r)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.isValidAuthenticate=r=>{const{chains:o,uri:a,domain:u,nonce:g}=r;if(!Array.isArray(o)||o.length===0)throw new Error("chains is required and must be a non-empty array");if(!(0,d.M_r)(a,!1))throw new Error("uri is required parameter");if(!(0,d.M_r)(u,!1))throw new Error("domain is required parameter");if(!(0,d.M_r)(g,!1))throw new Error("nonce is required parameter");if([...new Set(o.map(E=>(0,d.DQe)(E).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:v}=(0,d.DQe)(o[0]);if(v!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")},this.getVerifyContext=async(r,o)=>{const a={verified:{verifyUrl:o.verifyUrl||Ii,validation:"UNKNOWN",origin:o.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:o.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,o)=>{Object.values(r).forEach(a=>{if(!(0,d.M_r)(a,!1)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`${o} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})},this.getPendingAuthRequest=r=>{const o=this.client.auth.requests.get(r);return typeof o=="object"?o:void 0},this.addToRecentlyDeleted=(r,o)=>{if(this.recentlyDeletedMap.set(r,o),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0;const u=this.recentlyDeletedLimit/2;for(const g of this.recentlyDeletedMap.keys()){if(a++>=u)break;this.recentlyDeletedMap.delete(g)}}},this.checkRecentlyDeleted=r=>{const o=this.recentlyDeletedMap.get(r);if(o){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Record was recently deleted - ${o}: ${r}`);throw new Error(a)}}}async isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ve.message,async s=>{const{topic:r,message:o}=s,{publicKey:a}=this.client.auth.authKeys.keys.includes(Rr)?this.client.auth.authKeys.get(Rr):{responseTopic:void 0,publicKey:void 0},u=await this.client.core.crypto.decode(r,o,{receiverPublicKey:a});try{(0,K.isJsonRpcRequest)(u)?(this.client.core.history.set(r,u),this.onRelayEventRequest({topic:r,payload:u})):(0,K.isJsonRpcResponse)(u)?(await this.client.core.history.resolve(u),await this.onRelayEventResponse({topic:r,payload:u}),this.client.core.history.delete(r,u.id)):this.onRelayEventUnknownPayload({topic:r,payload:u})}catch(g){this.client.logger.error(g)}})}registerExpirerEvents(){this.client.core.expirer.on(ct.expired,async s=>{const{topic:r,id:o}=(0,d.iPz)(s.target);if(o&&this.client.pendingRequest.keys.includes(o))return await this.deletePendingSessionRequest(o,(0,d.kCb)("EXPIRED"),!0);if(o&&this.client.auth.requests.keys.includes(o))return await this.deletePendingAuthRequest(o,(0,d.kCb)("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):o&&(await this.deleteProposal(o,!0),this.client.events.emit("proposal_expire",{id:o}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ei.create,s=>this.onPairingCreated(s)),this.client.core.pairing.events.on(Ei.delete,s=>{this.addToRecentlyDeleted(s.topic,"pairing")})}isValidPairingTopic(s){if(!(0,d.M_r)(s,!1)){const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(s)){const{message:r}=(0,d.kCb)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if((0,d.BwD)(this.client.core.pairing.pairings.get(s).expiry)){const{message:r}=(0,d.kCb)("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}}async isValidSessionTopic(s){if(!(0,d.M_r)(s,!1)){const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`session topic should be a string: ${s}`);throw new Error(r)}if(this.checkRecentlyDeleted(s),!this.client.session.keys.includes(s)){const{message:r}=(0,d.kCb)("NO_MATCHING_KEY",`session topic doesn't exist: ${s}`);throw new Error(r)}if((0,d.BwD)(this.client.session.get(s).expiry)){await this.deleteSession({topic:s});const{message:r}=(0,d.kCb)("EXPIRED",`session topic: ${s}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(s)){const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`session topic does not exist in keychain: ${s}`);throw await this.deleteSession({topic:s}),new Error(r)}}async isValidSessionOrPairingTopic(s){if(this.checkRecentlyDeleted(s),this.client.session.keys.includes(s))await this.isValidSessionTopic(s);else if(this.client.core.pairing.pairings.keys.includes(s))this.isValidPairingTopic(s);else if((0,d.M_r)(s,!1)){const{message:r}=(0,d.kCb)("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${s}`);throw new Error(r)}else{const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`session or pairing topic should be a string: ${s}`);throw new Error(r)}}async isValidProposalId(s){if(!(0,d.Q01)(s)){const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`proposal id should be a number: ${s}`);throw new Error(r)}if(!this.client.proposal.keys.includes(s)){const{message:r}=(0,d.kCb)("NO_MATCHING_KEY",`proposal id doesn't exist: ${s}`);throw new Error(r)}if((0,d.BwD)(this.client.proposal.get(s).expiryTimestamp)){await this.deleteProposal(s);const{message:r}=(0,d.kCb)("EXPIRED",`proposal id: ${s}`);throw new Error(r)}}}class Bp extends ci{constructor(s,r){super(s,r,Rp,Ms),this.core=s,this.logger=r}}class Vp extends ci{constructor(s,r){super(s,r,Op,Ms),this.core=s,this.logger=r}}class Kp extends ci{constructor(s,r){super(s,r,Ap,Ms,o=>o.id),this.core=s,this.logger=r}}class Jp extends ci{constructor(s,r){super(s,r,Tp,xr,()=>Rr),this.core=s,this.logger=r}}class Gp extends ci{constructor(s,r){super(s,r,Mp,xr),this.core=s,this.logger=r}}class Wp extends ci{constructor(s,r){super(s,r,$p,xr,o=>o.id),this.core=s,this.logger=r}}class Qp{constructor(s,r){this.core=s,this.logger=r,this.authKeys=new Jp(this.core,this.logger),this.pairingTopics=new Gp(this.core,this.logger),this.requests=new Wp(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}class js extends G{constructor(s){super(s),this.protocol=ea,this.version=ta,this.name=$s.name,this.events=new He.EventEmitter,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.removeAllListeners=o=>this.events.removeAllListeners(o),this.connect=async o=>{try{return await this.engine.connect(o)}catch(a){throw this.logger.error(a.message),a}},this.pair=async o=>{try{return await this.engine.pair(o)}catch(a){throw this.logger.error(a.message),a}},this.approve=async o=>{try{return await this.engine.approve(o)}catch(a){throw this.logger.error(a.message),a}},this.reject=async o=>{try{return await this.engine.reject(o)}catch(a){throw this.logger.error(a.message),a}},this.update=async o=>{try{return await this.engine.update(o)}catch(a){throw this.logger.error(a.message),a}},this.extend=async o=>{try{return await this.engine.extend(o)}catch(a){throw this.logger.error(a.message),a}},this.request=async o=>{try{return await this.engine.request(o)}catch(a){throw this.logger.error(a.message),a}},this.respond=async o=>{try{return await this.engine.respond(o)}catch(a){throw this.logger.error(a.message),a}},this.ping=async o=>{try{return await this.engine.ping(o)}catch(a){throw this.logger.error(a.message),a}},this.emit=async o=>{try{return await this.engine.emit(o)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async o=>{try{return await this.engine.disconnect(o)}catch(a){throw this.logger.error(a.message),a}},this.find=o=>{try{return this.engine.find(o)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(o){throw this.logger.error(o.message),o}},this.authenticate=async o=>{try{return await this.engine.authenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.formatAuthMessage=o=>{try{return this.engine.formatAuthMessage(o)}catch(a){throw this.logger.error(a.message),a}},this.approveSessionAuthenticate=async o=>{try{return await this.engine.approveSessionAuthenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.rejectSessionAuthenticate=async o=>{try{return await this.engine.rejectSessionAuthenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.name=(s==null?void 0:s.name)||$s.name,this.metadata=(s==null?void 0:s.metadata)||(0,d.DaH)(),this.signConfig=s==null?void 0:s.signConfig;const r=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ee.gw)((0,ee.jI)({level:(s==null?void 0:s.logger)||$s.logger}));this.core=(s==null?void 0:s.core)||new xp(s),this.logger=(0,ee.Ep)(r,this.name),this.session=new Vp(this.core,this.logger),this.proposal=new Bp(this.core,this.logger),this.pendingRequest=new Kp(this.core,this.logger),this.engine=new Hp(this),this.auth=new Qp(this.core,this.logger)}static async init(s){const r=new js(s);return await r.initialize(),r}get context(){return(0,ee.Fd)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),await this.auth.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(s){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(s.message),s}}}const T_=null,M_=null;var Qt=me(51916);const aa="error",Yp="wss://relay.walletconnect.com",Zp="wc",Xp="universal_provider",ca=`${Zp}@2:${Xp}:`,ed="https://rpc.walletconnect.com/v1/",Mt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Ji=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof me.g<"u"?me.g:typeof self<"u"?self:{},Ls={exports:{}};(function(m,s){(function(){var r,o="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",v="Invalid `variable` option passed into `_.template`",E="__lodash_hash_undefined__",x=500,q="__lodash_placeholder__",F=1,j=2,z=4,k=1,J=2,Z=1,re=2,ge=4,ce=8,ue=16,he=32,Re=64,Ee=128,qe=256,Ze=512,Gi=30,Zt="...",li=800,Xe=16,Fe=1,pi=2,Wi=3,xt=1/0,et=9007199254740991,Si=17976931348623157e292,Rt=0/0,Ke=4294967295,Qi=Ke-1,Fr=Ke>>>1,Qs=[["ary",Ee],["bind",Z],["bindKey",re],["curry",ce],["curryRight",ue],["flip",Ze],["partial",he],["partialRight",Re],["rearg",qe]],Ot="[object Arguments]",xi="[object Array]",Md="[object AsyncFunction]",Yi="[object Boolean]",Zi="[object Date]",$d="[object DOMException]",Nr="[object Error]",Tr="[object Function]",wa="[object GeneratorFunction]",vt="[object Map]",Xi="[object Number]",kd="[object Null]",$t="[object Object]",_a="[object Promise]",jd="[object Proxy]",er="[object RegExp]",wt="[object Set]",tr="[object String]",Mr="[object Symbol]",Ld="[object Undefined]",ir="[object WeakMap]",zd="[object WeakSet]",rr="[object ArrayBuffer]",Ri="[object DataView]",Ys="[object Float32Array]",Zs="[object Float64Array]",Xs="[object Int8Array]",en="[object Int16Array]",tn="[object Int32Array]",rn="[object Uint8Array]",sn="[object Uint8ClampedArray]",nn="[object Uint16Array]",on="[object Uint32Array]",Ud=/\b__p \+= '';/g,Hd=/\b(__p \+=) '' \+/g,Bd=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ba=/&(?:amp|lt|gt|quot|#39);/g,Ea=/[&<>"']/g,Vd=RegExp(ba.source),Kd=RegExp(Ea.source),Jd=/<%-([\s\S]+?)%>/g,Gd=/<%([\s\S]+?)%>/g,Ia=/<%=([\s\S]+?)%>/g,Wd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qd=/^\w*$/,Yd=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,an=/[\\^$.*+?()[\]{}|]/g,Zd=RegExp(an.source),cn=/^\s+/,Xd=/\s/,eg=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,tg=/\{\n\/\* \[wrapped with (.+)\] \*/,ig=/,? & /,rg=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,sg=/[()=,{}\[\]\/\s]/,ng=/\\(\\)?/g,og=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Pa=/\w*$/,ag=/^[-+]0x[0-9a-f]+$/i,cg=/^0b[01]+$/i,hg=/^\[object .+?Constructor\]$/,ug=/^0o[0-7]+$/i,lg=/^(?:0|[1-9]\d*)$/,pg=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,$r=/($^)/,dg=/['\n\r\u2028\u2029\\]/g,kr="\\ud800-\\udfff",gg="\\u0300-\\u036f",fg="\\ufe20-\\ufe2f",mg="\\u20d0-\\u20ff",Ca=gg+fg+mg,Sa="\\u2700-\\u27bf",xa="a-z\\xdf-\\xf6\\xf8-\\xff",yg="\\xac\\xb1\\xd7\\xf7",vg="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",wg="\\u2000-\\u206f",_g=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ra="A-Z\\xc0-\\xd6\\xd8-\\xde",Oa="\\ufe0e\\ufe0f",qa=yg+vg+wg+_g,hn="['\u2019]",bg="["+kr+"]",Aa="["+qa+"]",jr="["+Ca+"]",Da="\\d+",Eg="["+Sa+"]",Fa="["+xa+"]",Na="[^"+kr+qa+Da+Sa+xa+Ra+"]",un="\\ud83c[\\udffb-\\udfff]",Ig="(?:"+jr+"|"+un+")",Ta="[^"+kr+"]",ln="(?:\\ud83c[\\udde6-\\uddff]){2}",pn="[\\ud800-\\udbff][\\udc00-\\udfff]",Oi="["+Ra+"]",Ma="\\u200d",$a="(?:"+Fa+"|"+Na+")",Pg="(?:"+Oi+"|"+Na+")",ka="(?:"+hn+"(?:d|ll|m|re|s|t|ve))?",ja="(?:"+hn+"(?:D|LL|M|RE|S|T|VE))?",La=Ig+"?",za="["+Oa+"]?",Cg="(?:"+Ma+"(?:"+[Ta,ln,pn].join("|")+")"+za+La+")*",Sg="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xg="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ua=za+La+Cg,Rg="(?:"+[Eg,ln,pn].join("|")+")"+Ua,Og="(?:"+[Ta+jr+"?",jr,ln,pn,bg].join("|")+")",qg=RegExp(hn,"g"),Ag=RegExp(jr,"g"),dn=RegExp(un+"(?="+un+")|"+Og+Ua,"g"),Dg=RegExp([Oi+"?"+Fa+"+"+ka+"(?="+[Aa,Oi,"$"].join("|")+")",Pg+"+"+ja+"(?="+[Aa,Oi+$a,"$"].join("|")+")",Oi+"?"+$a+"+"+ka,Oi+"+"+ja,xg,Sg,Da,Rg].join("|"),"g"),Fg=RegExp("["+Ma+kr+Ca+Oa+"]"),Ng=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Tg=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Mg=-1,_e={};_e[Ys]=_e[Zs]=_e[Xs]=_e[en]=_e[tn]=_e[rn]=_e[sn]=_e[nn]=_e[on]=!0,_e[Ot]=_e[xi]=_e[rr]=_e[Yi]=_e[Ri]=_e[Zi]=_e[Nr]=_e[Tr]=_e[vt]=_e[Xi]=_e[$t]=_e[er]=_e[wt]=_e[tr]=_e[ir]=!1;var we={};we[Ot]=we[xi]=we[rr]=we[Ri]=we[Yi]=we[Zi]=we[Ys]=we[Zs]=we[Xs]=we[en]=we[tn]=we[vt]=we[Xi]=we[$t]=we[er]=we[wt]=we[tr]=we[Mr]=we[rn]=we[sn]=we[nn]=we[on]=!0,we[Nr]=we[Tr]=we[ir]=!1;var $g={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},kg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},jg={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Lg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},zg=parseFloat,Ug=parseInt,Ha=typeof Ji=="object"&&Ji&&Ji.Object===Object&&Ji,Hg=typeof self=="object"&&self&&self.Object===Object&&self,Me=Ha||Hg||Function("return this")(),gn=s&&!s.nodeType&&s,di=gn&&!0&&m&&!m.nodeType&&m,Ba=di&&di.exports===gn,fn=Ba&&Ha.process,ht=function(){try{var _=di&&di.require&&di.require("util").types;return _||fn&&fn.binding&&fn.binding("util")}catch{}}(),Va=ht&&ht.isArrayBuffer,Ka=ht&&ht.isDate,Ja=ht&&ht.isMap,Ga=ht&&ht.isRegExp,Wa=ht&&ht.isSet,Qa=ht&&ht.isTypedArray;function tt(_,P,I){switch(I.length){case 0:return _.call(P);case 1:return _.call(P,I[0]);case 2:return _.call(P,I[0],I[1]);case 3:return _.call(P,I[0],I[1],I[2])}return _.apply(P,I)}function Bg(_,P,I,T){for(var Q=-1,le=_==null?0:_.length;++Q<le;){var Ae=_[Q];P(T,Ae,I(Ae),_)}return T}function ut(_,P){for(var I=-1,T=_==null?0:_.length;++I<T&&P(_[I],I,_)!==!1;);return _}function Vg(_,P){for(var I=_==null?0:_.length;I--&&P(_[I],I,_)!==!1;);return _}function Ya(_,P){for(var I=-1,T=_==null?0:_.length;++I<T;)if(!P(_[I],I,_))return!1;return!0}function Xt(_,P){for(var I=-1,T=_==null?0:_.length,Q=0,le=[];++I<T;){var Ae=_[I];P(Ae,I,_)&&(le[Q++]=Ae)}return le}function Lr(_,P){var I=_==null?0:_.length;return!!I&&qi(_,P,0)>-1}function mn(_,P,I){for(var T=-1,Q=_==null?0:_.length;++T<Q;)if(I(P,_[T]))return!0;return!1}function Ie(_,P){for(var I=-1,T=_==null?0:_.length,Q=Array(T);++I<T;)Q[I]=P(_[I],I,_);return Q}function ei(_,P){for(var I=-1,T=P.length,Q=_.length;++I<T;)_[Q+I]=P[I];return _}function yn(_,P,I,T){var Q=-1,le=_==null?0:_.length;for(T&&le&&(I=_[++Q]);++Q<le;)I=P(I,_[Q],Q,_);return I}function Kg(_,P,I,T){var Q=_==null?0:_.length;for(T&&Q&&(I=_[--Q]);Q--;)I=P(I,_[Q],Q,_);return I}function vn(_,P){for(var I=-1,T=_==null?0:_.length;++I<T;)if(P(_[I],I,_))return!0;return!1}var Jg=wn("length");function Gg(_){return _.split("")}function Wg(_){return _.match(rg)||[]}function Za(_,P,I){var T;return I(_,function(Q,le,Ae){if(P(Q,le,Ae))return T=le,!1}),T}function zr(_,P,I,T){for(var Q=_.length,le=I+(T?1:-1);T?le--:++le<Q;)if(P(_[le],le,_))return le;return-1}function qi(_,P,I){return P===P?cf(_,P,I):zr(_,Xa,I)}function Qg(_,P,I,T){for(var Q=I-1,le=_.length;++Q<le;)if(T(_[Q],P))return Q;return-1}function Xa(_){return _!==_}function ec(_,P){var I=_==null?0:_.length;return I?bn(_,P)/I:Rt}function wn(_){return function(P){return P==null?r:P[_]}}function _n(_){return function(P){return _==null?r:_[P]}}function tc(_,P,I,T,Q){return Q(_,function(le,Ae,ve){I=T?(T=!1,le):P(I,le,Ae,ve)}),I}function Yg(_,P){var I=_.length;for(_.sort(P);I--;)_[I]=_[I].value;return _}function bn(_,P){for(var I,T=-1,Q=_.length;++T<Q;){var le=P(_[T]);le!==r&&(I=I===r?le:I+le)}return I}function En(_,P){for(var I=-1,T=Array(_);++I<_;)T[I]=P(I);return T}function Zg(_,P){return Ie(P,function(I){return[I,_[I]]})}function ic(_){return _&&_.slice(0,oc(_)+1).replace(cn,"")}function it(_){return function(P){return _(P)}}function In(_,P){return Ie(P,function(I){return _[I]})}function sr(_,P){return _.has(P)}function rc(_,P){for(var I=-1,T=_.length;++I<T&&qi(P,_[I],0)>-1;);return I}function sc(_,P){for(var I=_.length;I--&&qi(P,_[I],0)>-1;);return I}function Xg(_,P){for(var I=_.length,T=0;I--;)_[I]===P&&++T;return T}var ef=_n($g),tf=_n(kg);function rf(_){return"\\"+Lg[_]}function sf(_,P){return _==null?r:_[P]}function Ai(_){return Fg.test(_)}function nf(_){return Ng.test(_)}function of(_){for(var P,I=[];!(P=_.next()).done;)I.push(P.value);return I}function Pn(_){var P=-1,I=Array(_.size);return _.forEach(function(T,Q){I[++P]=[Q,T]}),I}function nc(_,P){return function(I){return _(P(I))}}function ti(_,P){for(var I=-1,T=_.length,Q=0,le=[];++I<T;){var Ae=_[I];(Ae===P||Ae===q)&&(_[I]=q,le[Q++]=I)}return le}function Ur(_){var P=-1,I=Array(_.size);return _.forEach(function(T){I[++P]=T}),I}function af(_){var P=-1,I=Array(_.size);return _.forEach(function(T){I[++P]=[T,T]}),I}function cf(_,P,I){for(var T=I-1,Q=_.length;++T<Q;)if(_[T]===P)return T;return-1}function hf(_,P,I){for(var T=I+1;T--;)if(_[T]===P)return T;return T}function Di(_){return Ai(_)?lf(_):Jg(_)}function _t(_){return Ai(_)?pf(_):Gg(_)}function oc(_){for(var P=_.length;P--&&Xd.test(_.charAt(P)););return P}var uf=_n(jg);function lf(_){for(var P=dn.lastIndex=0;dn.test(_);)++P;return P}function pf(_){return _.match(dn)||[]}function df(_){return _.match(Dg)||[]}var gf=function _(P){P=P==null?Me:Fi.defaults(Me.Object(),P,Fi.pick(Me,Tg));var I=P.Array,T=P.Date,Q=P.Error,le=P.Function,Ae=P.Math,ve=P.Object,Cn=P.RegExp,ff=P.String,lt=P.TypeError,Hr=I.prototype,mf=le.prototype,Ni=ve.prototype,Br=P["__core-js_shared__"],Vr=mf.toString,fe=Ni.hasOwnProperty,yf=0,ac=function(){var e=/[^.]+$/.exec(Br&&Br.keys&&Br.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Kr=Ni.toString,vf=Vr.call(ve),wf=Me._,_f=Cn("^"+Vr.call(fe).replace(an,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Jr=Ba?P.Buffer:r,ii=P.Symbol,Gr=P.Uint8Array,cc=Jr?Jr.allocUnsafe:r,Wr=nc(ve.getPrototypeOf,ve),hc=ve.create,uc=Ni.propertyIsEnumerable,Qr=Hr.splice,lc=ii?ii.isConcatSpreadable:r,nr=ii?ii.iterator:r,gi=ii?ii.toStringTag:r,Yr=function(){try{var e=wi(ve,"defineProperty");return e({},"",{}),e}catch{}}(),bf=P.clearTimeout!==Me.clearTimeout&&P.clearTimeout,Ef=T&&T.now!==Me.Date.now&&T.now,If=P.setTimeout!==Me.setTimeout&&P.setTimeout,Zr=Ae.ceil,Xr=Ae.floor,Sn=ve.getOwnPropertySymbols,Pf=Jr?Jr.isBuffer:r,pc=P.isFinite,Cf=Hr.join,Sf=nc(ve.keys,ve),De=Ae.max,ke=Ae.min,xf=T.now,Rf=P.parseInt,dc=Ae.random,Of=Hr.reverse,xn=wi(P,"DataView"),or=wi(P,"Map"),Rn=wi(P,"Promise"),Ti=wi(P,"Set"),ar=wi(P,"WeakMap"),cr=wi(ve,"create"),es=ar&&new ar,Mi={},qf=_i(xn),Af=_i(or),Df=_i(Rn),Ff=_i(Ti),Nf=_i(ar),ts=ii?ii.prototype:r,hr=ts?ts.valueOf:r,gc=ts?ts.toString:r;function p(e){if(Ce(e)&&!Y(e)&&!(e instanceof oe)){if(e instanceof pt)return e;if(fe.call(e,"__wrapped__"))return fh(e)}return new pt(e)}var $i=function(){function e(){}return function(t){if(!Pe(t))return{};if(hc)return hc(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function is(){}function pt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}p.templateSettings={escape:Jd,evaluate:Gd,interpolate:Ia,variable:"",imports:{_:p}},p.prototype=is.prototype,p.prototype.constructor=p,pt.prototype=$i(is.prototype),pt.prototype.constructor=pt;function oe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ke,this.__views__=[]}function Tf(){var e=new oe(this.__wrapped__);return e.__actions__=Je(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Je(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Je(this.__views__),e}function Mf(){if(this.__filtered__){var e=new oe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function $f(){var e=this.__wrapped__.value(),t=this.__dir__,n=Y(e),h=t<0,l=n?e.length:0,f=Wm(0,l,this.__views__),y=f.start,w=f.end,b=w-y,C=h?w:y-1,S=this.__iteratees__,R=S.length,D=0,L=ke(b,this.__takeCount__);if(!n||!h&&l==b&&L==b)return kc(e,this.__actions__);var B=[];e:for(;b--&&D<L;){C+=t;for(var te=-1,V=e[C];++te<R;){var ne=S[te],ae=ne.iteratee,nt=ne.type,Ue=ae(V);if(nt==pi)V=Ue;else if(!Ue){if(nt==Fe)continue e;break e}}B[D++]=V}return B}oe.prototype=$i(is.prototype),oe.prototype.constructor=oe;function fi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function kf(){this.__data__=cr?cr(null):{},this.size=0}function jf(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Lf(e){var t=this.__data__;if(cr){var n=t[e];return n===E?r:n}return fe.call(t,e)?t[e]:r}function zf(e){var t=this.__data__;return cr?t[e]!==r:fe.call(t,e)}function Uf(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=cr&&t===r?E:t,this}fi.prototype.clear=kf,fi.prototype.delete=jf,fi.prototype.get=Lf,fi.prototype.has=zf,fi.prototype.set=Uf;function kt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Hf(){this.__data__=[],this.size=0}function Bf(e){var t=this.__data__,n=rs(t,e);if(n<0)return!1;var h=t.length-1;return n==h?t.pop():Qr.call(t,n,1),--this.size,!0}function Vf(e){var t=this.__data__,n=rs(t,e);return n<0?r:t[n][1]}function Kf(e){return rs(this.__data__,e)>-1}function Jf(e,t){var n=this.__data__,h=rs(n,e);return h<0?(++this.size,n.push([e,t])):n[h][1]=t,this}kt.prototype.clear=Hf,kt.prototype.delete=Bf,kt.prototype.get=Vf,kt.prototype.has=Kf,kt.prototype.set=Jf;function jt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Gf(){this.size=0,this.__data__={hash:new fi,map:new(or||kt),string:new fi}}function Wf(e){var t=fs(this,e).delete(e);return this.size-=t?1:0,t}function Qf(e){return fs(this,e).get(e)}function Yf(e){return fs(this,e).has(e)}function Zf(e,t){var n=fs(this,e),h=n.size;return n.set(e,t),this.size+=n.size==h?0:1,this}jt.prototype.clear=Gf,jt.prototype.delete=Wf,jt.prototype.get=Qf,jt.prototype.has=Yf,jt.prototype.set=Zf;function mi(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new jt;++t<n;)this.add(e[t])}function Xf(e){return this.__data__.set(e,E),this}function em(e){return this.__data__.has(e)}mi.prototype.add=mi.prototype.push=Xf,mi.prototype.has=em;function Et(e){var t=this.__data__=new kt(e);this.size=t.size}function tm(){this.__data__=new kt,this.size=0}function im(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function rm(e){return this.__data__.get(e)}function sm(e){return this.__data__.has(e)}function nm(e,t){var n=this.__data__;if(n instanceof kt){var h=n.__data__;if(!or||h.length<a-1)return h.push([e,t]),this.size=++n.size,this;n=this.__data__=new jt(h)}return n.set(e,t),this.size=n.size,this}Et.prototype.clear=tm,Et.prototype.delete=im,Et.prototype.get=rm,Et.prototype.has=sm,Et.prototype.set=nm;function fc(e,t){var n=Y(e),h=!n&&bi(e),l=!n&&!h&&ai(e),f=!n&&!h&&!l&&zi(e),y=n||h||l||f,w=y?En(e.length,ff):[],b=w.length;for(var C in e)(t||fe.call(e,C))&&!(y&&(C=="length"||l&&(C=="offset"||C=="parent")||f&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||Ht(C,b)))&&w.push(C);return w}function mc(e){var t=e.length;return t?e[jn(0,t-1)]:r}function om(e,t){return ms(Je(e),yi(t,0,e.length))}function am(e){return ms(Je(e))}function On(e,t,n){(n!==r&&!It(e[t],n)||n===r&&!(t in e))&&Lt(e,t,n)}function ur(e,t,n){var h=e[t];(!(fe.call(e,t)&&It(h,n))||n===r&&!(t in e))&&Lt(e,t,n)}function rs(e,t){for(var n=e.length;n--;)if(It(e[n][0],t))return n;return-1}function cm(e,t,n,h){return ri(e,function(l,f,y){t(h,l,n(l),y)}),h}function yc(e,t){return e&&At(t,Ne(t),e)}function hm(e,t){return e&&At(t,We(t),e)}function Lt(e,t,n){t=="__proto__"&&Yr?Yr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function qn(e,t){for(var n=-1,h=t.length,l=I(h),f=e==null;++n<h;)l[n]=f?r:uo(e,t[n]);return l}function yi(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function dt(e,t,n,h,l,f){var y,w=t&F,b=t&j,C=t&z;if(n&&(y=l?n(e,h,l,f):n(e)),y!==r)return y;if(!Pe(e))return e;var S=Y(e);if(S){if(y=Ym(e),!w)return Je(e,y)}else{var R=je(e),D=R==Tr||R==wa;if(ai(e))return zc(e,w);if(R==$t||R==Ot||D&&!l){if(y=b||D?{}:oh(e),!w)return b?Lm(e,hm(y,e)):jm(e,yc(y,e))}else{if(!we[R])return l?e:{};y=Zm(e,R,w)}}f||(f=new Et);var L=f.get(e);if(L)return L;f.set(e,y),Th(e)?e.forEach(function(V){y.add(dt(V,t,n,V,e,f))}):Fh(e)&&e.forEach(function(V,ne){y.set(ne,dt(V,t,n,ne,e,f))});var B=C?b?Qn:Wn:b?We:Ne,te=S?r:B(e);return ut(te||e,function(V,ne){te&&(ne=V,V=e[ne]),ur(y,ne,dt(V,t,n,ne,e,f))}),y}function um(e){var t=Ne(e);return function(n){return vc(n,e,t)}}function vc(e,t,n){var h=n.length;if(e==null)return!h;for(e=ve(e);h--;){var l=n[h],f=t[l],y=e[l];if(y===r&&!(l in e)||!f(y))return!1}return!0}function wc(e,t,n){if(typeof e!="function")throw new lt(g);return yr(function(){e.apply(r,n)},t)}function lr(e,t,n,h){var l=-1,f=Lr,y=!0,w=e.length,b=[],C=t.length;if(!w)return b;n&&(t=Ie(t,it(n))),h?(f=mn,y=!1):t.length>=a&&(f=sr,y=!1,t=new mi(t));e:for(;++l<w;){var S=e[l],R=n==null?S:n(S);if(S=h||S!==0?S:0,y&&R===R){for(var D=C;D--;)if(t[D]===R)continue e;b.push(S)}else f(t,R,h)||b.push(S)}return b}var ri=Kc(qt),_c=Kc(Dn,!0);function lm(e,t){var n=!0;return ri(e,function(h,l,f){return n=!!t(h,l,f),n}),n}function ss(e,t,n){for(var h=-1,l=e.length;++h<l;){var f=e[h],y=t(f);if(y!=null&&(w===r?y===y&&!st(y):n(y,w)))var w=y,b=f}return b}function pm(e,t,n,h){var l=e.length;for(n=X(n),n<0&&(n=-n>l?0:l+n),h=h===r||h>l?l:X(h),h<0&&(h+=l),h=n>h?0:$h(h);n<h;)e[n++]=t;return e}function bc(e,t){var n=[];return ri(e,function(h,l,f){t(h,l,f)&&n.push(h)}),n}function $e(e,t,n,h,l){var f=-1,y=e.length;for(n||(n=ey),l||(l=[]);++f<y;){var w=e[f];t>0&&n(w)?t>1?$e(w,t-1,n,h,l):ei(l,w):h||(l[l.length]=w)}return l}var An=Jc(),Ec=Jc(!0);function qt(e,t){return e&&An(e,t,Ne)}function Dn(e,t){return e&&Ec(e,t,Ne)}function ns(e,t){return Xt(t,function(n){return Bt(e[n])})}function vi(e,t){t=ni(t,e);for(var n=0,h=t.length;e!=null&&n<h;)e=e[Dt(t[n++])];return n&&n==h?e:r}function Ic(e,t,n){var h=t(e);return Y(e)?h:ei(h,n(e))}function Le(e){return e==null?e===r?Ld:kd:gi&&gi in ve(e)?Gm(e):ay(e)}function Fn(e,t){return e>t}function dm(e,t){return e!=null&&fe.call(e,t)}function gm(e,t){return e!=null&&t in ve(e)}function fm(e,t,n){return e>=ke(t,n)&&e<De(t,n)}function Nn(e,t,n){for(var h=n?mn:Lr,l=e[0].length,f=e.length,y=f,w=I(f),b=1/0,C=[];y--;){var S=e[y];y&&t&&(S=Ie(S,it(t))),b=ke(S.length,b),w[y]=!n&&(t||l>=120&&S.length>=120)?new mi(y&&S):r}S=e[0];var R=-1,D=w[0];e:for(;++R<l&&C.length<b;){var L=S[R],B=t?t(L):L;if(L=n||L!==0?L:0,!(D?sr(D,B):h(C,B,n))){for(y=f;--y;){var te=w[y];if(!(te?sr(te,B):h(e[y],B,n)))continue e}D&&D.push(B),C.push(L)}}return C}function mm(e,t,n,h){return qt(e,function(l,f,y){t(h,n(l),f,y)}),h}function pr(e,t,n){t=ni(t,e),e=uh(e,t);var h=e==null?e:e[Dt(ft(t))];return h==null?r:tt(h,e,n)}function Pc(e){return Ce(e)&&Le(e)==Ot}function ym(e){return Ce(e)&&Le(e)==rr}function vm(e){return Ce(e)&&Le(e)==Zi}function dr(e,t,n,h,l){return e===t?!0:e==null||t==null||!Ce(e)&&!Ce(t)?e!==e&&t!==t:wm(e,t,n,h,dr,l)}function wm(e,t,n,h,l,f){var y=Y(e),w=Y(t),b=y?xi:je(e),C=w?xi:je(t);b=b==Ot?$t:b,C=C==Ot?$t:C;var S=b==$t,R=C==$t,D=b==C;if(D&&ai(e)){if(!ai(t))return!1;y=!0,S=!1}if(D&&!S)return f||(f=new Et),y||zi(e)?rh(e,t,n,h,l,f):Km(e,t,b,n,h,l,f);if(!(n&k)){var L=S&&fe.call(e,"__wrapped__"),B=R&&fe.call(t,"__wrapped__");if(L||B){var te=L?e.value():e,V=B?t.value():t;return f||(f=new Et),l(te,V,n,h,f)}}return D?(f||(f=new Et),Jm(e,t,n,h,l,f)):!1}function _m(e){return Ce(e)&&je(e)==vt}function Tn(e,t,n,h){var l=n.length,f=l,y=!h;if(e==null)return!f;for(e=ve(e);l--;){var w=n[l];if(y&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++l<f;){w=n[l];var b=w[0],C=e[b],S=w[1];if(y&&w[2]){if(C===r&&!(b in e))return!1}else{var R=new Et;if(h)var D=h(C,S,b,e,t,R);if(!(D===r?dr(S,C,k|J,h,R):D))return!1}}return!0}function Cc(e){if(!Pe(e)||iy(e))return!1;var t=Bt(e)?_f:hg;return t.test(_i(e))}function bm(e){return Ce(e)&&Le(e)==er}function Em(e){return Ce(e)&&je(e)==wt}function Im(e){return Ce(e)&&Es(e.length)&&!!_e[Le(e)]}function Sc(e){return typeof e=="function"?e:e==null?Qe:typeof e=="object"?Y(e)?Oc(e[0],e[1]):Rc(e):Gh(e)}function Mn(e){if(!mr(e))return Sf(e);var t=[];for(var n in ve(e))fe.call(e,n)&&n!="constructor"&&t.push(n);return t}function Pm(e){if(!Pe(e))return oy(e);var t=mr(e),n=[];for(var h in e)h=="constructor"&&(t||!fe.call(e,h))||n.push(h);return n}function $n(e,t){return e<t}function xc(e,t){var n=-1,h=Ge(e)?I(e.length):[];return ri(e,function(l,f,y){h[++n]=t(l,f,y)}),h}function Rc(e){var t=Zn(e);return t.length==1&&t[0][2]?ch(t[0][0],t[0][1]):function(n){return n===e||Tn(n,e,t)}}function Oc(e,t){return eo(e)&&ah(t)?ch(Dt(e),t):function(n){var h=uo(n,e);return h===r&&h===t?lo(n,e):dr(t,h,k|J)}}function os(e,t,n,h,l){e!==t&&An(t,function(f,y){if(l||(l=new Et),Pe(f))Cm(e,t,y,n,os,h,l);else{var w=h?h(io(e,y),f,y+"",e,t,l):r;w===r&&(w=f),On(e,y,w)}},We)}function Cm(e,t,n,h,l,f,y){var w=io(e,n),b=io(t,n),C=y.get(b);if(C){On(e,n,C);return}var S=f?f(w,b,n+"",e,t,y):r,R=S===r;if(R){var D=Y(b),L=!D&&ai(b),B=!D&&!L&&zi(b);S=b,D||L||B?Y(w)?S=w:Se(w)?S=Je(w):L?(R=!1,S=zc(b,!0)):B?(R=!1,S=Uc(b,!0)):S=[]:vr(b)||bi(b)?(S=w,bi(w)?S=kh(w):(!Pe(w)||Bt(w))&&(S=oh(b))):R=!1}R&&(y.set(b,S),l(S,b,h,f,y),y.delete(b)),On(e,n,S)}function qc(e,t){var n=e.length;if(n)return t+=t<0?n:0,Ht(t,n)?e[t]:r}function Ac(e,t,n){t.length?t=Ie(t,function(f){return Y(f)?function(y){return vi(y,f.length===1?f[0]:f)}:f}):t=[Qe];var h=-1;t=Ie(t,it(H()));var l=xc(e,function(f,y,w){var b=Ie(t,function(C){return C(f)});return{criteria:b,index:++h,value:f}});return Yg(l,function(f,y){return km(f,y,n)})}function Sm(e,t){return Dc(e,t,function(n,h){return lo(e,h)})}function Dc(e,t,n){for(var h=-1,l=t.length,f={};++h<l;){var y=t[h],w=vi(e,y);n(w,y)&&gr(f,ni(y,e),w)}return f}function xm(e){return function(t){return vi(t,e)}}function kn(e,t,n,h){var l=h?Qg:qi,f=-1,y=t.length,w=e;for(e===t&&(t=Je(t)),n&&(w=Ie(e,it(n)));++f<y;)for(var b=0,C=t[f],S=n?n(C):C;(b=l(w,S,b,h))>-1;)w!==e&&Qr.call(w,b,1),Qr.call(e,b,1);return e}function Fc(e,t){for(var n=e?t.length:0,h=n-1;n--;){var l=t[n];if(n==h||l!==f){var f=l;Ht(l)?Qr.call(e,l,1):Un(e,l)}}return e}function jn(e,t){return e+Xr(dc()*(t-e+1))}function Rm(e,t,n,h){for(var l=-1,f=De(Zr((t-e)/(n||1)),0),y=I(f);f--;)y[h?f:++l]=e,e+=n;return y}function Ln(e,t){var n="";if(!e||t<1||t>et)return n;do t%2&&(n+=e),t=Xr(t/2),t&&(e+=e);while(t);return n}function ie(e,t){return ro(hh(e,t,Qe),e+"")}function Om(e){return mc(Ui(e))}function qm(e,t){var n=Ui(e);return ms(n,yi(t,0,n.length))}function gr(e,t,n,h){if(!Pe(e))return e;t=ni(t,e);for(var l=-1,f=t.length,y=f-1,w=e;w!=null&&++l<f;){var b=Dt(t[l]),C=n;if(b==="__proto__"||b==="constructor"||b==="prototype")return e;if(l!=y){var S=w[b];C=h?h(S,b,w):r,C===r&&(C=Pe(S)?S:Ht(t[l+1])?[]:{})}ur(w,b,C),w=w[b]}return e}var Nc=es?function(e,t){return es.set(e,t),e}:Qe,Am=Yr?function(e,t){return Yr(e,"toString",{configurable:!0,enumerable:!1,value:go(t),writable:!0})}:Qe;function Dm(e){return ms(Ui(e))}function gt(e,t,n){var h=-1,l=e.length;t<0&&(t=-t>l?0:l+t),n=n>l?l:n,n<0&&(n+=l),l=t>n?0:n-t>>>0,t>>>=0;for(var f=I(l);++h<l;)f[h]=e[h+t];return f}function Fm(e,t){var n;return ri(e,function(h,l,f){return n=t(h,l,f),!n}),!!n}function as(e,t,n){var h=0,l=e==null?h:e.length;if(typeof t=="number"&&t===t&&l<=Fr){for(;h<l;){var f=h+l>>>1,y=e[f];y!==null&&!st(y)&&(n?y<=t:y<t)?h=f+1:l=f}return l}return zn(e,t,Qe,n)}function zn(e,t,n,h){var l=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var y=t!==t,w=t===null,b=st(t),C=t===r;l<f;){var S=Xr((l+f)/2),R=n(e[S]),D=R!==r,L=R===null,B=R===R,te=st(R);if(y)var V=h||B;else C?V=B&&(h||D):w?V=B&&D&&(h||!L):b?V=B&&D&&!L&&(h||!te):L||te?V=!1:V=h?R<=t:R<t;V?l=S+1:f=S}return ke(f,Qi)}function Tc(e,t){for(var n=-1,h=e.length,l=0,f=[];++n<h;){var y=e[n],w=t?t(y):y;if(!n||!It(w,b)){var b=w;f[l++]=y===0?0:y}}return f}function Mc(e){return typeof e=="number"?e:st(e)?Rt:+e}function rt(e){if(typeof e=="string")return e;if(Y(e))return Ie(e,rt)+"";if(st(e))return gc?gc.call(e):"";var t=e+"";return t=="0"&&1/e==-xt?"-0":t}function si(e,t,n){var h=-1,l=Lr,f=e.length,y=!0,w=[],b=w;if(n)y=!1,l=mn;else if(f>=a){var C=t?null:Bm(e);if(C)return Ur(C);y=!1,l=sr,b=new mi}else b=t?[]:w;e:for(;++h<f;){var S=e[h],R=t?t(S):S;if(S=n||S!==0?S:0,y&&R===R){for(var D=b.length;D--;)if(b[D]===R)continue e;t&&b.push(R),w.push(S)}else l(b,R,n)||(b!==w&&b.push(R),w.push(S))}return w}function Un(e,t){return t=ni(t,e),e=uh(e,t),e==null||delete e[Dt(ft(t))]}function $c(e,t,n,h){return gr(e,t,n(vi(e,t)),h)}function cs(e,t,n,h){for(var l=e.length,f=h?l:-1;(h?f--:++f<l)&&t(e[f],f,e););return n?gt(e,h?0:f,h?f+1:l):gt(e,h?f+1:0,h?l:f)}function kc(e,t){var n=e;return n instanceof oe&&(n=n.value()),yn(t,function(h,l){return l.func.apply(l.thisArg,ei([h],l.args))},n)}function Hn(e,t,n){var h=e.length;if(h<2)return h?si(e[0]):[];for(var l=-1,f=I(h);++l<h;)for(var y=e[l],w=-1;++w<h;)w!=l&&(f[l]=lr(f[l]||y,e[w],t,n));return si($e(f,1),t,n)}function jc(e,t,n){for(var h=-1,l=e.length,f=t.length,y={};++h<l;){var w=h<f?t[h]:r;n(y,e[h],w)}return y}function Bn(e){return Se(e)?e:[]}function Vn(e){return typeof e=="function"?e:Qe}function ni(e,t){return Y(e)?e:eo(e,t)?[e]:gh(de(e))}var Nm=ie;function oi(e,t,n){var h=e.length;return n=n===r?h:n,!t&&n>=h?e:gt(e,t,n)}var Lc=bf||function(e){return Me.clearTimeout(e)};function zc(e,t){if(t)return e.slice();var n=e.length,h=cc?cc(n):new e.constructor(n);return e.copy(h),h}function Kn(e){var t=new e.constructor(e.byteLength);return new Gr(t).set(new Gr(e)),t}function Tm(e,t){var n=t?Kn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Mm(e){var t=new e.constructor(e.source,Pa.exec(e));return t.lastIndex=e.lastIndex,t}function $m(e){return hr?ve(hr.call(e)):{}}function Uc(e,t){var n=t?Kn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Hc(e,t){if(e!==t){var n=e!==r,h=e===null,l=e===e,f=st(e),y=t!==r,w=t===null,b=t===t,C=st(t);if(!w&&!C&&!f&&e>t||f&&y&&b&&!w&&!C||h&&y&&b||!n&&b||!l)return 1;if(!h&&!f&&!C&&e<t||C&&n&&l&&!h&&!f||w&&n&&l||!y&&l||!b)return-1}return 0}function km(e,t,n){for(var h=-1,l=e.criteria,f=t.criteria,y=l.length,w=n.length;++h<y;){var b=Hc(l[h],f[h]);if(b){if(h>=w)return b;var C=n[h];return b*(C=="desc"?-1:1)}}return e.index-t.index}function Bc(e,t,n,h){for(var l=-1,f=e.length,y=n.length,w=-1,b=t.length,C=De(f-y,0),S=I(b+C),R=!h;++w<b;)S[w]=t[w];for(;++l<y;)(R||l<f)&&(S[n[l]]=e[l]);for(;C--;)S[w++]=e[l++];return S}function Vc(e,t,n,h){for(var l=-1,f=e.length,y=-1,w=n.length,b=-1,C=t.length,S=De(f-w,0),R=I(S+C),D=!h;++l<S;)R[l]=e[l];for(var L=l;++b<C;)R[L+b]=t[b];for(;++y<w;)(D||l<f)&&(R[L+n[y]]=e[l++]);return R}function Je(e,t){var n=-1,h=e.length;for(t||(t=I(h));++n<h;)t[n]=e[n];return t}function At(e,t,n,h){var l=!n;n||(n={});for(var f=-1,y=t.length;++f<y;){var w=t[f],b=h?h(n[w],e[w],w,n,e):r;b===r&&(b=e[w]),l?Lt(n,w,b):ur(n,w,b)}return n}function jm(e,t){return At(e,Xn(e),t)}function Lm(e,t){return At(e,sh(e),t)}function hs(e,t){return function(n,h){var l=Y(n)?Bg:cm,f=t?t():{};return l(n,e,H(h,2),f)}}function ki(e){return ie(function(t,n){var h=-1,l=n.length,f=l>1?n[l-1]:r,y=l>2?n[2]:r;for(f=e.length>3&&typeof f=="function"?(l--,f):r,y&&ze(n[0],n[1],y)&&(f=l<3?r:f,l=1),t=ve(t);++h<l;){var w=n[h];w&&e(t,w,h,f)}return t})}function Kc(e,t){return function(n,h){if(n==null)return n;if(!Ge(n))return e(n,h);for(var l=n.length,f=t?l:-1,y=ve(n);(t?f--:++f<l)&&h(y[f],f,y)!==!1;);return n}}function Jc(e){return function(t,n,h){for(var l=-1,f=ve(t),y=h(t),w=y.length;w--;){var b=y[e?w:++l];if(n(f[b],b,f)===!1)break}return t}}function zm(e,t,n){var h=t&Z,l=fr(e);function f(){var y=this&&this!==Me&&this instanceof f?l:e;return y.apply(h?n:this,arguments)}return f}function Gc(e){return function(t){t=de(t);var n=Ai(t)?_t(t):r,h=n?n[0]:t.charAt(0),l=n?oi(n,1).join(""):t.slice(1);return h[e]()+l}}function ji(e){return function(t){return yn(Kh(Vh(t).replace(qg,"")),e,"")}}function fr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=$i(e.prototype),h=e.apply(n,t);return Pe(h)?h:n}}function Um(e,t,n){var h=fr(e);function l(){for(var f=arguments.length,y=I(f),w=f,b=Li(l);w--;)y[w]=arguments[w];var C=f<3&&y[0]!==b&&y[f-1]!==b?[]:ti(y,b);if(f-=C.length,f<n)return Xc(e,t,us,l.placeholder,r,y,C,r,r,n-f);var S=this&&this!==Me&&this instanceof l?h:e;return tt(S,this,y)}return l}function Wc(e){return function(t,n,h){var l=ve(t);if(!Ge(t)){var f=H(n,3);t=Ne(t),n=function(w){return f(l[w],w,l)}}var y=e(t,n,h);return y>-1?l[f?t[y]:y]:r}}function Qc(e){return Ut(function(t){var n=t.length,h=n,l=pt.prototype.thru;for(e&&t.reverse();h--;){var f=t[h];if(typeof f!="function")throw new lt(g);if(l&&!y&&gs(f)=="wrapper")var y=new pt([],!0)}for(h=y?h:n;++h<n;){f=t[h];var w=gs(f),b=w=="wrapper"?Yn(f):r;b&&to(b[0])&&b[1]==(Ee|ce|he|qe)&&!b[4].length&&b[9]==1?y=y[gs(b[0])].apply(y,b[3]):y=f.length==1&&to(f)?y[w]():y.thru(f)}return function(){var C=arguments,S=C[0];if(y&&C.length==1&&Y(S))return y.plant(S).value();for(var R=0,D=n?t[R].apply(this,C):S;++R<n;)D=t[R].call(this,D);return D}})}function us(e,t,n,h,l,f,y,w,b,C){var S=t&Ee,R=t&Z,D=t&re,L=t&(ce|ue),B=t&Ze,te=D?r:fr(e);function V(){for(var ne=arguments.length,ae=I(ne),nt=ne;nt--;)ae[nt]=arguments[nt];if(L)var Ue=Li(V),ot=Xg(ae,Ue);if(h&&(ae=Bc(ae,h,l,L)),f&&(ae=Vc(ae,f,y,L)),ne-=ot,L&&ne<C){var xe=ti(ae,Ue);return Xc(e,t,us,V.placeholder,n,ae,xe,w,b,C-ne)}var Pt=R?n:this,Kt=D?Pt[e]:e;return ne=ae.length,w?ae=cy(ae,w):B&&ne>1&&ae.reverse(),S&&b<ne&&(ae.length=b),this&&this!==Me&&this instanceof V&&(Kt=te||fr(Kt)),Kt.apply(Pt,ae)}return V}function Yc(e,t){return function(n,h){return mm(n,e,t(h),{})}}function ls(e,t){return function(n,h){var l;if(n===r&&h===r)return t;if(n!==r&&(l=n),h!==r){if(l===r)return h;typeof n=="string"||typeof h=="string"?(n=rt(n),h=rt(h)):(n=Mc(n),h=Mc(h)),l=e(n,h)}return l}}function Jn(e){return Ut(function(t){return t=Ie(t,it(H())),ie(function(n){var h=this;return e(t,function(l){return tt(l,h,n)})})})}function ps(e,t){t=t===r?" ":rt(t);var n=t.length;if(n<2)return n?Ln(t,e):t;var h=Ln(t,Zr(e/Di(t)));return Ai(t)?oi(_t(h),0,e).join(""):h.slice(0,e)}function Hm(e,t,n,h){var l=t&Z,f=fr(e);function y(){for(var w=-1,b=arguments.length,C=-1,S=h.length,R=I(S+b),D=this&&this!==Me&&this instanceof y?f:e;++C<S;)R[C]=h[C];for(;b--;)R[C++]=arguments[++w];return tt(D,l?n:this,R)}return y}function Zc(e){return function(t,n,h){return h&&typeof h!="number"&&ze(t,n,h)&&(n=h=r),t=Vt(t),n===r?(n=t,t=0):n=Vt(n),h=h===r?t<n?1:-1:Vt(h),Rm(t,n,h,e)}}function ds(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=mt(t),n=mt(n)),e(t,n)}}function Xc(e,t,n,h,l,f,y,w,b,C){var S=t&ce,R=S?y:r,D=S?r:y,L=S?f:r,B=S?r:f;t|=S?he:Re,t&=~(S?Re:he),t&ge||(t&=~(Z|re));var te=[e,t,l,L,R,B,D,w,b,C],V=n.apply(r,te);return to(e)&&lh(V,te),V.placeholder=h,ph(V,e,t)}function Gn(e){var t=Ae[e];return function(n,h){if(n=mt(n),h=h==null?0:ke(X(h),292),h&&pc(n)){var l=(de(n)+"e").split("e"),f=t(l[0]+"e"+(+l[1]+h));return l=(de(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-h))}return t(n)}}var Bm=Ti&&1/Ur(new Ti([,-0]))[1]==xt?function(e){return new Ti(e)}:yo;function eh(e){return function(t){var n=je(t);return n==vt?Pn(t):n==wt?af(t):Zg(t,e(t))}}function zt(e,t,n,h,l,f,y,w){var b=t&re;if(!b&&typeof e!="function")throw new lt(g);var C=h?h.length:0;if(C||(t&=~(he|Re),h=l=r),y=y===r?y:De(X(y),0),w=w===r?w:X(w),C-=l?l.length:0,t&Re){var S=h,R=l;h=l=r}var D=b?r:Yn(e),L=[e,t,n,h,l,S,R,f,y,w];if(D&&ny(L,D),e=L[0],t=L[1],n=L[2],h=L[3],l=L[4],w=L[9]=L[9]===r?b?0:e.length:De(L[9]-C,0),!w&&t&(ce|ue)&&(t&=~(ce|ue)),!t||t==Z)var B=zm(e,t,n);else t==ce||t==ue?B=Um(e,t,w):(t==he||t==(Z|he))&&!l.length?B=Hm(e,t,n,h):B=us.apply(r,L);var te=D?Nc:lh;return ph(te(B,L),e,t)}function th(e,t,n,h){return e===r||It(e,Ni[n])&&!fe.call(h,n)?t:e}function ih(e,t,n,h,l,f){return Pe(e)&&Pe(t)&&(f.set(t,e),os(e,t,r,ih,f),f.delete(t)),e}function Vm(e){return vr(e)?r:e}function rh(e,t,n,h,l,f){var y=n&k,w=e.length,b=t.length;if(w!=b&&!(y&&b>w))return!1;var C=f.get(e),S=f.get(t);if(C&&S)return C==t&&S==e;var R=-1,D=!0,L=n&J?new mi:r;for(f.set(e,t),f.set(t,e);++R<w;){var B=e[R],te=t[R];if(h)var V=y?h(te,B,R,t,e,f):h(B,te,R,e,t,f);if(V!==r){if(V)continue;D=!1;break}if(L){if(!vn(t,function(ne,ae){if(!sr(L,ae)&&(B===ne||l(B,ne,n,h,f)))return L.push(ae)})){D=!1;break}}else if(!(B===te||l(B,te,n,h,f))){D=!1;break}}return f.delete(e),f.delete(t),D}function Km(e,t,n,h,l,f,y){switch(n){case Ri:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case rr:return!(e.byteLength!=t.byteLength||!f(new Gr(e),new Gr(t)));case Yi:case Zi:case Xi:return It(+e,+t);case Nr:return e.name==t.name&&e.message==t.message;case er:case tr:return e==t+"";case vt:var w=Pn;case wt:var b=h&k;if(w||(w=Ur),e.size!=t.size&&!b)return!1;var C=y.get(e);if(C)return C==t;h|=J,y.set(e,t);var S=rh(w(e),w(t),h,l,f,y);return y.delete(e),S;case Mr:if(hr)return hr.call(e)==hr.call(t)}return!1}function Jm(e,t,n,h,l,f){var y=n&k,w=Wn(e),b=w.length,C=Wn(t),S=C.length;if(b!=S&&!y)return!1;for(var R=b;R--;){var D=w[R];if(!(y?D in t:fe.call(t,D)))return!1}var L=f.get(e),B=f.get(t);if(L&&B)return L==t&&B==e;var te=!0;f.set(e,t),f.set(t,e);for(var V=y;++R<b;){D=w[R];var ne=e[D],ae=t[D];if(h)var nt=y?h(ae,ne,D,t,e,f):h(ne,ae,D,e,t,f);if(!(nt===r?ne===ae||l(ne,ae,n,h,f):nt)){te=!1;break}V||(V=D=="constructor")}if(te&&!V){var Ue=e.constructor,ot=t.constructor;Ue!=ot&&"constructor"in e&&"constructor"in t&&!(typeof Ue=="function"&&Ue instanceof Ue&&typeof ot=="function"&&ot instanceof ot)&&(te=!1)}return f.delete(e),f.delete(t),te}function Ut(e){return ro(hh(e,r,vh),e+"")}function Wn(e){return Ic(e,Ne,Xn)}function Qn(e){return Ic(e,We,sh)}var Yn=es?function(e){return es.get(e)}:yo;function gs(e){for(var t=e.name+"",n=Mi[t],h=fe.call(Mi,t)?n.length:0;h--;){var l=n[h],f=l.func;if(f==null||f==e)return l.name}return t}function Li(e){var t=fe.call(p,"placeholder")?p:e;return t.placeholder}function H(){var e=p.iteratee||fo;return e=e===fo?Sc:e,arguments.length?e(arguments[0],arguments[1]):e}function fs(e,t){var n=e.__data__;return ty(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Zn(e){for(var t=Ne(e),n=t.length;n--;){var h=t[n],l=e[h];t[n]=[h,l,ah(l)]}return t}function wi(e,t){var n=sf(e,t);return Cc(n)?n:r}function Gm(e){var t=fe.call(e,gi),n=e[gi];try{e[gi]=r;var h=!0}catch{}var l=Kr.call(e);return h&&(t?e[gi]=n:delete e[gi]),l}var Xn=Sn?function(e){return e==null?[]:(e=ve(e),Xt(Sn(e),function(t){return uc.call(e,t)}))}:vo,sh=Sn?function(e){for(var t=[];e;)ei(t,Xn(e)),e=Wr(e);return t}:vo,je=Le;(xn&&je(new xn(new ArrayBuffer(1)))!=Ri||or&&je(new or)!=vt||Rn&&je(Rn.resolve())!=_a||Ti&&je(new Ti)!=wt||ar&&je(new ar)!=ir)&&(je=function(e){var t=Le(e),n=t==$t?e.constructor:r,h=n?_i(n):"";if(h)switch(h){case qf:return Ri;case Af:return vt;case Df:return _a;case Ff:return wt;case Nf:return ir}return t});function Wm(e,t,n){for(var h=-1,l=n.length;++h<l;){var f=n[h],y=f.size;switch(f.type){case"drop":e+=y;break;case"dropRight":t-=y;break;case"take":t=ke(t,e+y);break;case"takeRight":e=De(e,t-y);break}}return{start:e,end:t}}function Qm(e){var t=e.match(tg);return t?t[1].split(ig):[]}function nh(e,t,n){t=ni(t,e);for(var h=-1,l=t.length,f=!1;++h<l;){var y=Dt(t[h]);if(!(f=e!=null&&n(e,y)))break;e=e[y]}return f||++h!=l?f:(l=e==null?0:e.length,!!l&&Es(l)&&Ht(y,l)&&(Y(e)||bi(e)))}function Ym(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&fe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function oh(e){return typeof e.constructor=="function"&&!mr(e)?$i(Wr(e)):{}}function Zm(e,t,n){var h=e.constructor;switch(t){case rr:return Kn(e);case Yi:case Zi:return new h(+e);case Ri:return Tm(e,n);case Ys:case Zs:case Xs:case en:case tn:case rn:case sn:case nn:case on:return Uc(e,n);case vt:return new h;case Xi:case tr:return new h(e);case er:return Mm(e);case wt:return new h;case Mr:return $m(e)}}function Xm(e,t){var n=t.length;if(!n)return e;var h=n-1;return t[h]=(n>1?"& ":"")+t[h],t=t.join(n>2?", ":" "),e.replace(eg,`{
/* [wrapped with `+t+`] */
`)}function ey(e){return Y(e)||bi(e)||!!(lc&&e&&e[lc])}function Ht(e,t){var n=typeof e;return t=t??et,!!t&&(n=="number"||n!="symbol"&&lg.test(e))&&e>-1&&e%1==0&&e<t}function ze(e,t,n){if(!Pe(n))return!1;var h=typeof t;return(h=="number"?Ge(n)&&Ht(t,n.length):h=="string"&&t in n)?It(n[t],e):!1}function eo(e,t){if(Y(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||st(e)?!0:Qd.test(e)||!Wd.test(e)||t!=null&&e in ve(t)}function ty(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function to(e){var t=gs(e),n=p[t];if(typeof n!="function"||!(t in oe.prototype))return!1;if(e===n)return!0;var h=Yn(n);return!!h&&e===h[0]}function iy(e){return!!ac&&ac in e}var ry=Br?Bt:wo;function mr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Ni;return e===n}function ah(e){return e===e&&!Pe(e)}function ch(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in ve(n))}}function sy(e){var t=_s(e,function(h){return n.size===x&&n.clear(),h}),n=t.cache;return t}function ny(e,t){var n=e[1],h=t[1],l=n|h,f=l<(Z|re|Ee),y=h==Ee&&n==ce||h==Ee&&n==qe&&e[7].length<=t[8]||h==(Ee|qe)&&t[7].length<=t[8]&&n==ce;if(!(f||y))return e;h&Z&&(e[2]=t[2],l|=n&Z?0:ge);var w=t[3];if(w){var b=e[3];e[3]=b?Bc(b,w,t[4]):w,e[4]=b?ti(e[3],q):t[4]}return w=t[5],w&&(b=e[5],e[5]=b?Vc(b,w,t[6]):w,e[6]=b?ti(e[5],q):t[6]),w=t[7],w&&(e[7]=w),h&Ee&&(e[8]=e[8]==null?t[8]:ke(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function oy(e){var t=[];if(e!=null)for(var n in ve(e))t.push(n);return t}function ay(e){return Kr.call(e)}function hh(e,t,n){return t=De(t===r?e.length-1:t,0),function(){for(var h=arguments,l=-1,f=De(h.length-t,0),y=I(f);++l<f;)y[l]=h[t+l];l=-1;for(var w=I(t+1);++l<t;)w[l]=h[l];return w[t]=n(y),tt(e,this,w)}}function uh(e,t){return t.length<2?e:vi(e,gt(t,0,-1))}function cy(e,t){for(var n=e.length,h=ke(t.length,n),l=Je(e);h--;){var f=t[h];e[h]=Ht(f,n)?l[f]:r}return e}function io(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var lh=dh(Nc),yr=If||function(e,t){return Me.setTimeout(e,t)},ro=dh(Am);function ph(e,t,n){var h=t+"";return ro(e,Xm(h,hy(Qm(h),n)))}function dh(e){var t=0,n=0;return function(){var h=xf(),l=Xe-(h-n);if(n=h,l>0){if(++t>=li)return arguments[0]}else t=0;return e.apply(r,arguments)}}function ms(e,t){var n=-1,h=e.length,l=h-1;for(t=t===r?h:t;++n<t;){var f=jn(n,l),y=e[f];e[f]=e[n],e[n]=y}return e.length=t,e}var gh=sy(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Yd,function(n,h,l,f){t.push(l?f.replace(ng,"$1"):h||n)}),t});function Dt(e){if(typeof e=="string"||st(e))return e;var t=e+"";return t=="0"&&1/e==-xt?"-0":t}function _i(e){if(e!=null){try{return Vr.call(e)}catch{}try{return e+""}catch{}}return""}function hy(e,t){return ut(Qs,function(n){var h="_."+n[0];t&n[1]&&!Lr(e,h)&&e.push(h)}),e.sort()}function fh(e){if(e instanceof oe)return e.clone();var t=new pt(e.__wrapped__,e.__chain__);return t.__actions__=Je(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function uy(e,t,n){(n?ze(e,t,n):t===r)?t=1:t=De(X(t),0);var h=e==null?0:e.length;if(!h||t<1)return[];for(var l=0,f=0,y=I(Zr(h/t));l<h;)y[f++]=gt(e,l,l+=t);return y}function ly(e){for(var t=-1,n=e==null?0:e.length,h=0,l=[];++t<n;){var f=e[t];f&&(l[h++]=f)}return l}function py(){var e=arguments.length;if(!e)return[];for(var t=I(e-1),n=arguments[0],h=e;h--;)t[h-1]=arguments[h];return ei(Y(n)?Je(n):[n],$e(t,1))}var dy=ie(function(e,t){return Se(e)?lr(e,$e(t,1,Se,!0)):[]}),gy=ie(function(e,t){var n=ft(t);return Se(n)&&(n=r),Se(e)?lr(e,$e(t,1,Se,!0),H(n,2)):[]}),fy=ie(function(e,t){var n=ft(t);return Se(n)&&(n=r),Se(e)?lr(e,$e(t,1,Se,!0),r,n):[]});function my(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:X(t),gt(e,t<0?0:t,h)):[]}function yy(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:X(t),t=h-t,gt(e,0,t<0?0:t)):[]}function vy(e,t){return e&&e.length?cs(e,H(t,3),!0,!0):[]}function wy(e,t){return e&&e.length?cs(e,H(t,3),!0):[]}function _y(e,t,n,h){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&ze(e,t,n)&&(n=0,h=l),pm(e,t,n,h)):[]}function mh(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:X(n);return l<0&&(l=De(h+l,0)),zr(e,H(t,3),l)}function yh(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h-1;return n!==r&&(l=X(n),l=n<0?De(h+l,0):ke(l,h-1)),zr(e,H(t,3),l,!0)}function vh(e){var t=e==null?0:e.length;return t?$e(e,1):[]}function by(e){var t=e==null?0:e.length;return t?$e(e,xt):[]}function Ey(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:X(t),$e(e,t)):[]}function Iy(e){for(var t=-1,n=e==null?0:e.length,h={};++t<n;){var l=e[t];h[l[0]]=l[1]}return h}function wh(e){return e&&e.length?e[0]:r}function Py(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:X(n);return l<0&&(l=De(h+l,0)),qi(e,t,l)}function Cy(e){var t=e==null?0:e.length;return t?gt(e,0,-1):[]}var Sy=ie(function(e){var t=Ie(e,Bn);return t.length&&t[0]===e[0]?Nn(t):[]}),xy=ie(function(e){var t=ft(e),n=Ie(e,Bn);return t===ft(n)?t=r:n.pop(),n.length&&n[0]===e[0]?Nn(n,H(t,2)):[]}),Ry=ie(function(e){var t=ft(e),n=Ie(e,Bn);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?Nn(n,r,t):[]});function Oy(e,t){return e==null?"":Cf.call(e,t)}function ft(e){var t=e==null?0:e.length;return t?e[t-1]:r}function qy(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h;return n!==r&&(l=X(n),l=l<0?De(h+l,0):ke(l,h-1)),t===t?hf(e,t,l):zr(e,Xa,l,!0)}function Ay(e,t){return e&&e.length?qc(e,X(t)):r}var Dy=ie(_h);function _h(e,t){return e&&e.length&&t&&t.length?kn(e,t):e}function Fy(e,t,n){return e&&e.length&&t&&t.length?kn(e,t,H(n,2)):e}function Ny(e,t,n){return e&&e.length&&t&&t.length?kn(e,t,r,n):e}var Ty=Ut(function(e,t){var n=e==null?0:e.length,h=qn(e,t);return Fc(e,Ie(t,function(l){return Ht(l,n)?+l:l}).sort(Hc)),h});function My(e,t){var n=[];if(!(e&&e.length))return n;var h=-1,l=[],f=e.length;for(t=H(t,3);++h<f;){var y=e[h];t(y,h,e)&&(n.push(y),l.push(h))}return Fc(e,l),n}function so(e){return e==null?e:Of.call(e)}function $y(e,t,n){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&ze(e,t,n)?(t=0,n=h):(t=t==null?0:X(t),n=n===r?h:X(n)),gt(e,t,n)):[]}function ky(e,t){return as(e,t)}function jy(e,t,n){return zn(e,t,H(n,2))}function Ly(e,t){var n=e==null?0:e.length;if(n){var h=as(e,t);if(h<n&&It(e[h],t))return h}return-1}function zy(e,t){return as(e,t,!0)}function Uy(e,t,n){return zn(e,t,H(n,2),!0)}function Hy(e,t){var n=e==null?0:e.length;if(n){var h=as(e,t,!0)-1;if(It(e[h],t))return h}return-1}function By(e){return e&&e.length?Tc(e):[]}function Vy(e,t){return e&&e.length?Tc(e,H(t,2)):[]}function Ky(e){var t=e==null?0:e.length;return t?gt(e,1,t):[]}function Jy(e,t,n){return e&&e.length?(t=n||t===r?1:X(t),gt(e,0,t<0?0:t)):[]}function Gy(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:X(t),t=h-t,gt(e,t<0?0:t,h)):[]}function Wy(e,t){return e&&e.length?cs(e,H(t,3),!1,!0):[]}function Qy(e,t){return e&&e.length?cs(e,H(t,3)):[]}var Yy=ie(function(e){return si($e(e,1,Se,!0))}),Zy=ie(function(e){var t=ft(e);return Se(t)&&(t=r),si($e(e,1,Se,!0),H(t,2))}),Xy=ie(function(e){var t=ft(e);return t=typeof t=="function"?t:r,si($e(e,1,Se,!0),r,t)});function ev(e){return e&&e.length?si(e):[]}function tv(e,t){return e&&e.length?si(e,H(t,2)):[]}function iv(e,t){return t=typeof t=="function"?t:r,e&&e.length?si(e,r,t):[]}function no(e){if(!(e&&e.length))return[];var t=0;return e=Xt(e,function(n){if(Se(n))return t=De(n.length,t),!0}),En(t,function(n){return Ie(e,wn(n))})}function bh(e,t){if(!(e&&e.length))return[];var n=no(e);return t==null?n:Ie(n,function(h){return tt(t,r,h)})}var rv=ie(function(e,t){return Se(e)?lr(e,t):[]}),sv=ie(function(e){return Hn(Xt(e,Se))}),nv=ie(function(e){var t=ft(e);return Se(t)&&(t=r),Hn(Xt(e,Se),H(t,2))}),ov=ie(function(e){var t=ft(e);return t=typeof t=="function"?t:r,Hn(Xt(e,Se),r,t)}),av=ie(no);function cv(e,t){return jc(e||[],t||[],ur)}function hv(e,t){return jc(e||[],t||[],gr)}var uv=ie(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,bh(e,n)});function Eh(e){var t=p(e);return t.__chain__=!0,t}function lv(e,t){return t(e),e}function ys(e,t){return t(e)}var pv=Ut(function(e){var t=e.length,n=t?e[0]:0,h=this.__wrapped__,l=function(f){return qn(f,e)};return t>1||this.__actions__.length||!(h instanceof oe)||!Ht(n)?this.thru(l):(h=h.slice(n,+n+(t?1:0)),h.__actions__.push({func:ys,args:[l],thisArg:r}),new pt(h,this.__chain__).thru(function(f){return t&&!f.length&&f.push(r),f}))});function dv(){return Eh(this)}function gv(){return new pt(this.value(),this.__chain__)}function fv(){this.__values__===r&&(this.__values__=Mh(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function mv(){return this}function yv(e){for(var t,n=this;n instanceof is;){var h=fh(n);h.__index__=0,h.__values__=r,t?l.__wrapped__=h:t=h;var l=h;n=n.__wrapped__}return l.__wrapped__=e,t}function vv(){var e=this.__wrapped__;if(e instanceof oe){var t=e;return this.__actions__.length&&(t=new oe(this)),t=t.reverse(),t.__actions__.push({func:ys,args:[so],thisArg:r}),new pt(t,this.__chain__)}return this.thru(so)}function wv(){return kc(this.__wrapped__,this.__actions__)}var _v=hs(function(e,t,n){fe.call(e,n)?++e[n]:Lt(e,n,1)});function bv(e,t,n){var h=Y(e)?Ya:lm;return n&&ze(e,t,n)&&(t=r),h(e,H(t,3))}function Ev(e,t){var n=Y(e)?Xt:bc;return n(e,H(t,3))}var Iv=Wc(mh),Pv=Wc(yh);function Cv(e,t){return $e(vs(e,t),1)}function Sv(e,t){return $e(vs(e,t),xt)}function xv(e,t,n){return n=n===r?1:X(n),$e(vs(e,t),n)}function Ih(e,t){var n=Y(e)?ut:ri;return n(e,H(t,3))}function Ph(e,t){var n=Y(e)?Vg:_c;return n(e,H(t,3))}var Rv=hs(function(e,t,n){fe.call(e,n)?e[n].push(t):Lt(e,n,[t])});function Ov(e,t,n,h){e=Ge(e)?e:Ui(e),n=n&&!h?X(n):0;var l=e.length;return n<0&&(n=De(l+n,0)),Is(e)?n<=l&&e.indexOf(t,n)>-1:!!l&&qi(e,t,n)>-1}var qv=ie(function(e,t,n){var h=-1,l=typeof t=="function",f=Ge(e)?I(e.length):[];return ri(e,function(y){f[++h]=l?tt(t,y,n):pr(y,t,n)}),f}),Av=hs(function(e,t,n){Lt(e,n,t)});function vs(e,t){var n=Y(e)?Ie:xc;return n(e,H(t,3))}function Dv(e,t,n,h){return e==null?[]:(Y(t)||(t=t==null?[]:[t]),n=h?r:n,Y(n)||(n=n==null?[]:[n]),Ac(e,t,n))}var Fv=hs(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function Nv(e,t,n){var h=Y(e)?yn:tc,l=arguments.length<3;return h(e,H(t,4),n,l,ri)}function Tv(e,t,n){var h=Y(e)?Kg:tc,l=arguments.length<3;return h(e,H(t,4),n,l,_c)}function Mv(e,t){var n=Y(e)?Xt:bc;return n(e,bs(H(t,3)))}function $v(e){var t=Y(e)?mc:Om;return t(e)}function kv(e,t,n){(n?ze(e,t,n):t===r)?t=1:t=X(t);var h=Y(e)?om:qm;return h(e,t)}function jv(e){var t=Y(e)?am:Dm;return t(e)}function Lv(e){if(e==null)return 0;if(Ge(e))return Is(e)?Di(e):e.length;var t=je(e);return t==vt||t==wt?e.size:Mn(e).length}function zv(e,t,n){var h=Y(e)?vn:Fm;return n&&ze(e,t,n)&&(t=r),h(e,H(t,3))}var Uv=ie(function(e,t){if(e==null)return[];var n=t.length;return n>1&&ze(e,t[0],t[1])?t=[]:n>2&&ze(t[0],t[1],t[2])&&(t=[t[0]]),Ac(e,$e(t,1),[])}),ws=Ef||function(){return Me.Date.now()};function Hv(e,t){if(typeof t!="function")throw new lt(g);return e=X(e),function(){if(--e<1)return t.apply(this,arguments)}}function Ch(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,zt(e,Ee,r,r,r,r,t)}function Sh(e,t){var n;if(typeof t!="function")throw new lt(g);return e=X(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var oo=ie(function(e,t,n){var h=Z;if(n.length){var l=ti(n,Li(oo));h|=he}return zt(e,h,t,n,l)}),xh=ie(function(e,t,n){var h=Z|re;if(n.length){var l=ti(n,Li(xh));h|=he}return zt(t,h,e,n,l)});function Rh(e,t,n){t=n?r:t;var h=zt(e,ce,r,r,r,r,r,t);return h.placeholder=Rh.placeholder,h}function Oh(e,t,n){t=n?r:t;var h=zt(e,ue,r,r,r,r,r,t);return h.placeholder=Oh.placeholder,h}function qh(e,t,n){var h,l,f,y,w,b,C=0,S=!1,R=!1,D=!0;if(typeof e!="function")throw new lt(g);t=mt(t)||0,Pe(n)&&(S=!!n.leading,R="maxWait"in n,f=R?De(mt(n.maxWait)||0,t):f,D="trailing"in n?!!n.trailing:D);function L(xe){var Pt=h,Kt=l;return h=l=r,C=xe,y=e.apply(Kt,Pt),y}function B(xe){return C=xe,w=yr(ne,t),S?L(xe):y}function te(xe){var Pt=xe-b,Kt=xe-C,Wh=t-Pt;return R?ke(Wh,f-Kt):Wh}function V(xe){var Pt=xe-b,Kt=xe-C;return b===r||Pt>=t||Pt<0||R&&Kt>=f}function ne(){var xe=ws();if(V(xe))return ae(xe);w=yr(ne,te(xe))}function ae(xe){return w=r,D&&h?L(xe):(h=l=r,y)}function nt(){w!==r&&Lc(w),C=0,h=b=l=w=r}function Ue(){return w===r?y:ae(ws())}function ot(){var xe=ws(),Pt=V(xe);if(h=arguments,l=this,b=xe,Pt){if(w===r)return B(b);if(R)return Lc(w),w=yr(ne,t),L(b)}return w===r&&(w=yr(ne,t)),y}return ot.cancel=nt,ot.flush=Ue,ot}var Bv=ie(function(e,t){return wc(e,1,t)}),Vv=ie(function(e,t,n){return wc(e,mt(t)||0,n)});function Kv(e){return zt(e,Ze)}function _s(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new lt(g);var n=function(){var h=arguments,l=t?t.apply(this,h):h[0],f=n.cache;if(f.has(l))return f.get(l);var y=e.apply(this,h);return n.cache=f.set(l,y)||f,y};return n.cache=new(_s.Cache||jt),n}_s.Cache=jt;function bs(e){if(typeof e!="function")throw new lt(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Jv(e){return Sh(2,e)}var Gv=Nm(function(e,t){t=t.length==1&&Y(t[0])?Ie(t[0],it(H())):Ie($e(t,1),it(H()));var n=t.length;return ie(function(h){for(var l=-1,f=ke(h.length,n);++l<f;)h[l]=t[l].call(this,h[l]);return tt(e,this,h)})}),ao=ie(function(e,t){var n=ti(t,Li(ao));return zt(e,he,r,t,n)}),Ah=ie(function(e,t){var n=ti(t,Li(Ah));return zt(e,Re,r,t,n)}),Wv=Ut(function(e,t){return zt(e,qe,r,r,r,t)});function Qv(e,t){if(typeof e!="function")throw new lt(g);return t=t===r?t:X(t),ie(e,t)}function Yv(e,t){if(typeof e!="function")throw new lt(g);return t=t==null?0:De(X(t),0),ie(function(n){var h=n[t],l=oi(n,0,t);return h&&ei(l,h),tt(e,this,l)})}function Zv(e,t,n){var h=!0,l=!0;if(typeof e!="function")throw new lt(g);return Pe(n)&&(h="leading"in n?!!n.leading:h,l="trailing"in n?!!n.trailing:l),qh(e,t,{leading:h,maxWait:t,trailing:l})}function Xv(e){return Ch(e,1)}function e0(e,t){return ao(Vn(t),e)}function t0(){if(!arguments.length)return[];var e=arguments[0];return Y(e)?e:[e]}function i0(e){return dt(e,z)}function r0(e,t){return t=typeof t=="function"?t:r,dt(e,z,t)}function s0(e){return dt(e,F|z)}function n0(e,t){return t=typeof t=="function"?t:r,dt(e,F|z,t)}function o0(e,t){return t==null||vc(e,t,Ne(t))}function It(e,t){return e===t||e!==e&&t!==t}var a0=ds(Fn),c0=ds(function(e,t){return e>=t}),bi=Pc(function(){return arguments}())?Pc:function(e){return Ce(e)&&fe.call(e,"callee")&&!uc.call(e,"callee")},Y=I.isArray,h0=Va?it(Va):ym;function Ge(e){return e!=null&&Es(e.length)&&!Bt(e)}function Se(e){return Ce(e)&&Ge(e)}function u0(e){return e===!0||e===!1||Ce(e)&&Le(e)==Yi}var ai=Pf||wo,l0=Ka?it(Ka):vm;function p0(e){return Ce(e)&&e.nodeType===1&&!vr(e)}function d0(e){if(e==null)return!0;if(Ge(e)&&(Y(e)||typeof e=="string"||typeof e.splice=="function"||ai(e)||zi(e)||bi(e)))return!e.length;var t=je(e);if(t==vt||t==wt)return!e.size;if(mr(e))return!Mn(e).length;for(var n in e)if(fe.call(e,n))return!1;return!0}function g0(e,t){return dr(e,t)}function f0(e,t,n){n=typeof n=="function"?n:r;var h=n?n(e,t):r;return h===r?dr(e,t,r,n):!!h}function co(e){if(!Ce(e))return!1;var t=Le(e);return t==Nr||t==$d||typeof e.message=="string"&&typeof e.name=="string"&&!vr(e)}function m0(e){return typeof e=="number"&&pc(e)}function Bt(e){if(!Pe(e))return!1;var t=Le(e);return t==Tr||t==wa||t==Md||t==jd}function Dh(e){return typeof e=="number"&&e==X(e)}function Es(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=et}function Pe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ce(e){return e!=null&&typeof e=="object"}var Fh=Ja?it(Ja):_m;function y0(e,t){return e===t||Tn(e,t,Zn(t))}function v0(e,t,n){return n=typeof n=="function"?n:r,Tn(e,t,Zn(t),n)}function w0(e){return Nh(e)&&e!=+e}function _0(e){if(ry(e))throw new Q(u);return Cc(e)}function b0(e){return e===null}function E0(e){return e==null}function Nh(e){return typeof e=="number"||Ce(e)&&Le(e)==Xi}function vr(e){if(!Ce(e)||Le(e)!=$t)return!1;var t=Wr(e);if(t===null)return!0;var n=fe.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Vr.call(n)==vf}var ho=Ga?it(Ga):bm;function I0(e){return Dh(e)&&e>=-et&&e<=et}var Th=Wa?it(Wa):Em;function Is(e){return typeof e=="string"||!Y(e)&&Ce(e)&&Le(e)==tr}function st(e){return typeof e=="symbol"||Ce(e)&&Le(e)==Mr}var zi=Qa?it(Qa):Im;function P0(e){return e===r}function C0(e){return Ce(e)&&je(e)==ir}function S0(e){return Ce(e)&&Le(e)==zd}var x0=ds($n),R0=ds(function(e,t){return e<=t});function Mh(e){if(!e)return[];if(Ge(e))return Is(e)?_t(e):Je(e);if(nr&&e[nr])return of(e[nr]());var t=je(e),n=t==vt?Pn:t==wt?Ur:Ui;return n(e)}function Vt(e){if(!e)return e===0?e:0;if(e=mt(e),e===xt||e===-xt){var t=e<0?-1:1;return t*Si}return e===e?e:0}function X(e){var t=Vt(e),n=t%1;return t===t?n?t-n:t:0}function $h(e){return e?yi(X(e),0,Ke):0}function mt(e){if(typeof e=="number")return e;if(st(e))return Rt;if(Pe(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Pe(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ic(e);var n=cg.test(e);return n||ug.test(e)?Ug(e.slice(2),n?2:8):ag.test(e)?Rt:+e}function kh(e){return At(e,We(e))}function O0(e){return e?yi(X(e),-et,et):e===0?e:0}function de(e){return e==null?"":rt(e)}var q0=ki(function(e,t){if(mr(t)||Ge(t)){At(t,Ne(t),e);return}for(var n in t)fe.call(t,n)&&ur(e,n,t[n])}),jh=ki(function(e,t){At(t,We(t),e)}),Ps=ki(function(e,t,n,h){At(t,We(t),e,h)}),A0=ki(function(e,t,n,h){At(t,Ne(t),e,h)}),D0=Ut(qn);function F0(e,t){var n=$i(e);return t==null?n:yc(n,t)}var N0=ie(function(e,t){e=ve(e);var n=-1,h=t.length,l=h>2?t[2]:r;for(l&&ze(t[0],t[1],l)&&(h=1);++n<h;)for(var f=t[n],y=We(f),w=-1,b=y.length;++w<b;){var C=y[w],S=e[C];(S===r||It(S,Ni[C])&&!fe.call(e,C))&&(e[C]=f[C])}return e}),T0=ie(function(e){return e.push(r,ih),tt(Lh,r,e)});function M0(e,t){return Za(e,H(t,3),qt)}function $0(e,t){return Za(e,H(t,3),Dn)}function k0(e,t){return e==null?e:An(e,H(t,3),We)}function j0(e,t){return e==null?e:Ec(e,H(t,3),We)}function L0(e,t){return e&&qt(e,H(t,3))}function z0(e,t){return e&&Dn(e,H(t,3))}function U0(e){return e==null?[]:ns(e,Ne(e))}function H0(e){return e==null?[]:ns(e,We(e))}function uo(e,t,n){var h=e==null?r:vi(e,t);return h===r?n:h}function B0(e,t){return e!=null&&nh(e,t,dm)}function lo(e,t){return e!=null&&nh(e,t,gm)}var V0=Yc(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Kr.call(t)),e[t]=n},go(Qe)),K0=Yc(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Kr.call(t)),fe.call(e,t)?e[t].push(n):e[t]=[n]},H),J0=ie(pr);function Ne(e){return Ge(e)?fc(e):Mn(e)}function We(e){return Ge(e)?fc(e,!0):Pm(e)}function G0(e,t){var n={};return t=H(t,3),qt(e,function(h,l,f){Lt(n,t(h,l,f),h)}),n}function W0(e,t){var n={};return t=H(t,3),qt(e,function(h,l,f){Lt(n,l,t(h,l,f))}),n}var Q0=ki(function(e,t,n){os(e,t,n)}),Lh=ki(function(e,t,n,h){os(e,t,n,h)}),Y0=Ut(function(e,t){var n={};if(e==null)return n;var h=!1;t=Ie(t,function(f){return f=ni(f,e),h||(h=f.length>1),f}),At(e,Qn(e),n),h&&(n=dt(n,F|j|z,Vm));for(var l=t.length;l--;)Un(n,t[l]);return n});function Z0(e,t){return zh(e,bs(H(t)))}var X0=Ut(function(e,t){return e==null?{}:Sm(e,t)});function zh(e,t){if(e==null)return{};var n=Ie(Qn(e),function(h){return[h]});return t=H(t),Dc(e,n,function(h,l){return t(h,l[0])})}function ew(e,t,n){t=ni(t,e);var h=-1,l=t.length;for(l||(l=1,e=r);++h<l;){var f=e==null?r:e[Dt(t[h])];f===r&&(h=l,f=n),e=Bt(f)?f.call(e):f}return e}function tw(e,t,n){return e==null?e:gr(e,t,n)}function iw(e,t,n,h){return h=typeof h=="function"?h:r,e==null?e:gr(e,t,n,h)}var Uh=eh(Ne),Hh=eh(We);function rw(e,t,n){var h=Y(e),l=h||ai(e)||zi(e);if(t=H(t,4),n==null){var f=e&&e.constructor;l?n=h?new f:[]:Pe(e)?n=Bt(f)?$i(Wr(e)):{}:n={}}return(l?ut:qt)(e,function(y,w,b){return t(n,y,w,b)}),n}function sw(e,t){return e==null?!0:Un(e,t)}function nw(e,t,n){return e==null?e:$c(e,t,Vn(n))}function ow(e,t,n,h){return h=typeof h=="function"?h:r,e==null?e:$c(e,t,Vn(n),h)}function Ui(e){return e==null?[]:In(e,Ne(e))}function aw(e){return e==null?[]:In(e,We(e))}function cw(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=mt(n),n=n===n?n:0),t!==r&&(t=mt(t),t=t===t?t:0),yi(mt(e),t,n)}function hw(e,t,n){return t=Vt(t),n===r?(n=t,t=0):n=Vt(n),e=mt(e),fm(e,t,n)}function uw(e,t,n){if(n&&typeof n!="boolean"&&ze(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Vt(e),t===r?(t=e,e=0):t=Vt(t)),e>t){var h=e;e=t,t=h}if(n||e%1||t%1){var l=dc();return ke(e+l*(t-e+zg("1e-"+((l+"").length-1))),t)}return jn(e,t)}var lw=ji(function(e,t,n){return t=t.toLowerCase(),e+(n?Bh(t):t)});function Bh(e){return po(de(e).toLowerCase())}function Vh(e){return e=de(e),e&&e.replace(pg,ef).replace(Ag,"")}function pw(e,t,n){e=de(e),t=rt(t);var h=e.length;n=n===r?h:yi(X(n),0,h);var l=n;return n-=t.length,n>=0&&e.slice(n,l)==t}function dw(e){return e=de(e),e&&Kd.test(e)?e.replace(Ea,tf):e}function gw(e){return e=de(e),e&&Zd.test(e)?e.replace(an,"\\$&"):e}var fw=ji(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),mw=ji(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),yw=Gc("toLowerCase");function vw(e,t,n){e=de(e),t=X(t);var h=t?Di(e):0;if(!t||h>=t)return e;var l=(t-h)/2;return ps(Xr(l),n)+e+ps(Zr(l),n)}function ww(e,t,n){e=de(e),t=X(t);var h=t?Di(e):0;return t&&h<t?e+ps(t-h,n):e}function _w(e,t,n){e=de(e),t=X(t);var h=t?Di(e):0;return t&&h<t?ps(t-h,n)+e:e}function bw(e,t,n){return n||t==null?t=0:t&&(t=+t),Rf(de(e).replace(cn,""),t||0)}function Ew(e,t,n){return(n?ze(e,t,n):t===r)?t=1:t=X(t),Ln(de(e),t)}function Iw(){var e=arguments,t=de(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Pw=ji(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function Cw(e,t,n){return n&&typeof n!="number"&&ze(e,t,n)&&(t=n=r),n=n===r?Ke:n>>>0,n?(e=de(e),e&&(typeof t=="string"||t!=null&&!ho(t))&&(t=rt(t),!t&&Ai(e))?oi(_t(e),0,n):e.split(t,n)):[]}var Sw=ji(function(e,t,n){return e+(n?" ":"")+po(t)});function xw(e,t,n){return e=de(e),n=n==null?0:yi(X(n),0,e.length),t=rt(t),e.slice(n,n+t.length)==t}function Rw(e,t,n){var h=p.templateSettings;n&&ze(e,t,n)&&(t=r),e=de(e),t=Ps({},t,h,th);var l=Ps({},t.imports,h.imports,th),f=Ne(l),y=In(l,f),w,b,C=0,S=t.interpolate||$r,R="__p += '",D=Cn((t.escape||$r).source+"|"+S.source+"|"+(S===Ia?og:$r).source+"|"+(t.evaluate||$r).source+"|$","g"),L="//# sourceURL="+(fe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Mg+"]")+`
`;e.replace(D,function(V,ne,ae,nt,Ue,ot){return ae||(ae=nt),R+=e.slice(C,ot).replace(dg,rf),ne&&(w=!0,R+=`' +
__e(`+ne+`) +
'`),Ue&&(b=!0,R+=`';
`+Ue+`;
__p += '`),ae&&(R+=`' +
((__t = (`+ae+`)) == null ? '' : __t) +
'`),C=ot+V.length,V}),R+=`';
`;var B=fe.call(t,"variable")&&t.variable;if(!B)R=`with (obj) {
`+R+`
}
`;else if(sg.test(B))throw new Q(v);R=(b?R.replace(Ud,""):R).replace(Hd,"$1").replace(Bd,"$1;"),R="function("+(B||"obj")+`) {
`+(B?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(b?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var te=Jh(function(){return le(f,L+"return "+R).apply(r,y)});if(te.source=R,co(te))throw te;return te}function Ow(e){return de(e).toLowerCase()}function qw(e){return de(e).toUpperCase()}function Aw(e,t,n){if(e=de(e),e&&(n||t===r))return ic(e);if(!e||!(t=rt(t)))return e;var h=_t(e),l=_t(t),f=rc(h,l),y=sc(h,l)+1;return oi(h,f,y).join("")}function Dw(e,t,n){if(e=de(e),e&&(n||t===r))return e.slice(0,oc(e)+1);if(!e||!(t=rt(t)))return e;var h=_t(e),l=sc(h,_t(t))+1;return oi(h,0,l).join("")}function Fw(e,t,n){if(e=de(e),e&&(n||t===r))return e.replace(cn,"");if(!e||!(t=rt(t)))return e;var h=_t(e),l=rc(h,_t(t));return oi(h,l).join("")}function Nw(e,t){var n=Gi,h=Zt;if(Pe(t)){var l="separator"in t?t.separator:l;n="length"in t?X(t.length):n,h="omission"in t?rt(t.omission):h}e=de(e);var f=e.length;if(Ai(e)){var y=_t(e);f=y.length}if(n>=f)return e;var w=n-Di(h);if(w<1)return h;var b=y?oi(y,0,w).join(""):e.slice(0,w);if(l===r)return b+h;if(y&&(w+=b.length-w),ho(l)){if(e.slice(w).search(l)){var C,S=b;for(l.global||(l=Cn(l.source,de(Pa.exec(l))+"g")),l.lastIndex=0;C=l.exec(S);)var R=C.index;b=b.slice(0,R===r?w:R)}}else if(e.indexOf(rt(l),w)!=w){var D=b.lastIndexOf(l);D>-1&&(b=b.slice(0,D))}return b+h}function Tw(e){return e=de(e),e&&Vd.test(e)?e.replace(ba,uf):e}var Mw=ji(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),po=Gc("toUpperCase");function Kh(e,t,n){return e=de(e),t=n?r:t,t===r?nf(e)?df(e):Wg(e):e.match(t)||[]}var Jh=ie(function(e,t){try{return tt(e,r,t)}catch(n){return co(n)?n:new Q(n)}}),$w=Ut(function(e,t){return ut(t,function(n){n=Dt(n),Lt(e,n,oo(e[n],e))}),e});function kw(e){var t=e==null?0:e.length,n=H();return e=t?Ie(e,function(h){if(typeof h[1]!="function")throw new lt(g);return[n(h[0]),h[1]]}):[],ie(function(h){for(var l=-1;++l<t;){var f=e[l];if(tt(f[0],this,h))return tt(f[1],this,h)}})}function jw(e){return um(dt(e,F))}function go(e){return function(){return e}}function Lw(e,t){return e==null||e!==e?t:e}var zw=Qc(),Uw=Qc(!0);function Qe(e){return e}function fo(e){return Sc(typeof e=="function"?e:dt(e,F))}function Hw(e){return Rc(dt(e,F))}function Bw(e,t){return Oc(e,dt(t,F))}var Vw=ie(function(e,t){return function(n){return pr(n,e,t)}}),Kw=ie(function(e,t){return function(n){return pr(e,n,t)}});function mo(e,t,n){var h=Ne(t),l=ns(t,h);n==null&&!(Pe(t)&&(l.length||!h.length))&&(n=t,t=e,e=this,l=ns(t,Ne(t)));var f=!(Pe(n)&&"chain"in n)||!!n.chain,y=Bt(e);return ut(l,function(w){var b=t[w];e[w]=b,y&&(e.prototype[w]=function(){var C=this.__chain__;if(f||C){var S=e(this.__wrapped__),R=S.__actions__=Je(this.__actions__);return R.push({func:b,args:arguments,thisArg:e}),S.__chain__=C,S}return b.apply(e,ei([this.value()],arguments))})}),e}function Jw(){return Me._===this&&(Me._=wf),this}function yo(){}function Gw(e){return e=X(e),ie(function(t){return qc(t,e)})}var Ww=Jn(Ie),Qw=Jn(Ya),Yw=Jn(vn);function Gh(e){return eo(e)?wn(Dt(e)):xm(e)}function Zw(e){return function(t){return e==null?r:vi(e,t)}}var Xw=Zc(),e_=Zc(!0);function vo(){return[]}function wo(){return!1}function t_(){return{}}function i_(){return""}function r_(){return!0}function s_(e,t){if(e=X(e),e<1||e>et)return[];var n=Ke,h=ke(e,Ke);t=H(t),e-=Ke;for(var l=En(h,t);++n<e;)t(n);return l}function n_(e){return Y(e)?Ie(e,Dt):st(e)?[e]:Je(gh(de(e)))}function o_(e){var t=++yf;return de(e)+t}var a_=ls(function(e,t){return e+t},0),c_=Gn("ceil"),h_=ls(function(e,t){return e/t},1),u_=Gn("floor");function l_(e){return e&&e.length?ss(e,Qe,Fn):r}function p_(e,t){return e&&e.length?ss(e,H(t,2),Fn):r}function d_(e){return ec(e,Qe)}function g_(e,t){return ec(e,H(t,2))}function f_(e){return e&&e.length?ss(e,Qe,$n):r}function m_(e,t){return e&&e.length?ss(e,H(t,2),$n):r}var y_=ls(function(e,t){return e*t},1),v_=Gn("round"),w_=ls(function(e,t){return e-t},0);function __(e){return e&&e.length?bn(e,Qe):0}function b_(e,t){return e&&e.length?bn(e,H(t,2)):0}return p.after=Hv,p.ary=Ch,p.assign=q0,p.assignIn=jh,p.assignInWith=Ps,p.assignWith=A0,p.at=D0,p.before=Sh,p.bind=oo,p.bindAll=$w,p.bindKey=xh,p.castArray=t0,p.chain=Eh,p.chunk=uy,p.compact=ly,p.concat=py,p.cond=kw,p.conforms=jw,p.constant=go,p.countBy=_v,p.create=F0,p.curry=Rh,p.curryRight=Oh,p.debounce=qh,p.defaults=N0,p.defaultsDeep=T0,p.defer=Bv,p.delay=Vv,p.difference=dy,p.differenceBy=gy,p.differenceWith=fy,p.drop=my,p.dropRight=yy,p.dropRightWhile=vy,p.dropWhile=wy,p.fill=_y,p.filter=Ev,p.flatMap=Cv,p.flatMapDeep=Sv,p.flatMapDepth=xv,p.flatten=vh,p.flattenDeep=by,p.flattenDepth=Ey,p.flip=Kv,p.flow=zw,p.flowRight=Uw,p.fromPairs=Iy,p.functions=U0,p.functionsIn=H0,p.groupBy=Rv,p.initial=Cy,p.intersection=Sy,p.intersectionBy=xy,p.intersectionWith=Ry,p.invert=V0,p.invertBy=K0,p.invokeMap=qv,p.iteratee=fo,p.keyBy=Av,p.keys=Ne,p.keysIn=We,p.map=vs,p.mapKeys=G0,p.mapValues=W0,p.matches=Hw,p.matchesProperty=Bw,p.memoize=_s,p.merge=Q0,p.mergeWith=Lh,p.method=Vw,p.methodOf=Kw,p.mixin=mo,p.negate=bs,p.nthArg=Gw,p.omit=Y0,p.omitBy=Z0,p.once=Jv,p.orderBy=Dv,p.over=Ww,p.overArgs=Gv,p.overEvery=Qw,p.overSome=Yw,p.partial=ao,p.partialRight=Ah,p.partition=Fv,p.pick=X0,p.pickBy=zh,p.property=Gh,p.propertyOf=Zw,p.pull=Dy,p.pullAll=_h,p.pullAllBy=Fy,p.pullAllWith=Ny,p.pullAt=Ty,p.range=Xw,p.rangeRight=e_,p.rearg=Wv,p.reject=Mv,p.remove=My,p.rest=Qv,p.reverse=so,p.sampleSize=kv,p.set=tw,p.setWith=iw,p.shuffle=jv,p.slice=$y,p.sortBy=Uv,p.sortedUniq=By,p.sortedUniqBy=Vy,p.split=Cw,p.spread=Yv,p.tail=Ky,p.take=Jy,p.takeRight=Gy,p.takeRightWhile=Wy,p.takeWhile=Qy,p.tap=lv,p.throttle=Zv,p.thru=ys,p.toArray=Mh,p.toPairs=Uh,p.toPairsIn=Hh,p.toPath=n_,p.toPlainObject=kh,p.transform=rw,p.unary=Xv,p.union=Yy,p.unionBy=Zy,p.unionWith=Xy,p.uniq=ev,p.uniqBy=tv,p.uniqWith=iv,p.unset=sw,p.unzip=no,p.unzipWith=bh,p.update=nw,p.updateWith=ow,p.values=Ui,p.valuesIn=aw,p.without=rv,p.words=Kh,p.wrap=e0,p.xor=sv,p.xorBy=nv,p.xorWith=ov,p.zip=av,p.zipObject=cv,p.zipObjectDeep=hv,p.zipWith=uv,p.entries=Uh,p.entriesIn=Hh,p.extend=jh,p.extendWith=Ps,mo(p,p),p.add=a_,p.attempt=Jh,p.camelCase=lw,p.capitalize=Bh,p.ceil=c_,p.clamp=cw,p.clone=i0,p.cloneDeep=s0,p.cloneDeepWith=n0,p.cloneWith=r0,p.conformsTo=o0,p.deburr=Vh,p.defaultTo=Lw,p.divide=h_,p.endsWith=pw,p.eq=It,p.escape=dw,p.escapeRegExp=gw,p.every=bv,p.find=Iv,p.findIndex=mh,p.findKey=M0,p.findLast=Pv,p.findLastIndex=yh,p.findLastKey=$0,p.floor=u_,p.forEach=Ih,p.forEachRight=Ph,p.forIn=k0,p.forInRight=j0,p.forOwn=L0,p.forOwnRight=z0,p.get=uo,p.gt=a0,p.gte=c0,p.has=B0,p.hasIn=lo,p.head=wh,p.identity=Qe,p.includes=Ov,p.indexOf=Py,p.inRange=hw,p.invoke=J0,p.isArguments=bi,p.isArray=Y,p.isArrayBuffer=h0,p.isArrayLike=Ge,p.isArrayLikeObject=Se,p.isBoolean=u0,p.isBuffer=ai,p.isDate=l0,p.isElement=p0,p.isEmpty=d0,p.isEqual=g0,p.isEqualWith=f0,p.isError=co,p.isFinite=m0,p.isFunction=Bt,p.isInteger=Dh,p.isLength=Es,p.isMap=Fh,p.isMatch=y0,p.isMatchWith=v0,p.isNaN=w0,p.isNative=_0,p.isNil=E0,p.isNull=b0,p.isNumber=Nh,p.isObject=Pe,p.isObjectLike=Ce,p.isPlainObject=vr,p.isRegExp=ho,p.isSafeInteger=I0,p.isSet=Th,p.isString=Is,p.isSymbol=st,p.isTypedArray=zi,p.isUndefined=P0,p.isWeakMap=C0,p.isWeakSet=S0,p.join=Oy,p.kebabCase=fw,p.last=ft,p.lastIndexOf=qy,p.lowerCase=mw,p.lowerFirst=yw,p.lt=x0,p.lte=R0,p.max=l_,p.maxBy=p_,p.mean=d_,p.meanBy=g_,p.min=f_,p.minBy=m_,p.stubArray=vo,p.stubFalse=wo,p.stubObject=t_,p.stubString=i_,p.stubTrue=r_,p.multiply=y_,p.nth=Ay,p.noConflict=Jw,p.noop=yo,p.now=ws,p.pad=vw,p.padEnd=ww,p.padStart=_w,p.parseInt=bw,p.random=uw,p.reduce=Nv,p.reduceRight=Tv,p.repeat=Ew,p.replace=Iw,p.result=ew,p.round=v_,p.runInContext=_,p.sample=$v,p.size=Lv,p.snakeCase=Pw,p.some=zv,p.sortedIndex=ky,p.sortedIndexBy=jy,p.sortedIndexOf=Ly,p.sortedLastIndex=zy,p.sortedLastIndexBy=Uy,p.sortedLastIndexOf=Hy,p.startCase=Sw,p.startsWith=xw,p.subtract=w_,p.sum=__,p.sumBy=b_,p.template=Rw,p.times=s_,p.toFinite=Vt,p.toInteger=X,p.toLength=$h,p.toLower=Ow,p.toNumber=mt,p.toSafeInteger=O0,p.toString=de,p.toUpper=qw,p.trim=Aw,p.trimEnd=Dw,p.trimStart=Fw,p.truncate=Nw,p.unescape=Tw,p.uniqueId=o_,p.upperCase=Mw,p.upperFirst=po,p.each=Ih,p.eachRight=Ph,p.first=wh,mo(p,function(){var e={};return qt(p,function(t,n){fe.call(p.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),p.VERSION=o,ut(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),ut(["drop","take"],function(e,t){oe.prototype[e]=function(n){n=n===r?1:De(X(n),0);var h=this.__filtered__&&!t?new oe(this):this.clone();return h.__filtered__?h.__takeCount__=ke(n,h.__takeCount__):h.__views__.push({size:ke(n,Ke),type:e+(h.__dir__<0?"Right":"")}),h},oe.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),ut(["filter","map","takeWhile"],function(e,t){var n=t+1,h=n==Fe||n==Wi;oe.prototype[e]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:H(l,3),type:n}),f.__filtered__=f.__filtered__||h,f}}),ut(["head","last"],function(e,t){var n="take"+(t?"Right":"");oe.prototype[e]=function(){return this[n](1).value()[0]}}),ut(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");oe.prototype[e]=function(){return this.__filtered__?new oe(this):this[n](1)}}),oe.prototype.compact=function(){return this.filter(Qe)},oe.prototype.find=function(e){return this.filter(e).head()},oe.prototype.findLast=function(e){return this.reverse().find(e)},oe.prototype.invokeMap=ie(function(e,t){return typeof e=="function"?new oe(this):this.map(function(n){return pr(n,e,t)})}),oe.prototype.reject=function(e){return this.filter(bs(H(e)))},oe.prototype.slice=function(e,t){e=X(e);var n=this;return n.__filtered__&&(e>0||t<0)?new oe(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=X(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},oe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},oe.prototype.toArray=function(){return this.take(Ke)},qt(oe.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),h=/^(?:head|last)$/.test(t),l=p[h?"take"+(t=="last"?"Right":""):t],f=h||/^find/.test(t);l&&(p.prototype[t]=function(){var y=this.__wrapped__,w=h?[1]:arguments,b=y instanceof oe,C=w[0],S=b||Y(y),R=function(ne){var ae=l.apply(p,ei([ne],w));return h&&D?ae[0]:ae};S&&n&&typeof C=="function"&&C.length!=1&&(b=S=!1);var D=this.__chain__,L=!!this.__actions__.length,B=f&&!D,te=b&&!L;if(!f&&S){y=te?y:new oe(this);var V=e.apply(y,w);return V.__actions__.push({func:ys,args:[R],thisArg:r}),new pt(V,D)}return B&&te?e.apply(this,w):(V=this.thru(R),B?h?V.value()[0]:V.value():V)})}),ut(["pop","push","shift","sort","splice","unshift"],function(e){var t=Hr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",h=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(h&&!this.__chain__){var f=this.value();return t.apply(Y(f)?f:[],l)}return this[n](function(y){return t.apply(Y(y)?y:[],l)})}}),qt(oe.prototype,function(e,t){var n=p[t];if(n){var h=n.name+"";fe.call(Mi,h)||(Mi[h]=[]),Mi[h].push({name:t,func:n})}}),Mi[us(r,re).name]=[{name:"wrapper",func:r}],oe.prototype.clone=Tf,oe.prototype.reverse=Mf,oe.prototype.value=$f,p.prototype.at=pv,p.prototype.chain=dv,p.prototype.commit=gv,p.prototype.next=fv,p.prototype.plant=yv,p.prototype.reverse=vv,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=wv,p.prototype.first=p.prototype.head,nr&&(p.prototype[nr]=mv),p},Fi=gf();di?((di.exports=Fi)._=Fi,gn._=Fi):Me._=Fi}).call(Ji)})(Ls,Ls.exports);var td=Object.defineProperty,id=Object.defineProperties,rd=Object.getOwnPropertyDescriptors,ha=Object.getOwnPropertySymbols,sd=Object.prototype.hasOwnProperty,nd=Object.prototype.propertyIsEnumerable,ua=(m,s,r)=>s in m?td(m,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[s]=r,Or=(m,s)=>{for(var r in s||(s={}))sd.call(s,r)&&ua(m,r,s[r]);if(ha)for(var r of ha(s))nd.call(s,r)&&ua(m,r,s[r]);return m},od=(m,s)=>id(m,rd(s));function Yt(m,s,r){var o;const a=(0,d.DQe)(m);return((o=s.rpcMap)==null?void 0:o[a.reference])||`${ed}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function ui(m){return m.includes(":")?m.split(":")[1]:m}function la(m){return m.map(s=>`${s.split(":")[0]}:${s.split(":")[1]}`)}function ad(m,s){const r=Object.keys(s.namespaces).filter(a=>a.includes(m));if(!r.length)return[];const o=[];return r.forEach(a=>{const u=s.namespaces[a].accounts;o.push(...u)}),o}function zs(m={},s={}){const r=pa(m),o=pa(s);return Ls.exports.merge(r,o)}function pa(m){var s,r,o,a;const u={};if(!(0,d.L5o)(m))return u;for(const[g,v]of Object.entries(m)){const E=(0,d.gpE)(g)?[g]:v.chains,x=v.methods||[],q=v.events||[],F=v.rpcMap||{},j=(0,d.Maj)(g);u[j]=od(Or(Or({},u[j]),v),{chains:(0,d.eGA)(E,(s=u[j])==null?void 0:s.chains),methods:(0,d.eGA)(x,(r=u[j])==null?void 0:r.methods),events:(0,d.eGA)(q,(o=u[j])==null?void 0:o.events),rpcMap:Or(Or({},F),(a=u[j])==null?void 0:a.rpcMap)})}return u}function cd(m){return m.includes(":")?m.split(":")[2]:m}function da(m){const s={};for(const[r,o]of Object.entries(m)){const a=o.methods||[],u=o.events||[],g=o.accounts||[],v=(0,d.gpE)(r)?[r]:o.chains?o.chains:la(o.accounts);s[r]={chains:v,methods:a,events:u,accounts:g}}return s}function Us(m){return typeof m=="number"?m:m.includes("0x")?parseInt(m,16):(m=m.includes(":")?m.split(":")[1]:m,isNaN(Number(m))?m:Number(m))}const ga={},be=m=>ga[m],Hs=(m,s)=>{ga[m]=s};class hd{constructor(s){this.name="polkadot",this.namespace=s.namespace,this.events=be("events"),this.client=be("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=ui(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Yt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Nt.r(new Qt.Z(o,be("disableProviderPing")))}}class ud{constructor(s){this.name="eip155",this.namespace=s.namespace,this.events=be("events"),this.client=be("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(s){switch(s.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(s);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(s.request.method)?await this.client.request(s):this.getHttpProvider().request(s.request)}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(parseInt(s),r),this.chainId=parseInt(s),this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}createHttpProvider(s,r){const o=r||Yt(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Nt.r(new Qt.k(o,be("disableProviderPing")))}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=parseInt(ui(r));s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const s=this.chainId,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}async handleSwitchChain(s){var r,o;let a=s.request.params?(r=s.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:s.topic,request:{method:s.request.method,params:[{chainId:a}]},chainId:(o=this.namespace.chains)==null?void 0:o[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(s){return this.namespace.chains.includes(`${this.name}:${s}`)}}class ld{constructor(s){this.name="solana",this.namespace=s.namespace,this.events=be("events"),this.client=be("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=ui(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Yt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Nt.r(new Qt.Z(o,be("disableProviderPing")))}}class pd{constructor(s){this.name="cosmos",this.namespace=s.namespace,this.events=be("events"),this.client=be("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=ui(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Yt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Nt.r(new Qt.Z(o,be("disableProviderPing")))}}class dd{constructor(s){this.name="cip34",this.namespace=s.namespace,this.events=be("events"),this.client=be("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{const o=this.getCardanoRPCUrl(r),a=ui(r);s[a]=this.createHttpProvider(a,o)}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}getCardanoRPCUrl(s){const r=this.namespace.rpcMap;if(r)return r[s]}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||this.getCardanoRPCUrl(s);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Nt.r(new Qt.Z(o,be("disableProviderPing")))}}class gd{constructor(s){this.name="elrond",this.namespace=s.namespace,this.events=be("events"),this.client=be("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=ui(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Yt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Nt.r(new Qt.Z(o,be("disableProviderPing")))}}class fd{constructor(s){this.name="multiversx",this.namespace=s.namespace,this.events=be("events"),this.client=be("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=ui(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Yt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Nt.r(new Qt.Z(o,be("disableProviderPing")))}}class md{constructor(s){this.name="near",this.namespace=s.namespace,this.events=be("events"),this.client=be("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){if(this.chainId=s,!this.httpProviders[s]){const o=r||Yt(`${this.name}:${s}`,this.namespace);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,o)}this.events.emit(Mt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;s[r]=this.createHttpProvider(r,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Yt(s,this.namespace);return typeof o>"u"?void 0:new Nt.r(new Qt.Z(o,be("disableProviderPing")))}}var yd=Object.defineProperty,vd=Object.defineProperties,wd=Object.getOwnPropertyDescriptors,fa=Object.getOwnPropertySymbols,_d=Object.prototype.hasOwnProperty,bd=Object.prototype.propertyIsEnumerable,ma=(m,s,r)=>s in m?yd(m,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[s]=r,qr=(m,s)=>{for(var r in s||(s={}))_d.call(s,r)&&ma(m,r,s[r]);if(fa)for(var r of fa(s))bd.call(s,r)&&ma(m,r,s[r]);return m},Bs=(m,s)=>vd(m,wd(s));class Vs{constructor(s){this.events=new(Hi()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=s,this.logger=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ee.gw)((0,ee.jI)({level:(s==null?void 0:s.logger)||aa})),this.disableProviderPing=(s==null?void 0:s.disableProviderPing)||!1}static async init(s){const r=new Vs(s);return await r.initialize(),r}async request(s,r,o){const[a,u]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:qr({},s),chainId:`${a}:${u}`,topic:this.session.topic,expiry:o})}sendAsync(s,r,o,a){const u=new Date().getTime();this.request(s,o,a).then(g=>r(null,(0,K.formatJsonRpcResult)(u,g))).catch(g=>r(g,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var s;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(s=this.session)==null?void 0:s.topic,reason:(0,d.D6H)("USER_DISCONNECTED")}),await this.cleanup()}async connect(s){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(s),await this.cleanupPendingPairings(),!s.skipPairing)return await this.pair(s.pairingTopic)}async authenticate(s){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(s),await this.cleanupPendingPairings();const{uri:r,response:o}=await this.client.authenticate(s);r&&(this.uri=r,this.events.emit("display_uri",r));const a=await o();if(this.session=a.session,this.session){const u=da(this.session.namespaces);this.namespaces=zs(this.namespaces,u),this.persist("namespaces",this.namespaces),this.onConnect()}return a}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}removeListener(s,r){this.events.removeListener(s,r)}off(s,r){this.events.off(s,r)}get isWalletConnect(){return!0}async pair(s){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:o,approval:a}=await this.client.connect({pairingTopic:s,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});o&&(this.uri=o,this.events.emit("display_uri",o)),await a().then(u=>{this.session=u;const g=da(u.namespaces);this.namespaces=zs(this.namespaces,g),this.persist("namespaces",this.namespaces)}).catch(u=>{if(u.message!==sa)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(s,r){try{if(!this.session)return;const[o,a]=this.validateChain(s);this.getProvider(o).setDefaultChain(a,r)}catch(o){if(!/Please call connect/.test(o.message))throw o}}async cleanupPendingPairings(s={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if((0,d.qt8)(r)){for(const o of r)s.deletePairings?this.client.core.expirer.set(o.topic,0):await this.client.core.relayer.subscriber.unsubscribe(o.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const s=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[s]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await js.init({logger:this.providerOpts.logger||aa,relayUrl:this.providerOpts.relayUrl||Yp,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const s=[...new Set(Object.keys(this.session.namespaces).map(r=>(0,d.Maj)(r)))];Hs("client",this.client),Hs("events",this.events),Hs("disableProviderPing",this.disableProviderPing),s.forEach(r=>{if(!this.session)return;const o=ad(r,this.session),a=la(o),u=zs(this.namespaces,this.optionalNamespaces),g=Bs(qr({},u[r]),{accounts:o,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new ud({namespace:g});break;case"solana":this.rpcProviders[r]=new ld({namespace:g});break;case"cosmos":this.rpcProviders[r]=new pd({namespace:g});break;case"polkadot":this.rpcProviders[r]=new hd({namespace:g});break;case"cip34":this.rpcProviders[r]=new dd({namespace:g});break;case"elrond":this.rpcProviders[r]=new gd({namespace:g});break;case"multiversx":this.rpcProviders[r]=new fd({namespace:g});break;case"near":this.rpcProviders[r]=new md({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",s=>{this.events.emit("session_ping",s)}),this.client.on("session_event",s=>{const{params:r}=s,{event:o}=r;if(o.name==="accountsChanged"){const a=o.data;a&&(0,d.qt8)(a)&&this.events.emit("accountsChanged",a.map(cd))}else if(o.name==="chainChanged"){const a=r.chainId,u=r.event.data,g=(0,d.Maj)(a),v=Us(a)!==Us(u)?`${g}:${Us(u)}`:a;this.onChainChanged(v)}else this.events.emit(o.name,o.data);this.events.emit("session_event",s)}),this.client.on("session_update",({topic:s,params:r})=>{var o;const{namespaces:a}=r,u=(o=this.client)==null?void 0:o.session.get(s);this.session=Bs(qr({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:s,params:r})}),this.client.on("session_delete",async s=>{await this.cleanup(),this.events.emit("session_delete",s),this.events.emit("disconnect",Bs(qr({},(0,d.D6H)("USER_DISCONNECTED")),{data:s.topic}))}),this.on(Mt.DEFAULT_CHAIN_CHANGED,s=>{this.onChainChanged(s,!0)})}getProvider(s){if(!this.rpcProviders[s])throw new Error(`Provider not found: ${s}`);return this.rpcProviders[s]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(s=>{var r;this.getProvider(s).updateNamespace((r=this.session)==null?void 0:r.namespaces[s])})}setNamespaces(s){const{namespaces:r,optionalNamespaces:o,sessionProperties:a}=s;r&&Object.keys(r).length&&(this.namespaces=r),o&&Object.keys(o).length&&(this.optionalNamespaces=o),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",o)}validateChain(s){const[r,o]=(s==null?void 0:s.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,o];if(r&&!Object.keys(this.namespaces||{}).map(g=>(0,d.Maj)(g)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&o)return[r,o];const a=(0,d.Maj)(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[s]=this.validateChain();return await this.getProvider(s).requestAccounts()}onChainChanged(s,r=!1){if(!this.namespaces)return;const[o,a]=this.validateChain(s);a&&(r||this.getProvider(o).setDefaultChain(a),this.namespaces[o]?this.namespaces[o].defaultChain=a:this.namespaces[`${o}:${a}`]?this.namespaces[`${o}:${a}`].defaultChain=a:this.namespaces[`${o}:${a}`]={defaultChain:a},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(s,r){this.client.core.storage.setItem(`${ca}/${s}`,r)}async getFromStore(s){return await this.client.core.storage.getItem(`${ca}/${s}`)}}const Ed=Vs,Id="wc",Pd="ethereum_provider",Cd=`${Id}@2:${Pd}:`,Sd="https://rpc.walletconnect.com/v1/",Ks=["eth_sendTransaction","personal_sign"],xd=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Js=["chainChanged","accountsChanged"],Rd=["chainChanged","accountsChanged","message","disconnect","connect"];var Od=Object.defineProperty,qd=Object.defineProperties,Ad=Object.getOwnPropertyDescriptors,ya=Object.getOwnPropertySymbols,Dd=Object.prototype.hasOwnProperty,Fd=Object.prototype.propertyIsEnumerable,va=(m,s,r)=>s in m?Od(m,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[s]=r,Ci=(m,s)=>{for(var r in s||(s={}))Dd.call(s,r)&&va(m,r,s[r]);if(ya)for(var r of ya(s))Fd.call(s,r)&&va(m,r,s[r]);return m},Gs=(m,s)=>qd(m,Ad(s));function Ar(m){return Number(m[0].split(":")[1])}function Dr(m){return`0x${m.toString(16)}`}function Nd(m){const{chains:s,optionalChains:r,methods:o,optionalMethods:a,events:u,optionalEvents:g,rpcMap:v}=m;if(!(0,d.qt8)(s))throw new Error("Invalid chains");const E={chains:s,methods:o||Ks,events:u||Js,rpcMap:Ci({},s.length?{[Ar(s)]:v[Ar(s)]}:{})},x=u==null?void 0:u.filter(z=>!Js.includes(z)),q=o==null?void 0:o.filter(z=>!Ks.includes(z));if(!r&&!g&&!a&&!(x!=null&&x.length)&&!(q!=null&&q.length))return{required:s.length?E:void 0};const F=(x==null?void 0:x.length)&&(q==null?void 0:q.length)||!r,j={chains:[...new Set(F?E.chains.concat(r||[]):r)],methods:[...new Set(E.methods.concat(a!=null&&a.length?a:xd))],events:[...new Set(E.events.concat(g!=null&&g.length?g:Rd))],rpcMap:v};return{required:s.length?E:void 0,optional:r.length?j:void 0}}class Ws{constructor(){this.events=new He.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Cd,this.on=(s,r)=>(this.events.on(s,r),this),this.once=(s,r)=>(this.events.once(s,r),this),this.removeListener=(s,r)=>(this.events.removeListener(s,r),this),this.off=(s,r)=>(this.events.off(s,r),this),this.parseAccount=s=>this.isCompatibleChainId(s)?this.parseAccountId(s).address:s,this.signer={},this.rpc={}}static async init(s){const r=new Ws;return await r.initialize(s),r}async request(s,r){return await this.signer.request(s,this.formatChainId(this.chainId),r)}sendAsync(s,r,o){this.signer.sendAsync(s,r,this.formatChainId(this.chainId),o)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(s){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(s);const{required:r,optional:o}=Nd(this.rpc);try{const a=await new Promise(async(g,v)=>{var E;this.rpc.showQrModal&&((E=this.modal)==null||E.subscribeModal(x=>{!x.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),v(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Gs(Ci({namespaces:Ci({},r&&{[this.namespace]:r})},o&&{optionalNamespaces:{[this.namespace]:o}}),{pairingTopic:s==null?void 0:s.pairingTopic})).then(x=>{g(x)}).catch(x=>{v(new Error(x.message))})});if(!a)return;const u=(0,d.guN)(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:Dr(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async authenticate(s){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:s==null?void 0:s.chains});try{const r=await new Promise(async(a,u)=>{var g;this.rpc.showQrModal&&((g=this.modal)==null||g.subscribeModal(v=>{!v.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),u(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Gs(Ci({},s),{chains:this.rpc.chains})).then(v=>{a(v)}).catch(v=>{u(new Error(v.message))})}),o=r.session;if(o){const a=(0,d.guN)(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:a),this.setAccounts(a),this.events.emit("connect",{chainId:Dr(this.chainId)})}return r}catch(r){throw this.signer.logger.error(r),r}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",s=>{const{params:r}=s,{event:o}=r;o.name==="accountsChanged"?(this.accounts=this.parseAccounts(o.data),this.events.emit("accountsChanged",this.accounts)):o.name==="chainChanged"?this.setChainId(this.formatChainId(o.data)):this.events.emit(o.name,o.data),this.events.emit("session_event",s)}),this.signer.on("chainChanged",s=>{const r=parseInt(s);this.chainId=r,this.events.emit("chainChanged",Dr(this.chainId)),this.persist()}),this.signer.on("session_update",s=>{this.events.emit("session_update",s)}),this.signer.on("session_delete",s=>{this.reset(),this.events.emit("session_delete",s),this.events.emit("disconnect",Gs(Ci({},(0,d.D6H)("USER_DISCONNECTED")),{data:s.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",s=>{var r,o;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(o=this.modal)==null||o.openModal({uri:s})),this.events.emit("display_uri",s)})}switchEthereumChain(s){this.request({method:"wallet_switchEthereumChain",params:[{chainId:s.toString(16)}]})}isCompatibleChainId(s){return typeof s=="string"?s.startsWith(`${this.namespace}:`):!1}formatChainId(s){return`${this.namespace}:${s}`}parseChainId(s){return Number(s.split(":")[1])}setChainIds(s){const r=s.filter(o=>this.isCompatibleChainId(o)).map(o=>this.parseChainId(o));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Dr(this.chainId)),this.persist())}setChainId(s){if(this.isCompatibleChainId(s)){const r=this.parseChainId(s);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(s){const[r,o,a]=s.split(":");return{chainId:`${r}:${o}`,address:a}}setAccounts(s){this.accounts=s.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(s){var r,o;const a=(r=s==null?void 0:s.chains)!=null?r:[],u=(o=s==null?void 0:s.optionalChains)!=null?o:[],g=a.concat(u);if(!g.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const v=a.length?(s==null?void 0:s.methods)||Ks:[],E=a.length?(s==null?void 0:s.events)||Js:[],x=(s==null?void 0:s.optionalMethods)||[],q=(s==null?void 0:s.optionalEvents)||[],F=(s==null?void 0:s.rpcMap)||this.buildRpcMap(g,s.projectId),j=(s==null?void 0:s.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(z=>this.formatChainId(z)),optionalChains:u.map(z=>this.formatChainId(z)),methods:v,events:E,optionalMethods:x,optionalEvents:q,rpcMap:F,showQrModal:!!(s!=null&&s.showQrModal),qrModalOptions:j,projectId:s.projectId,metadata:s.metadata}}buildRpcMap(s,r){const o={};return s.forEach(a=>{o[a]=this.getRpcUrl(a,r)}),o}async initialize(s){if(this.rpc=this.getRpcConfig(s),this.chainId=this.rpc.chains.length?Ar(this.rpc.chains):Ar(this.rpc.optionalChains),this.signer=await Ed.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:s.disableProviderPing,relayUrl:s.relayUrl,storageOptions:s.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:o}=await me.e(4019).then(me.bind(me,54019));r=o}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Ci({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(o){throw this.signer.logger.error(o),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(s){if(!s)return;const{chains:r,optionalChains:o,rpcMap:a}=s;r&&(0,d.qt8)(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),o&&(0,d.qt8)(o)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=o==null?void 0:o.map(u=>this.formatChainId(u)),o.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(s,r){var o;return((o=this.rpc.rpcMap)==null?void 0:o[s])||`${Sd}?chainId=eip155:${s}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const s=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${s}`]?this.session.namespaces[`${this.namespace}:${s}`]:this.session.namespaces[this.namespace];this.setChainIds(s?[this.formatChainId(s)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}catch(s){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(s),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(s){return typeof s=="string"||s instanceof String?[this.parseAccount(s)]:s.map(r=>this.parseAccount(r))}}const Td=Ws},72100:function(Cs){var Jt=typeof Reflect=="object"?Reflect:null,me=Jt&&typeof Jt.apply=="function"?Jt.apply:function(O,N,U){return Function.prototype.apply.call(O,N,U)},He;Jt&&typeof Jt.ownKeys=="function"?He=Jt.ownKeys:Object.getOwnPropertySymbols?He=function(O){return Object.getOwnPropertyNames(O).concat(Object.getOwnPropertySymbols(O))}:He=function(O){return Object.getOwnPropertyNames(O)};function Hi(A){console&&console.warn&&console.warn(A)}var d=Number.isNaN||function(O){return O!==O};function pe(){pe.init.call(this)}Cs.exports=pe,Cs.exports.once=xs,pe.EventEmitter=pe,pe.prototype._events=void 0,pe.prototype._eventsCount=0,pe.prototype._maxListeners=void 0;var Gt=10;function ee(A){if(typeof A!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof A)}Object.defineProperty(pe,"defaultMaxListeners",{enumerable:!0,get:function(){return Gt},set:function(A){if(typeof A!="number"||A<0||d(A))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+A+".");Gt=A}}),pe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},pe.prototype.setMaxListeners=function(O){if(typeof O!="number"||O<0||d(O))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+O+".");return this._maxListeners=O,this};function Ft(A){return A._maxListeners===void 0?pe.defaultMaxListeners:A._maxListeners}pe.prototype.getMaxListeners=function(){return Ft(this)},pe.prototype.emit=function(O){for(var N=[],U=1;U<arguments.length;U++)N.push(arguments[U]);var G=O==="error",ye=this._events;if(ye!==void 0)G=G&&ye.error===void 0;else if(!G)return!1;if(G){var se;if(N.length>0&&(se=N[0]),se instanceof Error)throw se;var Be=new Error("Unhandled error."+(se?" ("+se.message+")":""));throw Be.context=se,Be}var Ct=ye[O];if(Ct===void 0)return!1;if(typeof Ct=="function")me(Ct,this,N);else for(var Cr=Ct.length,M=Ir(Ct,Cr),U=0;U<Cr;++U)me(M[U],this,N);return!0};function wr(A,O,N,U){var G,ye,se;if(ee(N),ye=A._events,ye===void 0?(ye=A._events=Object.create(null),A._eventsCount=0):(ye.newListener!==void 0&&(A.emit("newListener",O,N.listener?N.listener:N),ye=A._events),se=ye[O]),se===void 0)se=ye[O]=N,++A._eventsCount;else if(typeof se=="function"?se=ye[O]=U?[N,se]:[se,N]:U?se.unshift(N):se.push(N),G=Ft(A),G>0&&se.length>G&&!se.warned){se.warned=!0;var Be=new Error("Possible EventEmitter memory leak detected. "+se.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");Be.name="MaxListenersExceededWarning",Be.emitter=A,Be.type=O,Be.count=se.length,Hi(Be)}return A}pe.prototype.addListener=function(O,N){return wr(this,O,N,!1)},pe.prototype.on=pe.prototype.addListener,pe.prototype.prependListener=function(O,N){return wr(this,O,N,!0)};function _o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _r(A,O,N){var U={fired:!1,wrapFn:void 0,target:A,type:O,listener:N},G=_o.bind(U);return G.listener=N,U.wrapFn=G,G}pe.prototype.once=function(O,N){return ee(N),this.on(O,_r(this,O,N)),this},pe.prototype.prependOnceListener=function(O,N){return ee(N),this.prependListener(O,_r(this,O,N)),this},pe.prototype.removeListener=function(O,N){var U,G,ye,se,Be;if(ee(N),G=this._events,G===void 0)return this;if(U=G[O],U===void 0)return this;if(U===N||U.listener===N)--this._eventsCount===0?this._events=Object.create(null):(delete G[O],G.removeListener&&this.emit("removeListener",O,U.listener||N));else if(typeof U!="function"){for(ye=-1,se=U.length-1;se>=0;se--)if(U[se]===N||U[se].listener===N){Be=U[se].listener,ye=se;break}if(ye<0)return this;ye===0?U.shift():Ss(U,ye),U.length===1&&(G[O]=U[0]),G.removeListener!==void 0&&this.emit("removeListener",O,Be||N)}return this},pe.prototype.off=pe.prototype.removeListener,pe.prototype.removeAllListeners=function(O){var N,U,G;if(U=this._events,U===void 0)return this;if(U.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):U[O]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete U[O]),this;if(arguments.length===0){var ye=Object.keys(U),se;for(G=0;G<ye.length;++G)se=ye[G],se!=="removeListener"&&this.removeAllListeners(se);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(N=U[O],typeof N=="function")this.removeListener(O,N);else if(N!==void 0)for(G=N.length-1;G>=0;G--)this.removeListener(O,N[G]);return this};function br(A,O,N){var U=A._events;if(U===void 0)return[];var G=U[O];return G===void 0?[]:typeof G=="function"?N?[G.listener||G]:[G]:N?bo(G):Ir(G,G.length)}pe.prototype.listeners=function(O){return br(this,O,!0)},pe.prototype.rawListeners=function(O){return br(this,O,!1)},pe.listenerCount=function(A,O){return typeof A.listenerCount=="function"?A.listenerCount(O):Er.call(A,O)},pe.prototype.listenerCount=Er;function Er(A){var O=this._events;if(O!==void 0){var N=O[A];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}pe.prototype.eventNames=function(){return this._eventsCount>0?He(this._events):[]};function Ir(A,O){for(var N=new Array(O),U=0;U<O;++U)N[U]=A[U];return N}function Ss(A,O){for(;O+1<A.length;O++)A[O]=A[O+1];A.pop()}function bo(A){for(var O=new Array(A.length),N=0;N<O.length;++N)O[N]=A[N].listener||A[N];return O}function xs(A,O){return new Promise(function(N,U){function G(se){A.removeListener(O,ye),U(se)}function ye(){typeof A.removeListener=="function"&&A.removeListener("error",G),N([].slice.call(arguments))}Pr(A,O,ye,{once:!0}),O!=="error"&&Eo(A,G,{once:!0})})}function Eo(A,O,N){typeof A.on=="function"&&Pr(A,"error",O,N)}function Pr(A,O,N,U){if(typeof A.on=="function")U.once?A.once(O,N):A.on(O,N);else if(typeof A.addEventListener=="function")A.addEventListener(O,function G(ye){U.once&&A.removeEventListener(O,G),N(ye)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof A)}}}]);
