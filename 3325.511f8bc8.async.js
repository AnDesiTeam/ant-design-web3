"use strict";(self.webpackChunk_ant_design_web3_docs=self.webpackChunk_ant_design_web3_docs||[]).push([[3325],{42392:function(qs,ae){Object.defineProperty(ae,"__esModule",{value:!0}),ae.PINO_CUSTOM_CONTEXT_KEY=ae.PINO_LOGGER_DEFAULTS=void 0,ae.PINO_LOGGER_DEFAULTS={level:"info"},ae.PINO_CUSTOM_CONTEXT_KEY="custom_context"},71315:function(qs,ae,F){Object.defineProperty(ae,"__esModule",{value:!0}),ae.pino=void 0;const xe=F(22115),ai=xe.__importDefault(F(86984));Object.defineProperty(ae,"pino",{enumerable:!0,get:function(){return ai.default}}),xe.__exportStar(F(42392),ae),xe.__exportStar(F(48992),ae)},48992:function(qs,ae,F){Object.defineProperty(ae,"__esModule",{value:!0}),ae.generateChildLogger=ae.formatChildLoggerContext=ae.getLoggerContext=ae.setBrowserLoggerContext=ae.getBrowserLoggerContext=ae.getDefaultLoggerOptions=void 0;const xe=F(42392);function ai(Se){return Object.assign(Object.assign({},Se),{level:(Se==null?void 0:Se.level)||xe.PINO_LOGGER_DEFAULTS.level})}ae.getDefaultLoggerOptions=ai;function xr(Se,nt=xe.PINO_CUSTOM_CONTEXT_KEY){return Se[nt]||""}ae.getBrowserLoggerContext=xr;function Ht(Se,nt,ot=xe.PINO_CUSTOM_CONTEXT_KEY){return Se[ot]=nt,Se}ae.setBrowserLoggerContext=Ht;function Y(Se,nt=xe.PINO_CUSTOM_CONTEXT_KEY){let ot="";return typeof Se.bindings>"u"?ot=xr(Se,nt):ot=Se.bindings().context||"",ot}ae.getLoggerContext=Y;function Nt(Se,nt,ot=xe.PINO_CUSTOM_CONTEXT_KEY){const ci=Y(Se,ot);return ci.trim()?`${ci}/${nt}`:nt}ae.formatChildLoggerContext=Nt;function js(Se,nt,ot=xe.PINO_CUSTOM_CONTEXT_KEY){const ci=Nt(Se,nt,ot),Sr=Se.child({context:ci});return Ht(Sr,ci,ot)}ae.generateChildLogger=js},83325:function(qs,ae,F){F.r(ae),F.d(ae,{UniversalProvider:function(){return ey},default:function(){return Mr}});var xe=F(72100),ai=F.n(xe),xr=F(53070),Ht=F(37875),Y=F(56526),Nt=F(36900);class js extends Nt.q{constructor(s){super(),this.opts=s,this.protocol="wc",this.version=2}}class Se{constructor(s,r,o){this.core=s,this.logger=r}}class nt extends Nt.q{constructor(s,r){super(),this.core=s,this.logger=r,this.records=new Map}}class ot{constructor(s,r){this.logger=s,this.core=r}}class ci extends Nt.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class Sr extends Nt.q{constructor(s){super()}}class Vh{constructor(s,r,o,a){this.core=s,this.logger=r,this.name=o}}class Qb{constructor(){this.map=new Map}}class Kh extends Nt.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class Yb{constructor(s,r){this.core=s,this.logger=r}}class Hh extends Nt.q{constructor(s,r){super(),this.core=s,this.logger=r}}class Zb{constructor(s,r){this.logger=s,this.core=r}}class Bh{constructor(s,r){this.projectId=s,this.logger=r}}class Gh{constructor(s,r){this.projectId=s,this.logger=r}}class Xb extends null{constructor(){super()}}class Jh{constructor(s){this.opts=s,this.protocol="wc",this.version=2}}class eE extends null{constructor(){super()}}class Wh{constructor(s){this.client=s}}var $o=F(41926),Rr=F(88614),Uo=F(11541),Qh=F(45306),Lo=F(4883),$s=F(76846),zo=F(9267),de=F(5105),Yh=F(81365),$=F(46196),Wi=F(73079),Zh=F(42669),Or=F(22501),Xh=F(35014),Us=F(14224);const Nr=":";function Mo(u){const[s,r]=u.split(Nr);return{namespace:s,reference:r}}function el(u){const{namespace:s,reference:r}=u;return[s,r].join(Nr)}function ko(u){const[s,r,o]=u.split(Nr);return{namespace:s,reference:r,address:o}}function tl(u){const{namespace:s,reference:r,address:o}=u;return[s,r,o].join(Nr)}function Vo(u,s){const r=[];return u.forEach(o=>{const a=s(o);r.includes(a)||r.push(a)}),r}function il(u){const{address:s}=ko(u);return s}function rl(u){const{namespace:s,reference:r}=ko(u);return el({namespace:s,reference:r})}function tE(u,s){const{namespace:r,reference:o}=Mo(s);return tl({namespace:r,reference:o,address:u})}function iE(u){return Vo(u,il)}function sl(u){return Vo(u,rl)}function rE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...a.accounts)}),r}function sE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...sl(a.accounts))}),r}function nE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...Ls(o,a))}),r}function Ls(u,s){return u.includes(":")?[u]:s.chains||[]}const zs=u=>u==null?void 0:u.split(":"),nl=u=>{const s=u&&zs(u);if(s)return s[3]},oE=u=>{const s=u&&zs(u);if(s)return s[2]+":"+s[3]},ol=u=>{const s=u&&zs(u);if(s)return s.pop()},aE=(u,s)=>{const r=`${u.domain} wants you to sign in with your Ethereum account:`,o=ol(s),a=u.statement,p=`URI: ${u.aud}`,g=`Version: ${u.version}`,m=`Chain ID: ${nl(s)}`,b=`Nonce: ${u.nonce}`,x=`Issued At: ${u.iat}`,N=u.resources&&u.resources.length>0?`Resources:
${u.resources.map(O=>`- ${O}`).join(`
`)}`:void 0;return[r,o,"",a,"",p,g,m,b,x,N].filter(O=>O!=null).join(`
`)},Ko="base10",Le="base16",Ms="base64pad",ks="utf8",Ho=0,ui=1,al=0,Bo=1,Vs=12,Ks=32;function cl(){const u=zo.Au();return{privateKey:(0,de.BB)(u.secretKey,Le),publicKey:(0,de.BB)(u.publicKey,Le)}}function Hs(){const u=(0,Lo.randomBytes)(Ks);return(0,de.BB)(u,Le)}function ul(u,s){const r=zo.gi((0,de.mL)(u,Le),(0,de.mL)(s,Le),!0),o=new Qh.t($s.mE,r).expand(Ks);return(0,de.BB)(o,Le)}function hl(u){const s=(0,$s.vp)((0,de.mL)(u,Le));return(0,de.BB)(s,Le)}function Ii(u){const s=(0,$s.vp)((0,de.mL)(u,ks));return(0,de.BB)(s,Le)}function ll(u){return(0,de.mL)(`${u}`,Ko)}function Qi(u){return Number((0,de.BB)(u,Ko))}function pl(u){const s=ll(typeof u.type<"u"?u.type:Ho);if(Qi(s)===ui&&typeof u.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof u.senderPublicKey<"u"?(0,de.mL)(u.senderPublicKey,Le):void 0,o=typeof u.iv<"u"?(0,de.mL)(u.iv,Le):(0,Lo.randomBytes)(Vs),a=new Uo.OK((0,de.mL)(u.symKey,Le)).seal(o,(0,de.mL)(u.message,ks));return fl({type:s,sealed:a,iv:o,senderPublicKey:r})}function dl(u){const s=new Uo.OK((0,de.mL)(u.symKey,Le)),{sealed:r,iv:o}=Cr(u.encoded),a=s.open(o,r);if(a===null)throw new Error("Failed to decrypt");return(0,de.BB)(a,ks)}function fl(u){if(Qi(u.type)===ui){if(typeof u.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,de.BB)((0,de.zo)([u.type,u.senderPublicKey,u.iv,u.sealed]),Ms)}return(0,de.BB)((0,de.zo)([u.type,u.iv,u.sealed]),Ms)}function Cr(u){const s=(0,de.mL)(u,Ms),r=s.slice(al,Bo),o=Bo;if(Qi(r)===ui){const m=o+Ks,b=m+Vs,x=s.slice(o,m),N=s.slice(m,b),O=s.slice(b);return{type:r,sealed:O,iv:N,senderPublicKey:x}}const a=o+Vs,p=s.slice(o,a),g=s.slice(a);return{type:r,sealed:g,iv:p}}function gl(u,s){const r=Cr(u);return Go({type:Qi(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?(0,de.BB)(r.senderPublicKey,Le):void 0,receiverPublicKey:s==null?void 0:s.receiverPublicKey})}function Go(u){const s=(u==null?void 0:u.type)||Ho;if(s===ui){if(typeof(u==null?void 0:u.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(u==null?void 0:u.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:s,senderPublicKey:u==null?void 0:u.senderPublicKey,receiverPublicKey:u==null?void 0:u.receiverPublicKey}}function Jo(u){return u.type===ui&&typeof u.senderPublicKey=="string"&&typeof u.receiverPublicKey=="string"}var yl=Object.defineProperty,Wo=Object.getOwnPropertySymbols,vl=Object.prototype.hasOwnProperty,ml=Object.prototype.propertyIsEnumerable,Qo=(u,s,r)=>s in u?yl(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Yo=(u,s)=>{for(var r in s||(s={}))vl.call(s,r)&&Qo(u,r,s[r]);if(Wo)for(var r of Wo(s))ml.call(s,r)&&Qo(u,r,s[r]);return u};const wl="ReactNative",Be={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Bs=" ",cE=":",_l="/",Zo=2,uE=1e3,bl="js";function Gs(){return typeof Us<"u"&&typeof Us.versions<"u"&&typeof Us.versions.node<"u"}function Pi(){return!(0,Wi.getDocument)()&&!!(0,Wi.getNavigator)()&&navigator.product===wl}function xi(){return!Gs()&&!!(0,Wi.getNavigator)()&&!!(0,Wi.getDocument)()}function Si(){return Pi()?Be.reactNative:Gs()?Be.node:xi()?Be.browser:Be.unknown}function El(){var u;try{return Pi()&&typeof F.g<"u"&&typeof(F.g==null?void 0:F.g.Application)<"u"?(u=F.g.Application)==null?void 0:u.applicationId:void 0}catch{return}}function Il(u,s){let r=Or.parse(u);return r=Yo(Yo({},r),s),u=Or.stringify(r),u}function Pl(){return(0,Zh.D)()||{name:"",description:"",url:"",icons:[""]}}function hE(u,s){var r;const o=Si(),a={protocol:u,version:s,env:o};return o==="browser"&&(a.host=((r=he())==null?void 0:r.host)||"unknown"),a}function xl(){if(Si()===Be.reactNative&&typeof F.g<"u"&&typeof(F.g==null?void 0:F.g.Platform)<"u"){const{OS:r,Version:o}=F.g.Platform;return[r,o].join("-")}const u=(0,Yh.qY)();if(u===null)return"unknown";const s=u.os?u.os.replace(" ","").toLowerCase():"unknown";return u.type==="browser"?[s,u.name,u.version].join("-"):[s,u.version].join("-")}function Sl(){var u;const s=Si();return s===Be.browser?[s,((u=(0,Wi.getLocation)())==null?void 0:u.host)||"unknown"].join(":"):s}function Rl(u,s,r){const o=xl(),a=Sl();return[[u,s].join("-"),[bl,r].join("-"),o,a].join("/")}function Ol({protocol:u,version:s,relayUrl:r,sdkVersion:o,auth:a,projectId:p,useOnCloseEvent:g,bundleId:m}){const b=r.split("?"),x=Rl(u,s,o),N={auth:a,ua:x,projectId:p,useOnCloseEvent:g||void 0,origin:m||void 0},O=Il(b[1]||"",N);return b[0]+"?"+O}function lE(u){let s=(u.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const r=typeof s<"u"?u.split("://")[1]:u;return s=s==="wss"?"https":"http",[s,r].join("://")}function pE(u,s,r){if(!u[s]||typeof u[s]!==r)throw new Error(`Missing or invalid "${s}" param`)}function Nl(u,s=Zo){return Cl(u.split(_l),s)}function dE(u){return Nl(u).join(Bs)}function hi(u,s){return u.filter(r=>s.includes(r)).length===u.length}function Cl(u,s=Zo){return u.slice(Math.max(u.length-s,0))}function Xo(u){return Object.fromEntries(u.entries())}function ea(u){return new Map(Object.entries(u))}function fE(u,s){const r={};return Object.keys(u).forEach(o=>{r[o]=s(u[o])}),r}const gE=u=>u;function Al(u){return u.trim().replace(/^\w/,s=>s.toUpperCase())}function yE(u){return u.split(Bs).map(s=>Al(s)).join(Bs)}function Ri(u=$.FIVE_MINUTES,s){const r=(0,$.toMiliseconds)(u||$.FIVE_MINUTES);let o,a,p;return{resolve:g=>{p&&o&&(clearTimeout(p),o(g))},reject:g=>{p&&a&&(clearTimeout(p),a(g))},done:()=>new Promise((g,m)=>{p=setTimeout(()=>{m(new Error(s))},r),o=g,a=m})}}function Yi(u,s,r){return new Promise(async(o,a)=>{const p=setTimeout(()=>a(new Error(r)),s);try{const g=await u;o(g)}catch(g){a(g)}clearTimeout(p)})}function ta(u,s){if(typeof s=="string"&&s.startsWith(`${u}:`))return s;if(u.toLowerCase()==="topic"){if(typeof s!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${s}`}else if(u.toLowerCase()==="id"){if(typeof s!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${s}`}throw new Error(`Unknown expirer target type: ${u}`)}function Dl(u){return ta("topic",u)}function Fl(u){return ta("id",u)}function ia(u){const[s,r]=u.split(":"),o={id:void 0,topic:void 0};if(s==="topic"&&typeof r=="string")o.topic=r;else if(s==="id"&&Number.isInteger(Number(r)))o.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${s}:${r}`);return o}function Ze(u,s){return(0,$.fromMiliseconds)((s||Date.now())+(0,$.toMiliseconds)(u))}function Bt(u){return Date.now()>=(0,$.toMiliseconds)(u)}function be(u,s){return`${u}${s?`:${s}`:""}`}function It(u=[],s=[]){return[...new Set([...u,...s])]}async function Tl({id:u,topic:s,wcDeepLink:r}){try{if(!r)return;const o=typeof r=="string"?JSON.parse(r):r;let a=o==null?void 0:o.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const p=`${a}/wc?requestId=${u}&sessionTopic=${s}`,g=Si();g===Be.browser?p.startsWith("https://")?window.open(p,"_blank","noreferrer noopener"):window.open(p,"_self","noreferrer noopener"):g===Be.reactNative&&typeof(F.g==null?void 0:F.g.Linking)<"u"&&await F.g.Linking.openURL(p)}catch(o){console.error(o)}}async function ql(u,s){try{return await u.getItem(s)||(xi()?localStorage.getItem(s):void 0)}catch(r){console.error(r)}}const jl="irn";function Js(u){return(u==null?void 0:u.relay)||{protocol:jl}}function Ar(u){const s=Xh.RELAY_JSONRPC[u];if(typeof s>"u")throw new Error(`Relay Protocol not supported: ${u}`);return s}var $l=Object.defineProperty,Ul=Object.defineProperties,Ll=Object.getOwnPropertyDescriptors,ra=Object.getOwnPropertySymbols,zl=Object.prototype.hasOwnProperty,Ml=Object.prototype.propertyIsEnumerable,sa=(u,s,r)=>s in u?$l(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,kl=(u,s)=>{for(var r in s||(s={}))zl.call(s,r)&&sa(u,r,s[r]);if(ra)for(var r of ra(s))Ml.call(s,r)&&sa(u,r,s[r]);return u},Vl=(u,s)=>Ul(u,Ll(s));function Kl(u,s="-"){const r={},o="relay"+s;return Object.keys(u).forEach(a=>{if(a.startsWith(o)){const p=a.replace(o,""),g=u[a];r[p]=g}}),r}function na(u){u=u.includes("wc://")?u.replace("wc://",""):u,u=u.includes("wc:")?u.replace("wc:",""):u;const s=u.indexOf(":"),r=u.indexOf("?")!==-1?u.indexOf("?"):void 0,o=u.substring(0,s),a=u.substring(s+1,r).split("@"),p=typeof r<"u"?u.substring(r):"",g=Or.parse(p);return{protocol:o,topic:Hl(a[0]),version:parseInt(a[1],10),symKey:g.symKey,relay:Kl(g),expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function Hl(u){return u.startsWith("//")?u.substring(2):u}function Bl(u,s="-"){const r="relay",o={};return Object.keys(u).forEach(a=>{const p=r+s+a;u[a]&&(o[p]=u[a])}),o}function Gl(u){return`${u.protocol}:${u.topic}@${u.version}?`+Or.stringify(Vl(kl({symKey:u.symKey},Bl(u.relay)),{expiryTimestamp:u.expiryTimestamp}))}var Jl=Object.defineProperty,Wl=Object.defineProperties,Ql=Object.getOwnPropertyDescriptors,oa=Object.getOwnPropertySymbols,Yl=Object.prototype.hasOwnProperty,Zl=Object.prototype.propertyIsEnumerable,aa=(u,s,r)=>s in u?Jl(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Xl=(u,s)=>{for(var r in s||(s={}))Yl.call(s,r)&&aa(u,r,s[r]);if(oa)for(var r of oa(s))Zl.call(s,r)&&aa(u,r,s[r]);return u},ep=(u,s)=>Wl(u,Ql(s));function Oi(u){const s=[];return u.forEach(r=>{const[o,a]=r.split(":");s.push(`${o}:${a}`)}),s}function tp(u){const s=[];return Object.values(u).forEach(r=>{s.push(...Oi(r.accounts))}),s}function ip(u,s){const r=[];return Object.values(u).forEach(o=>{Oi(o.accounts).includes(s)&&r.push(...o.methods)}),r}function rp(u,s){const r=[];return Object.values(u).forEach(o=>{Oi(o.accounts).includes(s)&&r.push(...o.events)}),r}function vE(u,s){const r=Tr(u,s);if(r)throw new Error(r.message);const o={};for(const[a,p]of Object.entries(u))o[a]={methods:p.methods,events:p.events,chains:p.accounts.map(g=>`${g.split(":")[0]}:${g.split(":")[1]}`)};return o}function mE(u){const{proposal:{requiredNamespaces:s,optionalNamespaces:r={}},supportedNamespaces:o}=u,a=ca(s),p=ca(r),g={};Object.keys(o).forEach(x=>{const N=o[x].chains,O=o[x].methods,j=o[x].events,ne=o[x].accounts;N.forEach(T=>{if(!ne.some(k=>k.includes(T)))throw new Error(`No accounts provided for chain ${T} in namespace ${x}`)}),g[x]={chains:N,methods:O,events:j,accounts:ne}});const m=Qs(s,g,"approve()");if(m)throw new Error(m.message);const b={};return!Object.keys(s).length&&!Object.keys(r).length?g:(Object.keys(a).forEach(x=>{const N=o[x].chains.filter(T=>{var k,W;return(W=(k=a[x])==null?void 0:k.chains)==null?void 0:W.includes(T)}),O=o[x].methods.filter(T=>{var k,W;return(W=(k=a[x])==null?void 0:k.methods)==null?void 0:W.includes(T)}),j=o[x].events.filter(T=>{var k,W;return(W=(k=a[x])==null?void 0:k.events)==null?void 0:W.includes(T)}),ne=N.map(T=>o[x].accounts.filter(k=>k.includes(`${T}:`))).flat();b[x]={chains:N,methods:O,events:j,accounts:ne}}),Object.keys(p).forEach(x=>{var N,O,j,ne,T,k;if(!o[x])return;const W=(O=(N=p[x])==null?void 0:N.chains)==null?void 0:O.filter(ie=>o[x].chains.includes(ie)),ce=o[x].methods.filter(ie=>{var G,ye;return(ye=(G=p[x])==null?void 0:G.methods)==null?void 0:ye.includes(ie)}),De=o[x].events.filter(ie=>{var G,ye;return(ye=(G=p[x])==null?void 0:G.events)==null?void 0:ye.includes(ie)}),le=W==null?void 0:W.map(ie=>o[x].accounts.filter(G=>G.includes(`${ie}:`))).flat();b[x]={chains:It((j=b[x])==null?void 0:j.chains,W),methods:It((ne=b[x])==null?void 0:ne.methods,ce),events:It((T=b[x])==null?void 0:T.events,De),accounts:It((k=b[x])==null?void 0:k.accounts,le)}}),b)}function Dr(u){return u.includes(":")}function Ni(u){return Dr(u)?u.split(":")[0]:u}function ca(u){var s,r,o;const a={};if(!Ci(u))return a;for(const[p,g]of Object.entries(u)){const m=Dr(p)?[p]:g.chains,b=g.methods||[],x=g.events||[],N=Ni(p);a[N]=ep(Xl({},a[N]),{chains:It(m,(s=a[N])==null?void 0:s.chains),methods:It(b,(r=a[N])==null?void 0:r.methods),events:It(x,(o=a[N])==null?void 0:o.events)})}return a}const sp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},np={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function C(u,s){const{message:r,code:o}=np[u];return{message:s?`${r} ${s}`:r,code:o}}function me(u,s){const{message:r,code:o}=sp[u];return{message:s?`${r} ${s}`:r,code:o}}function li(u,s){return Array.isArray(u)?typeof s<"u"&&u.length?u.every(s):!0:!1}function Ci(u){return Object.getPrototypeOf(u)===Object.prototype&&Object.keys(u).length}function ze(u){return typeof u>"u"}function Ne(u,s){return s&&ze(u)?!0:typeof u=="string"&&!!u.trim().length}function Ws(u,s){return s&&ze(u)?!0:typeof u=="number"&&!isNaN(u)}function op(u,s){const{requiredNamespaces:r}=s,o=Object.keys(u.namespaces),a=Object.keys(r);let p=!0;return hi(a,o)?(o.forEach(g=>{const{accounts:m,methods:b,events:x}=u.namespaces[g],N=Oi(m),O=r[g];(!hi(Ls(g,O),N)||!hi(O.methods,b)||!hi(O.events,x))&&(p=!1)}),p):!1}function Fr(u){return Ne(u,!1)&&u.includes(":")?u.split(":").length===2:!1}function ap(u){if(Ne(u,!1)&&u.includes(":")){const s=u.split(":");if(s.length===3){const r=s[0]+":"+s[1];return!!s[2]&&Fr(r)}}return!1}function cp(u){if(Ne(u,!1))try{return typeof new URL(u)<"u"}catch{return!1}return!1}function up(u){var s;return(s=u==null?void 0:u.proposer)==null?void 0:s.publicKey}function hp(u){return u==null?void 0:u.topic}function lp(u,s){let r=null;return Ne(u==null?void 0:u.publicKey,!1)||(r=C("MISSING_OR_INVALID",`${s} controller public key should be a string`)),r}function ua(u){let s=!0;return li(u)?u.length&&(s=u.every(r=>Ne(r,!1))):s=!1,s}function pp(u,s,r){let o=null;return li(s)&&s.length?s.forEach(a=>{o||Fr(a)||(o=me("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Fr(u)||(o=me("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),o}function dp(u,s,r){let o=null;return Object.entries(u).forEach(([a,p])=>{if(o)return;const g=pp(a,Ls(a,p),`${s} ${r}`);g&&(o=g)}),o}function fp(u,s){let r=null;return li(u)?u.forEach(o=>{r||ap(o)||(r=me("UNSUPPORTED_ACCOUNTS",`${s}, account ${o} should be a string and conform to "namespace:chainId:address" format`))}):r=me("UNSUPPORTED_ACCOUNTS",`${s}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function gp(u,s){let r=null;return Object.values(u).forEach(o=>{if(r)return;const a=fp(o==null?void 0:o.accounts,`${s} namespace`);a&&(r=a)}),r}function yp(u,s){let r=null;return ua(u==null?void 0:u.methods)?ua(u==null?void 0:u.events)||(r=me("UNSUPPORTED_EVENTS",`${s}, events should be an array of strings or empty array for no events`)):r=me("UNSUPPORTED_METHODS",`${s}, methods should be an array of strings or empty array for no methods`),r}function ha(u,s){let r=null;return Object.values(u).forEach(o=>{if(r)return;const a=yp(o,`${s}, namespace`);a&&(r=a)}),r}function vp(u,s,r){let o=null;if(u&&Ci(u)){const a=ha(u,s);a&&(o=a);const p=dp(u,s,r);p&&(o=p)}else o=C("MISSING_OR_INVALID",`${s}, ${r} should be an object with data`);return o}function Tr(u,s){let r=null;if(u&&Ci(u)){const o=ha(u,s);o&&(r=o);const a=gp(u,s);a&&(r=a)}else r=C("MISSING_OR_INVALID",`${s}, namespaces should be an object with data`);return r}function la(u){return Ne(u.protocol,!0)}function mp(u,s){let r=!1;return s&&!u?r=!0:u&&li(u)&&u.length&&u.forEach(o=>{r=la(o)}),r}function wp(u){return typeof u=="number"}function Ge(u){return typeof u<"u"&&typeof u!==null}function _p(u){return!(!u||typeof u!="object"||!u.code||!Ws(u.code,!1)||!u.message||!Ne(u.message,!1))}function bp(u){return!(ze(u)||!Ne(u.method,!1))}function Ep(u){return!(ze(u)||ze(u.result)&&ze(u.error)||!Ws(u.id,!1)||!Ne(u.jsonrpc,!1))}function Ip(u){return!(ze(u)||!Ne(u.name,!1))}function pa(u,s){return!(!Fr(s)||!tp(u).includes(s))}function Pp(u,s,r){return Ne(r,!1)?ip(u,s).includes(r):!1}function xp(u,s,r){return Ne(r,!1)?rp(u,s).includes(r):!1}function Qs(u,s,r){let o=null;const a=Sp(u),p=Rp(s),g=Object.keys(a),m=Object.keys(p),b=da(Object.keys(u)),x=da(Object.keys(s)),N=b.filter(O=>!x.includes(O));return N.length&&(o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${N.toString()}
      Received: ${Object.keys(s).toString()}`)),hi(g,m)||(o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${g.toString()}
      Approved: ${m.toString()}`)),Object.keys(s).forEach(O=>{if(!O.includes(":")||o)return;const j=Oi(s[O].accounts);j.includes(O)||(o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${j.toString()}`))}),g.forEach(O=>{o||(hi(a[O].methods,p[O].methods)?hi(a[O].events,p[O].events)||(o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${O}`)):o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${O}`))}),o}function Sp(u){const s={};return Object.keys(u).forEach(r=>{var o;r.includes(":")?s[r]=u[r]:(o=u[r].chains)==null||o.forEach(a=>{s[a]={methods:u[r].methods,events:u[r].events}})}),s}function da(u){return[...new Set(u.map(s=>s.includes(":")?s.split(":")[0]:s))]}function Rp(u){const s={};return Object.keys(u).forEach(r=>{if(r.includes(":"))s[r]=u[r];else{const o=Oi(u[r].accounts);o==null||o.forEach(a=>{s[a]={accounts:u[r].accounts.filter(p=>p.includes(`${a}:`)),methods:u[r].methods,events:u[r].events}})}}),s}function Op(u,s){return Ws(u,!1)&&u<=s.max&&u>=s.min}function fa(){const u=Si();return new Promise(s=>{switch(u){case Be.browser:s(Np());break;case Be.reactNative:s(Cp());break;case Be.node:s(Ap());break;default:s(!0)}})}function Np(){return xi()&&(navigator==null?void 0:navigator.onLine)}async function Cp(){if(Pi()&&typeof F.g<"u"&&F.g!=null&&F.g.NetInfo){const u=await(F.g==null?void 0:F.g.NetInfo.fetch());return u==null?void 0:u.isConnected}return!0}function Ap(){return!0}function Dp(u){switch(Si()){case Be.browser:Fp(u);break;case Be.reactNative:Tp(u);break;case Be.node:break}}function Fp(u){!Pi()&&xi()&&(window.addEventListener("online",()=>u(!0)),window.addEventListener("offline",()=>u(!1)))}function Tp(u){var s;Pi()&&typeof F.g<"u"&&F.g!=null&&F.g.NetInfo&&((s=F.g)==null||s.NetInfo.addEventListener(r=>u(r==null?void 0:r.isConnected)))}const Ys={};class qr{static get(s){return Ys[s]}static set(s,r){Ys[s]=r}static delete(s){delete Ys[s]}}var Ct=F(83102),Z=F(23700),qp=F(66865),jp=F(5899),$p=F.n(jp),Up=F(51538),Lp=F.n(Up);function zp(u,s){if(u.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),o=0;o<r.length;o++)r[o]=255;for(var a=0;a<u.length;a++){var p=u.charAt(a),g=p.charCodeAt(0);if(r[g]!==255)throw new TypeError(p+" is ambiguous");r[g]=a}var m=u.length,b=u.charAt(0),x=Math.log(m)/Math.log(256),N=Math.log(256)/Math.log(m);function O(T){if(T instanceof Uint8Array||(ArrayBuffer.isView(T)?T=new Uint8Array(T.buffer,T.byteOffset,T.byteLength):Array.isArray(T)&&(T=Uint8Array.from(T))),!(T instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(T.length===0)return"";for(var k=0,W=0,ce=0,De=T.length;ce!==De&&T[ce]===0;)ce++,k++;for(var le=(De-ce)*N+1>>>0,ie=new Uint8Array(le);ce!==De;){for(var G=T[ce],ye=0,Ee=le-1;(G!==0||ye<W)&&Ee!==-1;Ee--,ye++)G+=256*ie[Ee]>>>0,ie[Ee]=G%m>>>0,G=G/m>>>0;if(G!==0)throw new Error("Non-zero carry");W=ye,ce++}for(var ke=le-W;ke!==le&&ie[ke]===0;)ke++;for(var Qt=b.repeat(k);ke<le;++ke)Qt+=u.charAt(ie[ke]);return Qt}function j(T){if(typeof T!="string")throw new TypeError("Expected String");if(T.length===0)return new Uint8Array;var k=0;if(T[k]!==" "){for(var W=0,ce=0;T[k]===b;)W++,k++;for(var De=(T.length-k)*x+1>>>0,le=new Uint8Array(De);T[k];){var ie=r[T.charCodeAt(k)];if(ie===255)return;for(var G=0,ye=De-1;(ie!==0||G<ce)&&ye!==-1;ye--,G++)ie+=m*le[ye]>>>0,le[ye]=ie%256>>>0,ie=ie/256>>>0;if(ie!==0)throw new Error("Non-zero carry");ce=G,k++}if(T[k]!==" "){for(var Ee=De-ce;Ee!==De&&le[Ee]===0;)Ee++;for(var ke=new Uint8Array(W+(De-Ee)),Qt=W;Ee!==De;)ke[Qt++]=le[Ee++];return ke}}}function ne(T){var k=j(T);if(k)return k;throw new Error(`Non-${s} character`)}return{encode:O,decodeUnsafe:j,decode:ne}}var Mp=zp,kp=Mp;const ga=u=>{if(u instanceof Uint8Array&&u.constructor.name==="Uint8Array")return u;if(u instanceof ArrayBuffer)return new Uint8Array(u);if(ArrayBuffer.isView(u))return new Uint8Array(u.buffer,u.byteOffset,u.byteLength);throw new Error("Unknown type, must be binary type")},Vp=u=>new TextEncoder().encode(u),Kp=u=>new TextDecoder().decode(u);class Hp{constructor(s,r,o){this.name=s,this.prefix=r,this.baseEncode=o}encode(s){if(s instanceof Uint8Array)return`${this.prefix}${this.baseEncode(s)}`;throw Error("Unknown type, must be binary type")}}class Bp{constructor(s,r,o){if(this.name=s,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=o}decode(s){if(typeof s=="string"){if(s.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(s)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(s.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(s){return ya(this,s)}}class Gp{constructor(s){this.decoders=s}or(s){return ya(this,s)}decode(s){const r=s[0],o=this.decoders[r];if(o)return o.decode(s);throw RangeError(`Unable to decode multibase string ${JSON.stringify(s)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ya=(u,s)=>new Gp({...u.decoders||{[u.prefix]:u},...s.decoders||{[s.prefix]:s}});class Jp{constructor(s,r,o,a){this.name=s,this.prefix=r,this.baseEncode=o,this.baseDecode=a,this.encoder=new Hp(s,r,o),this.decoder=new Bp(s,r,a)}encode(s){return this.encoder.encode(s)}decode(s){return this.decoder.decode(s)}}const jr=({name:u,prefix:s,encode:r,decode:o})=>new Jp(u,s,r,o),Zi=({prefix:u,name:s,alphabet:r})=>{const{encode:o,decode:a}=kp(r,s);return jr({prefix:u,name:s,encode:o,decode:p=>ga(a(p))})},Wp=(u,s,r,o)=>{const a={};for(let N=0;N<s.length;++N)a[s[N]]=N;let p=u.length;for(;u[p-1]==="=";)--p;const g=new Uint8Array(p*r/8|0);let m=0,b=0,x=0;for(let N=0;N<p;++N){const O=a[u[N]];if(O===void 0)throw new SyntaxError(`Non-${o} character`);b=b<<r|O,m+=r,m>=8&&(m-=8,g[x++]=255&b>>m)}if(m>=r||255&b<<8-m)throw new SyntaxError("Unexpected end of data");return g},Qp=(u,s,r)=>{const o=s[s.length-1]==="=",a=(1<<r)-1;let p="",g=0,m=0;for(let b=0;b<u.length;++b)for(m=m<<8|u[b],g+=8;g>r;)g-=r,p+=s[a&m>>g];if(g&&(p+=s[a&m<<r-g]),o)for(;p.length*r&7;)p+="=";return p},Ae=({name:u,prefix:s,bitsPerChar:r,alphabet:o})=>jr({prefix:s,name:u,encode(a){return Qp(a,o,r)},decode(a){return Wp(a,o,r,u)}}),Yp=jr({prefix:"\0",name:"identity",encode:u=>Kp(u),decode:u=>Vp(u)});var Zp=Object.freeze({__proto__:null,identity:Yp});const Xp=Ae({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ed=Object.freeze({__proto__:null,base2:Xp});const td=Ae({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var id=Object.freeze({__proto__:null,base8:td});const rd=Zi({prefix:"9",name:"base10",alphabet:"0123456789"});var sd=Object.freeze({__proto__:null,base10:rd});const nd=Ae({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),od=Ae({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ad=Object.freeze({__proto__:null,base16:nd,base16upper:od});const cd=Ae({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ud=Ae({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),hd=Ae({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ld=Ae({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pd=Ae({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),dd=Ae({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),fd=Ae({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),gd=Ae({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),yd=Ae({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var vd=Object.freeze({__proto__:null,base32:cd,base32upper:ud,base32pad:hd,base32padupper:ld,base32hex:pd,base32hexupper:dd,base32hexpad:fd,base32hexpadupper:gd,base32z:yd});const md=Zi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wd=Zi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var _d=Object.freeze({__proto__:null,base36:md,base36upper:wd});const bd=Zi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ed=Zi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Id=Object.freeze({__proto__:null,base58btc:bd,base58flickr:Ed});const Pd=Ae({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xd=Ae({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Sd=Ae({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Rd=Ae({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Od=Object.freeze({__proto__:null,base64:Pd,base64pad:xd,base64url:Sd,base64urlpad:Rd});const va=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Nd=va.reduce((u,s,r)=>(u[r]=s,u),[]),Cd=va.reduce((u,s,r)=>(u[s.codePointAt(0)]=r,u),[]);function Ad(u){return u.reduce((s,r)=>(s+=Nd[r],s),"")}function Dd(u){const s=[];for(const r of u){const o=Cd[r.codePointAt(0)];if(o===void 0)throw new Error(`Non-base256emoji character: ${r}`);s.push(o)}return new Uint8Array(s)}const Fd=jr({prefix:"\u{1F680}",name:"base256emoji",encode:Ad,decode:Dd});var Td=Object.freeze({__proto__:null,base256emoji:Fd}),qd=wa,ma=128,jd=127,$d=~jd,Ud=Math.pow(2,31);function wa(u,s,r){s=s||[],r=r||0;for(var o=r;u>=Ud;)s[r++]=u&255|ma,u/=128;for(;u&$d;)s[r++]=u&255|ma,u>>>=7;return s[r]=u|0,wa.bytes=r-o+1,s}var Ld=Zs,zd=128,_a=127;function Zs(u,o){var r=0,o=o||0,a=0,p=o,g,m=u.length;do{if(p>=m)throw Zs.bytes=0,new RangeError("Could not decode varint");g=u[p++],r+=a<28?(g&_a)<<a:(g&_a)*Math.pow(2,a),a+=7}while(g>=zd);return Zs.bytes=p-o,r}var Md=Math.pow(2,7),kd=Math.pow(2,14),Vd=Math.pow(2,21),Kd=Math.pow(2,28),Hd=Math.pow(2,35),Bd=Math.pow(2,42),Gd=Math.pow(2,49),Jd=Math.pow(2,56),Wd=Math.pow(2,63),Qd=function(u){return u<Md?1:u<kd?2:u<Vd?3:u<Kd?4:u<Hd?5:u<Bd?6:u<Gd?7:u<Jd?8:u<Wd?9:10},Yd={encode:qd,decode:Ld,encodingLength:Qd},ba=Yd;const Ea=(u,s,r=0)=>(ba.encode(u,s,r),s),Ia=u=>ba.encodingLength(u),Xs=(u,s)=>{const r=s.byteLength,o=Ia(u),a=o+Ia(r),p=new Uint8Array(a+r);return Ea(u,p,0),Ea(r,p,o),p.set(s,a),new Zd(u,r,s,p)};class Zd{constructor(s,r,o,a){this.code=s,this.size=r,this.digest=o,this.bytes=a}}const Pa=({name:u,code:s,encode:r})=>new Xd(u,s,r);class Xd{constructor(s,r,o){this.name=s,this.code=r,this.encode=o}digest(s){if(s instanceof Uint8Array){const r=this.encode(s);return r instanceof Uint8Array?Xs(this.code,r):r.then(o=>Xs(this.code,o))}else throw Error("Unknown type, must be binary type")}}const xa=u=>async s=>new Uint8Array(await crypto.subtle.digest(u,s)),ef=Pa({name:"sha2-256",code:18,encode:xa("SHA-256")}),tf=Pa({name:"sha2-512",code:19,encode:xa("SHA-512")});var rf=Object.freeze({__proto__:null,sha256:ef,sha512:tf});const Sa=0,sf="identity",Ra=ga;var nf=Object.freeze({__proto__:null,identity:{code:Sa,name:sf,encode:Ra,digest:u=>Xs(Sa,Ra(u))}});new TextEncoder,new TextDecoder;const Oa={...Zp,...ed,...id,...sd,...ad,...vd,..._d,...Id,...Od,...Td};({...rf,...nf});function Na(u){return globalThis.Buffer!=null?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):u}function of(u=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Na(globalThis.Buffer.allocUnsafe(u)):new Uint8Array(u)}function Ca(u,s,r,o){return{name:u,prefix:s,encoder:{name:u,prefix:s,encode:r},decoder:{decode:o}}}const Aa=Ca("utf8","u",u=>"u"+new TextDecoder("utf8").decode(u),u=>new TextEncoder().encode(u.substring(1))),en=Ca("ascii","a",u=>{let s="a";for(let r=0;r<u.length;r++)s+=String.fromCharCode(u[r]);return s},u=>{u=u.substring(1);const s=of(u.length);for(let r=0;r<u.length;r++)s[r]=u.charCodeAt(r);return s}),af={utf8:Aa,"utf-8":Aa,hex:Oa.base16,latin1:en,ascii:en,binary:en,...Oa};function cf(u,s="utf8"){const r=af[s];if(!r)throw new Error(`Unsupported encoding "${s}"`);return(s==="utf8"||s==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Na(globalThis.Buffer.from(u,"utf-8")):r.decoder.decode(`${r.prefix}${u}`)}const Da="wc",uf=2,tn="core",Gt=`${Da}@2:${tn}:`,hf={name:tn,logger:"error"},lf={database:":memory:"},pf="crypto",Fa="client_ed25519_seed",df=$.ONE_DAY,ff="keychain",gf="0.3",yf="messages",vf="0.3",mf=$.SIX_HOURS,wf="publisher",Ta="irn",_f="error",qa="wss://relay.walletconnect.com",ja="wss://relay.walletconnect.org",bf="relayer",je={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Ef="_subscription",At={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},If=$.ONE_SECOND,bE={database:":memory:"},Pf="2.11.2",xf=1e4,Sf="0.3",Rf="WALLETCONNECT_CLIENT_ID",yt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},EE=null,Of="subscription",Nf="0.3",Cf=$.FIVE_SECONDS*1e3,Af="pairing",Df="0.3",IE=null,Xi={wc_pairingDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:$.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:$.ONE_DAY,prompt:!1,tag:0},res:{ttl:$.ONE_DAY,prompt:!1,tag:0}}},er={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Pt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Ff="history",Tf="0.3",qf="expirer",at={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},jf="0.3",PE=null,rn="verify-api",Ai="https://verify.walletconnect.com",sn="https://verify.walletconnect.org",$f=[Ai,sn],Uf="echo",Lf="https://echo.walletconnect.com";class zf{constructor(s,r){this.core=s,this.logger=r,this.keychain=new Map,this.name=ff,this.version=gf,this.initialized=!1,this.storagePrefix=Gt,this.init=async()=>{if(!this.initialized){const o=await this.getKeyChain();typeof o<"u"&&(this.keychain=o),this.initialized=!0}},this.has=o=>(this.isInitialized(),this.keychain.has(o)),this.set=async(o,a)=>{this.isInitialized(),this.keychain.set(o,a),await this.persist()},this.get=o=>{this.isInitialized();const a=this.keychain.get(o);if(typeof a>"u"){const{message:p}=C("NO_MATCHING_KEY",`${this.name}: ${o}`);throw new Error(p)}return a},this.del=async o=>{this.isInitialized(),this.keychain.delete(o),await this.persist()},this.core=s,this.logger=(0,Y.Ep)(r,this.name)}get context(){return(0,Y.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(s){await this.core.storage.setItem(this.storageKey,Xo(s))}async getKeyChain(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?ea(s):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Mf{constructor(s,r,o){this.core=s,this.logger=r,this.name=pf,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),p=Rr.generateKeyPair(a);return Rr.encodeIss(p.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=cl();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const p=await this.getClientSeed(),g=Rr.generateKeyPair(p),m=Hs(),b=df;return await Rr.signJWT(m,a,b,g)},this.generateSharedKey=(a,p,g)=>{this.isInitialized();const m=this.getPrivateKey(a),b=ul(m,p);return this.setSymKey(b,g)},this.setSymKey=async(a,p)=>{this.isInitialized();const g=p||hl(a);return await this.keychain.set(g,a),g},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,p,g)=>{this.isInitialized();const m=Go(g),b=(0,$o.u)(p);if(Jo(m)){const j=m.senderPublicKey,ne=m.receiverPublicKey;a=await this.generateSharedKey(j,ne)}const x=this.getSymKey(a),{type:N,senderPublicKey:O}=m;return pl({type:N,symKey:x,message:b,senderPublicKey:O})},this.decode=async(a,p,g)=>{this.isInitialized();const m=gl(p,g);if(Jo(m)){const b=m.receiverPublicKey,x=m.senderPublicKey;a=await this.generateSharedKey(b,x)}try{const b=this.getSymKey(a),x=dl({symKey:b,encoded:p});return(0,$o.D)(x)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}},this.getPayloadType=a=>{const p=Cr(a);return Qi(p.type)},this.getPayloadSenderPublicKey=a=>{const p=Cr(a);return p.senderPublicKey?(0,de.BB)(p.senderPublicKey,Le):void 0},this.core=s,this.logger=(0,Y.Ep)(r,this.name),this.keychain=o||new zf(this.core,this.logger)}get context(){return(0,Y.Fd)(this.logger)}async setPrivateKey(s,r){return await this.keychain.set(s,r),s}getPrivateKey(s){return this.keychain.get(s)}async getClientSeed(){let s="";try{s=this.keychain.get(Fa)}catch{s=Hs(),await this.keychain.set(Fa,s)}return cf(s,"base16")}getSymKey(s){return this.keychain.get(s)}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class kf extends ot{constructor(s,r){super(s,r),this.logger=s,this.core=r,this.messages=new Map,this.name=yf,this.version=vf,this.initialized=!1,this.storagePrefix=Gt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const o=await this.getRelayerMessages();typeof o<"u"&&(this.messages=o),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(o){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(o)}finally{this.initialized=!0}}},this.set=async(o,a)=>{this.isInitialized();const p=Ii(a);let g=this.messages.get(o);return typeof g>"u"&&(g={}),typeof g[p]<"u"||(g[p]=a,this.messages.set(o,g),await this.persist()),p},this.get=o=>{this.isInitialized();let a=this.messages.get(o);return typeof a>"u"&&(a={}),a},this.has=(o,a)=>{this.isInitialized();const p=this.get(o),g=Ii(a);return typeof p[g]<"u"},this.del=async o=>{this.isInitialized(),this.messages.delete(o),await this.persist()},this.logger=(0,Y.Ep)(s,this.name),this.core=r}get context(){return(0,Y.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(s){await this.core.storage.setItem(this.storageKey,Xo(s))}async getRelayerMessages(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?ea(s):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Vf extends ci{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.events=new xe.EventEmitter,this.name=wf,this.queue=new Map,this.publishTimeout=(0,$.toMiliseconds)($.TEN_SECONDS*2),this.needsTransportRestart=!1,this.publish=async(o,a,p)=>{var g;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:p}});try{const m=(p==null?void 0:p.ttl)||mf,b=Js(p),x=(p==null?void 0:p.prompt)||!1,N=(p==null?void 0:p.tag)||0,O=(p==null?void 0:p.id)||(0,Z.getBigIntRpcId)().toString(),j={topic:o,message:a,opts:{ttl:m,relay:b,prompt:x,tag:N,id:O}},ne=setTimeout(()=>this.queue.set(O,j),this.publishTimeout);try{await await Yi(this.rpcPublish(o,a,m,b,x,N,O),this.publishTimeout,`Failed to publish payload, please try again. id:${O} tag:${N}`),this.removeRequestFromQueue(O),this.relayer.events.emit(je.publish,j)}catch(T){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(g=p==null?void 0:p.internal)!=null&&g.throwOnFailedPublish)throw this.removeRequestFromQueue(O),T;return}finally{clearTimeout(ne)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:p}})}catch(m){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(m),m}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.relayer=s,this.logger=(0,Y.Ep)(r,this.name),this.registerEventListeners()}get context(){return(0,Y.Fd)(this.logger)}rpcPublish(s,r,o,a,p,g,m){var b,x,N,O;const j={method:Ar(a.protocol).publish,params:{topic:s,message:r,ttl:o,prompt:p,tag:g},id:m};return ze((b=j.params)==null?void 0:b.prompt)&&((x=j.params)==null||delete x.prompt),ze((N=j.params)==null?void 0:N.tag)&&((O=j.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:j}),this.relayer.request(j)}removeRequestFromQueue(s){this.queue.delete(s)}checkQueue(){this.queue.forEach(async s=>{const{topic:r,message:o,opts:a}=s;await this.publish(r,o,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ht.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(je.connection_stalled);return}this.checkQueue()}),this.relayer.on(je.message_ack,s=>{this.removeRequestFromQueue(s.id.toString())})}}class Kf{constructor(){this.map=new Map,this.set=(s,r)=>{const o=this.get(s);this.exists(s,r)||this.map.set(s,[...o,r])},this.get=s=>this.map.get(s)||[],this.exists=(s,r)=>this.get(s).includes(r),this.delete=(s,r)=>{if(typeof r>"u"){this.map.delete(s);return}if(!this.map.has(s))return;const o=this.get(s);if(!this.exists(s,r))return;const a=o.filter(p=>p!==r);if(!a.length){this.map.delete(s);return}this.map.set(s,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Hf=Object.defineProperty,Bf=Object.defineProperties,Gf=Object.getOwnPropertyDescriptors,$a=Object.getOwnPropertySymbols,Jf=Object.prototype.hasOwnProperty,Wf=Object.prototype.propertyIsEnumerable,Ua=(u,s,r)=>s in u?Hf(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,tr=(u,s)=>{for(var r in s||(s={}))Jf.call(s,r)&&Ua(u,r,s[r]);if($a)for(var r of $a(s))Wf.call(s,r)&&Ua(u,r,s[r]);return u},nn=(u,s)=>Bf(u,Gf(s));class Qf extends Kh{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.subscriptions=new Map,this.topicMap=new Kf,this.events=new xe.EventEmitter,this.name=Of,this.version=Nf,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Gt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const p=Js(a),g={topic:o,relay:p};this.pending.set(o,g);const m=await this.rpcSubscribe(o,p);return this.onSubscribe(m,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}}),m}catch(p){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(p),p}},this.unsubscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(o,a.id,a):await this.unsubscribeByTopic(o,a)},this.isSubscribed=async o=>{if(this.topics.includes(o))return!0;const a=`${this.pendingSubscriptionWatchLabel}_${o}`;return await new Promise((p,g)=>{const m=new $.Watch;m.start(a);const b=setInterval(()=>{!this.pending.has(o)&&this.topics.includes(o)&&(clearInterval(b),m.stop(a),p(!0)),m.elapsed(a)>=Cf&&(clearInterval(b),m.stop(a),g(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=s,this.logger=(0,Y.Ep)(r,this.name),this.clientId=""}get context(){return(0,Y.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(s,r){let o=!1;try{o=this.getSubscription(s).topic===r}catch{}return o}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(s,r){const o=this.topicMap.get(s);await Promise.all(o.map(async a=>await this.unsubscribeById(s,a,r)))}async unsubscribeById(s,r,o){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}});try{const a=Js(o);await this.rpcUnsubscribe(s,r,a);const p=me("USER_DISCONNECTED",`${this.name}, ${s}`);await this.onUnsubscribe(s,r,p),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(s,r){const o={method:Ar(r.protocol).subscribe,params:{topic:s}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{await await Yi(this.relayer.request(o),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(je.connection_stalled)}return Ii(s+this.clientId)}async rpcBatchSubscribe(s){if(!s.length)return;const r=s[0].relay,o={method:Ar(r.protocol).batchSubscribe,params:{topics:s.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await Yi(this.relayer.request(o),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(je.connection_stalled)}}rpcUnsubscribe(s,r,o){const a={method:Ar(o.protocol).unsubscribe,params:{topic:s,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(s,r){this.setSubscription(s,nn(tr({},r),{id:s})),this.pending.delete(r.topic)}onBatchSubscribe(s){s.length&&s.forEach(r=>{this.setSubscription(r.id,tr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(s,r,o){this.events.removeAllListeners(r),this.hasSubscription(r,s)&&this.deleteSubscription(r,o),await this.relayer.messages.del(s)}async setRelayerSubscriptions(s){await this.relayer.core.storage.setItem(this.storageKey,s)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(s,r){this.subscriptions.has(s)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:s,subscription:r}),this.addSubscription(s,r))}addSubscription(s,r){this.subscriptions.set(s,tr({},r)),this.topicMap.set(r.topic,s),this.events.emit(yt.created,r)}getSubscription(s){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:s});const r=this.subscriptions.get(s);if(!r){const{message:o}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}deleteSubscription(s,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:s,reason:r});const o=this.getSubscription(s);this.subscriptions.delete(s),this.topicMap.delete(o.topic,s),this.events.emit(yt.deleted,nn(tr({},o),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(yt.sync)}async reset(){if(this.cached.length){const s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<s;r++){const o=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(o)}}this.events.emit(yt.resubscribed)}async restore(){try{const s=await this.getRelayerSubscriptions();if(typeof s>"u"||!s.length)return;if(this.subscriptions.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(s){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(s)}}async batchSubscribe(s){if(!s.length)return;const r=await this.rpcBatchSubscribe(s);li(r)&&this.onBatchSubscribe(r.map((o,a)=>nn(tr({},s[a]),{id:o})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const s=[];this.pending.forEach(r=>{s.push(r)}),await this.batchSubscribe(s)}registerEventListeners(){this.relayer.core.heartbeat.on(Ht.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(je.connect,async()=>{await this.onConnect()}),this.relayer.on(je.disconnect,()=>{this.onDisconnect()}),this.events.on(yt.created,async s=>{const r=yt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()}),this.events.on(yt.deleted,async s=>{const r=yt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}async restartToComplete(){this.restartInProgress&&await new Promise(s=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),s())},this.pollingInterval)})}}var Yf=Object.defineProperty,La=Object.getOwnPropertySymbols,Zf=Object.prototype.hasOwnProperty,Xf=Object.prototype.propertyIsEnumerable,za=(u,s,r)=>s in u?Yf(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,eg=(u,s)=>{for(var r in s||(s={}))Zf.call(s,r)&&za(u,r,s[r]);if(La)for(var r of La(s))Xf.call(s,r)&&za(u,r,s[r]);return u};class tg extends Sr{constructor(s){super(s),this.protocol="wc",this.version=2,this.events=new xe.EventEmitter,this.name=bf,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.request=async r=>{this.logger.debug("Publishing Request Payload");const o=r.id;try{await this.toEstablishConnection();const a=this.provider.request(r);return this.requestsInFlight.set(o,{promise:a,request:r}),await a}catch(a){throw this.logger.debug("Failed to Publish Request"),this.logger.error(a),a}finally{this.requestsInFlight.delete(o)}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(je.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(je.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(At.payload,this.onPayloadHandler),this.provider.on(At.connect,this.onConnectHandler),this.provider.on(At.disconnect,this.onDisconnectHandler),this.provider.on(At.error,this.onProviderErrorHandler)},this.core=s.core,this.logger=typeof s.logger<"u"&&typeof s.logger!="string"?(0,Y.Ep)(s.logger,this.name):(0,Y.gw)((0,Y.jI)({level:s.logger||_f})),this.messages=new kf(this.logger,s.core),this.subscriber=new Qf(this,this.logger),this.publisher=new Vf(this,this.logger),this.relayUrl=(s==null?void 0:s.relayUrl)||qa,this.projectId=s.projectId,this.bundleId=El(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ja}...`),await this.restartTransport(ja)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},xf)}get context(){return(0,Y.Fd)(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(s,r,o){this.isInitialized(),await this.publisher.publish(s,r,o),await this.recordMessageEvent({topic:s,message:r,publishedAt:Date.now()})}async subscribe(s,r){var o;this.isInitialized();let a=((o=this.subscriber.topicMap.get(s))==null?void 0:o[0])||"";if(a)return a;let p;const g=m=>{m.topic===s&&(this.subscriber.off(yt.created,g),p())};return await Promise.all([new Promise(m=>{p=m,this.subscriber.on(yt.created,g)}),new Promise(async m=>{a=await this.subscriber.subscribe(s,r),m()})]),a}async unsubscribe(s,r){this.isInitialized(),await this.subscriber.unsubscribe(s,r)}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}off(s,r){this.events.off(s,r)}removeListener(s,r){this.events.removeListener(s,r)}async transportClose(){this.requestsInFlight.size>0&&(this.logger.debug("Waiting for all in-flight requests to finish before closing transport..."),this.requestsInFlight.forEach(async s=>{await s.promise})),this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Yi(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(s){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){s&&s!==this.relayUrl&&(this.relayUrl=s,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(yt.resubscribed,()=>{r()})}),new Promise(async(r,o)=>{try{await Yi(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){o(a);return}r()})])}catch(r){this.logger.error(r);const o=r;if(!this.isConnectionStalled(o.message))throw r;this.provider.events.emit(At.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(s){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=s||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await fa())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(s){return this.staleConnectionErrors.some(r=>s.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const s=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ct.r(new qp.Z(Ol({sdkVersion:Pf,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:s,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(s){const{topic:r,message:o}=s;await this.messages.set(r,o)}async shouldIgnoreMessageEvent(s){const{topic:r,message:o}=s;if(!o||o.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${o}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,o);return a&&this.logger.debug(`Ignoring duplicate message: ${o}`),a}async onProviderPayload(s){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:s}),(0,Z.isJsonRpcRequest)(s)){if(!s.method.endsWith(Ef))return;const r=s.params,{topic:o,message:a,publishedAt:p}=r.data,g={topic:o,message:a,publishedAt:p};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(eg({type:"event",event:r.id},g)),this.events.emit(r.id,g),await this.acknowledgePayload(s),await this.onMessageEvent(g)}else(0,Z.isJsonRpcResponse)(s)&&this.events.emit(je.message_ack,s)}async onMessageEvent(s){await this.shouldIgnoreMessageEvent(s)||(this.events.emit(je.message,s),await this.recordMessageEvent(s))}async acknowledgePayload(s){const r=(0,Z.formatJsonRpcResult)(s.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(At.payload,this.onPayloadHandler),this.provider.off(At.connect,this.onConnectHandler),this.provider.off(At.disconnect,this.onDisconnectHandler),this.provider.off(At.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(je.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let s=await fa();Dp(async r=>{this.initialized&&s!==r&&(s=r,r?await this.restartTransport().catch(o=>this.logger.error(o)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(o=>this.logger.error(o))))})}onProviderDisconnect(){this.events.emit(je.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(s=>this.logger.error(s))},(0,$.toMiliseconds)(If)))}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(s=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),s())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var ig=Object.defineProperty,Ma=Object.getOwnPropertySymbols,rg=Object.prototype.hasOwnProperty,sg=Object.prototype.propertyIsEnumerable,ka=(u,s,r)=>s in u?ig(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Va=(u,s)=>{for(var r in s||(s={}))rg.call(s,r)&&ka(u,r,s[r]);if(Ma)for(var r of Ma(s))sg.call(s,r)&&ka(u,r,s[r]);return u};class $r extends Vh{constructor(s,r,o,a=Gt,p=void 0){super(s,r,o,a),this.core=s,this.logger=r,this.name=o,this.map=new Map,this.version=Sf,this.cached=[],this.initialized=!1,this.storagePrefix=Gt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!ze(g)?this.map.set(this.getKey(g),g):up(g)?this.map.set(g.id,g):hp(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,m)=>{this.isInitialized(),this.map.has(g)?await this.update(g,m):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:m}),this.map.set(g,m),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(m=>Object.keys(g).every(b=>$p()(m[b],g[b]))):this.values),this.update=async(g,m)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:m});const b=Va(Va({},this.getData(g)),m);this.map.set(g,b),await this.persist()},this.delete=async(g,m)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:m}),this.map.delete(g),await this.persist())},this.logger=(0,Y.Ep)(r,this.name),this.storagePrefix=a,this.getKey=p}get context(){return(0,Y.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(s){await this.core.storage.setItem(this.storageKey,s)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(s){const r=this.map.get(s);if(!r){const{message:o}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.error(o),new Error(o)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const s=await this.getDataStore();if(typeof s>"u"||!s.length)return;if(this.map.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(s){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(s)}}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class ng{constructor(s,r){this.core=s,this.logger=r,this.name=Af,this.version=Df,this.events=new(ai()),this.initialized=!1,this.storagePrefix=Gt,this.ignoredPayloadTypes=[ui],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:o})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...o])]},this.create=async()=>{this.isInitialized();const o=Hs(),a=await this.core.crypto.setSymKey(o),p=Ze($.FIVE_MINUTES),g={protocol:Ta},m={topic:a,expiry:p,relay:g,active:!1},b=Gl({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:o,relay:g,expiryTimestamp:p});return await this.pairings.set(a,m),await this.core.relayer.subscribe(a),this.core.expirer.set(a,p),{topic:a,uri:b}},this.pair=async o=>{this.isInitialized(),this.isValidPair(o);const{topic:a,symKey:p,relay:g,expiryTimestamp:m}=na(o.uri);let b;if(this.pairings.keys.includes(a)&&(b=this.pairings.get(a),b.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const x=m||Ze($.FIVE_MINUTES),N={topic:a,relay:g,expiry:x,active:!1};return await this.pairings.set(a,N),this.core.expirer.set(a,x),o.activatePairing&&await this.activate({topic:a}),this.events.emit(er.create,N),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(p,a),await this.core.relayer.subscribe(a,{relay:g})),N},this.activate=async({topic:o})=>{this.isInitialized();const a=Ze($.THIRTY_DAYS);await this.pairings.update(o,{active:!0,expiry:a}),this.core.expirer.set(o,a)},this.ping=async o=>{this.isInitialized(),await this.isValidPing(o);const{topic:a}=o;if(this.pairings.keys.includes(a)){const p=await this.sendRequest(a,"wc_pairingPing",{}),{done:g,resolve:m,reject:b}=Ri();this.events.once(be("pairing_ping",p),({error:x})=>{x?b(x):m()}),await g()}},this.updateExpiry=async({topic:o,expiry:a})=>{this.isInitialized(),await this.pairings.update(o,{expiry:a})},this.updateMetadata=async({topic:o,metadata:a})=>{this.isInitialized(),await this.pairings.update(o,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async o=>{this.isInitialized(),await this.isValidDisconnect(o);const{topic:a}=o;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",me("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(o,a,p)=>{const g=(0,Z.formatJsonRpcRequest)(a,p),m=await this.core.crypto.encode(o,g),b=Xi[a].req;return this.core.history.set(o,g),this.core.relayer.publish(o,m,b),g.id},this.sendResult=async(o,a,p)=>{const g=(0,Z.formatJsonRpcResult)(o,p),m=await this.core.crypto.encode(a,g),b=await this.core.history.get(a,o),x=Xi[b.request.method].res;await this.core.relayer.publish(a,m,x),await this.core.history.resolve(g)},this.sendError=async(o,a,p)=>{const g=(0,Z.formatJsonRpcError)(o,p),m=await this.core.crypto.encode(a,g),b=await this.core.history.get(a,o),x=Xi[b.request.method]?Xi[b.request.method].res:Xi.unregistered_method.res;await this.core.relayer.publish(a,m,x),await this.core.history.resolve(g)},this.deletePairing=async(o,a)=>{await this.core.relayer.unsubscribe(o),await Promise.all([this.pairings.delete(o,me("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(o),a?Promise.resolve():this.core.expirer.del(o)])},this.cleanup=async()=>{const o=this.pairings.getAll().filter(a=>Bt(a.expiry));await Promise.all(o.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=o=>{const{topic:a,payload:p}=o;switch(p.method){case"wc_pairingPing":return this.onPairingPingRequest(a,p);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,p);default:return this.onUnknownRpcMethodRequest(a,p)}},this.onRelayEventResponse=async o=>{const{topic:a,payload:p}=o,g=(await this.core.history.get(a,p.id)).request.method;switch(g){case"wc_pairingPing":return this.onPairingPingResponse(a,p);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(o,a)=>{const{id:p}=a;try{this.isValidPing({topic:o}),await this.sendResult(p,o,!0),this.events.emit(er.ping,{id:p,topic:o})}catch(g){await this.sendError(p,o,g),this.logger.error(g)}},this.onPairingPingResponse=(o,a)=>{const{id:p}=a;setTimeout(()=>{(0,Z.isJsonRpcResult)(a)?this.events.emit(be("pairing_ping",p),{}):(0,Z.isJsonRpcError)(a)&&this.events.emit(be("pairing_ping",p),{error:a.error})},500)},this.onPairingDeleteRequest=async(o,a)=>{const{id:p}=a;try{this.isValidDisconnect({topic:o}),await this.deletePairing(o),this.events.emit(er.delete,{id:p,topic:o})}catch(g){await this.sendError(p,o,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(o,a)=>{const{id:p,method:g}=a;try{if(this.registeredMethods.includes(g))return;const m=me("WC_METHOD_UNSUPPORTED",g);await this.sendError(p,o,m),this.logger.error(m)}catch(m){await this.sendError(p,o,m),this.logger.error(m)}},this.onUnknownRpcMethodResponse=o=>{this.registeredMethods.includes(o)||this.logger.error(me("WC_METHOD_UNSUPPORTED",o))},this.isValidPair=o=>{var a;if(!Ge(o)){const{message:g}=C("MISSING_OR_INVALID",`pair() params: ${o}`);throw new Error(g)}if(!cp(o.uri)){const{message:g}=C("MISSING_OR_INVALID",`pair() uri: ${o.uri}`);throw new Error(g)}const p=na(o.uri);if(!((a=p==null?void 0:p.relay)!=null&&a.protocol)){const{message:g}=C("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(g)}if(!(p!=null&&p.symKey)){const{message:g}=C("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(g)}if(p!=null&&p.expiryTimestamp&&(0,$.toMiliseconds)(p==null?void 0:p.expiryTimestamp)<Date.now()){const{message:g}=C("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(g)}},this.isValidPing=async o=>{if(!Ge(o)){const{message:p}=C("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(p)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidDisconnect=async o=>{if(!Ge(o)){const{message:p}=C("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(p)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async o=>{if(!Ne(o,!1)){const{message:a}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!this.pairings.keys.includes(o)){const{message:a}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if(Bt(this.pairings.get(o).expiry)){await this.deletePairing(o);const{message:a}=C("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}},this.core=s,this.logger=(0,Y.Ep)(r,this.name),this.pairings=new $r(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,Y.Fd)(this.logger)}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}registerRelayerEvents(){this.core.relayer.on(je.message,async s=>{const{topic:r,message:o}=s;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(o)))return;const a=await this.core.crypto.decode(r,o);try{(0,Z.isJsonRpcRequest)(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):(0,Z.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(p){this.logger.error(p)}})}registerExpirerEvents(){this.core.expirer.on(at.expired,async s=>{const{topic:r}=ia(s.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(er.expire,{topic:r}))})}}class og extends nt{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.records=new Map,this.events=new xe.EventEmitter,this.name=Ff,this.version=Tf,this.cached=[],this.initialized=!1,this.storagePrefix=Gt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.records.set(o.id,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(o,a,p)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:o,request:a,chainId:p}),this.records.has(a.id))return;const g={id:a.id,topic:o,request:{method:a.method,params:a.params||null},chainId:p,expiry:Ze($.THIRTY_DAYS)};this.records.set(g.id,g),this.events.emit(Pt.created,g)},this.resolve=async o=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:o}),!this.records.has(o.id))return;const a=await this.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,Z.isJsonRpcError)(o)?{error:o.error}:{result:o.result},this.records.set(a.id,a),this.events.emit(Pt.updated,a))},this.get=async(o,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:o,id:a}),await this.getRecord(a)),this.delete=(o,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(p=>{if(p.topic===o){if(typeof a<"u"&&p.id!==a)return;this.records.delete(p.id),this.events.emit(Pt.deleted,p)}})},this.exists=async(o,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===o:!1),this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,Y.Ep)(r,this.name)}get context(){return(0,Y.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const s=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const o={topic:r.topic,request:(0,Z.formatJsonRpcRequest)(r.request.method,r.request.params,r.id),chainId:r.chainId};return s.push(o)}),s}async setJsonRpcRecords(s){await this.core.storage.setItem(this.storageKey,s)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(s){this.isInitialized();const r=this.records.get(s);if(!r){const{message:o}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Pt.sync)}async restore(){try{const s=await this.getJsonRpcRecords();if(typeof s>"u"||!s.length)return;if(this.records.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}}registerEventListeners(){this.events.on(Pt.created,s=>{const r=Pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.events.on(Pt.updated,s=>{const r=Pt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.events.on(Pt.deleted,s=>{const r=Pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.core.heartbeat.on(Ht.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(s=>{(0,$.toMiliseconds)(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.delete(s.topic,s.id))})}catch(s){this.logger.warn(s)}}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class ag extends Hh{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.expirations=new Map,this.events=new xe.EventEmitter,this.name=qf,this.version=jf,this.cached=[],this.initialized=!1,this.storagePrefix=Gt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.expirations.set(o.target,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=o=>{try{const a=this.formatTarget(o);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(o,a)=>{this.isInitialized();const p=this.formatTarget(o),g={target:p,expiry:a};this.expirations.set(p,g),this.checkExpiry(p,g),this.events.emit(at.created,{target:p,expiration:g})},this.get=o=>{this.isInitialized();const a=this.formatTarget(o);return this.getExpiration(a)},this.del=o=>{if(this.isInitialized(),this.has(o)){const a=this.formatTarget(o),p=this.getExpiration(a);this.expirations.delete(a),this.events.emit(at.deleted,{target:a,expiration:p})}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,Y.Ep)(r,this.name)}get context(){return(0,Y.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(s){if(typeof s=="string")return Dl(s);if(typeof s=="number")return Fl(s);const{message:r}=C("UNKNOWN_TYPE",`Target type: ${typeof s}`);throw new Error(r)}async setExpirations(s){await this.core.storage.setItem(this.storageKey,s)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(at.sync)}async restore(){try{const s=await this.getExpirations();if(typeof s>"u"||!s.length)return;if(this.expirations.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(s){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(s)}}getExpiration(s){const r=this.expirations.get(s);if(!r){const{message:o}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.error(o),new Error(o)}return r}checkExpiry(s,r){const{expiry:o}=r;(0,$.toMiliseconds)(o)-Date.now()<=0&&this.expire(s,r)}expire(s,r){this.expirations.delete(s),this.events.emit(at.expired,{target:s,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((s,r)=>this.checkExpiry(r,s))}registerEventListeners(){this.core.heartbeat.on(Ht.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(at.created,s=>{const r=at.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(at.expired,s=>{const r=at.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(at.deleted,s=>{const r=at.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class cg extends Bh{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.name=rn,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async o=>{if(this.verifyDisabled||Pi()||!xi())return;const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(p){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(p)}if(!this.initialized){this.removeIframe(),this.verifyUrl=sn;try{await this.createIframe()}catch(p){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(p),this.verifyDisabled=!0}}},this.register=async o=>{this.initialized?this.sendPost(o.attestationId):(this.addToQueue(o.attestationId),await this.init())},this.resolve=async o=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);let p;try{p=await this.fetchAttestation(o.attestationId,a)}catch(g){this.logger.info(`failed to resolve attestation: ${o.attestationId} from url: ${a}`),this.logger.info(g),p=await this.fetchAttestation(o.attestationId,sn)}return p},this.fetchAttestation=async(o,a)=>{this.logger.info(`resolving attestation: ${o} from url: ${a}`);const p=this.startAbortTimer($.ONE_SECOND*2),g=await fetch(`${a}/attestation/${o}`,{signal:this.abortController.signal});return clearTimeout(p),g.status===200?await g.json():void 0},this.addToQueue=o=>{this.queue.push(o)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(o=>this.sendPost(o)),this.queue=[])},this.sendPost=o=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(o,"*"),this.logger.info(`postMessage sent: ${o} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let o;const a=p=>{p.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),o())};await Promise.race([new Promise(p=>{if(document.getElementById(rn))return p();window.addEventListener("message",a);const g=document.createElement("iframe");g.id=rn,g.src=`${this.verifyUrl}/${this.projectId}`,g.style.display="none",document.body.append(g),this.iframe=g,o=p}),new Promise((p,g)=>setTimeout(()=>{window.removeEventListener("message",a),g("verify iframe load timeout")},(0,$.toMiliseconds)($.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=o=>{let a=o||Ai;return $f.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Ai}`),a=Ai),a},this.logger=(0,Y.Ep)(r,this.name),this.verifyUrl=Ai,this.abortController=new AbortController,this.isDevEnv=Gs()&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST}get context(){return(0,Y.Fd)(this.logger)}startAbortTimer(s){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,$.toMiliseconds)(s))}}class ug extends Gh{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.context=Uf,this.registerDeviceToken=async o=>{const{clientId:a,token:p,notificationType:g,enableEncrypted:m=!1}=o,b=`${Lf}/${this.projectId}/clients`;await Lp()(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:g,token:p,always_raw:m})})},this.logger=(0,Y.Ep)(r,this.context)}}var hg=Object.defineProperty,Ka=Object.getOwnPropertySymbols,lg=Object.prototype.hasOwnProperty,pg=Object.prototype.propertyIsEnumerable,Ha=(u,s,r)=>s in u?hg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Ba=(u,s)=>{for(var r in s||(s={}))lg.call(s,r)&&Ha(u,r,s[r]);if(Ka)for(var r of Ka(s))pg.call(s,r)&&Ha(u,r,s[r]);return u};class on extends js{constructor(s){super(s),this.protocol=Da,this.version=uf,this.name=tn,this.events=new xe.EventEmitter,this.initialized=!1,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.projectId=s==null?void 0:s.projectId,this.relayUrl=(s==null?void 0:s.relayUrl)||qa,this.customStoragePrefix=s!=null&&s.customStoragePrefix?`:${s.customStoragePrefix}`:"";const r=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,Y.gw)((0,Y.jI)({level:(s==null?void 0:s.logger)||hf.logger}));this.logger=(0,Y.Ep)(r,this.name),this.heartbeat=new Ht.HeartBeat,this.crypto=new Mf(this,this.logger,s==null?void 0:s.keychain),this.history=new og(this,this.logger),this.expirer=new ag(this,this.logger),this.storage=s!=null&&s.storage?s.storage:new xr.Z(Ba(Ba({},lf),s==null?void 0:s.storageOptions)),this.relayer=new tg({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ng(this,this.logger),this.verify=new cg(this.projectId||"",this.logger),this.echoClient=new ug(this.projectId||"",this.logger)}static async init(s){const r=new on(s);await r.initialize();const o=await r.crypto.getClientId();return await r.storage.setItem(Rf,o),r}get context(){return(0,Y.Fd)(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(s){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,s),this.logger.error(s.message),s}}}const dg=on,Ga="wc",Ja=2,Wa="client",an=`${Ga}@${Ja}:${Wa}:`,cn={name:Wa,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},xE={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_request_expire:"session_request_expire"},SE={database:":memory:"},Qa="WALLETCONNECT_DEEPLINK_CHOICE",RE={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},OE="history",NE="0.3",fg="proposal",CE=null,Ya="Proposal expired",gg="session",Ur=$.SEVEN_DAYS,yg="engine",Dt={wc_sessionPropose:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1104},res:{ttl:$.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1106},res:{ttl:$.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1112},res:{ttl:$.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1115}}},un={min:$.FIVE_MINUTES,max:$.SEVEN_DAYS},Ft={idle:"IDLE",active:"ACTIVE"},vg="request",mg=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var wg=Object.defineProperty,_g=Object.defineProperties,bg=Object.getOwnPropertyDescriptors,Za=Object.getOwnPropertySymbols,Eg=Object.prototype.hasOwnProperty,Ig=Object.prototype.propertyIsEnumerable,Xa=(u,s,r)=>s in u?wg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Me=(u,s)=>{for(var r in s||(s={}))Eg.call(s,r)&&Xa(u,r,s[r]);if(Za)for(var r of Za(s))Ig.call(s,r)&&Xa(u,r,s[r]);return u},Di=(u,s)=>_g(u,bg(s));class Pg extends Wh{constructor(s){super(s),this.name=yg,this.events=new(ai()),this.initialized=!1,this.ignoredPayloadTypes=[ui],this.requestQueue={state:Ft.idle,queue:[]},this.sessionRequestQueue={state:Ft.idle,queue:[]},this.requestQueueDelay=$.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Dt)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,$.toMiliseconds)(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const o=Di(Me({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(o);const{pairingTopic:a,requiredNamespaces:p,optionalNamespaces:g,sessionProperties:m,relays:b}=o;let x=a,N,O=!1;if(x&&(O=this.client.core.pairing.pairings.get(x).active),!x||!O){const{topic:ie,uri:G}=await this.client.core.pairing.create();x=ie,N=G}const j=await this.client.core.crypto.generateKeyPair(),ne=Dt.wc_sessionPropose.req.ttl||$.FIVE_MINUTES,T=Ze(ne),k=Me({requiredNamespaces:p,optionalNamespaces:g,relays:b??[{protocol:Ta}],proposer:{publicKey:j,metadata:this.client.metadata},expiryTimestamp:T},m&&{sessionProperties:m}),{reject:W,resolve:ce,done:De}=Ri(ne,Ya);if(this.events.once(be("session_connect"),async({error:ie,session:G})=>{if(ie)W(ie);else if(G){G.self.publicKey=j;const ye=Di(Me({},G),{requiredNamespaces:k.requiredNamespaces,optionalNamespaces:k.optionalNamespaces});await this.client.session.set(G.topic,ye),await this.setExpiry(G.topic,G.expiry),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:G.peer.metadata}),ce(ye)}}),!x){const{message:ie}=C("NO_MATCHING_KEY",`connect() pairing topic: ${x}`);throw new Error(ie)}const le=await this.sendRequest({topic:x,method:"wc_sessionPropose",params:k,throwOnFailedPublish:!0});return await this.setProposal(le,Me({id:le},k)),{uri:N,approval:De}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:o,relayProtocol:a,namespaces:p,sessionProperties:g}=r,m=this.client.proposal.get(o);let{pairingTopic:b,proposer:x,requiredNamespaces:N,optionalNamespaces:O}=m;b=b||"";const j=await this.client.core.crypto.generateKeyPair(),ne=x.publicKey,T=await this.client.core.crypto.generateSharedKey(j,ne);b&&o&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:x.metadata}),await this.sendResult({id:o,topic:b,result:{relay:{protocol:a??"irn"},responderPublicKey:j}}),await this.client.proposal.delete(o,me("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const k=Me({relay:{protocol:a??"irn"},namespaces:p,pairingTopic:b,controller:{publicKey:j,metadata:this.client.metadata},expiry:Ze(Ur)},g&&{sessionProperties:g});await this.client.core.relayer.subscribe(T);const W=Di(Me({},k),{topic:T,requiredNamespaces:N,optionalNamespaces:O,pairingTopic:b,acknowledged:!1,self:k.controller,peer:{publicKey:x.publicKey,metadata:x.metadata},controller:j});await this.client.session.set(T,W);try{await this.sendRequest({topic:T,method:"wc_sessionSettle",params:k,throwOnFailedPublish:!0})}catch(ce){throw this.client.logger.error(ce),this.client.session.delete(T,me("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),ce}return await this.setExpiry(T,Ze(Ur)),{topic:T,acknowledged:()=>new Promise(ce=>setTimeout(()=>ce(this.client.session.get(T)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:o,reason:a}=r,{pairingTopic:p}=this.client.proposal.get(o);p&&(await this.sendError(o,p,a),await this.client.proposal.delete(o,me("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:o,namespaces:a}=r,p=await this.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:g,resolve:m,reject:b}=Ri();return this.events.once(be("session_update",p),({error:x})=>{x?b(x):m()}),await this.client.session.update(o,{namespaces:a}),{acknowledged:g}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:o}=r,a=await this.sendRequest({topic:o,method:"wc_sessionExtend",params:{}}),{done:p,resolve:g,reject:m}=Ri();return this.events.once(be("session_extend",a),({error:b})=>{b?m(b):g()}),await this.setExpiry(o,Ze(Ur)),{acknowledged:p}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:o,request:a,topic:p,expiry:g=Dt.wc_sessionRequest.req.ttl}=r,m=(0,Z.payloadId)(),{done:b,resolve:x,reject:N}=Ri(g,"Request expired. Please try again.");return this.events.once(be("session_request",m),({error:O,result:j})=>{O?N(O):x(j)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:m,topic:p,method:"wc_sessionRequest",params:{request:Di(Me({},a),{expiryTimestamp:Ze(g)}),chainId:o},expiry:g,throwOnFailedPublish:!0}).catch(j=>N(j)),this.client.events.emit("session_request_sent",{topic:p,request:a,chainId:o,id:m}),O()}),new Promise(async O=>{const j=await ql(this.client.core.storage,Qa);Tl({id:m,topic:p,wcDeepLink:j}),O()}),b()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:o,response:a}=r,{id:p}=a;(0,Z.isJsonRpcResult)(a)?await this.sendResult({id:p,topic:o,result:a.result,throwOnFailedPublish:!0}):(0,Z.isJsonRpcError)(a)&&await this.sendError(p,o,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:o}=r;if(this.client.session.keys.includes(o)){const a=await this.sendRequest({topic:o,method:"wc_sessionPing",params:{}}),{done:p,resolve:g,reject:m}=Ri();this.events.once(be("session_ping",a),({error:b})=>{b?m(b):g()}),await p()}else this.client.core.pairing.pairings.keys.includes(o)&&await this.client.core.pairing.ping({topic:o})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:o,event:a,chainId:p}=r;await this.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:p}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:o}=r;if(this.client.session.keys.includes(o))await this.sendRequest({topic:o,method:"wc_sessionDelete",params:me("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:o,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(o))await this.client.core.pairing.disconnect({topic:o});else{const{message:a}=C("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(o=>op(o,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const o=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(p=>{var g,m;return((g=p.peerMetadata)==null?void 0:g.url)&&((m=p.peerMetadata)==null?void 0:m.url)===r.peer.metadata.url&&p.topic&&p.topic!==o.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(p=>this.client.core.pairing.disconnect({topic:p.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(o){this.client.logger.error(o)}},this.deleteSession=async r=>{const{topic:o,expirerHasDeleted:a=!1,emitEvent:p=!0,id:g=0}=r,{self:m}=this.client.session.get(o);await this.client.core.relayer.unsubscribe(o),await this.client.session.delete(o,me("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(m.publicKey)&&await this.client.core.crypto.deleteKeyPair(m.publicKey),this.client.core.crypto.keychain.has(o)&&await this.client.core.crypto.deleteSymKey(o),a||this.client.core.expirer.del(o),this.client.core.storage.removeItem(Qa).catch(b=>this.client.logger.warn(b)),this.getPendingSessionRequests().forEach(b=>{b.topic===o&&this.deletePendingSessionRequest(b.id,me("USER_DISCONNECTED"))}),p&&this.client.events.emit("session_delete",{id:g,topic:o})},this.deleteProposal=async(r,o)=>{await Promise.all([this.client.proposal.delete(r,me("USER_DISCONNECTED")),o?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,o,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,o),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(p=>p.id!==r),a&&(this.sessionRequestQueue.state=Ft.idle,this.client.events.emit("session_request_expire",{id:r}))},this.setExpiry=async(r,o)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:o}),this.client.core.expirer.set(r,o)},this.setProposal=async(r,o)=>{await this.client.proposal.set(r,o),this.client.core.expirer.set(r,Ze(Dt.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async r=>{const{id:o,topic:a,params:p,verifyContext:g}=r,m=p.request.expiryTimestamp||Ze(Dt.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(o,{id:o,topic:a,params:p,verifyContext:g}),m&&this.client.core.expirer.set(o,m)},this.sendRequest=async r=>{const{topic:o,method:a,params:p,expiry:g,relayRpcId:m,clientRpcId:b,throwOnFailedPublish:x}=r,N=(0,Z.formatJsonRpcRequest)(a,p,b);if(xi()&&mg.includes(a)){const ne=Ii(JSON.stringify(N));this.client.core.verify.register({attestationId:ne})}const O=await this.client.core.crypto.encode(o,N),j=Dt[a].req;return g&&(j.ttl=g),m&&(j.id=m),this.client.core.history.set(o,N),x?(j.internal=Di(Me({},j.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,O,j)):this.client.core.relayer.publish(o,O,j).catch(ne=>this.client.logger.error(ne)),N.id},this.sendResult=async r=>{const{id:o,topic:a,result:p,throwOnFailedPublish:g}=r,m=(0,Z.formatJsonRpcResult)(o,p),b=await this.client.core.crypto.encode(a,m),x=await this.client.core.history.get(a,o),N=Dt[x.request.method].res;g?(N.internal=Di(Me({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,b,N)):this.client.core.relayer.publish(a,b,N).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(m)},this.sendError=async(r,o,a)=>{const p=(0,Z.formatJsonRpcError)(r,a),g=await this.client.core.crypto.encode(o,p),m=await this.client.core.history.get(o,r),b=Dt[m.request.method].res;this.client.core.relayer.publish(o,g,b),await this.client.core.history.resolve(p)},this.cleanup=async()=>{const r=[],o=[];this.client.session.getAll().forEach(a=>{let p=!1;Bt(a.expiry)&&(p=!0),this.client.core.crypto.keychain.has(a.topic)||(p=!0),p&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Bt(a.expiryTimestamp)&&o.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession({topic:a})),...o.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Ft.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ft.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(o=>setTimeout(o,300))}catch(o){this.client.logger.warn(o)}}this.requestQueue.state=Ft.idle},this.processRequest=r=>{const{topic:o,payload:a}=r,p=a.method;switch(p){case"wc_sessionPropose":return this.onSessionProposeRequest(o,a);case"wc_sessionSettle":return this.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return this.onSessionExtendRequest(o,a);case"wc_sessionPing":return this.onSessionPingRequest(o,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return this.onSessionRequest(o,a);case"wc_sessionEvent":return this.onSessionEventRequest(o,a);default:return this.client.logger.info(`Unsupported request method ${p}`)}},this.onRelayEventResponse=async r=>{const{topic:o,payload:a}=r,p=(await this.client.core.history.get(o,a.id)).request.method;switch(p){case"wc_sessionPropose":return this.onSessionProposeResponse(o,a);case"wc_sessionSettle":return this.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return this.onSessionExtendResponse(o,a);case"wc_sessionPing":return this.onSessionPingResponse(o,a);case"wc_sessionRequest":return this.onSessionRequestResponse(o,a);default:return this.client.logger.info(`Unsupported response method ${p}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:o}=r,{message:a}=C("MISSING_OR_INVALID",`Decoded payload on topic ${o} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,o)=>{const{params:a,id:p}=o;try{this.isValidConnect(Me({},o.params));const g=a.expiryTimestamp||Ze(Dt.wc_sessionPropose.req.ttl),m=Me({id:p,pairingTopic:r,expiryTimestamp:g},a);await this.setProposal(p,m);const b=Ii(JSON.stringify(o)),x=await this.getVerifyContext(b,m.proposer.metadata);this.client.events.emit("session_proposal",{id:p,params:m,verifyContext:x})}catch(g){await this.sendError(p,r,g),this.client.logger.error(g)}},this.onSessionProposeResponse=async(r,o)=>{const{id:a}=o;if((0,Z.isJsonRpcResult)(o)){const{result:p}=o;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:p});const g=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const m=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:m});const b=p.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const x=await this.client.core.crypto.generateSharedKey(m,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:x});const N=await this.client.core.relayer.subscribe(x);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:N}),await this.client.core.pairing.activate({topic:r})}else(0,Z.isJsonRpcError)(o)&&(await this.client.proposal.delete(a,me("USER_DISCONNECTED")),this.events.emit(be("session_connect"),{error:o.error}))},this.onSessionSettleRequest=async(r,o)=>{const{id:a,params:p}=o;try{this.isValidSessionSettleRequest(p);const{relay:g,controller:m,expiry:b,namespaces:x,sessionProperties:N,pairingTopic:O}=o.params,j=Me({topic:r,relay:g,expiry:b,namespaces:x,acknowledged:!0,pairingTopic:O,requiredNamespaces:{},optionalNamespaces:{},controller:m.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:m.publicKey,metadata:m.metadata}},N&&{sessionProperties:N});await this.sendResult({id:o.id,topic:r,result:!0}),this.events.emit(be("session_connect"),{session:j}),this.cleanupDuplicatePairings(j)}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.onSessionSettleResponse=async(r,o)=>{const{id:a}=o;(0,Z.isJsonRpcResult)(o)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(be("session_approve",a),{})):(0,Z.isJsonRpcError)(o)&&(await this.client.session.delete(r,me("USER_DISCONNECTED")),this.events.emit(be("session_approve",a),{error:o.error}))},this.onSessionUpdateRequest=async(r,o)=>{const{params:a,id:p}=o;try{const g=`${r}_session_update`,m=qr.get(g);if(m&&this.isRequestOutOfSync(m,p)){this.client.logger.info(`Discarding out of sync request - ${p}`);return}this.isValidUpdate(Me({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:p,topic:r,result:!0}),this.client.events.emit("session_update",{id:p,topic:r,params:a}),qr.set(g,p)}catch(g){await this.sendError(p,r,g),this.client.logger.error(g)}},this.isRequestOutOfSync=(r,o)=>parseInt(o.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,o)=>{const{id:a}=o;(0,Z.isJsonRpcResult)(o)?this.events.emit(be("session_update",a),{}):(0,Z.isJsonRpcError)(o)&&this.events.emit(be("session_update",a),{error:o.error})},this.onSessionExtendRequest=async(r,o)=>{const{id:a}=o;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ze(Ur)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionExtendResponse=(r,o)=>{const{id:a}=o;(0,Z.isJsonRpcResult)(o)?this.events.emit(be("session_extend",a),{}):(0,Z.isJsonRpcError)(o)&&this.events.emit(be("session_extend",a),{error:o.error})},this.onSessionPingRequest=async(r,o)=>{const{id:a}=o;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionPingResponse=(r,o)=>{const{id:a}=o;setTimeout(()=>{(0,Z.isJsonRpcResult)(o)?this.events.emit(be("session_ping",a),{}):(0,Z.isJsonRpcError)(o)&&this.events.emit(be("session_ping",a),{error:o.error})},500)},this.onSessionDeleteRequest=async(r,o)=>{const{id:a}=o;try{this.isValidDisconnect({topic:r,reason:o.params}),await Promise.all([new Promise(p=>{this.client.core.relayer.once(je.publish,async()=>{p(await this.deleteSession({topic:r,id:a}))})}),this.sendResult({id:a,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:me("USER_DISCONNECTED")})])}catch(p){this.client.logger.error(p)}},this.onSessionRequest=async(r,o)=>{const{id:a,params:p}=o;try{this.isValidRequest(Me({topic:r},p));const g=Ii(JSON.stringify((0,Z.formatJsonRpcRequest)("wc_sessionRequest",p,a))),m=this.client.session.get(r),b=await this.getVerifyContext(g,m.peer.metadata),x={id:a,topic:r,params:p,verifyContext:b};await this.setPendingSessionRequest(x),this.addSessionRequestToSessionRequestQueue(x),this.processSessionRequestQueue()}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.onSessionRequestResponse=(r,o)=>{const{id:a}=o;(0,Z.isJsonRpcResult)(o)?this.events.emit(be("session_request",a),{result:o.result}):(0,Z.isJsonRpcError)(o)&&this.events.emit(be("session_request",a),{error:o.error})},this.onSessionEventRequest=async(r,o)=>{const{id:a,params:p}=o;try{const g=`${r}_session_event_${p.event.name}`,m=qr.get(g);if(m&&this.isRequestOutOfSync(m,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Me({topic:r},p)),this.client.events.emit("session_event",{id:a,topic:r,params:p}),qr.set(g,a)}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ft.idle,this.processSessionRequestQueue()},(0,$.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:o})=>{const a=this.client.core.history.pending;a.length>0&&a.filter(p=>p.topic===r&&p.request.method==="wc_sessionRequest").forEach(p=>{this.events.emit(be("session_request",p.request.id),{error:o})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Ft.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ft.active,this.client.events.emit("session_request",r)}catch(o){this.client.logger.error(o)}},this.onPairingCreated=r=>{if(r.active)return;const o=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);o&&this.onSessionProposeRequest(r.topic,(0,Z.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,relays:o.relays,proposer:o.proposer,sessionProperties:o.sessionProperties},o.id))},this.isValidConnect=async r=>{if(!Ge(r)){const{message:b}=C("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(b)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:p,sessionProperties:g,relays:m}=r;if(ze(o)||await this.isValidPairingTopic(o),!mp(m,!0)){const{message:b}=C("MISSING_OR_INVALID",`connect() relays: ${m}`);throw new Error(b)}!ze(a)&&Ci(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ze(p)&&Ci(p)!==0&&this.validateNamespaces(p,"optionalNamespaces"),ze(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(r,o)=>{const a=vp(r,"connect()",o);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!Ge(r))throw new Error(C("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:o,namespaces:a,relayProtocol:p,sessionProperties:g}=r;await this.isValidProposalId(o);const m=this.client.proposal.get(o),b=Tr(a,"approve()");if(b)throw new Error(b.message);const x=Qs(m.requiredNamespaces,a,"approve()");if(x)throw new Error(x.message);if(!Ne(p,!0)){const{message:N}=C("MISSING_OR_INVALID",`approve() relayProtocol: ${p}`);throw new Error(N)}ze(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async r=>{if(!Ge(r)){const{message:p}=C("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(p)}const{id:o,reason:a}=r;if(await this.isValidProposalId(o),!_p(a)){const{message:p}=C("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(p)}},this.isValidSessionSettleRequest=r=>{if(!Ge(r)){const{message:x}=C("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(x)}const{relay:o,controller:a,namespaces:p,expiry:g}=r;if(!la(o)){const{message:x}=C("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(x)}const m=lp(a,"onSessionSettleRequest()");if(m)throw new Error(m.message);const b=Tr(p,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(Bt(g)){const{message:x}=C("EXPIRED","onSessionSettleRequest()");throw new Error(x)}},this.isValidUpdate=async r=>{if(!Ge(r)){const{message:b}=C("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(b)}const{topic:o,namespaces:a}=r;await this.isValidSessionTopic(o);const p=this.client.session.get(o),g=Tr(a,"update()");if(g)throw new Error(g.message);const m=Qs(p.requiredNamespaces,a,"update()");if(m)throw new Error(m.message)},this.isValidExtend=async r=>{if(!Ge(r)){const{message:a}=C("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionTopic(o)},this.isValidRequest=async r=>{if(!Ge(r)){const{message:b}=C("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(b)}const{topic:o,request:a,chainId:p,expiry:g}=r;await this.isValidSessionTopic(o);const{namespaces:m}=this.client.session.get(o);if(!pa(m,p)){const{message:b}=C("MISSING_OR_INVALID",`request() chainId: ${p}`);throw new Error(b)}if(!bp(a)){const{message:b}=C("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(b)}if(!Pp(m,p,a.method)){const{message:b}=C("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(b)}if(g&&!Op(g,un)){const{message:b}=C("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${un.min} and ${un.max}`);throw new Error(b)}},this.isValidRespond=async r=>{var o;if(!Ge(r)){const{message:g}=C("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(g)}const{topic:a,response:p}=r;try{await this.isValidSessionTopic(a)}catch(g){throw(o=r==null?void 0:r.response)!=null&&o.id&&this.cleanupAfterResponse(r),g}if(!Ep(p)){const{message:g}=C("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(p)}`);throw new Error(g)}},this.isValidPing=async r=>{if(!Ge(r)){const{message:a}=C("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.isValidEmit=async r=>{if(!Ge(r)){const{message:m}=C("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(m)}const{topic:o,event:a,chainId:p}=r;await this.isValidSessionTopic(o);const{namespaces:g}=this.client.session.get(o);if(!pa(g,p)){const{message:m}=C("MISSING_OR_INVALID",`emit() chainId: ${p}`);throw new Error(m)}if(!Ip(a)){const{message:m}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(m)}if(!xp(g,p,a.name)){const{message:m}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(m)}},this.isValidDisconnect=async r=>{if(!Ge(r)){const{message:a}=C("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.getVerifyContext=async(r,o)=>{const a={verified:{verifyUrl:o.verifyUrl||Ai,validation:"UNKNOWN",origin:o.url||""}};try{const p=await this.client.core.verify.resolve({attestationId:r,verifyUrl:o.verifyUrl});p&&(a.verified.origin=p.origin,a.verified.isScam=p.isScam,a.verified.validation=p.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(p){this.client.logger.info(p)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,o)=>{Object.values(r).forEach(a=>{if(!Ne(a,!1)){const{message:p}=C("MISSING_OR_INVALID",`${o} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(p)}})}}async isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(je.message,async s=>{const{topic:r,message:o}=s;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(o)))return;const a=await this.client.core.crypto.decode(r,o);try{(0,Z.isJsonRpcRequest)(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):(0,Z.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(p){this.client.logger.error(p)}})}registerExpirerEvents(){this.client.core.expirer.on(at.expired,async s=>{const{topic:r,id:o}=ia(s.target);if(o&&this.client.pendingRequest.keys.includes(o))return await this.deletePendingSessionRequest(o,C("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):o&&(await this.deleteProposal(o,!0),this.client.events.emit("proposal_expire",{id:o}))})}registerPairingEvents(){this.client.core.pairing.events.on(er.create,s=>this.onPairingCreated(s))}isValidPairingTopic(s){if(!Ne(s,!1)){const{message:r}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(s)){const{message:r}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if(Bt(this.client.core.pairing.pairings.get(s).expiry)){const{message:r}=C("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}}async isValidSessionTopic(s){if(!Ne(s,!1)){const{message:r}=C("MISSING_OR_INVALID",`session topic should be a string: ${s}`);throw new Error(r)}if(!this.client.session.keys.includes(s)){const{message:r}=C("NO_MATCHING_KEY",`session topic doesn't exist: ${s}`);throw new Error(r)}if(Bt(this.client.session.get(s).expiry)){await this.deleteSession({topic:s});const{message:r}=C("EXPIRED",`session topic: ${s}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(s)){const{message:r}=C("MISSING_OR_INVALID",`session topic does not exist in keychain: ${s}`);throw await this.deleteSession({topic:s}),new Error(r)}}async isValidSessionOrPairingTopic(s){if(this.client.session.keys.includes(s))await this.isValidSessionTopic(s);else if(this.client.core.pairing.pairings.keys.includes(s))this.isValidPairingTopic(s);else if(Ne(s,!1)){const{message:r}=C("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${s}`);throw new Error(r)}else{const{message:r}=C("MISSING_OR_INVALID",`session or pairing topic should be a string: ${s}`);throw new Error(r)}}async isValidProposalId(s){if(!wp(s)){const{message:r}=C("MISSING_OR_INVALID",`proposal id should be a number: ${s}`);throw new Error(r)}if(!this.client.proposal.keys.includes(s)){const{message:r}=C("NO_MATCHING_KEY",`proposal id doesn't exist: ${s}`);throw new Error(r)}if(Bt(this.client.proposal.get(s).expiryTimestamp)){await this.deleteProposal(s);const{message:r}=C("EXPIRED",`proposal id: ${s}`);throw new Error(r)}}}class xg extends $r{constructor(s,r){super(s,r,fg,an),this.core=s,this.logger=r}}class Sg extends $r{constructor(s,r){super(s,r,gg,an),this.core=s,this.logger=r}}class Rg extends $r{constructor(s,r){super(s,r,vg,an,o=>o.id),this.core=s,this.logger=r}}class hn extends Jh{constructor(s){super(s),this.protocol=Ga,this.version=Ja,this.name=cn.name,this.events=new xe.EventEmitter,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.removeAllListeners=o=>this.events.removeAllListeners(o),this.connect=async o=>{try{return await this.engine.connect(o)}catch(a){throw this.logger.error(a.message),a}},this.pair=async o=>{try{return await this.engine.pair(o)}catch(a){throw this.logger.error(a.message),a}},this.approve=async o=>{try{return await this.engine.approve(o)}catch(a){throw this.logger.error(a.message),a}},this.reject=async o=>{try{return await this.engine.reject(o)}catch(a){throw this.logger.error(a.message),a}},this.update=async o=>{try{return await this.engine.update(o)}catch(a){throw this.logger.error(a.message),a}},this.extend=async o=>{try{return await this.engine.extend(o)}catch(a){throw this.logger.error(a.message),a}},this.request=async o=>{try{return await this.engine.request(o)}catch(a){throw this.logger.error(a.message),a}},this.respond=async o=>{try{return await this.engine.respond(o)}catch(a){throw this.logger.error(a.message),a}},this.ping=async o=>{try{return await this.engine.ping(o)}catch(a){throw this.logger.error(a.message),a}},this.emit=async o=>{try{return await this.engine.emit(o)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async o=>{try{return await this.engine.disconnect(o)}catch(a){throw this.logger.error(a.message),a}},this.find=o=>{try{return this.engine.find(o)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(o){throw this.logger.error(o.message),o}},this.name=(s==null?void 0:s.name)||cn.name,this.metadata=(s==null?void 0:s.metadata)||Pl();const r=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,Y.gw)((0,Y.jI)({level:(s==null?void 0:s.logger)||cn.logger}));this.core=(s==null?void 0:s.core)||new dg(s),this.logger=(0,Y.Ep)(r,this.name),this.session=new Sg(this.core,this.logger),this.proposal=new xg(this.core,this.logger),this.pendingRequest=new Rg(this.core,this.logger),this.engine=new Pg(this)}static async init(s){const r=new hn(s);return await r.initialize(),r}get context(){return(0,Y.Fd)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(s){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(s.message),s}}}const AE=null,DE=null;var ec=F(71315),Jt=F(67708);const tc="error",Og="wss://relay.walletconnect.com",Ng="wc",Cg="universal_provider",ic=`${Ng}@2:${Cg}:`,Ag="https://rpc.walletconnect.com/v1/",Tt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof F.g<"u"?F.g:typeof self<"u"?self:{},ln={exports:{}};(function(u,s){(function(){var r,o="4.17.21",a=200,p="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",m="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",x=500,N="__lodash_placeholder__",O=1,j=2,ne=4,T=1,k=2,W=1,ce=2,De=4,le=8,ie=16,G=32,ye=64,Ee=128,ke=256,Qt=512,ty=30,iy="...",ry=800,sy=16,lc=1,ny=2,oy=3,di=1/0,Yt=9007199254740991,ay=17976931348623157e292,kr=0/0,xt=4294967295,cy=xt-1,uy=xt>>>1,hy=[["ary",Ee],["bind",W],["bindKey",ce],["curry",le],["curryRight",ie],["flip",Qt],["partial",G],["partialRight",ye],["rearg",ke]],Fi="[object Arguments]",Vr="[object Array]",ly="[object AsyncFunction]",rr="[object Boolean]",sr="[object Date]",py="[object DOMException]",Kr="[object Error]",Hr="[object Function]",pc="[object GeneratorFunction]",vt="[object Map]",nr="[object Number]",dy="[object Null]",qt="[object Object]",dc="[object Promise]",fy="[object Proxy]",or="[object RegExp]",mt="[object Set]",ar="[object String]",Br="[object Symbol]",gy="[object Undefined]",cr="[object WeakMap]",yy="[object WeakSet]",ur="[object ArrayBuffer]",Ti="[object DataView]",gn="[object Float32Array]",yn="[object Float64Array]",vn="[object Int8Array]",mn="[object Int16Array]",wn="[object Int32Array]",_n="[object Uint8Array]",bn="[object Uint8ClampedArray]",En="[object Uint16Array]",In="[object Uint32Array]",vy=/\b__p \+= '';/g,my=/\b(__p \+=) '' \+/g,wy=/(__e\(.*?\)|\b__t\)) \+\n'';/g,fc=/&(?:amp|lt|gt|quot|#39);/g,gc=/[&<>"']/g,_y=RegExp(fc.source),by=RegExp(gc.source),Ey=/<%-([\s\S]+?)%>/g,Iy=/<%([\s\S]+?)%>/g,yc=/<%=([\s\S]+?)%>/g,Py=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xy=/^\w*$/,Sy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Pn=/[\\^$.*+?()[\]{}|]/g,Ry=RegExp(Pn.source),xn=/^\s+/,Oy=/\s/,Ny=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Cy=/\{\n\/\* \[wrapped with (.+)\] \*/,Ay=/,? & /,Dy=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Fy=/[()=,{}\[\]\/\s]/,Ty=/\\(\\)?/g,qy=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,vc=/\w*$/,jy=/^[-+]0x[0-9a-f]+$/i,$y=/^0b[01]+$/i,Uy=/^\[object .+?Constructor\]$/,Ly=/^0o[0-7]+$/i,zy=/^(?:0|[1-9]\d*)$/,My=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gr=/($^)/,ky=/['\n\r\u2028\u2029\\]/g,Jr="\\ud800-\\udfff",Vy="\\u0300-\\u036f",Ky="\\ufe20-\\ufe2f",Hy="\\u20d0-\\u20ff",mc=Vy+Ky+Hy,wc="\\u2700-\\u27bf",_c="a-z\\xdf-\\xf6\\xf8-\\xff",By="\\xac\\xb1\\xd7\\xf7",Gy="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Jy="\\u2000-\\u206f",Wy=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",bc="A-Z\\xc0-\\xd6\\xd8-\\xde",Ec="\\ufe0e\\ufe0f",Ic=By+Gy+Jy+Wy,Sn="['\u2019]",Qy="["+Jr+"]",Pc="["+Ic+"]",Wr="["+mc+"]",xc="\\d+",Yy="["+wc+"]",Sc="["+_c+"]",Rc="[^"+Jr+Ic+xc+wc+_c+bc+"]",Rn="\\ud83c[\\udffb-\\udfff]",Zy="(?:"+Wr+"|"+Rn+")",Oc="[^"+Jr+"]",On="(?:\\ud83c[\\udde6-\\uddff]){2}",Nn="[\\ud800-\\udbff][\\udc00-\\udfff]",qi="["+bc+"]",Nc="\\u200d",Cc="(?:"+Sc+"|"+Rc+")",Xy="(?:"+qi+"|"+Rc+")",Ac="(?:"+Sn+"(?:d|ll|m|re|s|t|ve))?",Dc="(?:"+Sn+"(?:D|LL|M|RE|S|T|VE))?",Fc=Zy+"?",Tc="["+Ec+"]?",ev="(?:"+Nc+"(?:"+[Oc,On,Nn].join("|")+")"+Tc+Fc+")*",tv="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",iv="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",qc=Tc+Fc+ev,rv="(?:"+[Yy,On,Nn].join("|")+")"+qc,sv="(?:"+[Oc+Wr+"?",Wr,On,Nn,Qy].join("|")+")",nv=RegExp(Sn,"g"),ov=RegExp(Wr,"g"),Cn=RegExp(Rn+"(?="+Rn+")|"+sv+qc,"g"),av=RegExp([qi+"?"+Sc+"+"+Ac+"(?="+[Pc,qi,"$"].join("|")+")",Xy+"+"+Dc+"(?="+[Pc,qi+Cc,"$"].join("|")+")",qi+"?"+Cc+"+"+Ac,qi+"+"+Dc,iv,tv,xc,rv].join("|"),"g"),cv=RegExp("["+Nc+Jr+mc+Ec+"]"),uv=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,hv=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],lv=-1,fe={};fe[gn]=fe[yn]=fe[vn]=fe[mn]=fe[wn]=fe[_n]=fe[bn]=fe[En]=fe[In]=!0,fe[Fi]=fe[Vr]=fe[ur]=fe[rr]=fe[Ti]=fe[sr]=fe[Kr]=fe[Hr]=fe[vt]=fe[nr]=fe[qt]=fe[or]=fe[mt]=fe[ar]=fe[cr]=!1;var pe={};pe[Fi]=pe[Vr]=pe[ur]=pe[Ti]=pe[rr]=pe[sr]=pe[gn]=pe[yn]=pe[vn]=pe[mn]=pe[wn]=pe[vt]=pe[nr]=pe[qt]=pe[or]=pe[mt]=pe[ar]=pe[Br]=pe[_n]=pe[bn]=pe[En]=pe[In]=!0,pe[Kr]=pe[Hr]=pe[cr]=!1;var pv={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},dv={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},fv={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},gv={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},yv=parseFloat,vv=parseInt,jc=typeof ir=="object"&&ir&&ir.Object===Object&&ir,mv=typeof self=="object"&&self&&self.Object===Object&&self,Te=jc||mv||Function("return this")(),An=s&&!s.nodeType&&s,fi=An&&!0&&u&&!u.nodeType&&u,$c=fi&&fi.exports===An,Dn=$c&&jc.process,ct=function(){try{var w=fi&&fi.require&&fi.require("util").types;return w||Dn&&Dn.binding&&Dn.binding("util")}catch{}}(),Uc=ct&&ct.isArrayBuffer,Lc=ct&&ct.isDate,zc=ct&&ct.isMap,Mc=ct&&ct.isRegExp,kc=ct&&ct.isSet,Vc=ct&&ct.isTypedArray;function Xe(w,I,E){switch(E.length){case 0:return w.call(I);case 1:return w.call(I,E[0]);case 2:return w.call(I,E[0],E[1]);case 3:return w.call(I,E[0],E[1],E[2])}return w.apply(I,E)}function wv(w,I,E,D){for(var V=-1,re=w==null?0:w.length;++V<re;){var Re=w[V];I(D,Re,E(Re),w)}return D}function ut(w,I){for(var E=-1,D=w==null?0:w.length;++E<D&&I(w[E],E,w)!==!1;);return w}function _v(w,I){for(var E=w==null?0:w.length;E--&&I(w[E],E,w)!==!1;);return w}function Kc(w,I){for(var E=-1,D=w==null?0:w.length;++E<D;)if(!I(w[E],E,w))return!1;return!0}function Zt(w,I){for(var E=-1,D=w==null?0:w.length,V=0,re=[];++E<D;){var Re=w[E];I(Re,E,w)&&(re[V++]=Re)}return re}function Qr(w,I){var E=w==null?0:w.length;return!!E&&ji(w,I,0)>-1}function Fn(w,I,E){for(var D=-1,V=w==null?0:w.length;++D<V;)if(E(I,w[D]))return!0;return!1}function ve(w,I){for(var E=-1,D=w==null?0:w.length,V=Array(D);++E<D;)V[E]=I(w[E],E,w);return V}function Xt(w,I){for(var E=-1,D=I.length,V=w.length;++E<D;)w[V+E]=I[E];return w}function Tn(w,I,E,D){var V=-1,re=w==null?0:w.length;for(D&&re&&(E=w[++V]);++V<re;)E=I(E,w[V],V,w);return E}function bv(w,I,E,D){var V=w==null?0:w.length;for(D&&V&&(E=w[--V]);V--;)E=I(E,w[V],V,w);return E}function qn(w,I){for(var E=-1,D=w==null?0:w.length;++E<D;)if(I(w[E],E,w))return!0;return!1}var Ev=jn("length");function Iv(w){return w.split("")}function Pv(w){return w.match(Dy)||[]}function Hc(w,I,E){var D;return E(w,function(V,re,Re){if(I(V,re,Re))return D=re,!1}),D}function Yr(w,I,E,D){for(var V=w.length,re=E+(D?1:-1);D?re--:++re<V;)if(I(w[re],re,w))return re;return-1}function ji(w,I,E){return I===I?jv(w,I,E):Yr(w,Bc,E)}function xv(w,I,E,D){for(var V=E-1,re=w.length;++V<re;)if(D(w[V],I))return V;return-1}function Bc(w){return w!==w}function Gc(w,I){var E=w==null?0:w.length;return E?Un(w,I)/E:kr}function jn(w){return function(I){return I==null?r:I[w]}}function $n(w){return function(I){return w==null?r:w[I]}}function Jc(w,I,E,D,V){return V(w,function(re,Re,ue){E=D?(D=!1,re):I(E,re,Re,ue)}),E}function Sv(w,I){var E=w.length;for(w.sort(I);E--;)w[E]=w[E].value;return w}function Un(w,I){for(var E,D=-1,V=w.length;++D<V;){var re=I(w[D]);re!==r&&(E=E===r?re:E+re)}return E}function Ln(w,I){for(var E=-1,D=Array(w);++E<w;)D[E]=I(E);return D}function Rv(w,I){return ve(I,function(E){return[E,w[E]]})}function Wc(w){return w&&w.slice(0,Xc(w)+1).replace(xn,"")}function et(w){return function(I){return w(I)}}function zn(w,I){return ve(I,function(E){return w[E]})}function hr(w,I){return w.has(I)}function Qc(w,I){for(var E=-1,D=w.length;++E<D&&ji(I,w[E],0)>-1;);return E}function Yc(w,I){for(var E=w.length;E--&&ji(I,w[E],0)>-1;);return E}function Ov(w,I){for(var E=w.length,D=0;E--;)w[E]===I&&++D;return D}var Nv=$n(pv),Cv=$n(dv);function Av(w){return"\\"+gv[w]}function Dv(w,I){return w==null?r:w[I]}function $i(w){return cv.test(w)}function Fv(w){return uv.test(w)}function Tv(w){for(var I,E=[];!(I=w.next()).done;)E.push(I.value);return E}function Mn(w){var I=-1,E=Array(w.size);return w.forEach(function(D,V){E[++I]=[V,D]}),E}function Zc(w,I){return function(E){return w(I(E))}}function ei(w,I){for(var E=-1,D=w.length,V=0,re=[];++E<D;){var Re=w[E];(Re===I||Re===N)&&(w[E]=N,re[V++]=E)}return re}function Zr(w){var I=-1,E=Array(w.size);return w.forEach(function(D){E[++I]=D}),E}function qv(w){var I=-1,E=Array(w.size);return w.forEach(function(D){E[++I]=[D,D]}),E}function jv(w,I,E){for(var D=E-1,V=w.length;++D<V;)if(w[D]===I)return D;return-1}function $v(w,I,E){for(var D=E+1;D--;)if(w[D]===I)return D;return D}function Ui(w){return $i(w)?Lv(w):Ev(w)}function wt(w){return $i(w)?zv(w):Iv(w)}function Xc(w){for(var I=w.length;I--&&Oy.test(w.charAt(I)););return I}var Uv=$n(fv);function Lv(w){for(var I=Cn.lastIndex=0;Cn.test(w);)++I;return I}function zv(w){return w.match(Cn)||[]}function Mv(w){return w.match(av)||[]}var kv=function w(I){I=I==null?Te:Li.defaults(Te.Object(),I,Li.pick(Te,hv));var E=I.Array,D=I.Date,V=I.Error,re=I.Function,Re=I.Math,ue=I.Object,kn=I.RegExp,Vv=I.String,ht=I.TypeError,Xr=E.prototype,Kv=re.prototype,zi=ue.prototype,es=I["__core-js_shared__"],ts=Kv.toString,oe=zi.hasOwnProperty,Hv=0,eu=function(){var e=/[^.]+$/.exec(es&&es.keys&&es.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),is=zi.toString,Bv=ts.call(ue),Gv=Te._,Jv=kn("^"+ts.call(oe).replace(Pn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rs=$c?I.Buffer:r,ti=I.Symbol,ss=I.Uint8Array,tu=rs?rs.allocUnsafe:r,ns=Zc(ue.getPrototypeOf,ue),iu=ue.create,ru=zi.propertyIsEnumerable,os=Xr.splice,su=ti?ti.isConcatSpreadable:r,lr=ti?ti.iterator:r,gi=ti?ti.toStringTag:r,as=function(){try{var e=_i(ue,"defineProperty");return e({},"",{}),e}catch{}}(),Wv=I.clearTimeout!==Te.clearTimeout&&I.clearTimeout,Qv=D&&D.now!==Te.Date.now&&D.now,Yv=I.setTimeout!==Te.setTimeout&&I.setTimeout,cs=Re.ceil,us=Re.floor,Vn=ue.getOwnPropertySymbols,Zv=rs?rs.isBuffer:r,nu=I.isFinite,Xv=Xr.join,em=Zc(ue.keys,ue),Oe=Re.max,$e=Re.min,tm=D.now,im=I.parseInt,ou=Re.random,rm=Xr.reverse,Kn=_i(I,"DataView"),pr=_i(I,"Map"),Hn=_i(I,"Promise"),Mi=_i(I,"Set"),dr=_i(I,"WeakMap"),fr=_i(ue,"create"),hs=dr&&new dr,ki={},sm=bi(Kn),nm=bi(pr),om=bi(Hn),am=bi(Mi),cm=bi(dr),ls=ti?ti.prototype:r,gr=ls?ls.valueOf:r,au=ls?ls.toString:r;function d(e){if(_e(e)&&!K(e)&&!(e instanceof ee)){if(e instanceof lt)return e;if(oe.call(e,"__wrapped__"))return ch(e)}return new lt(e)}var Vi=function(){function e(){}return function(t){if(!we(t))return{};if(iu)return iu(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function ps(){}function lt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}d.templateSettings={escape:Ey,evaluate:Iy,interpolate:yc,variable:"",imports:{_:d}},d.prototype=ps.prototype,d.prototype.constructor=d,lt.prototype=Vi(ps.prototype),lt.prototype.constructor=lt;function ee(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=xt,this.__views__=[]}function um(){var e=new ee(this.__wrapped__);return e.__actions__=Je(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Je(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Je(this.__views__),e}function hm(){if(this.__filtered__){var e=new ee(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function lm(){var e=this.__wrapped__.value(),t=this.__dir__,n=K(e),h=t<0,l=n?e.length:0,f=I0(0,l,this.__views__),y=f.start,v=f.end,_=v-y,P=h?v:y-1,S=this.__iteratees__,R=S.length,A=0,q=$e(_,this.__takeCount__);if(!n||!h&&l==_&&q==_)return Au(e,this.__actions__);var z=[];e:for(;_--&&A<q;){P+=t;for(var B=-1,M=e[P];++B<R;){var Q=S[B],te=Q.iteratee,rt=Q.type,He=te(M);if(rt==ny)M=He;else if(!He){if(rt==lc)continue e;break e}}z[A++]=M}return z}ee.prototype=Vi(ps.prototype),ee.prototype.constructor=ee;function yi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function pm(){this.__data__=fr?fr(null):{},this.size=0}function dm(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function fm(e){var t=this.__data__;if(fr){var n=t[e];return n===b?r:n}return oe.call(t,e)?t[e]:r}function gm(e){var t=this.__data__;return fr?t[e]!==r:oe.call(t,e)}function ym(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=fr&&t===r?b:t,this}yi.prototype.clear=pm,yi.prototype.delete=dm,yi.prototype.get=fm,yi.prototype.has=gm,yi.prototype.set=ym;function jt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function vm(){this.__data__=[],this.size=0}function mm(e){var t=this.__data__,n=ds(t,e);if(n<0)return!1;var h=t.length-1;return n==h?t.pop():os.call(t,n,1),--this.size,!0}function wm(e){var t=this.__data__,n=ds(t,e);return n<0?r:t[n][1]}function _m(e){return ds(this.__data__,e)>-1}function bm(e,t){var n=this.__data__,h=ds(n,e);return h<0?(++this.size,n.push([e,t])):n[h][1]=t,this}jt.prototype.clear=vm,jt.prototype.delete=mm,jt.prototype.get=wm,jt.prototype.has=_m,jt.prototype.set=bm;function $t(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Em(){this.size=0,this.__data__={hash:new yi,map:new(pr||jt),string:new yi}}function Im(e){var t=xs(this,e).delete(e);return this.size-=t?1:0,t}function Pm(e){return xs(this,e).get(e)}function xm(e){return xs(this,e).has(e)}function Sm(e,t){var n=xs(this,e),h=n.size;return n.set(e,t),this.size+=n.size==h?0:1,this}$t.prototype.clear=Em,$t.prototype.delete=Im,$t.prototype.get=Pm,$t.prototype.has=xm,$t.prototype.set=Sm;function vi(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new $t;++t<n;)this.add(e[t])}function Rm(e){return this.__data__.set(e,b),this}function Om(e){return this.__data__.has(e)}vi.prototype.add=vi.prototype.push=Rm,vi.prototype.has=Om;function _t(e){var t=this.__data__=new jt(e);this.size=t.size}function Nm(){this.__data__=new jt,this.size=0}function Cm(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Am(e){return this.__data__.get(e)}function Dm(e){return this.__data__.has(e)}function Fm(e,t){var n=this.__data__;if(n instanceof jt){var h=n.__data__;if(!pr||h.length<a-1)return h.push([e,t]),this.size=++n.size,this;n=this.__data__=new $t(h)}return n.set(e,t),this.size=n.size,this}_t.prototype.clear=Nm,_t.prototype.delete=Cm,_t.prototype.get=Am,_t.prototype.has=Dm,_t.prototype.set=Fm;function cu(e,t){var n=K(e),h=!n&&Ei(e),l=!n&&!h&&oi(e),f=!n&&!h&&!l&&Gi(e),y=n||h||l||f,v=y?Ln(e.length,Vv):[],_=v.length;for(var P in e)(t||oe.call(e,P))&&!(y&&(P=="length"||l&&(P=="offset"||P=="parent")||f&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||Mt(P,_)))&&v.push(P);return v}function uu(e){var t=e.length;return t?e[io(0,t-1)]:r}function Tm(e,t){return Ss(Je(e),mi(t,0,e.length))}function qm(e){return Ss(Je(e))}function Bn(e,t,n){(n!==r&&!bt(e[t],n)||n===r&&!(t in e))&&Ut(e,t,n)}function yr(e,t,n){var h=e[t];(!(oe.call(e,t)&&bt(h,n))||n===r&&!(t in e))&&Ut(e,t,n)}function ds(e,t){for(var n=e.length;n--;)if(bt(e[n][0],t))return n;return-1}function jm(e,t,n,h){return ii(e,function(l,f,y){t(h,l,n(l),y)}),h}function hu(e,t){return e&&Rt(t,Ce(t),e)}function $m(e,t){return e&&Rt(t,Qe(t),e)}function Ut(e,t,n){t=="__proto__"&&as?as(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Gn(e,t){for(var n=-1,h=t.length,l=E(h),f=e==null;++n<h;)l[n]=f?r:Oo(e,t[n]);return l}function mi(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function pt(e,t,n,h,l,f){var y,v=t&O,_=t&j,P=t&ne;if(n&&(y=l?n(e,h,l,f):n(e)),y!==r)return y;if(!we(e))return e;var S=K(e);if(S){if(y=x0(e),!v)return Je(e,y)}else{var R=Ue(e),A=R==Hr||R==pc;if(oi(e))return Tu(e,v);if(R==qt||R==Fi||A&&!l){if(y=_||A?{}:Xu(e),!v)return _?f0(e,$m(y,e)):d0(e,hu(y,e))}else{if(!pe[R])return l?e:{};y=S0(e,R,v)}}f||(f=new _t);var q=f.get(e);if(q)return q;f.set(e,y),Oh(e)?e.forEach(function(M){y.add(pt(M,t,n,M,e,f))}):Sh(e)&&e.forEach(function(M,Q){y.set(Q,pt(M,t,n,Q,e,f))});var z=P?_?fo:po:_?Qe:Ce,B=S?r:z(e);return ut(B||e,function(M,Q){B&&(Q=M,M=e[Q]),yr(y,Q,pt(M,t,n,Q,e,f))}),y}function Um(e){var t=Ce(e);return function(n){return lu(n,e,t)}}function lu(e,t,n){var h=n.length;if(e==null)return!h;for(e=ue(e);h--;){var l=n[h],f=t[l],y=e[l];if(y===r&&!(l in e)||!f(y))return!1}return!0}function pu(e,t,n){if(typeof e!="function")throw new ht(g);return Ir(function(){e.apply(r,n)},t)}function vr(e,t,n,h){var l=-1,f=Qr,y=!0,v=e.length,_=[],P=t.length;if(!v)return _;n&&(t=ve(t,et(n))),h?(f=Fn,y=!1):t.length>=a&&(f=hr,y=!1,t=new vi(t));e:for(;++l<v;){var S=e[l],R=n==null?S:n(S);if(S=h||S!==0?S:0,y&&R===R){for(var A=P;A--;)if(t[A]===R)continue e;_.push(S)}else f(t,R,h)||_.push(S)}return _}var ii=Lu(St),du=Lu(Wn,!0);function Lm(e,t){var n=!0;return ii(e,function(h,l,f){return n=!!t(h,l,f),n}),n}function fs(e,t,n){for(var h=-1,l=e.length;++h<l;){var f=e[h],y=t(f);if(y!=null&&(v===r?y===y&&!it(y):n(y,v)))var v=y,_=f}return _}function zm(e,t,n,h){var l=e.length;for(n=H(n),n<0&&(n=-n>l?0:l+n),h=h===r||h>l?l:H(h),h<0&&(h+=l),h=n>h?0:Ch(h);n<h;)e[n++]=t;return e}function fu(e,t){var n=[];return ii(e,function(h,l,f){t(h,l,f)&&n.push(h)}),n}function qe(e,t,n,h,l){var f=-1,y=e.length;for(n||(n=O0),l||(l=[]);++f<y;){var v=e[f];t>0&&n(v)?t>1?qe(v,t-1,n,h,l):Xt(l,v):h||(l[l.length]=v)}return l}var Jn=zu(),gu=zu(!0);function St(e,t){return e&&Jn(e,t,Ce)}function Wn(e,t){return e&&gu(e,t,Ce)}function gs(e,t){return Zt(t,function(n){return kt(e[n])})}function wi(e,t){t=si(t,e);for(var n=0,h=t.length;e!=null&&n<h;)e=e[Ot(t[n++])];return n&&n==h?e:r}function yu(e,t,n){var h=t(e);return K(e)?h:Xt(h,n(e))}function Ve(e){return e==null?e===r?gy:dy:gi&&gi in ue(e)?E0(e):q0(e)}function Qn(e,t){return e>t}function Mm(e,t){return e!=null&&oe.call(e,t)}function km(e,t){return e!=null&&t in ue(e)}function Vm(e,t,n){return e>=$e(t,n)&&e<Oe(t,n)}function Yn(e,t,n){for(var h=n?Fn:Qr,l=e[0].length,f=e.length,y=f,v=E(f),_=1/0,P=[];y--;){var S=e[y];y&&t&&(S=ve(S,et(t))),_=$e(S.length,_),v[y]=!n&&(t||l>=120&&S.length>=120)?new vi(y&&S):r}S=e[0];var R=-1,A=v[0];e:for(;++R<l&&P.length<_;){var q=S[R],z=t?t(q):q;if(q=n||q!==0?q:0,!(A?hr(A,z):h(P,z,n))){for(y=f;--y;){var B=v[y];if(!(B?hr(B,z):h(e[y],z,n)))continue e}A&&A.push(z),P.push(q)}}return P}function Km(e,t,n,h){return St(e,function(l,f,y){t(h,n(l),f,y)}),h}function mr(e,t,n){t=si(t,e),e=rh(e,t);var h=e==null?e:e[Ot(ft(t))];return h==null?r:Xe(h,e,n)}function vu(e){return _e(e)&&Ve(e)==Fi}function Hm(e){return _e(e)&&Ve(e)==ur}function Bm(e){return _e(e)&&Ve(e)==sr}function wr(e,t,n,h,l){return e===t?!0:e==null||t==null||!_e(e)&&!_e(t)?e!==e&&t!==t:Gm(e,t,n,h,wr,l)}function Gm(e,t,n,h,l,f){var y=K(e),v=K(t),_=y?Vr:Ue(e),P=v?Vr:Ue(t);_=_==Fi?qt:_,P=P==Fi?qt:P;var S=_==qt,R=P==qt,A=_==P;if(A&&oi(e)){if(!oi(t))return!1;y=!0,S=!1}if(A&&!S)return f||(f=new _t),y||Gi(e)?Qu(e,t,n,h,l,f):_0(e,t,_,n,h,l,f);if(!(n&T)){var q=S&&oe.call(e,"__wrapped__"),z=R&&oe.call(t,"__wrapped__");if(q||z){var B=q?e.value():e,M=z?t.value():t;return f||(f=new _t),l(B,M,n,h,f)}}return A?(f||(f=new _t),b0(e,t,n,h,l,f)):!1}function Jm(e){return _e(e)&&Ue(e)==vt}function Zn(e,t,n,h){var l=n.length,f=l,y=!h;if(e==null)return!f;for(e=ue(e);l--;){var v=n[l];if(y&&v[2]?v[1]!==e[v[0]]:!(v[0]in e))return!1}for(;++l<f;){v=n[l];var _=v[0],P=e[_],S=v[1];if(y&&v[2]){if(P===r&&!(_ in e))return!1}else{var R=new _t;if(h)var A=h(P,S,_,e,t,R);if(!(A===r?wr(S,P,T|k,h,R):A))return!1}}return!0}function mu(e){if(!we(e)||C0(e))return!1;var t=kt(e)?Jv:Uy;return t.test(bi(e))}function Wm(e){return _e(e)&&Ve(e)==or}function Qm(e){return _e(e)&&Ue(e)==mt}function Ym(e){return _e(e)&&Ds(e.length)&&!!fe[Ve(e)]}function wu(e){return typeof e=="function"?e:e==null?Ye:typeof e=="object"?K(e)?Eu(e[0],e[1]):bu(e):Mh(e)}function Xn(e){if(!Er(e))return em(e);var t=[];for(var n in ue(e))oe.call(e,n)&&n!="constructor"&&t.push(n);return t}function Zm(e){if(!we(e))return T0(e);var t=Er(e),n=[];for(var h in e)h=="constructor"&&(t||!oe.call(e,h))||n.push(h);return n}function eo(e,t){return e<t}function _u(e,t){var n=-1,h=We(e)?E(e.length):[];return ii(e,function(l,f,y){h[++n]=t(l,f,y)}),h}function bu(e){var t=yo(e);return t.length==1&&t[0][2]?th(t[0][0],t[0][1]):function(n){return n===e||Zn(n,e,t)}}function Eu(e,t){return mo(e)&&eh(t)?th(Ot(e),t):function(n){var h=Oo(n,e);return h===r&&h===t?No(n,e):wr(t,h,T|k)}}function ys(e,t,n,h,l){e!==t&&Jn(t,function(f,y){if(l||(l=new _t),we(f))Xm(e,t,y,n,ys,h,l);else{var v=h?h(_o(e,y),f,y+"",e,t,l):r;v===r&&(v=f),Bn(e,y,v)}},Qe)}function Xm(e,t,n,h,l,f,y){var v=_o(e,n),_=_o(t,n),P=y.get(_);if(P){Bn(e,n,P);return}var S=f?f(v,_,n+"",e,t,y):r,R=S===r;if(R){var A=K(_),q=!A&&oi(_),z=!A&&!q&&Gi(_);S=_,A||q||z?K(v)?S=v:Ie(v)?S=Je(v):q?(R=!1,S=Tu(_,!0)):z?(R=!1,S=qu(_,!0)):S=[]:Pr(_)||Ei(_)?(S=v,Ei(v)?S=Ah(v):(!we(v)||kt(v))&&(S=Xu(_))):R=!1}R&&(y.set(_,S),l(S,_,h,f,y),y.delete(_)),Bn(e,n,S)}function Iu(e,t){var n=e.length;if(n)return t+=t<0?n:0,Mt(t,n)?e[t]:r}function Pu(e,t,n){t.length?t=ve(t,function(f){return K(f)?function(y){return wi(y,f.length===1?f[0]:f)}:f}):t=[Ye];var h=-1;t=ve(t,et(U()));var l=_u(e,function(f,y,v){var _=ve(t,function(P){return P(f)});return{criteria:_,index:++h,value:f}});return Sv(l,function(f,y){return p0(f,y,n)})}function e0(e,t){return xu(e,t,function(n,h){return No(e,h)})}function xu(e,t,n){for(var h=-1,l=t.length,f={};++h<l;){var y=t[h],v=wi(e,y);n(v,y)&&_r(f,si(y,e),v)}return f}function t0(e){return function(t){return wi(t,e)}}function to(e,t,n,h){var l=h?xv:ji,f=-1,y=t.length,v=e;for(e===t&&(t=Je(t)),n&&(v=ve(e,et(n)));++f<y;)for(var _=0,P=t[f],S=n?n(P):P;(_=l(v,S,_,h))>-1;)v!==e&&os.call(v,_,1),os.call(e,_,1);return e}function Su(e,t){for(var n=e?t.length:0,h=n-1;n--;){var l=t[n];if(n==h||l!==f){var f=l;Mt(l)?os.call(e,l,1):no(e,l)}}return e}function io(e,t){return e+us(ou()*(t-e+1))}function i0(e,t,n,h){for(var l=-1,f=Oe(cs((t-e)/(n||1)),0),y=E(f);f--;)y[h?f:++l]=e,e+=n;return y}function ro(e,t){var n="";if(!e||t<1||t>Yt)return n;do t%2&&(n+=e),t=us(t/2),t&&(e+=e);while(t);return n}function J(e,t){return bo(ih(e,t,Ye),e+"")}function r0(e){return uu(Ji(e))}function s0(e,t){var n=Ji(e);return Ss(n,mi(t,0,n.length))}function _r(e,t,n,h){if(!we(e))return e;t=si(t,e);for(var l=-1,f=t.length,y=f-1,v=e;v!=null&&++l<f;){var _=Ot(t[l]),P=n;if(_==="__proto__"||_==="constructor"||_==="prototype")return e;if(l!=y){var S=v[_];P=h?h(S,_,v):r,P===r&&(P=we(S)?S:Mt(t[l+1])?[]:{})}yr(v,_,P),v=v[_]}return e}var Ru=hs?function(e,t){return hs.set(e,t),e}:Ye,n0=as?function(e,t){return as(e,"toString",{configurable:!0,enumerable:!1,value:Ao(t),writable:!0})}:Ye;function o0(e){return Ss(Ji(e))}function dt(e,t,n){var h=-1,l=e.length;t<0&&(t=-t>l?0:l+t),n=n>l?l:n,n<0&&(n+=l),l=t>n?0:n-t>>>0,t>>>=0;for(var f=E(l);++h<l;)f[h]=e[h+t];return f}function a0(e,t){var n;return ii(e,function(h,l,f){return n=t(h,l,f),!n}),!!n}function vs(e,t,n){var h=0,l=e==null?h:e.length;if(typeof t=="number"&&t===t&&l<=uy){for(;h<l;){var f=h+l>>>1,y=e[f];y!==null&&!it(y)&&(n?y<=t:y<t)?h=f+1:l=f}return l}return so(e,t,Ye,n)}function so(e,t,n,h){var l=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var y=t!==t,v=t===null,_=it(t),P=t===r;l<f;){var S=us((l+f)/2),R=n(e[S]),A=R!==r,q=R===null,z=R===R,B=it(R);if(y)var M=h||z;else P?M=z&&(h||A):v?M=z&&A&&(h||!q):_?M=z&&A&&!q&&(h||!B):q||B?M=!1:M=h?R<=t:R<t;M?l=S+1:f=S}return $e(f,cy)}function Ou(e,t){for(var n=-1,h=e.length,l=0,f=[];++n<h;){var y=e[n],v=t?t(y):y;if(!n||!bt(v,_)){var _=v;f[l++]=y===0?0:y}}return f}function Nu(e){return typeof e=="number"?e:it(e)?kr:+e}function tt(e){if(typeof e=="string")return e;if(K(e))return ve(e,tt)+"";if(it(e))return au?au.call(e):"";var t=e+"";return t=="0"&&1/e==-di?"-0":t}function ri(e,t,n){var h=-1,l=Qr,f=e.length,y=!0,v=[],_=v;if(n)y=!1,l=Fn;else if(f>=a){var P=t?null:m0(e);if(P)return Zr(P);y=!1,l=hr,_=new vi}else _=t?[]:v;e:for(;++h<f;){var S=e[h],R=t?t(S):S;if(S=n||S!==0?S:0,y&&R===R){for(var A=_.length;A--;)if(_[A]===R)continue e;t&&_.push(R),v.push(S)}else l(_,R,n)||(_!==v&&_.push(R),v.push(S))}return v}function no(e,t){return t=si(t,e),e=rh(e,t),e==null||delete e[Ot(ft(t))]}function Cu(e,t,n,h){return _r(e,t,n(wi(e,t)),h)}function ms(e,t,n,h){for(var l=e.length,f=h?l:-1;(h?f--:++f<l)&&t(e[f],f,e););return n?dt(e,h?0:f,h?f+1:l):dt(e,h?f+1:0,h?l:f)}function Au(e,t){var n=e;return n instanceof ee&&(n=n.value()),Tn(t,function(h,l){return l.func.apply(l.thisArg,Xt([h],l.args))},n)}function oo(e,t,n){var h=e.length;if(h<2)return h?ri(e[0]):[];for(var l=-1,f=E(h);++l<h;)for(var y=e[l],v=-1;++v<h;)v!=l&&(f[l]=vr(f[l]||y,e[v],t,n));return ri(qe(f,1),t,n)}function Du(e,t,n){for(var h=-1,l=e.length,f=t.length,y={};++h<l;){var v=h<f?t[h]:r;n(y,e[h],v)}return y}function ao(e){return Ie(e)?e:[]}function co(e){return typeof e=="function"?e:Ye}function si(e,t){return K(e)?e:mo(e,t)?[e]:ah(se(e))}var c0=J;function ni(e,t,n){var h=e.length;return n=n===r?h:n,!t&&n>=h?e:dt(e,t,n)}var Fu=Wv||function(e){return Te.clearTimeout(e)};function Tu(e,t){if(t)return e.slice();var n=e.length,h=tu?tu(n):new e.constructor(n);return e.copy(h),h}function uo(e){var t=new e.constructor(e.byteLength);return new ss(t).set(new ss(e)),t}function u0(e,t){var n=t?uo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function h0(e){var t=new e.constructor(e.source,vc.exec(e));return t.lastIndex=e.lastIndex,t}function l0(e){return gr?ue(gr.call(e)):{}}function qu(e,t){var n=t?uo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ju(e,t){if(e!==t){var n=e!==r,h=e===null,l=e===e,f=it(e),y=t!==r,v=t===null,_=t===t,P=it(t);if(!v&&!P&&!f&&e>t||f&&y&&_&&!v&&!P||h&&y&&_||!n&&_||!l)return 1;if(!h&&!f&&!P&&e<t||P&&n&&l&&!h&&!f||v&&n&&l||!y&&l||!_)return-1}return 0}function p0(e,t,n){for(var h=-1,l=e.criteria,f=t.criteria,y=l.length,v=n.length;++h<y;){var _=ju(l[h],f[h]);if(_){if(h>=v)return _;var P=n[h];return _*(P=="desc"?-1:1)}}return e.index-t.index}function $u(e,t,n,h){for(var l=-1,f=e.length,y=n.length,v=-1,_=t.length,P=Oe(f-y,0),S=E(_+P),R=!h;++v<_;)S[v]=t[v];for(;++l<y;)(R||l<f)&&(S[n[l]]=e[l]);for(;P--;)S[v++]=e[l++];return S}function Uu(e,t,n,h){for(var l=-1,f=e.length,y=-1,v=n.length,_=-1,P=t.length,S=Oe(f-v,0),R=E(S+P),A=!h;++l<S;)R[l]=e[l];for(var q=l;++_<P;)R[q+_]=t[_];for(;++y<v;)(A||l<f)&&(R[q+n[y]]=e[l++]);return R}function Je(e,t){var n=-1,h=e.length;for(t||(t=E(h));++n<h;)t[n]=e[n];return t}function Rt(e,t,n,h){var l=!n;n||(n={});for(var f=-1,y=t.length;++f<y;){var v=t[f],_=h?h(n[v],e[v],v,n,e):r;_===r&&(_=e[v]),l?Ut(n,v,_):yr(n,v,_)}return n}function d0(e,t){return Rt(e,vo(e),t)}function f0(e,t){return Rt(e,Yu(e),t)}function ws(e,t){return function(n,h){var l=K(n)?wv:jm,f=t?t():{};return l(n,e,U(h,2),f)}}function Ki(e){return J(function(t,n){var h=-1,l=n.length,f=l>1?n[l-1]:r,y=l>2?n[2]:r;for(f=e.length>3&&typeof f=="function"?(l--,f):r,y&&Ke(n[0],n[1],y)&&(f=l<3?r:f,l=1),t=ue(t);++h<l;){var v=n[h];v&&e(t,v,h,f)}return t})}function Lu(e,t){return function(n,h){if(n==null)return n;if(!We(n))return e(n,h);for(var l=n.length,f=t?l:-1,y=ue(n);(t?f--:++f<l)&&h(y[f],f,y)!==!1;);return n}}function zu(e){return function(t,n,h){for(var l=-1,f=ue(t),y=h(t),v=y.length;v--;){var _=y[e?v:++l];if(n(f[_],_,f)===!1)break}return t}}function g0(e,t,n){var h=t&W,l=br(e);function f(){var y=this&&this!==Te&&this instanceof f?l:e;return y.apply(h?n:this,arguments)}return f}function Mu(e){return function(t){t=se(t);var n=$i(t)?wt(t):r,h=n?n[0]:t.charAt(0),l=n?ni(n,1).join(""):t.slice(1);return h[e]()+l}}function Hi(e){return function(t){return Tn(Lh(Uh(t).replace(nv,"")),e,"")}}function br(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Vi(e.prototype),h=e.apply(n,t);return we(h)?h:n}}function y0(e,t,n){var h=br(e);function l(){for(var f=arguments.length,y=E(f),v=f,_=Bi(l);v--;)y[v]=arguments[v];var P=f<3&&y[0]!==_&&y[f-1]!==_?[]:ei(y,_);if(f-=P.length,f<n)return Bu(e,t,_s,l.placeholder,r,y,P,r,r,n-f);var S=this&&this!==Te&&this instanceof l?h:e;return Xe(S,this,y)}return l}function ku(e){return function(t,n,h){var l=ue(t);if(!We(t)){var f=U(n,3);t=Ce(t),n=function(v){return f(l[v],v,l)}}var y=e(t,n,h);return y>-1?l[f?t[y]:y]:r}}function Vu(e){return zt(function(t){var n=t.length,h=n,l=lt.prototype.thru;for(e&&t.reverse();h--;){var f=t[h];if(typeof f!="function")throw new ht(g);if(l&&!y&&Ps(f)=="wrapper")var y=new lt([],!0)}for(h=y?h:n;++h<n;){f=t[h];var v=Ps(f),_=v=="wrapper"?go(f):r;_&&wo(_[0])&&_[1]==(Ee|le|G|ke)&&!_[4].length&&_[9]==1?y=y[Ps(_[0])].apply(y,_[3]):y=f.length==1&&wo(f)?y[v]():y.thru(f)}return function(){var P=arguments,S=P[0];if(y&&P.length==1&&K(S))return y.plant(S).value();for(var R=0,A=n?t[R].apply(this,P):S;++R<n;)A=t[R].call(this,A);return A}})}function _s(e,t,n,h,l,f,y,v,_,P){var S=t&Ee,R=t&W,A=t&ce,q=t&(le|ie),z=t&Qt,B=A?r:br(e);function M(){for(var Q=arguments.length,te=E(Q),rt=Q;rt--;)te[rt]=arguments[rt];if(q)var He=Bi(M),st=Ov(te,He);if(h&&(te=$u(te,h,l,q)),f&&(te=Uu(te,f,y,q)),Q-=st,q&&Q<P){var Pe=ei(te,He);return Bu(e,t,_s,M.placeholder,n,te,Pe,v,_,P-Q)}var Et=R?n:this,Kt=A?Et[e]:e;return Q=te.length,v?te=j0(te,v):z&&Q>1&&te.reverse(),S&&_<Q&&(te.length=_),this&&this!==Te&&this instanceof M&&(Kt=B||br(Kt)),Kt.apply(Et,te)}return M}function Ku(e,t){return function(n,h){return Km(n,e,t(h),{})}}function bs(e,t){return function(n,h){var l;if(n===r&&h===r)return t;if(n!==r&&(l=n),h!==r){if(l===r)return h;typeof n=="string"||typeof h=="string"?(n=tt(n),h=tt(h)):(n=Nu(n),h=Nu(h)),l=e(n,h)}return l}}function ho(e){return zt(function(t){return t=ve(t,et(U())),J(function(n){var h=this;return e(t,function(l){return Xe(l,h,n)})})})}function Es(e,t){t=t===r?" ":tt(t);var n=t.length;if(n<2)return n?ro(t,e):t;var h=ro(t,cs(e/Ui(t)));return $i(t)?ni(wt(h),0,e).join(""):h.slice(0,e)}function v0(e,t,n,h){var l=t&W,f=br(e);function y(){for(var v=-1,_=arguments.length,P=-1,S=h.length,R=E(S+_),A=this&&this!==Te&&this instanceof y?f:e;++P<S;)R[P]=h[P];for(;_--;)R[P++]=arguments[++v];return Xe(A,l?n:this,R)}return y}function Hu(e){return function(t,n,h){return h&&typeof h!="number"&&Ke(t,n,h)&&(n=h=r),t=Vt(t),n===r?(n=t,t=0):n=Vt(n),h=h===r?t<n?1:-1:Vt(h),i0(t,n,h,e)}}function Is(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=gt(t),n=gt(n)),e(t,n)}}function Bu(e,t,n,h,l,f,y,v,_,P){var S=t&le,R=S?y:r,A=S?r:y,q=S?f:r,z=S?r:f;t|=S?G:ye,t&=~(S?ye:G),t&De||(t&=~(W|ce));var B=[e,t,l,q,R,z,A,v,_,P],M=n.apply(r,B);return wo(e)&&sh(M,B),M.placeholder=h,nh(M,e,t)}function lo(e){var t=Re[e];return function(n,h){if(n=gt(n),h=h==null?0:$e(H(h),292),h&&nu(n)){var l=(se(n)+"e").split("e"),f=t(l[0]+"e"+(+l[1]+h));return l=(se(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-h))}return t(n)}}var m0=Mi&&1/Zr(new Mi([,-0]))[1]==di?function(e){return new Mi(e)}:To;function Gu(e){return function(t){var n=Ue(t);return n==vt?Mn(t):n==mt?qv(t):Rv(t,e(t))}}function Lt(e,t,n,h,l,f,y,v){var _=t&ce;if(!_&&typeof e!="function")throw new ht(g);var P=h?h.length:0;if(P||(t&=~(G|ye),h=l=r),y=y===r?y:Oe(H(y),0),v=v===r?v:H(v),P-=l?l.length:0,t&ye){var S=h,R=l;h=l=r}var A=_?r:go(e),q=[e,t,n,h,l,S,R,f,y,v];if(A&&F0(q,A),e=q[0],t=q[1],n=q[2],h=q[3],l=q[4],v=q[9]=q[9]===r?_?0:e.length:Oe(q[9]-P,0),!v&&t&(le|ie)&&(t&=~(le|ie)),!t||t==W)var z=g0(e,t,n);else t==le||t==ie?z=y0(e,t,v):(t==G||t==(W|G))&&!l.length?z=v0(e,t,n,h):z=_s.apply(r,q);var B=A?Ru:sh;return nh(B(z,q),e,t)}function Ju(e,t,n,h){return e===r||bt(e,zi[n])&&!oe.call(h,n)?t:e}function Wu(e,t,n,h,l,f){return we(e)&&we(t)&&(f.set(t,e),ys(e,t,r,Wu,f),f.delete(t)),e}function w0(e){return Pr(e)?r:e}function Qu(e,t,n,h,l,f){var y=n&T,v=e.length,_=t.length;if(v!=_&&!(y&&_>v))return!1;var P=f.get(e),S=f.get(t);if(P&&S)return P==t&&S==e;var R=-1,A=!0,q=n&k?new vi:r;for(f.set(e,t),f.set(t,e);++R<v;){var z=e[R],B=t[R];if(h)var M=y?h(B,z,R,t,e,f):h(z,B,R,e,t,f);if(M!==r){if(M)continue;A=!1;break}if(q){if(!qn(t,function(Q,te){if(!hr(q,te)&&(z===Q||l(z,Q,n,h,f)))return q.push(te)})){A=!1;break}}else if(!(z===B||l(z,B,n,h,f))){A=!1;break}}return f.delete(e),f.delete(t),A}function _0(e,t,n,h,l,f,y){switch(n){case Ti:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ur:return!(e.byteLength!=t.byteLength||!f(new ss(e),new ss(t)));case rr:case sr:case nr:return bt(+e,+t);case Kr:return e.name==t.name&&e.message==t.message;case or:case ar:return e==t+"";case vt:var v=Mn;case mt:var _=h&T;if(v||(v=Zr),e.size!=t.size&&!_)return!1;var P=y.get(e);if(P)return P==t;h|=k,y.set(e,t);var S=Qu(v(e),v(t),h,l,f,y);return y.delete(e),S;case Br:if(gr)return gr.call(e)==gr.call(t)}return!1}function b0(e,t,n,h,l,f){var y=n&T,v=po(e),_=v.length,P=po(t),S=P.length;if(_!=S&&!y)return!1;for(var R=_;R--;){var A=v[R];if(!(y?A in t:oe.call(t,A)))return!1}var q=f.get(e),z=f.get(t);if(q&&z)return q==t&&z==e;var B=!0;f.set(e,t),f.set(t,e);for(var M=y;++R<_;){A=v[R];var Q=e[A],te=t[A];if(h)var rt=y?h(te,Q,A,t,e,f):h(Q,te,A,e,t,f);if(!(rt===r?Q===te||l(Q,te,n,h,f):rt)){B=!1;break}M||(M=A=="constructor")}if(B&&!M){var He=e.constructor,st=t.constructor;He!=st&&"constructor"in e&&"constructor"in t&&!(typeof He=="function"&&He instanceof He&&typeof st=="function"&&st instanceof st)&&(B=!1)}return f.delete(e),f.delete(t),B}function zt(e){return bo(ih(e,r,lh),e+"")}function po(e){return yu(e,Ce,vo)}function fo(e){return yu(e,Qe,Yu)}var go=hs?function(e){return hs.get(e)}:To;function Ps(e){for(var t=e.name+"",n=ki[t],h=oe.call(ki,t)?n.length:0;h--;){var l=n[h],f=l.func;if(f==null||f==e)return l.name}return t}function Bi(e){var t=oe.call(d,"placeholder")?d:e;return t.placeholder}function U(){var e=d.iteratee||Do;return e=e===Do?wu:e,arguments.length?e(arguments[0],arguments[1]):e}function xs(e,t){var n=e.__data__;return N0(t)?n[typeof t=="string"?"string":"hash"]:n.map}function yo(e){for(var t=Ce(e),n=t.length;n--;){var h=t[n],l=e[h];t[n]=[h,l,eh(l)]}return t}function _i(e,t){var n=Dv(e,t);return mu(n)?n:r}function E0(e){var t=oe.call(e,gi),n=e[gi];try{e[gi]=r;var h=!0}catch{}var l=is.call(e);return h&&(t?e[gi]=n:delete e[gi]),l}var vo=Vn?function(e){return e==null?[]:(e=ue(e),Zt(Vn(e),function(t){return ru.call(e,t)}))}:qo,Yu=Vn?function(e){for(var t=[];e;)Xt(t,vo(e)),e=ns(e);return t}:qo,Ue=Ve;(Kn&&Ue(new Kn(new ArrayBuffer(1)))!=Ti||pr&&Ue(new pr)!=vt||Hn&&Ue(Hn.resolve())!=dc||Mi&&Ue(new Mi)!=mt||dr&&Ue(new dr)!=cr)&&(Ue=function(e){var t=Ve(e),n=t==qt?e.constructor:r,h=n?bi(n):"";if(h)switch(h){case sm:return Ti;case nm:return vt;case om:return dc;case am:return mt;case cm:return cr}return t});function I0(e,t,n){for(var h=-1,l=n.length;++h<l;){var f=n[h],y=f.size;switch(f.type){case"drop":e+=y;break;case"dropRight":t-=y;break;case"take":t=$e(t,e+y);break;case"takeRight":e=Oe(e,t-y);break}}return{start:e,end:t}}function P0(e){var t=e.match(Cy);return t?t[1].split(Ay):[]}function Zu(e,t,n){t=si(t,e);for(var h=-1,l=t.length,f=!1;++h<l;){var y=Ot(t[h]);if(!(f=e!=null&&n(e,y)))break;e=e[y]}return f||++h!=l?f:(l=e==null?0:e.length,!!l&&Ds(l)&&Mt(y,l)&&(K(e)||Ei(e)))}function x0(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&oe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Xu(e){return typeof e.constructor=="function"&&!Er(e)?Vi(ns(e)):{}}function S0(e,t,n){var h=e.constructor;switch(t){case ur:return uo(e);case rr:case sr:return new h(+e);case Ti:return u0(e,n);case gn:case yn:case vn:case mn:case wn:case _n:case bn:case En:case In:return qu(e,n);case vt:return new h;case nr:case ar:return new h(e);case or:return h0(e);case mt:return new h;case Br:return l0(e)}}function R0(e,t){var n=t.length;if(!n)return e;var h=n-1;return t[h]=(n>1?"& ":"")+t[h],t=t.join(n>2?", ":" "),e.replace(Ny,`{
/* [wrapped with `+t+`] */
`)}function O0(e){return K(e)||Ei(e)||!!(su&&e&&e[su])}function Mt(e,t){var n=typeof e;return t=t??Yt,!!t&&(n=="number"||n!="symbol"&&zy.test(e))&&e>-1&&e%1==0&&e<t}function Ke(e,t,n){if(!we(n))return!1;var h=typeof t;return(h=="number"?We(n)&&Mt(t,n.length):h=="string"&&t in n)?bt(n[t],e):!1}function mo(e,t){if(K(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||it(e)?!0:xy.test(e)||!Py.test(e)||t!=null&&e in ue(t)}function N0(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function wo(e){var t=Ps(e),n=d[t];if(typeof n!="function"||!(t in ee.prototype))return!1;if(e===n)return!0;var h=go(n);return!!h&&e===h[0]}function C0(e){return!!eu&&eu in e}var A0=es?kt:jo;function Er(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||zi;return e===n}function eh(e){return e===e&&!we(e)}function th(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in ue(n))}}function D0(e){var t=Cs(e,function(h){return n.size===x&&n.clear(),h}),n=t.cache;return t}function F0(e,t){var n=e[1],h=t[1],l=n|h,f=l<(W|ce|Ee),y=h==Ee&&n==le||h==Ee&&n==ke&&e[7].length<=t[8]||h==(Ee|ke)&&t[7].length<=t[8]&&n==le;if(!(f||y))return e;h&W&&(e[2]=t[2],l|=n&W?0:De);var v=t[3];if(v){var _=e[3];e[3]=_?$u(_,v,t[4]):v,e[4]=_?ei(e[3],N):t[4]}return v=t[5],v&&(_=e[5],e[5]=_?Uu(_,v,t[6]):v,e[6]=_?ei(e[5],N):t[6]),v=t[7],v&&(e[7]=v),h&Ee&&(e[8]=e[8]==null?t[8]:$e(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function T0(e){var t=[];if(e!=null)for(var n in ue(e))t.push(n);return t}function q0(e){return is.call(e)}function ih(e,t,n){return t=Oe(t===r?e.length-1:t,0),function(){for(var h=arguments,l=-1,f=Oe(h.length-t,0),y=E(f);++l<f;)y[l]=h[t+l];l=-1;for(var v=E(t+1);++l<t;)v[l]=h[l];return v[t]=n(y),Xe(e,this,v)}}function rh(e,t){return t.length<2?e:wi(e,dt(t,0,-1))}function j0(e,t){for(var n=e.length,h=$e(t.length,n),l=Je(e);h--;){var f=t[h];e[h]=Mt(f,n)?l[f]:r}return e}function _o(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var sh=oh(Ru),Ir=Yv||function(e,t){return Te.setTimeout(e,t)},bo=oh(n0);function nh(e,t,n){var h=t+"";return bo(e,R0(h,$0(P0(h),n)))}function oh(e){var t=0,n=0;return function(){var h=tm(),l=sy-(h-n);if(n=h,l>0){if(++t>=ry)return arguments[0]}else t=0;return e.apply(r,arguments)}}function Ss(e,t){var n=-1,h=e.length,l=h-1;for(t=t===r?h:t;++n<t;){var f=io(n,l),y=e[f];e[f]=e[n],e[n]=y}return e.length=t,e}var ah=D0(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Sy,function(n,h,l,f){t.push(l?f.replace(Ty,"$1"):h||n)}),t});function Ot(e){if(typeof e=="string"||it(e))return e;var t=e+"";return t=="0"&&1/e==-di?"-0":t}function bi(e){if(e!=null){try{return ts.call(e)}catch{}try{return e+""}catch{}}return""}function $0(e,t){return ut(hy,function(n){var h="_."+n[0];t&n[1]&&!Qr(e,h)&&e.push(h)}),e.sort()}function ch(e){if(e instanceof ee)return e.clone();var t=new lt(e.__wrapped__,e.__chain__);return t.__actions__=Je(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function U0(e,t,n){(n?Ke(e,t,n):t===r)?t=1:t=Oe(H(t),0);var h=e==null?0:e.length;if(!h||t<1)return[];for(var l=0,f=0,y=E(cs(h/t));l<h;)y[f++]=dt(e,l,l+=t);return y}function L0(e){for(var t=-1,n=e==null?0:e.length,h=0,l=[];++t<n;){var f=e[t];f&&(l[h++]=f)}return l}function z0(){var e=arguments.length;if(!e)return[];for(var t=E(e-1),n=arguments[0],h=e;h--;)t[h-1]=arguments[h];return Xt(K(n)?Je(n):[n],qe(t,1))}var M0=J(function(e,t){return Ie(e)?vr(e,qe(t,1,Ie,!0)):[]}),k0=J(function(e,t){var n=ft(t);return Ie(n)&&(n=r),Ie(e)?vr(e,qe(t,1,Ie,!0),U(n,2)):[]}),V0=J(function(e,t){var n=ft(t);return Ie(n)&&(n=r),Ie(e)?vr(e,qe(t,1,Ie,!0),r,n):[]});function K0(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:H(t),dt(e,t<0?0:t,h)):[]}function H0(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:H(t),t=h-t,dt(e,0,t<0?0:t)):[]}function B0(e,t){return e&&e.length?ms(e,U(t,3),!0,!0):[]}function G0(e,t){return e&&e.length?ms(e,U(t,3),!0):[]}function J0(e,t,n,h){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Ke(e,t,n)&&(n=0,h=l),zm(e,t,n,h)):[]}function uh(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:H(n);return l<0&&(l=Oe(h+l,0)),Yr(e,U(t,3),l)}function hh(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h-1;return n!==r&&(l=H(n),l=n<0?Oe(h+l,0):$e(l,h-1)),Yr(e,U(t,3),l,!0)}function lh(e){var t=e==null?0:e.length;return t?qe(e,1):[]}function W0(e){var t=e==null?0:e.length;return t?qe(e,di):[]}function Q0(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:H(t),qe(e,t)):[]}function Y0(e){for(var t=-1,n=e==null?0:e.length,h={};++t<n;){var l=e[t];h[l[0]]=l[1]}return h}function ph(e){return e&&e.length?e[0]:r}function Z0(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:H(n);return l<0&&(l=Oe(h+l,0)),ji(e,t,l)}function X0(e){var t=e==null?0:e.length;return t?dt(e,0,-1):[]}var ew=J(function(e){var t=ve(e,ao);return t.length&&t[0]===e[0]?Yn(t):[]}),tw=J(function(e){var t=ft(e),n=ve(e,ao);return t===ft(n)?t=r:n.pop(),n.length&&n[0]===e[0]?Yn(n,U(t,2)):[]}),iw=J(function(e){var t=ft(e),n=ve(e,ao);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?Yn(n,r,t):[]});function rw(e,t){return e==null?"":Xv.call(e,t)}function ft(e){var t=e==null?0:e.length;return t?e[t-1]:r}function sw(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h;return n!==r&&(l=H(n),l=l<0?Oe(h+l,0):$e(l,h-1)),t===t?$v(e,t,l):Yr(e,Bc,l,!0)}function nw(e,t){return e&&e.length?Iu(e,H(t)):r}var ow=J(dh);function dh(e,t){return e&&e.length&&t&&t.length?to(e,t):e}function aw(e,t,n){return e&&e.length&&t&&t.length?to(e,t,U(n,2)):e}function cw(e,t,n){return e&&e.length&&t&&t.length?to(e,t,r,n):e}var uw=zt(function(e,t){var n=e==null?0:e.length,h=Gn(e,t);return Su(e,ve(t,function(l){return Mt(l,n)?+l:l}).sort(ju)),h});function hw(e,t){var n=[];if(!(e&&e.length))return n;var h=-1,l=[],f=e.length;for(t=U(t,3);++h<f;){var y=e[h];t(y,h,e)&&(n.push(y),l.push(h))}return Su(e,l),n}function Eo(e){return e==null?e:rm.call(e)}function lw(e,t,n){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Ke(e,t,n)?(t=0,n=h):(t=t==null?0:H(t),n=n===r?h:H(n)),dt(e,t,n)):[]}function pw(e,t){return vs(e,t)}function dw(e,t,n){return so(e,t,U(n,2))}function fw(e,t){var n=e==null?0:e.length;if(n){var h=vs(e,t);if(h<n&&bt(e[h],t))return h}return-1}function gw(e,t){return vs(e,t,!0)}function yw(e,t,n){return so(e,t,U(n,2),!0)}function vw(e,t){var n=e==null?0:e.length;if(n){var h=vs(e,t,!0)-1;if(bt(e[h],t))return h}return-1}function mw(e){return e&&e.length?Ou(e):[]}function ww(e,t){return e&&e.length?Ou(e,U(t,2)):[]}function _w(e){var t=e==null?0:e.length;return t?dt(e,1,t):[]}function bw(e,t,n){return e&&e.length?(t=n||t===r?1:H(t),dt(e,0,t<0?0:t)):[]}function Ew(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:H(t),t=h-t,dt(e,t<0?0:t,h)):[]}function Iw(e,t){return e&&e.length?ms(e,U(t,3),!1,!0):[]}function Pw(e,t){return e&&e.length?ms(e,U(t,3)):[]}var xw=J(function(e){return ri(qe(e,1,Ie,!0))}),Sw=J(function(e){var t=ft(e);return Ie(t)&&(t=r),ri(qe(e,1,Ie,!0),U(t,2))}),Rw=J(function(e){var t=ft(e);return t=typeof t=="function"?t:r,ri(qe(e,1,Ie,!0),r,t)});function Ow(e){return e&&e.length?ri(e):[]}function Nw(e,t){return e&&e.length?ri(e,U(t,2)):[]}function Cw(e,t){return t=typeof t=="function"?t:r,e&&e.length?ri(e,r,t):[]}function Io(e){if(!(e&&e.length))return[];var t=0;return e=Zt(e,function(n){if(Ie(n))return t=Oe(n.length,t),!0}),Ln(t,function(n){return ve(e,jn(n))})}function fh(e,t){if(!(e&&e.length))return[];var n=Io(e);return t==null?n:ve(n,function(h){return Xe(t,r,h)})}var Aw=J(function(e,t){return Ie(e)?vr(e,t):[]}),Dw=J(function(e){return oo(Zt(e,Ie))}),Fw=J(function(e){var t=ft(e);return Ie(t)&&(t=r),oo(Zt(e,Ie),U(t,2))}),Tw=J(function(e){var t=ft(e);return t=typeof t=="function"?t:r,oo(Zt(e,Ie),r,t)}),qw=J(Io);function jw(e,t){return Du(e||[],t||[],yr)}function $w(e,t){return Du(e||[],t||[],_r)}var Uw=J(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,fh(e,n)});function gh(e){var t=d(e);return t.__chain__=!0,t}function Lw(e,t){return t(e),e}function Rs(e,t){return t(e)}var zw=zt(function(e){var t=e.length,n=t?e[0]:0,h=this.__wrapped__,l=function(f){return Gn(f,e)};return t>1||this.__actions__.length||!(h instanceof ee)||!Mt(n)?this.thru(l):(h=h.slice(n,+n+(t?1:0)),h.__actions__.push({func:Rs,args:[l],thisArg:r}),new lt(h,this.__chain__).thru(function(f){return t&&!f.length&&f.push(r),f}))});function Mw(){return gh(this)}function kw(){return new lt(this.value(),this.__chain__)}function Vw(){this.__values__===r&&(this.__values__=Nh(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Kw(){return this}function Hw(e){for(var t,n=this;n instanceof ps;){var h=ch(n);h.__index__=0,h.__values__=r,t?l.__wrapped__=h:t=h;var l=h;n=n.__wrapped__}return l.__wrapped__=e,t}function Bw(){var e=this.__wrapped__;if(e instanceof ee){var t=e;return this.__actions__.length&&(t=new ee(this)),t=t.reverse(),t.__actions__.push({func:Rs,args:[Eo],thisArg:r}),new lt(t,this.__chain__)}return this.thru(Eo)}function Gw(){return Au(this.__wrapped__,this.__actions__)}var Jw=ws(function(e,t,n){oe.call(e,n)?++e[n]:Ut(e,n,1)});function Ww(e,t,n){var h=K(e)?Kc:Lm;return n&&Ke(e,t,n)&&(t=r),h(e,U(t,3))}function Qw(e,t){var n=K(e)?Zt:fu;return n(e,U(t,3))}var Yw=ku(uh),Zw=ku(hh);function Xw(e,t){return qe(Os(e,t),1)}function e_(e,t){return qe(Os(e,t),di)}function t_(e,t,n){return n=n===r?1:H(n),qe(Os(e,t),n)}function yh(e,t){var n=K(e)?ut:ii;return n(e,U(t,3))}function vh(e,t){var n=K(e)?_v:du;return n(e,U(t,3))}var i_=ws(function(e,t,n){oe.call(e,n)?e[n].push(t):Ut(e,n,[t])});function r_(e,t,n,h){e=We(e)?e:Ji(e),n=n&&!h?H(n):0;var l=e.length;return n<0&&(n=Oe(l+n,0)),Fs(e)?n<=l&&e.indexOf(t,n)>-1:!!l&&ji(e,t,n)>-1}var s_=J(function(e,t,n){var h=-1,l=typeof t=="function",f=We(e)?E(e.length):[];return ii(e,function(y){f[++h]=l?Xe(t,y,n):mr(y,t,n)}),f}),n_=ws(function(e,t,n){Ut(e,n,t)});function Os(e,t){var n=K(e)?ve:_u;return n(e,U(t,3))}function o_(e,t,n,h){return e==null?[]:(K(t)||(t=t==null?[]:[t]),n=h?r:n,K(n)||(n=n==null?[]:[n]),Pu(e,t,n))}var a_=ws(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function c_(e,t,n){var h=K(e)?Tn:Jc,l=arguments.length<3;return h(e,U(t,4),n,l,ii)}function u_(e,t,n){var h=K(e)?bv:Jc,l=arguments.length<3;return h(e,U(t,4),n,l,du)}function h_(e,t){var n=K(e)?Zt:fu;return n(e,As(U(t,3)))}function l_(e){var t=K(e)?uu:r0;return t(e)}function p_(e,t,n){(n?Ke(e,t,n):t===r)?t=1:t=H(t);var h=K(e)?Tm:s0;return h(e,t)}function d_(e){var t=K(e)?qm:o0;return t(e)}function f_(e){if(e==null)return 0;if(We(e))return Fs(e)?Ui(e):e.length;var t=Ue(e);return t==vt||t==mt?e.size:Xn(e).length}function g_(e,t,n){var h=K(e)?qn:a0;return n&&Ke(e,t,n)&&(t=r),h(e,U(t,3))}var y_=J(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Ke(e,t[0],t[1])?t=[]:n>2&&Ke(t[0],t[1],t[2])&&(t=[t[0]]),Pu(e,qe(t,1),[])}),Ns=Qv||function(){return Te.Date.now()};function v_(e,t){if(typeof t!="function")throw new ht(g);return e=H(e),function(){if(--e<1)return t.apply(this,arguments)}}function mh(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,Lt(e,Ee,r,r,r,r,t)}function wh(e,t){var n;if(typeof t!="function")throw new ht(g);return e=H(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var Po=J(function(e,t,n){var h=W;if(n.length){var l=ei(n,Bi(Po));h|=G}return Lt(e,h,t,n,l)}),_h=J(function(e,t,n){var h=W|ce;if(n.length){var l=ei(n,Bi(_h));h|=G}return Lt(t,h,e,n,l)});function bh(e,t,n){t=n?r:t;var h=Lt(e,le,r,r,r,r,r,t);return h.placeholder=bh.placeholder,h}function Eh(e,t,n){t=n?r:t;var h=Lt(e,ie,r,r,r,r,r,t);return h.placeholder=Eh.placeholder,h}function Ih(e,t,n){var h,l,f,y,v,_,P=0,S=!1,R=!1,A=!0;if(typeof e!="function")throw new ht(g);t=gt(t)||0,we(n)&&(S=!!n.leading,R="maxWait"in n,f=R?Oe(gt(n.maxWait)||0,t):f,A="trailing"in n?!!n.trailing:A);function q(Pe){var Et=h,Kt=l;return h=l=r,P=Pe,y=e.apply(Kt,Et),y}function z(Pe){return P=Pe,v=Ir(Q,t),S?q(Pe):y}function B(Pe){var Et=Pe-_,Kt=Pe-P,kh=t-Et;return R?$e(kh,f-Kt):kh}function M(Pe){var Et=Pe-_,Kt=Pe-P;return _===r||Et>=t||Et<0||R&&Kt>=f}function Q(){var Pe=Ns();if(M(Pe))return te(Pe);v=Ir(Q,B(Pe))}function te(Pe){return v=r,A&&h?q(Pe):(h=l=r,y)}function rt(){v!==r&&Fu(v),P=0,h=_=l=v=r}function He(){return v===r?y:te(Ns())}function st(){var Pe=Ns(),Et=M(Pe);if(h=arguments,l=this,_=Pe,Et){if(v===r)return z(_);if(R)return Fu(v),v=Ir(Q,t),q(_)}return v===r&&(v=Ir(Q,t)),y}return st.cancel=rt,st.flush=He,st}var m_=J(function(e,t){return pu(e,1,t)}),w_=J(function(e,t,n){return pu(e,gt(t)||0,n)});function __(e){return Lt(e,Qt)}function Cs(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new ht(g);var n=function(){var h=arguments,l=t?t.apply(this,h):h[0],f=n.cache;if(f.has(l))return f.get(l);var y=e.apply(this,h);return n.cache=f.set(l,y)||f,y};return n.cache=new(Cs.Cache||$t),n}Cs.Cache=$t;function As(e){if(typeof e!="function")throw new ht(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function b_(e){return wh(2,e)}var E_=c0(function(e,t){t=t.length==1&&K(t[0])?ve(t[0],et(U())):ve(qe(t,1),et(U()));var n=t.length;return J(function(h){for(var l=-1,f=$e(h.length,n);++l<f;)h[l]=t[l].call(this,h[l]);return Xe(e,this,h)})}),xo=J(function(e,t){var n=ei(t,Bi(xo));return Lt(e,G,r,t,n)}),Ph=J(function(e,t){var n=ei(t,Bi(Ph));return Lt(e,ye,r,t,n)}),I_=zt(function(e,t){return Lt(e,ke,r,r,r,t)});function P_(e,t){if(typeof e!="function")throw new ht(g);return t=t===r?t:H(t),J(e,t)}function x_(e,t){if(typeof e!="function")throw new ht(g);return t=t==null?0:Oe(H(t),0),J(function(n){var h=n[t],l=ni(n,0,t);return h&&Xt(l,h),Xe(e,this,l)})}function S_(e,t,n){var h=!0,l=!0;if(typeof e!="function")throw new ht(g);return we(n)&&(h="leading"in n?!!n.leading:h,l="trailing"in n?!!n.trailing:l),Ih(e,t,{leading:h,maxWait:t,trailing:l})}function R_(e){return mh(e,1)}function O_(e,t){return xo(co(t),e)}function N_(){if(!arguments.length)return[];var e=arguments[0];return K(e)?e:[e]}function C_(e){return pt(e,ne)}function A_(e,t){return t=typeof t=="function"?t:r,pt(e,ne,t)}function D_(e){return pt(e,O|ne)}function F_(e,t){return t=typeof t=="function"?t:r,pt(e,O|ne,t)}function T_(e,t){return t==null||lu(e,t,Ce(t))}function bt(e,t){return e===t||e!==e&&t!==t}var q_=Is(Qn),j_=Is(function(e,t){return e>=t}),Ei=vu(function(){return arguments}())?vu:function(e){return _e(e)&&oe.call(e,"callee")&&!ru.call(e,"callee")},K=E.isArray,$_=Uc?et(Uc):Hm;function We(e){return e!=null&&Ds(e.length)&&!kt(e)}function Ie(e){return _e(e)&&We(e)}function U_(e){return e===!0||e===!1||_e(e)&&Ve(e)==rr}var oi=Zv||jo,L_=Lc?et(Lc):Bm;function z_(e){return _e(e)&&e.nodeType===1&&!Pr(e)}function M_(e){if(e==null)return!0;if(We(e)&&(K(e)||typeof e=="string"||typeof e.splice=="function"||oi(e)||Gi(e)||Ei(e)))return!e.length;var t=Ue(e);if(t==vt||t==mt)return!e.size;if(Er(e))return!Xn(e).length;for(var n in e)if(oe.call(e,n))return!1;return!0}function k_(e,t){return wr(e,t)}function V_(e,t,n){n=typeof n=="function"?n:r;var h=n?n(e,t):r;return h===r?wr(e,t,r,n):!!h}function So(e){if(!_e(e))return!1;var t=Ve(e);return t==Kr||t==py||typeof e.message=="string"&&typeof e.name=="string"&&!Pr(e)}function K_(e){return typeof e=="number"&&nu(e)}function kt(e){if(!we(e))return!1;var t=Ve(e);return t==Hr||t==pc||t==ly||t==fy}function xh(e){return typeof e=="number"&&e==H(e)}function Ds(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Yt}function we(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function _e(e){return e!=null&&typeof e=="object"}var Sh=zc?et(zc):Jm;function H_(e,t){return e===t||Zn(e,t,yo(t))}function B_(e,t,n){return n=typeof n=="function"?n:r,Zn(e,t,yo(t),n)}function G_(e){return Rh(e)&&e!=+e}function J_(e){if(A0(e))throw new V(p);return mu(e)}function W_(e){return e===null}function Q_(e){return e==null}function Rh(e){return typeof e=="number"||_e(e)&&Ve(e)==nr}function Pr(e){if(!_e(e)||Ve(e)!=qt)return!1;var t=ns(e);if(t===null)return!0;var n=oe.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&ts.call(n)==Bv}var Ro=Mc?et(Mc):Wm;function Y_(e){return xh(e)&&e>=-Yt&&e<=Yt}var Oh=kc?et(kc):Qm;function Fs(e){return typeof e=="string"||!K(e)&&_e(e)&&Ve(e)==ar}function it(e){return typeof e=="symbol"||_e(e)&&Ve(e)==Br}var Gi=Vc?et(Vc):Ym;function Z_(e){return e===r}function X_(e){return _e(e)&&Ue(e)==cr}function e1(e){return _e(e)&&Ve(e)==yy}var t1=Is(eo),i1=Is(function(e,t){return e<=t});function Nh(e){if(!e)return[];if(We(e))return Fs(e)?wt(e):Je(e);if(lr&&e[lr])return Tv(e[lr]());var t=Ue(e),n=t==vt?Mn:t==mt?Zr:Ji;return n(e)}function Vt(e){if(!e)return e===0?e:0;if(e=gt(e),e===di||e===-di){var t=e<0?-1:1;return t*ay}return e===e?e:0}function H(e){var t=Vt(e),n=t%1;return t===t?n?t-n:t:0}function Ch(e){return e?mi(H(e),0,xt):0}function gt(e){if(typeof e=="number")return e;if(it(e))return kr;if(we(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=we(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Wc(e);var n=$y.test(e);return n||Ly.test(e)?vv(e.slice(2),n?2:8):jy.test(e)?kr:+e}function Ah(e){return Rt(e,Qe(e))}function r1(e){return e?mi(H(e),-Yt,Yt):e===0?e:0}function se(e){return e==null?"":tt(e)}var s1=Ki(function(e,t){if(Er(t)||We(t)){Rt(t,Ce(t),e);return}for(var n in t)oe.call(t,n)&&yr(e,n,t[n])}),Dh=Ki(function(e,t){Rt(t,Qe(t),e)}),Ts=Ki(function(e,t,n,h){Rt(t,Qe(t),e,h)}),n1=Ki(function(e,t,n,h){Rt(t,Ce(t),e,h)}),o1=zt(Gn);function a1(e,t){var n=Vi(e);return t==null?n:hu(n,t)}var c1=J(function(e,t){e=ue(e);var n=-1,h=t.length,l=h>2?t[2]:r;for(l&&Ke(t[0],t[1],l)&&(h=1);++n<h;)for(var f=t[n],y=Qe(f),v=-1,_=y.length;++v<_;){var P=y[v],S=e[P];(S===r||bt(S,zi[P])&&!oe.call(e,P))&&(e[P]=f[P])}return e}),u1=J(function(e){return e.push(r,Wu),Xe(Fh,r,e)});function h1(e,t){return Hc(e,U(t,3),St)}function l1(e,t){return Hc(e,U(t,3),Wn)}function p1(e,t){return e==null?e:Jn(e,U(t,3),Qe)}function d1(e,t){return e==null?e:gu(e,U(t,3),Qe)}function f1(e,t){return e&&St(e,U(t,3))}function g1(e,t){return e&&Wn(e,U(t,3))}function y1(e){return e==null?[]:gs(e,Ce(e))}function v1(e){return e==null?[]:gs(e,Qe(e))}function Oo(e,t,n){var h=e==null?r:wi(e,t);return h===r?n:h}function m1(e,t){return e!=null&&Zu(e,t,Mm)}function No(e,t){return e!=null&&Zu(e,t,km)}var w1=Ku(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=is.call(t)),e[t]=n},Ao(Ye)),_1=Ku(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=is.call(t)),oe.call(e,t)?e[t].push(n):e[t]=[n]},U),b1=J(mr);function Ce(e){return We(e)?cu(e):Xn(e)}function Qe(e){return We(e)?cu(e,!0):Zm(e)}function E1(e,t){var n={};return t=U(t,3),St(e,function(h,l,f){Ut(n,t(h,l,f),h)}),n}function I1(e,t){var n={};return t=U(t,3),St(e,function(h,l,f){Ut(n,l,t(h,l,f))}),n}var P1=Ki(function(e,t,n){ys(e,t,n)}),Fh=Ki(function(e,t,n,h){ys(e,t,n,h)}),x1=zt(function(e,t){var n={};if(e==null)return n;var h=!1;t=ve(t,function(f){return f=si(f,e),h||(h=f.length>1),f}),Rt(e,fo(e),n),h&&(n=pt(n,O|j|ne,w0));for(var l=t.length;l--;)no(n,t[l]);return n});function S1(e,t){return Th(e,As(U(t)))}var R1=zt(function(e,t){return e==null?{}:e0(e,t)});function Th(e,t){if(e==null)return{};var n=ve(fo(e),function(h){return[h]});return t=U(t),xu(e,n,function(h,l){return t(h,l[0])})}function O1(e,t,n){t=si(t,e);var h=-1,l=t.length;for(l||(l=1,e=r);++h<l;){var f=e==null?r:e[Ot(t[h])];f===r&&(h=l,f=n),e=kt(f)?f.call(e):f}return e}function N1(e,t,n){return e==null?e:_r(e,t,n)}function C1(e,t,n,h){return h=typeof h=="function"?h:r,e==null?e:_r(e,t,n,h)}var qh=Gu(Ce),jh=Gu(Qe);function A1(e,t,n){var h=K(e),l=h||oi(e)||Gi(e);if(t=U(t,4),n==null){var f=e&&e.constructor;l?n=h?new f:[]:we(e)?n=kt(f)?Vi(ns(e)):{}:n={}}return(l?ut:St)(e,function(y,v,_){return t(n,y,v,_)}),n}function D1(e,t){return e==null?!0:no(e,t)}function F1(e,t,n){return e==null?e:Cu(e,t,co(n))}function T1(e,t,n,h){return h=typeof h=="function"?h:r,e==null?e:Cu(e,t,co(n),h)}function Ji(e){return e==null?[]:zn(e,Ce(e))}function q1(e){return e==null?[]:zn(e,Qe(e))}function j1(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=gt(n),n=n===n?n:0),t!==r&&(t=gt(t),t=t===t?t:0),mi(gt(e),t,n)}function $1(e,t,n){return t=Vt(t),n===r?(n=t,t=0):n=Vt(n),e=gt(e),Vm(e,t,n)}function U1(e,t,n){if(n&&typeof n!="boolean"&&Ke(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Vt(e),t===r?(t=e,e=0):t=Vt(t)),e>t){var h=e;e=t,t=h}if(n||e%1||t%1){var l=ou();return $e(e+l*(t-e+yv("1e-"+((l+"").length-1))),t)}return io(e,t)}var L1=Hi(function(e,t,n){return t=t.toLowerCase(),e+(n?$h(t):t)});function $h(e){return Co(se(e).toLowerCase())}function Uh(e){return e=se(e),e&&e.replace(My,Nv).replace(ov,"")}function z1(e,t,n){e=se(e),t=tt(t);var h=e.length;n=n===r?h:mi(H(n),0,h);var l=n;return n-=t.length,n>=0&&e.slice(n,l)==t}function M1(e){return e=se(e),e&&by.test(e)?e.replace(gc,Cv):e}function k1(e){return e=se(e),e&&Ry.test(e)?e.replace(Pn,"\\$&"):e}var V1=Hi(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),K1=Hi(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),H1=Mu("toLowerCase");function B1(e,t,n){e=se(e),t=H(t);var h=t?Ui(e):0;if(!t||h>=t)return e;var l=(t-h)/2;return Es(us(l),n)+e+Es(cs(l),n)}function G1(e,t,n){e=se(e),t=H(t);var h=t?Ui(e):0;return t&&h<t?e+Es(t-h,n):e}function J1(e,t,n){e=se(e),t=H(t);var h=t?Ui(e):0;return t&&h<t?Es(t-h,n)+e:e}function W1(e,t,n){return n||t==null?t=0:t&&(t=+t),im(se(e).replace(xn,""),t||0)}function Q1(e,t,n){return(n?Ke(e,t,n):t===r)?t=1:t=H(t),ro(se(e),t)}function Y1(){var e=arguments,t=se(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Z1=Hi(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function X1(e,t,n){return n&&typeof n!="number"&&Ke(e,t,n)&&(t=n=r),n=n===r?xt:n>>>0,n?(e=se(e),e&&(typeof t=="string"||t!=null&&!Ro(t))&&(t=tt(t),!t&&$i(e))?ni(wt(e),0,n):e.split(t,n)):[]}var eb=Hi(function(e,t,n){return e+(n?" ":"")+Co(t)});function tb(e,t,n){return e=se(e),n=n==null?0:mi(H(n),0,e.length),t=tt(t),e.slice(n,n+t.length)==t}function ib(e,t,n){var h=d.templateSettings;n&&Ke(e,t,n)&&(t=r),e=se(e),t=Ts({},t,h,Ju);var l=Ts({},t.imports,h.imports,Ju),f=Ce(l),y=zn(l,f),v,_,P=0,S=t.interpolate||Gr,R="__p += '",A=kn((t.escape||Gr).source+"|"+S.source+"|"+(S===yc?qy:Gr).source+"|"+(t.evaluate||Gr).source+"|$","g"),q="//# sourceURL="+(oe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++lv+"]")+`
`;e.replace(A,function(M,Q,te,rt,He,st){return te||(te=rt),R+=e.slice(P,st).replace(ky,Av),Q&&(v=!0,R+=`' +
__e(`+Q+`) +
'`),He&&(_=!0,R+=`';
`+He+`;
__p += '`),te&&(R+=`' +
((__t = (`+te+`)) == null ? '' : __t) +
'`),P=st+M.length,M}),R+=`';
`;var z=oe.call(t,"variable")&&t.variable;if(!z)R=`with (obj) {
`+R+`
}
`;else if(Fy.test(z))throw new V(m);R=(_?R.replace(vy,""):R).replace(my,"$1").replace(wy,"$1;"),R="function("+(z||"obj")+`) {
`+(z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(v?", __e = _.escape":"")+(_?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var B=zh(function(){return re(f,q+"return "+R).apply(r,y)});if(B.source=R,So(B))throw B;return B}function rb(e){return se(e).toLowerCase()}function sb(e){return se(e).toUpperCase()}function nb(e,t,n){if(e=se(e),e&&(n||t===r))return Wc(e);if(!e||!(t=tt(t)))return e;var h=wt(e),l=wt(t),f=Qc(h,l),y=Yc(h,l)+1;return ni(h,f,y).join("")}function ob(e,t,n){if(e=se(e),e&&(n||t===r))return e.slice(0,Xc(e)+1);if(!e||!(t=tt(t)))return e;var h=wt(e),l=Yc(h,wt(t))+1;return ni(h,0,l).join("")}function ab(e,t,n){if(e=se(e),e&&(n||t===r))return e.replace(xn,"");if(!e||!(t=tt(t)))return e;var h=wt(e),l=Qc(h,wt(t));return ni(h,l).join("")}function cb(e,t){var n=ty,h=iy;if(we(t)){var l="separator"in t?t.separator:l;n="length"in t?H(t.length):n,h="omission"in t?tt(t.omission):h}e=se(e);var f=e.length;if($i(e)){var y=wt(e);f=y.length}if(n>=f)return e;var v=n-Ui(h);if(v<1)return h;var _=y?ni(y,0,v).join(""):e.slice(0,v);if(l===r)return _+h;if(y&&(v+=_.length-v),Ro(l)){if(e.slice(v).search(l)){var P,S=_;for(l.global||(l=kn(l.source,se(vc.exec(l))+"g")),l.lastIndex=0;P=l.exec(S);)var R=P.index;_=_.slice(0,R===r?v:R)}}else if(e.indexOf(tt(l),v)!=v){var A=_.lastIndexOf(l);A>-1&&(_=_.slice(0,A))}return _+h}function ub(e){return e=se(e),e&&_y.test(e)?e.replace(fc,Uv):e}var hb=Hi(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Co=Mu("toUpperCase");function Lh(e,t,n){return e=se(e),t=n?r:t,t===r?Fv(e)?Mv(e):Pv(e):e.match(t)||[]}var zh=J(function(e,t){try{return Xe(e,r,t)}catch(n){return So(n)?n:new V(n)}}),lb=zt(function(e,t){return ut(t,function(n){n=Ot(n),Ut(e,n,Po(e[n],e))}),e});function pb(e){var t=e==null?0:e.length,n=U();return e=t?ve(e,function(h){if(typeof h[1]!="function")throw new ht(g);return[n(h[0]),h[1]]}):[],J(function(h){for(var l=-1;++l<t;){var f=e[l];if(Xe(f[0],this,h))return Xe(f[1],this,h)}})}function db(e){return Um(pt(e,O))}function Ao(e){return function(){return e}}function fb(e,t){return e==null||e!==e?t:e}var gb=Vu(),yb=Vu(!0);function Ye(e){return e}function Do(e){return wu(typeof e=="function"?e:pt(e,O))}function vb(e){return bu(pt(e,O))}function mb(e,t){return Eu(e,pt(t,O))}var wb=J(function(e,t){return function(n){return mr(n,e,t)}}),_b=J(function(e,t){return function(n){return mr(e,n,t)}});function Fo(e,t,n){var h=Ce(t),l=gs(t,h);n==null&&!(we(t)&&(l.length||!h.length))&&(n=t,t=e,e=this,l=gs(t,Ce(t)));var f=!(we(n)&&"chain"in n)||!!n.chain,y=kt(e);return ut(l,function(v){var _=t[v];e[v]=_,y&&(e.prototype[v]=function(){var P=this.__chain__;if(f||P){var S=e(this.__wrapped__),R=S.__actions__=Je(this.__actions__);return R.push({func:_,args:arguments,thisArg:e}),S.__chain__=P,S}return _.apply(e,Xt([this.value()],arguments))})}),e}function bb(){return Te._===this&&(Te._=Gv),this}function To(){}function Eb(e){return e=H(e),J(function(t){return Iu(t,e)})}var Ib=ho(ve),Pb=ho(Kc),xb=ho(qn);function Mh(e){return mo(e)?jn(Ot(e)):t0(e)}function Sb(e){return function(t){return e==null?r:wi(e,t)}}var Rb=Hu(),Ob=Hu(!0);function qo(){return[]}function jo(){return!1}function Nb(){return{}}function Cb(){return""}function Ab(){return!0}function Db(e,t){if(e=H(e),e<1||e>Yt)return[];var n=xt,h=$e(e,xt);t=U(t),e-=xt;for(var l=Ln(h,t);++n<e;)t(n);return l}function Fb(e){return K(e)?ve(e,Ot):it(e)?[e]:Je(ah(se(e)))}function Tb(e){var t=++Hv;return se(e)+t}var qb=bs(function(e,t){return e+t},0),jb=lo("ceil"),$b=bs(function(e,t){return e/t},1),Ub=lo("floor");function Lb(e){return e&&e.length?fs(e,Ye,Qn):r}function zb(e,t){return e&&e.length?fs(e,U(t,2),Qn):r}function Mb(e){return Gc(e,Ye)}function kb(e,t){return Gc(e,U(t,2))}function Vb(e){return e&&e.length?fs(e,Ye,eo):r}function Kb(e,t){return e&&e.length?fs(e,U(t,2),eo):r}var Hb=bs(function(e,t){return e*t},1),Bb=lo("round"),Gb=bs(function(e,t){return e-t},0);function Jb(e){return e&&e.length?Un(e,Ye):0}function Wb(e,t){return e&&e.length?Un(e,U(t,2)):0}return d.after=v_,d.ary=mh,d.assign=s1,d.assignIn=Dh,d.assignInWith=Ts,d.assignWith=n1,d.at=o1,d.before=wh,d.bind=Po,d.bindAll=lb,d.bindKey=_h,d.castArray=N_,d.chain=gh,d.chunk=U0,d.compact=L0,d.concat=z0,d.cond=pb,d.conforms=db,d.constant=Ao,d.countBy=Jw,d.create=a1,d.curry=bh,d.curryRight=Eh,d.debounce=Ih,d.defaults=c1,d.defaultsDeep=u1,d.defer=m_,d.delay=w_,d.difference=M0,d.differenceBy=k0,d.differenceWith=V0,d.drop=K0,d.dropRight=H0,d.dropRightWhile=B0,d.dropWhile=G0,d.fill=J0,d.filter=Qw,d.flatMap=Xw,d.flatMapDeep=e_,d.flatMapDepth=t_,d.flatten=lh,d.flattenDeep=W0,d.flattenDepth=Q0,d.flip=__,d.flow=gb,d.flowRight=yb,d.fromPairs=Y0,d.functions=y1,d.functionsIn=v1,d.groupBy=i_,d.initial=X0,d.intersection=ew,d.intersectionBy=tw,d.intersectionWith=iw,d.invert=w1,d.invertBy=_1,d.invokeMap=s_,d.iteratee=Do,d.keyBy=n_,d.keys=Ce,d.keysIn=Qe,d.map=Os,d.mapKeys=E1,d.mapValues=I1,d.matches=vb,d.matchesProperty=mb,d.memoize=Cs,d.merge=P1,d.mergeWith=Fh,d.method=wb,d.methodOf=_b,d.mixin=Fo,d.negate=As,d.nthArg=Eb,d.omit=x1,d.omitBy=S1,d.once=b_,d.orderBy=o_,d.over=Ib,d.overArgs=E_,d.overEvery=Pb,d.overSome=xb,d.partial=xo,d.partialRight=Ph,d.partition=a_,d.pick=R1,d.pickBy=Th,d.property=Mh,d.propertyOf=Sb,d.pull=ow,d.pullAll=dh,d.pullAllBy=aw,d.pullAllWith=cw,d.pullAt=uw,d.range=Rb,d.rangeRight=Ob,d.rearg=I_,d.reject=h_,d.remove=hw,d.rest=P_,d.reverse=Eo,d.sampleSize=p_,d.set=N1,d.setWith=C1,d.shuffle=d_,d.slice=lw,d.sortBy=y_,d.sortedUniq=mw,d.sortedUniqBy=ww,d.split=X1,d.spread=x_,d.tail=_w,d.take=bw,d.takeRight=Ew,d.takeRightWhile=Iw,d.takeWhile=Pw,d.tap=Lw,d.throttle=S_,d.thru=Rs,d.toArray=Nh,d.toPairs=qh,d.toPairsIn=jh,d.toPath=Fb,d.toPlainObject=Ah,d.transform=A1,d.unary=R_,d.union=xw,d.unionBy=Sw,d.unionWith=Rw,d.uniq=Ow,d.uniqBy=Nw,d.uniqWith=Cw,d.unset=D1,d.unzip=Io,d.unzipWith=fh,d.update=F1,d.updateWith=T1,d.values=Ji,d.valuesIn=q1,d.without=Aw,d.words=Lh,d.wrap=O_,d.xor=Dw,d.xorBy=Fw,d.xorWith=Tw,d.zip=qw,d.zipObject=jw,d.zipObjectDeep=$w,d.zipWith=Uw,d.entries=qh,d.entriesIn=jh,d.extend=Dh,d.extendWith=Ts,Fo(d,d),d.add=qb,d.attempt=zh,d.camelCase=L1,d.capitalize=$h,d.ceil=jb,d.clamp=j1,d.clone=C_,d.cloneDeep=D_,d.cloneDeepWith=F_,d.cloneWith=A_,d.conformsTo=T_,d.deburr=Uh,d.defaultTo=fb,d.divide=$b,d.endsWith=z1,d.eq=bt,d.escape=M1,d.escapeRegExp=k1,d.every=Ww,d.find=Yw,d.findIndex=uh,d.findKey=h1,d.findLast=Zw,d.findLastIndex=hh,d.findLastKey=l1,d.floor=Ub,d.forEach=yh,d.forEachRight=vh,d.forIn=p1,d.forInRight=d1,d.forOwn=f1,d.forOwnRight=g1,d.get=Oo,d.gt=q_,d.gte=j_,d.has=m1,d.hasIn=No,d.head=ph,d.identity=Ye,d.includes=r_,d.indexOf=Z0,d.inRange=$1,d.invoke=b1,d.isArguments=Ei,d.isArray=K,d.isArrayBuffer=$_,d.isArrayLike=We,d.isArrayLikeObject=Ie,d.isBoolean=U_,d.isBuffer=oi,d.isDate=L_,d.isElement=z_,d.isEmpty=M_,d.isEqual=k_,d.isEqualWith=V_,d.isError=So,d.isFinite=K_,d.isFunction=kt,d.isInteger=xh,d.isLength=Ds,d.isMap=Sh,d.isMatch=H_,d.isMatchWith=B_,d.isNaN=G_,d.isNative=J_,d.isNil=Q_,d.isNull=W_,d.isNumber=Rh,d.isObject=we,d.isObjectLike=_e,d.isPlainObject=Pr,d.isRegExp=Ro,d.isSafeInteger=Y_,d.isSet=Oh,d.isString=Fs,d.isSymbol=it,d.isTypedArray=Gi,d.isUndefined=Z_,d.isWeakMap=X_,d.isWeakSet=e1,d.join=rw,d.kebabCase=V1,d.last=ft,d.lastIndexOf=sw,d.lowerCase=K1,d.lowerFirst=H1,d.lt=t1,d.lte=i1,d.max=Lb,d.maxBy=zb,d.mean=Mb,d.meanBy=kb,d.min=Vb,d.minBy=Kb,d.stubArray=qo,d.stubFalse=jo,d.stubObject=Nb,d.stubString=Cb,d.stubTrue=Ab,d.multiply=Hb,d.nth=nw,d.noConflict=bb,d.noop=To,d.now=Ns,d.pad=B1,d.padEnd=G1,d.padStart=J1,d.parseInt=W1,d.random=U1,d.reduce=c_,d.reduceRight=u_,d.repeat=Q1,d.replace=Y1,d.result=O1,d.round=Bb,d.runInContext=w,d.sample=l_,d.size=f_,d.snakeCase=Z1,d.some=g_,d.sortedIndex=pw,d.sortedIndexBy=dw,d.sortedIndexOf=fw,d.sortedLastIndex=gw,d.sortedLastIndexBy=yw,d.sortedLastIndexOf=vw,d.startCase=eb,d.startsWith=tb,d.subtract=Gb,d.sum=Jb,d.sumBy=Wb,d.template=ib,d.times=Db,d.toFinite=Vt,d.toInteger=H,d.toLength=Ch,d.toLower=rb,d.toNumber=gt,d.toSafeInteger=r1,d.toString=se,d.toUpper=sb,d.trim=nb,d.trimEnd=ob,d.trimStart=ab,d.truncate=cb,d.unescape=ub,d.uniqueId=Tb,d.upperCase=hb,d.upperFirst=Co,d.each=yh,d.eachRight=vh,d.first=ph,Fo(d,function(){var e={};return St(d,function(t,n){oe.call(d.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),d.VERSION=o,ut(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),ut(["drop","take"],function(e,t){ee.prototype[e]=function(n){n=n===r?1:Oe(H(n),0);var h=this.__filtered__&&!t?new ee(this):this.clone();return h.__filtered__?h.__takeCount__=$e(n,h.__takeCount__):h.__views__.push({size:$e(n,xt),type:e+(h.__dir__<0?"Right":"")}),h},ee.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),ut(["filter","map","takeWhile"],function(e,t){var n=t+1,h=n==lc||n==oy;ee.prototype[e]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:U(l,3),type:n}),f.__filtered__=f.__filtered__||h,f}}),ut(["head","last"],function(e,t){var n="take"+(t?"Right":"");ee.prototype[e]=function(){return this[n](1).value()[0]}}),ut(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");ee.prototype[e]=function(){return this.__filtered__?new ee(this):this[n](1)}}),ee.prototype.compact=function(){return this.filter(Ye)},ee.prototype.find=function(e){return this.filter(e).head()},ee.prototype.findLast=function(e){return this.reverse().find(e)},ee.prototype.invokeMap=J(function(e,t){return typeof e=="function"?new ee(this):this.map(function(n){return mr(n,e,t)})}),ee.prototype.reject=function(e){return this.filter(As(U(e)))},ee.prototype.slice=function(e,t){e=H(e);var n=this;return n.__filtered__&&(e>0||t<0)?new ee(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=H(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},ee.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ee.prototype.toArray=function(){return this.take(xt)},St(ee.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),h=/^(?:head|last)$/.test(t),l=d[h?"take"+(t=="last"?"Right":""):t],f=h||/^find/.test(t);l&&(d.prototype[t]=function(){var y=this.__wrapped__,v=h?[1]:arguments,_=y instanceof ee,P=v[0],S=_||K(y),R=function(Q){var te=l.apply(d,Xt([Q],v));return h&&A?te[0]:te};S&&n&&typeof P=="function"&&P.length!=1&&(_=S=!1);var A=this.__chain__,q=!!this.__actions__.length,z=f&&!A,B=_&&!q;if(!f&&S){y=B?y:new ee(this);var M=e.apply(y,v);return M.__actions__.push({func:Rs,args:[R],thisArg:r}),new lt(M,A)}return z&&B?e.apply(this,v):(M=this.thru(R),z?h?M.value()[0]:M.value():M)})}),ut(["pop","push","shift","sort","splice","unshift"],function(e){var t=Xr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",h=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(h&&!this.__chain__){var f=this.value();return t.apply(K(f)?f:[],l)}return this[n](function(y){return t.apply(K(y)?y:[],l)})}}),St(ee.prototype,function(e,t){var n=d[t];if(n){var h=n.name+"";oe.call(ki,h)||(ki[h]=[]),ki[h].push({name:t,func:n})}}),ki[_s(r,ce).name]=[{name:"wrapper",func:r}],ee.prototype.clone=um,ee.prototype.reverse=hm,ee.prototype.value=lm,d.prototype.at=zw,d.prototype.chain=Mw,d.prototype.commit=kw,d.prototype.next=Vw,d.prototype.plant=Hw,d.prototype.reverse=Bw,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Gw,d.prototype.first=d.prototype.head,lr&&(d.prototype[lr]=Kw),d},Li=kv();fi?((fi.exports=Li)._=Li,An._=Li):Te._=Li}).call(ir)})(ln,ln.exports);var Dg=Object.defineProperty,Fg=Object.defineProperties,Tg=Object.getOwnPropertyDescriptors,rc=Object.getOwnPropertySymbols,qg=Object.prototype.hasOwnProperty,jg=Object.prototype.propertyIsEnumerable,sc=(u,s,r)=>s in u?Dg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Lr=(u,s)=>{for(var r in s||(s={}))qg.call(s,r)&&sc(u,r,s[r]);if(rc)for(var r of rc(s))jg.call(s,r)&&sc(u,r,s[r]);return u},$g=(u,s)=>Fg(u,Tg(s));function Wt(u,s,r){var o;const a=Mo(u);return((o=s.rpcMap)==null?void 0:o[a.reference])||`${Ag}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function pi(u){return u.includes(":")?u.split(":")[1]:u}function nc(u){return u.map(s=>`${s.split(":")[0]}:${s.split(":")[1]}`)}function Ug(u,s){const r=Object.keys(s.namespaces).filter(a=>a.includes(u));if(!r.length)return[];const o=[];return r.forEach(a=>{const p=s.namespaces[a].accounts;o.push(...p)}),o}function oc(u={},s={}){const r=ac(u),o=ac(s);return ln.exports.merge(r,o)}function ac(u){var s,r,o,a;const p={};if(!Ci(u))return p;for(const[g,m]of Object.entries(u)){const b=Dr(g)?[g]:m.chains,x=m.methods||[],N=m.events||[],O=m.rpcMap||{},j=Ni(g);p[j]=$g(Lr(Lr({},p[j]),m),{chains:It(b,(s=p[j])==null?void 0:s.chains),methods:It(x,(r=p[j])==null?void 0:r.methods),events:It(N,(o=p[j])==null?void 0:o.events),rpcMap:Lr(Lr({},O),(a=p[j])==null?void 0:a.rpcMap)})}return p}function Lg(u){return u.includes(":")?u.split(":")[2]:u}function zg(u){const s={};for(const[r,o]of Object.entries(u)){const a=o.methods||[],p=o.events||[],g=o.accounts||[],m=Dr(r)?[r]:o.chains?o.chains:nc(o.accounts);s[r]={chains:m,methods:a,events:p,accounts:g}}return s}function pn(u){return typeof u=="number"?u:u.includes("0x")?parseInt(u,16):(u=u.includes(":")?u.split(":")[1]:u,isNaN(Number(u))?u:Number(u))}const cc={},ge=u=>cc[u],dn=(u,s)=>{cc[u]=s};class Mg{constructor(s){this.name="polkadot",this.namespace=s.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=pi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Wt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Ct.r(new Jt.Z(o,ge("disableProviderPing")))}}class kg{constructor(s){this.name="eip155",this.namespace=s.namespace,this.events=ge("events"),this.client=ge("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(s){switch(s.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(s);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(s.request.method)?await this.client.request(s):this.getHttpProvider().request(s.request)}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(parseInt(s),r),this.chainId=parseInt(s),this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}createHttpProvider(s,r){const o=r||Wt(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Ct.r(new Jt.k(o,ge("disableProviderPing")))}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=parseInt(pi(r));s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const s=this.chainId,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}async handleSwitchChain(s){var r,o;let a=s.request.params?(r=s.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const p=parseInt(a,16);if(this.isChainApproved(p))this.setDefaultChain(`${p}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:s.topic,request:{method:s.request.method,params:[{chainId:a}]},chainId:(o=this.namespace.chains)==null?void 0:o[0]}),this.setDefaultChain(`${p}`);else throw new Error(`Failed to switch to chain 'eip155:${p}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(s){return this.namespace.chains.includes(`${this.name}:${s}`)}}class Vg{constructor(s){this.name="solana",this.namespace=s.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=pi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Wt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Ct.r(new Jt.Z(o,ge("disableProviderPing")))}}class Kg{constructor(s){this.name="cosmos",this.namespace=s.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=pi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Wt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Ct.r(new Jt.Z(o,ge("disableProviderPing")))}}class Hg{constructor(s){this.name="cip34",this.namespace=s.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{const o=this.getCardanoRPCUrl(r),a=pi(r);s[a]=this.createHttpProvider(a,o)}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}getCardanoRPCUrl(s){const r=this.namespace.rpcMap;if(r)return r[s]}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||this.getCardanoRPCUrl(s);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Ct.r(new Jt.Z(o,ge("disableProviderPing")))}}class Bg{constructor(s){this.name="elrond",this.namespace=s.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=pi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Wt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Ct.r(new Jt.Z(o,ge("disableProviderPing")))}}class Gg{constructor(s){this.name="multiversx",this.namespace=s.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=pi(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Wt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Ct.r(new Jt.Z(o,ge("disableProviderPing")))}}class Jg{constructor(s){this.name="near",this.namespace=s.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){if(this.chainId=s,!this.httpProviders[s]){const o=r||Wt(`${this.name}:${s}`,this.namespace);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,o)}this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;s[r]=this.createHttpProvider(r,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Wt(s,this.namespace);return typeof o>"u"?void 0:new Ct.r(new Jt.Z(o,ge("disableProviderPing")))}}var Wg=Object.defineProperty,Qg=Object.defineProperties,Yg=Object.getOwnPropertyDescriptors,uc=Object.getOwnPropertySymbols,Zg=Object.prototype.hasOwnProperty,Xg=Object.prototype.propertyIsEnumerable,hc=(u,s,r)=>s in u?Wg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,zr=(u,s)=>{for(var r in s||(s={}))Zg.call(s,r)&&hc(u,r,s[r]);if(uc)for(var r of uc(s))Xg.call(s,r)&&hc(u,r,s[r]);return u},fn=(u,s)=>Qg(u,Yg(s));class Mr{constructor(s){this.events=new(ai()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=s,this.logger=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ec.pino)((0,ec.getDefaultLoggerOptions)({level:(s==null?void 0:s.logger)||tc})),this.disableProviderPing=(s==null?void 0:s.disableProviderPing)||!1}static async init(s){const r=new Mr(s);return await r.initialize(),r}async request(s,r,o){const[a,p]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:zr({},s),chainId:`${a}:${p}`,topic:this.session.topic,expiry:o})}sendAsync(s,r,o,a){const p=new Date().getTime();this.request(s,o,a).then(g=>r(null,(0,Z.formatJsonRpcResult)(p,g))).catch(g=>r(g,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var s;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(s=this.session)==null?void 0:s.topic,reason:me("USER_DISCONNECTED")}),await this.cleanup()}async connect(s){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(s),await this.cleanupPendingPairings(),!s.skipPairing)return await this.pair(s.pairingTopic)}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}removeListener(s,r){this.events.removeListener(s,r)}off(s,r){this.events.off(s,r)}get isWalletConnect(){return!0}async pair(s){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:o,approval:a}=await this.client.connect({pairingTopic:s,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});o&&(this.uri=o,this.events.emit("display_uri",o)),await a().then(p=>{this.session=p;const g=zg(p.namespaces);this.namespaces=oc(this.namespaces,g),this.persist("namespaces",this.namespaces)}).catch(p=>{if(p.message!==Ya)throw p;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(s,r){try{if(!this.session)return;const[o,a]=this.validateChain(s);this.getProvider(o).setDefaultChain(a,r)}catch(o){if(!/Please call connect/.test(o.message))throw o}}async cleanupPendingPairings(s={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(li(r)){for(const o of r)s.deletePairings?this.client.core.expirer.set(o.topic,0):await this.client.core.relayer.subscriber.unsubscribe(o.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const s=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[s]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await hn.init({logger:this.providerOpts.logger||tc,relayUrl:this.providerOpts.relayUrl||Og,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const s=[...new Set(Object.keys(this.session.namespaces).map(r=>Ni(r)))];dn("client",this.client),dn("events",this.events),dn("disableProviderPing",this.disableProviderPing),s.forEach(r=>{if(!this.session)return;const o=Ug(r,this.session),a=nc(o),p=oc(this.namespaces,this.optionalNamespaces),g=fn(zr({},p[r]),{accounts:o,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new kg({namespace:g});break;case"solana":this.rpcProviders[r]=new Vg({namespace:g});break;case"cosmos":this.rpcProviders[r]=new Kg({namespace:g});break;case"polkadot":this.rpcProviders[r]=new Mg({namespace:g});break;case"cip34":this.rpcProviders[r]=new Hg({namespace:g});break;case"elrond":this.rpcProviders[r]=new Bg({namespace:g});break;case"multiversx":this.rpcProviders[r]=new Gg({namespace:g});break;case"near":this.rpcProviders[r]=new Jg({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",s=>{this.events.emit("session_ping",s)}),this.client.on("session_event",s=>{const{params:r}=s,{event:o}=r;if(o.name==="accountsChanged"){const a=o.data;a&&li(a)&&this.events.emit("accountsChanged",a.map(Lg))}else if(o.name==="chainChanged"){const a=r.chainId,p=r.event.data,g=Ni(a),m=pn(a)!==pn(p)?`${g}:${pn(p)}`:a;this.onChainChanged(m)}else this.events.emit(o.name,o.data);this.events.emit("session_event",s)}),this.client.on("session_update",({topic:s,params:r})=>{var o;const{namespaces:a}=r,p=(o=this.client)==null?void 0:o.session.get(s);this.session=fn(zr({},p),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:s,params:r})}),this.client.on("session_delete",async s=>{await this.cleanup(),this.events.emit("session_delete",s),this.events.emit("disconnect",fn(zr({},me("USER_DISCONNECTED")),{data:s.topic}))}),this.on(Tt.DEFAULT_CHAIN_CHANGED,s=>{this.onChainChanged(s,!0)})}getProvider(s){if(!this.rpcProviders[s])throw new Error(`Provider not found: ${s}`);return this.rpcProviders[s]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(s=>{var r;this.getProvider(s).updateNamespace((r=this.session)==null?void 0:r.namespaces[s])})}setNamespaces(s){const{namespaces:r,optionalNamespaces:o,sessionProperties:a}=s;r&&Object.keys(r).length&&(this.namespaces=r),o&&Object.keys(o).length&&(this.optionalNamespaces=o),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",o)}validateChain(s){const[r,o]=(s==null?void 0:s.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,o];if(r&&!Object.keys(this.namespaces||{}).map(g=>Ni(g)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&o)return[r,o];const a=Ni(Object.keys(this.namespaces)[0]),p=this.rpcProviders[a].getDefaultChain();return[a,p]}async requestAccounts(){const[s]=this.validateChain();return await this.getProvider(s).requestAccounts()}onChainChanged(s,r=!1){if(!this.namespaces)return;const[o,a]=this.validateChain(s);a&&(r||this.getProvider(o).setDefaultChain(a),this.namespaces[o]?this.namespaces[o].defaultChain=a:this.namespaces[`${o}:${a}`]?this.namespaces[`${o}:${a}`].defaultChain=a:this.namespaces[`${o}:${a}`]={defaultChain:a},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(s,r){this.client.core.storage.setItem(`${ic}/${s}`,r)}async getFromStore(s){return await this.client.core.storage.getItem(`${ic}/${s}`)}}const ey=Mr}}]);
