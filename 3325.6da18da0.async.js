"use strict";(self.webpackChunk_ant_design_web3_docs=self.webpackChunk_ant_design_web3_docs||[]).push([[3325],{83325:function(Gb,Oo,j){j.r(Oo),j.d(Oo,{UniversalProvider:function(){return Yg},default:function(){return Fr}});var Lt=j(72100),Rs=j.n(Lt),Th=j(53070),ki=j(37875),ee=j(71315),gi=j(36900);class qh extends gi.q{constructor(s){super(),this.opts=s,this.protocol="wc",this.version=2}}class Jb{constructor(s,r,o){this.core=s,this.logger=r}}class $h extends gi.q{constructor(s,r){super(),this.core=s,this.logger=r,this.records=new Map}}class jh{constructor(s,r){this.logger=s,this.core=r}}class Uh extends gi.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class Lh extends gi.q{constructor(s){super()}}class zh{constructor(s,r,o,a){this.core=s,this.logger=r,this.name=o}}class Wb{constructor(){this.map=new Map}}class Mh extends gi.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class Qb{constructor(s,r){this.core=s,this.logger=r}}class kh extends gi.q{constructor(s,r){super(),this.core=s,this.logger=r}}class Yb{constructor(s,r){this.logger=s,this.core=r}}class Vh{constructor(s,r){this.projectId=s,this.logger=r}}class Kh{constructor(s,r){this.projectId=s,this.logger=r}}class Zb extends null{constructor(){super()}}class Hh{constructor(s){this.opts=s,this.protocol="wc",this.version=2}}class Xb extends null{constructor(){super()}}class Bh{constructor(s){this.client=s}}var No=j(41926),wr=j(88614),Co=j(11541),Gh=j(45306),Ao=j(4883),Os=j(76846),Do=j(9267),pe=j(5105),Jh=j(81365),$=j(46196),Vi=j(73079),Wh=j(42669),_r=j(22501),Qh=j(35014),Ns=j(14224);const br=":";function Fo(u){const[s,r]=u.split(br);return{namespace:s,reference:r}}function Yh(u){const{namespace:s,reference:r}=u;return[s,r].join(br)}function To(u){const[s,r,o]=u.split(br);return{namespace:s,reference:r,address:o}}function Zh(u){const{namespace:s,reference:r,address:o}=u;return[s,r,o].join(br)}function qo(u,s){const r=[];return u.forEach(o=>{const a=s(o);r.includes(a)||r.push(a)}),r}function Xh(u){const{address:s}=To(u);return s}function el(u){const{namespace:s,reference:r}=To(u);return Yh({namespace:s,reference:r})}function eE(u,s){const{namespace:r,reference:o}=Fo(s);return Zh({namespace:r,reference:o,address:u})}function tE(u){return qo(u,Xh)}function tl(u){return qo(u,el)}function iE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...a.accounts)}),r}function rE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...tl(a.accounts))}),r}function sE(u,s=[]){const r=[];return Object.keys(u).forEach(o=>{if(s.length&&!s.includes(o))return;const a=u[o];r.push(...Cs(o,a))}),r}function Cs(u,s){return u.includes(":")?[u]:s.chains||[]}const As=u=>u==null?void 0:u.split(":"),il=u=>{const s=u&&As(u);if(s)return s[3]},nE=u=>{const s=u&&As(u);if(s)return s[2]+":"+s[3]},rl=u=>{const s=u&&As(u);if(s)return s.pop()},oE=(u,s)=>{const r=`${u.domain} wants you to sign in with your Ethereum account:`,o=rl(s),a=u.statement,p=`URI: ${u.aud}`,g=`Version: ${u.version}`,m=`Chain ID: ${il(s)}`,b=`Nonce: ${u.nonce}`,x=`Issued At: ${u.iat}`,N=u.resources&&u.resources.length>0?`Resources:
${u.resources.map(O=>`- ${O}`).join(`
`)}`:void 0;return[r,o,"",a,"",p,g,m,b,x,N].filter(O=>O!=null).join(`
`)},$o="base10",$e="base16",Ds="base64pad",Fs="utf8",jo=0,ti=1,sl=0,Uo=1,Ts=12,qs=32;function nl(){const u=Do.Au();return{privateKey:(0,pe.BB)(u.secretKey,$e),publicKey:(0,pe.BB)(u.publicKey,$e)}}function $s(){const u=(0,Ao.randomBytes)(qs);return(0,pe.BB)(u,$e)}function ol(u,s){const r=Do.gi((0,pe.mL)(u,$e),(0,pe.mL)(s,$e),!0),o=new Gh.t(Os.mE,r).expand(qs);return(0,pe.BB)(o,$e)}function al(u){const s=(0,Os.vp)((0,pe.mL)(u,$e));return(0,pe.BB)(s,$e)}function yi(u){const s=(0,Os.vp)((0,pe.mL)(u,Fs));return(0,pe.BB)(s,$e)}function cl(u){return(0,pe.mL)(`${u}`,$o)}function Ki(u){return Number((0,pe.BB)(u,$o))}function ul(u){const s=cl(typeof u.type<"u"?u.type:jo);if(Ki(s)===ti&&typeof u.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof u.senderPublicKey<"u"?(0,pe.mL)(u.senderPublicKey,$e):void 0,o=typeof u.iv<"u"?(0,pe.mL)(u.iv,$e):(0,Ao.randomBytes)(Ts),a=new Co.OK((0,pe.mL)(u.symKey,$e)).seal(o,(0,pe.mL)(u.message,Fs));return ll({type:s,sealed:a,iv:o,senderPublicKey:r})}function hl(u){const s=new Co.OK((0,pe.mL)(u.symKey,$e)),{sealed:r,iv:o}=Er(u.encoded),a=s.open(o,r);if(a===null)throw new Error("Failed to decrypt");return(0,pe.BB)(a,Fs)}function ll(u){if(Ki(u.type)===ti){if(typeof u.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,pe.BB)((0,pe.zo)([u.type,u.senderPublicKey,u.iv,u.sealed]),Ds)}return(0,pe.BB)((0,pe.zo)([u.type,u.iv,u.sealed]),Ds)}function Er(u){const s=(0,pe.mL)(u,Ds),r=s.slice(sl,Uo),o=Uo;if(Ki(r)===ti){const m=o+qs,b=m+Ts,x=s.slice(o,m),N=s.slice(m,b),O=s.slice(b);return{type:r,sealed:O,iv:N,senderPublicKey:x}}const a=o+Ts,p=s.slice(o,a),g=s.slice(a);return{type:r,sealed:g,iv:p}}function pl(u,s){const r=Er(u);return Lo({type:Ki(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?(0,pe.BB)(r.senderPublicKey,$e):void 0,receiverPublicKey:s==null?void 0:s.receiverPublicKey})}function Lo(u){const s=(u==null?void 0:u.type)||jo;if(s===ti){if(typeof(u==null?void 0:u.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(u==null?void 0:u.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:s,senderPublicKey:u==null?void 0:u.senderPublicKey,receiverPublicKey:u==null?void 0:u.receiverPublicKey}}function zo(u){return u.type===ti&&typeof u.senderPublicKey=="string"&&typeof u.receiverPublicKey=="string"}var dl=Object.defineProperty,Mo=Object.getOwnPropertySymbols,fl=Object.prototype.hasOwnProperty,gl=Object.prototype.propertyIsEnumerable,ko=(u,s,r)=>s in u?dl(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Vo=(u,s)=>{for(var r in s||(s={}))fl.call(s,r)&&ko(u,r,s[r]);if(Mo)for(var r of Mo(s))gl.call(s,r)&&ko(u,r,s[r]);return u};const yl="ReactNative",Ve={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},js=" ",aE=":",vl="/",Ko=2,cE=1e3,ml="js";function Us(){return typeof Ns<"u"&&typeof Ns.versions<"u"&&typeof Ns.versions.node<"u"}function vi(){return!(0,Vi.getDocument)()&&!!(0,Vi.getNavigator)()&&navigator.product===yl}function mi(){return!Us()&&!!(0,Vi.getNavigator)()&&!!(0,Vi.getDocument)()}function wi(){return vi()?Ve.reactNative:Us()?Ve.node:mi()?Ve.browser:Ve.unknown}function wl(){var u;try{return vi()&&typeof j.g<"u"&&typeof(j.g==null?void 0:j.g.Application)<"u"?(u=j.g.Application)==null?void 0:u.applicationId:void 0}catch{return}}function _l(u,s){let r=_r.parse(u);return r=Vo(Vo({},r),s),u=_r.stringify(r),u}function bl(){return(0,Wh.D)()||{name:"",description:"",url:"",icons:[""]}}function uE(u,s){var r;const o=wi(),a={protocol:u,version:s,env:o};return o==="browser"&&(a.host=((r=he())==null?void 0:r.host)||"unknown"),a}function El(){if(wi()===Ve.reactNative&&typeof j.g<"u"&&typeof(j.g==null?void 0:j.g.Platform)<"u"){const{OS:r,Version:o}=j.g.Platform;return[r,o].join("-")}const u=(0,Jh.qY)();if(u===null)return"unknown";const s=u.os?u.os.replace(" ","").toLowerCase():"unknown";return u.type==="browser"?[s,u.name,u.version].join("-"):[s,u.version].join("-")}function Il(){var u;const s=wi();return s===Ve.browser?[s,((u=(0,Vi.getLocation)())==null?void 0:u.host)||"unknown"].join(":"):s}function Pl(u,s,r){const o=El(),a=Il();return[[u,s].join("-"),[ml,r].join("-"),o,a].join("/")}function xl({protocol:u,version:s,relayUrl:r,sdkVersion:o,auth:a,projectId:p,useOnCloseEvent:g,bundleId:m}){const b=r.split("?"),x=Pl(u,s,o),N={auth:a,ua:x,projectId:p,useOnCloseEvent:g||void 0,origin:m||void 0},O=_l(b[1]||"",N);return b[0]+"?"+O}function hE(u){let s=(u.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const r=typeof s<"u"?u.split("://")[1]:u;return s=s==="wss"?"https":"http",[s,r].join("://")}function lE(u,s,r){if(!u[s]||typeof u[s]!==r)throw new Error(`Missing or invalid "${s}" param`)}function Sl(u,s=Ko){return Rl(u.split(vl),s)}function pE(u){return Sl(u).join(js)}function ii(u,s){return u.filter(r=>s.includes(r)).length===u.length}function Rl(u,s=Ko){return u.slice(Math.max(u.length-s,0))}function Ho(u){return Object.fromEntries(u.entries())}function Bo(u){return new Map(Object.entries(u))}function dE(u,s){const r={};return Object.keys(u).forEach(o=>{r[o]=s(u[o])}),r}const fE=u=>u;function Ol(u){return u.trim().replace(/^\w/,s=>s.toUpperCase())}function gE(u){return u.split(js).map(s=>Ol(s)).join(js)}function _i(u=$.FIVE_MINUTES,s){const r=(0,$.toMiliseconds)(u||$.FIVE_MINUTES);let o,a,p;return{resolve:g=>{p&&o&&(clearTimeout(p),o(g))},reject:g=>{p&&a&&(clearTimeout(p),a(g))},done:()=>new Promise((g,m)=>{p=setTimeout(()=>{m(new Error(s))},r),o=g,a=m})}}function Hi(u,s,r){return new Promise(async(o,a)=>{const p=setTimeout(()=>a(new Error(r)),s);try{const g=await u;o(g)}catch(g){a(g)}clearTimeout(p)})}function Go(u,s){if(typeof s=="string"&&s.startsWith(`${u}:`))return s;if(u.toLowerCase()==="topic"){if(typeof s!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${s}`}else if(u.toLowerCase()==="id"){if(typeof s!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${s}`}throw new Error(`Unknown expirer target type: ${u}`)}function Nl(u){return Go("topic",u)}function Cl(u){return Go("id",u)}function Jo(u){const[s,r]=u.split(":"),o={id:void 0,topic:void 0};if(s==="topic"&&typeof r=="string")o.topic=r;else if(s==="id"&&Number.isInteger(Number(r)))o.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${s}:${r}`);return o}function We(u,s){return(0,$.fromMiliseconds)((s||Date.now())+(0,$.toMiliseconds)(u))}function zt(u){return Date.now()>=(0,$.toMiliseconds)(u)}function _e(u,s){return`${u}${s?`:${s}`:""}`}function mt(u=[],s=[]){return[...new Set([...u,...s])]}async function Al({id:u,topic:s,wcDeepLink:r}){try{if(!r)return;const o=typeof r=="string"?JSON.parse(r):r;let a=o==null?void 0:o.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const p=`${a}/wc?requestId=${u}&sessionTopic=${s}`,g=wi();g===Ve.browser?p.startsWith("https://")?window.open(p,"_blank","noreferrer noopener"):window.open(p,"_self","noreferrer noopener"):g===Ve.reactNative&&typeof(j.g==null?void 0:j.g.Linking)<"u"&&await j.g.Linking.openURL(p)}catch(o){console.error(o)}}async function Dl(u,s){try{return await u.getItem(s)||(mi()?localStorage.getItem(s):void 0)}catch(r){console.error(r)}}const Fl="irn";function Ls(u){return(u==null?void 0:u.relay)||{protocol:Fl}}function Ir(u){const s=Qh.RELAY_JSONRPC[u];if(typeof s>"u")throw new Error(`Relay Protocol not supported: ${u}`);return s}var Tl=Object.defineProperty,ql=Object.defineProperties,$l=Object.getOwnPropertyDescriptors,Wo=Object.getOwnPropertySymbols,jl=Object.prototype.hasOwnProperty,Ul=Object.prototype.propertyIsEnumerable,Qo=(u,s,r)=>s in u?Tl(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Ll=(u,s)=>{for(var r in s||(s={}))jl.call(s,r)&&Qo(u,r,s[r]);if(Wo)for(var r of Wo(s))Ul.call(s,r)&&Qo(u,r,s[r]);return u},zl=(u,s)=>ql(u,$l(s));function Ml(u,s="-"){const r={},o="relay"+s;return Object.keys(u).forEach(a=>{if(a.startsWith(o)){const p=a.replace(o,""),g=u[a];r[p]=g}}),r}function Yo(u){u=u.includes("wc://")?u.replace("wc://",""):u,u=u.includes("wc:")?u.replace("wc:",""):u;const s=u.indexOf(":"),r=u.indexOf("?")!==-1?u.indexOf("?"):void 0,o=u.substring(0,s),a=u.substring(s+1,r).split("@"),p=typeof r<"u"?u.substring(r):"",g=_r.parse(p);return{protocol:o,topic:kl(a[0]),version:parseInt(a[1],10),symKey:g.symKey,relay:Ml(g),expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function kl(u){return u.startsWith("//")?u.substring(2):u}function Vl(u,s="-"){const r="relay",o={};return Object.keys(u).forEach(a=>{const p=r+s+a;u[a]&&(o[p]=u[a])}),o}function Kl(u){return`${u.protocol}:${u.topic}@${u.version}?`+_r.stringify(zl(Ll({symKey:u.symKey},Vl(u.relay)),{expiryTimestamp:u.expiryTimestamp}))}var Hl=Object.defineProperty,Bl=Object.defineProperties,Gl=Object.getOwnPropertyDescriptors,Zo=Object.getOwnPropertySymbols,Jl=Object.prototype.hasOwnProperty,Wl=Object.prototype.propertyIsEnumerable,Xo=(u,s,r)=>s in u?Hl(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Ql=(u,s)=>{for(var r in s||(s={}))Jl.call(s,r)&&Xo(u,r,s[r]);if(Zo)for(var r of Zo(s))Wl.call(s,r)&&Xo(u,r,s[r]);return u},Yl=(u,s)=>Bl(u,Gl(s));function bi(u){const s=[];return u.forEach(r=>{const[o,a]=r.split(":");s.push(`${o}:${a}`)}),s}function Zl(u){const s=[];return Object.values(u).forEach(r=>{s.push(...bi(r.accounts))}),s}function Xl(u,s){const r=[];return Object.values(u).forEach(o=>{bi(o.accounts).includes(s)&&r.push(...o.methods)}),r}function ep(u,s){const r=[];return Object.values(u).forEach(o=>{bi(o.accounts).includes(s)&&r.push(...o.events)}),r}function yE(u,s){const r=Sr(u,s);if(r)throw new Error(r.message);const o={};for(const[a,p]of Object.entries(u))o[a]={methods:p.methods,events:p.events,chains:p.accounts.map(g=>`${g.split(":")[0]}:${g.split(":")[1]}`)};return o}function vE(u){const{proposal:{requiredNamespaces:s,optionalNamespaces:r={}},supportedNamespaces:o}=u,a=ea(s),p=ea(r),g={};Object.keys(o).forEach(x=>{const N=o[x].chains,O=o[x].methods,q=o[x].events,ne=o[x].accounts;N.forEach(F=>{if(!ne.some(k=>k.includes(F)))throw new Error(`No accounts provided for chain ${F} in namespace ${x}`)}),g[x]={chains:N,methods:O,events:q,accounts:ne}});const m=Ms(s,g,"approve()");if(m)throw new Error(m.message);const b={};return!Object.keys(s).length&&!Object.keys(r).length?g:(Object.keys(a).forEach(x=>{const N=o[x].chains.filter(F=>{var k,W;return(W=(k=a[x])==null?void 0:k.chains)==null?void 0:W.includes(F)}),O=o[x].methods.filter(F=>{var k,W;return(W=(k=a[x])==null?void 0:k.methods)==null?void 0:W.includes(F)}),q=o[x].events.filter(F=>{var k,W;return(W=(k=a[x])==null?void 0:k.events)==null?void 0:W.includes(F)}),ne=N.map(F=>o[x].accounts.filter(k=>k.includes(`${F}:`))).flat();b[x]={chains:N,methods:O,events:q,accounts:ne}}),Object.keys(p).forEach(x=>{var N,O,q,ne,F,k;if(!o[x])return;const W=(O=(N=p[x])==null?void 0:N.chains)==null?void 0:O.filter(ie=>o[x].chains.includes(ie)),ae=o[x].methods.filter(ie=>{var G,ge;return(ge=(G=p[x])==null?void 0:G.methods)==null?void 0:ge.includes(ie)}),Ne=o[x].events.filter(ie=>{var G,ge;return(ge=(G=p[x])==null?void 0:G.events)==null?void 0:ge.includes(ie)}),ue=W==null?void 0:W.map(ie=>o[x].accounts.filter(G=>G.includes(`${ie}:`))).flat();b[x]={chains:mt((q=b[x])==null?void 0:q.chains,W),methods:mt((ne=b[x])==null?void 0:ne.methods,ae),events:mt((F=b[x])==null?void 0:F.events,Ne),accounts:mt((k=b[x])==null?void 0:k.accounts,ue)}}),b)}function Pr(u){return u.includes(":")}function Ei(u){return Pr(u)?u.split(":")[0]:u}function ea(u){var s,r,o;const a={};if(!Ii(u))return a;for(const[p,g]of Object.entries(u)){const m=Pr(p)?[p]:g.chains,b=g.methods||[],x=g.events||[],N=Ei(p);a[N]=Yl(Ql({},a[N]),{chains:mt(m,(s=a[N])==null?void 0:s.chains),methods:mt(b,(r=a[N])==null?void 0:r.methods),events:mt(x,(o=a[N])==null?void 0:o.events)})}return a}const tp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},ip={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function C(u,s){const{message:r,code:o}=ip[u];return{message:s?`${r} ${s}`:r,code:o}}function ve(u,s){const{message:r,code:o}=tp[u];return{message:s?`${r} ${s}`:r,code:o}}function ri(u,s){return Array.isArray(u)?typeof s<"u"&&u.length?u.every(s):!0:!1}function Ii(u){return Object.getPrototypeOf(u)===Object.prototype&&Object.keys(u).length}function je(u){return typeof u>"u"}function Se(u,s){return s&&je(u)?!0:typeof u=="string"&&!!u.trim().length}function zs(u,s){return s&&je(u)?!0:typeof u=="number"&&!isNaN(u)}function rp(u,s){const{requiredNamespaces:r}=s,o=Object.keys(u.namespaces),a=Object.keys(r);let p=!0;return ii(a,o)?(o.forEach(g=>{const{accounts:m,methods:b,events:x}=u.namespaces[g],N=bi(m),O=r[g];(!ii(Cs(g,O),N)||!ii(O.methods,b)||!ii(O.events,x))&&(p=!1)}),p):!1}function xr(u){return Se(u,!1)&&u.includes(":")?u.split(":").length===2:!1}function sp(u){if(Se(u,!1)&&u.includes(":")){const s=u.split(":");if(s.length===3){const r=s[0]+":"+s[1];return!!s[2]&&xr(r)}}return!1}function np(u){if(Se(u,!1))try{return typeof new URL(u)<"u"}catch{return!1}return!1}function op(u){var s;return(s=u==null?void 0:u.proposer)==null?void 0:s.publicKey}function ap(u){return u==null?void 0:u.topic}function cp(u,s){let r=null;return Se(u==null?void 0:u.publicKey,!1)||(r=C("MISSING_OR_INVALID",`${s} controller public key should be a string`)),r}function ta(u){let s=!0;return ri(u)?u.length&&(s=u.every(r=>Se(r,!1))):s=!1,s}function up(u,s,r){let o=null;return ri(s)&&s.length?s.forEach(a=>{o||xr(a)||(o=ve("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):xr(u)||(o=ve("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),o}function hp(u,s,r){let o=null;return Object.entries(u).forEach(([a,p])=>{if(o)return;const g=up(a,Cs(a,p),`${s} ${r}`);g&&(o=g)}),o}function lp(u,s){let r=null;return ri(u)?u.forEach(o=>{r||sp(o)||(r=ve("UNSUPPORTED_ACCOUNTS",`${s}, account ${o} should be a string and conform to "namespace:chainId:address" format`))}):r=ve("UNSUPPORTED_ACCOUNTS",`${s}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function pp(u,s){let r=null;return Object.values(u).forEach(o=>{if(r)return;const a=lp(o==null?void 0:o.accounts,`${s} namespace`);a&&(r=a)}),r}function dp(u,s){let r=null;return ta(u==null?void 0:u.methods)?ta(u==null?void 0:u.events)||(r=ve("UNSUPPORTED_EVENTS",`${s}, events should be an array of strings or empty array for no events`)):r=ve("UNSUPPORTED_METHODS",`${s}, methods should be an array of strings or empty array for no methods`),r}function ia(u,s){let r=null;return Object.values(u).forEach(o=>{if(r)return;const a=dp(o,`${s}, namespace`);a&&(r=a)}),r}function fp(u,s,r){let o=null;if(u&&Ii(u)){const a=ia(u,s);a&&(o=a);const p=hp(u,s,r);p&&(o=p)}else o=C("MISSING_OR_INVALID",`${s}, ${r} should be an object with data`);return o}function Sr(u,s){let r=null;if(u&&Ii(u)){const o=ia(u,s);o&&(r=o);const a=pp(u,s);a&&(r=a)}else r=C("MISSING_OR_INVALID",`${s}, namespaces should be an object with data`);return r}function ra(u){return Se(u.protocol,!0)}function gp(u,s){let r=!1;return s&&!u?r=!0:u&&ri(u)&&u.length&&u.forEach(o=>{r=ra(o)}),r}function yp(u){return typeof u=="number"}function Ke(u){return typeof u<"u"&&typeof u!==null}function vp(u){return!(!u||typeof u!="object"||!u.code||!zs(u.code,!1)||!u.message||!Se(u.message,!1))}function mp(u){return!(je(u)||!Se(u.method,!1))}function wp(u){return!(je(u)||je(u.result)&&je(u.error)||!zs(u.id,!1)||!Se(u.jsonrpc,!1))}function _p(u){return!(je(u)||!Se(u.name,!1))}function sa(u,s){return!(!xr(s)||!Zl(u).includes(s))}function bp(u,s,r){return Se(r,!1)?Xl(u,s).includes(r):!1}function Ep(u,s,r){return Se(r,!1)?ep(u,s).includes(r):!1}function Ms(u,s,r){let o=null;const a=Ip(u),p=Pp(s),g=Object.keys(a),m=Object.keys(p),b=na(Object.keys(u)),x=na(Object.keys(s)),N=b.filter(O=>!x.includes(O));return N.length&&(o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${N.toString()}
      Received: ${Object.keys(s).toString()}`)),ii(g,m)||(o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${g.toString()}
      Approved: ${m.toString()}`)),Object.keys(s).forEach(O=>{if(!O.includes(":")||o)return;const q=bi(s[O].accounts);q.includes(O)||(o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${q.toString()}`))}),g.forEach(O=>{o||(ii(a[O].methods,p[O].methods)?ii(a[O].events,p[O].events)||(o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${O}`)):o=C("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${O}`))}),o}function Ip(u){const s={};return Object.keys(u).forEach(r=>{var o;r.includes(":")?s[r]=u[r]:(o=u[r].chains)==null||o.forEach(a=>{s[a]={methods:u[r].methods,events:u[r].events}})}),s}function na(u){return[...new Set(u.map(s=>s.includes(":")?s.split(":")[0]:s))]}function Pp(u){const s={};return Object.keys(u).forEach(r=>{if(r.includes(":"))s[r]=u[r];else{const o=bi(u[r].accounts);o==null||o.forEach(a=>{s[a]={accounts:u[r].accounts.filter(p=>p.includes(`${a}:`)),methods:u[r].methods,events:u[r].events}})}}),s}function xp(u,s){return zs(u,!1)&&u<=s.max&&u>=s.min}function oa(){const u=wi();return new Promise(s=>{switch(u){case Ve.browser:s(Sp());break;case Ve.reactNative:s(Rp());break;case Ve.node:s(Op());break;default:s(!0)}})}function Sp(){return mi()&&(navigator==null?void 0:navigator.onLine)}async function Rp(){if(vi()&&typeof j.g<"u"&&j.g!=null&&j.g.NetInfo){const u=await(j.g==null?void 0:j.g.NetInfo.fetch());return u==null?void 0:u.isConnected}return!0}function Op(){return!0}function Np(u){switch(wi()){case Ve.browser:Cp(u);break;case Ve.reactNative:Ap(u);break;case Ve.node:break}}function Cp(u){!vi()&&mi()&&(window.addEventListener("online",()=>u(!0)),window.addEventListener("offline",()=>u(!1)))}function Ap(u){var s;vi()&&typeof j.g<"u"&&j.g!=null&&j.g.NetInfo&&((s=j.g)==null||s.NetInfo.addEventListener(r=>u(r==null?void 0:r.isConnected)))}const ks={};class Rr{static get(s){return ks[s]}static set(s,r){ks[s]=r}static delete(s){delete ks[s]}}var Pt=j(83102),Y=j(23700),Dp=j(66865),Fp=j(5899),Tp=j.n(Fp),qp=j(51538),$p=j.n(qp);function jp(u,s){if(u.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),o=0;o<r.length;o++)r[o]=255;for(var a=0;a<u.length;a++){var p=u.charAt(a),g=p.charCodeAt(0);if(r[g]!==255)throw new TypeError(p+" is ambiguous");r[g]=a}var m=u.length,b=u.charAt(0),x=Math.log(m)/Math.log(256),N=Math.log(256)/Math.log(m);function O(F){if(F instanceof Uint8Array||(ArrayBuffer.isView(F)?F=new Uint8Array(F.buffer,F.byteOffset,F.byteLength):Array.isArray(F)&&(F=Uint8Array.from(F))),!(F instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(F.length===0)return"";for(var k=0,W=0,ae=0,Ne=F.length;ae!==Ne&&F[ae]===0;)ae++,k++;for(var ue=(Ne-ae)*N+1>>>0,ie=new Uint8Array(ue);ae!==Ne;){for(var G=F[ae],ge=0,be=ue-1;(G!==0||ge<W)&&be!==-1;be--,ge++)G+=256*ie[be]>>>0,ie[be]=G%m>>>0,G=G/m>>>0;if(G!==0)throw new Error("Non-zero carry");W=ge,ae++}for(var Le=ue-W;Le!==ue&&ie[Le]===0;)Le++;for(var Kt=b.repeat(k);Le<ue;++Le)Kt+=u.charAt(ie[Le]);return Kt}function q(F){if(typeof F!="string")throw new TypeError("Expected String");if(F.length===0)return new Uint8Array;var k=0;if(F[k]!==" "){for(var W=0,ae=0;F[k]===b;)W++,k++;for(var Ne=(F.length-k)*x+1>>>0,ue=new Uint8Array(Ne);F[k];){var ie=r[F.charCodeAt(k)];if(ie===255)return;for(var G=0,ge=Ne-1;(ie!==0||G<ae)&&ge!==-1;ge--,G++)ie+=m*ue[ge]>>>0,ue[ge]=ie%256>>>0,ie=ie/256>>>0;if(ie!==0)throw new Error("Non-zero carry");ae=G,k++}if(F[k]!==" "){for(var be=Ne-ae;be!==Ne&&ue[be]===0;)be++;for(var Le=new Uint8Array(W+(Ne-be)),Kt=W;be!==Ne;)Le[Kt++]=ue[be++];return Le}}}function ne(F){var k=q(F);if(k)return k;throw new Error(`Non-${s} character`)}return{encode:O,decodeUnsafe:q,decode:ne}}var Up=jp,Lp=Up;const aa=u=>{if(u instanceof Uint8Array&&u.constructor.name==="Uint8Array")return u;if(u instanceof ArrayBuffer)return new Uint8Array(u);if(ArrayBuffer.isView(u))return new Uint8Array(u.buffer,u.byteOffset,u.byteLength);throw new Error("Unknown type, must be binary type")},zp=u=>new TextEncoder().encode(u),Mp=u=>new TextDecoder().decode(u);class kp{constructor(s,r,o){this.name=s,this.prefix=r,this.baseEncode=o}encode(s){if(s instanceof Uint8Array)return`${this.prefix}${this.baseEncode(s)}`;throw Error("Unknown type, must be binary type")}}class Vp{constructor(s,r,o){if(this.name=s,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=o}decode(s){if(typeof s=="string"){if(s.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(s)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(s.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(s){return ca(this,s)}}class Kp{constructor(s){this.decoders=s}or(s){return ca(this,s)}decode(s){const r=s[0],o=this.decoders[r];if(o)return o.decode(s);throw RangeError(`Unable to decode multibase string ${JSON.stringify(s)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ca=(u,s)=>new Kp({...u.decoders||{[u.prefix]:u},...s.decoders||{[s.prefix]:s}});class Hp{constructor(s,r,o,a){this.name=s,this.prefix=r,this.baseEncode=o,this.baseDecode=a,this.encoder=new kp(s,r,o),this.decoder=new Vp(s,r,a)}encode(s){return this.encoder.encode(s)}decode(s){return this.decoder.decode(s)}}const Or=({name:u,prefix:s,encode:r,decode:o})=>new Hp(u,s,r,o),Bi=({prefix:u,name:s,alphabet:r})=>{const{encode:o,decode:a}=Lp(r,s);return Or({prefix:u,name:s,encode:o,decode:p=>aa(a(p))})},Bp=(u,s,r,o)=>{const a={};for(let N=0;N<s.length;++N)a[s[N]]=N;let p=u.length;for(;u[p-1]==="=";)--p;const g=new Uint8Array(p*r/8|0);let m=0,b=0,x=0;for(let N=0;N<p;++N){const O=a[u[N]];if(O===void 0)throw new SyntaxError(`Non-${o} character`);b=b<<r|O,m+=r,m>=8&&(m-=8,g[x++]=255&b>>m)}if(m>=r||255&b<<8-m)throw new SyntaxError("Unexpected end of data");return g},Gp=(u,s,r)=>{const o=s[s.length-1]==="=",a=(1<<r)-1;let p="",g=0,m=0;for(let b=0;b<u.length;++b)for(m=m<<8|u[b],g+=8;g>r;)g-=r,p+=s[a&m>>g];if(g&&(p+=s[a&m<<r-g]),o)for(;p.length*r&7;)p+="=";return p},Oe=({name:u,prefix:s,bitsPerChar:r,alphabet:o})=>Or({prefix:s,name:u,encode(a){return Gp(a,o,r)},decode(a){return Bp(a,o,r,u)}}),Jp=Or({prefix:"\0",name:"identity",encode:u=>Mp(u),decode:u=>zp(u)});var Wp=Object.freeze({__proto__:null,identity:Jp});const Qp=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Yp=Object.freeze({__proto__:null,base2:Qp});const Zp=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Xp=Object.freeze({__proto__:null,base8:Zp});const ed=Bi({prefix:"9",name:"base10",alphabet:"0123456789"});var td=Object.freeze({__proto__:null,base10:ed});const id=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rd=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var sd=Object.freeze({__proto__:null,base16:id,base16upper:rd});const nd=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),od=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ad=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),cd=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ud=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),hd=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ld=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),pd=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),dd=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var fd=Object.freeze({__proto__:null,base32:nd,base32upper:od,base32pad:ad,base32padupper:cd,base32hex:ud,base32hexupper:hd,base32hexpad:ld,base32hexpadupper:pd,base32z:dd});const gd=Bi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),yd=Bi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var vd=Object.freeze({__proto__:null,base36:gd,base36upper:yd});const md=Bi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),wd=Bi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var _d=Object.freeze({__proto__:null,base58btc:md,base58flickr:wd});const bd=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ed=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Id=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Pd=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var xd=Object.freeze({__proto__:null,base64:bd,base64pad:Ed,base64url:Id,base64urlpad:Pd});const ua=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Sd=ua.reduce((u,s,r)=>(u[r]=s,u),[]),Rd=ua.reduce((u,s,r)=>(u[s.codePointAt(0)]=r,u),[]);function Od(u){return u.reduce((s,r)=>(s+=Sd[r],s),"")}function Nd(u){const s=[];for(const r of u){const o=Rd[r.codePointAt(0)];if(o===void 0)throw new Error(`Non-base256emoji character: ${r}`);s.push(o)}return new Uint8Array(s)}const Cd=Or({prefix:"\u{1F680}",name:"base256emoji",encode:Od,decode:Nd});var Ad=Object.freeze({__proto__:null,base256emoji:Cd}),Dd=la,ha=128,Fd=127,Td=~Fd,qd=Math.pow(2,31);function la(u,s,r){s=s||[],r=r||0;for(var o=r;u>=qd;)s[r++]=u&255|ha,u/=128;for(;u&Td;)s[r++]=u&255|ha,u>>>=7;return s[r]=u|0,la.bytes=r-o+1,s}var $d=Vs,jd=128,pa=127;function Vs(u,o){var r=0,o=o||0,a=0,p=o,g,m=u.length;do{if(p>=m)throw Vs.bytes=0,new RangeError("Could not decode varint");g=u[p++],r+=a<28?(g&pa)<<a:(g&pa)*Math.pow(2,a),a+=7}while(g>=jd);return Vs.bytes=p-o,r}var Ud=Math.pow(2,7),Ld=Math.pow(2,14),zd=Math.pow(2,21),Md=Math.pow(2,28),kd=Math.pow(2,35),Vd=Math.pow(2,42),Kd=Math.pow(2,49),Hd=Math.pow(2,56),Bd=Math.pow(2,63),Gd=function(u){return u<Ud?1:u<Ld?2:u<zd?3:u<Md?4:u<kd?5:u<Vd?6:u<Kd?7:u<Hd?8:u<Bd?9:10},Jd={encode:Dd,decode:$d,encodingLength:Gd},da=Jd;const fa=(u,s,r=0)=>(da.encode(u,s,r),s),ga=u=>da.encodingLength(u),Ks=(u,s)=>{const r=s.byteLength,o=ga(u),a=o+ga(r),p=new Uint8Array(a+r);return fa(u,p,0),fa(r,p,o),p.set(s,a),new Wd(u,r,s,p)};class Wd{constructor(s,r,o,a){this.code=s,this.size=r,this.digest=o,this.bytes=a}}const ya=({name:u,code:s,encode:r})=>new Qd(u,s,r);class Qd{constructor(s,r,o){this.name=s,this.code=r,this.encode=o}digest(s){if(s instanceof Uint8Array){const r=this.encode(s);return r instanceof Uint8Array?Ks(this.code,r):r.then(o=>Ks(this.code,o))}else throw Error("Unknown type, must be binary type")}}const va=u=>async s=>new Uint8Array(await crypto.subtle.digest(u,s)),Yd=ya({name:"sha2-256",code:18,encode:va("SHA-256")}),Zd=ya({name:"sha2-512",code:19,encode:va("SHA-512")});var Xd=Object.freeze({__proto__:null,sha256:Yd,sha512:Zd});const ma=0,ef="identity",wa=aa;var tf=Object.freeze({__proto__:null,identity:{code:ma,name:ef,encode:wa,digest:u=>Ks(ma,wa(u))}});new TextEncoder,new TextDecoder;const _a={...Wp,...Yp,...Xp,...td,...sd,...fd,...vd,..._d,...xd,...Ad};({...Xd,...tf});function ba(u){return globalThis.Buffer!=null?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):u}function rf(u=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ba(globalThis.Buffer.allocUnsafe(u)):new Uint8Array(u)}function Ea(u,s,r,o){return{name:u,prefix:s,encoder:{name:u,prefix:s,encode:r},decoder:{decode:o}}}const Ia=Ea("utf8","u",u=>"u"+new TextDecoder("utf8").decode(u),u=>new TextEncoder().encode(u.substring(1))),Hs=Ea("ascii","a",u=>{let s="a";for(let r=0;r<u.length;r++)s+=String.fromCharCode(u[r]);return s},u=>{u=u.substring(1);const s=rf(u.length);for(let r=0;r<u.length;r++)s[r]=u.charCodeAt(r);return s}),sf={utf8:Ia,"utf-8":Ia,hex:_a.base16,latin1:Hs,ascii:Hs,binary:Hs,..._a};function nf(u,s="utf8"){const r=sf[s];if(!r)throw new Error(`Unsupported encoding "${s}"`);return(s==="utf8"||s==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ba(globalThis.Buffer.from(u,"utf-8")):r.decoder.decode(`${r.prefix}${u}`)}const Pa="wc",of=2,Bs="core",Mt=`${Pa}@2:${Bs}:`,af={name:Bs,logger:"error"},cf={database:":memory:"},uf="crypto",xa="client_ed25519_seed",hf=$.ONE_DAY,lf="keychain",pf="0.3",df="messages",ff="0.3",gf=$.SIX_HOURS,yf="publisher",Sa="irn",vf="error",Ra="wss://relay.walletconnect.com",Oa="wss://relay.walletconnect.org",mf="relayer",De={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},wf="_subscription",xt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},_f=$.ONE_SECOND,_E={database:":memory:"},bf="2.11.2",Ef=1e4,If="0.3",Pf="WALLETCONNECT_CLIENT_ID",lt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},bE=null,xf="subscription",Sf="0.3",Rf=$.FIVE_SECONDS*1e3,Of="pairing",Nf="0.3",EE=null,Gi={wc_pairingDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:$.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:$.ONE_DAY,prompt:!1,tag:0},res:{ttl:$.ONE_DAY,prompt:!1,tag:0}}},Ji={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},wt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Cf="history",Af="0.3",Df="expirer",it={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ff="0.3",IE=null,Gs="verify-api",Pi="https://verify.walletconnect.com",Js="https://verify.walletconnect.org",Tf=[Pi,Js],qf="echo",$f="https://echo.walletconnect.com";class jf{constructor(s,r){this.core=s,this.logger=r,this.keychain=new Map,this.name=lf,this.version=pf,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){const o=await this.getKeyChain();typeof o<"u"&&(this.keychain=o),this.initialized=!0}},this.has=o=>(this.isInitialized(),this.keychain.has(o)),this.set=async(o,a)=>{this.isInitialized(),this.keychain.set(o,a),await this.persist()},this.get=o=>{this.isInitialized();const a=this.keychain.get(o);if(typeof a>"u"){const{message:p}=C("NO_MATCHING_KEY",`${this.name}: ${o}`);throw new Error(p)}return a},this.del=async o=>{this.isInitialized(),this.keychain.delete(o),await this.persist()},this.core=s,this.logger=(0,ee.generateChildLogger)(r,this.name)}get context(){return(0,ee.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(s){await this.core.storage.setItem(this.storageKey,Ho(s))}async getKeyChain(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?Bo(s):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Uf{constructor(s,r,o){this.core=s,this.logger=r,this.name=uf,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),p=wr.generateKeyPair(a);return wr.encodeIss(p.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=nl();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const p=await this.getClientSeed(),g=wr.generateKeyPair(p),m=$s(),b=hf;return await wr.signJWT(m,a,b,g)},this.generateSharedKey=(a,p,g)=>{this.isInitialized();const m=this.getPrivateKey(a),b=ol(m,p);return this.setSymKey(b,g)},this.setSymKey=async(a,p)=>{this.isInitialized();const g=p||al(a);return await this.keychain.set(g,a),g},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,p,g)=>{this.isInitialized();const m=Lo(g),b=(0,No.u)(p);if(zo(m)){const q=m.senderPublicKey,ne=m.receiverPublicKey;a=await this.generateSharedKey(q,ne)}const x=this.getSymKey(a),{type:N,senderPublicKey:O}=m;return ul({type:N,symKey:x,message:b,senderPublicKey:O})},this.decode=async(a,p,g)=>{this.isInitialized();const m=pl(p,g);if(zo(m)){const b=m.receiverPublicKey,x=m.senderPublicKey;a=await this.generateSharedKey(b,x)}try{const b=this.getSymKey(a),x=hl({symKey:b,encoded:p});return(0,No.D)(x)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}},this.getPayloadType=a=>{const p=Er(a);return Ki(p.type)},this.getPayloadSenderPublicKey=a=>{const p=Er(a);return p.senderPublicKey?(0,pe.BB)(p.senderPublicKey,$e):void 0},this.core=s,this.logger=(0,ee.generateChildLogger)(r,this.name),this.keychain=o||new jf(this.core,this.logger)}get context(){return(0,ee.getLoggerContext)(this.logger)}async setPrivateKey(s,r){return await this.keychain.set(s,r),s}getPrivateKey(s){return this.keychain.get(s)}async getClientSeed(){let s="";try{s=this.keychain.get(xa)}catch{s=$s(),await this.keychain.set(xa,s)}return nf(s,"base16")}getSymKey(s){return this.keychain.get(s)}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Lf extends jh{constructor(s,r){super(s,r),this.logger=s,this.core=r,this.messages=new Map,this.name=df,this.version=ff,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const o=await this.getRelayerMessages();typeof o<"u"&&(this.messages=o),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(o){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(o)}finally{this.initialized=!0}}},this.set=async(o,a)=>{this.isInitialized();const p=yi(a);let g=this.messages.get(o);return typeof g>"u"&&(g={}),typeof g[p]<"u"||(g[p]=a,this.messages.set(o,g),await this.persist()),p},this.get=o=>{this.isInitialized();let a=this.messages.get(o);return typeof a>"u"&&(a={}),a},this.has=(o,a)=>{this.isInitialized();const p=this.get(o),g=yi(a);return typeof p[g]<"u"},this.del=async o=>{this.isInitialized(),this.messages.delete(o),await this.persist()},this.logger=(0,ee.generateChildLogger)(s,this.name),this.core=r}get context(){return(0,ee.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(s){await this.core.storage.setItem(this.storageKey,Ho(s))}async getRelayerMessages(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?Bo(s):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class zf extends Uh{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.events=new Lt.EventEmitter,this.name=yf,this.queue=new Map,this.publishTimeout=(0,$.toMiliseconds)($.TEN_SECONDS*2),this.needsTransportRestart=!1,this.publish=async(o,a,p)=>{var g;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:p}});try{const m=(p==null?void 0:p.ttl)||gf,b=Ls(p),x=(p==null?void 0:p.prompt)||!1,N=(p==null?void 0:p.tag)||0,O=(p==null?void 0:p.id)||(0,Y.getBigIntRpcId)().toString(),q={topic:o,message:a,opts:{ttl:m,relay:b,prompt:x,tag:N,id:O}},ne=setTimeout(()=>this.queue.set(O,q),this.publishTimeout);try{await await Hi(this.rpcPublish(o,a,m,b,x,N,O),this.publishTimeout,`Failed to publish payload, please try again. id:${O} tag:${N}`),this.removeRequestFromQueue(O),this.relayer.events.emit(De.publish,q)}catch(F){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(g=p==null?void 0:p.internal)!=null&&g.throwOnFailedPublish)throw this.removeRequestFromQueue(O),F;return}finally{clearTimeout(ne)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:p}})}catch(m){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(m),m}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.relayer=s,this.logger=(0,ee.generateChildLogger)(r,this.name),this.registerEventListeners()}get context(){return(0,ee.getLoggerContext)(this.logger)}rpcPublish(s,r,o,a,p,g,m){var b,x,N,O;const q={method:Ir(a.protocol).publish,params:{topic:s,message:r,ttl:o,prompt:p,tag:g},id:m};return je((b=q.params)==null?void 0:b.prompt)&&((x=q.params)==null||delete x.prompt),je((N=q.params)==null?void 0:N.tag)&&((O=q.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:q}),this.relayer.request(q)}removeRequestFromQueue(s){this.queue.delete(s)}checkQueue(){this.queue.forEach(async s=>{const{topic:r,message:o,opts:a}=s;await this.publish(r,o,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(ki.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(De.connection_stalled);return}this.checkQueue()}),this.relayer.on(De.message_ack,s=>{this.removeRequestFromQueue(s.id.toString())})}}class Mf{constructor(){this.map=new Map,this.set=(s,r)=>{const o=this.get(s);this.exists(s,r)||this.map.set(s,[...o,r])},this.get=s=>this.map.get(s)||[],this.exists=(s,r)=>this.get(s).includes(r),this.delete=(s,r)=>{if(typeof r>"u"){this.map.delete(s);return}if(!this.map.has(s))return;const o=this.get(s);if(!this.exists(s,r))return;const a=o.filter(p=>p!==r);if(!a.length){this.map.delete(s);return}this.map.set(s,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var kf=Object.defineProperty,Vf=Object.defineProperties,Kf=Object.getOwnPropertyDescriptors,Na=Object.getOwnPropertySymbols,Hf=Object.prototype.hasOwnProperty,Bf=Object.prototype.propertyIsEnumerable,Ca=(u,s,r)=>s in u?kf(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Wi=(u,s)=>{for(var r in s||(s={}))Hf.call(s,r)&&Ca(u,r,s[r]);if(Na)for(var r of Na(s))Bf.call(s,r)&&Ca(u,r,s[r]);return u},Ws=(u,s)=>Vf(u,Kf(s));class Gf extends Mh{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.subscriptions=new Map,this.topicMap=new Mf,this.events=new Lt.EventEmitter,this.name=xf,this.version=Sf,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Mt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const p=Ls(a),g={topic:o,relay:p};this.pending.set(o,g);const m=await this.rpcSubscribe(o,p);return this.onSubscribe(m,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}}),m}catch(p){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(p),p}},this.unsubscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(o,a.id,a):await this.unsubscribeByTopic(o,a)},this.isSubscribed=async o=>{if(this.topics.includes(o))return!0;const a=`${this.pendingSubscriptionWatchLabel}_${o}`;return await new Promise((p,g)=>{const m=new $.Watch;m.start(a);const b=setInterval(()=>{!this.pending.has(o)&&this.topics.includes(o)&&(clearInterval(b),m.stop(a),p(!0)),m.elapsed(a)>=Rf&&(clearInterval(b),m.stop(a),g(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=s,this.logger=(0,ee.generateChildLogger)(r,this.name),this.clientId=""}get context(){return(0,ee.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(s,r){let o=!1;try{o=this.getSubscription(s).topic===r}catch{}return o}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(s,r){const o=this.topicMap.get(s);await Promise.all(o.map(async a=>await this.unsubscribeById(s,a,r)))}async unsubscribeById(s,r,o){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}});try{const a=Ls(o);await this.rpcUnsubscribe(s,r,a);const p=ve("USER_DISCONNECTED",`${this.name}, ${s}`);await this.onUnsubscribe(s,r,p),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(s,r){const o={method:Ir(r.protocol).subscribe,params:{topic:s}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{await await Hi(this.relayer.request(o),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(De.connection_stalled)}return yi(s+this.clientId)}async rpcBatchSubscribe(s){if(!s.length)return;const r=s[0].relay,o={method:Ir(r.protocol).batchSubscribe,params:{topics:s.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await Hi(this.relayer.request(o),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(De.connection_stalled)}}rpcUnsubscribe(s,r,o){const a={method:Ir(o.protocol).unsubscribe,params:{topic:s,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(s,r){this.setSubscription(s,Ws(Wi({},r),{id:s})),this.pending.delete(r.topic)}onBatchSubscribe(s){s.length&&s.forEach(r=>{this.setSubscription(r.id,Wi({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(s,r,o){this.events.removeAllListeners(r),this.hasSubscription(r,s)&&this.deleteSubscription(r,o),await this.relayer.messages.del(s)}async setRelayerSubscriptions(s){await this.relayer.core.storage.setItem(this.storageKey,s)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(s,r){this.subscriptions.has(s)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:s,subscription:r}),this.addSubscription(s,r))}addSubscription(s,r){this.subscriptions.set(s,Wi({},r)),this.topicMap.set(r.topic,s),this.events.emit(lt.created,r)}getSubscription(s){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:s});const r=this.subscriptions.get(s);if(!r){const{message:o}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}deleteSubscription(s,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:s,reason:r});const o=this.getSubscription(s);this.subscriptions.delete(s),this.topicMap.delete(o.topic,s),this.events.emit(lt.deleted,Ws(Wi({},o),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(lt.sync)}async reset(){if(this.cached.length){const s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<s;r++){const o=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(o)}}this.events.emit(lt.resubscribed)}async restore(){try{const s=await this.getRelayerSubscriptions();if(typeof s>"u"||!s.length)return;if(this.subscriptions.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(s){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(s)}}async batchSubscribe(s){if(!s.length)return;const r=await this.rpcBatchSubscribe(s);ri(r)&&this.onBatchSubscribe(r.map((o,a)=>Ws(Wi({},s[a]),{id:o})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const s=[];this.pending.forEach(r=>{s.push(r)}),await this.batchSubscribe(s)}registerEventListeners(){this.relayer.core.heartbeat.on(ki.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(De.connect,async()=>{await this.onConnect()}),this.relayer.on(De.disconnect,()=>{this.onDisconnect()}),this.events.on(lt.created,async s=>{const r=lt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()}),this.events.on(lt.deleted,async s=>{const r=lt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}async restartToComplete(){this.restartInProgress&&await new Promise(s=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),s())},this.pollingInterval)})}}var Jf=Object.defineProperty,Aa=Object.getOwnPropertySymbols,Wf=Object.prototype.hasOwnProperty,Qf=Object.prototype.propertyIsEnumerable,Da=(u,s,r)=>s in u?Jf(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Yf=(u,s)=>{for(var r in s||(s={}))Wf.call(s,r)&&Da(u,r,s[r]);if(Aa)for(var r of Aa(s))Qf.call(s,r)&&Da(u,r,s[r]);return u};class Zf extends Lh{constructor(s){super(s),this.protocol="wc",this.version=2,this.events=new Lt.EventEmitter,this.name=mf,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.request=async r=>{this.logger.debug("Publishing Request Payload");const o=r.id;try{await this.toEstablishConnection();const a=this.provider.request(r);return this.requestsInFlight.set(o,{promise:a,request:r}),await a}catch(a){throw this.logger.debug("Failed to Publish Request"),this.logger.error(a),a}finally{this.requestsInFlight.delete(o)}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(De.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(De.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(xt.payload,this.onPayloadHandler),this.provider.on(xt.connect,this.onConnectHandler),this.provider.on(xt.disconnect,this.onDisconnectHandler),this.provider.on(xt.error,this.onProviderErrorHandler)},this.core=s.core,this.logger=typeof s.logger<"u"&&typeof s.logger!="string"?(0,ee.generateChildLogger)(s.logger,this.name):(0,ee.pino)((0,ee.getDefaultLoggerOptions)({level:s.logger||vf})),this.messages=new Lf(this.logger,s.core),this.subscriber=new Gf(this,this.logger),this.publisher=new zf(this,this.logger),this.relayUrl=(s==null?void 0:s.relayUrl)||Ra,this.projectId=s.projectId,this.bundleId=wl(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Oa}...`),await this.restartTransport(Oa)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Ef)}get context(){return(0,ee.getLoggerContext)(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(s,r,o){this.isInitialized(),await this.publisher.publish(s,r,o),await this.recordMessageEvent({topic:s,message:r,publishedAt:Date.now()})}async subscribe(s,r){var o;this.isInitialized();let a=((o=this.subscriber.topicMap.get(s))==null?void 0:o[0])||"";if(a)return a;let p;const g=m=>{m.topic===s&&(this.subscriber.off(lt.created,g),p())};return await Promise.all([new Promise(m=>{p=m,this.subscriber.on(lt.created,g)}),new Promise(async m=>{a=await this.subscriber.subscribe(s,r),m()})]),a}async unsubscribe(s,r){this.isInitialized(),await this.subscriber.unsubscribe(s,r)}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}off(s,r){this.events.off(s,r)}removeListener(s,r){this.events.removeListener(s,r)}async transportClose(){this.requestsInFlight.size>0&&(this.logger.debug("Waiting for all in-flight requests to finish before closing transport..."),this.requestsInFlight.forEach(async s=>{await s.promise})),this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Hi(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(s){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){s&&s!==this.relayUrl&&(this.relayUrl=s,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(lt.resubscribed,()=>{r()})}),new Promise(async(r,o)=>{try{await Hi(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){o(a);return}r()})])}catch(r){this.logger.error(r);const o=r;if(!this.isConnectionStalled(o.message))throw r;this.provider.events.emit(xt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(s){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=s||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await oa())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(s){return this.staleConnectionErrors.some(r=>s.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const s=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Pt.r(new Dp.Z(xl({sdkVersion:bf,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:s,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(s){const{topic:r,message:o}=s;await this.messages.set(r,o)}async shouldIgnoreMessageEvent(s){const{topic:r,message:o}=s;if(!o||o.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${o}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,o);return a&&this.logger.debug(`Ignoring duplicate message: ${o}`),a}async onProviderPayload(s){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:s}),(0,Y.isJsonRpcRequest)(s)){if(!s.method.endsWith(wf))return;const r=s.params,{topic:o,message:a,publishedAt:p}=r.data,g={topic:o,message:a,publishedAt:p};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Yf({type:"event",event:r.id},g)),this.events.emit(r.id,g),await this.acknowledgePayload(s),await this.onMessageEvent(g)}else(0,Y.isJsonRpcResponse)(s)&&this.events.emit(De.message_ack,s)}async onMessageEvent(s){await this.shouldIgnoreMessageEvent(s)||(this.events.emit(De.message,s),await this.recordMessageEvent(s))}async acknowledgePayload(s){const r=(0,Y.formatJsonRpcResult)(s.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(xt.payload,this.onPayloadHandler),this.provider.off(xt.connect,this.onConnectHandler),this.provider.off(xt.disconnect,this.onDisconnectHandler),this.provider.off(xt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(De.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let s=await oa();Np(async r=>{this.initialized&&s!==r&&(s=r,r?await this.restartTransport().catch(o=>this.logger.error(o)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(o=>this.logger.error(o))))})}onProviderDisconnect(){this.events.emit(De.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(s=>this.logger.error(s))},(0,$.toMiliseconds)(_f)))}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(s=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),s())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Xf=Object.defineProperty,Fa=Object.getOwnPropertySymbols,eg=Object.prototype.hasOwnProperty,tg=Object.prototype.propertyIsEnumerable,Ta=(u,s,r)=>s in u?Xf(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,qa=(u,s)=>{for(var r in s||(s={}))eg.call(s,r)&&Ta(u,r,s[r]);if(Fa)for(var r of Fa(s))tg.call(s,r)&&Ta(u,r,s[r]);return u};class Nr extends zh{constructor(s,r,o,a=Mt,p=void 0){super(s,r,o,a),this.core=s,this.logger=r,this.name=o,this.map=new Map,this.version=If,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!je(g)?this.map.set(this.getKey(g),g):op(g)?this.map.set(g.id,g):ap(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,m)=>{this.isInitialized(),this.map.has(g)?await this.update(g,m):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:m}),this.map.set(g,m),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(m=>Object.keys(g).every(b=>Tp()(m[b],g[b]))):this.values),this.update=async(g,m)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:m});const b=qa(qa({},this.getData(g)),m);this.map.set(g,b),await this.persist()},this.delete=async(g,m)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:m}),this.map.delete(g),await this.persist())},this.logger=(0,ee.generateChildLogger)(r,this.name),this.storagePrefix=a,this.getKey=p}get context(){return(0,ee.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(s){await this.core.storage.setItem(this.storageKey,s)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(s){const r=this.map.get(s);if(!r){const{message:o}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.error(o),new Error(o)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const s=await this.getDataStore();if(typeof s>"u"||!s.length)return;if(this.map.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(s){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(s)}}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class ig{constructor(s,r){this.core=s,this.logger=r,this.name=Of,this.version=Nf,this.events=new(Rs()),this.initialized=!1,this.storagePrefix=Mt,this.ignoredPayloadTypes=[ti],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:o})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...o])]},this.create=async()=>{this.isInitialized();const o=$s(),a=await this.core.crypto.setSymKey(o),p=We($.FIVE_MINUTES),g={protocol:Sa},m={topic:a,expiry:p,relay:g,active:!1},b=Kl({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:o,relay:g,expiryTimestamp:p});return await this.pairings.set(a,m),await this.core.relayer.subscribe(a),this.core.expirer.set(a,p),{topic:a,uri:b}},this.pair=async o=>{this.isInitialized(),this.isValidPair(o);const{topic:a,symKey:p,relay:g,expiryTimestamp:m}=Yo(o.uri);let b;if(this.pairings.keys.includes(a)&&(b=this.pairings.get(a),b.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const x=m||We($.FIVE_MINUTES),N={topic:a,relay:g,expiry:x,active:!1};return await this.pairings.set(a,N),this.core.expirer.set(a,x),o.activatePairing&&await this.activate({topic:a}),this.events.emit(Ji.create,N),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(p,a),await this.core.relayer.subscribe(a,{relay:g})),N},this.activate=async({topic:o})=>{this.isInitialized();const a=We($.THIRTY_DAYS);await this.pairings.update(o,{active:!0,expiry:a}),this.core.expirer.set(o,a)},this.ping=async o=>{this.isInitialized(),await this.isValidPing(o);const{topic:a}=o;if(this.pairings.keys.includes(a)){const p=await this.sendRequest(a,"wc_pairingPing",{}),{done:g,resolve:m,reject:b}=_i();this.events.once(_e("pairing_ping",p),({error:x})=>{x?b(x):m()}),await g()}},this.updateExpiry=async({topic:o,expiry:a})=>{this.isInitialized(),await this.pairings.update(o,{expiry:a})},this.updateMetadata=async({topic:o,metadata:a})=>{this.isInitialized(),await this.pairings.update(o,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async o=>{this.isInitialized(),await this.isValidDisconnect(o);const{topic:a}=o;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",ve("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(o,a,p)=>{const g=(0,Y.formatJsonRpcRequest)(a,p),m=await this.core.crypto.encode(o,g),b=Gi[a].req;return this.core.history.set(o,g),this.core.relayer.publish(o,m,b),g.id},this.sendResult=async(o,a,p)=>{const g=(0,Y.formatJsonRpcResult)(o,p),m=await this.core.crypto.encode(a,g),b=await this.core.history.get(a,o),x=Gi[b.request.method].res;await this.core.relayer.publish(a,m,x),await this.core.history.resolve(g)},this.sendError=async(o,a,p)=>{const g=(0,Y.formatJsonRpcError)(o,p),m=await this.core.crypto.encode(a,g),b=await this.core.history.get(a,o),x=Gi[b.request.method]?Gi[b.request.method].res:Gi.unregistered_method.res;await this.core.relayer.publish(a,m,x),await this.core.history.resolve(g)},this.deletePairing=async(o,a)=>{await this.core.relayer.unsubscribe(o),await Promise.all([this.pairings.delete(o,ve("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(o),a?Promise.resolve():this.core.expirer.del(o)])},this.cleanup=async()=>{const o=this.pairings.getAll().filter(a=>zt(a.expiry));await Promise.all(o.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=o=>{const{topic:a,payload:p}=o;switch(p.method){case"wc_pairingPing":return this.onPairingPingRequest(a,p);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,p);default:return this.onUnknownRpcMethodRequest(a,p)}},this.onRelayEventResponse=async o=>{const{topic:a,payload:p}=o,g=(await this.core.history.get(a,p.id)).request.method;switch(g){case"wc_pairingPing":return this.onPairingPingResponse(a,p);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(o,a)=>{const{id:p}=a;try{this.isValidPing({topic:o}),await this.sendResult(p,o,!0),this.events.emit(Ji.ping,{id:p,topic:o})}catch(g){await this.sendError(p,o,g),this.logger.error(g)}},this.onPairingPingResponse=(o,a)=>{const{id:p}=a;setTimeout(()=>{(0,Y.isJsonRpcResult)(a)?this.events.emit(_e("pairing_ping",p),{}):(0,Y.isJsonRpcError)(a)&&this.events.emit(_e("pairing_ping",p),{error:a.error})},500)},this.onPairingDeleteRequest=async(o,a)=>{const{id:p}=a;try{this.isValidDisconnect({topic:o}),await this.deletePairing(o),this.events.emit(Ji.delete,{id:p,topic:o})}catch(g){await this.sendError(p,o,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(o,a)=>{const{id:p,method:g}=a;try{if(this.registeredMethods.includes(g))return;const m=ve("WC_METHOD_UNSUPPORTED",g);await this.sendError(p,o,m),this.logger.error(m)}catch(m){await this.sendError(p,o,m),this.logger.error(m)}},this.onUnknownRpcMethodResponse=o=>{this.registeredMethods.includes(o)||this.logger.error(ve("WC_METHOD_UNSUPPORTED",o))},this.isValidPair=o=>{var a;if(!Ke(o)){const{message:g}=C("MISSING_OR_INVALID",`pair() params: ${o}`);throw new Error(g)}if(!np(o.uri)){const{message:g}=C("MISSING_OR_INVALID",`pair() uri: ${o.uri}`);throw new Error(g)}const p=Yo(o.uri);if(!((a=p==null?void 0:p.relay)!=null&&a.protocol)){const{message:g}=C("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(g)}if(!(p!=null&&p.symKey)){const{message:g}=C("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(g)}if(p!=null&&p.expiryTimestamp&&(0,$.toMiliseconds)(p==null?void 0:p.expiryTimestamp)<Date.now()){const{message:g}=C("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(g)}},this.isValidPing=async o=>{if(!Ke(o)){const{message:p}=C("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(p)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidDisconnect=async o=>{if(!Ke(o)){const{message:p}=C("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(p)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async o=>{if(!Se(o,!1)){const{message:a}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!this.pairings.keys.includes(o)){const{message:a}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if(zt(this.pairings.get(o).expiry)){await this.deletePairing(o);const{message:a}=C("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}},this.core=s,this.logger=(0,ee.generateChildLogger)(r,this.name),this.pairings=new Nr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,ee.getLoggerContext)(this.logger)}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}registerRelayerEvents(){this.core.relayer.on(De.message,async s=>{const{topic:r,message:o}=s;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(o)))return;const a=await this.core.crypto.decode(r,o);try{(0,Y.isJsonRpcRequest)(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):(0,Y.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(p){this.logger.error(p)}})}registerExpirerEvents(){this.core.expirer.on(it.expired,async s=>{const{topic:r}=Jo(s.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Ji.expire,{topic:r}))})}}class rg extends $h{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.records=new Map,this.events=new Lt.EventEmitter,this.name=Cf,this.version=Af,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.records.set(o.id,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(o,a,p)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:o,request:a,chainId:p}),this.records.has(a.id))return;const g={id:a.id,topic:o,request:{method:a.method,params:a.params||null},chainId:p,expiry:We($.THIRTY_DAYS)};this.records.set(g.id,g),this.events.emit(wt.created,g)},this.resolve=async o=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:o}),!this.records.has(o.id))return;const a=await this.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,Y.isJsonRpcError)(o)?{error:o.error}:{result:o.result},this.records.set(a.id,a),this.events.emit(wt.updated,a))},this.get=async(o,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:o,id:a}),await this.getRecord(a)),this.delete=(o,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(p=>{if(p.topic===o){if(typeof a<"u"&&p.id!==a)return;this.records.delete(p.id),this.events.emit(wt.deleted,p)}})},this.exists=async(o,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===o:!1),this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,ee.generateChildLogger)(r,this.name)}get context(){return(0,ee.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const s=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const o={topic:r.topic,request:(0,Y.formatJsonRpcRequest)(r.request.method,r.request.params,r.id),chainId:r.chainId};return s.push(o)}),s}async setJsonRpcRecords(s){await this.core.storage.setItem(this.storageKey,s)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(s){this.isInitialized();const r=this.records.get(s);if(!r){const{message:o}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(wt.sync)}async restore(){try{const s=await this.getJsonRpcRecords();if(typeof s>"u"||!s.length)return;if(this.records.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}}registerEventListeners(){this.events.on(wt.created,s=>{const r=wt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.events.on(wt.updated,s=>{const r=wt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.events.on(wt.deleted,s=>{const r=wt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s}),this.persist()}),this.core.heartbeat.on(ki.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(s=>{(0,$.toMiliseconds)(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.delete(s.topic,s.id))})}catch(s){this.logger.warn(s)}}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class sg extends kh{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.expirations=new Map,this.events=new Lt.EventEmitter,this.name=Df,this.version=Ff,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.expirations.set(o.target,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=o=>{try{const a=this.formatTarget(o);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(o,a)=>{this.isInitialized();const p=this.formatTarget(o),g={target:p,expiry:a};this.expirations.set(p,g),this.checkExpiry(p,g),this.events.emit(it.created,{target:p,expiration:g})},this.get=o=>{this.isInitialized();const a=this.formatTarget(o);return this.getExpiration(a)},this.del=o=>{if(this.isInitialized(),this.has(o)){const a=this.formatTarget(o),p=this.getExpiration(a);this.expirations.delete(a),this.events.emit(it.deleted,{target:a,expiration:p})}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,ee.generateChildLogger)(r,this.name)}get context(){return(0,ee.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(s){if(typeof s=="string")return Nl(s);if(typeof s=="number")return Cl(s);const{message:r}=C("UNKNOWN_TYPE",`Target type: ${typeof s}`);throw new Error(r)}async setExpirations(s){await this.core.storage.setItem(this.storageKey,s)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(it.sync)}async restore(){try{const s=await this.getExpirations();if(typeof s>"u"||!s.length)return;if(this.expirations.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(s){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(s)}}getExpiration(s){const r=this.expirations.get(s);if(!r){const{message:o}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.error(o),new Error(o)}return r}checkExpiry(s,r){const{expiry:o}=r;(0,$.toMiliseconds)(o)-Date.now()<=0&&this.expire(s,r)}expire(s,r){this.expirations.delete(s),this.events.emit(it.expired,{target:s,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((s,r)=>this.checkExpiry(r,s))}registerEventListeners(){this.core.heartbeat.on(ki.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(it.created,s=>{const r=it.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(it.expired,s=>{const r=it.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(it.deleted,s=>{const r=it.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}}}class ng extends Vh{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.name=Gs,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async o=>{if(this.verifyDisabled||vi()||!mi())return;const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(p){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(p)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Js;try{await this.createIframe()}catch(p){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(p),this.verifyDisabled=!0}}},this.register=async o=>{this.initialized?this.sendPost(o.attestationId):(this.addToQueue(o.attestationId),await this.init())},this.resolve=async o=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);let p;try{p=await this.fetchAttestation(o.attestationId,a)}catch(g){this.logger.info(`failed to resolve attestation: ${o.attestationId} from url: ${a}`),this.logger.info(g),p=await this.fetchAttestation(o.attestationId,Js)}return p},this.fetchAttestation=async(o,a)=>{this.logger.info(`resolving attestation: ${o} from url: ${a}`);const p=this.startAbortTimer($.ONE_SECOND*2),g=await fetch(`${a}/attestation/${o}`,{signal:this.abortController.signal});return clearTimeout(p),g.status===200?await g.json():void 0},this.addToQueue=o=>{this.queue.push(o)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(o=>this.sendPost(o)),this.queue=[])},this.sendPost=o=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(o,"*"),this.logger.info(`postMessage sent: ${o} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let o;const a=p=>{p.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),o())};await Promise.race([new Promise(p=>{if(document.getElementById(Gs))return p();window.addEventListener("message",a);const g=document.createElement("iframe");g.id=Gs,g.src=`${this.verifyUrl}/${this.projectId}`,g.style.display="none",document.body.append(g),this.iframe=g,o=p}),new Promise((p,g)=>setTimeout(()=>{window.removeEventListener("message",a),g("verify iframe load timeout")},(0,$.toMiliseconds)($.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=o=>{let a=o||Pi;return Tf.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Pi}`),a=Pi),a},this.logger=(0,ee.generateChildLogger)(r,this.name),this.verifyUrl=Pi,this.abortController=new AbortController,this.isDevEnv=Us()&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST}get context(){return(0,ee.getLoggerContext)(this.logger)}startAbortTimer(s){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,$.toMiliseconds)(s))}}class og extends Kh{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.context=qf,this.registerDeviceToken=async o=>{const{clientId:a,token:p,notificationType:g,enableEncrypted:m=!1}=o,b=`${$f}/${this.projectId}/clients`;await $p()(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:g,token:p,always_raw:m})})},this.logger=(0,ee.generateChildLogger)(r,this.context)}}var ag=Object.defineProperty,$a=Object.getOwnPropertySymbols,cg=Object.prototype.hasOwnProperty,ug=Object.prototype.propertyIsEnumerable,ja=(u,s,r)=>s in u?ag(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Ua=(u,s)=>{for(var r in s||(s={}))cg.call(s,r)&&ja(u,r,s[r]);if($a)for(var r of $a(s))ug.call(s,r)&&ja(u,r,s[r]);return u};class Qs extends qh{constructor(s){super(s),this.protocol=Pa,this.version=of,this.name=Bs,this.events=new Lt.EventEmitter,this.initialized=!1,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.projectId=s==null?void 0:s.projectId,this.relayUrl=(s==null?void 0:s.relayUrl)||Ra,this.customStoragePrefix=s!=null&&s.customStoragePrefix?`:${s.customStoragePrefix}`:"";const r=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ee.pino)((0,ee.getDefaultLoggerOptions)({level:(s==null?void 0:s.logger)||af.logger}));this.logger=(0,ee.generateChildLogger)(r,this.name),this.heartbeat=new ki.HeartBeat,this.crypto=new Uf(this,this.logger,s==null?void 0:s.keychain),this.history=new rg(this,this.logger),this.expirer=new sg(this,this.logger),this.storage=s!=null&&s.storage?s.storage:new Th.Z(Ua(Ua({},cf),s==null?void 0:s.storageOptions)),this.relayer=new Zf({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ig(this,this.logger),this.verify=new ng(this.projectId||"",this.logger),this.echoClient=new og(this.projectId||"",this.logger)}static async init(s){const r=new Qs(s);await r.initialize();const o=await r.crypto.getClientId();return await r.storage.setItem(Pf,o),r}get context(){return(0,ee.getLoggerContext)(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(s){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,s),this.logger.error(s.message),s}}}const hg=Qs,La="wc",za=2,Ma="client",Ys=`${La}@${za}:${Ma}:`,Zs={name:Ma,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},PE={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_request_expire:"session_request_expire"},xE={database:":memory:"},ka="WALLETCONNECT_DEEPLINK_CHOICE",SE={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},RE="history",OE="0.3",lg="proposal",NE=null,Va="Proposal expired",pg="session",Cr=$.SEVEN_DAYS,dg="engine",St={wc_sessionPropose:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1104},res:{ttl:$.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1106},res:{ttl:$.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1112},res:{ttl:$.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1115}}},Xs={min:$.FIVE_MINUTES,max:$.SEVEN_DAYS},Rt={idle:"IDLE",active:"ACTIVE"},fg="request",gg=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var yg=Object.defineProperty,vg=Object.defineProperties,mg=Object.getOwnPropertyDescriptors,Ka=Object.getOwnPropertySymbols,wg=Object.prototype.hasOwnProperty,_g=Object.prototype.propertyIsEnumerable,Ha=(u,s,r)=>s in u?yg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Ue=(u,s)=>{for(var r in s||(s={}))wg.call(s,r)&&Ha(u,r,s[r]);if(Ka)for(var r of Ka(s))_g.call(s,r)&&Ha(u,r,s[r]);return u},xi=(u,s)=>vg(u,mg(s));class bg extends Bh{constructor(s){super(s),this.name=dg,this.events=new(Rs()),this.initialized=!1,this.ignoredPayloadTypes=[ti],this.requestQueue={state:Rt.idle,queue:[]},this.sessionRequestQueue={state:Rt.idle,queue:[]},this.requestQueueDelay=$.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(St)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,$.toMiliseconds)(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const o=xi(Ue({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(o);const{pairingTopic:a,requiredNamespaces:p,optionalNamespaces:g,sessionProperties:m,relays:b}=o;let x=a,N,O=!1;if(x&&(O=this.client.core.pairing.pairings.get(x).active),!x||!O){const{topic:ie,uri:G}=await this.client.core.pairing.create();x=ie,N=G}const q=await this.client.core.crypto.generateKeyPair(),ne=St.wc_sessionPropose.req.ttl||$.FIVE_MINUTES,F=We(ne),k=Ue({requiredNamespaces:p,optionalNamespaces:g,relays:b??[{protocol:Sa}],proposer:{publicKey:q,metadata:this.client.metadata},expiryTimestamp:F},m&&{sessionProperties:m}),{reject:W,resolve:ae,done:Ne}=_i(ne,Va);if(this.events.once(_e("session_connect"),async({error:ie,session:G})=>{if(ie)W(ie);else if(G){G.self.publicKey=q;const ge=xi(Ue({},G),{requiredNamespaces:k.requiredNamespaces,optionalNamespaces:k.optionalNamespaces});await this.client.session.set(G.topic,ge),await this.setExpiry(G.topic,G.expiry),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:G.peer.metadata}),ae(ge)}}),!x){const{message:ie}=C("NO_MATCHING_KEY",`connect() pairing topic: ${x}`);throw new Error(ie)}const ue=await this.sendRequest({topic:x,method:"wc_sessionPropose",params:k,throwOnFailedPublish:!0});return await this.setProposal(ue,Ue({id:ue},k)),{uri:N,approval:Ne}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:o,relayProtocol:a,namespaces:p,sessionProperties:g}=r,m=this.client.proposal.get(o);let{pairingTopic:b,proposer:x,requiredNamespaces:N,optionalNamespaces:O}=m;b=b||"";const q=await this.client.core.crypto.generateKeyPair(),ne=x.publicKey,F=await this.client.core.crypto.generateSharedKey(q,ne);b&&o&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:x.metadata}),await this.sendResult({id:o,topic:b,result:{relay:{protocol:a??"irn"},responderPublicKey:q}}),await this.client.proposal.delete(o,ve("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const k=Ue({relay:{protocol:a??"irn"},namespaces:p,pairingTopic:b,controller:{publicKey:q,metadata:this.client.metadata},expiry:We(Cr)},g&&{sessionProperties:g});await this.client.core.relayer.subscribe(F);const W=xi(Ue({},k),{topic:F,requiredNamespaces:N,optionalNamespaces:O,pairingTopic:b,acknowledged:!1,self:k.controller,peer:{publicKey:x.publicKey,metadata:x.metadata},controller:q});await this.client.session.set(F,W);try{await this.sendRequest({topic:F,method:"wc_sessionSettle",params:k,throwOnFailedPublish:!0})}catch(ae){throw this.client.logger.error(ae),this.client.session.delete(F,ve("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(F),ae}return await this.setExpiry(F,We(Cr)),{topic:F,acknowledged:()=>new Promise(ae=>setTimeout(()=>ae(this.client.session.get(F)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:o,reason:a}=r,{pairingTopic:p}=this.client.proposal.get(o);p&&(await this.sendError(o,p,a),await this.client.proposal.delete(o,ve("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:o,namespaces:a}=r,p=await this.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:g,resolve:m,reject:b}=_i();return this.events.once(_e("session_update",p),({error:x})=>{x?b(x):m()}),await this.client.session.update(o,{namespaces:a}),{acknowledged:g}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:o}=r,a=await this.sendRequest({topic:o,method:"wc_sessionExtend",params:{}}),{done:p,resolve:g,reject:m}=_i();return this.events.once(_e("session_extend",a),({error:b})=>{b?m(b):g()}),await this.setExpiry(o,We(Cr)),{acknowledged:p}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:o,request:a,topic:p,expiry:g=St.wc_sessionRequest.req.ttl}=r,m=(0,Y.payloadId)(),{done:b,resolve:x,reject:N}=_i(g,"Request expired. Please try again.");return this.events.once(_e("session_request",m),({error:O,result:q})=>{O?N(O):x(q)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:m,topic:p,method:"wc_sessionRequest",params:{request:xi(Ue({},a),{expiryTimestamp:We(g)}),chainId:o},expiry:g,throwOnFailedPublish:!0}).catch(q=>N(q)),this.client.events.emit("session_request_sent",{topic:p,request:a,chainId:o,id:m}),O()}),new Promise(async O=>{const q=await Dl(this.client.core.storage,ka);Al({id:m,topic:p,wcDeepLink:q}),O()}),b()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:o,response:a}=r,{id:p}=a;(0,Y.isJsonRpcResult)(a)?await this.sendResult({id:p,topic:o,result:a.result,throwOnFailedPublish:!0}):(0,Y.isJsonRpcError)(a)&&await this.sendError(p,o,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:o}=r;if(this.client.session.keys.includes(o)){const a=await this.sendRequest({topic:o,method:"wc_sessionPing",params:{}}),{done:p,resolve:g,reject:m}=_i();this.events.once(_e("session_ping",a),({error:b})=>{b?m(b):g()}),await p()}else this.client.core.pairing.pairings.keys.includes(o)&&await this.client.core.pairing.ping({topic:o})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:o,event:a,chainId:p}=r;await this.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:p}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:o}=r;if(this.client.session.keys.includes(o))await this.sendRequest({topic:o,method:"wc_sessionDelete",params:ve("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:o,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(o))await this.client.core.pairing.disconnect({topic:o});else{const{message:a}=C("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(o=>rp(o,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const o=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(p=>{var g,m;return((g=p.peerMetadata)==null?void 0:g.url)&&((m=p.peerMetadata)==null?void 0:m.url)===r.peer.metadata.url&&p.topic&&p.topic!==o.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(p=>this.client.core.pairing.disconnect({topic:p.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(o){this.client.logger.error(o)}},this.deleteSession=async r=>{const{topic:o,expirerHasDeleted:a=!1,emitEvent:p=!0,id:g=0}=r,{self:m}=this.client.session.get(o);await this.client.core.relayer.unsubscribe(o),await this.client.session.delete(o,ve("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(m.publicKey)&&await this.client.core.crypto.deleteKeyPair(m.publicKey),this.client.core.crypto.keychain.has(o)&&await this.client.core.crypto.deleteSymKey(o),a||this.client.core.expirer.del(o),this.client.core.storage.removeItem(ka).catch(b=>this.client.logger.warn(b)),this.getPendingSessionRequests().forEach(b=>{b.topic===o&&this.deletePendingSessionRequest(b.id,ve("USER_DISCONNECTED"))}),p&&this.client.events.emit("session_delete",{id:g,topic:o})},this.deleteProposal=async(r,o)=>{await Promise.all([this.client.proposal.delete(r,ve("USER_DISCONNECTED")),o?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,o,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,o),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(p=>p.id!==r),a&&(this.sessionRequestQueue.state=Rt.idle,this.client.events.emit("session_request_expire",{id:r}))},this.setExpiry=async(r,o)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:o}),this.client.core.expirer.set(r,o)},this.setProposal=async(r,o)=>{await this.client.proposal.set(r,o),this.client.core.expirer.set(r,We(St.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async r=>{const{id:o,topic:a,params:p,verifyContext:g}=r,m=p.request.expiryTimestamp||We(St.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(o,{id:o,topic:a,params:p,verifyContext:g}),m&&this.client.core.expirer.set(o,m)},this.sendRequest=async r=>{const{topic:o,method:a,params:p,expiry:g,relayRpcId:m,clientRpcId:b,throwOnFailedPublish:x}=r,N=(0,Y.formatJsonRpcRequest)(a,p,b);if(mi()&&gg.includes(a)){const ne=yi(JSON.stringify(N));this.client.core.verify.register({attestationId:ne})}const O=await this.client.core.crypto.encode(o,N),q=St[a].req;return g&&(q.ttl=g),m&&(q.id=m),this.client.core.history.set(o,N),x?(q.internal=xi(Ue({},q.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,O,q)):this.client.core.relayer.publish(o,O,q).catch(ne=>this.client.logger.error(ne)),N.id},this.sendResult=async r=>{const{id:o,topic:a,result:p,throwOnFailedPublish:g}=r,m=(0,Y.formatJsonRpcResult)(o,p),b=await this.client.core.crypto.encode(a,m),x=await this.client.core.history.get(a,o),N=St[x.request.method].res;g?(N.internal=xi(Ue({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,b,N)):this.client.core.relayer.publish(a,b,N).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(m)},this.sendError=async(r,o,a)=>{const p=(0,Y.formatJsonRpcError)(r,a),g=await this.client.core.crypto.encode(o,p),m=await this.client.core.history.get(o,r),b=St[m.request.method].res;this.client.core.relayer.publish(o,g,b),await this.client.core.history.resolve(p)},this.cleanup=async()=>{const r=[],o=[];this.client.session.getAll().forEach(a=>{let p=!1;zt(a.expiry)&&(p=!0),this.client.core.crypto.keychain.has(a.topic)||(p=!0),p&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{zt(a.expiryTimestamp)&&o.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession({topic:a})),...o.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Rt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Rt.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(o=>setTimeout(o,300))}catch(o){this.client.logger.warn(o)}}this.requestQueue.state=Rt.idle},this.processRequest=r=>{const{topic:o,payload:a}=r,p=a.method;switch(p){case"wc_sessionPropose":return this.onSessionProposeRequest(o,a);case"wc_sessionSettle":return this.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return this.onSessionExtendRequest(o,a);case"wc_sessionPing":return this.onSessionPingRequest(o,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return this.onSessionRequest(o,a);case"wc_sessionEvent":return this.onSessionEventRequest(o,a);default:return this.client.logger.info(`Unsupported request method ${p}`)}},this.onRelayEventResponse=async r=>{const{topic:o,payload:a}=r,p=(await this.client.core.history.get(o,a.id)).request.method;switch(p){case"wc_sessionPropose":return this.onSessionProposeResponse(o,a);case"wc_sessionSettle":return this.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return this.onSessionExtendResponse(o,a);case"wc_sessionPing":return this.onSessionPingResponse(o,a);case"wc_sessionRequest":return this.onSessionRequestResponse(o,a);default:return this.client.logger.info(`Unsupported response method ${p}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:o}=r,{message:a}=C("MISSING_OR_INVALID",`Decoded payload on topic ${o} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,o)=>{const{params:a,id:p}=o;try{this.isValidConnect(Ue({},o.params));const g=a.expiryTimestamp||We(St.wc_sessionPropose.req.ttl),m=Ue({id:p,pairingTopic:r,expiryTimestamp:g},a);await this.setProposal(p,m);const b=yi(JSON.stringify(o)),x=await this.getVerifyContext(b,m.proposer.metadata);this.client.events.emit("session_proposal",{id:p,params:m,verifyContext:x})}catch(g){await this.sendError(p,r,g),this.client.logger.error(g)}},this.onSessionProposeResponse=async(r,o)=>{const{id:a}=o;if((0,Y.isJsonRpcResult)(o)){const{result:p}=o;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:p});const g=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const m=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:m});const b=p.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const x=await this.client.core.crypto.generateSharedKey(m,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:x});const N=await this.client.core.relayer.subscribe(x);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:N}),await this.client.core.pairing.activate({topic:r})}else(0,Y.isJsonRpcError)(o)&&(await this.client.proposal.delete(a,ve("USER_DISCONNECTED")),this.events.emit(_e("session_connect"),{error:o.error}))},this.onSessionSettleRequest=async(r,o)=>{const{id:a,params:p}=o;try{this.isValidSessionSettleRequest(p);const{relay:g,controller:m,expiry:b,namespaces:x,sessionProperties:N,pairingTopic:O}=o.params,q=Ue({topic:r,relay:g,expiry:b,namespaces:x,acknowledged:!0,pairingTopic:O,requiredNamespaces:{},optionalNamespaces:{},controller:m.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:m.publicKey,metadata:m.metadata}},N&&{sessionProperties:N});await this.sendResult({id:o.id,topic:r,result:!0}),this.events.emit(_e("session_connect"),{session:q}),this.cleanupDuplicatePairings(q)}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.onSessionSettleResponse=async(r,o)=>{const{id:a}=o;(0,Y.isJsonRpcResult)(o)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(_e("session_approve",a),{})):(0,Y.isJsonRpcError)(o)&&(await this.client.session.delete(r,ve("USER_DISCONNECTED")),this.events.emit(_e("session_approve",a),{error:o.error}))},this.onSessionUpdateRequest=async(r,o)=>{const{params:a,id:p}=o;try{const g=`${r}_session_update`,m=Rr.get(g);if(m&&this.isRequestOutOfSync(m,p)){this.client.logger.info(`Discarding out of sync request - ${p}`);return}this.isValidUpdate(Ue({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:p,topic:r,result:!0}),this.client.events.emit("session_update",{id:p,topic:r,params:a}),Rr.set(g,p)}catch(g){await this.sendError(p,r,g),this.client.logger.error(g)}},this.isRequestOutOfSync=(r,o)=>parseInt(o.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,o)=>{const{id:a}=o;(0,Y.isJsonRpcResult)(o)?this.events.emit(_e("session_update",a),{}):(0,Y.isJsonRpcError)(o)&&this.events.emit(_e("session_update",a),{error:o.error})},this.onSessionExtendRequest=async(r,o)=>{const{id:a}=o;try{this.isValidExtend({topic:r}),await this.setExpiry(r,We(Cr)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionExtendResponse=(r,o)=>{const{id:a}=o;(0,Y.isJsonRpcResult)(o)?this.events.emit(_e("session_extend",a),{}):(0,Y.isJsonRpcError)(o)&&this.events.emit(_e("session_extend",a),{error:o.error})},this.onSessionPingRequest=async(r,o)=>{const{id:a}=o;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionPingResponse=(r,o)=>{const{id:a}=o;setTimeout(()=>{(0,Y.isJsonRpcResult)(o)?this.events.emit(_e("session_ping",a),{}):(0,Y.isJsonRpcError)(o)&&this.events.emit(_e("session_ping",a),{error:o.error})},500)},this.onSessionDeleteRequest=async(r,o)=>{const{id:a}=o;try{this.isValidDisconnect({topic:r,reason:o.params}),await Promise.all([new Promise(p=>{this.client.core.relayer.once(De.publish,async()=>{p(await this.deleteSession({topic:r,id:a}))})}),this.sendResult({id:a,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ve("USER_DISCONNECTED")})])}catch(p){this.client.logger.error(p)}},this.onSessionRequest=async(r,o)=>{const{id:a,params:p}=o;try{this.isValidRequest(Ue({topic:r},p));const g=yi(JSON.stringify((0,Y.formatJsonRpcRequest)("wc_sessionRequest",p,a))),m=this.client.session.get(r),b=await this.getVerifyContext(g,m.peer.metadata),x={id:a,topic:r,params:p,verifyContext:b};await this.setPendingSessionRequest(x),this.addSessionRequestToSessionRequestQueue(x),this.processSessionRequestQueue()}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.onSessionRequestResponse=(r,o)=>{const{id:a}=o;(0,Y.isJsonRpcResult)(o)?this.events.emit(_e("session_request",a),{result:o.result}):(0,Y.isJsonRpcError)(o)&&this.events.emit(_e("session_request",a),{error:o.error})},this.onSessionEventRequest=async(r,o)=>{const{id:a,params:p}=o;try{const g=`${r}_session_event_${p.event.name}`,m=Rr.get(g);if(m&&this.isRequestOutOfSync(m,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Ue({topic:r},p)),this.client.events.emit("session_event",{id:a,topic:r,params:p}),Rr.set(g,a)}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Rt.idle,this.processSessionRequestQueue()},(0,$.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:o})=>{const a=this.client.core.history.pending;a.length>0&&a.filter(p=>p.topic===r&&p.request.method==="wc_sessionRequest").forEach(p=>{this.events.emit(_e("session_request",p.request.id),{error:o})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Rt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Rt.active,this.client.events.emit("session_request",r)}catch(o){this.client.logger.error(o)}},this.onPairingCreated=r=>{if(r.active)return;const o=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);o&&this.onSessionProposeRequest(r.topic,(0,Y.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,relays:o.relays,proposer:o.proposer,sessionProperties:o.sessionProperties},o.id))},this.isValidConnect=async r=>{if(!Ke(r)){const{message:b}=C("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(b)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:p,sessionProperties:g,relays:m}=r;if(je(o)||await this.isValidPairingTopic(o),!gp(m,!0)){const{message:b}=C("MISSING_OR_INVALID",`connect() relays: ${m}`);throw new Error(b)}!je(a)&&Ii(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!je(p)&&Ii(p)!==0&&this.validateNamespaces(p,"optionalNamespaces"),je(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(r,o)=>{const a=fp(r,"connect()",o);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!Ke(r))throw new Error(C("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:o,namespaces:a,relayProtocol:p,sessionProperties:g}=r;await this.isValidProposalId(o);const m=this.client.proposal.get(o),b=Sr(a,"approve()");if(b)throw new Error(b.message);const x=Ms(m.requiredNamespaces,a,"approve()");if(x)throw new Error(x.message);if(!Se(p,!0)){const{message:N}=C("MISSING_OR_INVALID",`approve() relayProtocol: ${p}`);throw new Error(N)}je(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async r=>{if(!Ke(r)){const{message:p}=C("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(p)}const{id:o,reason:a}=r;if(await this.isValidProposalId(o),!vp(a)){const{message:p}=C("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(p)}},this.isValidSessionSettleRequest=r=>{if(!Ke(r)){const{message:x}=C("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(x)}const{relay:o,controller:a,namespaces:p,expiry:g}=r;if(!ra(o)){const{message:x}=C("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(x)}const m=cp(a,"onSessionSettleRequest()");if(m)throw new Error(m.message);const b=Sr(p,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(zt(g)){const{message:x}=C("EXPIRED","onSessionSettleRequest()");throw new Error(x)}},this.isValidUpdate=async r=>{if(!Ke(r)){const{message:b}=C("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(b)}const{topic:o,namespaces:a}=r;await this.isValidSessionTopic(o);const p=this.client.session.get(o),g=Sr(a,"update()");if(g)throw new Error(g.message);const m=Ms(p.requiredNamespaces,a,"update()");if(m)throw new Error(m.message)},this.isValidExtend=async r=>{if(!Ke(r)){const{message:a}=C("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionTopic(o)},this.isValidRequest=async r=>{if(!Ke(r)){const{message:b}=C("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(b)}const{topic:o,request:a,chainId:p,expiry:g}=r;await this.isValidSessionTopic(o);const{namespaces:m}=this.client.session.get(o);if(!sa(m,p)){const{message:b}=C("MISSING_OR_INVALID",`request() chainId: ${p}`);throw new Error(b)}if(!mp(a)){const{message:b}=C("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(b)}if(!bp(m,p,a.method)){const{message:b}=C("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(b)}if(g&&!xp(g,Xs)){const{message:b}=C("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${Xs.min} and ${Xs.max}`);throw new Error(b)}},this.isValidRespond=async r=>{var o;if(!Ke(r)){const{message:g}=C("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(g)}const{topic:a,response:p}=r;try{await this.isValidSessionTopic(a)}catch(g){throw(o=r==null?void 0:r.response)!=null&&o.id&&this.cleanupAfterResponse(r),g}if(!wp(p)){const{message:g}=C("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(p)}`);throw new Error(g)}},this.isValidPing=async r=>{if(!Ke(r)){const{message:a}=C("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.isValidEmit=async r=>{if(!Ke(r)){const{message:m}=C("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(m)}const{topic:o,event:a,chainId:p}=r;await this.isValidSessionTopic(o);const{namespaces:g}=this.client.session.get(o);if(!sa(g,p)){const{message:m}=C("MISSING_OR_INVALID",`emit() chainId: ${p}`);throw new Error(m)}if(!_p(a)){const{message:m}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(m)}if(!Ep(g,p,a.name)){const{message:m}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(m)}},this.isValidDisconnect=async r=>{if(!Ke(r)){const{message:a}=C("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.getVerifyContext=async(r,o)=>{const a={verified:{verifyUrl:o.verifyUrl||Pi,validation:"UNKNOWN",origin:o.url||""}};try{const p=await this.client.core.verify.resolve({attestationId:r,verifyUrl:o.verifyUrl});p&&(a.verified.origin=p.origin,a.verified.isScam=p.isScam,a.verified.validation=p.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(p){this.client.logger.info(p)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,o)=>{Object.values(r).forEach(a=>{if(!Se(a,!1)){const{message:p}=C("MISSING_OR_INVALID",`${o} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(p)}})}}async isInitialized(){if(!this.initialized){const{message:s}=C("NOT_INITIALIZED",this.name);throw new Error(s)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(De.message,async s=>{const{topic:r,message:o}=s;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(o)))return;const a=await this.client.core.crypto.decode(r,o);try{(0,Y.isJsonRpcRequest)(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):(0,Y.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(p){this.client.logger.error(p)}})}registerExpirerEvents(){this.client.core.expirer.on(it.expired,async s=>{const{topic:r,id:o}=Jo(s.target);if(o&&this.client.pendingRequest.keys.includes(o))return await this.deletePendingSessionRequest(o,C("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):o&&(await this.deleteProposal(o,!0),this.client.events.emit("proposal_expire",{id:o}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ji.create,s=>this.onPairingCreated(s))}isValidPairingTopic(s){if(!Se(s,!1)){const{message:r}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(s)){const{message:r}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if(zt(this.client.core.pairing.pairings.get(s).expiry)){const{message:r}=C("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}}async isValidSessionTopic(s){if(!Se(s,!1)){const{message:r}=C("MISSING_OR_INVALID",`session topic should be a string: ${s}`);throw new Error(r)}if(!this.client.session.keys.includes(s)){const{message:r}=C("NO_MATCHING_KEY",`session topic doesn't exist: ${s}`);throw new Error(r)}if(zt(this.client.session.get(s).expiry)){await this.deleteSession({topic:s});const{message:r}=C("EXPIRED",`session topic: ${s}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(s)){const{message:r}=C("MISSING_OR_INVALID",`session topic does not exist in keychain: ${s}`);throw await this.deleteSession({topic:s}),new Error(r)}}async isValidSessionOrPairingTopic(s){if(this.client.session.keys.includes(s))await this.isValidSessionTopic(s);else if(this.client.core.pairing.pairings.keys.includes(s))this.isValidPairingTopic(s);else if(Se(s,!1)){const{message:r}=C("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${s}`);throw new Error(r)}else{const{message:r}=C("MISSING_OR_INVALID",`session or pairing topic should be a string: ${s}`);throw new Error(r)}}async isValidProposalId(s){if(!yp(s)){const{message:r}=C("MISSING_OR_INVALID",`proposal id should be a number: ${s}`);throw new Error(r)}if(!this.client.proposal.keys.includes(s)){const{message:r}=C("NO_MATCHING_KEY",`proposal id doesn't exist: ${s}`);throw new Error(r)}if(zt(this.client.proposal.get(s).expiryTimestamp)){await this.deleteProposal(s);const{message:r}=C("EXPIRED",`proposal id: ${s}`);throw new Error(r)}}}class Eg extends Nr{constructor(s,r){super(s,r,lg,Ys),this.core=s,this.logger=r}}class Ig extends Nr{constructor(s,r){super(s,r,pg,Ys),this.core=s,this.logger=r}}class Pg extends Nr{constructor(s,r){super(s,r,fg,Ys,o=>o.id),this.core=s,this.logger=r}}class en extends Hh{constructor(s){super(s),this.protocol=La,this.version=za,this.name=Zs.name,this.events=new Lt.EventEmitter,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.removeAllListeners=o=>this.events.removeAllListeners(o),this.connect=async o=>{try{return await this.engine.connect(o)}catch(a){throw this.logger.error(a.message),a}},this.pair=async o=>{try{return await this.engine.pair(o)}catch(a){throw this.logger.error(a.message),a}},this.approve=async o=>{try{return await this.engine.approve(o)}catch(a){throw this.logger.error(a.message),a}},this.reject=async o=>{try{return await this.engine.reject(o)}catch(a){throw this.logger.error(a.message),a}},this.update=async o=>{try{return await this.engine.update(o)}catch(a){throw this.logger.error(a.message),a}},this.extend=async o=>{try{return await this.engine.extend(o)}catch(a){throw this.logger.error(a.message),a}},this.request=async o=>{try{return await this.engine.request(o)}catch(a){throw this.logger.error(a.message),a}},this.respond=async o=>{try{return await this.engine.respond(o)}catch(a){throw this.logger.error(a.message),a}},this.ping=async o=>{try{return await this.engine.ping(o)}catch(a){throw this.logger.error(a.message),a}},this.emit=async o=>{try{return await this.engine.emit(o)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async o=>{try{return await this.engine.disconnect(o)}catch(a){throw this.logger.error(a.message),a}},this.find=o=>{try{return this.engine.find(o)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(o){throw this.logger.error(o.message),o}},this.name=(s==null?void 0:s.name)||Zs.name,this.metadata=(s==null?void 0:s.metadata)||bl();const r=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ee.pino)((0,ee.getDefaultLoggerOptions)({level:(s==null?void 0:s.logger)||Zs.logger}));this.core=(s==null?void 0:s.core)||new hg(s),this.logger=(0,ee.generateChildLogger)(r,this.name),this.session=new Ig(this.core,this.logger),this.proposal=new Eg(this.core,this.logger),this.pendingRequest=new Pg(this.core,this.logger),this.engine=new bg(this)}static async init(s){const r=new en(s);return await r.initialize(),r}get context(){return(0,ee.getLoggerContext)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(s){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(s.message),s}}}const CE=null,AE=null;var kt=j(67708);const Ba="error",xg="wss://relay.walletconnect.com",Sg="wc",Rg="universal_provider",Ga=`${Sg}@2:${Rg}:`,Og="https://rpc.walletconnect.com/v1/",Ot={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof j.g<"u"?j.g:typeof self<"u"?self:{},tn={exports:{}};(function(u,s){(function(){var r,o="4.17.21",a=200,p="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",m="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",x=500,N="__lodash_placeholder__",O=1,q=2,ne=4,F=1,k=2,W=1,ae=2,Ne=4,ue=8,ie=16,G=32,ge=64,be=128,Le=256,Kt=512,Zg=30,Xg="...",ey=800,ty=16,ic=1,iy=2,ry=3,ni=1/0,Ht=9007199254740991,sy=17976931348623157e292,Tr=0/0,_t=4294967295,ny=_t-1,oy=_t>>>1,ay=[["ary",be],["bind",W],["bindKey",ae],["curry",ue],["curryRight",ie],["flip",Kt],["partial",G],["partialRight",ge],["rearg",Le]],Si="[object Arguments]",qr="[object Array]",cy="[object AsyncFunction]",Yi="[object Boolean]",Zi="[object Date]",uy="[object DOMException]",$r="[object Error]",jr="[object Function]",rc="[object GeneratorFunction]",pt="[object Map]",Xi="[object Number]",hy="[object Null]",Nt="[object Object]",sc="[object Promise]",ly="[object Proxy]",er="[object RegExp]",dt="[object Set]",tr="[object String]",Ur="[object Symbol]",py="[object Undefined]",ir="[object WeakMap]",dy="[object WeakSet]",rr="[object ArrayBuffer]",Ri="[object DataView]",on="[object Float32Array]",an="[object Float64Array]",cn="[object Int8Array]",un="[object Int16Array]",hn="[object Int32Array]",ln="[object Uint8Array]",pn="[object Uint8ClampedArray]",dn="[object Uint16Array]",fn="[object Uint32Array]",fy=/\b__p \+= '';/g,gy=/\b(__p \+=) '' \+/g,yy=/(__e\(.*?\)|\b__t\)) \+\n'';/g,nc=/&(?:amp|lt|gt|quot|#39);/g,oc=/[&<>"']/g,vy=RegExp(nc.source),my=RegExp(oc.source),wy=/<%-([\s\S]+?)%>/g,_y=/<%([\s\S]+?)%>/g,ac=/<%=([\s\S]+?)%>/g,by=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ey=/^\w*$/,Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gn=/[\\^$.*+?()[\]{}|]/g,Py=RegExp(gn.source),yn=/^\s+/,xy=/\s/,Sy=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ry=/\{\n\/\* \[wrapped with (.+)\] \*/,Oy=/,? & /,Ny=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Cy=/[()=,{}\[\]\/\s]/,Ay=/\\(\\)?/g,Dy=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,cc=/\w*$/,Fy=/^[-+]0x[0-9a-f]+$/i,Ty=/^0b[01]+$/i,qy=/^\[object .+?Constructor\]$/,$y=/^0o[0-7]+$/i,jy=/^(?:0|[1-9]\d*)$/,Uy=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Lr=/($^)/,Ly=/['\n\r\u2028\u2029\\]/g,zr="\\ud800-\\udfff",zy="\\u0300-\\u036f",My="\\ufe20-\\ufe2f",ky="\\u20d0-\\u20ff",uc=zy+My+ky,hc="\\u2700-\\u27bf",lc="a-z\\xdf-\\xf6\\xf8-\\xff",Vy="\\xac\\xb1\\xd7\\xf7",Ky="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Hy="\\u2000-\\u206f",By=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pc="A-Z\\xc0-\\xd6\\xd8-\\xde",dc="\\ufe0e\\ufe0f",fc=Vy+Ky+Hy+By,vn="['\u2019]",Gy="["+zr+"]",gc="["+fc+"]",Mr="["+uc+"]",yc="\\d+",Jy="["+hc+"]",vc="["+lc+"]",mc="[^"+zr+fc+yc+hc+lc+pc+"]",mn="\\ud83c[\\udffb-\\udfff]",Wy="(?:"+Mr+"|"+mn+")",wc="[^"+zr+"]",wn="(?:\\ud83c[\\udde6-\\uddff]){2}",_n="[\\ud800-\\udbff][\\udc00-\\udfff]",Oi="["+pc+"]",_c="\\u200d",bc="(?:"+vc+"|"+mc+")",Qy="(?:"+Oi+"|"+mc+")",Ec="(?:"+vn+"(?:d|ll|m|re|s|t|ve))?",Ic="(?:"+vn+"(?:D|LL|M|RE|S|T|VE))?",Pc=Wy+"?",xc="["+dc+"]?",Yy="(?:"+_c+"(?:"+[wc,wn,_n].join("|")+")"+xc+Pc+")*",Zy="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Xy="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Sc=xc+Pc+Yy,ev="(?:"+[Jy,wn,_n].join("|")+")"+Sc,tv="(?:"+[wc+Mr+"?",Mr,wn,_n,Gy].join("|")+")",iv=RegExp(vn,"g"),rv=RegExp(Mr,"g"),bn=RegExp(mn+"(?="+mn+")|"+tv+Sc,"g"),sv=RegExp([Oi+"?"+vc+"+"+Ec+"(?="+[gc,Oi,"$"].join("|")+")",Qy+"+"+Ic+"(?="+[gc,Oi+bc,"$"].join("|")+")",Oi+"?"+bc+"+"+Ec,Oi+"+"+Ic,Xy,Zy,yc,ev].join("|"),"g"),nv=RegExp("["+_c+zr+uc+dc+"]"),ov=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,av=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],cv=-1,de={};de[on]=de[an]=de[cn]=de[un]=de[hn]=de[ln]=de[pn]=de[dn]=de[fn]=!0,de[Si]=de[qr]=de[rr]=de[Yi]=de[Ri]=de[Zi]=de[$r]=de[jr]=de[pt]=de[Xi]=de[Nt]=de[er]=de[dt]=de[tr]=de[ir]=!1;var le={};le[Si]=le[qr]=le[rr]=le[Ri]=le[Yi]=le[Zi]=le[on]=le[an]=le[cn]=le[un]=le[hn]=le[pt]=le[Xi]=le[Nt]=le[er]=le[dt]=le[tr]=le[Ur]=le[ln]=le[pn]=le[dn]=le[fn]=!0,le[$r]=le[jr]=le[ir]=!1;var uv={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},hv={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},lv={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},pv={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},dv=parseFloat,fv=parseInt,Rc=typeof Qi=="object"&&Qi&&Qi.Object===Object&&Qi,gv=typeof self=="object"&&self&&self.Object===Object&&self,Ce=Rc||gv||Function("return this")(),En=s&&!s.nodeType&&s,oi=En&&!0&&u&&!u.nodeType&&u,Oc=oi&&oi.exports===En,In=Oc&&Rc.process,rt=function(){try{var w=oi&&oi.require&&oi.require("util").types;return w||In&&In.binding&&In.binding("util")}catch{}}(),Nc=rt&&rt.isArrayBuffer,Cc=rt&&rt.isDate,Ac=rt&&rt.isMap,Dc=rt&&rt.isRegExp,Fc=rt&&rt.isSet,Tc=rt&&rt.isTypedArray;function Qe(w,I,E){switch(E.length){case 0:return w.call(I);case 1:return w.call(I,E[0]);case 2:return w.call(I,E[0],E[1]);case 3:return w.call(I,E[0],E[1],E[2])}return w.apply(I,E)}function yv(w,I,E,D){for(var V=-1,re=w==null?0:w.length;++V<re;){var Pe=w[V];I(D,Pe,E(Pe),w)}return D}function st(w,I){for(var E=-1,D=w==null?0:w.length;++E<D&&I(w[E],E,w)!==!1;);return w}function vv(w,I){for(var E=w==null?0:w.length;E--&&I(w[E],E,w)!==!1;);return w}function qc(w,I){for(var E=-1,D=w==null?0:w.length;++E<D;)if(!I(w[E],E,w))return!1;return!0}function Bt(w,I){for(var E=-1,D=w==null?0:w.length,V=0,re=[];++E<D;){var Pe=w[E];I(Pe,E,w)&&(re[V++]=Pe)}return re}function kr(w,I){var E=w==null?0:w.length;return!!E&&Ni(w,I,0)>-1}function Pn(w,I,E){for(var D=-1,V=w==null?0:w.length;++D<V;)if(E(I,w[D]))return!0;return!1}function ye(w,I){for(var E=-1,D=w==null?0:w.length,V=Array(D);++E<D;)V[E]=I(w[E],E,w);return V}function Gt(w,I){for(var E=-1,D=I.length,V=w.length;++E<D;)w[V+E]=I[E];return w}function xn(w,I,E,D){var V=-1,re=w==null?0:w.length;for(D&&re&&(E=w[++V]);++V<re;)E=I(E,w[V],V,w);return E}function mv(w,I,E,D){var V=w==null?0:w.length;for(D&&V&&(E=w[--V]);V--;)E=I(E,w[V],V,w);return E}function Sn(w,I){for(var E=-1,D=w==null?0:w.length;++E<D;)if(I(w[E],E,w))return!0;return!1}var wv=Rn("length");function _v(w){return w.split("")}function bv(w){return w.match(Ny)||[]}function $c(w,I,E){var D;return E(w,function(V,re,Pe){if(I(V,re,Pe))return D=re,!1}),D}function Vr(w,I,E,D){for(var V=w.length,re=E+(D?1:-1);D?re--:++re<V;)if(I(w[re],re,w))return re;return-1}function Ni(w,I,E){return I===I?Fv(w,I,E):Vr(w,jc,E)}function Ev(w,I,E,D){for(var V=E-1,re=w.length;++V<re;)if(D(w[V],I))return V;return-1}function jc(w){return w!==w}function Uc(w,I){var E=w==null?0:w.length;return E?Nn(w,I)/E:Tr}function Rn(w){return function(I){return I==null?r:I[w]}}function On(w){return function(I){return w==null?r:w[I]}}function Lc(w,I,E,D,V){return V(w,function(re,Pe,ce){E=D?(D=!1,re):I(E,re,Pe,ce)}),E}function Iv(w,I){var E=w.length;for(w.sort(I);E--;)w[E]=w[E].value;return w}function Nn(w,I){for(var E,D=-1,V=w.length;++D<V;){var re=I(w[D]);re!==r&&(E=E===r?re:E+re)}return E}function Cn(w,I){for(var E=-1,D=Array(w);++E<w;)D[E]=I(E);return D}function Pv(w,I){return ye(I,function(E){return[E,w[E]]})}function zc(w){return w&&w.slice(0,Kc(w)+1).replace(yn,"")}function Ye(w){return function(I){return w(I)}}function An(w,I){return ye(I,function(E){return w[E]})}function sr(w,I){return w.has(I)}function Mc(w,I){for(var E=-1,D=w.length;++E<D&&Ni(I,w[E],0)>-1;);return E}function kc(w,I){for(var E=w.length;E--&&Ni(I,w[E],0)>-1;);return E}function xv(w,I){for(var E=w.length,D=0;E--;)w[E]===I&&++D;return D}var Sv=On(uv),Rv=On(hv);function Ov(w){return"\\"+pv[w]}function Nv(w,I){return w==null?r:w[I]}function Ci(w){return nv.test(w)}function Cv(w){return ov.test(w)}function Av(w){for(var I,E=[];!(I=w.next()).done;)E.push(I.value);return E}function Dn(w){var I=-1,E=Array(w.size);return w.forEach(function(D,V){E[++I]=[V,D]}),E}function Vc(w,I){return function(E){return w(I(E))}}function Jt(w,I){for(var E=-1,D=w.length,V=0,re=[];++E<D;){var Pe=w[E];(Pe===I||Pe===N)&&(w[E]=N,re[V++]=E)}return re}function Kr(w){var I=-1,E=Array(w.size);return w.forEach(function(D){E[++I]=D}),E}function Dv(w){var I=-1,E=Array(w.size);return w.forEach(function(D){E[++I]=[D,D]}),E}function Fv(w,I,E){for(var D=E-1,V=w.length;++D<V;)if(w[D]===I)return D;return-1}function Tv(w,I,E){for(var D=E+1;D--;)if(w[D]===I)return D;return D}function Ai(w){return Ci(w)?$v(w):wv(w)}function ft(w){return Ci(w)?jv(w):_v(w)}function Kc(w){for(var I=w.length;I--&&xy.test(w.charAt(I)););return I}var qv=On(lv);function $v(w){for(var I=bn.lastIndex=0;bn.test(w);)++I;return I}function jv(w){return w.match(bn)||[]}function Uv(w){return w.match(sv)||[]}var Lv=function w(I){I=I==null?Ce:Di.defaults(Ce.Object(),I,Di.pick(Ce,av));var E=I.Array,D=I.Date,V=I.Error,re=I.Function,Pe=I.Math,ce=I.Object,Fn=I.RegExp,zv=I.String,nt=I.TypeError,Hr=E.prototype,Mv=re.prototype,Fi=ce.prototype,Br=I["__core-js_shared__"],Gr=Mv.toString,oe=Fi.hasOwnProperty,kv=0,Hc=function(){var e=/[^.]+$/.exec(Br&&Br.keys&&Br.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Jr=Fi.toString,Vv=Gr.call(ce),Kv=Ce._,Hv=Fn("^"+Gr.call(oe).replace(gn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wr=Oc?I.Buffer:r,Wt=I.Symbol,Qr=I.Uint8Array,Bc=Wr?Wr.allocUnsafe:r,Yr=Vc(ce.getPrototypeOf,ce),Gc=ce.create,Jc=Fi.propertyIsEnumerable,Zr=Hr.splice,Wc=Wt?Wt.isConcatSpreadable:r,nr=Wt?Wt.iterator:r,ai=Wt?Wt.toStringTag:r,Xr=function(){try{var e=pi(ce,"defineProperty");return e({},"",{}),e}catch{}}(),Bv=I.clearTimeout!==Ce.clearTimeout&&I.clearTimeout,Gv=D&&D.now!==Ce.Date.now&&D.now,Jv=I.setTimeout!==Ce.setTimeout&&I.setTimeout,es=Pe.ceil,ts=Pe.floor,Tn=ce.getOwnPropertySymbols,Wv=Wr?Wr.isBuffer:r,Qc=I.isFinite,Qv=Hr.join,Yv=Vc(ce.keys,ce),xe=Pe.max,Te=Pe.min,Zv=D.now,Xv=I.parseInt,Yc=Pe.random,em=Hr.reverse,qn=pi(I,"DataView"),or=pi(I,"Map"),$n=pi(I,"Promise"),Ti=pi(I,"Set"),ar=pi(I,"WeakMap"),cr=pi(ce,"create"),is=ar&&new ar,qi={},tm=di(qn),im=di(or),rm=di($n),sm=di(Ti),nm=di(ar),rs=Wt?Wt.prototype:r,ur=rs?rs.valueOf:r,Zc=rs?rs.toString:r;function d(e){if(we(e)&&!K(e)&&!(e instanceof Z)){if(e instanceof ot)return e;if(oe.call(e,"__wrapped__"))return Xu(e)}return new ot(e)}var $i=function(){function e(){}return function(t){if(!me(t))return{};if(Gc)return Gc(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function ss(){}function ot(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}d.templateSettings={escape:wy,evaluate:_y,interpolate:ac,variable:"",imports:{_:d}},d.prototype=ss.prototype,d.prototype.constructor=d,ot.prototype=$i(ss.prototype),ot.prototype.constructor=ot;function Z(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=_t,this.__views__=[]}function om(){var e=new Z(this.__wrapped__);return e.__actions__=He(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=He(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=He(this.__views__),e}function am(){if(this.__filtered__){var e=new Z(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function cm(){var e=this.__wrapped__.value(),t=this.__dir__,n=K(e),h=t<0,l=n?e.length:0,f=_0(0,l,this.__views__),y=f.start,v=f.end,_=v-y,P=h?v:y-1,S=this.__iteratees__,R=S.length,A=0,T=Te(_,this.__takeCount__);if(!n||!h&&l==_&&T==_)return Eu(e,this.__actions__);var z=[];e:for(;_--&&A<T;){P+=t;for(var B=-1,M=e[P];++B<R;){var Q=S[B],te=Q.iteratee,et=Q.type,ke=te(M);if(et==iy)M=ke;else if(!ke){if(et==ic)continue e;break e}}z[A++]=M}return z}Z.prototype=$i(ss.prototype),Z.prototype.constructor=Z;function ci(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function um(){this.__data__=cr?cr(null):{},this.size=0}function hm(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function lm(e){var t=this.__data__;if(cr){var n=t[e];return n===b?r:n}return oe.call(t,e)?t[e]:r}function pm(e){var t=this.__data__;return cr?t[e]!==r:oe.call(t,e)}function dm(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=cr&&t===r?b:t,this}ci.prototype.clear=um,ci.prototype.delete=hm,ci.prototype.get=lm,ci.prototype.has=pm,ci.prototype.set=dm;function Ct(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function fm(){this.__data__=[],this.size=0}function gm(e){var t=this.__data__,n=ns(t,e);if(n<0)return!1;var h=t.length-1;return n==h?t.pop():Zr.call(t,n,1),--this.size,!0}function ym(e){var t=this.__data__,n=ns(t,e);return n<0?r:t[n][1]}function vm(e){return ns(this.__data__,e)>-1}function mm(e,t){var n=this.__data__,h=ns(n,e);return h<0?(++this.size,n.push([e,t])):n[h][1]=t,this}Ct.prototype.clear=fm,Ct.prototype.delete=gm,Ct.prototype.get=ym,Ct.prototype.has=vm,Ct.prototype.set=mm;function At(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function wm(){this.size=0,this.__data__={hash:new ci,map:new(or||Ct),string:new ci}}function _m(e){var t=vs(this,e).delete(e);return this.size-=t?1:0,t}function bm(e){return vs(this,e).get(e)}function Em(e){return vs(this,e).has(e)}function Im(e,t){var n=vs(this,e),h=n.size;return n.set(e,t),this.size+=n.size==h?0:1,this}At.prototype.clear=wm,At.prototype.delete=_m,At.prototype.get=bm,At.prototype.has=Em,At.prototype.set=Im;function ui(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new At;++t<n;)this.add(e[t])}function Pm(e){return this.__data__.set(e,b),this}function xm(e){return this.__data__.has(e)}ui.prototype.add=ui.prototype.push=Pm,ui.prototype.has=xm;function gt(e){var t=this.__data__=new Ct(e);this.size=t.size}function Sm(){this.__data__=new Ct,this.size=0}function Rm(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Om(e){return this.__data__.get(e)}function Nm(e){return this.__data__.has(e)}function Cm(e,t){var n=this.__data__;if(n instanceof Ct){var h=n.__data__;if(!or||h.length<a-1)return h.push([e,t]),this.size=++n.size,this;n=this.__data__=new At(h)}return n.set(e,t),this.size=n.size,this}gt.prototype.clear=Sm,gt.prototype.delete=Rm,gt.prototype.get=Om,gt.prototype.has=Nm,gt.prototype.set=Cm;function Xc(e,t){var n=K(e),h=!n&&fi(e),l=!n&&!h&&ei(e),f=!n&&!h&&!l&&zi(e),y=n||h||l||f,v=y?Cn(e.length,zv):[],_=v.length;for(var P in e)(t||oe.call(e,P))&&!(y&&(P=="length"||l&&(P=="offset"||P=="parent")||f&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||qt(P,_)))&&v.push(P);return v}function eu(e){var t=e.length;return t?e[Gn(0,t-1)]:r}function Am(e,t){return ms(He(e),hi(t,0,e.length))}function Dm(e){return ms(He(e))}function jn(e,t,n){(n!==r&&!yt(e[t],n)||n===r&&!(t in e))&&Dt(e,t,n)}function hr(e,t,n){var h=e[t];(!(oe.call(e,t)&&yt(h,n))||n===r&&!(t in e))&&Dt(e,t,n)}function ns(e,t){for(var n=e.length;n--;)if(yt(e[n][0],t))return n;return-1}function Fm(e,t,n,h){return Qt(e,function(l,f,y){t(h,l,n(l),y)}),h}function tu(e,t){return e&&Et(t,Re(t),e)}function Tm(e,t){return e&&Et(t,Ge(t),e)}function Dt(e,t,n){t=="__proto__"&&Xr?Xr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Un(e,t){for(var n=-1,h=t.length,l=E(h),f=e==null;++n<h;)l[n]=f?r:wo(e,t[n]);return l}function hi(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function at(e,t,n,h,l,f){var y,v=t&O,_=t&q,P=t&ne;if(n&&(y=l?n(e,h,l,f):n(e)),y!==r)return y;if(!me(e))return e;var S=K(e);if(S){if(y=E0(e),!v)return He(e,y)}else{var R=qe(e),A=R==jr||R==rc;if(ei(e))return xu(e,v);if(R==Nt||R==Si||A&&!l){if(y=_||A?{}:Ku(e),!v)return _?l0(e,Tm(y,e)):h0(e,tu(y,e))}else{if(!le[R])return l?e:{};y=I0(e,R,v)}}f||(f=new gt);var T=f.get(e);if(T)return T;f.set(e,y),wh(e)?e.forEach(function(M){y.add(at(M,t,n,M,e,f))}):vh(e)&&e.forEach(function(M,Q){y.set(Q,at(M,t,n,Q,e,f))});var z=P?_?so:ro:_?Ge:Re,B=S?r:z(e);return st(B||e,function(M,Q){B&&(Q=M,M=e[Q]),hr(y,Q,at(M,t,n,Q,e,f))}),y}function qm(e){var t=Re(e);return function(n){return iu(n,e,t)}}function iu(e,t,n){var h=n.length;if(e==null)return!h;for(e=ce(e);h--;){var l=n[h],f=t[l],y=e[l];if(y===r&&!(l in e)||!f(y))return!1}return!0}function ru(e,t,n){if(typeof e!="function")throw new nt(g);return vr(function(){e.apply(r,n)},t)}function lr(e,t,n,h){var l=-1,f=kr,y=!0,v=e.length,_=[],P=t.length;if(!v)return _;n&&(t=ye(t,Ye(n))),h?(f=Pn,y=!1):t.length>=a&&(f=sr,y=!1,t=new ui(t));e:for(;++l<v;){var S=e[l],R=n==null?S:n(S);if(S=h||S!==0?S:0,y&&R===R){for(var A=P;A--;)if(t[A]===R)continue e;_.push(S)}else f(t,R,h)||_.push(S)}return _}var Qt=Cu(bt),su=Cu(zn,!0);function $m(e,t){var n=!0;return Qt(e,function(h,l,f){return n=!!t(h,l,f),n}),n}function os(e,t,n){for(var h=-1,l=e.length;++h<l;){var f=e[h],y=t(f);if(y!=null&&(v===r?y===y&&!Xe(y):n(y,v)))var v=y,_=f}return _}function jm(e,t,n,h){var l=e.length;for(n=H(n),n<0&&(n=-n>l?0:l+n),h=h===r||h>l?l:H(h),h<0&&(h+=l),h=n>h?0:bh(h);n<h;)e[n++]=t;return e}function nu(e,t){var n=[];return Qt(e,function(h,l,f){t(h,l,f)&&n.push(h)}),n}function Ae(e,t,n,h,l){var f=-1,y=e.length;for(n||(n=x0),l||(l=[]);++f<y;){var v=e[f];t>0&&n(v)?t>1?Ae(v,t-1,n,h,l):Gt(l,v):h||(l[l.length]=v)}return l}var Ln=Au(),ou=Au(!0);function bt(e,t){return e&&Ln(e,t,Re)}function zn(e,t){return e&&ou(e,t,Re)}function as(e,t){return Bt(t,function(n){return $t(e[n])})}function li(e,t){t=Zt(t,e);for(var n=0,h=t.length;e!=null&&n<h;)e=e[It(t[n++])];return n&&n==h?e:r}function au(e,t,n){var h=t(e);return K(e)?h:Gt(h,n(e))}function ze(e){return e==null?e===r?py:hy:ai&&ai in ce(e)?w0(e):D0(e)}function Mn(e,t){return e>t}function Um(e,t){return e!=null&&oe.call(e,t)}function Lm(e,t){return e!=null&&t in ce(e)}function zm(e,t,n){return e>=Te(t,n)&&e<xe(t,n)}function kn(e,t,n){for(var h=n?Pn:kr,l=e[0].length,f=e.length,y=f,v=E(f),_=1/0,P=[];y--;){var S=e[y];y&&t&&(S=ye(S,Ye(t))),_=Te(S.length,_),v[y]=!n&&(t||l>=120&&S.length>=120)?new ui(y&&S):r}S=e[0];var R=-1,A=v[0];e:for(;++R<l&&P.length<_;){var T=S[R],z=t?t(T):T;if(T=n||T!==0?T:0,!(A?sr(A,z):h(P,z,n))){for(y=f;--y;){var B=v[y];if(!(B?sr(B,z):h(e[y],z,n)))continue e}A&&A.push(z),P.push(T)}}return P}function Mm(e,t,n,h){return bt(e,function(l,f,y){t(h,n(l),f,y)}),h}function pr(e,t,n){t=Zt(t,e),e=Ju(e,t);var h=e==null?e:e[It(ut(t))];return h==null?r:Qe(h,e,n)}function cu(e){return we(e)&&ze(e)==Si}function km(e){return we(e)&&ze(e)==rr}function Vm(e){return we(e)&&ze(e)==Zi}function dr(e,t,n,h,l){return e===t?!0:e==null||t==null||!we(e)&&!we(t)?e!==e&&t!==t:Km(e,t,n,h,dr,l)}function Km(e,t,n,h,l,f){var y=K(e),v=K(t),_=y?qr:qe(e),P=v?qr:qe(t);_=_==Si?Nt:_,P=P==Si?Nt:P;var S=_==Nt,R=P==Nt,A=_==P;if(A&&ei(e)){if(!ei(t))return!1;y=!0,S=!1}if(A&&!S)return f||(f=new gt),y||zi(e)?Mu(e,t,n,h,l,f):v0(e,t,_,n,h,l,f);if(!(n&F)){var T=S&&oe.call(e,"__wrapped__"),z=R&&oe.call(t,"__wrapped__");if(T||z){var B=T?e.value():e,M=z?t.value():t;return f||(f=new gt),l(B,M,n,h,f)}}return A?(f||(f=new gt),m0(e,t,n,h,l,f)):!1}function Hm(e){return we(e)&&qe(e)==pt}function Vn(e,t,n,h){var l=n.length,f=l,y=!h;if(e==null)return!f;for(e=ce(e);l--;){var v=n[l];if(y&&v[2]?v[1]!==e[v[0]]:!(v[0]in e))return!1}for(;++l<f;){v=n[l];var _=v[0],P=e[_],S=v[1];if(y&&v[2]){if(P===r&&!(_ in e))return!1}else{var R=new gt;if(h)var A=h(P,S,_,e,t,R);if(!(A===r?dr(S,P,F|k,h,R):A))return!1}}return!0}function uu(e){if(!me(e)||R0(e))return!1;var t=$t(e)?Hv:qy;return t.test(di(e))}function Bm(e){return we(e)&&ze(e)==er}function Gm(e){return we(e)&&qe(e)==dt}function Jm(e){return we(e)&&Ps(e.length)&&!!de[ze(e)]}function hu(e){return typeof e=="function"?e:e==null?Je:typeof e=="object"?K(e)?du(e[0],e[1]):pu(e):Dh(e)}function Kn(e){if(!yr(e))return Yv(e);var t=[];for(var n in ce(e))oe.call(e,n)&&n!="constructor"&&t.push(n);return t}function Wm(e){if(!me(e))return A0(e);var t=yr(e),n=[];for(var h in e)h=="constructor"&&(t||!oe.call(e,h))||n.push(h);return n}function Hn(e,t){return e<t}function lu(e,t){var n=-1,h=Be(e)?E(e.length):[];return Qt(e,function(l,f,y){h[++n]=t(l,f,y)}),h}function pu(e){var t=oo(e);return t.length==1&&t[0][2]?Bu(t[0][0],t[0][1]):function(n){return n===e||Vn(n,e,t)}}function du(e,t){return co(e)&&Hu(t)?Bu(It(e),t):function(n){var h=wo(n,e);return h===r&&h===t?_o(n,e):dr(t,h,F|k)}}function cs(e,t,n,h,l){e!==t&&Ln(t,function(f,y){if(l||(l=new gt),me(f))Qm(e,t,y,n,cs,h,l);else{var v=h?h(ho(e,y),f,y+"",e,t,l):r;v===r&&(v=f),jn(e,y,v)}},Ge)}function Qm(e,t,n,h,l,f,y){var v=ho(e,n),_=ho(t,n),P=y.get(_);if(P){jn(e,n,P);return}var S=f?f(v,_,n+"",e,t,y):r,R=S===r;if(R){var A=K(_),T=!A&&ei(_),z=!A&&!T&&zi(_);S=_,A||T||z?K(v)?S=v:Ee(v)?S=He(v):T?(R=!1,S=xu(_,!0)):z?(R=!1,S=Su(_,!0)):S=[]:mr(_)||fi(_)?(S=v,fi(v)?S=Eh(v):(!me(v)||$t(v))&&(S=Ku(_))):R=!1}R&&(y.set(_,S),l(S,_,h,f,y),y.delete(_)),jn(e,n,S)}function fu(e,t){var n=e.length;if(n)return t+=t<0?n:0,qt(t,n)?e[t]:r}function gu(e,t,n){t.length?t=ye(t,function(f){return K(f)?function(y){return li(y,f.length===1?f[0]:f)}:f}):t=[Je];var h=-1;t=ye(t,Ye(U()));var l=lu(e,function(f,y,v){var _=ye(t,function(P){return P(f)});return{criteria:_,index:++h,value:f}});return Iv(l,function(f,y){return u0(f,y,n)})}function Ym(e,t){return yu(e,t,function(n,h){return _o(e,h)})}function yu(e,t,n){for(var h=-1,l=t.length,f={};++h<l;){var y=t[h],v=li(e,y);n(v,y)&&fr(f,Zt(y,e),v)}return f}function Zm(e){return function(t){return li(t,e)}}function Bn(e,t,n,h){var l=h?Ev:Ni,f=-1,y=t.length,v=e;for(e===t&&(t=He(t)),n&&(v=ye(e,Ye(n)));++f<y;)for(var _=0,P=t[f],S=n?n(P):P;(_=l(v,S,_,h))>-1;)v!==e&&Zr.call(v,_,1),Zr.call(e,_,1);return e}function vu(e,t){for(var n=e?t.length:0,h=n-1;n--;){var l=t[n];if(n==h||l!==f){var f=l;qt(l)?Zr.call(e,l,1):Qn(e,l)}}return e}function Gn(e,t){return e+ts(Yc()*(t-e+1))}function Xm(e,t,n,h){for(var l=-1,f=xe(es((t-e)/(n||1)),0),y=E(f);f--;)y[h?f:++l]=e,e+=n;return y}function Jn(e,t){var n="";if(!e||t<1||t>Ht)return n;do t%2&&(n+=e),t=ts(t/2),t&&(e+=e);while(t);return n}function J(e,t){return lo(Gu(e,t,Je),e+"")}function e0(e){return eu(Mi(e))}function t0(e,t){var n=Mi(e);return ms(n,hi(t,0,n.length))}function fr(e,t,n,h){if(!me(e))return e;t=Zt(t,e);for(var l=-1,f=t.length,y=f-1,v=e;v!=null&&++l<f;){var _=It(t[l]),P=n;if(_==="__proto__"||_==="constructor"||_==="prototype")return e;if(l!=y){var S=v[_];P=h?h(S,_,v):r,P===r&&(P=me(S)?S:qt(t[l+1])?[]:{})}hr(v,_,P),v=v[_]}return e}var mu=is?function(e,t){return is.set(e,t),e}:Je,i0=Xr?function(e,t){return Xr(e,"toString",{configurable:!0,enumerable:!1,value:Eo(t),writable:!0})}:Je;function r0(e){return ms(Mi(e))}function ct(e,t,n){var h=-1,l=e.length;t<0&&(t=-t>l?0:l+t),n=n>l?l:n,n<0&&(n+=l),l=t>n?0:n-t>>>0,t>>>=0;for(var f=E(l);++h<l;)f[h]=e[h+t];return f}function s0(e,t){var n;return Qt(e,function(h,l,f){return n=t(h,l,f),!n}),!!n}function us(e,t,n){var h=0,l=e==null?h:e.length;if(typeof t=="number"&&t===t&&l<=oy){for(;h<l;){var f=h+l>>>1,y=e[f];y!==null&&!Xe(y)&&(n?y<=t:y<t)?h=f+1:l=f}return l}return Wn(e,t,Je,n)}function Wn(e,t,n,h){var l=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var y=t!==t,v=t===null,_=Xe(t),P=t===r;l<f;){var S=ts((l+f)/2),R=n(e[S]),A=R!==r,T=R===null,z=R===R,B=Xe(R);if(y)var M=h||z;else P?M=z&&(h||A):v?M=z&&A&&(h||!T):_?M=z&&A&&!T&&(h||!B):T||B?M=!1:M=h?R<=t:R<t;M?l=S+1:f=S}return Te(f,ny)}function wu(e,t){for(var n=-1,h=e.length,l=0,f=[];++n<h;){var y=e[n],v=t?t(y):y;if(!n||!yt(v,_)){var _=v;f[l++]=y===0?0:y}}return f}function _u(e){return typeof e=="number"?e:Xe(e)?Tr:+e}function Ze(e){if(typeof e=="string")return e;if(K(e))return ye(e,Ze)+"";if(Xe(e))return Zc?Zc.call(e):"";var t=e+"";return t=="0"&&1/e==-ni?"-0":t}function Yt(e,t,n){var h=-1,l=kr,f=e.length,y=!0,v=[],_=v;if(n)y=!1,l=Pn;else if(f>=a){var P=t?null:g0(e);if(P)return Kr(P);y=!1,l=sr,_=new ui}else _=t?[]:v;e:for(;++h<f;){var S=e[h],R=t?t(S):S;if(S=n||S!==0?S:0,y&&R===R){for(var A=_.length;A--;)if(_[A]===R)continue e;t&&_.push(R),v.push(S)}else l(_,R,n)||(_!==v&&_.push(R),v.push(S))}return v}function Qn(e,t){return t=Zt(t,e),e=Ju(e,t),e==null||delete e[It(ut(t))]}function bu(e,t,n,h){return fr(e,t,n(li(e,t)),h)}function hs(e,t,n,h){for(var l=e.length,f=h?l:-1;(h?f--:++f<l)&&t(e[f],f,e););return n?ct(e,h?0:f,h?f+1:l):ct(e,h?f+1:0,h?l:f)}function Eu(e,t){var n=e;return n instanceof Z&&(n=n.value()),xn(t,function(h,l){return l.func.apply(l.thisArg,Gt([h],l.args))},n)}function Yn(e,t,n){var h=e.length;if(h<2)return h?Yt(e[0]):[];for(var l=-1,f=E(h);++l<h;)for(var y=e[l],v=-1;++v<h;)v!=l&&(f[l]=lr(f[l]||y,e[v],t,n));return Yt(Ae(f,1),t,n)}function Iu(e,t,n){for(var h=-1,l=e.length,f=t.length,y={};++h<l;){var v=h<f?t[h]:r;n(y,e[h],v)}return y}function Zn(e){return Ee(e)?e:[]}function Xn(e){return typeof e=="function"?e:Je}function Zt(e,t){return K(e)?e:co(e,t)?[e]:Zu(se(e))}var n0=J;function Xt(e,t,n){var h=e.length;return n=n===r?h:n,!t&&n>=h?e:ct(e,t,n)}var Pu=Bv||function(e){return Ce.clearTimeout(e)};function xu(e,t){if(t)return e.slice();var n=e.length,h=Bc?Bc(n):new e.constructor(n);return e.copy(h),h}function eo(e){var t=new e.constructor(e.byteLength);return new Qr(t).set(new Qr(e)),t}function o0(e,t){var n=t?eo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function a0(e){var t=new e.constructor(e.source,cc.exec(e));return t.lastIndex=e.lastIndex,t}function c0(e){return ur?ce(ur.call(e)):{}}function Su(e,t){var n=t?eo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Ru(e,t){if(e!==t){var n=e!==r,h=e===null,l=e===e,f=Xe(e),y=t!==r,v=t===null,_=t===t,P=Xe(t);if(!v&&!P&&!f&&e>t||f&&y&&_&&!v&&!P||h&&y&&_||!n&&_||!l)return 1;if(!h&&!f&&!P&&e<t||P&&n&&l&&!h&&!f||v&&n&&l||!y&&l||!_)return-1}return 0}function u0(e,t,n){for(var h=-1,l=e.criteria,f=t.criteria,y=l.length,v=n.length;++h<y;){var _=Ru(l[h],f[h]);if(_){if(h>=v)return _;var P=n[h];return _*(P=="desc"?-1:1)}}return e.index-t.index}function Ou(e,t,n,h){for(var l=-1,f=e.length,y=n.length,v=-1,_=t.length,P=xe(f-y,0),S=E(_+P),R=!h;++v<_;)S[v]=t[v];for(;++l<y;)(R||l<f)&&(S[n[l]]=e[l]);for(;P--;)S[v++]=e[l++];return S}function Nu(e,t,n,h){for(var l=-1,f=e.length,y=-1,v=n.length,_=-1,P=t.length,S=xe(f-v,0),R=E(S+P),A=!h;++l<S;)R[l]=e[l];for(var T=l;++_<P;)R[T+_]=t[_];for(;++y<v;)(A||l<f)&&(R[T+n[y]]=e[l++]);return R}function He(e,t){var n=-1,h=e.length;for(t||(t=E(h));++n<h;)t[n]=e[n];return t}function Et(e,t,n,h){var l=!n;n||(n={});for(var f=-1,y=t.length;++f<y;){var v=t[f],_=h?h(n[v],e[v],v,n,e):r;_===r&&(_=e[v]),l?Dt(n,v,_):hr(n,v,_)}return n}function h0(e,t){return Et(e,ao(e),t)}function l0(e,t){return Et(e,ku(e),t)}function ls(e,t){return function(n,h){var l=K(n)?yv:Fm,f=t?t():{};return l(n,e,U(h,2),f)}}function ji(e){return J(function(t,n){var h=-1,l=n.length,f=l>1?n[l-1]:r,y=l>2?n[2]:r;for(f=e.length>3&&typeof f=="function"?(l--,f):r,y&&Me(n[0],n[1],y)&&(f=l<3?r:f,l=1),t=ce(t);++h<l;){var v=n[h];v&&e(t,v,h,f)}return t})}function Cu(e,t){return function(n,h){if(n==null)return n;if(!Be(n))return e(n,h);for(var l=n.length,f=t?l:-1,y=ce(n);(t?f--:++f<l)&&h(y[f],f,y)!==!1;);return n}}function Au(e){return function(t,n,h){for(var l=-1,f=ce(t),y=h(t),v=y.length;v--;){var _=y[e?v:++l];if(n(f[_],_,f)===!1)break}return t}}function p0(e,t,n){var h=t&W,l=gr(e);function f(){var y=this&&this!==Ce&&this instanceof f?l:e;return y.apply(h?n:this,arguments)}return f}function Du(e){return function(t){t=se(t);var n=Ci(t)?ft(t):r,h=n?n[0]:t.charAt(0),l=n?Xt(n,1).join(""):t.slice(1);return h[e]()+l}}function Ui(e){return function(t){return xn(Ch(Nh(t).replace(iv,"")),e,"")}}function gr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=$i(e.prototype),h=e.apply(n,t);return me(h)?h:n}}function d0(e,t,n){var h=gr(e);function l(){for(var f=arguments.length,y=E(f),v=f,_=Li(l);v--;)y[v]=arguments[v];var P=f<3&&y[0]!==_&&y[f-1]!==_?[]:Jt(y,_);if(f-=P.length,f<n)return ju(e,t,ps,l.placeholder,r,y,P,r,r,n-f);var S=this&&this!==Ce&&this instanceof l?h:e;return Qe(S,this,y)}return l}function Fu(e){return function(t,n,h){var l=ce(t);if(!Be(t)){var f=U(n,3);t=Re(t),n=function(v){return f(l[v],v,l)}}var y=e(t,n,h);return y>-1?l[f?t[y]:y]:r}}function Tu(e){return Tt(function(t){var n=t.length,h=n,l=ot.prototype.thru;for(e&&t.reverse();h--;){var f=t[h];if(typeof f!="function")throw new nt(g);if(l&&!y&&ys(f)=="wrapper")var y=new ot([],!0)}for(h=y?h:n;++h<n;){f=t[h];var v=ys(f),_=v=="wrapper"?no(f):r;_&&uo(_[0])&&_[1]==(be|ue|G|Le)&&!_[4].length&&_[9]==1?y=y[ys(_[0])].apply(y,_[3]):y=f.length==1&&uo(f)?y[v]():y.thru(f)}return function(){var P=arguments,S=P[0];if(y&&P.length==1&&K(S))return y.plant(S).value();for(var R=0,A=n?t[R].apply(this,P):S;++R<n;)A=t[R].call(this,A);return A}})}function ps(e,t,n,h,l,f,y,v,_,P){var S=t&be,R=t&W,A=t&ae,T=t&(ue|ie),z=t&Kt,B=A?r:gr(e);function M(){for(var Q=arguments.length,te=E(Q),et=Q;et--;)te[et]=arguments[et];if(T)var ke=Li(M),tt=xv(te,ke);if(h&&(te=Ou(te,h,l,T)),f&&(te=Nu(te,f,y,T)),Q-=tt,T&&Q<P){var Ie=Jt(te,ke);return ju(e,t,ps,M.placeholder,n,te,Ie,v,_,P-Q)}var vt=R?n:this,Ut=A?vt[e]:e;return Q=te.length,v?te=F0(te,v):z&&Q>1&&te.reverse(),S&&_<Q&&(te.length=_),this&&this!==Ce&&this instanceof M&&(Ut=B||gr(Ut)),Ut.apply(vt,te)}return M}function qu(e,t){return function(n,h){return Mm(n,e,t(h),{})}}function ds(e,t){return function(n,h){var l;if(n===r&&h===r)return t;if(n!==r&&(l=n),h!==r){if(l===r)return h;typeof n=="string"||typeof h=="string"?(n=Ze(n),h=Ze(h)):(n=_u(n),h=_u(h)),l=e(n,h)}return l}}function to(e){return Tt(function(t){return t=ye(t,Ye(U())),J(function(n){var h=this;return e(t,function(l){return Qe(l,h,n)})})})}function fs(e,t){t=t===r?" ":Ze(t);var n=t.length;if(n<2)return n?Jn(t,e):t;var h=Jn(t,es(e/Ai(t)));return Ci(t)?Xt(ft(h),0,e).join(""):h.slice(0,e)}function f0(e,t,n,h){var l=t&W,f=gr(e);function y(){for(var v=-1,_=arguments.length,P=-1,S=h.length,R=E(S+_),A=this&&this!==Ce&&this instanceof y?f:e;++P<S;)R[P]=h[P];for(;_--;)R[P++]=arguments[++v];return Qe(A,l?n:this,R)}return y}function $u(e){return function(t,n,h){return h&&typeof h!="number"&&Me(t,n,h)&&(n=h=r),t=jt(t),n===r?(n=t,t=0):n=jt(n),h=h===r?t<n?1:-1:jt(h),Xm(t,n,h,e)}}function gs(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=ht(t),n=ht(n)),e(t,n)}}function ju(e,t,n,h,l,f,y,v,_,P){var S=t&ue,R=S?y:r,A=S?r:y,T=S?f:r,z=S?r:f;t|=S?G:ge,t&=~(S?ge:G),t&Ne||(t&=~(W|ae));var B=[e,t,l,T,R,z,A,v,_,P],M=n.apply(r,B);return uo(e)&&Wu(M,B),M.placeholder=h,Qu(M,e,t)}function io(e){var t=Pe[e];return function(n,h){if(n=ht(n),h=h==null?0:Te(H(h),292),h&&Qc(n)){var l=(se(n)+"e").split("e"),f=t(l[0]+"e"+(+l[1]+h));return l=(se(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-h))}return t(n)}}var g0=Ti&&1/Kr(new Ti([,-0]))[1]==ni?function(e){return new Ti(e)}:xo;function Uu(e){return function(t){var n=qe(t);return n==pt?Dn(t):n==dt?Dv(t):Pv(t,e(t))}}function Ft(e,t,n,h,l,f,y,v){var _=t&ae;if(!_&&typeof e!="function")throw new nt(g);var P=h?h.length:0;if(P||(t&=~(G|ge),h=l=r),y=y===r?y:xe(H(y),0),v=v===r?v:H(v),P-=l?l.length:0,t&ge){var S=h,R=l;h=l=r}var A=_?r:no(e),T=[e,t,n,h,l,S,R,f,y,v];if(A&&C0(T,A),e=T[0],t=T[1],n=T[2],h=T[3],l=T[4],v=T[9]=T[9]===r?_?0:e.length:xe(T[9]-P,0),!v&&t&(ue|ie)&&(t&=~(ue|ie)),!t||t==W)var z=p0(e,t,n);else t==ue||t==ie?z=d0(e,t,v):(t==G||t==(W|G))&&!l.length?z=f0(e,t,n,h):z=ps.apply(r,T);var B=A?mu:Wu;return Qu(B(z,T),e,t)}function Lu(e,t,n,h){return e===r||yt(e,Fi[n])&&!oe.call(h,n)?t:e}function zu(e,t,n,h,l,f){return me(e)&&me(t)&&(f.set(t,e),cs(e,t,r,zu,f),f.delete(t)),e}function y0(e){return mr(e)?r:e}function Mu(e,t,n,h,l,f){var y=n&F,v=e.length,_=t.length;if(v!=_&&!(y&&_>v))return!1;var P=f.get(e),S=f.get(t);if(P&&S)return P==t&&S==e;var R=-1,A=!0,T=n&k?new ui:r;for(f.set(e,t),f.set(t,e);++R<v;){var z=e[R],B=t[R];if(h)var M=y?h(B,z,R,t,e,f):h(z,B,R,e,t,f);if(M!==r){if(M)continue;A=!1;break}if(T){if(!Sn(t,function(Q,te){if(!sr(T,te)&&(z===Q||l(z,Q,n,h,f)))return T.push(te)})){A=!1;break}}else if(!(z===B||l(z,B,n,h,f))){A=!1;break}}return f.delete(e),f.delete(t),A}function v0(e,t,n,h,l,f,y){switch(n){case Ri:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case rr:return!(e.byteLength!=t.byteLength||!f(new Qr(e),new Qr(t)));case Yi:case Zi:case Xi:return yt(+e,+t);case $r:return e.name==t.name&&e.message==t.message;case er:case tr:return e==t+"";case pt:var v=Dn;case dt:var _=h&F;if(v||(v=Kr),e.size!=t.size&&!_)return!1;var P=y.get(e);if(P)return P==t;h|=k,y.set(e,t);var S=Mu(v(e),v(t),h,l,f,y);return y.delete(e),S;case Ur:if(ur)return ur.call(e)==ur.call(t)}return!1}function m0(e,t,n,h,l,f){var y=n&F,v=ro(e),_=v.length,P=ro(t),S=P.length;if(_!=S&&!y)return!1;for(var R=_;R--;){var A=v[R];if(!(y?A in t:oe.call(t,A)))return!1}var T=f.get(e),z=f.get(t);if(T&&z)return T==t&&z==e;var B=!0;f.set(e,t),f.set(t,e);for(var M=y;++R<_;){A=v[R];var Q=e[A],te=t[A];if(h)var et=y?h(te,Q,A,t,e,f):h(Q,te,A,e,t,f);if(!(et===r?Q===te||l(Q,te,n,h,f):et)){B=!1;break}M||(M=A=="constructor")}if(B&&!M){var ke=e.constructor,tt=t.constructor;ke!=tt&&"constructor"in e&&"constructor"in t&&!(typeof ke=="function"&&ke instanceof ke&&typeof tt=="function"&&tt instanceof tt)&&(B=!1)}return f.delete(e),f.delete(t),B}function Tt(e){return lo(Gu(e,r,ih),e+"")}function ro(e){return au(e,Re,ao)}function so(e){return au(e,Ge,ku)}var no=is?function(e){return is.get(e)}:xo;function ys(e){for(var t=e.name+"",n=qi[t],h=oe.call(qi,t)?n.length:0;h--;){var l=n[h],f=l.func;if(f==null||f==e)return l.name}return t}function Li(e){var t=oe.call(d,"placeholder")?d:e;return t.placeholder}function U(){var e=d.iteratee||Io;return e=e===Io?hu:e,arguments.length?e(arguments[0],arguments[1]):e}function vs(e,t){var n=e.__data__;return S0(t)?n[typeof t=="string"?"string":"hash"]:n.map}function oo(e){for(var t=Re(e),n=t.length;n--;){var h=t[n],l=e[h];t[n]=[h,l,Hu(l)]}return t}function pi(e,t){var n=Nv(e,t);return uu(n)?n:r}function w0(e){var t=oe.call(e,ai),n=e[ai];try{e[ai]=r;var h=!0}catch{}var l=Jr.call(e);return h&&(t?e[ai]=n:delete e[ai]),l}var ao=Tn?function(e){return e==null?[]:(e=ce(e),Bt(Tn(e),function(t){return Jc.call(e,t)}))}:So,ku=Tn?function(e){for(var t=[];e;)Gt(t,ao(e)),e=Yr(e);return t}:So,qe=ze;(qn&&qe(new qn(new ArrayBuffer(1)))!=Ri||or&&qe(new or)!=pt||$n&&qe($n.resolve())!=sc||Ti&&qe(new Ti)!=dt||ar&&qe(new ar)!=ir)&&(qe=function(e){var t=ze(e),n=t==Nt?e.constructor:r,h=n?di(n):"";if(h)switch(h){case tm:return Ri;case im:return pt;case rm:return sc;case sm:return dt;case nm:return ir}return t});function _0(e,t,n){for(var h=-1,l=n.length;++h<l;){var f=n[h],y=f.size;switch(f.type){case"drop":e+=y;break;case"dropRight":t-=y;break;case"take":t=Te(t,e+y);break;case"takeRight":e=xe(e,t-y);break}}return{start:e,end:t}}function b0(e){var t=e.match(Ry);return t?t[1].split(Oy):[]}function Vu(e,t,n){t=Zt(t,e);for(var h=-1,l=t.length,f=!1;++h<l;){var y=It(t[h]);if(!(f=e!=null&&n(e,y)))break;e=e[y]}return f||++h!=l?f:(l=e==null?0:e.length,!!l&&Ps(l)&&qt(y,l)&&(K(e)||fi(e)))}function E0(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&oe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Ku(e){return typeof e.constructor=="function"&&!yr(e)?$i(Yr(e)):{}}function I0(e,t,n){var h=e.constructor;switch(t){case rr:return eo(e);case Yi:case Zi:return new h(+e);case Ri:return o0(e,n);case on:case an:case cn:case un:case hn:case ln:case pn:case dn:case fn:return Su(e,n);case pt:return new h;case Xi:case tr:return new h(e);case er:return a0(e);case dt:return new h;case Ur:return c0(e)}}function P0(e,t){var n=t.length;if(!n)return e;var h=n-1;return t[h]=(n>1?"& ":"")+t[h],t=t.join(n>2?", ":" "),e.replace(Sy,`{
/* [wrapped with `+t+`] */
`)}function x0(e){return K(e)||fi(e)||!!(Wc&&e&&e[Wc])}function qt(e,t){var n=typeof e;return t=t??Ht,!!t&&(n=="number"||n!="symbol"&&jy.test(e))&&e>-1&&e%1==0&&e<t}function Me(e,t,n){if(!me(n))return!1;var h=typeof t;return(h=="number"?Be(n)&&qt(t,n.length):h=="string"&&t in n)?yt(n[t],e):!1}function co(e,t){if(K(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Xe(e)?!0:Ey.test(e)||!by.test(e)||t!=null&&e in ce(t)}function S0(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function uo(e){var t=ys(e),n=d[t];if(typeof n!="function"||!(t in Z.prototype))return!1;if(e===n)return!0;var h=no(n);return!!h&&e===h[0]}function R0(e){return!!Hc&&Hc in e}var O0=Br?$t:Ro;function yr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Fi;return e===n}function Hu(e){return e===e&&!me(e)}function Bu(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in ce(n))}}function N0(e){var t=Es(e,function(h){return n.size===x&&n.clear(),h}),n=t.cache;return t}function C0(e,t){var n=e[1],h=t[1],l=n|h,f=l<(W|ae|be),y=h==be&&n==ue||h==be&&n==Le&&e[7].length<=t[8]||h==(be|Le)&&t[7].length<=t[8]&&n==ue;if(!(f||y))return e;h&W&&(e[2]=t[2],l|=n&W?0:Ne);var v=t[3];if(v){var _=e[3];e[3]=_?Ou(_,v,t[4]):v,e[4]=_?Jt(e[3],N):t[4]}return v=t[5],v&&(_=e[5],e[5]=_?Nu(_,v,t[6]):v,e[6]=_?Jt(e[5],N):t[6]),v=t[7],v&&(e[7]=v),h&be&&(e[8]=e[8]==null?t[8]:Te(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function A0(e){var t=[];if(e!=null)for(var n in ce(e))t.push(n);return t}function D0(e){return Jr.call(e)}function Gu(e,t,n){return t=xe(t===r?e.length-1:t,0),function(){for(var h=arguments,l=-1,f=xe(h.length-t,0),y=E(f);++l<f;)y[l]=h[t+l];l=-1;for(var v=E(t+1);++l<t;)v[l]=h[l];return v[t]=n(y),Qe(e,this,v)}}function Ju(e,t){return t.length<2?e:li(e,ct(t,0,-1))}function F0(e,t){for(var n=e.length,h=Te(t.length,n),l=He(e);h--;){var f=t[h];e[h]=qt(f,n)?l[f]:r}return e}function ho(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Wu=Yu(mu),vr=Jv||function(e,t){return Ce.setTimeout(e,t)},lo=Yu(i0);function Qu(e,t,n){var h=t+"";return lo(e,P0(h,T0(b0(h),n)))}function Yu(e){var t=0,n=0;return function(){var h=Zv(),l=ty-(h-n);if(n=h,l>0){if(++t>=ey)return arguments[0]}else t=0;return e.apply(r,arguments)}}function ms(e,t){var n=-1,h=e.length,l=h-1;for(t=t===r?h:t;++n<t;){var f=Gn(n,l),y=e[f];e[f]=e[n],e[n]=y}return e.length=t,e}var Zu=N0(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Iy,function(n,h,l,f){t.push(l?f.replace(Ay,"$1"):h||n)}),t});function It(e){if(typeof e=="string"||Xe(e))return e;var t=e+"";return t=="0"&&1/e==-ni?"-0":t}function di(e){if(e!=null){try{return Gr.call(e)}catch{}try{return e+""}catch{}}return""}function T0(e,t){return st(ay,function(n){var h="_."+n[0];t&n[1]&&!kr(e,h)&&e.push(h)}),e.sort()}function Xu(e){if(e instanceof Z)return e.clone();var t=new ot(e.__wrapped__,e.__chain__);return t.__actions__=He(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function q0(e,t,n){(n?Me(e,t,n):t===r)?t=1:t=xe(H(t),0);var h=e==null?0:e.length;if(!h||t<1)return[];for(var l=0,f=0,y=E(es(h/t));l<h;)y[f++]=ct(e,l,l+=t);return y}function $0(e){for(var t=-1,n=e==null?0:e.length,h=0,l=[];++t<n;){var f=e[t];f&&(l[h++]=f)}return l}function j0(){var e=arguments.length;if(!e)return[];for(var t=E(e-1),n=arguments[0],h=e;h--;)t[h-1]=arguments[h];return Gt(K(n)?He(n):[n],Ae(t,1))}var U0=J(function(e,t){return Ee(e)?lr(e,Ae(t,1,Ee,!0)):[]}),L0=J(function(e,t){var n=ut(t);return Ee(n)&&(n=r),Ee(e)?lr(e,Ae(t,1,Ee,!0),U(n,2)):[]}),z0=J(function(e,t){var n=ut(t);return Ee(n)&&(n=r),Ee(e)?lr(e,Ae(t,1,Ee,!0),r,n):[]});function M0(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:H(t),ct(e,t<0?0:t,h)):[]}function k0(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:H(t),t=h-t,ct(e,0,t<0?0:t)):[]}function V0(e,t){return e&&e.length?hs(e,U(t,3),!0,!0):[]}function K0(e,t){return e&&e.length?hs(e,U(t,3),!0):[]}function H0(e,t,n,h){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Me(e,t,n)&&(n=0,h=l),jm(e,t,n,h)):[]}function eh(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:H(n);return l<0&&(l=xe(h+l,0)),Vr(e,U(t,3),l)}function th(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h-1;return n!==r&&(l=H(n),l=n<0?xe(h+l,0):Te(l,h-1)),Vr(e,U(t,3),l,!0)}function ih(e){var t=e==null?0:e.length;return t?Ae(e,1):[]}function B0(e){var t=e==null?0:e.length;return t?Ae(e,ni):[]}function G0(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:H(t),Ae(e,t)):[]}function J0(e){for(var t=-1,n=e==null?0:e.length,h={};++t<n;){var l=e[t];h[l[0]]=l[1]}return h}function rh(e){return e&&e.length?e[0]:r}function W0(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=n==null?0:H(n);return l<0&&(l=xe(h+l,0)),Ni(e,t,l)}function Q0(e){var t=e==null?0:e.length;return t?ct(e,0,-1):[]}var Y0=J(function(e){var t=ye(e,Zn);return t.length&&t[0]===e[0]?kn(t):[]}),Z0=J(function(e){var t=ut(e),n=ye(e,Zn);return t===ut(n)?t=r:n.pop(),n.length&&n[0]===e[0]?kn(n,U(t,2)):[]}),X0=J(function(e){var t=ut(e),n=ye(e,Zn);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?kn(n,r,t):[]});function ew(e,t){return e==null?"":Qv.call(e,t)}function ut(e){var t=e==null?0:e.length;return t?e[t-1]:r}function tw(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var l=h;return n!==r&&(l=H(n),l=l<0?xe(h+l,0):Te(l,h-1)),t===t?Tv(e,t,l):Vr(e,jc,l,!0)}function iw(e,t){return e&&e.length?fu(e,H(t)):r}var rw=J(sh);function sh(e,t){return e&&e.length&&t&&t.length?Bn(e,t):e}function sw(e,t,n){return e&&e.length&&t&&t.length?Bn(e,t,U(n,2)):e}function nw(e,t,n){return e&&e.length&&t&&t.length?Bn(e,t,r,n):e}var ow=Tt(function(e,t){var n=e==null?0:e.length,h=Un(e,t);return vu(e,ye(t,function(l){return qt(l,n)?+l:l}).sort(Ru)),h});function aw(e,t){var n=[];if(!(e&&e.length))return n;var h=-1,l=[],f=e.length;for(t=U(t,3);++h<f;){var y=e[h];t(y,h,e)&&(n.push(y),l.push(h))}return vu(e,l),n}function po(e){return e==null?e:em.call(e)}function cw(e,t,n){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Me(e,t,n)?(t=0,n=h):(t=t==null?0:H(t),n=n===r?h:H(n)),ct(e,t,n)):[]}function uw(e,t){return us(e,t)}function hw(e,t,n){return Wn(e,t,U(n,2))}function lw(e,t){var n=e==null?0:e.length;if(n){var h=us(e,t);if(h<n&&yt(e[h],t))return h}return-1}function pw(e,t){return us(e,t,!0)}function dw(e,t,n){return Wn(e,t,U(n,2),!0)}function fw(e,t){var n=e==null?0:e.length;if(n){var h=us(e,t,!0)-1;if(yt(e[h],t))return h}return-1}function gw(e){return e&&e.length?wu(e):[]}function yw(e,t){return e&&e.length?wu(e,U(t,2)):[]}function vw(e){var t=e==null?0:e.length;return t?ct(e,1,t):[]}function mw(e,t,n){return e&&e.length?(t=n||t===r?1:H(t),ct(e,0,t<0?0:t)):[]}function ww(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===r?1:H(t),t=h-t,ct(e,t<0?0:t,h)):[]}function _w(e,t){return e&&e.length?hs(e,U(t,3),!1,!0):[]}function bw(e,t){return e&&e.length?hs(e,U(t,3)):[]}var Ew=J(function(e){return Yt(Ae(e,1,Ee,!0))}),Iw=J(function(e){var t=ut(e);return Ee(t)&&(t=r),Yt(Ae(e,1,Ee,!0),U(t,2))}),Pw=J(function(e){var t=ut(e);return t=typeof t=="function"?t:r,Yt(Ae(e,1,Ee,!0),r,t)});function xw(e){return e&&e.length?Yt(e):[]}function Sw(e,t){return e&&e.length?Yt(e,U(t,2)):[]}function Rw(e,t){return t=typeof t=="function"?t:r,e&&e.length?Yt(e,r,t):[]}function fo(e){if(!(e&&e.length))return[];var t=0;return e=Bt(e,function(n){if(Ee(n))return t=xe(n.length,t),!0}),Cn(t,function(n){return ye(e,Rn(n))})}function nh(e,t){if(!(e&&e.length))return[];var n=fo(e);return t==null?n:ye(n,function(h){return Qe(t,r,h)})}var Ow=J(function(e,t){return Ee(e)?lr(e,t):[]}),Nw=J(function(e){return Yn(Bt(e,Ee))}),Cw=J(function(e){var t=ut(e);return Ee(t)&&(t=r),Yn(Bt(e,Ee),U(t,2))}),Aw=J(function(e){var t=ut(e);return t=typeof t=="function"?t:r,Yn(Bt(e,Ee),r,t)}),Dw=J(fo);function Fw(e,t){return Iu(e||[],t||[],hr)}function Tw(e,t){return Iu(e||[],t||[],fr)}var qw=J(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,nh(e,n)});function oh(e){var t=d(e);return t.__chain__=!0,t}function $w(e,t){return t(e),e}function ws(e,t){return t(e)}var jw=Tt(function(e){var t=e.length,n=t?e[0]:0,h=this.__wrapped__,l=function(f){return Un(f,e)};return t>1||this.__actions__.length||!(h instanceof Z)||!qt(n)?this.thru(l):(h=h.slice(n,+n+(t?1:0)),h.__actions__.push({func:ws,args:[l],thisArg:r}),new ot(h,this.__chain__).thru(function(f){return t&&!f.length&&f.push(r),f}))});function Uw(){return oh(this)}function Lw(){return new ot(this.value(),this.__chain__)}function zw(){this.__values__===r&&(this.__values__=_h(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Mw(){return this}function kw(e){for(var t,n=this;n instanceof ss;){var h=Xu(n);h.__index__=0,h.__values__=r,t?l.__wrapped__=h:t=h;var l=h;n=n.__wrapped__}return l.__wrapped__=e,t}function Vw(){var e=this.__wrapped__;if(e instanceof Z){var t=e;return this.__actions__.length&&(t=new Z(this)),t=t.reverse(),t.__actions__.push({func:ws,args:[po],thisArg:r}),new ot(t,this.__chain__)}return this.thru(po)}function Kw(){return Eu(this.__wrapped__,this.__actions__)}var Hw=ls(function(e,t,n){oe.call(e,n)?++e[n]:Dt(e,n,1)});function Bw(e,t,n){var h=K(e)?qc:$m;return n&&Me(e,t,n)&&(t=r),h(e,U(t,3))}function Gw(e,t){var n=K(e)?Bt:nu;return n(e,U(t,3))}var Jw=Fu(eh),Ww=Fu(th);function Qw(e,t){return Ae(_s(e,t),1)}function Yw(e,t){return Ae(_s(e,t),ni)}function Zw(e,t,n){return n=n===r?1:H(n),Ae(_s(e,t),n)}function ah(e,t){var n=K(e)?st:Qt;return n(e,U(t,3))}function ch(e,t){var n=K(e)?vv:su;return n(e,U(t,3))}var Xw=ls(function(e,t,n){oe.call(e,n)?e[n].push(t):Dt(e,n,[t])});function e_(e,t,n,h){e=Be(e)?e:Mi(e),n=n&&!h?H(n):0;var l=e.length;return n<0&&(n=xe(l+n,0)),xs(e)?n<=l&&e.indexOf(t,n)>-1:!!l&&Ni(e,t,n)>-1}var t_=J(function(e,t,n){var h=-1,l=typeof t=="function",f=Be(e)?E(e.length):[];return Qt(e,function(y){f[++h]=l?Qe(t,y,n):pr(y,t,n)}),f}),i_=ls(function(e,t,n){Dt(e,n,t)});function _s(e,t){var n=K(e)?ye:lu;return n(e,U(t,3))}function r_(e,t,n,h){return e==null?[]:(K(t)||(t=t==null?[]:[t]),n=h?r:n,K(n)||(n=n==null?[]:[n]),gu(e,t,n))}var s_=ls(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function n_(e,t,n){var h=K(e)?xn:Lc,l=arguments.length<3;return h(e,U(t,4),n,l,Qt)}function o_(e,t,n){var h=K(e)?mv:Lc,l=arguments.length<3;return h(e,U(t,4),n,l,su)}function a_(e,t){var n=K(e)?Bt:nu;return n(e,Is(U(t,3)))}function c_(e){var t=K(e)?eu:e0;return t(e)}function u_(e,t,n){(n?Me(e,t,n):t===r)?t=1:t=H(t);var h=K(e)?Am:t0;return h(e,t)}function h_(e){var t=K(e)?Dm:r0;return t(e)}function l_(e){if(e==null)return 0;if(Be(e))return xs(e)?Ai(e):e.length;var t=qe(e);return t==pt||t==dt?e.size:Kn(e).length}function p_(e,t,n){var h=K(e)?Sn:s0;return n&&Me(e,t,n)&&(t=r),h(e,U(t,3))}var d_=J(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Me(e,t[0],t[1])?t=[]:n>2&&Me(t[0],t[1],t[2])&&(t=[t[0]]),gu(e,Ae(t,1),[])}),bs=Gv||function(){return Ce.Date.now()};function f_(e,t){if(typeof t!="function")throw new nt(g);return e=H(e),function(){if(--e<1)return t.apply(this,arguments)}}function uh(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,Ft(e,be,r,r,r,r,t)}function hh(e,t){var n;if(typeof t!="function")throw new nt(g);return e=H(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var go=J(function(e,t,n){var h=W;if(n.length){var l=Jt(n,Li(go));h|=G}return Ft(e,h,t,n,l)}),lh=J(function(e,t,n){var h=W|ae;if(n.length){var l=Jt(n,Li(lh));h|=G}return Ft(t,h,e,n,l)});function ph(e,t,n){t=n?r:t;var h=Ft(e,ue,r,r,r,r,r,t);return h.placeholder=ph.placeholder,h}function dh(e,t,n){t=n?r:t;var h=Ft(e,ie,r,r,r,r,r,t);return h.placeholder=dh.placeholder,h}function fh(e,t,n){var h,l,f,y,v,_,P=0,S=!1,R=!1,A=!0;if(typeof e!="function")throw new nt(g);t=ht(t)||0,me(n)&&(S=!!n.leading,R="maxWait"in n,f=R?xe(ht(n.maxWait)||0,t):f,A="trailing"in n?!!n.trailing:A);function T(Ie){var vt=h,Ut=l;return h=l=r,P=Ie,y=e.apply(Ut,vt),y}function z(Ie){return P=Ie,v=vr(Q,t),S?T(Ie):y}function B(Ie){var vt=Ie-_,Ut=Ie-P,Fh=t-vt;return R?Te(Fh,f-Ut):Fh}function M(Ie){var vt=Ie-_,Ut=Ie-P;return _===r||vt>=t||vt<0||R&&Ut>=f}function Q(){var Ie=bs();if(M(Ie))return te(Ie);v=vr(Q,B(Ie))}function te(Ie){return v=r,A&&h?T(Ie):(h=l=r,y)}function et(){v!==r&&Pu(v),P=0,h=_=l=v=r}function ke(){return v===r?y:te(bs())}function tt(){var Ie=bs(),vt=M(Ie);if(h=arguments,l=this,_=Ie,vt){if(v===r)return z(_);if(R)return Pu(v),v=vr(Q,t),T(_)}return v===r&&(v=vr(Q,t)),y}return tt.cancel=et,tt.flush=ke,tt}var g_=J(function(e,t){return ru(e,1,t)}),y_=J(function(e,t,n){return ru(e,ht(t)||0,n)});function v_(e){return Ft(e,Kt)}function Es(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new nt(g);var n=function(){var h=arguments,l=t?t.apply(this,h):h[0],f=n.cache;if(f.has(l))return f.get(l);var y=e.apply(this,h);return n.cache=f.set(l,y)||f,y};return n.cache=new(Es.Cache||At),n}Es.Cache=At;function Is(e){if(typeof e!="function")throw new nt(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function m_(e){return hh(2,e)}var w_=n0(function(e,t){t=t.length==1&&K(t[0])?ye(t[0],Ye(U())):ye(Ae(t,1),Ye(U()));var n=t.length;return J(function(h){for(var l=-1,f=Te(h.length,n);++l<f;)h[l]=t[l].call(this,h[l]);return Qe(e,this,h)})}),yo=J(function(e,t){var n=Jt(t,Li(yo));return Ft(e,G,r,t,n)}),gh=J(function(e,t){var n=Jt(t,Li(gh));return Ft(e,ge,r,t,n)}),__=Tt(function(e,t){return Ft(e,Le,r,r,r,t)});function b_(e,t){if(typeof e!="function")throw new nt(g);return t=t===r?t:H(t),J(e,t)}function E_(e,t){if(typeof e!="function")throw new nt(g);return t=t==null?0:xe(H(t),0),J(function(n){var h=n[t],l=Xt(n,0,t);return h&&Gt(l,h),Qe(e,this,l)})}function I_(e,t,n){var h=!0,l=!0;if(typeof e!="function")throw new nt(g);return me(n)&&(h="leading"in n?!!n.leading:h,l="trailing"in n?!!n.trailing:l),fh(e,t,{leading:h,maxWait:t,trailing:l})}function P_(e){return uh(e,1)}function x_(e,t){return yo(Xn(t),e)}function S_(){if(!arguments.length)return[];var e=arguments[0];return K(e)?e:[e]}function R_(e){return at(e,ne)}function O_(e,t){return t=typeof t=="function"?t:r,at(e,ne,t)}function N_(e){return at(e,O|ne)}function C_(e,t){return t=typeof t=="function"?t:r,at(e,O|ne,t)}function A_(e,t){return t==null||iu(e,t,Re(t))}function yt(e,t){return e===t||e!==e&&t!==t}var D_=gs(Mn),F_=gs(function(e,t){return e>=t}),fi=cu(function(){return arguments}())?cu:function(e){return we(e)&&oe.call(e,"callee")&&!Jc.call(e,"callee")},K=E.isArray,T_=Nc?Ye(Nc):km;function Be(e){return e!=null&&Ps(e.length)&&!$t(e)}function Ee(e){return we(e)&&Be(e)}function q_(e){return e===!0||e===!1||we(e)&&ze(e)==Yi}var ei=Wv||Ro,$_=Cc?Ye(Cc):Vm;function j_(e){return we(e)&&e.nodeType===1&&!mr(e)}function U_(e){if(e==null)return!0;if(Be(e)&&(K(e)||typeof e=="string"||typeof e.splice=="function"||ei(e)||zi(e)||fi(e)))return!e.length;var t=qe(e);if(t==pt||t==dt)return!e.size;if(yr(e))return!Kn(e).length;for(var n in e)if(oe.call(e,n))return!1;return!0}function L_(e,t){return dr(e,t)}function z_(e,t,n){n=typeof n=="function"?n:r;var h=n?n(e,t):r;return h===r?dr(e,t,r,n):!!h}function vo(e){if(!we(e))return!1;var t=ze(e);return t==$r||t==uy||typeof e.message=="string"&&typeof e.name=="string"&&!mr(e)}function M_(e){return typeof e=="number"&&Qc(e)}function $t(e){if(!me(e))return!1;var t=ze(e);return t==jr||t==rc||t==cy||t==ly}function yh(e){return typeof e=="number"&&e==H(e)}function Ps(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Ht}function me(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function we(e){return e!=null&&typeof e=="object"}var vh=Ac?Ye(Ac):Hm;function k_(e,t){return e===t||Vn(e,t,oo(t))}function V_(e,t,n){return n=typeof n=="function"?n:r,Vn(e,t,oo(t),n)}function K_(e){return mh(e)&&e!=+e}function H_(e){if(O0(e))throw new V(p);return uu(e)}function B_(e){return e===null}function G_(e){return e==null}function mh(e){return typeof e=="number"||we(e)&&ze(e)==Xi}function mr(e){if(!we(e)||ze(e)!=Nt)return!1;var t=Yr(e);if(t===null)return!0;var n=oe.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Gr.call(n)==Vv}var mo=Dc?Ye(Dc):Bm;function J_(e){return yh(e)&&e>=-Ht&&e<=Ht}var wh=Fc?Ye(Fc):Gm;function xs(e){return typeof e=="string"||!K(e)&&we(e)&&ze(e)==tr}function Xe(e){return typeof e=="symbol"||we(e)&&ze(e)==Ur}var zi=Tc?Ye(Tc):Jm;function W_(e){return e===r}function Q_(e){return we(e)&&qe(e)==ir}function Y_(e){return we(e)&&ze(e)==dy}var Z_=gs(Hn),X_=gs(function(e,t){return e<=t});function _h(e){if(!e)return[];if(Be(e))return xs(e)?ft(e):He(e);if(nr&&e[nr])return Av(e[nr]());var t=qe(e),n=t==pt?Dn:t==dt?Kr:Mi;return n(e)}function jt(e){if(!e)return e===0?e:0;if(e=ht(e),e===ni||e===-ni){var t=e<0?-1:1;return t*sy}return e===e?e:0}function H(e){var t=jt(e),n=t%1;return t===t?n?t-n:t:0}function bh(e){return e?hi(H(e),0,_t):0}function ht(e){if(typeof e=="number")return e;if(Xe(e))return Tr;if(me(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=me(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=zc(e);var n=Ty.test(e);return n||$y.test(e)?fv(e.slice(2),n?2:8):Fy.test(e)?Tr:+e}function Eh(e){return Et(e,Ge(e))}function e1(e){return e?hi(H(e),-Ht,Ht):e===0?e:0}function se(e){return e==null?"":Ze(e)}var t1=ji(function(e,t){if(yr(t)||Be(t)){Et(t,Re(t),e);return}for(var n in t)oe.call(t,n)&&hr(e,n,t[n])}),Ih=ji(function(e,t){Et(t,Ge(t),e)}),Ss=ji(function(e,t,n,h){Et(t,Ge(t),e,h)}),i1=ji(function(e,t,n,h){Et(t,Re(t),e,h)}),r1=Tt(Un);function s1(e,t){var n=$i(e);return t==null?n:tu(n,t)}var n1=J(function(e,t){e=ce(e);var n=-1,h=t.length,l=h>2?t[2]:r;for(l&&Me(t[0],t[1],l)&&(h=1);++n<h;)for(var f=t[n],y=Ge(f),v=-1,_=y.length;++v<_;){var P=y[v],S=e[P];(S===r||yt(S,Fi[P])&&!oe.call(e,P))&&(e[P]=f[P])}return e}),o1=J(function(e){return e.push(r,zu),Qe(Ph,r,e)});function a1(e,t){return $c(e,U(t,3),bt)}function c1(e,t){return $c(e,U(t,3),zn)}function u1(e,t){return e==null?e:Ln(e,U(t,3),Ge)}function h1(e,t){return e==null?e:ou(e,U(t,3),Ge)}function l1(e,t){return e&&bt(e,U(t,3))}function p1(e,t){return e&&zn(e,U(t,3))}function d1(e){return e==null?[]:as(e,Re(e))}function f1(e){return e==null?[]:as(e,Ge(e))}function wo(e,t,n){var h=e==null?r:li(e,t);return h===r?n:h}function g1(e,t){return e!=null&&Vu(e,t,Um)}function _o(e,t){return e!=null&&Vu(e,t,Lm)}var y1=qu(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Jr.call(t)),e[t]=n},Eo(Je)),v1=qu(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Jr.call(t)),oe.call(e,t)?e[t].push(n):e[t]=[n]},U),m1=J(pr);function Re(e){return Be(e)?Xc(e):Kn(e)}function Ge(e){return Be(e)?Xc(e,!0):Wm(e)}function w1(e,t){var n={};return t=U(t,3),bt(e,function(h,l,f){Dt(n,t(h,l,f),h)}),n}function _1(e,t){var n={};return t=U(t,3),bt(e,function(h,l,f){Dt(n,l,t(h,l,f))}),n}var b1=ji(function(e,t,n){cs(e,t,n)}),Ph=ji(function(e,t,n,h){cs(e,t,n,h)}),E1=Tt(function(e,t){var n={};if(e==null)return n;var h=!1;t=ye(t,function(f){return f=Zt(f,e),h||(h=f.length>1),f}),Et(e,so(e),n),h&&(n=at(n,O|q|ne,y0));for(var l=t.length;l--;)Qn(n,t[l]);return n});function I1(e,t){return xh(e,Is(U(t)))}var P1=Tt(function(e,t){return e==null?{}:Ym(e,t)});function xh(e,t){if(e==null)return{};var n=ye(so(e),function(h){return[h]});return t=U(t),yu(e,n,function(h,l){return t(h,l[0])})}function x1(e,t,n){t=Zt(t,e);var h=-1,l=t.length;for(l||(l=1,e=r);++h<l;){var f=e==null?r:e[It(t[h])];f===r&&(h=l,f=n),e=$t(f)?f.call(e):f}return e}function S1(e,t,n){return e==null?e:fr(e,t,n)}function R1(e,t,n,h){return h=typeof h=="function"?h:r,e==null?e:fr(e,t,n,h)}var Sh=Uu(Re),Rh=Uu(Ge);function O1(e,t,n){var h=K(e),l=h||ei(e)||zi(e);if(t=U(t,4),n==null){var f=e&&e.constructor;l?n=h?new f:[]:me(e)?n=$t(f)?$i(Yr(e)):{}:n={}}return(l?st:bt)(e,function(y,v,_){return t(n,y,v,_)}),n}function N1(e,t){return e==null?!0:Qn(e,t)}function C1(e,t,n){return e==null?e:bu(e,t,Xn(n))}function A1(e,t,n,h){return h=typeof h=="function"?h:r,e==null?e:bu(e,t,Xn(n),h)}function Mi(e){return e==null?[]:An(e,Re(e))}function D1(e){return e==null?[]:An(e,Ge(e))}function F1(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=ht(n),n=n===n?n:0),t!==r&&(t=ht(t),t=t===t?t:0),hi(ht(e),t,n)}function T1(e,t,n){return t=jt(t),n===r?(n=t,t=0):n=jt(n),e=ht(e),zm(e,t,n)}function q1(e,t,n){if(n&&typeof n!="boolean"&&Me(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=jt(e),t===r?(t=e,e=0):t=jt(t)),e>t){var h=e;e=t,t=h}if(n||e%1||t%1){var l=Yc();return Te(e+l*(t-e+dv("1e-"+((l+"").length-1))),t)}return Gn(e,t)}var $1=Ui(function(e,t,n){return t=t.toLowerCase(),e+(n?Oh(t):t)});function Oh(e){return bo(se(e).toLowerCase())}function Nh(e){return e=se(e),e&&e.replace(Uy,Sv).replace(rv,"")}function j1(e,t,n){e=se(e),t=Ze(t);var h=e.length;n=n===r?h:hi(H(n),0,h);var l=n;return n-=t.length,n>=0&&e.slice(n,l)==t}function U1(e){return e=se(e),e&&my.test(e)?e.replace(oc,Rv):e}function L1(e){return e=se(e),e&&Py.test(e)?e.replace(gn,"\\$&"):e}var z1=Ui(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),M1=Ui(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),k1=Du("toLowerCase");function V1(e,t,n){e=se(e),t=H(t);var h=t?Ai(e):0;if(!t||h>=t)return e;var l=(t-h)/2;return fs(ts(l),n)+e+fs(es(l),n)}function K1(e,t,n){e=se(e),t=H(t);var h=t?Ai(e):0;return t&&h<t?e+fs(t-h,n):e}function H1(e,t,n){e=se(e),t=H(t);var h=t?Ai(e):0;return t&&h<t?fs(t-h,n)+e:e}function B1(e,t,n){return n||t==null?t=0:t&&(t=+t),Xv(se(e).replace(yn,""),t||0)}function G1(e,t,n){return(n?Me(e,t,n):t===r)?t=1:t=H(t),Jn(se(e),t)}function J1(){var e=arguments,t=se(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var W1=Ui(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function Q1(e,t,n){return n&&typeof n!="number"&&Me(e,t,n)&&(t=n=r),n=n===r?_t:n>>>0,n?(e=se(e),e&&(typeof t=="string"||t!=null&&!mo(t))&&(t=Ze(t),!t&&Ci(e))?Xt(ft(e),0,n):e.split(t,n)):[]}var Y1=Ui(function(e,t,n){return e+(n?" ":"")+bo(t)});function Z1(e,t,n){return e=se(e),n=n==null?0:hi(H(n),0,e.length),t=Ze(t),e.slice(n,n+t.length)==t}function X1(e,t,n){var h=d.templateSettings;n&&Me(e,t,n)&&(t=r),e=se(e),t=Ss({},t,h,Lu);var l=Ss({},t.imports,h.imports,Lu),f=Re(l),y=An(l,f),v,_,P=0,S=t.interpolate||Lr,R="__p += '",A=Fn((t.escape||Lr).source+"|"+S.source+"|"+(S===ac?Dy:Lr).source+"|"+(t.evaluate||Lr).source+"|$","g"),T="//# sourceURL="+(oe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++cv+"]")+`
`;e.replace(A,function(M,Q,te,et,ke,tt){return te||(te=et),R+=e.slice(P,tt).replace(Ly,Ov),Q&&(v=!0,R+=`' +
__e(`+Q+`) +
'`),ke&&(_=!0,R+=`';
`+ke+`;
__p += '`),te&&(R+=`' +
((__t = (`+te+`)) == null ? '' : __t) +
'`),P=tt+M.length,M}),R+=`';
`;var z=oe.call(t,"variable")&&t.variable;if(!z)R=`with (obj) {
`+R+`
}
`;else if(Cy.test(z))throw new V(m);R=(_?R.replace(fy,""):R).replace(gy,"$1").replace(yy,"$1;"),R="function("+(z||"obj")+`) {
`+(z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(v?", __e = _.escape":"")+(_?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var B=Ah(function(){return re(f,T+"return "+R).apply(r,y)});if(B.source=R,vo(B))throw B;return B}function eb(e){return se(e).toLowerCase()}function tb(e){return se(e).toUpperCase()}function ib(e,t,n){if(e=se(e),e&&(n||t===r))return zc(e);if(!e||!(t=Ze(t)))return e;var h=ft(e),l=ft(t),f=Mc(h,l),y=kc(h,l)+1;return Xt(h,f,y).join("")}function rb(e,t,n){if(e=se(e),e&&(n||t===r))return e.slice(0,Kc(e)+1);if(!e||!(t=Ze(t)))return e;var h=ft(e),l=kc(h,ft(t))+1;return Xt(h,0,l).join("")}function sb(e,t,n){if(e=se(e),e&&(n||t===r))return e.replace(yn,"");if(!e||!(t=Ze(t)))return e;var h=ft(e),l=Mc(h,ft(t));return Xt(h,l).join("")}function nb(e,t){var n=Zg,h=Xg;if(me(t)){var l="separator"in t?t.separator:l;n="length"in t?H(t.length):n,h="omission"in t?Ze(t.omission):h}e=se(e);var f=e.length;if(Ci(e)){var y=ft(e);f=y.length}if(n>=f)return e;var v=n-Ai(h);if(v<1)return h;var _=y?Xt(y,0,v).join(""):e.slice(0,v);if(l===r)return _+h;if(y&&(v+=_.length-v),mo(l)){if(e.slice(v).search(l)){var P,S=_;for(l.global||(l=Fn(l.source,se(cc.exec(l))+"g")),l.lastIndex=0;P=l.exec(S);)var R=P.index;_=_.slice(0,R===r?v:R)}}else if(e.indexOf(Ze(l),v)!=v){var A=_.lastIndexOf(l);A>-1&&(_=_.slice(0,A))}return _+h}function ob(e){return e=se(e),e&&vy.test(e)?e.replace(nc,qv):e}var ab=Ui(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),bo=Du("toUpperCase");function Ch(e,t,n){return e=se(e),t=n?r:t,t===r?Cv(e)?Uv(e):bv(e):e.match(t)||[]}var Ah=J(function(e,t){try{return Qe(e,r,t)}catch(n){return vo(n)?n:new V(n)}}),cb=Tt(function(e,t){return st(t,function(n){n=It(n),Dt(e,n,go(e[n],e))}),e});function ub(e){var t=e==null?0:e.length,n=U();return e=t?ye(e,function(h){if(typeof h[1]!="function")throw new nt(g);return[n(h[0]),h[1]]}):[],J(function(h){for(var l=-1;++l<t;){var f=e[l];if(Qe(f[0],this,h))return Qe(f[1],this,h)}})}function hb(e){return qm(at(e,O))}function Eo(e){return function(){return e}}function lb(e,t){return e==null||e!==e?t:e}var pb=Tu(),db=Tu(!0);function Je(e){return e}function Io(e){return hu(typeof e=="function"?e:at(e,O))}function fb(e){return pu(at(e,O))}function gb(e,t){return du(e,at(t,O))}var yb=J(function(e,t){return function(n){return pr(n,e,t)}}),vb=J(function(e,t){return function(n){return pr(e,n,t)}});function Po(e,t,n){var h=Re(t),l=as(t,h);n==null&&!(me(t)&&(l.length||!h.length))&&(n=t,t=e,e=this,l=as(t,Re(t)));var f=!(me(n)&&"chain"in n)||!!n.chain,y=$t(e);return st(l,function(v){var _=t[v];e[v]=_,y&&(e.prototype[v]=function(){var P=this.__chain__;if(f||P){var S=e(this.__wrapped__),R=S.__actions__=He(this.__actions__);return R.push({func:_,args:arguments,thisArg:e}),S.__chain__=P,S}return _.apply(e,Gt([this.value()],arguments))})}),e}function mb(){return Ce._===this&&(Ce._=Kv),this}function xo(){}function wb(e){return e=H(e),J(function(t){return fu(t,e)})}var _b=to(ye),bb=to(qc),Eb=to(Sn);function Dh(e){return co(e)?Rn(It(e)):Zm(e)}function Ib(e){return function(t){return e==null?r:li(e,t)}}var Pb=$u(),xb=$u(!0);function So(){return[]}function Ro(){return!1}function Sb(){return{}}function Rb(){return""}function Ob(){return!0}function Nb(e,t){if(e=H(e),e<1||e>Ht)return[];var n=_t,h=Te(e,_t);t=U(t),e-=_t;for(var l=Cn(h,t);++n<e;)t(n);return l}function Cb(e){return K(e)?ye(e,It):Xe(e)?[e]:He(Zu(se(e)))}function Ab(e){var t=++kv;return se(e)+t}var Db=ds(function(e,t){return e+t},0),Fb=io("ceil"),Tb=ds(function(e,t){return e/t},1),qb=io("floor");function $b(e){return e&&e.length?os(e,Je,Mn):r}function jb(e,t){return e&&e.length?os(e,U(t,2),Mn):r}function Ub(e){return Uc(e,Je)}function Lb(e,t){return Uc(e,U(t,2))}function zb(e){return e&&e.length?os(e,Je,Hn):r}function Mb(e,t){return e&&e.length?os(e,U(t,2),Hn):r}var kb=ds(function(e,t){return e*t},1),Vb=io("round"),Kb=ds(function(e,t){return e-t},0);function Hb(e){return e&&e.length?Nn(e,Je):0}function Bb(e,t){return e&&e.length?Nn(e,U(t,2)):0}return d.after=f_,d.ary=uh,d.assign=t1,d.assignIn=Ih,d.assignInWith=Ss,d.assignWith=i1,d.at=r1,d.before=hh,d.bind=go,d.bindAll=cb,d.bindKey=lh,d.castArray=S_,d.chain=oh,d.chunk=q0,d.compact=$0,d.concat=j0,d.cond=ub,d.conforms=hb,d.constant=Eo,d.countBy=Hw,d.create=s1,d.curry=ph,d.curryRight=dh,d.debounce=fh,d.defaults=n1,d.defaultsDeep=o1,d.defer=g_,d.delay=y_,d.difference=U0,d.differenceBy=L0,d.differenceWith=z0,d.drop=M0,d.dropRight=k0,d.dropRightWhile=V0,d.dropWhile=K0,d.fill=H0,d.filter=Gw,d.flatMap=Qw,d.flatMapDeep=Yw,d.flatMapDepth=Zw,d.flatten=ih,d.flattenDeep=B0,d.flattenDepth=G0,d.flip=v_,d.flow=pb,d.flowRight=db,d.fromPairs=J0,d.functions=d1,d.functionsIn=f1,d.groupBy=Xw,d.initial=Q0,d.intersection=Y0,d.intersectionBy=Z0,d.intersectionWith=X0,d.invert=y1,d.invertBy=v1,d.invokeMap=t_,d.iteratee=Io,d.keyBy=i_,d.keys=Re,d.keysIn=Ge,d.map=_s,d.mapKeys=w1,d.mapValues=_1,d.matches=fb,d.matchesProperty=gb,d.memoize=Es,d.merge=b1,d.mergeWith=Ph,d.method=yb,d.methodOf=vb,d.mixin=Po,d.negate=Is,d.nthArg=wb,d.omit=E1,d.omitBy=I1,d.once=m_,d.orderBy=r_,d.over=_b,d.overArgs=w_,d.overEvery=bb,d.overSome=Eb,d.partial=yo,d.partialRight=gh,d.partition=s_,d.pick=P1,d.pickBy=xh,d.property=Dh,d.propertyOf=Ib,d.pull=rw,d.pullAll=sh,d.pullAllBy=sw,d.pullAllWith=nw,d.pullAt=ow,d.range=Pb,d.rangeRight=xb,d.rearg=__,d.reject=a_,d.remove=aw,d.rest=b_,d.reverse=po,d.sampleSize=u_,d.set=S1,d.setWith=R1,d.shuffle=h_,d.slice=cw,d.sortBy=d_,d.sortedUniq=gw,d.sortedUniqBy=yw,d.split=Q1,d.spread=E_,d.tail=vw,d.take=mw,d.takeRight=ww,d.takeRightWhile=_w,d.takeWhile=bw,d.tap=$w,d.throttle=I_,d.thru=ws,d.toArray=_h,d.toPairs=Sh,d.toPairsIn=Rh,d.toPath=Cb,d.toPlainObject=Eh,d.transform=O1,d.unary=P_,d.union=Ew,d.unionBy=Iw,d.unionWith=Pw,d.uniq=xw,d.uniqBy=Sw,d.uniqWith=Rw,d.unset=N1,d.unzip=fo,d.unzipWith=nh,d.update=C1,d.updateWith=A1,d.values=Mi,d.valuesIn=D1,d.without=Ow,d.words=Ch,d.wrap=x_,d.xor=Nw,d.xorBy=Cw,d.xorWith=Aw,d.zip=Dw,d.zipObject=Fw,d.zipObjectDeep=Tw,d.zipWith=qw,d.entries=Sh,d.entriesIn=Rh,d.extend=Ih,d.extendWith=Ss,Po(d,d),d.add=Db,d.attempt=Ah,d.camelCase=$1,d.capitalize=Oh,d.ceil=Fb,d.clamp=F1,d.clone=R_,d.cloneDeep=N_,d.cloneDeepWith=C_,d.cloneWith=O_,d.conformsTo=A_,d.deburr=Nh,d.defaultTo=lb,d.divide=Tb,d.endsWith=j1,d.eq=yt,d.escape=U1,d.escapeRegExp=L1,d.every=Bw,d.find=Jw,d.findIndex=eh,d.findKey=a1,d.findLast=Ww,d.findLastIndex=th,d.findLastKey=c1,d.floor=qb,d.forEach=ah,d.forEachRight=ch,d.forIn=u1,d.forInRight=h1,d.forOwn=l1,d.forOwnRight=p1,d.get=wo,d.gt=D_,d.gte=F_,d.has=g1,d.hasIn=_o,d.head=rh,d.identity=Je,d.includes=e_,d.indexOf=W0,d.inRange=T1,d.invoke=m1,d.isArguments=fi,d.isArray=K,d.isArrayBuffer=T_,d.isArrayLike=Be,d.isArrayLikeObject=Ee,d.isBoolean=q_,d.isBuffer=ei,d.isDate=$_,d.isElement=j_,d.isEmpty=U_,d.isEqual=L_,d.isEqualWith=z_,d.isError=vo,d.isFinite=M_,d.isFunction=$t,d.isInteger=yh,d.isLength=Ps,d.isMap=vh,d.isMatch=k_,d.isMatchWith=V_,d.isNaN=K_,d.isNative=H_,d.isNil=G_,d.isNull=B_,d.isNumber=mh,d.isObject=me,d.isObjectLike=we,d.isPlainObject=mr,d.isRegExp=mo,d.isSafeInteger=J_,d.isSet=wh,d.isString=xs,d.isSymbol=Xe,d.isTypedArray=zi,d.isUndefined=W_,d.isWeakMap=Q_,d.isWeakSet=Y_,d.join=ew,d.kebabCase=z1,d.last=ut,d.lastIndexOf=tw,d.lowerCase=M1,d.lowerFirst=k1,d.lt=Z_,d.lte=X_,d.max=$b,d.maxBy=jb,d.mean=Ub,d.meanBy=Lb,d.min=zb,d.minBy=Mb,d.stubArray=So,d.stubFalse=Ro,d.stubObject=Sb,d.stubString=Rb,d.stubTrue=Ob,d.multiply=kb,d.nth=iw,d.noConflict=mb,d.noop=xo,d.now=bs,d.pad=V1,d.padEnd=K1,d.padStart=H1,d.parseInt=B1,d.random=q1,d.reduce=n_,d.reduceRight=o_,d.repeat=G1,d.replace=J1,d.result=x1,d.round=Vb,d.runInContext=w,d.sample=c_,d.size=l_,d.snakeCase=W1,d.some=p_,d.sortedIndex=uw,d.sortedIndexBy=hw,d.sortedIndexOf=lw,d.sortedLastIndex=pw,d.sortedLastIndexBy=dw,d.sortedLastIndexOf=fw,d.startCase=Y1,d.startsWith=Z1,d.subtract=Kb,d.sum=Hb,d.sumBy=Bb,d.template=X1,d.times=Nb,d.toFinite=jt,d.toInteger=H,d.toLength=bh,d.toLower=eb,d.toNumber=ht,d.toSafeInteger=e1,d.toString=se,d.toUpper=tb,d.trim=ib,d.trimEnd=rb,d.trimStart=sb,d.truncate=nb,d.unescape=ob,d.uniqueId=Ab,d.upperCase=ab,d.upperFirst=bo,d.each=ah,d.eachRight=ch,d.first=rh,Po(d,function(){var e={};return bt(d,function(t,n){oe.call(d.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),d.VERSION=o,st(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),st(["drop","take"],function(e,t){Z.prototype[e]=function(n){n=n===r?1:xe(H(n),0);var h=this.__filtered__&&!t?new Z(this):this.clone();return h.__filtered__?h.__takeCount__=Te(n,h.__takeCount__):h.__views__.push({size:Te(n,_t),type:e+(h.__dir__<0?"Right":"")}),h},Z.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),st(["filter","map","takeWhile"],function(e,t){var n=t+1,h=n==ic||n==ry;Z.prototype[e]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:U(l,3),type:n}),f.__filtered__=f.__filtered__||h,f}}),st(["head","last"],function(e,t){var n="take"+(t?"Right":"");Z.prototype[e]=function(){return this[n](1).value()[0]}}),st(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");Z.prototype[e]=function(){return this.__filtered__?new Z(this):this[n](1)}}),Z.prototype.compact=function(){return this.filter(Je)},Z.prototype.find=function(e){return this.filter(e).head()},Z.prototype.findLast=function(e){return this.reverse().find(e)},Z.prototype.invokeMap=J(function(e,t){return typeof e=="function"?new Z(this):this.map(function(n){return pr(n,e,t)})}),Z.prototype.reject=function(e){return this.filter(Is(U(e)))},Z.prototype.slice=function(e,t){e=H(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Z(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=H(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},Z.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Z.prototype.toArray=function(){return this.take(_t)},bt(Z.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),h=/^(?:head|last)$/.test(t),l=d[h?"take"+(t=="last"?"Right":""):t],f=h||/^find/.test(t);l&&(d.prototype[t]=function(){var y=this.__wrapped__,v=h?[1]:arguments,_=y instanceof Z,P=v[0],S=_||K(y),R=function(Q){var te=l.apply(d,Gt([Q],v));return h&&A?te[0]:te};S&&n&&typeof P=="function"&&P.length!=1&&(_=S=!1);var A=this.__chain__,T=!!this.__actions__.length,z=f&&!A,B=_&&!T;if(!f&&S){y=B?y:new Z(this);var M=e.apply(y,v);return M.__actions__.push({func:ws,args:[R],thisArg:r}),new ot(M,A)}return z&&B?e.apply(this,v):(M=this.thru(R),z?h?M.value()[0]:M.value():M)})}),st(["pop","push","shift","sort","splice","unshift"],function(e){var t=Hr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",h=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var l=arguments;if(h&&!this.__chain__){var f=this.value();return t.apply(K(f)?f:[],l)}return this[n](function(y){return t.apply(K(y)?y:[],l)})}}),bt(Z.prototype,function(e,t){var n=d[t];if(n){var h=n.name+"";oe.call(qi,h)||(qi[h]=[]),qi[h].push({name:t,func:n})}}),qi[ps(r,ae).name]=[{name:"wrapper",func:r}],Z.prototype.clone=om,Z.prototype.reverse=am,Z.prototype.value=cm,d.prototype.at=jw,d.prototype.chain=Uw,d.prototype.commit=Lw,d.prototype.next=zw,d.prototype.plant=kw,d.prototype.reverse=Vw,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=Kw,d.prototype.first=d.prototype.head,nr&&(d.prototype[nr]=Mw),d},Di=Lv();oi?((oi.exports=Di)._=Di,En._=Di):Ce._=Di}).call(Qi)})(tn,tn.exports);var Ng=Object.defineProperty,Cg=Object.defineProperties,Ag=Object.getOwnPropertyDescriptors,Ja=Object.getOwnPropertySymbols,Dg=Object.prototype.hasOwnProperty,Fg=Object.prototype.propertyIsEnumerable,Wa=(u,s,r)=>s in u?Ng(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Ar=(u,s)=>{for(var r in s||(s={}))Dg.call(s,r)&&Wa(u,r,s[r]);if(Ja)for(var r of Ja(s))Fg.call(s,r)&&Wa(u,r,s[r]);return u},Tg=(u,s)=>Cg(u,Ag(s));function Vt(u,s,r){var o;const a=Fo(u);return((o=s.rpcMap)==null?void 0:o[a.reference])||`${Og}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function si(u){return u.includes(":")?u.split(":")[1]:u}function Qa(u){return u.map(s=>`${s.split(":")[0]}:${s.split(":")[1]}`)}function qg(u,s){const r=Object.keys(s.namespaces).filter(a=>a.includes(u));if(!r.length)return[];const o=[];return r.forEach(a=>{const p=s.namespaces[a].accounts;o.push(...p)}),o}function Ya(u={},s={}){const r=Za(u),o=Za(s);return tn.exports.merge(r,o)}function Za(u){var s,r,o,a;const p={};if(!Ii(u))return p;for(const[g,m]of Object.entries(u)){const b=Pr(g)?[g]:m.chains,x=m.methods||[],N=m.events||[],O=m.rpcMap||{},q=Ei(g);p[q]=Tg(Ar(Ar({},p[q]),m),{chains:mt(b,(s=p[q])==null?void 0:s.chains),methods:mt(x,(r=p[q])==null?void 0:r.methods),events:mt(N,(o=p[q])==null?void 0:o.events),rpcMap:Ar(Ar({},O),(a=p[q])==null?void 0:a.rpcMap)})}return p}function $g(u){return u.includes(":")?u.split(":")[2]:u}function jg(u){const s={};for(const[r,o]of Object.entries(u)){const a=o.methods||[],p=o.events||[],g=o.accounts||[],m=Pr(r)?[r]:o.chains?o.chains:Qa(o.accounts);s[r]={chains:m,methods:a,events:p,accounts:g}}return s}function rn(u){return typeof u=="number"?u:u.includes("0x")?parseInt(u,16):(u=u.includes(":")?u.split(":")[1]:u,isNaN(Number(u))?u:Number(u))}const Xa={},fe=u=>Xa[u],sn=(u,s)=>{Xa[u]=s};class Ug{constructor(s){this.name="polkadot",this.namespace=s.namespace,this.events=fe("events"),this.client=fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Ot.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=si(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Vt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Pt.r(new kt.Z(o,fe("disableProviderPing")))}}class Lg{constructor(s){this.name="eip155",this.namespace=s.namespace,this.events=fe("events"),this.client=fe("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(s){switch(s.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(s);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(s.request.method)?await this.client.request(s):this.getHttpProvider().request(s.request)}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(parseInt(s),r),this.chainId=parseInt(s),this.events.emit(Ot.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}createHttpProvider(s,r){const o=r||Vt(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Pt.r(new kt.k(o,fe("disableProviderPing")))}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=parseInt(si(r));s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const s=this.chainId,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}async handleSwitchChain(s){var r,o;let a=s.request.params?(r=s.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const p=parseInt(a,16);if(this.isChainApproved(p))this.setDefaultChain(`${p}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:s.topic,request:{method:s.request.method,params:[{chainId:a}]},chainId:(o=this.namespace.chains)==null?void 0:o[0]}),this.setDefaultChain(`${p}`);else throw new Error(`Failed to switch to chain 'eip155:${p}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(s){return this.namespace.chains.includes(`${this.name}:${s}`)}}class zg{constructor(s){this.name="solana",this.namespace=s.namespace,this.events=fe("events"),this.client=fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Ot.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=si(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Vt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Pt.r(new kt.Z(o,fe("disableProviderPing")))}}class Mg{constructor(s){this.name="cosmos",this.namespace=s.namespace,this.events=fe("events"),this.client=fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Ot.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=si(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Vt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Pt.r(new kt.Z(o,fe("disableProviderPing")))}}class kg{constructor(s){this.name="cip34",this.namespace=s.namespace,this.events=fe("events"),this.client=fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Ot.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{const o=this.getCardanoRPCUrl(r),a=si(r);s[a]=this.createHttpProvider(a,o)}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}getCardanoRPCUrl(s){const r=this.namespace.rpcMap;if(r)return r[s]}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||this.getCardanoRPCUrl(s);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Pt.r(new kt.Z(o,fe("disableProviderPing")))}}class Vg{constructor(s){this.name="elrond",this.namespace=s.namespace,this.events=fe("events"),this.client=fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Ot.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=si(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Vt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Pt.r(new kt.Z(o,fe("disableProviderPing")))}}class Kg{constructor(s){this.name="multiversx",this.namespace=s.namespace,this.events=fe("events"),this.client=fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Ot.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=si(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Vt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new Pt.r(new kt.Z(o,fe("disableProviderPing")))}}class Hg{constructor(s){this.name="near",this.namespace=s.namespace,this.events=fe("events"),this.client=fe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){if(this.chainId=s,!this.httpProviders[s]){const o=r||Vt(`${this.name}:${s}`,this.namespace);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,o)}this.events.emit(Ot.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;s[r]=this.createHttpProvider(r,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||Vt(s,this.namespace);return typeof o>"u"?void 0:new Pt.r(new kt.Z(o,fe("disableProviderPing")))}}var Bg=Object.defineProperty,Gg=Object.defineProperties,Jg=Object.getOwnPropertyDescriptors,ec=Object.getOwnPropertySymbols,Wg=Object.prototype.hasOwnProperty,Qg=Object.prototype.propertyIsEnumerable,tc=(u,s,r)=>s in u?Bg(u,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[s]=r,Dr=(u,s)=>{for(var r in s||(s={}))Wg.call(s,r)&&tc(u,r,s[r]);if(ec)for(var r of ec(s))Qg.call(s,r)&&tc(u,r,s[r]);return u},nn=(u,s)=>Gg(u,Jg(s));class Fr{constructor(s){this.events=new(Rs()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=s,this.logger=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ee.pino)((0,ee.getDefaultLoggerOptions)({level:(s==null?void 0:s.logger)||Ba})),this.disableProviderPing=(s==null?void 0:s.disableProviderPing)||!1}static async init(s){const r=new Fr(s);return await r.initialize(),r}async request(s,r,o){const[a,p]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:Dr({},s),chainId:`${a}:${p}`,topic:this.session.topic,expiry:o})}sendAsync(s,r,o,a){const p=new Date().getTime();this.request(s,o,a).then(g=>r(null,(0,Y.formatJsonRpcResult)(p,g))).catch(g=>r(g,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var s;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(s=this.session)==null?void 0:s.topic,reason:ve("USER_DISCONNECTED")}),await this.cleanup()}async connect(s){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(s),await this.cleanupPendingPairings(),!s.skipPairing)return await this.pair(s.pairingTopic)}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}removeListener(s,r){this.events.removeListener(s,r)}off(s,r){this.events.off(s,r)}get isWalletConnect(){return!0}async pair(s){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:o,approval:a}=await this.client.connect({pairingTopic:s,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});o&&(this.uri=o,this.events.emit("display_uri",o)),await a().then(p=>{this.session=p;const g=jg(p.namespaces);this.namespaces=Ya(this.namespaces,g),this.persist("namespaces",this.namespaces)}).catch(p=>{if(p.message!==Va)throw p;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(s,r){try{if(!this.session)return;const[o,a]=this.validateChain(s);this.getProvider(o).setDefaultChain(a,r)}catch(o){if(!/Please call connect/.test(o.message))throw o}}async cleanupPendingPairings(s={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(ri(r)){for(const o of r)s.deletePairings?this.client.core.expirer.set(o.topic,0):await this.client.core.relayer.subscriber.unsubscribe(o.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const s=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[s]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await en.init({logger:this.providerOpts.logger||Ba,relayUrl:this.providerOpts.relayUrl||xg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const s=[...new Set(Object.keys(this.session.namespaces).map(r=>Ei(r)))];sn("client",this.client),sn("events",this.events),sn("disableProviderPing",this.disableProviderPing),s.forEach(r=>{if(!this.session)return;const o=qg(r,this.session),a=Qa(o),p=Ya(this.namespaces,this.optionalNamespaces),g=nn(Dr({},p[r]),{accounts:o,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new Lg({namespace:g});break;case"solana":this.rpcProviders[r]=new zg({namespace:g});break;case"cosmos":this.rpcProviders[r]=new Mg({namespace:g});break;case"polkadot":this.rpcProviders[r]=new Ug({namespace:g});break;case"cip34":this.rpcProviders[r]=new kg({namespace:g});break;case"elrond":this.rpcProviders[r]=new Vg({namespace:g});break;case"multiversx":this.rpcProviders[r]=new Kg({namespace:g});break;case"near":this.rpcProviders[r]=new Hg({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",s=>{this.events.emit("session_ping",s)}),this.client.on("session_event",s=>{const{params:r}=s,{event:o}=r;if(o.name==="accountsChanged"){const a=o.data;a&&ri(a)&&this.events.emit("accountsChanged",a.map($g))}else if(o.name==="chainChanged"){const a=r.chainId,p=r.event.data,g=Ei(a),m=rn(a)!==rn(p)?`${g}:${rn(p)}`:a;this.onChainChanged(m)}else this.events.emit(o.name,o.data);this.events.emit("session_event",s)}),this.client.on("session_update",({topic:s,params:r})=>{var o;const{namespaces:a}=r,p=(o=this.client)==null?void 0:o.session.get(s);this.session=nn(Dr({},p),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:s,params:r})}),this.client.on("session_delete",async s=>{await this.cleanup(),this.events.emit("session_delete",s),this.events.emit("disconnect",nn(Dr({},ve("USER_DISCONNECTED")),{data:s.topic}))}),this.on(Ot.DEFAULT_CHAIN_CHANGED,s=>{this.onChainChanged(s,!0)})}getProvider(s){if(!this.rpcProviders[s])throw new Error(`Provider not found: ${s}`);return this.rpcProviders[s]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(s=>{var r;this.getProvider(s).updateNamespace((r=this.session)==null?void 0:r.namespaces[s])})}setNamespaces(s){const{namespaces:r,optionalNamespaces:o,sessionProperties:a}=s;r&&Object.keys(r).length&&(this.namespaces=r),o&&Object.keys(o).length&&(this.optionalNamespaces=o),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",o)}validateChain(s){const[r,o]=(s==null?void 0:s.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,o];if(r&&!Object.keys(this.namespaces||{}).map(g=>Ei(g)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&o)return[r,o];const a=Ei(Object.keys(this.namespaces)[0]),p=this.rpcProviders[a].getDefaultChain();return[a,p]}async requestAccounts(){const[s]=this.validateChain();return await this.getProvider(s).requestAccounts()}onChainChanged(s,r=!1){if(!this.namespaces)return;const[o,a]=this.validateChain(s);a&&(r||this.getProvider(o).setDefaultChain(a),this.namespaces[o]?this.namespaces[o].defaultChain=a:this.namespaces[`${o}:${a}`]?this.namespaces[`${o}:${a}`].defaultChain=a:this.namespaces[`${o}:${a}`]={defaultChain:a},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(s,r){this.client.core.storage.setItem(`${Ga}/${s}`,r)}async getFromStore(s){return await this.client.core.storage.getItem(`${Ga}/${s}`)}}const Yg=Fr}}]);
