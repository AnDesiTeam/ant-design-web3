"use strict";(self.webpackChunk_ant_design_web3_docs=self.webpackChunk_ant_design_web3_docs||[]).push([[6474],{26474:function(mE,kh,$){$.d(kh,{EthereumProvider:function(){return _m}});var xt=$(72100),Cs=$.n(xt),To=$(11541),Vh=$(45306),qo=$(4883),Os=$(76846),$o=$(9267),pe=$(5105),Kh=$(81365),j=$(46196),ki=$(73079),Hh=$(42669),_r=$(22501),Bh=$(35014),Ns=$(14224);const br=":";function jo(u){const[r,s]=u.split(br);return{namespace:r,reference:s}}function Gh(u){const{namespace:r,reference:s}=u;return[r,s].join(br)}function Uo(u){const[r,s,n]=u.split(br);return{namespace:r,reference:s,address:n}}function Jh(u){const{namespace:r,reference:s,address:n}=u;return[r,s,n].join(br)}function Lo(u,r){const s=[];return u.forEach(n=>{const a=r(n);s.includes(a)||s.push(a)}),s}function Wh(u){const{address:r}=Uo(u);return r}function Qh(u){const{namespace:r,reference:s}=Uo(u);return Gh({namespace:r,reference:s})}function vE(u,r){const{namespace:s,reference:n}=jo(r);return Jh({namespace:s,reference:n,address:u})}function yE(u){return Lo(u,Wh)}function Yh(u){return Lo(u,Qh)}function Zh(u,r=[]){const s=[];return Object.keys(u).forEach(n=>{if(r.length&&!r.includes(n))return;const a=u[n];s.push(...a.accounts)}),s}function wE(u,r=[]){const s=[];return Object.keys(u).forEach(n=>{if(r.length&&!r.includes(n))return;const a=u[n];s.push(...Yh(a.accounts))}),s}function _E(u,r=[]){const s=[];return Object.keys(u).forEach(n=>{if(r.length&&!r.includes(n))return;const a=u[n];s.push(...As(n,a))}),s}function As(u,r){return u.includes(":")?[u]:r.chains||[]}const Ds=u=>u==null?void 0:u.split(":"),Xh=u=>{const r=u&&Ds(u);if(r)return r[3]},bE=u=>{const r=u&&Ds(u);if(r)return r[2]+":"+r[3]},el=u=>{const r=u&&Ds(u);if(r)return r.pop()},EE=(u,r)=>{const s=`${u.domain} wants you to sign in with your Ethereum account:`,n=el(r),a=u.statement,l=`URI: ${u.aud}`,f=`Version: ${u.version}`,y=`Chain ID: ${Xh(r)}`,b=`Nonce: ${u.nonce}`,I=`Issued At: ${u.iat}`,C=u.resources&&u.resources.length>0?`Resources:
${u.resources.map(O=>`- ${O}`).join(`
`)}`:void 0;return[s,n,"",a,"",l,f,y,b,I,C].filter(O=>O!=null).join(`
`)},Mo="base10",$e="base16",Fs="base64pad",Ts="utf8",zo=0,ii=1,tl=0,ko=1,qs=12,$s=32;function il(){const u=$o.Au();return{privateKey:(0,pe.BB)(u.secretKey,$e),publicKey:(0,pe.BB)(u.publicKey,$e)}}function js(){const u=(0,qo.randomBytes)($s);return(0,pe.BB)(u,$e)}function rl(u,r){const s=$o.gi((0,pe.mL)(u,$e),(0,pe.mL)(r,$e),!0),n=new Vh.t(Os.mE,s).expand($s);return(0,pe.BB)(n,$e)}function sl(u){const r=(0,Os.vp)((0,pe.mL)(u,$e));return(0,pe.BB)(r,$e)}function gi(u){const r=(0,Os.vp)((0,pe.mL)(u,Ts));return(0,pe.BB)(r,$e)}function nl(u){return(0,pe.mL)(`${u}`,Mo)}function Vi(u){return Number((0,pe.BB)(u,Mo))}function ol(u){const r=nl(typeof u.type<"u"?u.type:zo);if(Vi(r)===ii&&typeof u.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const s=typeof u.senderPublicKey<"u"?(0,pe.mL)(u.senderPublicKey,$e):void 0,n=typeof u.iv<"u"?(0,pe.mL)(u.iv,$e):(0,qo.randomBytes)(qs),a=new To.OK((0,pe.mL)(u.symKey,$e)).seal(n,(0,pe.mL)(u.message,Ts));return cl({type:r,sealed:a,iv:n,senderPublicKey:s})}function al(u){const r=new To.OK((0,pe.mL)(u.symKey,$e)),{sealed:s,iv:n}=Er(u.encoded),a=r.open(n,s);if(a===null)throw new Error("Failed to decrypt");return(0,pe.BB)(a,Ts)}function cl(u){if(Vi(u.type)===ii){if(typeof u.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,pe.BB)((0,pe.zo)([u.type,u.senderPublicKey,u.iv,u.sealed]),Fs)}return(0,pe.BB)((0,pe.zo)([u.type,u.iv,u.sealed]),Fs)}function Er(u){const r=(0,pe.mL)(u,Fs),s=r.slice(tl,ko),n=ko;if(Vi(s)===ii){const y=n+$s,b=y+qs,I=r.slice(n,y),C=r.slice(y,b),O=r.slice(b);return{type:s,sealed:O,iv:C,senderPublicKey:I}}const a=n+qs,l=r.slice(n,a),f=r.slice(a);return{type:s,sealed:f,iv:l}}function ul(u,r){const s=Er(u);return Vo({type:Vi(s.type),senderPublicKey:typeof s.senderPublicKey<"u"?(0,pe.BB)(s.senderPublicKey,$e):void 0,receiverPublicKey:r==null?void 0:r.receiverPublicKey})}function Vo(u){const r=(u==null?void 0:u.type)||zo;if(r===ii){if(typeof(u==null?void 0:u.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(u==null?void 0:u.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:r,senderPublicKey:u==null?void 0:u.senderPublicKey,receiverPublicKey:u==null?void 0:u.receiverPublicKey}}function Ko(u){return u.type===ii&&typeof u.senderPublicKey=="string"&&typeof u.receiverPublicKey=="string"}var hl=Object.defineProperty,Ho=Object.getOwnPropertySymbols,ll=Object.prototype.hasOwnProperty,pl=Object.prototype.propertyIsEnumerable,Bo=(u,r,s)=>r in u?hl(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Go=(u,r)=>{for(var s in r||(r={}))ll.call(r,s)&&Bo(u,s,r[s]);if(Ho)for(var s of Ho(r))pl.call(r,s)&&Bo(u,s,r[s]);return u};const dl="ReactNative",Ve={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Us=" ",IE=":",fl="/",Jo=2,PE=1e3,gl="js";function Ls(){return typeof Ns<"u"&&typeof Ns.versions<"u"&&typeof Ns.versions.node<"u"}function mi(){return!(0,ki.getDocument)()&&!!(0,ki.getNavigator)()&&navigator.product===dl}function vi(){return!Ls()&&!!(0,ki.getNavigator)()&&!!(0,ki.getDocument)()}function yi(){return mi()?Ve.reactNative:Ls()?Ve.node:vi()?Ve.browser:Ve.unknown}function ml(){var u;try{return mi()&&typeof $.g<"u"&&typeof($.g==null?void 0:$.g.Application)<"u"?(u=$.g.Application)==null?void 0:u.applicationId:void 0}catch{return}}function vl(u,r){let s=_r.parse(u);return s=Go(Go({},s),r),u=_r.stringify(s),u}function yl(){return(0,Hh.D)()||{name:"",description:"",url:"",icons:[""]}}function xE(u,r){var s;const n=yi(),a={protocol:u,version:r,env:n};return n==="browser"&&(a.host=((s=he())==null?void 0:s.host)||"unknown"),a}function wl(){if(yi()===Ve.reactNative&&typeof $.g<"u"&&typeof($.g==null?void 0:$.g.Platform)<"u"){const{OS:s,Version:n}=$.g.Platform;return[s,n].join("-")}const u=(0,Kh.qY)();if(u===null)return"unknown";const r=u.os?u.os.replace(" ","").toLowerCase():"unknown";return u.type==="browser"?[r,u.name,u.version].join("-"):[r,u.version].join("-")}function _l(){var u;const r=yi();return r===Ve.browser?[r,((u=(0,ki.getLocation)())==null?void 0:u.host)||"unknown"].join(":"):r}function bl(u,r,s){const n=wl(),a=_l();return[[u,r].join("-"),[gl,s].join("-"),n,a].join("/")}function El({protocol:u,version:r,relayUrl:s,sdkVersion:n,auth:a,projectId:l,useOnCloseEvent:f,bundleId:y}){const b=s.split("?"),I=bl(u,r,n),C={auth:a,ua:I,projectId:l,useOnCloseEvent:f||void 0,origin:y||void 0},O=vl(b[1]||"",C);return b[0]+"?"+O}function SE(u){let r=(u.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const s=typeof r<"u"?u.split("://")[1]:u;return r=r==="wss"?"https":"http",[r,s].join("://")}function RE(u,r,s){if(!u[r]||typeof u[r]!==s)throw new Error(`Missing or invalid "${r}" param`)}function Il(u,r=Jo){return Pl(u.split(fl),r)}function CE(u){return Il(u).join(Us)}function ri(u,r){return u.filter(s=>r.includes(s)).length===u.length}function Pl(u,r=Jo){return u.slice(Math.max(u.length-r,0))}function Wo(u){return Object.fromEntries(u.entries())}function Qo(u){return new Map(Object.entries(u))}function OE(u,r){const s={};return Object.keys(u).forEach(n=>{s[n]=r(u[n])}),s}const NE=u=>u;function xl(u){return u.trim().replace(/^\w/,r=>r.toUpperCase())}function AE(u){return u.split(Us).map(r=>xl(r)).join(Us)}function wi(u=j.FIVE_MINUTES,r){const s=(0,j.toMiliseconds)(u||j.FIVE_MINUTES);let n,a,l;return{resolve:f=>{l&&n&&(clearTimeout(l),n(f))},reject:f=>{l&&a&&(clearTimeout(l),a(f))},done:()=>new Promise((f,y)=>{l=setTimeout(()=>{y(new Error(r))},s),n=f,a=y})}}function Ki(u,r,s){return new Promise(async(n,a)=>{const l=setTimeout(()=>a(new Error(s)),r);try{const f=await u;n(f)}catch(f){a(f)}clearTimeout(l)})}function Yo(u,r){if(typeof r=="string"&&r.startsWith(`${u}:`))return r;if(u.toLowerCase()==="topic"){if(typeof r!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${r}`}else if(u.toLowerCase()==="id"){if(typeof r!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${r}`}throw new Error(`Unknown expirer target type: ${u}`)}function Sl(u){return Yo("topic",u)}function Rl(u){return Yo("id",u)}function Zo(u){const[r,s]=u.split(":"),n={id:void 0,topic:void 0};if(r==="topic"&&typeof s=="string")n.topic=s;else if(r==="id"&&Number.isInteger(Number(s)))n.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${r}:${s}`);return n}function We(u,r){return(0,j.fromMiliseconds)((r||Date.now())+(0,j.toMiliseconds)(u))}function zt(u){return Date.now()>=(0,j.toMiliseconds)(u)}function _e(u,r){return`${u}${r?`:${r}`:""}`}function yt(u=[],r=[]){return[...new Set([...u,...r])]}async function Cl({id:u,topic:r,wcDeepLink:s}){try{if(!s)return;const n=typeof s=="string"?JSON.parse(s):s;let a=n==null?void 0:n.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const l=`${a}/wc?requestId=${u}&sessionTopic=${r}`,f=yi();f===Ve.browser?l.startsWith("https://")?window.open(l,"_blank","noreferrer noopener"):window.open(l,"_self","noreferrer noopener"):f===Ve.reactNative&&typeof($.g==null?void 0:$.g.Linking)<"u"&&await $.g.Linking.openURL(l)}catch(n){console.error(n)}}async function Ol(u,r){try{return await u.getItem(r)||(vi()?localStorage.getItem(r):void 0)}catch(s){console.error(s)}}const Nl="irn";function Ms(u){return(u==null?void 0:u.relay)||{protocol:Nl}}function Ir(u){const r=Bh.RELAY_JSONRPC[u];if(typeof r>"u")throw new Error(`Relay Protocol not supported: ${u}`);return r}var Al=Object.defineProperty,Dl=Object.defineProperties,Fl=Object.getOwnPropertyDescriptors,Xo=Object.getOwnPropertySymbols,Tl=Object.prototype.hasOwnProperty,ql=Object.prototype.propertyIsEnumerable,ea=(u,r,s)=>r in u?Al(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,$l=(u,r)=>{for(var s in r||(r={}))Tl.call(r,s)&&ea(u,s,r[s]);if(Xo)for(var s of Xo(r))ql.call(r,s)&&ea(u,s,r[s]);return u},jl=(u,r)=>Dl(u,Fl(r));function Ul(u,r="-"){const s={},n="relay"+r;return Object.keys(u).forEach(a=>{if(a.startsWith(n)){const l=a.replace(n,""),f=u[a];s[l]=f}}),s}function ta(u){u=u.includes("wc://")?u.replace("wc://",""):u,u=u.includes("wc:")?u.replace("wc:",""):u;const r=u.indexOf(":"),s=u.indexOf("?")!==-1?u.indexOf("?"):void 0,n=u.substring(0,r),a=u.substring(r+1,s).split("@"),l=typeof s<"u"?u.substring(s):"",f=_r.parse(l);return{protocol:n,topic:Ll(a[0]),version:parseInt(a[1],10),symKey:f.symKey,relay:Ul(f),expiryTimestamp:f.expiryTimestamp?parseInt(f.expiryTimestamp,10):void 0}}function Ll(u){return u.startsWith("//")?u.substring(2):u}function Ml(u,r="-"){const s="relay",n={};return Object.keys(u).forEach(a=>{const l=s+r+a;u[a]&&(n[l]=u[a])}),n}function zl(u){return`${u.protocol}:${u.topic}@${u.version}?`+_r.stringify(jl($l({symKey:u.symKey},Ml(u.relay)),{expiryTimestamp:u.expiryTimestamp}))}var kl=Object.defineProperty,Vl=Object.defineProperties,Kl=Object.getOwnPropertyDescriptors,ia=Object.getOwnPropertySymbols,Hl=Object.prototype.hasOwnProperty,Bl=Object.prototype.propertyIsEnumerable,ra=(u,r,s)=>r in u?kl(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Gl=(u,r)=>{for(var s in r||(r={}))Hl.call(r,s)&&ra(u,s,r[s]);if(ia)for(var s of ia(r))Bl.call(r,s)&&ra(u,s,r[s]);return u},Jl=(u,r)=>Vl(u,Kl(r));function _i(u){const r=[];return u.forEach(s=>{const[n,a]=s.split(":");r.push(`${n}:${a}`)}),r}function Wl(u){const r=[];return Object.values(u).forEach(s=>{r.push(..._i(s.accounts))}),r}function Ql(u,r){const s=[];return Object.values(u).forEach(n=>{_i(n.accounts).includes(r)&&s.push(...n.methods)}),s}function Yl(u,r){const s=[];return Object.values(u).forEach(n=>{_i(n.accounts).includes(r)&&s.push(...n.events)}),s}function DE(u,r){const s=Sr(u,r);if(s)throw new Error(s.message);const n={};for(const[a,l]of Object.entries(u))n[a]={methods:l.methods,events:l.events,chains:l.accounts.map(f=>`${f.split(":")[0]}:${f.split(":")[1]}`)};return n}function FE(u){const{proposal:{requiredNamespaces:r,optionalNamespaces:s={}},supportedNamespaces:n}=u,a=sa(r),l=sa(s),f={};Object.keys(n).forEach(I=>{const C=n[I].chains,O=n[I].methods,F=n[I].events,Q=n[I].accounts;C.forEach(T=>{if(!Q.some(k=>k.includes(T)))throw new Error(`No accounts provided for chain ${T} in namespace ${I}`)}),f[I]={chains:C,methods:O,events:F,accounts:Q}});const y=ks(r,f,"approve()");if(y)throw new Error(y.message);const b={};return!Object.keys(r).length&&!Object.keys(s).length?f:(Object.keys(a).forEach(I=>{const C=n[I].chains.filter(T=>{var k,W;return(W=(k=a[I])==null?void 0:k.chains)==null?void 0:W.includes(T)}),O=n[I].methods.filter(T=>{var k,W;return(W=(k=a[I])==null?void 0:k.methods)==null?void 0:W.includes(T)}),F=n[I].events.filter(T=>{var k,W;return(W=(k=a[I])==null?void 0:k.events)==null?void 0:W.includes(T)}),Q=C.map(T=>n[I].accounts.filter(k=>k.includes(`${T}:`))).flat();b[I]={chains:C,methods:O,events:F,accounts:Q}}),Object.keys(l).forEach(I=>{var C,O,F,Q,T,k;if(!n[I])return;const W=(O=(C=l[I])==null?void 0:C.chains)==null?void 0:O.filter(re=>n[I].chains.includes(re)),ae=n[I].methods.filter(re=>{var G,me;return(me=(G=l[I])==null?void 0:G.methods)==null?void 0:me.includes(re)}),Oe=n[I].events.filter(re=>{var G,me;return(me=(G=l[I])==null?void 0:G.events)==null?void 0:me.includes(re)}),ue=W==null?void 0:W.map(re=>n[I].accounts.filter(G=>G.includes(`${re}:`))).flat();b[I]={chains:yt((F=b[I])==null?void 0:F.chains,W),methods:yt((Q=b[I])==null?void 0:Q.methods,ae),events:yt((T=b[I])==null?void 0:T.events,Oe),accounts:yt((k=b[I])==null?void 0:k.accounts,ue)}}),b)}function Pr(u){return u.includes(":")}function bi(u){return Pr(u)?u.split(":")[0]:u}function sa(u){var r,s,n;const a={};if(!Ei(u))return a;for(const[l,f]of Object.entries(u)){const y=Pr(l)?[l]:f.chains,b=f.methods||[],I=f.events||[],C=bi(l);a[C]=Jl(Gl({},a[C]),{chains:yt(y,(r=a[C])==null?void 0:r.chains),methods:yt(b,(s=a[C])==null?void 0:s.methods),events:yt(I,(n=a[C])==null?void 0:n.events)})}return a}const Zl={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Xl={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function N(u,r){const{message:s,code:n}=Xl[u];return{message:r?`${s} ${r}`:s,code:n}}function fe(u,r){const{message:s,code:n}=Zl[u];return{message:r?`${s} ${r}`:s,code:n}}function wt(u,r){return Array.isArray(u)?typeof r<"u"&&u.length?u.every(r):!0:!1}function Ei(u){return Object.getPrototypeOf(u)===Object.prototype&&Object.keys(u).length}function je(u){return typeof u>"u"}function Se(u,r){return r&&je(u)?!0:typeof u=="string"&&!!u.trim().length}function zs(u,r){return r&&je(u)?!0:typeof u=="number"&&!isNaN(u)}function ep(u,r){const{requiredNamespaces:s}=r,n=Object.keys(u.namespaces),a=Object.keys(s);let l=!0;return ri(a,n)?(n.forEach(f=>{const{accounts:y,methods:b,events:I}=u.namespaces[f],C=_i(y),O=s[f];(!ri(As(f,O),C)||!ri(O.methods,b)||!ri(O.events,I))&&(l=!1)}),l):!1}function xr(u){return Se(u,!1)&&u.includes(":")?u.split(":").length===2:!1}function tp(u){if(Se(u,!1)&&u.includes(":")){const r=u.split(":");if(r.length===3){const s=r[0]+":"+r[1];return!!r[2]&&xr(s)}}return!1}function ip(u){if(Se(u,!1))try{return typeof new URL(u)<"u"}catch{return!1}return!1}function rp(u){var r;return(r=u==null?void 0:u.proposer)==null?void 0:r.publicKey}function sp(u){return u==null?void 0:u.topic}function np(u,r){let s=null;return Se(u==null?void 0:u.publicKey,!1)||(s=N("MISSING_OR_INVALID",`${r} controller public key should be a string`)),s}function na(u){let r=!0;return wt(u)?u.length&&(r=u.every(s=>Se(s,!1))):r=!1,r}function op(u,r,s){let n=null;return wt(r)&&r.length?r.forEach(a=>{n||xr(a)||(n=fe("UNSUPPORTED_CHAINS",`${s}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):xr(u)||(n=fe("UNSUPPORTED_CHAINS",`${s}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function ap(u,r,s){let n=null;return Object.entries(u).forEach(([a,l])=>{if(n)return;const f=op(a,As(a,l),`${r} ${s}`);f&&(n=f)}),n}function cp(u,r){let s=null;return wt(u)?u.forEach(n=>{s||tp(n)||(s=fe("UNSUPPORTED_ACCOUNTS",`${r}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):s=fe("UNSUPPORTED_ACCOUNTS",`${r}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s}function up(u,r){let s=null;return Object.values(u).forEach(n=>{if(s)return;const a=cp(n==null?void 0:n.accounts,`${r} namespace`);a&&(s=a)}),s}function hp(u,r){let s=null;return na(u==null?void 0:u.methods)?na(u==null?void 0:u.events)||(s=fe("UNSUPPORTED_EVENTS",`${r}, events should be an array of strings or empty array for no events`)):s=fe("UNSUPPORTED_METHODS",`${r}, methods should be an array of strings or empty array for no methods`),s}function oa(u,r){let s=null;return Object.values(u).forEach(n=>{if(s)return;const a=hp(n,`${r}, namespace`);a&&(s=a)}),s}function lp(u,r,s){let n=null;if(u&&Ei(u)){const a=oa(u,r);a&&(n=a);const l=ap(u,r,s);l&&(n=l)}else n=N("MISSING_OR_INVALID",`${r}, ${s} should be an object with data`);return n}function Sr(u,r){let s=null;if(u&&Ei(u)){const n=oa(u,r);n&&(s=n);const a=up(u,r);a&&(s=a)}else s=N("MISSING_OR_INVALID",`${r}, namespaces should be an object with data`);return s}function aa(u){return Se(u.protocol,!0)}function pp(u,r){let s=!1;return r&&!u?s=!0:u&&wt(u)&&u.length&&u.forEach(n=>{s=aa(n)}),s}function dp(u){return typeof u=="number"}function Ke(u){return typeof u<"u"&&typeof u!==null}function fp(u){return!(!u||typeof u!="object"||!u.code||!zs(u.code,!1)||!u.message||!Se(u.message,!1))}function gp(u){return!(je(u)||!Se(u.method,!1))}function mp(u){return!(je(u)||je(u.result)&&je(u.error)||!zs(u.id,!1)||!Se(u.jsonrpc,!1))}function vp(u){return!(je(u)||!Se(u.name,!1))}function ca(u,r){return!(!xr(r)||!Wl(u).includes(r))}function yp(u,r,s){return Se(s,!1)?Ql(u,r).includes(s):!1}function wp(u,r,s){return Se(s,!1)?Yl(u,r).includes(s):!1}function ks(u,r,s){let n=null;const a=_p(u),l=bp(r),f=Object.keys(a),y=Object.keys(l),b=ua(Object.keys(u)),I=ua(Object.keys(r)),C=b.filter(O=>!I.includes(O));return C.length&&(n=N("NON_CONFORMING_NAMESPACES",`${s} namespaces keys don't satisfy requiredNamespaces.
      Required: ${C.toString()}
      Received: ${Object.keys(r).toString()}`)),ri(f,y)||(n=N("NON_CONFORMING_NAMESPACES",`${s} namespaces chains don't satisfy required namespaces.
      Required: ${f.toString()}
      Approved: ${y.toString()}`)),Object.keys(r).forEach(O=>{if(!O.includes(":")||n)return;const F=_i(r[O].accounts);F.includes(O)||(n=N("NON_CONFORMING_NAMESPACES",`${s} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${F.toString()}`))}),f.forEach(O=>{n||(ri(a[O].methods,l[O].methods)?ri(a[O].events,l[O].events)||(n=N("NON_CONFORMING_NAMESPACES",`${s} namespaces events don't satisfy namespace events for ${O}`)):n=N("NON_CONFORMING_NAMESPACES",`${s} namespaces methods don't satisfy namespace methods for ${O}`))}),n}function _p(u){const r={};return Object.keys(u).forEach(s=>{var n;s.includes(":")?r[s]=u[s]:(n=u[s].chains)==null||n.forEach(a=>{r[a]={methods:u[s].methods,events:u[s].events}})}),r}function ua(u){return[...new Set(u.map(r=>r.includes(":")?r.split(":")[0]:r))]}function bp(u){const r={};return Object.keys(u).forEach(s=>{if(s.includes(":"))r[s]=u[s];else{const n=_i(u[s].accounts);n==null||n.forEach(a=>{r[a]={accounts:u[s].accounts.filter(l=>l.includes(`${a}:`)),methods:u[s].methods,events:u[s].events}})}}),r}function Ep(u,r){return zs(u,!1)&&u<=r.max&&u>=r.min}function ha(){const u=yi();return new Promise(r=>{switch(u){case Ve.browser:r(Ip());break;case Ve.reactNative:r(Pp());break;case Ve.node:r(xp());break;default:r(!0)}})}function Ip(){return vi()&&(navigator==null?void 0:navigator.onLine)}async function Pp(){if(mi()&&typeof $.g<"u"&&$.g!=null&&$.g.NetInfo){const u=await($.g==null?void 0:$.g.NetInfo.fetch());return u==null?void 0:u.isConnected}return!0}function xp(){return!0}function Sp(u){switch(yi()){case Ve.browser:Rp(u);break;case Ve.reactNative:Cp(u);break;case Ve.node:break}}function Rp(u){!mi()&&vi()&&(window.addEventListener("online",()=>u(!0)),window.addEventListener("offline",()=>u(!1)))}function Cp(u){var r;mi()&&typeof $.g<"u"&&$.g!=null&&$.g.NetInfo&&((r=$.g)==null||r.NetInfo.addEventListener(s=>u(s==null?void 0:s.isConnected)))}const Vs={};class Rr{static get(r){return Vs[r]}static set(r,s){Vs[r]=s}static delete(r){delete Vs[r]}}var Op=$(53070),Hi=$(37875),te=$(71315),Ii=$(36900);class Np extends Ii.q{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class TE{constructor(r,s,n){this.core=r,this.logger=s}}class Ap extends Ii.q{constructor(r,s){super(),this.core=r,this.logger=s,this.records=new Map}}class Dp{constructor(r,s){this.logger=r,this.core=s}}class Fp extends Ii.q{constructor(r,s){super(),this.relayer=r,this.logger=s}}class Tp extends Ii.q{constructor(r){super()}}class qp{constructor(r,s,n,a){this.core=r,this.logger=s,this.name=n}}class qE{constructor(){this.map=new Map}}class $p extends Ii.q{constructor(r,s){super(),this.relayer=r,this.logger=s}}class $E{constructor(r,s){this.core=r,this.logger=s}}class jp extends Ii.q{constructor(r,s){super(),this.core=r,this.logger=s}}class jE{constructor(r,s){this.logger=r,this.core=s}}class Up{constructor(r,s){this.projectId=r,this.logger=s}}class Lp{constructor(r,s){this.projectId=r,this.logger=s}}class UE extends null{constructor(){super()}}class Mp{constructor(r){this.opts=r,this.protocol="wc",this.version=2}}class LE extends null{constructor(){super()}}class zp{constructor(r){this.client=r}}var la=$(41926),Cr=$(88614),St=$(83102),Z=$(23700),kp=$(66865),Vp=$(5899),Kp=$.n(Vp),Hp=$(51538),Bp=$.n(Hp);function Gp(u,r){if(u.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),n=0;n<s.length;n++)s[n]=255;for(var a=0;a<u.length;a++){var l=u.charAt(a),f=l.charCodeAt(0);if(s[f]!==255)throw new TypeError(l+" is ambiguous");s[f]=a}var y=u.length,b=u.charAt(0),I=Math.log(y)/Math.log(256),C=Math.log(256)/Math.log(y);function O(T){if(T instanceof Uint8Array||(ArrayBuffer.isView(T)?T=new Uint8Array(T.buffer,T.byteOffset,T.byteLength):Array.isArray(T)&&(T=Uint8Array.from(T))),!(T instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(T.length===0)return"";for(var k=0,W=0,ae=0,Oe=T.length;ae!==Oe&&T[ae]===0;)ae++,k++;for(var ue=(Oe-ae)*C+1>>>0,re=new Uint8Array(ue);ae!==Oe;){for(var G=T[ae],me=0,be=ue-1;(G!==0||me<W)&&be!==-1;be--,me++)G+=256*re[be]>>>0,re[be]=G%y>>>0,G=G/y>>>0;if(G!==0)throw new Error("Non-zero carry");W=me,ae++}for(var Le=ue-W;Le!==ue&&re[Le]===0;)Le++;for(var Ht=b.repeat(k);Le<ue;++Le)Ht+=u.charAt(re[Le]);return Ht}function F(T){if(typeof T!="string")throw new TypeError("Expected String");if(T.length===0)return new Uint8Array;var k=0;if(T[k]!==" "){for(var W=0,ae=0;T[k]===b;)W++,k++;for(var Oe=(T.length-k)*I+1>>>0,ue=new Uint8Array(Oe);T[k];){var re=s[T.charCodeAt(k)];if(re===255)return;for(var G=0,me=Oe-1;(re!==0||G<ae)&&me!==-1;me--,G++)re+=y*ue[me]>>>0,ue[me]=re%256>>>0,re=re/256>>>0;if(re!==0)throw new Error("Non-zero carry");ae=G,k++}if(T[k]!==" "){for(var be=Oe-ae;be!==Oe&&ue[be]===0;)be++;for(var Le=new Uint8Array(W+(Oe-be)),Ht=W;be!==Oe;)Le[Ht++]=ue[be++];return Le}}}function Q(T){var k=F(T);if(k)return k;throw new Error(`Non-${r} character`)}return{encode:O,decodeUnsafe:F,decode:Q}}var Jp=Gp,Wp=Jp;const pa=u=>{if(u instanceof Uint8Array&&u.constructor.name==="Uint8Array")return u;if(u instanceof ArrayBuffer)return new Uint8Array(u);if(ArrayBuffer.isView(u))return new Uint8Array(u.buffer,u.byteOffset,u.byteLength);throw new Error("Unknown type, must be binary type")},Qp=u=>new TextEncoder().encode(u),Yp=u=>new TextDecoder().decode(u);class Zp{constructor(r,s,n){this.name=r,this.prefix=s,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Xp{constructor(r,s,n){if(this.name=r,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return da(this,r)}}class ed{constructor(r){this.decoders=r}or(r){return da(this,r)}decode(r){const s=r[0],n=this.decoders[s];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const da=(u,r)=>new ed({...u.decoders||{[u.prefix]:u},...r.decoders||{[r.prefix]:r}});class td{constructor(r,s,n,a){this.name=r,this.prefix=s,this.baseEncode=n,this.baseDecode=a,this.encoder=new Zp(r,s,n),this.decoder=new Xp(r,s,a)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const Or=({name:u,prefix:r,encode:s,decode:n})=>new td(u,r,s,n),Bi=({prefix:u,name:r,alphabet:s})=>{const{encode:n,decode:a}=Wp(s,r);return Or({prefix:u,name:r,encode:n,decode:l=>pa(a(l))})},id=(u,r,s,n)=>{const a={};for(let C=0;C<r.length;++C)a[r[C]]=C;let l=u.length;for(;u[l-1]==="=";)--l;const f=new Uint8Array(l*s/8|0);let y=0,b=0,I=0;for(let C=0;C<l;++C){const O=a[u[C]];if(O===void 0)throw new SyntaxError(`Non-${n} character`);b=b<<s|O,y+=s,y>=8&&(y-=8,f[I++]=255&b>>y)}if(y>=s||255&b<<8-y)throw new SyntaxError("Unexpected end of data");return f},rd=(u,r,s)=>{const n=r[r.length-1]==="=",a=(1<<s)-1;let l="",f=0,y=0;for(let b=0;b<u.length;++b)for(y=y<<8|u[b],f+=8;f>s;)f-=s,l+=r[a&y>>f];if(f&&(l+=r[a&y<<s-f]),n)for(;l.length*s&7;)l+="=";return l},Ce=({name:u,prefix:r,bitsPerChar:s,alphabet:n})=>Or({prefix:r,name:u,encode(a){return rd(a,n,s)},decode(a){return id(a,n,s,u)}}),sd=Or({prefix:"\0",name:"identity",encode:u=>Yp(u),decode:u=>Qp(u)});var nd=Object.freeze({__proto__:null,identity:sd});const od=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ad=Object.freeze({__proto__:null,base2:od});const cd=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ud=Object.freeze({__proto__:null,base8:cd});const hd=Bi({prefix:"9",name:"base10",alphabet:"0123456789"});var ld=Object.freeze({__proto__:null,base10:hd});const pd=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),dd=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var fd=Object.freeze({__proto__:null,base16:pd,base16upper:dd});const gd=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),md=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),vd=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),yd=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wd=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_d=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bd=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ed=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Id=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Pd=Object.freeze({__proto__:null,base32:gd,base32upper:md,base32pad:vd,base32padupper:yd,base32hex:wd,base32hexupper:_d,base32hexpad:bd,base32hexpadupper:Ed,base32z:Id});const xd=Bi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Sd=Bi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Rd=Object.freeze({__proto__:null,base36:xd,base36upper:Sd});const Cd=Bi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Od=Bi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Nd=Object.freeze({__proto__:null,base58btc:Cd,base58flickr:Od});const Ad=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dd=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Fd=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Td=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var qd=Object.freeze({__proto__:null,base64:Ad,base64pad:Dd,base64url:Fd,base64urlpad:Td});const fa=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),$d=fa.reduce((u,r,s)=>(u[s]=r,u),[]),jd=fa.reduce((u,r,s)=>(u[r.codePointAt(0)]=s,u),[]);function Ud(u){return u.reduce((r,s)=>(r+=$d[s],r),"")}function Ld(u){const r=[];for(const s of u){const n=jd[s.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${s}`);r.push(n)}return new Uint8Array(r)}const Md=Or({prefix:"\u{1F680}",name:"base256emoji",encode:Ud,decode:Ld});var zd=Object.freeze({__proto__:null,base256emoji:Md}),kd=ma,ga=128,Vd=127,Kd=~Vd,Hd=Math.pow(2,31);function ma(u,r,s){r=r||[],s=s||0;for(var n=s;u>=Hd;)r[s++]=u&255|ga,u/=128;for(;u&Kd;)r[s++]=u&255|ga,u>>>=7;return r[s]=u|0,ma.bytes=s-n+1,r}var Bd=Ks,Gd=128,va=127;function Ks(u,n){var s=0,n=n||0,a=0,l=n,f,y=u.length;do{if(l>=y)throw Ks.bytes=0,new RangeError("Could not decode varint");f=u[l++],s+=a<28?(f&va)<<a:(f&va)*Math.pow(2,a),a+=7}while(f>=Gd);return Ks.bytes=l-n,s}var Jd=Math.pow(2,7),Wd=Math.pow(2,14),Qd=Math.pow(2,21),Yd=Math.pow(2,28),Zd=Math.pow(2,35),Xd=Math.pow(2,42),ef=Math.pow(2,49),tf=Math.pow(2,56),rf=Math.pow(2,63),sf=function(u){return u<Jd?1:u<Wd?2:u<Qd?3:u<Yd?4:u<Zd?5:u<Xd?6:u<ef?7:u<tf?8:u<rf?9:10},nf={encode:kd,decode:Bd,encodingLength:sf},ya=nf;const wa=(u,r,s=0)=>(ya.encode(u,r,s),r),_a=u=>ya.encodingLength(u),Hs=(u,r)=>{const s=r.byteLength,n=_a(u),a=n+_a(s),l=new Uint8Array(a+s);return wa(u,l,0),wa(s,l,n),l.set(r,a),new of(u,s,r,l)};class of{constructor(r,s,n,a){this.code=r,this.size=s,this.digest=n,this.bytes=a}}const ba=({name:u,code:r,encode:s})=>new af(u,r,s);class af{constructor(r,s,n){this.name=r,this.code=s,this.encode=n}digest(r){if(r instanceof Uint8Array){const s=this.encode(r);return s instanceof Uint8Array?Hs(this.code,s):s.then(n=>Hs(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Ea=u=>async r=>new Uint8Array(await crypto.subtle.digest(u,r)),cf=ba({name:"sha2-256",code:18,encode:Ea("SHA-256")}),uf=ba({name:"sha2-512",code:19,encode:Ea("SHA-512")});var hf=Object.freeze({__proto__:null,sha256:cf,sha512:uf});const Ia=0,lf="identity",Pa=pa;var pf=Object.freeze({__proto__:null,identity:{code:Ia,name:lf,encode:Pa,digest:u=>Hs(Ia,Pa(u))}});new TextEncoder,new TextDecoder;const xa={...nd,...ad,...ud,...ld,...fd,...Pd,...Rd,...Nd,...qd,...zd};({...hf,...pf});function Sa(u){return globalThis.Buffer!=null?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):u}function df(u=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Sa(globalThis.Buffer.allocUnsafe(u)):new Uint8Array(u)}function Ra(u,r,s,n){return{name:u,prefix:r,encoder:{name:u,prefix:r,encode:s},decoder:{decode:n}}}const Ca=Ra("utf8","u",u=>"u"+new TextDecoder("utf8").decode(u),u=>new TextEncoder().encode(u.substring(1))),Bs=Ra("ascii","a",u=>{let r="a";for(let s=0;s<u.length;s++)r+=String.fromCharCode(u[s]);return r},u=>{u=u.substring(1);const r=df(u.length);for(let s=0;s<u.length;s++)r[s]=u.charCodeAt(s);return r}),ff={utf8:Ca,"utf-8":Ca,hex:xa.base16,latin1:Bs,ascii:Bs,binary:Bs,...xa};function gf(u,r="utf8"){const s=ff[r];if(!s)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Sa(globalThis.Buffer.from(u,"utf-8")):s.decoder.decode(`${s.prefix}${u}`)}const Oa="wc",mf=2,Gs="core",kt=`${Oa}@2:${Gs}:`,vf={name:Gs,logger:"error"},yf={database:":memory:"},wf="crypto",Na="client_ed25519_seed",_f=j.ONE_DAY,bf="keychain",Ef="0.3",If="messages",Pf="0.3",xf=j.SIX_HOURS,Sf="publisher",Aa="irn",Rf="error",Da="wss://relay.walletconnect.com",Fa="wss://relay.walletconnect.org",Cf="relayer",De={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Of="_subscription",Rt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Nf=j.ONE_SECOND,kE={database:":memory:"},Af="2.11.1",Df=1e4,Ff="0.3",Tf="WALLETCONNECT_CLIENT_ID",lt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},VE=null,qf="subscription",$f="0.3",jf=j.FIVE_SECONDS*1e3,Uf="pairing",Lf="0.3",KE=null,Gi={wc_pairingDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.ONE_DAY,prompt:!1,tag:0}}},Ji={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},_t={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Mf="history",zf="0.3",kf="expirer",it={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Vf="0.3",HE=null,Js="verify-api",Pi="https://verify.walletconnect.com",Ws="https://verify.walletconnect.org",Kf=[Pi,Ws],Hf="echo",Bf="https://echo.walletconnect.com";class Gf{constructor(r,s){this.core=r,this.logger=s,this.keychain=new Map,this.name=bf,this.version=Ef,this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:l}=N("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(l)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=(0,te.generateChildLogger)(s,this.name)}get context(){return(0,te.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,Wo(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Qo(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Jf{constructor(r,s,n){this.core=r,this.logger=s,this.name=wf,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),l=Cr.generateKeyPair(a);return Cr.encodeIss(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=il();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const l=await this.getClientSeed(),f=Cr.generateKeyPair(l),y=js(),b=_f;return await Cr.signJWT(y,a,b,f)},this.generateSharedKey=(a,l,f)=>{this.isInitialized();const y=this.getPrivateKey(a),b=rl(y,l);return this.setSymKey(b,f)},this.setSymKey=async(a,l)=>{this.isInitialized();const f=l||sl(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,l,f)=>{this.isInitialized();const y=Vo(f),b=(0,la.u)(l);if(Ko(y)){const F=y.senderPublicKey,Q=y.receiverPublicKey;a=await this.generateSharedKey(F,Q)}const I=this.getSymKey(a),{type:C,senderPublicKey:O}=y;return ol({type:C,symKey:I,message:b,senderPublicKey:O})},this.decode=async(a,l,f)=>{this.isInitialized();const y=ul(l,f);if(Ko(y)){const b=y.receiverPublicKey,I=y.senderPublicKey;a=await this.generateSharedKey(b,I)}try{const b=this.getSymKey(a),I=al({symKey:b,encoded:l});return(0,la.D)(I)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}},this.getPayloadType=a=>{const l=Er(a);return Vi(l.type)},this.getPayloadSenderPublicKey=a=>{const l=Er(a);return l.senderPublicKey?(0,pe.BB)(l.senderPublicKey,$e):void 0},this.core=r,this.logger=(0,te.generateChildLogger)(s,this.name),this.keychain=n||new Gf(this.core,this.logger)}get context(){return(0,te.getLoggerContext)(this.logger)}async setPrivateKey(r,s){return await this.keychain.set(r,s),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(Na)}catch{r=js(),await this.keychain.set(Na,r)}return gf(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Wf extends Dp{constructor(r,s){super(r,s),this.logger=r,this.core=s,this.messages=new Map,this.name=If,this.version=Pf,this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const l=gi(a);let f=this.messages.get(n);return typeof f>"u"&&(f={}),typeof f[l]<"u"||(f[l]=a,this.messages.set(n,f),await this.persist()),l},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const l=this.get(n),f=gi(a);return typeof l[f]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=(0,te.generateChildLogger)(r,this.name),this.core=s}get context(){return(0,te.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,Wo(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Qo(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Qf extends Fp{constructor(r,s){super(r,s),this.relayer=r,this.logger=s,this.events=new xt.EventEmitter,this.name=Sf,this.queue=new Map,this.publishTimeout=(0,j.toMiliseconds)(j.TEN_SECONDS*2),this.needsTransportRestart=!1,this.publish=async(n,a,l)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:l}});try{const y=(l==null?void 0:l.ttl)||xf,b=Ms(l),I=(l==null?void 0:l.prompt)||!1,C=(l==null?void 0:l.tag)||0,O=(l==null?void 0:l.id)||(0,Z.getBigIntRpcId)().toString(),F={topic:n,message:a,opts:{ttl:y,relay:b,prompt:I,tag:C,id:O}},Q=setTimeout(()=>this.queue.set(O,F),this.publishTimeout);try{await await Ki(this.rpcPublish(n,a,y,b,I,C,O),this.publishTimeout,`Failed to publish payload, please try again. id:${O} tag:${C}`),this.removeRequestFromQueue(O),this.relayer.events.emit(De.publish,F)}catch(T){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=l==null?void 0:l.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(O),T;return}finally{clearTimeout(Q)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:l}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=r,this.logger=(0,te.generateChildLogger)(s,this.name),this.registerEventListeners()}get context(){return(0,te.getLoggerContext)(this.logger)}rpcPublish(r,s,n,a,l,f,y){var b,I,C,O;const F={method:Ir(a.protocol).publish,params:{topic:r,message:s,ttl:n,prompt:l,tag:f},id:y};return je((b=F.params)==null?void 0:b.prompt)&&((I=F.params)==null||delete I.prompt),je((C=F.params)==null?void 0:C.tag)&&((O=F.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:F}),this.relayer.request(F)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:s,message:n,opts:a}=r;await this.publish(s,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Hi.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(De.connection_stalled);return}this.checkQueue()}),this.relayer.on(De.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class Yf{constructor(){this.map=new Map,this.set=(r,s)=>{const n=this.get(r);this.exists(r,s)||this.map.set(r,[...n,s])},this.get=r=>this.map.get(r)||[],this.exists=(r,s)=>this.get(r).includes(s),this.delete=(r,s)=>{if(typeof s>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,s))return;const a=n.filter(l=>l!==s);if(!a.length){this.map.delete(r);return}this.map.set(r,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Zf=Object.defineProperty,Xf=Object.defineProperties,eg=Object.getOwnPropertyDescriptors,Ta=Object.getOwnPropertySymbols,tg=Object.prototype.hasOwnProperty,ig=Object.prototype.propertyIsEnumerable,qa=(u,r,s)=>r in u?Zf(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Wi=(u,r)=>{for(var s in r||(r={}))tg.call(r,s)&&qa(u,s,r[s]);if(Ta)for(var s of Ta(r))ig.call(r,s)&&qa(u,s,r[s]);return u},Qs=(u,r)=>Xf(u,eg(r));class rg extends $p{constructor(r,s){super(r,s),this.relayer=r,this.logger=s,this.subscriptions=new Map,this.topicMap=new Yf,this.events=new xt.EventEmitter,this.name=qf,this.version=$f,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=kt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const l=Ms(a),f={topic:n,relay:l};this.pending.set(n,f);const y=await this.rpcSubscribe(n,l);return this.onSubscribe(y,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),y}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>{if(this.topics.includes(n))return!0;const a=`${this.pendingSubscriptionWatchLabel}_${n}`;return await new Promise((l,f)=>{const y=new j.Watch;y.start(a);const b=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(b),y.stop(a),l(!0)),y.elapsed(a)>=jf&&(clearInterval(b),y.stop(a),f(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=(0,te.generateChildLogger)(s,this.name),this.clientId=""}get context(){return(0,te.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,s){let n=!1;try{n=this.getSubscription(r).topic===s}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,s){const n=this.topicMap.get(r);await Promise.all(n.map(async a=>await this.unsubscribeById(r,a,s)))}async unsubscribeById(r,s,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:s,opts:n}});try{const a=Ms(n);await this.rpcUnsubscribe(r,s,a);const l=fe("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,s,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:s,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(r,s){const n={method:Ir(s.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Ki(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(De.connection_stalled)}return gi(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const s=r[0].relay,n={method:Ir(s.protocol).batchSubscribe,params:{topics:r.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Ki(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(De.connection_stalled)}}rpcUnsubscribe(r,s,n){const a={method:Ir(n.protocol).unsubscribe,params:{topic:r,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(r,s){this.setSubscription(r,Qs(Wi({},s),{id:r})),this.pending.delete(s.topic)}onBatchSubscribe(r){r.length&&r.forEach(s=>{this.setSubscription(s.id,Wi({},s)),this.pending.delete(s.topic)})}async onUnsubscribe(r,s,n){this.events.removeAllListeners(s),this.hasSubscription(s,r)&&this.deleteSubscription(s,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,s){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:s}),this.addSubscription(r,s))}addSubscription(r,s){this.subscriptions.set(r,Wi({},s)),this.topicMap.set(s.topic,r),this.events.emit(lt.created,s)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const s=this.subscriptions.get(r);if(!s){const{message:n}=N("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return s}deleteSubscription(r,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:s});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(lt.deleted,Qs(Wi({},n),{reason:s}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(lt.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<r;s++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(lt.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:s}=N("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const s=await this.rpcBatchSubscribe(r);wt(s)&&this.onBatchSubscribe(s.map((n,a)=>Qs(Wi({},r[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(s=>{r.push(s)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(Hi.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(De.connect,async()=>{await this.onConnect()}),this.relayer.on(De.disconnect,()=>{this.onDisconnect()}),this.events.on(lt.created,async r=>{const s=lt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()}),this.events.on(lt.deleted,async r=>{const s=lt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const s=setInterval(()=>{this.restartInProgress||(clearInterval(s),r())},this.pollingInterval)})}}var sg=Object.defineProperty,$a=Object.getOwnPropertySymbols,ng=Object.prototype.hasOwnProperty,og=Object.prototype.propertyIsEnumerable,ja=(u,r,s)=>r in u?sg(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,ag=(u,r)=>{for(var s in r||(r={}))ng.call(r,s)&&ja(u,s,r[s]);if($a)for(var s of $a(r))og.call(r,s)&&ja(u,s,r[s]);return u};class cg extends Tp{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new xt.EventEmitter,this.name=Cf,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.request=async s=>{this.logger.debug("Publishing Request Payload");const n=s.id,a=this.provider.request(s);this.requestsInFlight.set(n,{promise:a,request:s});try{return await this.toEstablishConnection(),await a}catch(l){throw this.logger.debug("Failed to Publish Request"),this.logger.error(l),l}finally{this.requestsInFlight.delete(n)}},this.onPayloadHandler=s=>{this.onProviderPayload(s)},this.onConnectHandler=()=>{this.events.emit(De.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=s=>{this.logger.error(s),this.events.emit(De.error,s),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Rt.payload,this.onPayloadHandler),this.provider.on(Rt.connect,this.onConnectHandler),this.provider.on(Rt.disconnect,this.onDisconnectHandler),this.provider.on(Rt.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?(0,te.generateChildLogger)(r.logger,this.name):(0,te.pino)((0,te.getDefaultLoggerOptions)({level:r.logger||Rf})),this.messages=new Wf(this.logger,r.core),this.subscriber=new rg(this,this.logger),this.publisher=new Qf(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||Da,this.projectId=r.projectId,this.bundleId=ml(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Fa}...`),await this.restartTransport(Fa)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Df)}get context(){return(0,te.getLoggerContext)(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,s,n){this.isInitialized(),await this.publisher.publish(r,s,n),await this.recordMessageEvent({topic:r,message:s,publishedAt:Date.now()})}async subscribe(r,s){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";if(a)return a;let l;const f=y=>{y.topic===r&&(this.subscriber.off(lt.created,f),l())};return await Promise.all([new Promise(y=>{l=y,this.subscriber.on(lt.created,f)}),new Promise(async y=>{a=await this.subscriber.subscribe(r,s),y()})]),a}async unsubscribe(r,s){this.isInitialized(),await this.subscriber.unsubscribe(r,s)}on(r,s){this.events.on(r,s)}once(r,s){this.events.once(r,s)}off(r,s){this.events.off(r,s)}removeListener(r,s){this.events.removeListener(r,s)}async transportClose(){this.requestsInFlight.size>0&&(this.logger.debug("Waiting for all in-flight requests to finish before closing transport..."),this.requestsInFlight.forEach(async r=>{await r.promise})),this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Ki(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(s=>{if(!this.initialized)return s();this.subscriber.once(lt.resubscribed,()=>{s()})}),new Promise(async(s,n)=>{try{await Ki(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){n(a);return}s()})])}catch(s){this.logger.error(s);const n=s;if(!this.isConnectionStalled(n.message))throw s;this.provider.events.emit(Rt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await ha())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(s=>r.includes(s))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new St.r(new kp.Z(El({sdkVersion:Af,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:s,message:n}=r;await this.messages.set(s,n)}async shouldIgnoreMessageEvent(r){const{topic:s,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(s))return this.logger.debug(`Ignoring message for non-subscribed topic ${s}`),!0;const a=this.messages.has(s,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),(0,Z.isJsonRpcRequest)(r)){if(!r.method.endsWith(Of))return;const s=r.params,{topic:n,message:a,publishedAt:l}=s.data,f={topic:n,message:a,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ag({type:"event",event:s.id},f)),this.events.emit(s.id,f),await this.acknowledgePayload(r),await this.onMessageEvent(f)}else(0,Z.isJsonRpcResponse)(r)&&this.events.emit(De.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(De.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const s=(0,Z.formatJsonRpcResult)(r.id,!0);await this.provider.connection.send(s)}unregisterProviderListeners(){this.provider.off(Rt.payload,this.onPayloadHandler),this.provider.off(Rt.connect,this.onConnectHandler),this.provider.off(Rt.disconnect,this.onDisconnectHandler),this.provider.off(Rt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(De.connection_stalled,()=>{this.restartTransport().catch(s=>this.logger.error(s))});let r=await ha();Sp(async s=>{this.initialized&&r!==s&&(r=s,s?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(De.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},(0,j.toMiliseconds)(Nf)))}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const s=setInterval(()=>{this.connected&&(clearInterval(s),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var ug=Object.defineProperty,Ua=Object.getOwnPropertySymbols,hg=Object.prototype.hasOwnProperty,lg=Object.prototype.propertyIsEnumerable,La=(u,r,s)=>r in u?ug(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Ma=(u,r)=>{for(var s in r||(r={}))hg.call(r,s)&&La(u,s,r[s]);if(Ua)for(var s of Ua(r))lg.call(r,s)&&La(u,s,r[s]);return u};class Nr extends qp{constructor(r,s,n,a=kt,l=void 0){super(r,s,n,a),this.core=r,this.logger=s,this.name=n,this.map=new Map,this.version=Ff,this.cached=[],this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!je(f)?this.map.set(this.getKey(f),f):rp(f)?this.map.set(f.id,f):sp(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,y)=>{this.isInitialized(),this.map.has(f)?await this.update(f,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:y}),this.map.set(f,y),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(y=>Object.keys(f).every(b=>Kp()(y[b],f[b]))):this.values),this.update=async(f,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:y});const b=Ma(Ma({},this.getData(f)),y);this.map.set(f,b),await this.persist()},this.delete=async(f,y)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:y}),this.map.delete(f),await this.persist())},this.logger=(0,te.generateChildLogger)(s,this.name),this.storagePrefix=a,this.getKey=l}get context(){return(0,te.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const s=this.map.get(r);if(!s){const{message:n}=N("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return s}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:s}=N("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}}class pg{constructor(r,s){this.core=r,this.logger=s,this.name=Uf,this.version=Lf,this.events=new(Cs()),this.initialized=!1,this.storagePrefix=kt,this.ignoredPayloadTypes=[ii],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=js(),a=await this.core.crypto.setSymKey(n),l=We(j.FIVE_MINUTES),f={protocol:Aa},y={topic:a,expiry:l,relay:f,active:!1},b=zl({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:f,expiryTimestamp:l});return await this.pairings.set(a,y),await this.core.relayer.subscribe(a),this.core.expirer.set(a,l),{topic:a,uri:b}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:l,relay:f,expiryTimestamp:y}=ta(n.uri);let b;if(this.pairings.keys.includes(a)&&(b=this.pairings.get(a),b.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const I=y||We(j.FIVE_MINUTES),C={topic:a,relay:f,expiry:I,active:!1};return await this.pairings.set(a,C),this.core.expirer.set(a,I),n.activatePairing&&await this.activate({topic:a}),this.events.emit(Ji.create,C),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(l,a),await this.core.relayer.subscribe(a,{relay:f})),C},this.activate=async({topic:n})=>{this.isInitialized();const a=We(j.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const l=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:y,reject:b}=wi();this.events.once(_e("pairing_ping",l),({error:I})=>{I?b(I):y()}),await f()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",fe("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,l)=>{const f=(0,Z.formatJsonRpcRequest)(a,l),y=await this.core.crypto.encode(n,f),b=Gi[a].req;return this.core.history.set(n,f),this.core.relayer.publish(n,y,b),f.id},this.sendResult=async(n,a,l)=>{const f=(0,Z.formatJsonRpcResult)(n,l),y=await this.core.crypto.encode(a,f),b=await this.core.history.get(a,n),I=Gi[b.request.method].res;await this.core.relayer.publish(a,y,I),await this.core.history.resolve(f)},this.sendError=async(n,a,l)=>{const f=(0,Z.formatJsonRpcError)(n,l),y=await this.core.crypto.encode(a,f),b=await this.core.history.get(a,n),I=Gi[b.request.method]?Gi[b.request.method].res:Gi.unregistered_method.res;await this.core.relayer.publish(a,y,I),await this.core.history.resolve(f)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,fe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>zt(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:l}=n;switch(l.method){case"wc_pairingPing":return this.onPairingPingRequest(a,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,l);default:return this.onUnknownRpcMethodRequest(a,l)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:l}=n,f=(await this.core.history.get(a,l.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,l);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(n,a)=>{const{id:l}=a;try{this.isValidPing({topic:n}),await this.sendResult(l,n,!0),this.events.emit(Ji.ping,{id:l,topic:n})}catch(f){await this.sendError(l,n,f),this.logger.error(f)}},this.onPairingPingResponse=(n,a)=>{const{id:l}=a;setTimeout(()=>{(0,Z.isJsonRpcResult)(a)?this.events.emit(_e("pairing_ping",l),{}):(0,Z.isJsonRpcError)(a)&&this.events.emit(_e("pairing_ping",l),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:l}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Ji.delete,{id:l,topic:n})}catch(f){await this.sendError(l,n,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:l,method:f}=a;try{if(this.registeredMethods.includes(f))return;const y=fe("WC_METHOD_UNSUPPORTED",f);await this.sendError(l,n,y),this.logger.error(y)}catch(y){await this.sendError(l,n,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(fe("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var a;if(!Ke(n)){const{message:f}=N("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(f)}if(!ip(n.uri)){const{message:f}=N("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(f)}const l=ta(n.uri);if(!((a=l==null?void 0:l.relay)!=null&&a.protocol)){const{message:f}=N("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(l!=null&&l.symKey)){const{message:f}=N("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}if(l!=null&&l.expiryTimestamp&&(0,j.toMiliseconds)(l==null?void 0:l.expiryTimestamp)<Date.now()){const{message:f}=N("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(f)}},this.isValidPing=async n=>{if(!Ke(n)){const{message:l}=N("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(l)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!Ke(n)){const{message:l}=N("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(l)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!Se(n,!1)){const{message:a}=N("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=N("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(zt(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=N("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=r,this.logger=(0,te.generateChildLogger)(s,this.name),this.pairings=new Nr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,te.getLoggerContext)(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(De.message,async r=>{const{topic:s,message:n}=r;if(!this.pairings.keys.includes(s)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(s,n);try{(0,Z.isJsonRpcRequest)(a)?(this.core.history.set(s,a),this.onRelayEventRequest({topic:s,payload:a})):(0,Z.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:s,payload:a}),this.core.history.delete(s,a.id))}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(it.expired,async r=>{const{topic:s}=Zo(r.target);s&&this.pairings.keys.includes(s)&&(await this.deletePairing(s,!0),this.events.emit(Ji.expire,{topic:s}))})}}class dg extends Ap{constructor(r,s){super(r,s),this.core=r,this.logger=s,this.records=new Map,this.events=new xt.EventEmitter,this.name=Mf,this.version=zf,this.cached=[],this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:l}),this.records.has(a.id))return;const f={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:l,expiry:We(j.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(_t.created,f)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=(0,Z.isJsonRpcError)(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(_t.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(l=>{if(l.topic===n){if(typeof a<"u"&&l.id!==a)return;this.records.delete(l.id),this.events.emit(_t.deleted,l)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=(0,te.generateChildLogger)(s,this.name)}get context(){return(0,te.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;const n={topic:s.topic,request:(0,Z.formatJsonRpcRequest)(s.request.method,s.request.params,s.id),chainId:s.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const s=this.records.get(r);if(!s){const{message:n}=N("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return s}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(_t.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:s}=N("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(_t.created,r=>{const s=_t.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r}),this.persist()}),this.events.on(_t.updated,r=>{const s=_t.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r}),this.persist()}),this.events.on(_t.deleted,r=>{const s=_t.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r}),this.persist()}),this.core.heartbeat.on(Hi.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{(0,j.toMiliseconds)(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}}class fg extends jp{constructor(r,s){super(r,s),this.core=r,this.logger=s,this.expirations=new Map,this.events=new xt.EventEmitter,this.name=kf,this.version=Vf,this.cached=[],this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const l=this.formatTarget(n),f={target:l,expiry:a};this.expirations.set(l,f),this.checkExpiry(l,f),this.events.emit(it.created,{target:l,expiration:f})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),l=this.getExpiration(a);this.expirations.delete(a),this.events.emit(it.deleted,{target:a,expiration:l})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=(0,te.generateChildLogger)(s,this.name)}get context(){return(0,te.getLoggerContext)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return Sl(r);if(typeof r=="number")return Rl(r);const{message:s}=N("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(s)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(it.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:s}=N("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const s=this.expirations.get(r);if(!s){const{message:n}=N("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return s}checkExpiry(r,s){const{expiry:n}=s;(0,j.toMiliseconds)(n)-Date.now()<=0&&this.expire(r,s)}expire(r,s){this.expirations.delete(r),this.events.emit(it.expired,{target:r,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,s)=>this.checkExpiry(s,r))}registerEventListeners(){this.core.heartbeat.on(Hi.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(it.created,r=>{const s=it.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()}),this.events.on(it.expired,r=>{const s=it.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()}),this.events.on(it.deleted,r=>{const s=it.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}}}class gg extends Up{constructor(r,s){super(r,s),this.projectId=r,this.logger=s,this.name=Js,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||mi()||!vi())return;const a=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Ws;try{await this.createIframe()}catch(l){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(l),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let l;try{l=await this.fetchAttestation(n.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${a}`),this.logger.info(f),l=await this.fetchAttestation(n.attestationId,Ws)}return l},this.fetchAttestation=async(n,a)=>{this.logger.info(`resolving attestation: ${n} from url: ${a}`);const l=this.startAbortTimer(j.ONE_SECOND*2),f=await fetch(`${a}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(l),f.status===200?await f.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const a=l=>{l.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),n())};await Promise.race([new Promise(l=>{if(document.getElementById(Js))return l();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=Js,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,n=l}),new Promise((l,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},(0,j.toMiliseconds)(j.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let a=n||Pi;return Kf.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Pi}`),a=Pi),a},this.logger=(0,te.generateChildLogger)(s,this.name),this.verifyUrl=Pi,this.abortController=new AbortController,this.isDevEnv=Ls()&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST}get context(){return(0,te.getLoggerContext)(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,j.toMiliseconds)(r))}}class mg extends Lp{constructor(r,s){super(r,s),this.projectId=r,this.logger=s,this.context=Hf,this.registerDeviceToken=async n=>{const{clientId:a,token:l,notificationType:f,enableEncrypted:y=!1}=n,b=`${Bf}/${this.projectId}/clients`;await Bp()(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:f,token:l,always_raw:y})})},this.logger=(0,te.generateChildLogger)(s,this.context)}}var vg=Object.defineProperty,za=Object.getOwnPropertySymbols,yg=Object.prototype.hasOwnProperty,wg=Object.prototype.propertyIsEnumerable,ka=(u,r,s)=>r in u?vg(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Va=(u,r)=>{for(var s in r||(r={}))yg.call(r,s)&&ka(u,s,r[s]);if(za)for(var s of za(r))wg.call(r,s)&&ka(u,s,r[s]);return u};class Ys extends Np{constructor(r){super(r),this.protocol=Oa,this.version=mf,this.name=Gs,this.events=new xt.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||Da,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const s=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:(0,te.pino)((0,te.getDefaultLoggerOptions)({level:(r==null?void 0:r.logger)||vf.logger}));this.logger=(0,te.generateChildLogger)(s,this.name),this.heartbeat=new Hi.HeartBeat,this.crypto=new Jf(this,this.logger,r==null?void 0:r.keychain),this.history=new dg(this,this.logger),this.expirer=new fg(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new Op.Z(Va(Va({},yf),r==null?void 0:r.storageOptions)),this.relayer=new cg({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new pg(this,this.logger),this.verify=new gg(this.projectId||"",this.logger),this.echoClient=new mg(this.projectId||"",this.logger)}static async init(r){const s=new Ys(r);await s.initialize();const n=await s.crypto.getClientId();return await s.storage.setItem(Tf,n),s}get context(){return(0,te.getLoggerContext)(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const _g=Ys,Ka="wc",Ha=2,Ba="client",Zs=`${Ka}@${Ha}:${Ba}:`,Xs={name:Ba,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},BE={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_request_expire:"session_request_expire"},GE={database:":memory:"},Ga="WALLETCONNECT_DEEPLINK_CHOICE",JE={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},WE="history",QE="0.3",bg="proposal",YE=null,Ja="Proposal expired",Eg="session",Ar=j.SEVEN_DAYS,Ig="engine",Ct={wc_sessionPropose:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1104},res:{ttl:j.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1106},res:{ttl:j.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1112},res:{ttl:j.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1115}}},en={min:j.FIVE_MINUTES,max:j.SEVEN_DAYS},Ot={idle:"IDLE",active:"ACTIVE"},Pg="request",xg=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Sg=Object.defineProperty,Rg=Object.defineProperties,Cg=Object.getOwnPropertyDescriptors,Wa=Object.getOwnPropertySymbols,Og=Object.prototype.hasOwnProperty,Ng=Object.prototype.propertyIsEnumerable,Qa=(u,r,s)=>r in u?Sg(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Ue=(u,r)=>{for(var s in r||(r={}))Og.call(r,s)&&Qa(u,s,r[s]);if(Wa)for(var s of Wa(r))Ng.call(r,s)&&Qa(u,s,r[s]);return u},xi=(u,r)=>Rg(u,Cg(r));class Ag extends zp{constructor(r){super(r),this.name=Ig,this.events=new(Cs()),this.initialized=!1,this.ignoredPayloadTypes=[ii],this.requestQueue={state:Ot.idle,queue:[]},this.sessionRequestQueue={state:Ot.idle,queue:[]},this.requestQueueDelay=j.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ct)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,j.toMiliseconds)(this.requestQueueDelay)))},this.connect=async s=>{await this.isInitialized();const n=xi(Ue({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:l,optionalNamespaces:f,sessionProperties:y,relays:b}=n;let I=a,C,O=!1;if(I&&(O=this.client.core.pairing.pairings.get(I).active),!I||!O){const{topic:re,uri:G}=await this.client.core.pairing.create();I=re,C=G}const F=await this.client.core.crypto.generateKeyPair(),Q=Ct.wc_sessionPropose.req.ttl||j.FIVE_MINUTES,T=We(Q),k=Ue({requiredNamespaces:l,optionalNamespaces:f,relays:b??[{protocol:Aa}],proposer:{publicKey:F,metadata:this.client.metadata},expiryTimestamp:T},y&&{sessionProperties:y}),{reject:W,resolve:ae,done:Oe}=wi(Q,Ja);if(this.events.once(_e("session_connect"),async({error:re,session:G})=>{if(re)W(re);else if(G){G.self.publicKey=F;const me=xi(Ue({},G),{requiredNamespaces:k.requiredNamespaces,optionalNamespaces:k.optionalNamespaces});await this.client.session.set(G.topic,me),await this.setExpiry(G.topic,G.expiry),I&&await this.client.core.pairing.updateMetadata({topic:I,metadata:G.peer.metadata}),ae(me)}}),!I){const{message:re}=N("NO_MATCHING_KEY",`connect() pairing topic: ${I}`);throw new Error(re)}const ue=await this.sendRequest({topic:I,method:"wc_sessionPropose",params:k,throwOnFailedPublish:!0});return await this.setProposal(ue,Ue({id:ue},k)),{uri:C,approval:Oe}},this.pair=async s=>(await this.isInitialized(),await this.client.core.pairing.pair(s)),this.approve=async s=>{await this.isInitialized(),await this.isValidApprove(s);const{id:n,relayProtocol:a,namespaces:l,sessionProperties:f}=s,y=this.client.proposal.get(n);let{pairingTopic:b,proposer:I,requiredNamespaces:C,optionalNamespaces:O}=y;b=b||"";const F=await this.client.core.crypto.generateKeyPair(),Q=I.publicKey,T=await this.client.core.crypto.generateSharedKey(F,Q);b&&n&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:I.metadata}),await this.sendResult({id:n,topic:b,result:{relay:{protocol:a??"irn"},responderPublicKey:F}}),await this.client.proposal.delete(n,fe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const k=Ue({relay:{protocol:a??"irn"},namespaces:l,pairingTopic:b,controller:{publicKey:F,metadata:this.client.metadata},expiry:We(Ar)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(T);const W=xi(Ue({},k),{topic:T,requiredNamespaces:C,optionalNamespaces:O,pairingTopic:b,acknowledged:!1,self:k.controller,peer:{publicKey:I.publicKey,metadata:I.metadata},controller:F});await this.client.session.set(T,W);try{await this.sendRequest({topic:T,method:"wc_sessionSettle",params:k,throwOnFailedPublish:!0})}catch(ae){throw this.client.logger.error(ae),this.client.session.delete(T,fe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),ae}return await this.setExpiry(T,We(Ar)),{topic:T,acknowledged:()=>new Promise(ae=>setTimeout(()=>ae(this.client.session.get(T)),500))}},this.reject=async s=>{await this.isInitialized(),await this.isValidReject(s);const{id:n,reason:a}=s,{pairingTopic:l}=this.client.proposal.get(n);l&&(await this.sendError(n,l,a),await this.client.proposal.delete(n,fe("USER_DISCONNECTED")))},this.update=async s=>{await this.isInitialized(),await this.isValidUpdate(s);const{topic:n,namespaces:a}=s,l=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:y,reject:b}=wi();return this.events.once(_e("session_update",l),({error:I})=>{I?b(I):y()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:f}},this.extend=async s=>{await this.isInitialized(),await this.isValidExtend(s);const{topic:n}=s,a=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:l,resolve:f,reject:y}=wi();return this.events.once(_e("session_extend",a),({error:b})=>{b?y(b):f()}),await this.setExpiry(n,We(Ar)),{acknowledged:l}},this.request=async s=>{await this.isInitialized(),await this.isValidRequest(s);const{chainId:n,request:a,topic:l,expiry:f=Ct.wc_sessionRequest.req.ttl}=s,y=(0,Z.payloadId)(),{done:b,resolve:I,reject:C}=wi(f,"Request expired. Please try again.");return this.events.once(_e("session_request",y),({error:O,result:F})=>{O?C(O):I(F)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:y,topic:l,method:"wc_sessionRequest",params:{request:xi(Ue({},a),{expiryTimestamp:We(f)}),chainId:n},expiry:f,throwOnFailedPublish:!0}).catch(F=>C(F)),this.client.events.emit("session_request_sent",{topic:l,request:a,chainId:n,id:y}),O()}),new Promise(async O=>{const F=await Ol(this.client.core.storage,Ga);Cl({id:y,topic:l,wcDeepLink:F}),O()}),b()]).then(O=>O[2])},this.respond=async s=>{await this.isInitialized(),await this.isValidRespond(s);const{topic:n,response:a}=s,{id:l}=a;(0,Z.isJsonRpcResult)(a)?await this.sendResult({id:l,topic:n,result:a.result,throwOnFailedPublish:!0}):(0,Z.isJsonRpcError)(a)&&await this.sendError(l,n,a.error),this.cleanupAfterResponse(s)},this.ping=async s=>{await this.isInitialized(),await this.isValidPing(s);const{topic:n}=s;if(this.client.session.keys.includes(n)){const a=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:l,resolve:f,reject:y}=wi();this.events.once(_e("session_ping",a),({error:b})=>{b?y(b):f()}),await l()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async s=>{await this.isInitialized(),await this.isValidEmit(s);const{topic:n,event:a,chainId:l}=s;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:a,chainId:l}})},this.disconnect=async s=>{await this.isInitialized(),await this.isValidDisconnect(s);const{topic:n}=s;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:fe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:a}=N("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(a)}},this.find=s=>(this.isInitialized(),this.client.session.getAll().filter(n=>ep(n,s))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.cleanupDuplicatePairings=async s=>{if(s.pairingTopic)try{const n=this.client.core.pairing.pairings.get(s.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(l=>{var f,y;return((f=l.peerMetadata)==null?void 0:f.url)&&((y=l.peerMetadata)==null?void 0:y.url)===s.peer.metadata.url&&l.topic&&l.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async s=>{const{topic:n,expirerHasDeleted:a=!1,emitEvent:l=!0,id:f=0}=s,{self:y}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,fe("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(y.publicKey)&&await this.client.core.crypto.deleteKeyPair(y.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),a||this.client.core.expirer.del(n),this.client.core.storage.removeItem(Ga).catch(b=>this.client.logger.warn(b)),this.getPendingSessionRequests().forEach(b=>{b.topic===n&&this.deletePendingSessionRequest(b.id,fe("USER_DISCONNECTED"))}),l&&this.client.events.emit("session_delete",{id:f,topic:n})},this.deleteProposal=async(s,n)=>{await Promise.all([this.client.proposal.delete(s,fe("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(s)])},this.deletePendingSessionRequest=async(s,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(s,n),a?Promise.resolve():this.client.core.expirer.del(s)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(l=>l.id!==s),a&&(this.sessionRequestQueue.state=Ot.idle,this.client.events.emit("session_request_expire",{id:s}))},this.setExpiry=async(s,n)=>{this.client.session.keys.includes(s)&&await this.client.session.update(s,{expiry:n}),this.client.core.expirer.set(s,n)},this.setProposal=async(s,n)=>{await this.client.proposal.set(s,n),this.client.core.expirer.set(s,We(Ct.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async s=>{const{id:n,topic:a,params:l,verifyContext:f}=s,y=l.request.expiryTimestamp||We(Ct.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(n,{id:n,topic:a,params:l,verifyContext:f}),y&&this.client.core.expirer.set(n,y)},this.sendRequest=async s=>{const{topic:n,method:a,params:l,expiry:f,relayRpcId:y,clientRpcId:b,throwOnFailedPublish:I}=s,C=(0,Z.formatJsonRpcRequest)(a,l,b);if(vi()&&xg.includes(a)){const Q=gi(JSON.stringify(C));this.client.core.verify.register({attestationId:Q})}const O=await this.client.core.crypto.encode(n,C),F=Ct[a].req;return f&&(F.ttl=f),y&&(F.id=y),this.client.core.history.set(n,C),I?(F.internal=xi(Ue({},F.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,O,F)):this.client.core.relayer.publish(n,O,F).catch(Q=>this.client.logger.error(Q)),C.id},this.sendResult=async s=>{const{id:n,topic:a,result:l,throwOnFailedPublish:f}=s,y=(0,Z.formatJsonRpcResult)(n,l),b=await this.client.core.crypto.encode(a,y),I=await this.client.core.history.get(a,n),C=Ct[I.request.method].res;f?(C.internal=xi(Ue({},C.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,b,C)):this.client.core.relayer.publish(a,b,C).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(y)},this.sendError=async(s,n,a)=>{const l=(0,Z.formatJsonRpcError)(s,a),f=await this.client.core.crypto.encode(n,l),y=await this.client.core.history.get(n,s),b=Ct[y.request.method].res;this.client.core.relayer.publish(n,f,b),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const s=[],n=[];this.client.session.getAll().forEach(a=>{let l=!1;zt(a.expiry)&&(l=!0),this.client.core.crypto.keychain.has(a.topic)||(l=!0),l&&s.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{zt(a.expiryTimestamp)&&n.push(a.id)}),await Promise.all([...s.map(a=>this.deleteSession({topic:a})),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async s=>{this.requestQueue.queue.push(s),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Ot.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ot.active;const s=this.requestQueue.queue.shift();if(s)try{this.processRequest(s),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=Ot.idle},this.processRequest=s=>{const{topic:n,payload:a}=s,l=a.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async s=>{const{topic:n,payload:a}=s,l=(await this.client.core.history.get(n,a.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=s=>{const{topic:n}=s,{message:a}=N("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(s,n)=>{const{params:a,id:l}=n;try{this.isValidConnect(Ue({},n.params));const f=a.expiryTimestamp||We(Ct.wc_sessionPropose.req.ttl),y=Ue({id:l,pairingTopic:s,expiryTimestamp:f},a);await this.setProposal(l,y);const b=gi(JSON.stringify(n)),I=await this.getVerifyContext(b,y.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:y,verifyContext:I})}catch(f){await this.sendError(l,s,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(s,n)=>{const{id:a}=n;if((0,Z.isJsonRpcResult)(n)){const{result:l}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const y=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const b=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const I=await this.client.core.crypto.generateSharedKey(y,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:I});const C=await this.client.core.relayer.subscribe(I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:C}),await this.client.core.pairing.activate({topic:s})}else(0,Z.isJsonRpcError)(n)&&(await this.client.proposal.delete(a,fe("USER_DISCONNECTED")),this.events.emit(_e("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(s,n)=>{const{id:a,params:l}=n;try{this.isValidSessionSettleRequest(l);const{relay:f,controller:y,expiry:b,namespaces:I,sessionProperties:C,pairingTopic:O}=n.params,F=Ue({topic:s,relay:f,expiry:b,namespaces:I,acknowledged:!0,pairingTopic:O,requiredNamespaces:{},optionalNamespaces:{},controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},C&&{sessionProperties:C});await this.sendResult({id:n.id,topic:s,result:!0}),this.events.emit(_e("session_connect"),{session:F}),this.cleanupDuplicatePairings(F)}catch(f){await this.sendError(a,s,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(s,n)=>{const{id:a}=n;(0,Z.isJsonRpcResult)(n)?(await this.client.session.update(s,{acknowledged:!0}),this.events.emit(_e("session_approve",a),{})):(0,Z.isJsonRpcError)(n)&&(await this.client.session.delete(s,fe("USER_DISCONNECTED")),this.events.emit(_e("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(s,n)=>{const{params:a,id:l}=n;try{const f=`${s}_session_update`,y=Rr.get(f);if(y&&this.isRequestOutOfSync(y,l)){this.client.logger.info(`Discarding out of sync request - ${l}`);return}this.isValidUpdate(Ue({topic:s},a)),await this.client.session.update(s,{namespaces:a.namespaces}),await this.sendResult({id:l,topic:s,result:!0}),this.client.events.emit("session_update",{id:l,topic:s,params:a}),Rr.set(f,l)}catch(f){await this.sendError(l,s,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(s,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(s.toString().slice(0,-3)),this.onSessionUpdateResponse=(s,n)=>{const{id:a}=n;(0,Z.isJsonRpcResult)(n)?this.events.emit(_e("session_update",a),{}):(0,Z.isJsonRpcError)(n)&&this.events.emit(_e("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(s,n)=>{const{id:a}=n;try{this.isValidExtend({topic:s}),await this.setExpiry(s,We(Ar)),await this.sendResult({id:a,topic:s,result:!0}),this.client.events.emit("session_extend",{id:a,topic:s})}catch(l){await this.sendError(a,s,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(s,n)=>{const{id:a}=n;(0,Z.isJsonRpcResult)(n)?this.events.emit(_e("session_extend",a),{}):(0,Z.isJsonRpcError)(n)&&this.events.emit(_e("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(s,n)=>{const{id:a}=n;try{this.isValidPing({topic:s}),await this.sendResult({id:a,topic:s,result:!0}),this.client.events.emit("session_ping",{id:a,topic:s})}catch(l){await this.sendError(a,s,l),this.client.logger.error(l)}},this.onSessionPingResponse=(s,n)=>{const{id:a}=n;setTimeout(()=>{(0,Z.isJsonRpcResult)(n)?this.events.emit(_e("session_ping",a),{}):(0,Z.isJsonRpcError)(n)&&this.events.emit(_e("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(s,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:s,reason:n.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(De.publish,async()=>{l(await this.deleteSession({topic:s,id:a}))})}),this.sendResult({id:a,topic:s,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:s,error:fe("USER_DISCONNECTED")})])}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(s,n)=>{const{id:a,params:l}=n;try{this.isValidRequest(Ue({topic:s},l));const f=gi(JSON.stringify((0,Z.formatJsonRpcRequest)("wc_sessionRequest",l,a))),y=this.client.session.get(s),b=await this.getVerifyContext(f,y.peer.metadata),I={id:a,topic:s,params:l,verifyContext:b};await this.setPendingSessionRequest(I),this.addSessionRequestToSessionRequestQueue(I),this.processSessionRequestQueue()}catch(f){await this.sendError(a,s,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(s,n)=>{const{id:a}=n;(0,Z.isJsonRpcResult)(n)?this.events.emit(_e("session_request",a),{result:n.result}):(0,Z.isJsonRpcError)(n)&&this.events.emit(_e("session_request",a),{error:n.error})},this.onSessionEventRequest=async(s,n)=>{const{id:a,params:l}=n;try{const f=`${s}_session_event_${l.event.name}`,y=Rr.get(f);if(y&&this.isRequestOutOfSync(y,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Ue({topic:s},l)),this.client.events.emit("session_event",{id:a,topic:s,params:l}),Rr.set(f,a)}catch(f){await this.sendError(a,s,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=s=>{this.sessionRequestQueue.queue.push(s)},this.cleanupAfterResponse=s=>{this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ot.idle,this.processSessionRequestQueue()},(0,j.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:s,error:n})=>{const a=this.client.core.history.pending;a.length>0&&a.filter(l=>l.topic===s&&l.request.method==="wc_sessionRequest").forEach(l=>{this.events.emit(_e("session_request",l.request.id),{error:n})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Ot.active){this.client.logger.info("session request queue is already active.");return}const s=this.sessionRequestQueue.queue[0];if(!s){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ot.active,this.client.events.emit("session_request",s)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=s=>{if(s.active)return;const n=this.client.proposal.getAll().find(a=>a.pairingTopic===s.topic);n&&this.onSessionProposeRequest(s.topic,(0,Z.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async s=>{if(!Ke(s)){const{message:b}=N("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(b)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:l,sessionProperties:f,relays:y}=s;if(je(n)||await this.isValidPairingTopic(n),!pp(y,!0)){const{message:b}=N("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(b)}!je(a)&&Ei(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!je(l)&&Ei(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),je(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(s,n)=>{const a=lp(s,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async s=>{if(!Ke(s))throw new Error(N("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:n,namespaces:a,relayProtocol:l,sessionProperties:f}=s;await this.isValidProposalId(n);const y=this.client.proposal.get(n),b=Sr(a,"approve()");if(b)throw new Error(b.message);const I=ks(y.requiredNamespaces,a,"approve()");if(I)throw new Error(I.message);if(!Se(l,!0)){const{message:C}=N("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(C)}je(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async s=>{if(!Ke(s)){const{message:l}=N("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(l)}const{id:n,reason:a}=s;if(await this.isValidProposalId(n),!fp(a)){const{message:l}=N("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidSessionSettleRequest=s=>{if(!Ke(s)){const{message:I}=N("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(I)}const{relay:n,controller:a,namespaces:l,expiry:f}=s;if(!aa(n)){const{message:I}=N("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(I)}const y=np(a,"onSessionSettleRequest()");if(y)throw new Error(y.message);const b=Sr(l,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(zt(f)){const{message:I}=N("EXPIRED","onSessionSettleRequest()");throw new Error(I)}},this.isValidUpdate=async s=>{if(!Ke(s)){const{message:b}=N("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(b)}const{topic:n,namespaces:a}=s;await this.isValidSessionTopic(n);const l=this.client.session.get(n),f=Sr(a,"update()");if(f)throw new Error(f.message);const y=ks(l.requiredNamespaces,a,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async s=>{if(!Ke(s)){const{message:a}=N("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(a)}const{topic:n}=s;await this.isValidSessionTopic(n)},this.isValidRequest=async s=>{if(!Ke(s)){const{message:b}=N("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(b)}const{topic:n,request:a,chainId:l,expiry:f}=s;await this.isValidSessionTopic(n);const{namespaces:y}=this.client.session.get(n);if(!ca(y,l)){const{message:b}=N("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(b)}if(!gp(a)){const{message:b}=N("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(b)}if(!yp(y,l,a.method)){const{message:b}=N("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(b)}if(f&&!Ep(f,en)){const{message:b}=N("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${en.min} and ${en.max}`);throw new Error(b)}},this.isValidRespond=async s=>{var n;if(!Ke(s)){const{message:f}=N("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(f)}const{topic:a,response:l}=s;try{await this.isValidSessionTopic(a)}catch(f){throw(n=s==null?void 0:s.response)!=null&&n.id&&this.cleanupAfterResponse(s),f}if(!mp(l)){const{message:f}=N("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(l)}`);throw new Error(f)}},this.isValidPing=async s=>{if(!Ke(s)){const{message:a}=N("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(a)}const{topic:n}=s;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async s=>{if(!Ke(s)){const{message:y}=N("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(y)}const{topic:n,event:a,chainId:l}=s;await this.isValidSessionTopic(n);const{namespaces:f}=this.client.session.get(n);if(!ca(f,l)){const{message:y}=N("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(y)}if(!vp(a)){const{message:y}=N("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}if(!wp(f,l,a.name)){const{message:y}=N("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}},this.isValidDisconnect=async s=>{if(!Ke(s)){const{message:a}=N("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(a)}const{topic:n}=s;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(s,n)=>{const a={verified:{verifyUrl:n.verifyUrl||Pi,validation:"UNKNOWN",origin:n.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:s,verifyUrl:n.verifyUrl});l&&(a.verified.origin=l.origin,a.verified.isScam=l.isScam,a.verified.validation=l.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.info(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(s,n)=>{Object.values(s).forEach(a=>{if(!Se(a,!1)){const{message:l}=N("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(l)}})}}async isInitialized(){if(!this.initialized){const{message:r}=N("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(De.message,async r=>{const{topic:s,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(s,n);try{(0,Z.isJsonRpcRequest)(a)?(this.client.core.history.set(s,a),this.onRelayEventRequest({topic:s,payload:a})):(0,Z.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:s,payload:a}),this.client.core.history.delete(s,a.id)):this.onRelayEventUnknownPayload({topic:s,payload:a})}catch(l){this.client.logger.error(l)}})}registerExpirerEvents(){this.client.core.expirer.on(it.expired,async r=>{const{topic:s,id:n}=Zo(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,N("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(await this.deleteSession({topic:s,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:s})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ji.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!Se(r,!1)){const{message:s}=N("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:s}=N("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if(zt(this.client.core.pairing.pairings.get(r).expiry)){const{message:s}=N("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}}async isValidSessionTopic(r){if(!Se(r,!1)){const{message:s}=N("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(s)}if(!this.client.session.keys.includes(r)){const{message:s}=N("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(s)}if(zt(this.client.session.get(r).expiry)){await this.deleteSession({topic:r});const{message:s}=N("EXPIRED",`session topic: ${r}`);throw new Error(s)}if(!this.client.core.crypto.keychain.has(r)){const{message:s}=N("MISSING_OR_INVALID",`session topic does not exist in keychain: ${r}`);throw await this.deleteSession({topic:r}),new Error(s)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(Se(r,!1)){const{message:s}=N("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(s)}else{const{message:s}=N("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(s)}}async isValidProposalId(r){if(!dp(r)){const{message:s}=N("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(s)}if(!this.client.proposal.keys.includes(r)){const{message:s}=N("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(s)}if(zt(this.client.proposal.get(r).expiryTimestamp)){await this.deleteProposal(r);const{message:s}=N("EXPIRED",`proposal id: ${r}`);throw new Error(s)}}}class Dg extends Nr{constructor(r,s){super(r,s,bg,Zs),this.core=r,this.logger=s}}class Fg extends Nr{constructor(r,s){super(r,s,Eg,Zs),this.core=r,this.logger=s}}class Tg extends Nr{constructor(r,s){super(r,s,Pg,Zs,n=>n.id),this.core=r,this.logger=s}}class tn extends Mp{constructor(r){super(r),this.protocol=Ka,this.version=Ha,this.name=Xs.name,this.events=new xt.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(r==null?void 0:r.name)||Xs.name,this.metadata=(r==null?void 0:r.metadata)||yl();const s=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:(0,te.pino)((0,te.getDefaultLoggerOptions)({level:(r==null?void 0:r.logger)||Xs.logger}));this.core=(r==null?void 0:r.core)||new _g(r),this.logger=(0,te.generateChildLogger)(s,this.name),this.session=new Fg(this.core,this.logger),this.proposal=new Dg(this.core,this.logger),this.pendingRequest=new Tg(this.core,this.logger),this.engine=new Ag(this)}static async init(r){const s=new tn(r);return await s.initialize(),s}get context(){return(0,te.getLoggerContext)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}}const ZE=null,XE=null;var Vt=$(67708);const Ya="error",qg="wss://relay.walletconnect.com",$g="wc",jg="universal_provider",Za=`${$g}@2:${jg}:`,Ug="https://rpc.walletconnect.com/v1/",Nt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof $.g<"u"?$.g:typeof self<"u"?self:{},rn={exports:{}};(function(u,r){(function(){var s,n="4.17.21",a=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",y="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",I=500,C="__lodash_placeholder__",O=1,F=2,Q=4,T=1,k=2,W=1,ae=2,Oe=4,ue=8,re=16,G=32,me=64,be=128,Le=256,Ht=512,bm=30,Em="...",Im=800,Pm=16,hc=1,xm=2,Sm=3,ni=1/0,Bt=9007199254740991,Rm=17976931348623157e292,qr=0/0,bt=4294967295,Cm=bt-1,Om=bt>>>1,Nm=[["ary",be],["bind",W],["bindKey",ae],["curry",ue],["curryRight",re],["flip",Ht],["partial",G],["partialRight",me],["rearg",Le]],Si="[object Arguments]",$r="[object Array]",Am="[object AsyncFunction]",Zi="[object Boolean]",Xi="[object Date]",Dm="[object DOMException]",jr="[object Error]",Ur="[object Function]",lc="[object GeneratorFunction]",pt="[object Map]",er="[object Number]",Fm="[object Null]",At="[object Object]",pc="[object Promise]",Tm="[object Proxy]",tr="[object RegExp]",dt="[object Set]",ir="[object String]",Lr="[object Symbol]",qm="[object Undefined]",rr="[object WeakMap]",$m="[object WeakSet]",sr="[object ArrayBuffer]",Ri="[object DataView]",pn="[object Float32Array]",dn="[object Float64Array]",fn="[object Int8Array]",gn="[object Int16Array]",mn="[object Int32Array]",vn="[object Uint8Array]",yn="[object Uint8ClampedArray]",wn="[object Uint16Array]",_n="[object Uint32Array]",jm=/\b__p \+= '';/g,Um=/\b(__p \+=) '' \+/g,Lm=/(__e\(.*?\)|\b__t\)) \+\n'';/g,dc=/&(?:amp|lt|gt|quot|#39);/g,fc=/[&<>"']/g,Mm=RegExp(dc.source),zm=RegExp(fc.source),km=/<%-([\s\S]+?)%>/g,Vm=/<%([\s\S]+?)%>/g,gc=/<%=([\s\S]+?)%>/g,Km=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hm=/^\w*$/,Bm=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bn=/[\\^$.*+?()[\]{}|]/g,Gm=RegExp(bn.source),En=/^\s+/,Jm=/\s/,Wm=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Qm=/\{\n\/\* \[wrapped with (.+)\] \*/,Ym=/,? & /,Zm=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Xm=/[()=,{}\[\]\/\s]/,ev=/\\(\\)?/g,tv=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mc=/\w*$/,iv=/^[-+]0x[0-9a-f]+$/i,rv=/^0b[01]+$/i,sv=/^\[object .+?Constructor\]$/,nv=/^0o[0-7]+$/i,ov=/^(?:0|[1-9]\d*)$/,av=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Mr=/($^)/,cv=/['\n\r\u2028\u2029\\]/g,zr="\\ud800-\\udfff",uv="\\u0300-\\u036f",hv="\\ufe20-\\ufe2f",lv="\\u20d0-\\u20ff",vc=uv+hv+lv,yc="\\u2700-\\u27bf",wc="a-z\\xdf-\\xf6\\xf8-\\xff",pv="\\xac\\xb1\\xd7\\xf7",dv="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",fv="\\u2000-\\u206f",gv=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_c="A-Z\\xc0-\\xd6\\xd8-\\xde",bc="\\ufe0e\\ufe0f",Ec=pv+dv+fv+gv,In="['\u2019]",mv="["+zr+"]",Ic="["+Ec+"]",kr="["+vc+"]",Pc="\\d+",vv="["+yc+"]",xc="["+wc+"]",Sc="[^"+zr+Ec+Pc+yc+wc+_c+"]",Pn="\\ud83c[\\udffb-\\udfff]",yv="(?:"+kr+"|"+Pn+")",Rc="[^"+zr+"]",xn="(?:\\ud83c[\\udde6-\\uddff]){2}",Sn="[\\ud800-\\udbff][\\udc00-\\udfff]",Ci="["+_c+"]",Cc="\\u200d",Oc="(?:"+xc+"|"+Sc+")",wv="(?:"+Ci+"|"+Sc+")",Nc="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",Ac="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",Dc=yv+"?",Fc="["+bc+"]?",_v="(?:"+Cc+"(?:"+[Rc,xn,Sn].join("|")+")"+Fc+Dc+")*",bv="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ev="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Tc=Fc+Dc+_v,Iv="(?:"+[vv,xn,Sn].join("|")+")"+Tc,Pv="(?:"+[Rc+kr+"?",kr,xn,Sn,mv].join("|")+")",xv=RegExp(In,"g"),Sv=RegExp(kr,"g"),Rn=RegExp(Pn+"(?="+Pn+")|"+Pv+Tc,"g"),Rv=RegExp([Ci+"?"+xc+"+"+Nc+"(?="+[Ic,Ci,"$"].join("|")+")",wv+"+"+Ac+"(?="+[Ic,Ci+Oc,"$"].join("|")+")",Ci+"?"+Oc+"+"+Nc,Ci+"+"+Ac,Ev,bv,Pc,Iv].join("|"),"g"),Cv=RegExp("["+Cc+zr+vc+bc+"]"),Ov=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Nv=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Av=-1,de={};de[pn]=de[dn]=de[fn]=de[gn]=de[mn]=de[vn]=de[yn]=de[wn]=de[_n]=!0,de[Si]=de[$r]=de[sr]=de[Zi]=de[Ri]=de[Xi]=de[jr]=de[Ur]=de[pt]=de[er]=de[At]=de[tr]=de[dt]=de[ir]=de[rr]=!1;var le={};le[Si]=le[$r]=le[sr]=le[Ri]=le[Zi]=le[Xi]=le[pn]=le[dn]=le[fn]=le[gn]=le[mn]=le[pt]=le[er]=le[At]=le[tr]=le[dt]=le[ir]=le[Lr]=le[vn]=le[yn]=le[wn]=le[_n]=!0,le[jr]=le[Ur]=le[rr]=!1;var Dv={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Fv={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tv={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},qv={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},$v=parseFloat,jv=parseInt,qc=typeof Qi=="object"&&Qi&&Qi.Object===Object&&Qi,Uv=typeof self=="object"&&self&&self.Object===Object&&self,Ne=qc||Uv||Function("return this")(),Cn=r&&!r.nodeType&&r,oi=Cn&&!0&&u&&!u.nodeType&&u,$c=oi&&oi.exports===Cn,On=$c&&qc.process,rt=function(){try{var w=oi&&oi.require&&oi.require("util").types;return w||On&&On.binding&&On.binding("util")}catch{}}(),jc=rt&&rt.isArrayBuffer,Uc=rt&&rt.isDate,Lc=rt&&rt.isMap,Mc=rt&&rt.isRegExp,zc=rt&&rt.isSet,kc=rt&&rt.isTypedArray;function Qe(w,P,E){switch(E.length){case 0:return w.call(P);case 1:return w.call(P,E[0]);case 2:return w.call(P,E[0],E[1]);case 3:return w.call(P,E[0],E[1],E[2])}return w.apply(P,E)}function Lv(w,P,E,D){for(var V=-1,se=w==null?0:w.length;++V<se;){var Pe=w[V];P(D,Pe,E(Pe),w)}return D}function st(w,P){for(var E=-1,D=w==null?0:w.length;++E<D&&P(w[E],E,w)!==!1;);return w}function Mv(w,P){for(var E=w==null?0:w.length;E--&&P(w[E],E,w)!==!1;);return w}function Vc(w,P){for(var E=-1,D=w==null?0:w.length;++E<D;)if(!P(w[E],E,w))return!1;return!0}function Gt(w,P){for(var E=-1,D=w==null?0:w.length,V=0,se=[];++E<D;){var Pe=w[E];P(Pe,E,w)&&(se[V++]=Pe)}return se}function Vr(w,P){var E=w==null?0:w.length;return!!E&&Oi(w,P,0)>-1}function Nn(w,P,E){for(var D=-1,V=w==null?0:w.length;++D<V;)if(E(P,w[D]))return!0;return!1}function ve(w,P){for(var E=-1,D=w==null?0:w.length,V=Array(D);++E<D;)V[E]=P(w[E],E,w);return V}function Jt(w,P){for(var E=-1,D=P.length,V=w.length;++E<D;)w[V+E]=P[E];return w}function An(w,P,E,D){var V=-1,se=w==null?0:w.length;for(D&&se&&(E=w[++V]);++V<se;)E=P(E,w[V],V,w);return E}function zv(w,P,E,D){var V=w==null?0:w.length;for(D&&V&&(E=w[--V]);V--;)E=P(E,w[V],V,w);return E}function Dn(w,P){for(var E=-1,D=w==null?0:w.length;++E<D;)if(P(w[E],E,w))return!0;return!1}var kv=Fn("length");function Vv(w){return w.split("")}function Kv(w){return w.match(Zm)||[]}function Kc(w,P,E){var D;return E(w,function(V,se,Pe){if(P(V,se,Pe))return D=se,!1}),D}function Kr(w,P,E,D){for(var V=w.length,se=E+(D?1:-1);D?se--:++se<V;)if(P(w[se],se,w))return se;return-1}function Oi(w,P,E){return P===P?iy(w,P,E):Kr(w,Hc,E)}function Hv(w,P,E,D){for(var V=E-1,se=w.length;++V<se;)if(D(w[V],P))return V;return-1}function Hc(w){return w!==w}function Bc(w,P){var E=w==null?0:w.length;return E?qn(w,P)/E:qr}function Fn(w){return function(P){return P==null?s:P[w]}}function Tn(w){return function(P){return w==null?s:w[P]}}function Gc(w,P,E,D,V){return V(w,function(se,Pe,ce){E=D?(D=!1,se):P(E,se,Pe,ce)}),E}function Bv(w,P){var E=w.length;for(w.sort(P);E--;)w[E]=w[E].value;return w}function qn(w,P){for(var E,D=-1,V=w.length;++D<V;){var se=P(w[D]);se!==s&&(E=E===s?se:E+se)}return E}function $n(w,P){for(var E=-1,D=Array(w);++E<w;)D[E]=P(E);return D}function Gv(w,P){return ve(P,function(E){return[E,w[E]]})}function Jc(w){return w&&w.slice(0,Zc(w)+1).replace(En,"")}function Ye(w){return function(P){return w(P)}}function jn(w,P){return ve(P,function(E){return w[E]})}function nr(w,P){return w.has(P)}function Wc(w,P){for(var E=-1,D=w.length;++E<D&&Oi(P,w[E],0)>-1;);return E}function Qc(w,P){for(var E=w.length;E--&&Oi(P,w[E],0)>-1;);return E}function Jv(w,P){for(var E=w.length,D=0;E--;)w[E]===P&&++D;return D}var Wv=Tn(Dv),Qv=Tn(Fv);function Yv(w){return"\\"+qv[w]}function Zv(w,P){return w==null?s:w[P]}function Ni(w){return Cv.test(w)}function Xv(w){return Ov.test(w)}function ey(w){for(var P,E=[];!(P=w.next()).done;)E.push(P.value);return E}function Un(w){var P=-1,E=Array(w.size);return w.forEach(function(D,V){E[++P]=[V,D]}),E}function Yc(w,P){return function(E){return w(P(E))}}function Wt(w,P){for(var E=-1,D=w.length,V=0,se=[];++E<D;){var Pe=w[E];(Pe===P||Pe===C)&&(w[E]=C,se[V++]=E)}return se}function Hr(w){var P=-1,E=Array(w.size);return w.forEach(function(D){E[++P]=D}),E}function ty(w){var P=-1,E=Array(w.size);return w.forEach(function(D){E[++P]=[D,D]}),E}function iy(w,P,E){for(var D=E-1,V=w.length;++D<V;)if(w[D]===P)return D;return-1}function ry(w,P,E){for(var D=E+1;D--;)if(w[D]===P)return D;return D}function Ai(w){return Ni(w)?ny(w):kv(w)}function ft(w){return Ni(w)?oy(w):Vv(w)}function Zc(w){for(var P=w.length;P--&&Jm.test(w.charAt(P)););return P}var sy=Tn(Tv);function ny(w){for(var P=Rn.lastIndex=0;Rn.test(w);)++P;return P}function oy(w){return w.match(Rn)||[]}function ay(w){return w.match(Rv)||[]}var cy=function w(P){P=P==null?Ne:Di.defaults(Ne.Object(),P,Di.pick(Ne,Nv));var E=P.Array,D=P.Date,V=P.Error,se=P.Function,Pe=P.Math,ce=P.Object,Ln=P.RegExp,uy=P.String,nt=P.TypeError,Br=E.prototype,hy=se.prototype,Fi=ce.prototype,Gr=P["__core-js_shared__"],Jr=hy.toString,oe=Fi.hasOwnProperty,ly=0,Xc=function(){var e=/[^.]+$/.exec(Gr&&Gr.keys&&Gr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Wr=Fi.toString,py=Jr.call(ce),dy=Ne._,fy=Ln("^"+Jr.call(oe).replace(bn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qr=$c?P.Buffer:s,Qt=P.Symbol,Yr=P.Uint8Array,eu=Qr?Qr.allocUnsafe:s,Zr=Yc(ce.getPrototypeOf,ce),tu=ce.create,iu=Fi.propertyIsEnumerable,Xr=Br.splice,ru=Qt?Qt.isConcatSpreadable:s,or=Qt?Qt.iterator:s,ai=Qt?Qt.toStringTag:s,es=function(){try{var e=pi(ce,"defineProperty");return e({},"",{}),e}catch{}}(),gy=P.clearTimeout!==Ne.clearTimeout&&P.clearTimeout,my=D&&D.now!==Ne.Date.now&&D.now,vy=P.setTimeout!==Ne.setTimeout&&P.setTimeout,ts=Pe.ceil,is=Pe.floor,Mn=ce.getOwnPropertySymbols,yy=Qr?Qr.isBuffer:s,su=P.isFinite,wy=Br.join,_y=Yc(ce.keys,ce),xe=Pe.max,Te=Pe.min,by=D.now,Ey=P.parseInt,nu=Pe.random,Iy=Br.reverse,zn=pi(P,"DataView"),ar=pi(P,"Map"),kn=pi(P,"Promise"),Ti=pi(P,"Set"),cr=pi(P,"WeakMap"),ur=pi(ce,"create"),rs=cr&&new cr,qi={},Py=di(zn),xy=di(ar),Sy=di(kn),Ry=di(Ti),Cy=di(cr),ss=Qt?Qt.prototype:s,hr=ss?ss.valueOf:s,ou=ss?ss.toString:s;function d(e){if(we(e)&&!K(e)&&!(e instanceof ee)){if(e instanceof ot)return e;if(oe.call(e,"__wrapped__"))return ah(e)}return new ot(e)}var $i=function(){function e(){}return function(t){if(!ye(t))return{};if(tu)return tu(t);e.prototype=t;var o=new e;return e.prototype=s,o}}();function ns(){}function ot(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=s}d.templateSettings={escape:km,evaluate:Vm,interpolate:gc,variable:"",imports:{_:d}},d.prototype=ns.prototype,d.prototype.constructor=d,ot.prototype=$i(ns.prototype),ot.prototype.constructor=ot;function ee(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=bt,this.__views__=[]}function Oy(){var e=new ee(this.__wrapped__);return e.__actions__=He(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=He(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=He(this.__views__),e}function Ny(){if(this.__filtered__){var e=new ee(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Ay(){var e=this.__wrapped__.value(),t=this.__dir__,o=K(e),h=t<0,p=o?e.length:0,g=V0(0,p,this.__views__),m=g.start,v=g.end,_=v-m,x=h?v:m-1,S=this.__iteratees__,R=S.length,A=0,q=Te(_,this.__takeCount__);if(!o||!h&&p==_&&q==_)return Nu(e,this.__actions__);var M=[];e:for(;_--&&A<q;){x+=t;for(var B=-1,z=e[x];++B<R;){var Y=S[B],ie=Y.iteratee,et=Y.type,ke=ie(z);if(et==xm)z=ke;else if(!ke){if(et==hc)continue e;break e}}M[A++]=z}return M}ee.prototype=$i(ns.prototype),ee.prototype.constructor=ee;function ci(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var h=e[t];this.set(h[0],h[1])}}function Dy(){this.__data__=ur?ur(null):{},this.size=0}function Fy(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Ty(e){var t=this.__data__;if(ur){var o=t[e];return o===b?s:o}return oe.call(t,e)?t[e]:s}function qy(e){var t=this.__data__;return ur?t[e]!==s:oe.call(t,e)}function $y(e,t){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=ur&&t===s?b:t,this}ci.prototype.clear=Dy,ci.prototype.delete=Fy,ci.prototype.get=Ty,ci.prototype.has=qy,ci.prototype.set=$y;function Dt(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var h=e[t];this.set(h[0],h[1])}}function jy(){this.__data__=[],this.size=0}function Uy(e){var t=this.__data__,o=os(t,e);if(o<0)return!1;var h=t.length-1;return o==h?t.pop():Xr.call(t,o,1),--this.size,!0}function Ly(e){var t=this.__data__,o=os(t,e);return o<0?s:t[o][1]}function My(e){return os(this.__data__,e)>-1}function zy(e,t){var o=this.__data__,h=os(o,e);return h<0?(++this.size,o.push([e,t])):o[h][1]=t,this}Dt.prototype.clear=jy,Dt.prototype.delete=Uy,Dt.prototype.get=Ly,Dt.prototype.has=My,Dt.prototype.set=zy;function Ft(e){var t=-1,o=e==null?0:e.length;for(this.clear();++t<o;){var h=e[t];this.set(h[0],h[1])}}function ky(){this.size=0,this.__data__={hash:new ci,map:new(ar||Dt),string:new ci}}function Vy(e){var t=ys(this,e).delete(e);return this.size-=t?1:0,t}function Ky(e){return ys(this,e).get(e)}function Hy(e){return ys(this,e).has(e)}function By(e,t){var o=ys(this,e),h=o.size;return o.set(e,t),this.size+=o.size==h?0:1,this}Ft.prototype.clear=ky,Ft.prototype.delete=Vy,Ft.prototype.get=Ky,Ft.prototype.has=Hy,Ft.prototype.set=By;function ui(e){var t=-1,o=e==null?0:e.length;for(this.__data__=new Ft;++t<o;)this.add(e[t])}function Gy(e){return this.__data__.set(e,b),this}function Jy(e){return this.__data__.has(e)}ui.prototype.add=ui.prototype.push=Gy,ui.prototype.has=Jy;function gt(e){var t=this.__data__=new Dt(e);this.size=t.size}function Wy(){this.__data__=new Dt,this.size=0}function Qy(e){var t=this.__data__,o=t.delete(e);return this.size=t.size,o}function Yy(e){return this.__data__.get(e)}function Zy(e){return this.__data__.has(e)}function Xy(e,t){var o=this.__data__;if(o instanceof Dt){var h=o.__data__;if(!ar||h.length<a-1)return h.push([e,t]),this.size=++o.size,this;o=this.__data__=new Ft(h)}return o.set(e,t),this.size=o.size,this}gt.prototype.clear=Wy,gt.prototype.delete=Qy,gt.prototype.get=Yy,gt.prototype.has=Zy,gt.prototype.set=Xy;function au(e,t){var o=K(e),h=!o&&fi(e),p=!o&&!h&&ti(e),g=!o&&!h&&!p&&Mi(e),m=o||h||p||g,v=m?$n(e.length,uy):[],_=v.length;for(var x in e)(t||oe.call(e,x))&&!(m&&(x=="length"||p&&(x=="offset"||x=="parent")||g&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||jt(x,_)))&&v.push(x);return v}function cu(e){var t=e.length;return t?e[Xn(0,t-1)]:s}function e0(e,t){return ws(He(e),hi(t,0,e.length))}function t0(e){return ws(He(e))}function Vn(e,t,o){(o!==s&&!mt(e[t],o)||o===s&&!(t in e))&&Tt(e,t,o)}function lr(e,t,o){var h=e[t];(!(oe.call(e,t)&&mt(h,o))||o===s&&!(t in e))&&Tt(e,t,o)}function os(e,t){for(var o=e.length;o--;)if(mt(e[o][0],t))return o;return-1}function i0(e,t,o,h){return Yt(e,function(p,g,m){t(h,p,o(p),m)}),h}function uu(e,t){return e&&It(t,Re(t),e)}function r0(e,t){return e&&It(t,Ge(t),e)}function Tt(e,t,o){t=="__proto__"&&es?es(e,t,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[t]=o}function Kn(e,t){for(var o=-1,h=t.length,p=E(h),g=e==null;++o<h;)p[o]=g?s:xo(e,t[o]);return p}function hi(e,t,o){return e===e&&(o!==s&&(e=e<=o?e:o),t!==s&&(e=e>=t?e:t)),e}function at(e,t,o,h,p,g){var m,v=t&O,_=t&F,x=t&Q;if(o&&(m=p?o(e,h,p,g):o(e)),m!==s)return m;if(!ye(e))return e;var S=K(e);if(S){if(m=H0(e),!v)return He(e,m)}else{var R=qe(e),A=R==Ur||R==lc;if(ti(e))return Fu(e,v);if(R==At||R==Si||A&&!p){if(m=_||A?{}:Zu(e),!v)return _?T0(e,r0(m,e)):F0(e,uu(m,e))}else{if(!le[R])return p?e:{};m=B0(e,R,v)}}g||(g=new gt);var q=g.get(e);if(q)return q;g.set(e,m),Rh(e)?e.forEach(function(z){m.add(at(z,t,o,z,e,g))}):xh(e)&&e.forEach(function(z,Y){m.set(Y,at(z,t,o,Y,e,g))});var M=x?_?ho:uo:_?Ge:Re,B=S?s:M(e);return st(B||e,function(z,Y){B&&(Y=z,z=e[Y]),lr(m,Y,at(z,t,o,Y,e,g))}),m}function s0(e){var t=Re(e);return function(o){return hu(o,e,t)}}function hu(e,t,o){var h=o.length;if(e==null)return!h;for(e=ce(e);h--;){var p=o[h],g=t[p],m=e[p];if(m===s&&!(p in e)||!g(m))return!1}return!0}function lu(e,t,o){if(typeof e!="function")throw new nt(f);return yr(function(){e.apply(s,o)},t)}function pr(e,t,o,h){var p=-1,g=Vr,m=!0,v=e.length,_=[],x=t.length;if(!v)return _;o&&(t=ve(t,Ye(o))),h?(g=Nn,m=!1):t.length>=a&&(g=nr,m=!1,t=new ui(t));e:for(;++p<v;){var S=e[p],R=o==null?S:o(S);if(S=h||S!==0?S:0,m&&R===R){for(var A=x;A--;)if(t[A]===R)continue e;_.push(S)}else g(t,R,h)||_.push(S)}return _}var Yt=Uu(Et),pu=Uu(Bn,!0);function n0(e,t){var o=!0;return Yt(e,function(h,p,g){return o=!!t(h,p,g),o}),o}function as(e,t,o){for(var h=-1,p=e.length;++h<p;){var g=e[h],m=t(g);if(m!=null&&(v===s?m===m&&!Xe(m):o(m,v)))var v=m,_=g}return _}function o0(e,t,o,h){var p=e.length;for(o=H(o),o<0&&(o=-o>p?0:p+o),h=h===s||h>p?p:H(h),h<0&&(h+=p),h=o>h?0:Oh(h);o<h;)e[o++]=t;return e}function du(e,t){var o=[];return Yt(e,function(h,p,g){t(h,p,g)&&o.push(h)}),o}function Ae(e,t,o,h,p){var g=-1,m=e.length;for(o||(o=J0),p||(p=[]);++g<m;){var v=e[g];t>0&&o(v)?t>1?Ae(v,t-1,o,h,p):Jt(p,v):h||(p[p.length]=v)}return p}var Hn=Lu(),fu=Lu(!0);function Et(e,t){return e&&Hn(e,t,Re)}function Bn(e,t){return e&&fu(e,t,Re)}function cs(e,t){return Gt(t,function(o){return Ut(e[o])})}function li(e,t){t=Xt(t,e);for(var o=0,h=t.length;e!=null&&o<h;)e=e[Pt(t[o++])];return o&&o==h?e:s}function gu(e,t,o){var h=t(e);return K(e)?h:Jt(h,o(e))}function Me(e){return e==null?e===s?qm:Fm:ai&&ai in ce(e)?k0(e):tw(e)}function Gn(e,t){return e>t}function a0(e,t){return e!=null&&oe.call(e,t)}function c0(e,t){return e!=null&&t in ce(e)}function u0(e,t,o){return e>=Te(t,o)&&e<xe(t,o)}function Jn(e,t,o){for(var h=o?Nn:Vr,p=e[0].length,g=e.length,m=g,v=E(g),_=1/0,x=[];m--;){var S=e[m];m&&t&&(S=ve(S,Ye(t))),_=Te(S.length,_),v[m]=!o&&(t||p>=120&&S.length>=120)?new ui(m&&S):s}S=e[0];var R=-1,A=v[0];e:for(;++R<p&&x.length<_;){var q=S[R],M=t?t(q):q;if(q=o||q!==0?q:0,!(A?nr(A,M):h(x,M,o))){for(m=g;--m;){var B=v[m];if(!(B?nr(B,M):h(e[m],M,o)))continue e}A&&A.push(M),x.push(q)}}return x}function h0(e,t,o,h){return Et(e,function(p,g,m){t(h,o(p),g,m)}),h}function dr(e,t,o){t=Xt(t,e),e=ih(e,t);var h=e==null?e:e[Pt(ut(t))];return h==null?s:Qe(h,e,o)}function mu(e){return we(e)&&Me(e)==Si}function l0(e){return we(e)&&Me(e)==sr}function p0(e){return we(e)&&Me(e)==Xi}function fr(e,t,o,h,p){return e===t?!0:e==null||t==null||!we(e)&&!we(t)?e!==e&&t!==t:d0(e,t,o,h,fr,p)}function d0(e,t,o,h,p,g){var m=K(e),v=K(t),_=m?$r:qe(e),x=v?$r:qe(t);_=_==Si?At:_,x=x==Si?At:x;var S=_==At,R=x==At,A=_==x;if(A&&ti(e)){if(!ti(t))return!1;m=!0,S=!1}if(A&&!S)return g||(g=new gt),m||Mi(e)?Wu(e,t,o,h,p,g):M0(e,t,_,o,h,p,g);if(!(o&T)){var q=S&&oe.call(e,"__wrapped__"),M=R&&oe.call(t,"__wrapped__");if(q||M){var B=q?e.value():e,z=M?t.value():t;return g||(g=new gt),p(B,z,o,h,g)}}return A?(g||(g=new gt),z0(e,t,o,h,p,g)):!1}function f0(e){return we(e)&&qe(e)==pt}function Wn(e,t,o,h){var p=o.length,g=p,m=!h;if(e==null)return!g;for(e=ce(e);p--;){var v=o[p];if(m&&v[2]?v[1]!==e[v[0]]:!(v[0]in e))return!1}for(;++p<g;){v=o[p];var _=v[0],x=e[_],S=v[1];if(m&&v[2]){if(x===s&&!(_ in e))return!1}else{var R=new gt;if(h)var A=h(x,S,_,e,t,R);if(!(A===s?fr(S,x,T|k,h,R):A))return!1}}return!0}function vu(e){if(!ye(e)||Q0(e))return!1;var t=Ut(e)?fy:sv;return t.test(di(e))}function g0(e){return we(e)&&Me(e)==tr}function m0(e){return we(e)&&qe(e)==dt}function v0(e){return we(e)&&xs(e.length)&&!!de[Me(e)]}function yu(e){return typeof e=="function"?e:e==null?Je:typeof e=="object"?K(e)?bu(e[0],e[1]):_u(e):Mh(e)}function Qn(e){if(!vr(e))return _y(e);var t=[];for(var o in ce(e))oe.call(e,o)&&o!="constructor"&&t.push(o);return t}function y0(e){if(!ye(e))return ew(e);var t=vr(e),o=[];for(var h in e)h=="constructor"&&(t||!oe.call(e,h))||o.push(h);return o}function Yn(e,t){return e<t}function wu(e,t){var o=-1,h=Be(e)?E(e.length):[];return Yt(e,function(p,g,m){h[++o]=t(p,g,m)}),h}function _u(e){var t=po(e);return t.length==1&&t[0][2]?eh(t[0][0],t[0][1]):function(o){return o===e||Wn(o,e,t)}}function bu(e,t){return go(e)&&Xu(t)?eh(Pt(e),t):function(o){var h=xo(o,e);return h===s&&h===t?So(o,e):fr(t,h,T|k)}}function us(e,t,o,h,p){e!==t&&Hn(t,function(g,m){if(p||(p=new gt),ye(g))w0(e,t,m,o,us,h,p);else{var v=h?h(vo(e,m),g,m+"",e,t,p):s;v===s&&(v=g),Vn(e,m,v)}},Ge)}function w0(e,t,o,h,p,g,m){var v=vo(e,o),_=vo(t,o),x=m.get(_);if(x){Vn(e,o,x);return}var S=g?g(v,_,o+"",e,t,m):s,R=S===s;if(R){var A=K(_),q=!A&&ti(_),M=!A&&!q&&Mi(_);S=_,A||q||M?K(v)?S=v:Ee(v)?S=He(v):q?(R=!1,S=Fu(_,!0)):M?(R=!1,S=Tu(_,!0)):S=[]:wr(_)||fi(_)?(S=v,fi(v)?S=Nh(v):(!ye(v)||Ut(v))&&(S=Zu(_))):R=!1}R&&(m.set(_,S),p(S,_,h,g,m),m.delete(_)),Vn(e,o,S)}function Eu(e,t){var o=e.length;if(o)return t+=t<0?o:0,jt(t,o)?e[t]:s}function Iu(e,t,o){t.length?t=ve(t,function(g){return K(g)?function(m){return li(m,g.length===1?g[0]:g)}:g}):t=[Je];var h=-1;t=ve(t,Ye(U()));var p=wu(e,function(g,m,v){var _=ve(t,function(x){return x(g)});return{criteria:_,index:++h,value:g}});return Bv(p,function(g,m){return D0(g,m,o)})}function _0(e,t){return Pu(e,t,function(o,h){return So(e,h)})}function Pu(e,t,o){for(var h=-1,p=t.length,g={};++h<p;){var m=t[h],v=li(e,m);o(v,m)&&gr(g,Xt(m,e),v)}return g}function b0(e){return function(t){return li(t,e)}}function Zn(e,t,o,h){var p=h?Hv:Oi,g=-1,m=t.length,v=e;for(e===t&&(t=He(t)),o&&(v=ve(e,Ye(o)));++g<m;)for(var _=0,x=t[g],S=o?o(x):x;(_=p(v,S,_,h))>-1;)v!==e&&Xr.call(v,_,1),Xr.call(e,_,1);return e}function xu(e,t){for(var o=e?t.length:0,h=o-1;o--;){var p=t[o];if(o==h||p!==g){var g=p;jt(p)?Xr.call(e,p,1):io(e,p)}}return e}function Xn(e,t){return e+is(nu()*(t-e+1))}function E0(e,t,o,h){for(var p=-1,g=xe(ts((t-e)/(o||1)),0),m=E(g);g--;)m[h?g:++p]=e,e+=o;return m}function eo(e,t){var o="";if(!e||t<1||t>Bt)return o;do t%2&&(o+=e),t=is(t/2),t&&(e+=e);while(t);return o}function J(e,t){return yo(th(e,t,Je),e+"")}function I0(e){return cu(zi(e))}function P0(e,t){var o=zi(e);return ws(o,hi(t,0,o.length))}function gr(e,t,o,h){if(!ye(e))return e;t=Xt(t,e);for(var p=-1,g=t.length,m=g-1,v=e;v!=null&&++p<g;){var _=Pt(t[p]),x=o;if(_==="__proto__"||_==="constructor"||_==="prototype")return e;if(p!=m){var S=v[_];x=h?h(S,_,v):s,x===s&&(x=ye(S)?S:jt(t[p+1])?[]:{})}lr(v,_,x),v=v[_]}return e}var Su=rs?function(e,t){return rs.set(e,t),e}:Je,x0=es?function(e,t){return es(e,"toString",{configurable:!0,enumerable:!1,value:Co(t),writable:!0})}:Je;function S0(e){return ws(zi(e))}function ct(e,t,o){var h=-1,p=e.length;t<0&&(t=-t>p?0:p+t),o=o>p?p:o,o<0&&(o+=p),p=t>o?0:o-t>>>0,t>>>=0;for(var g=E(p);++h<p;)g[h]=e[h+t];return g}function R0(e,t){var o;return Yt(e,function(h,p,g){return o=t(h,p,g),!o}),!!o}function hs(e,t,o){var h=0,p=e==null?h:e.length;if(typeof t=="number"&&t===t&&p<=Om){for(;h<p;){var g=h+p>>>1,m=e[g];m!==null&&!Xe(m)&&(o?m<=t:m<t)?h=g+1:p=g}return p}return to(e,t,Je,o)}function to(e,t,o,h){var p=0,g=e==null?0:e.length;if(g===0)return 0;t=o(t);for(var m=t!==t,v=t===null,_=Xe(t),x=t===s;p<g;){var S=is((p+g)/2),R=o(e[S]),A=R!==s,q=R===null,M=R===R,B=Xe(R);if(m)var z=h||M;else x?z=M&&(h||A):v?z=M&&A&&(h||!q):_?z=M&&A&&!q&&(h||!B):q||B?z=!1:z=h?R<=t:R<t;z?p=S+1:g=S}return Te(g,Cm)}function Ru(e,t){for(var o=-1,h=e.length,p=0,g=[];++o<h;){var m=e[o],v=t?t(m):m;if(!o||!mt(v,_)){var _=v;g[p++]=m===0?0:m}}return g}function Cu(e){return typeof e=="number"?e:Xe(e)?qr:+e}function Ze(e){if(typeof e=="string")return e;if(K(e))return ve(e,Ze)+"";if(Xe(e))return ou?ou.call(e):"";var t=e+"";return t=="0"&&1/e==-ni?"-0":t}function Zt(e,t,o){var h=-1,p=Vr,g=e.length,m=!0,v=[],_=v;if(o)m=!1,p=Nn;else if(g>=a){var x=t?null:U0(e);if(x)return Hr(x);m=!1,p=nr,_=new ui}else _=t?[]:v;e:for(;++h<g;){var S=e[h],R=t?t(S):S;if(S=o||S!==0?S:0,m&&R===R){for(var A=_.length;A--;)if(_[A]===R)continue e;t&&_.push(R),v.push(S)}else p(_,R,o)||(_!==v&&_.push(R),v.push(S))}return v}function io(e,t){return t=Xt(t,e),e=ih(e,t),e==null||delete e[Pt(ut(t))]}function Ou(e,t,o,h){return gr(e,t,o(li(e,t)),h)}function ls(e,t,o,h){for(var p=e.length,g=h?p:-1;(h?g--:++g<p)&&t(e[g],g,e););return o?ct(e,h?0:g,h?g+1:p):ct(e,h?g+1:0,h?p:g)}function Nu(e,t){var o=e;return o instanceof ee&&(o=o.value()),An(t,function(h,p){return p.func.apply(p.thisArg,Jt([h],p.args))},o)}function ro(e,t,o){var h=e.length;if(h<2)return h?Zt(e[0]):[];for(var p=-1,g=E(h);++p<h;)for(var m=e[p],v=-1;++v<h;)v!=p&&(g[p]=pr(g[p]||m,e[v],t,o));return Zt(Ae(g,1),t,o)}function Au(e,t,o){for(var h=-1,p=e.length,g=t.length,m={};++h<p;){var v=h<g?t[h]:s;o(m,e[h],v)}return m}function so(e){return Ee(e)?e:[]}function no(e){return typeof e=="function"?e:Je}function Xt(e,t){return K(e)?e:go(e,t)?[e]:oh(ne(e))}var C0=J;function ei(e,t,o){var h=e.length;return o=o===s?h:o,!t&&o>=h?e:ct(e,t,o)}var Du=gy||function(e){return Ne.clearTimeout(e)};function Fu(e,t){if(t)return e.slice();var o=e.length,h=eu?eu(o):new e.constructor(o);return e.copy(h),h}function oo(e){var t=new e.constructor(e.byteLength);return new Yr(t).set(new Yr(e)),t}function O0(e,t){var o=t?oo(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function N0(e){var t=new e.constructor(e.source,mc.exec(e));return t.lastIndex=e.lastIndex,t}function A0(e){return hr?ce(hr.call(e)):{}}function Tu(e,t){var o=t?oo(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function qu(e,t){if(e!==t){var o=e!==s,h=e===null,p=e===e,g=Xe(e),m=t!==s,v=t===null,_=t===t,x=Xe(t);if(!v&&!x&&!g&&e>t||g&&m&&_&&!v&&!x||h&&m&&_||!o&&_||!p)return 1;if(!h&&!g&&!x&&e<t||x&&o&&p&&!h&&!g||v&&o&&p||!m&&p||!_)return-1}return 0}function D0(e,t,o){for(var h=-1,p=e.criteria,g=t.criteria,m=p.length,v=o.length;++h<m;){var _=qu(p[h],g[h]);if(_){if(h>=v)return _;var x=o[h];return _*(x=="desc"?-1:1)}}return e.index-t.index}function $u(e,t,o,h){for(var p=-1,g=e.length,m=o.length,v=-1,_=t.length,x=xe(g-m,0),S=E(_+x),R=!h;++v<_;)S[v]=t[v];for(;++p<m;)(R||p<g)&&(S[o[p]]=e[p]);for(;x--;)S[v++]=e[p++];return S}function ju(e,t,o,h){for(var p=-1,g=e.length,m=-1,v=o.length,_=-1,x=t.length,S=xe(g-v,0),R=E(S+x),A=!h;++p<S;)R[p]=e[p];for(var q=p;++_<x;)R[q+_]=t[_];for(;++m<v;)(A||p<g)&&(R[q+o[m]]=e[p++]);return R}function He(e,t){var o=-1,h=e.length;for(t||(t=E(h));++o<h;)t[o]=e[o];return t}function It(e,t,o,h){var p=!o;o||(o={});for(var g=-1,m=t.length;++g<m;){var v=t[g],_=h?h(o[v],e[v],v,o,e):s;_===s&&(_=e[v]),p?Tt(o,v,_):lr(o,v,_)}return o}function F0(e,t){return It(e,fo(e),t)}function T0(e,t){return It(e,Qu(e),t)}function ps(e,t){return function(o,h){var p=K(o)?Lv:i0,g=t?t():{};return p(o,e,U(h,2),g)}}function ji(e){return J(function(t,o){var h=-1,p=o.length,g=p>1?o[p-1]:s,m=p>2?o[2]:s;for(g=e.length>3&&typeof g=="function"?(p--,g):s,m&&ze(o[0],o[1],m)&&(g=p<3?s:g,p=1),t=ce(t);++h<p;){var v=o[h];v&&e(t,v,h,g)}return t})}function Uu(e,t){return function(o,h){if(o==null)return o;if(!Be(o))return e(o,h);for(var p=o.length,g=t?p:-1,m=ce(o);(t?g--:++g<p)&&h(m[g],g,m)!==!1;);return o}}function Lu(e){return function(t,o,h){for(var p=-1,g=ce(t),m=h(t),v=m.length;v--;){var _=m[e?v:++p];if(o(g[_],_,g)===!1)break}return t}}function q0(e,t,o){var h=t&W,p=mr(e);function g(){var m=this&&this!==Ne&&this instanceof g?p:e;return m.apply(h?o:this,arguments)}return g}function Mu(e){return function(t){t=ne(t);var o=Ni(t)?ft(t):s,h=o?o[0]:t.charAt(0),p=o?ei(o,1).join(""):t.slice(1);return h[e]()+p}}function Ui(e){return function(t){return An(Uh(jh(t).replace(xv,"")),e,"")}}function mr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var o=$i(e.prototype),h=e.apply(o,t);return ye(h)?h:o}}function $0(e,t,o){var h=mr(e);function p(){for(var g=arguments.length,m=E(g),v=g,_=Li(p);v--;)m[v]=arguments[v];var x=g<3&&m[0]!==_&&m[g-1]!==_?[]:Wt(m,_);if(g-=x.length,g<o)return Hu(e,t,ds,p.placeholder,s,m,x,s,s,o-g);var S=this&&this!==Ne&&this instanceof p?h:e;return Qe(S,this,m)}return p}function zu(e){return function(t,o,h){var p=ce(t);if(!Be(t)){var g=U(o,3);t=Re(t),o=function(v){return g(p[v],v,p)}}var m=e(t,o,h);return m>-1?p[g?t[m]:m]:s}}function ku(e){return $t(function(t){var o=t.length,h=o,p=ot.prototype.thru;for(e&&t.reverse();h--;){var g=t[h];if(typeof g!="function")throw new nt(f);if(p&&!m&&vs(g)=="wrapper")var m=new ot([],!0)}for(h=m?h:o;++h<o;){g=t[h];var v=vs(g),_=v=="wrapper"?lo(g):s;_&&mo(_[0])&&_[1]==(be|ue|G|Le)&&!_[4].length&&_[9]==1?m=m[vs(_[0])].apply(m,_[3]):m=g.length==1&&mo(g)?m[v]():m.thru(g)}return function(){var x=arguments,S=x[0];if(m&&x.length==1&&K(S))return m.plant(S).value();for(var R=0,A=o?t[R].apply(this,x):S;++R<o;)A=t[R].call(this,A);return A}})}function ds(e,t,o,h,p,g,m,v,_,x){var S=t&be,R=t&W,A=t&ae,q=t&(ue|re),M=t&Ht,B=A?s:mr(e);function z(){for(var Y=arguments.length,ie=E(Y),et=Y;et--;)ie[et]=arguments[et];if(q)var ke=Li(z),tt=Jv(ie,ke);if(h&&(ie=$u(ie,h,p,q)),g&&(ie=ju(ie,g,m,q)),Y-=tt,q&&Y<x){var Ie=Wt(ie,ke);return Hu(e,t,ds,z.placeholder,o,ie,Ie,v,_,x-Y)}var vt=R?o:this,Mt=A?vt[e]:e;return Y=ie.length,v?ie=iw(ie,v):M&&Y>1&&ie.reverse(),S&&_<Y&&(ie.length=_),this&&this!==Ne&&this instanceof z&&(Mt=B||mr(Mt)),Mt.apply(vt,ie)}return z}function Vu(e,t){return function(o,h){return h0(o,e,t(h),{})}}function fs(e,t){return function(o,h){var p;if(o===s&&h===s)return t;if(o!==s&&(p=o),h!==s){if(p===s)return h;typeof o=="string"||typeof h=="string"?(o=Ze(o),h=Ze(h)):(o=Cu(o),h=Cu(h)),p=e(o,h)}return p}}function ao(e){return $t(function(t){return t=ve(t,Ye(U())),J(function(o){var h=this;return e(t,function(p){return Qe(p,h,o)})})})}function gs(e,t){t=t===s?" ":Ze(t);var o=t.length;if(o<2)return o?eo(t,e):t;var h=eo(t,ts(e/Ai(t)));return Ni(t)?ei(ft(h),0,e).join(""):h.slice(0,e)}function j0(e,t,o,h){var p=t&W,g=mr(e);function m(){for(var v=-1,_=arguments.length,x=-1,S=h.length,R=E(S+_),A=this&&this!==Ne&&this instanceof m?g:e;++x<S;)R[x]=h[x];for(;_--;)R[x++]=arguments[++v];return Qe(A,p?o:this,R)}return m}function Ku(e){return function(t,o,h){return h&&typeof h!="number"&&ze(t,o,h)&&(o=h=s),t=Lt(t),o===s?(o=t,t=0):o=Lt(o),h=h===s?t<o?1:-1:Lt(h),E0(t,o,h,e)}}function ms(e){return function(t,o){return typeof t=="string"&&typeof o=="string"||(t=ht(t),o=ht(o)),e(t,o)}}function Hu(e,t,o,h,p,g,m,v,_,x){var S=t&ue,R=S?m:s,A=S?s:m,q=S?g:s,M=S?s:g;t|=S?G:me,t&=~(S?me:G),t&Oe||(t&=~(W|ae));var B=[e,t,p,q,R,M,A,v,_,x],z=o.apply(s,B);return mo(e)&&rh(z,B),z.placeholder=h,sh(z,e,t)}function co(e){var t=Pe[e];return function(o,h){if(o=ht(o),h=h==null?0:Te(H(h),292),h&&su(o)){var p=(ne(o)+"e").split("e"),g=t(p[0]+"e"+(+p[1]+h));return p=(ne(g)+"e").split("e"),+(p[0]+"e"+(+p[1]-h))}return t(o)}}var U0=Ti&&1/Hr(new Ti([,-0]))[1]==ni?function(e){return new Ti(e)}:Ao;function Bu(e){return function(t){var o=qe(t);return o==pt?Un(t):o==dt?ty(t):Gv(t,e(t))}}function qt(e,t,o,h,p,g,m,v){var _=t&ae;if(!_&&typeof e!="function")throw new nt(f);var x=h?h.length:0;if(x||(t&=~(G|me),h=p=s),m=m===s?m:xe(H(m),0),v=v===s?v:H(v),x-=p?p.length:0,t&me){var S=h,R=p;h=p=s}var A=_?s:lo(e),q=[e,t,o,h,p,S,R,g,m,v];if(A&&X0(q,A),e=q[0],t=q[1],o=q[2],h=q[3],p=q[4],v=q[9]=q[9]===s?_?0:e.length:xe(q[9]-x,0),!v&&t&(ue|re)&&(t&=~(ue|re)),!t||t==W)var M=q0(e,t,o);else t==ue||t==re?M=$0(e,t,v):(t==G||t==(W|G))&&!p.length?M=j0(e,t,o,h):M=ds.apply(s,q);var B=A?Su:rh;return sh(B(M,q),e,t)}function Gu(e,t,o,h){return e===s||mt(e,Fi[o])&&!oe.call(h,o)?t:e}function Ju(e,t,o,h,p,g){return ye(e)&&ye(t)&&(g.set(t,e),us(e,t,s,Ju,g),g.delete(t)),e}function L0(e){return wr(e)?s:e}function Wu(e,t,o,h,p,g){var m=o&T,v=e.length,_=t.length;if(v!=_&&!(m&&_>v))return!1;var x=g.get(e),S=g.get(t);if(x&&S)return x==t&&S==e;var R=-1,A=!0,q=o&k?new ui:s;for(g.set(e,t),g.set(t,e);++R<v;){var M=e[R],B=t[R];if(h)var z=m?h(B,M,R,t,e,g):h(M,B,R,e,t,g);if(z!==s){if(z)continue;A=!1;break}if(q){if(!Dn(t,function(Y,ie){if(!nr(q,ie)&&(M===Y||p(M,Y,o,h,g)))return q.push(ie)})){A=!1;break}}else if(!(M===B||p(M,B,o,h,g))){A=!1;break}}return g.delete(e),g.delete(t),A}function M0(e,t,o,h,p,g,m){switch(o){case Ri:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case sr:return!(e.byteLength!=t.byteLength||!g(new Yr(e),new Yr(t)));case Zi:case Xi:case er:return mt(+e,+t);case jr:return e.name==t.name&&e.message==t.message;case tr:case ir:return e==t+"";case pt:var v=Un;case dt:var _=h&T;if(v||(v=Hr),e.size!=t.size&&!_)return!1;var x=m.get(e);if(x)return x==t;h|=k,m.set(e,t);var S=Wu(v(e),v(t),h,p,g,m);return m.delete(e),S;case Lr:if(hr)return hr.call(e)==hr.call(t)}return!1}function z0(e,t,o,h,p,g){var m=o&T,v=uo(e),_=v.length,x=uo(t),S=x.length;if(_!=S&&!m)return!1;for(var R=_;R--;){var A=v[R];if(!(m?A in t:oe.call(t,A)))return!1}var q=g.get(e),M=g.get(t);if(q&&M)return q==t&&M==e;var B=!0;g.set(e,t),g.set(t,e);for(var z=m;++R<_;){A=v[R];var Y=e[A],ie=t[A];if(h)var et=m?h(ie,Y,A,t,e,g):h(Y,ie,A,e,t,g);if(!(et===s?Y===ie||p(Y,ie,o,h,g):et)){B=!1;break}z||(z=A=="constructor")}if(B&&!z){var ke=e.constructor,tt=t.constructor;ke!=tt&&"constructor"in e&&"constructor"in t&&!(typeof ke=="function"&&ke instanceof ke&&typeof tt=="function"&&tt instanceof tt)&&(B=!1)}return g.delete(e),g.delete(t),B}function $t(e){return yo(th(e,s,hh),e+"")}function uo(e){return gu(e,Re,fo)}function ho(e){return gu(e,Ge,Qu)}var lo=rs?function(e){return rs.get(e)}:Ao;function vs(e){for(var t=e.name+"",o=qi[t],h=oe.call(qi,t)?o.length:0;h--;){var p=o[h],g=p.func;if(g==null||g==e)return p.name}return t}function Li(e){var t=oe.call(d,"placeholder")?d:e;return t.placeholder}function U(){var e=d.iteratee||Oo;return e=e===Oo?yu:e,arguments.length?e(arguments[0],arguments[1]):e}function ys(e,t){var o=e.__data__;return W0(t)?o[typeof t=="string"?"string":"hash"]:o.map}function po(e){for(var t=Re(e),o=t.length;o--;){var h=t[o],p=e[h];t[o]=[h,p,Xu(p)]}return t}function pi(e,t){var o=Zv(e,t);return vu(o)?o:s}function k0(e){var t=oe.call(e,ai),o=e[ai];try{e[ai]=s;var h=!0}catch{}var p=Wr.call(e);return h&&(t?e[ai]=o:delete e[ai]),p}var fo=Mn?function(e){return e==null?[]:(e=ce(e),Gt(Mn(e),function(t){return iu.call(e,t)}))}:Do,Qu=Mn?function(e){for(var t=[];e;)Jt(t,fo(e)),e=Zr(e);return t}:Do,qe=Me;(zn&&qe(new zn(new ArrayBuffer(1)))!=Ri||ar&&qe(new ar)!=pt||kn&&qe(kn.resolve())!=pc||Ti&&qe(new Ti)!=dt||cr&&qe(new cr)!=rr)&&(qe=function(e){var t=Me(e),o=t==At?e.constructor:s,h=o?di(o):"";if(h)switch(h){case Py:return Ri;case xy:return pt;case Sy:return pc;case Ry:return dt;case Cy:return rr}return t});function V0(e,t,o){for(var h=-1,p=o.length;++h<p;){var g=o[h],m=g.size;switch(g.type){case"drop":e+=m;break;case"dropRight":t-=m;break;case"take":t=Te(t,e+m);break;case"takeRight":e=xe(e,t-m);break}}return{start:e,end:t}}function K0(e){var t=e.match(Qm);return t?t[1].split(Ym):[]}function Yu(e,t,o){t=Xt(t,e);for(var h=-1,p=t.length,g=!1;++h<p;){var m=Pt(t[h]);if(!(g=e!=null&&o(e,m)))break;e=e[m]}return g||++h!=p?g:(p=e==null?0:e.length,!!p&&xs(p)&&jt(m,p)&&(K(e)||fi(e)))}function H0(e){var t=e.length,o=new e.constructor(t);return t&&typeof e[0]=="string"&&oe.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function Zu(e){return typeof e.constructor=="function"&&!vr(e)?$i(Zr(e)):{}}function B0(e,t,o){var h=e.constructor;switch(t){case sr:return oo(e);case Zi:case Xi:return new h(+e);case Ri:return O0(e,o);case pn:case dn:case fn:case gn:case mn:case vn:case yn:case wn:case _n:return Tu(e,o);case pt:return new h;case er:case ir:return new h(e);case tr:return N0(e);case dt:return new h;case Lr:return A0(e)}}function G0(e,t){var o=t.length;if(!o)return e;var h=o-1;return t[h]=(o>1?"& ":"")+t[h],t=t.join(o>2?", ":" "),e.replace(Wm,`{
/* [wrapped with `+t+`] */
`)}function J0(e){return K(e)||fi(e)||!!(ru&&e&&e[ru])}function jt(e,t){var o=typeof e;return t=t??Bt,!!t&&(o=="number"||o!="symbol"&&ov.test(e))&&e>-1&&e%1==0&&e<t}function ze(e,t,o){if(!ye(o))return!1;var h=typeof t;return(h=="number"?Be(o)&&jt(t,o.length):h=="string"&&t in o)?mt(o[t],e):!1}function go(e,t){if(K(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||Xe(e)?!0:Hm.test(e)||!Km.test(e)||t!=null&&e in ce(t)}function W0(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function mo(e){var t=vs(e),o=d[t];if(typeof o!="function"||!(t in ee.prototype))return!1;if(e===o)return!0;var h=lo(o);return!!h&&e===h[0]}function Q0(e){return!!Xc&&Xc in e}var Y0=Gr?Ut:Fo;function vr(e){var t=e&&e.constructor,o=typeof t=="function"&&t.prototype||Fi;return e===o}function Xu(e){return e===e&&!ye(e)}function eh(e,t){return function(o){return o==null?!1:o[e]===t&&(t!==s||e in ce(o))}}function Z0(e){var t=Is(e,function(h){return o.size===I&&o.clear(),h}),o=t.cache;return t}function X0(e,t){var o=e[1],h=t[1],p=o|h,g=p<(W|ae|be),m=h==be&&o==ue||h==be&&o==Le&&e[7].length<=t[8]||h==(be|Le)&&t[7].length<=t[8]&&o==ue;if(!(g||m))return e;h&W&&(e[2]=t[2],p|=o&W?0:Oe);var v=t[3];if(v){var _=e[3];e[3]=_?$u(_,v,t[4]):v,e[4]=_?Wt(e[3],C):t[4]}return v=t[5],v&&(_=e[5],e[5]=_?ju(_,v,t[6]):v,e[6]=_?Wt(e[5],C):t[6]),v=t[7],v&&(e[7]=v),h&be&&(e[8]=e[8]==null?t[8]:Te(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=p,e}function ew(e){var t=[];if(e!=null)for(var o in ce(e))t.push(o);return t}function tw(e){return Wr.call(e)}function th(e,t,o){return t=xe(t===s?e.length-1:t,0),function(){for(var h=arguments,p=-1,g=xe(h.length-t,0),m=E(g);++p<g;)m[p]=h[t+p];p=-1;for(var v=E(t+1);++p<t;)v[p]=h[p];return v[t]=o(m),Qe(e,this,v)}}function ih(e,t){return t.length<2?e:li(e,ct(t,0,-1))}function iw(e,t){for(var o=e.length,h=Te(t.length,o),p=He(e);h--;){var g=t[h];e[h]=jt(g,o)?p[g]:s}return e}function vo(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var rh=nh(Su),yr=vy||function(e,t){return Ne.setTimeout(e,t)},yo=nh(x0);function sh(e,t,o){var h=t+"";return yo(e,G0(h,rw(K0(h),o)))}function nh(e){var t=0,o=0;return function(){var h=by(),p=Pm-(h-o);if(o=h,p>0){if(++t>=Im)return arguments[0]}else t=0;return e.apply(s,arguments)}}function ws(e,t){var o=-1,h=e.length,p=h-1;for(t=t===s?h:t;++o<t;){var g=Xn(o,p),m=e[g];e[g]=e[o],e[o]=m}return e.length=t,e}var oh=Z0(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Bm,function(o,h,p,g){t.push(p?g.replace(ev,"$1"):h||o)}),t});function Pt(e){if(typeof e=="string"||Xe(e))return e;var t=e+"";return t=="0"&&1/e==-ni?"-0":t}function di(e){if(e!=null){try{return Jr.call(e)}catch{}try{return e+""}catch{}}return""}function rw(e,t){return st(Nm,function(o){var h="_."+o[0];t&o[1]&&!Vr(e,h)&&e.push(h)}),e.sort()}function ah(e){if(e instanceof ee)return e.clone();var t=new ot(e.__wrapped__,e.__chain__);return t.__actions__=He(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function sw(e,t,o){(o?ze(e,t,o):t===s)?t=1:t=xe(H(t),0);var h=e==null?0:e.length;if(!h||t<1)return[];for(var p=0,g=0,m=E(ts(h/t));p<h;)m[g++]=ct(e,p,p+=t);return m}function nw(e){for(var t=-1,o=e==null?0:e.length,h=0,p=[];++t<o;){var g=e[t];g&&(p[h++]=g)}return p}function ow(){var e=arguments.length;if(!e)return[];for(var t=E(e-1),o=arguments[0],h=e;h--;)t[h-1]=arguments[h];return Jt(K(o)?He(o):[o],Ae(t,1))}var aw=J(function(e,t){return Ee(e)?pr(e,Ae(t,1,Ee,!0)):[]}),cw=J(function(e,t){var o=ut(t);return Ee(o)&&(o=s),Ee(e)?pr(e,Ae(t,1,Ee,!0),U(o,2)):[]}),uw=J(function(e,t){var o=ut(t);return Ee(o)&&(o=s),Ee(e)?pr(e,Ae(t,1,Ee,!0),s,o):[]});function hw(e,t,o){var h=e==null?0:e.length;return h?(t=o||t===s?1:H(t),ct(e,t<0?0:t,h)):[]}function lw(e,t,o){var h=e==null?0:e.length;return h?(t=o||t===s?1:H(t),t=h-t,ct(e,0,t<0?0:t)):[]}function pw(e,t){return e&&e.length?ls(e,U(t,3),!0,!0):[]}function dw(e,t){return e&&e.length?ls(e,U(t,3),!0):[]}function fw(e,t,o,h){var p=e==null?0:e.length;return p?(o&&typeof o!="number"&&ze(e,t,o)&&(o=0,h=p),o0(e,t,o,h)):[]}function ch(e,t,o){var h=e==null?0:e.length;if(!h)return-1;var p=o==null?0:H(o);return p<0&&(p=xe(h+p,0)),Kr(e,U(t,3),p)}function uh(e,t,o){var h=e==null?0:e.length;if(!h)return-1;var p=h-1;return o!==s&&(p=H(o),p=o<0?xe(h+p,0):Te(p,h-1)),Kr(e,U(t,3),p,!0)}function hh(e){var t=e==null?0:e.length;return t?Ae(e,1):[]}function gw(e){var t=e==null?0:e.length;return t?Ae(e,ni):[]}function mw(e,t){var o=e==null?0:e.length;return o?(t=t===s?1:H(t),Ae(e,t)):[]}function vw(e){for(var t=-1,o=e==null?0:e.length,h={};++t<o;){var p=e[t];h[p[0]]=p[1]}return h}function lh(e){return e&&e.length?e[0]:s}function yw(e,t,o){var h=e==null?0:e.length;if(!h)return-1;var p=o==null?0:H(o);return p<0&&(p=xe(h+p,0)),Oi(e,t,p)}function ww(e){var t=e==null?0:e.length;return t?ct(e,0,-1):[]}var _w=J(function(e){var t=ve(e,so);return t.length&&t[0]===e[0]?Jn(t):[]}),bw=J(function(e){var t=ut(e),o=ve(e,so);return t===ut(o)?t=s:o.pop(),o.length&&o[0]===e[0]?Jn(o,U(t,2)):[]}),Ew=J(function(e){var t=ut(e),o=ve(e,so);return t=typeof t=="function"?t:s,t&&o.pop(),o.length&&o[0]===e[0]?Jn(o,s,t):[]});function Iw(e,t){return e==null?"":wy.call(e,t)}function ut(e){var t=e==null?0:e.length;return t?e[t-1]:s}function Pw(e,t,o){var h=e==null?0:e.length;if(!h)return-1;var p=h;return o!==s&&(p=H(o),p=p<0?xe(h+p,0):Te(p,h-1)),t===t?ry(e,t,p):Kr(e,Hc,p,!0)}function xw(e,t){return e&&e.length?Eu(e,H(t)):s}var Sw=J(ph);function ph(e,t){return e&&e.length&&t&&t.length?Zn(e,t):e}function Rw(e,t,o){return e&&e.length&&t&&t.length?Zn(e,t,U(o,2)):e}function Cw(e,t,o){return e&&e.length&&t&&t.length?Zn(e,t,s,o):e}var Ow=$t(function(e,t){var o=e==null?0:e.length,h=Kn(e,t);return xu(e,ve(t,function(p){return jt(p,o)?+p:p}).sort(qu)),h});function Nw(e,t){var o=[];if(!(e&&e.length))return o;var h=-1,p=[],g=e.length;for(t=U(t,3);++h<g;){var m=e[h];t(m,h,e)&&(o.push(m),p.push(h))}return xu(e,p),o}function wo(e){return e==null?e:Iy.call(e)}function Aw(e,t,o){var h=e==null?0:e.length;return h?(o&&typeof o!="number"&&ze(e,t,o)?(t=0,o=h):(t=t==null?0:H(t),o=o===s?h:H(o)),ct(e,t,o)):[]}function Dw(e,t){return hs(e,t)}function Fw(e,t,o){return to(e,t,U(o,2))}function Tw(e,t){var o=e==null?0:e.length;if(o){var h=hs(e,t);if(h<o&&mt(e[h],t))return h}return-1}function qw(e,t){return hs(e,t,!0)}function $w(e,t,o){return to(e,t,U(o,2),!0)}function jw(e,t){var o=e==null?0:e.length;if(o){var h=hs(e,t,!0)-1;if(mt(e[h],t))return h}return-1}function Uw(e){return e&&e.length?Ru(e):[]}function Lw(e,t){return e&&e.length?Ru(e,U(t,2)):[]}function Mw(e){var t=e==null?0:e.length;return t?ct(e,1,t):[]}function zw(e,t,o){return e&&e.length?(t=o||t===s?1:H(t),ct(e,0,t<0?0:t)):[]}function kw(e,t,o){var h=e==null?0:e.length;return h?(t=o||t===s?1:H(t),t=h-t,ct(e,t<0?0:t,h)):[]}function Vw(e,t){return e&&e.length?ls(e,U(t,3),!1,!0):[]}function Kw(e,t){return e&&e.length?ls(e,U(t,3)):[]}var Hw=J(function(e){return Zt(Ae(e,1,Ee,!0))}),Bw=J(function(e){var t=ut(e);return Ee(t)&&(t=s),Zt(Ae(e,1,Ee,!0),U(t,2))}),Gw=J(function(e){var t=ut(e);return t=typeof t=="function"?t:s,Zt(Ae(e,1,Ee,!0),s,t)});function Jw(e){return e&&e.length?Zt(e):[]}function Ww(e,t){return e&&e.length?Zt(e,U(t,2)):[]}function Qw(e,t){return t=typeof t=="function"?t:s,e&&e.length?Zt(e,s,t):[]}function _o(e){if(!(e&&e.length))return[];var t=0;return e=Gt(e,function(o){if(Ee(o))return t=xe(o.length,t),!0}),$n(t,function(o){return ve(e,Fn(o))})}function dh(e,t){if(!(e&&e.length))return[];var o=_o(e);return t==null?o:ve(o,function(h){return Qe(t,s,h)})}var Yw=J(function(e,t){return Ee(e)?pr(e,t):[]}),Zw=J(function(e){return ro(Gt(e,Ee))}),Xw=J(function(e){var t=ut(e);return Ee(t)&&(t=s),ro(Gt(e,Ee),U(t,2))}),e_=J(function(e){var t=ut(e);return t=typeof t=="function"?t:s,ro(Gt(e,Ee),s,t)}),t_=J(_o);function i_(e,t){return Au(e||[],t||[],lr)}function r_(e,t){return Au(e||[],t||[],gr)}var s_=J(function(e){var t=e.length,o=t>1?e[t-1]:s;return o=typeof o=="function"?(e.pop(),o):s,dh(e,o)});function fh(e){var t=d(e);return t.__chain__=!0,t}function n_(e,t){return t(e),e}function _s(e,t){return t(e)}var o_=$t(function(e){var t=e.length,o=t?e[0]:0,h=this.__wrapped__,p=function(g){return Kn(g,e)};return t>1||this.__actions__.length||!(h instanceof ee)||!jt(o)?this.thru(p):(h=h.slice(o,+o+(t?1:0)),h.__actions__.push({func:_s,args:[p],thisArg:s}),new ot(h,this.__chain__).thru(function(g){return t&&!g.length&&g.push(s),g}))});function a_(){return fh(this)}function c_(){return new ot(this.value(),this.__chain__)}function u_(){this.__values__===s&&(this.__values__=Ch(this.value()));var e=this.__index__>=this.__values__.length,t=e?s:this.__values__[this.__index__++];return{done:e,value:t}}function h_(){return this}function l_(e){for(var t,o=this;o instanceof ns;){var h=ah(o);h.__index__=0,h.__values__=s,t?p.__wrapped__=h:t=h;var p=h;o=o.__wrapped__}return p.__wrapped__=e,t}function p_(){var e=this.__wrapped__;if(e instanceof ee){var t=e;return this.__actions__.length&&(t=new ee(this)),t=t.reverse(),t.__actions__.push({func:_s,args:[wo],thisArg:s}),new ot(t,this.__chain__)}return this.thru(wo)}function d_(){return Nu(this.__wrapped__,this.__actions__)}var f_=ps(function(e,t,o){oe.call(e,o)?++e[o]:Tt(e,o,1)});function g_(e,t,o){var h=K(e)?Vc:n0;return o&&ze(e,t,o)&&(t=s),h(e,U(t,3))}function m_(e,t){var o=K(e)?Gt:du;return o(e,U(t,3))}var v_=zu(ch),y_=zu(uh);function w_(e,t){return Ae(bs(e,t),1)}function __(e,t){return Ae(bs(e,t),ni)}function b_(e,t,o){return o=o===s?1:H(o),Ae(bs(e,t),o)}function gh(e,t){var o=K(e)?st:Yt;return o(e,U(t,3))}function mh(e,t){var o=K(e)?Mv:pu;return o(e,U(t,3))}var E_=ps(function(e,t,o){oe.call(e,o)?e[o].push(t):Tt(e,o,[t])});function I_(e,t,o,h){e=Be(e)?e:zi(e),o=o&&!h?H(o):0;var p=e.length;return o<0&&(o=xe(p+o,0)),Ss(e)?o<=p&&e.indexOf(t,o)>-1:!!p&&Oi(e,t,o)>-1}var P_=J(function(e,t,o){var h=-1,p=typeof t=="function",g=Be(e)?E(e.length):[];return Yt(e,function(m){g[++h]=p?Qe(t,m,o):dr(m,t,o)}),g}),x_=ps(function(e,t,o){Tt(e,o,t)});function bs(e,t){var o=K(e)?ve:wu;return o(e,U(t,3))}function S_(e,t,o,h){return e==null?[]:(K(t)||(t=t==null?[]:[t]),o=h?s:o,K(o)||(o=o==null?[]:[o]),Iu(e,t,o))}var R_=ps(function(e,t,o){e[o?0:1].push(t)},function(){return[[],[]]});function C_(e,t,o){var h=K(e)?An:Gc,p=arguments.length<3;return h(e,U(t,4),o,p,Yt)}function O_(e,t,o){var h=K(e)?zv:Gc,p=arguments.length<3;return h(e,U(t,4),o,p,pu)}function N_(e,t){var o=K(e)?Gt:du;return o(e,Ps(U(t,3)))}function A_(e){var t=K(e)?cu:I0;return t(e)}function D_(e,t,o){(o?ze(e,t,o):t===s)?t=1:t=H(t);var h=K(e)?e0:P0;return h(e,t)}function F_(e){var t=K(e)?t0:S0;return t(e)}function T_(e){if(e==null)return 0;if(Be(e))return Ss(e)?Ai(e):e.length;var t=qe(e);return t==pt||t==dt?e.size:Qn(e).length}function q_(e,t,o){var h=K(e)?Dn:R0;return o&&ze(e,t,o)&&(t=s),h(e,U(t,3))}var $_=J(function(e,t){if(e==null)return[];var o=t.length;return o>1&&ze(e,t[0],t[1])?t=[]:o>2&&ze(t[0],t[1],t[2])&&(t=[t[0]]),Iu(e,Ae(t,1),[])}),Es=my||function(){return Ne.Date.now()};function j_(e,t){if(typeof t!="function")throw new nt(f);return e=H(e),function(){if(--e<1)return t.apply(this,arguments)}}function vh(e,t,o){return t=o?s:t,t=e&&t==null?e.length:t,qt(e,be,s,s,s,s,t)}function yh(e,t){var o;if(typeof t!="function")throw new nt(f);return e=H(e),function(){return--e>0&&(o=t.apply(this,arguments)),e<=1&&(t=s),o}}var bo=J(function(e,t,o){var h=W;if(o.length){var p=Wt(o,Li(bo));h|=G}return qt(e,h,t,o,p)}),wh=J(function(e,t,o){var h=W|ae;if(o.length){var p=Wt(o,Li(wh));h|=G}return qt(t,h,e,o,p)});function _h(e,t,o){t=o?s:t;var h=qt(e,ue,s,s,s,s,s,t);return h.placeholder=_h.placeholder,h}function bh(e,t,o){t=o?s:t;var h=qt(e,re,s,s,s,s,s,t);return h.placeholder=bh.placeholder,h}function Eh(e,t,o){var h,p,g,m,v,_,x=0,S=!1,R=!1,A=!0;if(typeof e!="function")throw new nt(f);t=ht(t)||0,ye(o)&&(S=!!o.leading,R="maxWait"in o,g=R?xe(ht(o.maxWait)||0,t):g,A="trailing"in o?!!o.trailing:A);function q(Ie){var vt=h,Mt=p;return h=p=s,x=Ie,m=e.apply(Mt,vt),m}function M(Ie){return x=Ie,v=yr(Y,t),S?q(Ie):m}function B(Ie){var vt=Ie-_,Mt=Ie-x,zh=t-vt;return R?Te(zh,g-Mt):zh}function z(Ie){var vt=Ie-_,Mt=Ie-x;return _===s||vt>=t||vt<0||R&&Mt>=g}function Y(){var Ie=Es();if(z(Ie))return ie(Ie);v=yr(Y,B(Ie))}function ie(Ie){return v=s,A&&h?q(Ie):(h=p=s,m)}function et(){v!==s&&Du(v),x=0,h=_=p=v=s}function ke(){return v===s?m:ie(Es())}function tt(){var Ie=Es(),vt=z(Ie);if(h=arguments,p=this,_=Ie,vt){if(v===s)return M(_);if(R)return Du(v),v=yr(Y,t),q(_)}return v===s&&(v=yr(Y,t)),m}return tt.cancel=et,tt.flush=ke,tt}var U_=J(function(e,t){return lu(e,1,t)}),L_=J(function(e,t,o){return lu(e,ht(t)||0,o)});function M_(e){return qt(e,Ht)}function Is(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new nt(f);var o=function(){var h=arguments,p=t?t.apply(this,h):h[0],g=o.cache;if(g.has(p))return g.get(p);var m=e.apply(this,h);return o.cache=g.set(p,m)||g,m};return o.cache=new(Is.Cache||Ft),o}Is.Cache=Ft;function Ps(e){if(typeof e!="function")throw new nt(f);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function z_(e){return yh(2,e)}var k_=C0(function(e,t){t=t.length==1&&K(t[0])?ve(t[0],Ye(U())):ve(Ae(t,1),Ye(U()));var o=t.length;return J(function(h){for(var p=-1,g=Te(h.length,o);++p<g;)h[p]=t[p].call(this,h[p]);return Qe(e,this,h)})}),Eo=J(function(e,t){var o=Wt(t,Li(Eo));return qt(e,G,s,t,o)}),Ih=J(function(e,t){var o=Wt(t,Li(Ih));return qt(e,me,s,t,o)}),V_=$t(function(e,t){return qt(e,Le,s,s,s,t)});function K_(e,t){if(typeof e!="function")throw new nt(f);return t=t===s?t:H(t),J(e,t)}function H_(e,t){if(typeof e!="function")throw new nt(f);return t=t==null?0:xe(H(t),0),J(function(o){var h=o[t],p=ei(o,0,t);return h&&Jt(p,h),Qe(e,this,p)})}function B_(e,t,o){var h=!0,p=!0;if(typeof e!="function")throw new nt(f);return ye(o)&&(h="leading"in o?!!o.leading:h,p="trailing"in o?!!o.trailing:p),Eh(e,t,{leading:h,maxWait:t,trailing:p})}function G_(e){return vh(e,1)}function J_(e,t){return Eo(no(t),e)}function W_(){if(!arguments.length)return[];var e=arguments[0];return K(e)?e:[e]}function Q_(e){return at(e,Q)}function Y_(e,t){return t=typeof t=="function"?t:s,at(e,Q,t)}function Z_(e){return at(e,O|Q)}function X_(e,t){return t=typeof t=="function"?t:s,at(e,O|Q,t)}function e1(e,t){return t==null||hu(e,t,Re(t))}function mt(e,t){return e===t||e!==e&&t!==t}var t1=ms(Gn),i1=ms(function(e,t){return e>=t}),fi=mu(function(){return arguments}())?mu:function(e){return we(e)&&oe.call(e,"callee")&&!iu.call(e,"callee")},K=E.isArray,r1=jc?Ye(jc):l0;function Be(e){return e!=null&&xs(e.length)&&!Ut(e)}function Ee(e){return we(e)&&Be(e)}function s1(e){return e===!0||e===!1||we(e)&&Me(e)==Zi}var ti=yy||Fo,n1=Uc?Ye(Uc):p0;function o1(e){return we(e)&&e.nodeType===1&&!wr(e)}function a1(e){if(e==null)return!0;if(Be(e)&&(K(e)||typeof e=="string"||typeof e.splice=="function"||ti(e)||Mi(e)||fi(e)))return!e.length;var t=qe(e);if(t==pt||t==dt)return!e.size;if(vr(e))return!Qn(e).length;for(var o in e)if(oe.call(e,o))return!1;return!0}function c1(e,t){return fr(e,t)}function u1(e,t,o){o=typeof o=="function"?o:s;var h=o?o(e,t):s;return h===s?fr(e,t,s,o):!!h}function Io(e){if(!we(e))return!1;var t=Me(e);return t==jr||t==Dm||typeof e.message=="string"&&typeof e.name=="string"&&!wr(e)}function h1(e){return typeof e=="number"&&su(e)}function Ut(e){if(!ye(e))return!1;var t=Me(e);return t==Ur||t==lc||t==Am||t==Tm}function Ph(e){return typeof e=="number"&&e==H(e)}function xs(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Bt}function ye(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function we(e){return e!=null&&typeof e=="object"}var xh=Lc?Ye(Lc):f0;function l1(e,t){return e===t||Wn(e,t,po(t))}function p1(e,t,o){return o=typeof o=="function"?o:s,Wn(e,t,po(t),o)}function d1(e){return Sh(e)&&e!=+e}function f1(e){if(Y0(e))throw new V(l);return vu(e)}function g1(e){return e===null}function m1(e){return e==null}function Sh(e){return typeof e=="number"||we(e)&&Me(e)==er}function wr(e){if(!we(e)||Me(e)!=At)return!1;var t=Zr(e);if(t===null)return!0;var o=oe.call(t,"constructor")&&t.constructor;return typeof o=="function"&&o instanceof o&&Jr.call(o)==py}var Po=Mc?Ye(Mc):g0;function v1(e){return Ph(e)&&e>=-Bt&&e<=Bt}var Rh=zc?Ye(zc):m0;function Ss(e){return typeof e=="string"||!K(e)&&we(e)&&Me(e)==ir}function Xe(e){return typeof e=="symbol"||we(e)&&Me(e)==Lr}var Mi=kc?Ye(kc):v0;function y1(e){return e===s}function w1(e){return we(e)&&qe(e)==rr}function _1(e){return we(e)&&Me(e)==$m}var b1=ms(Yn),E1=ms(function(e,t){return e<=t});function Ch(e){if(!e)return[];if(Be(e))return Ss(e)?ft(e):He(e);if(or&&e[or])return ey(e[or]());var t=qe(e),o=t==pt?Un:t==dt?Hr:zi;return o(e)}function Lt(e){if(!e)return e===0?e:0;if(e=ht(e),e===ni||e===-ni){var t=e<0?-1:1;return t*Rm}return e===e?e:0}function H(e){var t=Lt(e),o=t%1;return t===t?o?t-o:t:0}function Oh(e){return e?hi(H(e),0,bt):0}function ht(e){if(typeof e=="number")return e;if(Xe(e))return qr;if(ye(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ye(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Jc(e);var o=rv.test(e);return o||nv.test(e)?jv(e.slice(2),o?2:8):iv.test(e)?qr:+e}function Nh(e){return It(e,Ge(e))}function I1(e){return e?hi(H(e),-Bt,Bt):e===0?e:0}function ne(e){return e==null?"":Ze(e)}var P1=ji(function(e,t){if(vr(t)||Be(t)){It(t,Re(t),e);return}for(var o in t)oe.call(t,o)&&lr(e,o,t[o])}),Ah=ji(function(e,t){It(t,Ge(t),e)}),Rs=ji(function(e,t,o,h){It(t,Ge(t),e,h)}),x1=ji(function(e,t,o,h){It(t,Re(t),e,h)}),S1=$t(Kn);function R1(e,t){var o=$i(e);return t==null?o:uu(o,t)}var C1=J(function(e,t){e=ce(e);var o=-1,h=t.length,p=h>2?t[2]:s;for(p&&ze(t[0],t[1],p)&&(h=1);++o<h;)for(var g=t[o],m=Ge(g),v=-1,_=m.length;++v<_;){var x=m[v],S=e[x];(S===s||mt(S,Fi[x])&&!oe.call(e,x))&&(e[x]=g[x])}return e}),O1=J(function(e){return e.push(s,Ju),Qe(Dh,s,e)});function N1(e,t){return Kc(e,U(t,3),Et)}function A1(e,t){return Kc(e,U(t,3),Bn)}function D1(e,t){return e==null?e:Hn(e,U(t,3),Ge)}function F1(e,t){return e==null?e:fu(e,U(t,3),Ge)}function T1(e,t){return e&&Et(e,U(t,3))}function q1(e,t){return e&&Bn(e,U(t,3))}function $1(e){return e==null?[]:cs(e,Re(e))}function j1(e){return e==null?[]:cs(e,Ge(e))}function xo(e,t,o){var h=e==null?s:li(e,t);return h===s?o:h}function U1(e,t){return e!=null&&Yu(e,t,a0)}function So(e,t){return e!=null&&Yu(e,t,c0)}var L1=Vu(function(e,t,o){t!=null&&typeof t.toString!="function"&&(t=Wr.call(t)),e[t]=o},Co(Je)),M1=Vu(function(e,t,o){t!=null&&typeof t.toString!="function"&&(t=Wr.call(t)),oe.call(e,t)?e[t].push(o):e[t]=[o]},U),z1=J(dr);function Re(e){return Be(e)?au(e):Qn(e)}function Ge(e){return Be(e)?au(e,!0):y0(e)}function k1(e,t){var o={};return t=U(t,3),Et(e,function(h,p,g){Tt(o,t(h,p,g),h)}),o}function V1(e,t){var o={};return t=U(t,3),Et(e,function(h,p,g){Tt(o,p,t(h,p,g))}),o}var K1=ji(function(e,t,o){us(e,t,o)}),Dh=ji(function(e,t,o,h){us(e,t,o,h)}),H1=$t(function(e,t){var o={};if(e==null)return o;var h=!1;t=ve(t,function(g){return g=Xt(g,e),h||(h=g.length>1),g}),It(e,ho(e),o),h&&(o=at(o,O|F|Q,L0));for(var p=t.length;p--;)io(o,t[p]);return o});function B1(e,t){return Fh(e,Ps(U(t)))}var G1=$t(function(e,t){return e==null?{}:_0(e,t)});function Fh(e,t){if(e==null)return{};var o=ve(ho(e),function(h){return[h]});return t=U(t),Pu(e,o,function(h,p){return t(h,p[0])})}function J1(e,t,o){t=Xt(t,e);var h=-1,p=t.length;for(p||(p=1,e=s);++h<p;){var g=e==null?s:e[Pt(t[h])];g===s&&(h=p,g=o),e=Ut(g)?g.call(e):g}return e}function W1(e,t,o){return e==null?e:gr(e,t,o)}function Q1(e,t,o,h){return h=typeof h=="function"?h:s,e==null?e:gr(e,t,o,h)}var Th=Bu(Re),qh=Bu(Ge);function Y1(e,t,o){var h=K(e),p=h||ti(e)||Mi(e);if(t=U(t,4),o==null){var g=e&&e.constructor;p?o=h?new g:[]:ye(e)?o=Ut(g)?$i(Zr(e)):{}:o={}}return(p?st:Et)(e,function(m,v,_){return t(o,m,v,_)}),o}function Z1(e,t){return e==null?!0:io(e,t)}function X1(e,t,o){return e==null?e:Ou(e,t,no(o))}function eb(e,t,o,h){return h=typeof h=="function"?h:s,e==null?e:Ou(e,t,no(o),h)}function zi(e){return e==null?[]:jn(e,Re(e))}function tb(e){return e==null?[]:jn(e,Ge(e))}function ib(e,t,o){return o===s&&(o=t,t=s),o!==s&&(o=ht(o),o=o===o?o:0),t!==s&&(t=ht(t),t=t===t?t:0),hi(ht(e),t,o)}function rb(e,t,o){return t=Lt(t),o===s?(o=t,t=0):o=Lt(o),e=ht(e),u0(e,t,o)}function sb(e,t,o){if(o&&typeof o!="boolean"&&ze(e,t,o)&&(t=o=s),o===s&&(typeof t=="boolean"?(o=t,t=s):typeof e=="boolean"&&(o=e,e=s)),e===s&&t===s?(e=0,t=1):(e=Lt(e),t===s?(t=e,e=0):t=Lt(t)),e>t){var h=e;e=t,t=h}if(o||e%1||t%1){var p=nu();return Te(e+p*(t-e+$v("1e-"+((p+"").length-1))),t)}return Xn(e,t)}var nb=Ui(function(e,t,o){return t=t.toLowerCase(),e+(o?$h(t):t)});function $h(e){return Ro(ne(e).toLowerCase())}function jh(e){return e=ne(e),e&&e.replace(av,Wv).replace(Sv,"")}function ob(e,t,o){e=ne(e),t=Ze(t);var h=e.length;o=o===s?h:hi(H(o),0,h);var p=o;return o-=t.length,o>=0&&e.slice(o,p)==t}function ab(e){return e=ne(e),e&&zm.test(e)?e.replace(fc,Qv):e}function cb(e){return e=ne(e),e&&Gm.test(e)?e.replace(bn,"\\$&"):e}var ub=Ui(function(e,t,o){return e+(o?"-":"")+t.toLowerCase()}),hb=Ui(function(e,t,o){return e+(o?" ":"")+t.toLowerCase()}),lb=Mu("toLowerCase");function pb(e,t,o){e=ne(e),t=H(t);var h=t?Ai(e):0;if(!t||h>=t)return e;var p=(t-h)/2;return gs(is(p),o)+e+gs(ts(p),o)}function db(e,t,o){e=ne(e),t=H(t);var h=t?Ai(e):0;return t&&h<t?e+gs(t-h,o):e}function fb(e,t,o){e=ne(e),t=H(t);var h=t?Ai(e):0;return t&&h<t?gs(t-h,o)+e:e}function gb(e,t,o){return o||t==null?t=0:t&&(t=+t),Ey(ne(e).replace(En,""),t||0)}function mb(e,t,o){return(o?ze(e,t,o):t===s)?t=1:t=H(t),eo(ne(e),t)}function vb(){var e=arguments,t=ne(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var yb=Ui(function(e,t,o){return e+(o?"_":"")+t.toLowerCase()});function wb(e,t,o){return o&&typeof o!="number"&&ze(e,t,o)&&(t=o=s),o=o===s?bt:o>>>0,o?(e=ne(e),e&&(typeof t=="string"||t!=null&&!Po(t))&&(t=Ze(t),!t&&Ni(e))?ei(ft(e),0,o):e.split(t,o)):[]}var _b=Ui(function(e,t,o){return e+(o?" ":"")+Ro(t)});function bb(e,t,o){return e=ne(e),o=o==null?0:hi(H(o),0,e.length),t=Ze(t),e.slice(o,o+t.length)==t}function Eb(e,t,o){var h=d.templateSettings;o&&ze(e,t,o)&&(t=s),e=ne(e),t=Rs({},t,h,Gu);var p=Rs({},t.imports,h.imports,Gu),g=Re(p),m=jn(p,g),v,_,x=0,S=t.interpolate||Mr,R="__p += '",A=Ln((t.escape||Mr).source+"|"+S.source+"|"+(S===gc?tv:Mr).source+"|"+(t.evaluate||Mr).source+"|$","g"),q="//# sourceURL="+(oe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Av+"]")+`
`;e.replace(A,function(z,Y,ie,et,ke,tt){return ie||(ie=et),R+=e.slice(x,tt).replace(cv,Yv),Y&&(v=!0,R+=`' +
__e(`+Y+`) +
'`),ke&&(_=!0,R+=`';
`+ke+`;
__p += '`),ie&&(R+=`' +
((__t = (`+ie+`)) == null ? '' : __t) +
'`),x=tt+z.length,z}),R+=`';
`;var M=oe.call(t,"variable")&&t.variable;if(!M)R=`with (obj) {
`+R+`
}
`;else if(Xm.test(M))throw new V(y);R=(_?R.replace(jm,""):R).replace(Um,"$1").replace(Lm,"$1;"),R="function("+(M||"obj")+`) {
`+(M?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(v?", __e = _.escape":"")+(_?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var B=Lh(function(){return se(g,q+"return "+R).apply(s,m)});if(B.source=R,Io(B))throw B;return B}function Ib(e){return ne(e).toLowerCase()}function Pb(e){return ne(e).toUpperCase()}function xb(e,t,o){if(e=ne(e),e&&(o||t===s))return Jc(e);if(!e||!(t=Ze(t)))return e;var h=ft(e),p=ft(t),g=Wc(h,p),m=Qc(h,p)+1;return ei(h,g,m).join("")}function Sb(e,t,o){if(e=ne(e),e&&(o||t===s))return e.slice(0,Zc(e)+1);if(!e||!(t=Ze(t)))return e;var h=ft(e),p=Qc(h,ft(t))+1;return ei(h,0,p).join("")}function Rb(e,t,o){if(e=ne(e),e&&(o||t===s))return e.replace(En,"");if(!e||!(t=Ze(t)))return e;var h=ft(e),p=Wc(h,ft(t));return ei(h,p).join("")}function Cb(e,t){var o=bm,h=Em;if(ye(t)){var p="separator"in t?t.separator:p;o="length"in t?H(t.length):o,h="omission"in t?Ze(t.omission):h}e=ne(e);var g=e.length;if(Ni(e)){var m=ft(e);g=m.length}if(o>=g)return e;var v=o-Ai(h);if(v<1)return h;var _=m?ei(m,0,v).join(""):e.slice(0,v);if(p===s)return _+h;if(m&&(v+=_.length-v),Po(p)){if(e.slice(v).search(p)){var x,S=_;for(p.global||(p=Ln(p.source,ne(mc.exec(p))+"g")),p.lastIndex=0;x=p.exec(S);)var R=x.index;_=_.slice(0,R===s?v:R)}}else if(e.indexOf(Ze(p),v)!=v){var A=_.lastIndexOf(p);A>-1&&(_=_.slice(0,A))}return _+h}function Ob(e){return e=ne(e),e&&Mm.test(e)?e.replace(dc,sy):e}var Nb=Ui(function(e,t,o){return e+(o?" ":"")+t.toUpperCase()}),Ro=Mu("toUpperCase");function Uh(e,t,o){return e=ne(e),t=o?s:t,t===s?Xv(e)?ay(e):Kv(e):e.match(t)||[]}var Lh=J(function(e,t){try{return Qe(e,s,t)}catch(o){return Io(o)?o:new V(o)}}),Ab=$t(function(e,t){return st(t,function(o){o=Pt(o),Tt(e,o,bo(e[o],e))}),e});function Db(e){var t=e==null?0:e.length,o=U();return e=t?ve(e,function(h){if(typeof h[1]!="function")throw new nt(f);return[o(h[0]),h[1]]}):[],J(function(h){for(var p=-1;++p<t;){var g=e[p];if(Qe(g[0],this,h))return Qe(g[1],this,h)}})}function Fb(e){return s0(at(e,O))}function Co(e){return function(){return e}}function Tb(e,t){return e==null||e!==e?t:e}var qb=ku(),$b=ku(!0);function Je(e){return e}function Oo(e){return yu(typeof e=="function"?e:at(e,O))}function jb(e){return _u(at(e,O))}function Ub(e,t){return bu(e,at(t,O))}var Lb=J(function(e,t){return function(o){return dr(o,e,t)}}),Mb=J(function(e,t){return function(o){return dr(e,o,t)}});function No(e,t,o){var h=Re(t),p=cs(t,h);o==null&&!(ye(t)&&(p.length||!h.length))&&(o=t,t=e,e=this,p=cs(t,Re(t)));var g=!(ye(o)&&"chain"in o)||!!o.chain,m=Ut(e);return st(p,function(v){var _=t[v];e[v]=_,m&&(e.prototype[v]=function(){var x=this.__chain__;if(g||x){var S=e(this.__wrapped__),R=S.__actions__=He(this.__actions__);return R.push({func:_,args:arguments,thisArg:e}),S.__chain__=x,S}return _.apply(e,Jt([this.value()],arguments))})}),e}function zb(){return Ne._===this&&(Ne._=dy),this}function Ao(){}function kb(e){return e=H(e),J(function(t){return Eu(t,e)})}var Vb=ao(ve),Kb=ao(Vc),Hb=ao(Dn);function Mh(e){return go(e)?Fn(Pt(e)):b0(e)}function Bb(e){return function(t){return e==null?s:li(e,t)}}var Gb=Ku(),Jb=Ku(!0);function Do(){return[]}function Fo(){return!1}function Wb(){return{}}function Qb(){return""}function Yb(){return!0}function Zb(e,t){if(e=H(e),e<1||e>Bt)return[];var o=bt,h=Te(e,bt);t=U(t),e-=bt;for(var p=$n(h,t);++o<e;)t(o);return p}function Xb(e){return K(e)?ve(e,Pt):Xe(e)?[e]:He(oh(ne(e)))}function eE(e){var t=++ly;return ne(e)+t}var tE=fs(function(e,t){return e+t},0),iE=co("ceil"),rE=fs(function(e,t){return e/t},1),sE=co("floor");function nE(e){return e&&e.length?as(e,Je,Gn):s}function oE(e,t){return e&&e.length?as(e,U(t,2),Gn):s}function aE(e){return Bc(e,Je)}function cE(e,t){return Bc(e,U(t,2))}function uE(e){return e&&e.length?as(e,Je,Yn):s}function hE(e,t){return e&&e.length?as(e,U(t,2),Yn):s}var lE=fs(function(e,t){return e*t},1),pE=co("round"),dE=fs(function(e,t){return e-t},0);function fE(e){return e&&e.length?qn(e,Je):0}function gE(e,t){return e&&e.length?qn(e,U(t,2)):0}return d.after=j_,d.ary=vh,d.assign=P1,d.assignIn=Ah,d.assignInWith=Rs,d.assignWith=x1,d.at=S1,d.before=yh,d.bind=bo,d.bindAll=Ab,d.bindKey=wh,d.castArray=W_,d.chain=fh,d.chunk=sw,d.compact=nw,d.concat=ow,d.cond=Db,d.conforms=Fb,d.constant=Co,d.countBy=f_,d.create=R1,d.curry=_h,d.curryRight=bh,d.debounce=Eh,d.defaults=C1,d.defaultsDeep=O1,d.defer=U_,d.delay=L_,d.difference=aw,d.differenceBy=cw,d.differenceWith=uw,d.drop=hw,d.dropRight=lw,d.dropRightWhile=pw,d.dropWhile=dw,d.fill=fw,d.filter=m_,d.flatMap=w_,d.flatMapDeep=__,d.flatMapDepth=b_,d.flatten=hh,d.flattenDeep=gw,d.flattenDepth=mw,d.flip=M_,d.flow=qb,d.flowRight=$b,d.fromPairs=vw,d.functions=$1,d.functionsIn=j1,d.groupBy=E_,d.initial=ww,d.intersection=_w,d.intersectionBy=bw,d.intersectionWith=Ew,d.invert=L1,d.invertBy=M1,d.invokeMap=P_,d.iteratee=Oo,d.keyBy=x_,d.keys=Re,d.keysIn=Ge,d.map=bs,d.mapKeys=k1,d.mapValues=V1,d.matches=jb,d.matchesProperty=Ub,d.memoize=Is,d.merge=K1,d.mergeWith=Dh,d.method=Lb,d.methodOf=Mb,d.mixin=No,d.negate=Ps,d.nthArg=kb,d.omit=H1,d.omitBy=B1,d.once=z_,d.orderBy=S_,d.over=Vb,d.overArgs=k_,d.overEvery=Kb,d.overSome=Hb,d.partial=Eo,d.partialRight=Ih,d.partition=R_,d.pick=G1,d.pickBy=Fh,d.property=Mh,d.propertyOf=Bb,d.pull=Sw,d.pullAll=ph,d.pullAllBy=Rw,d.pullAllWith=Cw,d.pullAt=Ow,d.range=Gb,d.rangeRight=Jb,d.rearg=V_,d.reject=N_,d.remove=Nw,d.rest=K_,d.reverse=wo,d.sampleSize=D_,d.set=W1,d.setWith=Q1,d.shuffle=F_,d.slice=Aw,d.sortBy=$_,d.sortedUniq=Uw,d.sortedUniqBy=Lw,d.split=wb,d.spread=H_,d.tail=Mw,d.take=zw,d.takeRight=kw,d.takeRightWhile=Vw,d.takeWhile=Kw,d.tap=n_,d.throttle=B_,d.thru=_s,d.toArray=Ch,d.toPairs=Th,d.toPairsIn=qh,d.toPath=Xb,d.toPlainObject=Nh,d.transform=Y1,d.unary=G_,d.union=Hw,d.unionBy=Bw,d.unionWith=Gw,d.uniq=Jw,d.uniqBy=Ww,d.uniqWith=Qw,d.unset=Z1,d.unzip=_o,d.unzipWith=dh,d.update=X1,d.updateWith=eb,d.values=zi,d.valuesIn=tb,d.without=Yw,d.words=Uh,d.wrap=J_,d.xor=Zw,d.xorBy=Xw,d.xorWith=e_,d.zip=t_,d.zipObject=i_,d.zipObjectDeep=r_,d.zipWith=s_,d.entries=Th,d.entriesIn=qh,d.extend=Ah,d.extendWith=Rs,No(d,d),d.add=tE,d.attempt=Lh,d.camelCase=nb,d.capitalize=$h,d.ceil=iE,d.clamp=ib,d.clone=Q_,d.cloneDeep=Z_,d.cloneDeepWith=X_,d.cloneWith=Y_,d.conformsTo=e1,d.deburr=jh,d.defaultTo=Tb,d.divide=rE,d.endsWith=ob,d.eq=mt,d.escape=ab,d.escapeRegExp=cb,d.every=g_,d.find=v_,d.findIndex=ch,d.findKey=N1,d.findLast=y_,d.findLastIndex=uh,d.findLastKey=A1,d.floor=sE,d.forEach=gh,d.forEachRight=mh,d.forIn=D1,d.forInRight=F1,d.forOwn=T1,d.forOwnRight=q1,d.get=xo,d.gt=t1,d.gte=i1,d.has=U1,d.hasIn=So,d.head=lh,d.identity=Je,d.includes=I_,d.indexOf=yw,d.inRange=rb,d.invoke=z1,d.isArguments=fi,d.isArray=K,d.isArrayBuffer=r1,d.isArrayLike=Be,d.isArrayLikeObject=Ee,d.isBoolean=s1,d.isBuffer=ti,d.isDate=n1,d.isElement=o1,d.isEmpty=a1,d.isEqual=c1,d.isEqualWith=u1,d.isError=Io,d.isFinite=h1,d.isFunction=Ut,d.isInteger=Ph,d.isLength=xs,d.isMap=xh,d.isMatch=l1,d.isMatchWith=p1,d.isNaN=d1,d.isNative=f1,d.isNil=m1,d.isNull=g1,d.isNumber=Sh,d.isObject=ye,d.isObjectLike=we,d.isPlainObject=wr,d.isRegExp=Po,d.isSafeInteger=v1,d.isSet=Rh,d.isString=Ss,d.isSymbol=Xe,d.isTypedArray=Mi,d.isUndefined=y1,d.isWeakMap=w1,d.isWeakSet=_1,d.join=Iw,d.kebabCase=ub,d.last=ut,d.lastIndexOf=Pw,d.lowerCase=hb,d.lowerFirst=lb,d.lt=b1,d.lte=E1,d.max=nE,d.maxBy=oE,d.mean=aE,d.meanBy=cE,d.min=uE,d.minBy=hE,d.stubArray=Do,d.stubFalse=Fo,d.stubObject=Wb,d.stubString=Qb,d.stubTrue=Yb,d.multiply=lE,d.nth=xw,d.noConflict=zb,d.noop=Ao,d.now=Es,d.pad=pb,d.padEnd=db,d.padStart=fb,d.parseInt=gb,d.random=sb,d.reduce=C_,d.reduceRight=O_,d.repeat=mb,d.replace=vb,d.result=J1,d.round=pE,d.runInContext=w,d.sample=A_,d.size=T_,d.snakeCase=yb,d.some=q_,d.sortedIndex=Dw,d.sortedIndexBy=Fw,d.sortedIndexOf=Tw,d.sortedLastIndex=qw,d.sortedLastIndexBy=$w,d.sortedLastIndexOf=jw,d.startCase=_b,d.startsWith=bb,d.subtract=dE,d.sum=fE,d.sumBy=gE,d.template=Eb,d.times=Zb,d.toFinite=Lt,d.toInteger=H,d.toLength=Oh,d.toLower=Ib,d.toNumber=ht,d.toSafeInteger=I1,d.toString=ne,d.toUpper=Pb,d.trim=xb,d.trimEnd=Sb,d.trimStart=Rb,d.truncate=Cb,d.unescape=Ob,d.uniqueId=eE,d.upperCase=Nb,d.upperFirst=Ro,d.each=gh,d.eachRight=mh,d.first=lh,No(d,function(){var e={};return Et(d,function(t,o){oe.call(d.prototype,o)||(e[o]=t)}),e}(),{chain:!1}),d.VERSION=n,st(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){d[e].placeholder=d}),st(["drop","take"],function(e,t){ee.prototype[e]=function(o){o=o===s?1:xe(H(o),0);var h=this.__filtered__&&!t?new ee(this):this.clone();return h.__filtered__?h.__takeCount__=Te(o,h.__takeCount__):h.__views__.push({size:Te(o,bt),type:e+(h.__dir__<0?"Right":"")}),h},ee.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),st(["filter","map","takeWhile"],function(e,t){var o=t+1,h=o==hc||o==Sm;ee.prototype[e]=function(p){var g=this.clone();return g.__iteratees__.push({iteratee:U(p,3),type:o}),g.__filtered__=g.__filtered__||h,g}}),st(["head","last"],function(e,t){var o="take"+(t?"Right":"");ee.prototype[e]=function(){return this[o](1).value()[0]}}),st(["initial","tail"],function(e,t){var o="drop"+(t?"":"Right");ee.prototype[e]=function(){return this.__filtered__?new ee(this):this[o](1)}}),ee.prototype.compact=function(){return this.filter(Je)},ee.prototype.find=function(e){return this.filter(e).head()},ee.prototype.findLast=function(e){return this.reverse().find(e)},ee.prototype.invokeMap=J(function(e,t){return typeof e=="function"?new ee(this):this.map(function(o){return dr(o,e,t)})}),ee.prototype.reject=function(e){return this.filter(Ps(U(e)))},ee.prototype.slice=function(e,t){e=H(e);var o=this;return o.__filtered__&&(e>0||t<0)?new ee(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),t!==s&&(t=H(t),o=t<0?o.dropRight(-t):o.take(t-e)),o)},ee.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ee.prototype.toArray=function(){return this.take(bt)},Et(ee.prototype,function(e,t){var o=/^(?:filter|find|map|reject)|While$/.test(t),h=/^(?:head|last)$/.test(t),p=d[h?"take"+(t=="last"?"Right":""):t],g=h||/^find/.test(t);p&&(d.prototype[t]=function(){var m=this.__wrapped__,v=h?[1]:arguments,_=m instanceof ee,x=v[0],S=_||K(m),R=function(Y){var ie=p.apply(d,Jt([Y],v));return h&&A?ie[0]:ie};S&&o&&typeof x=="function"&&x.length!=1&&(_=S=!1);var A=this.__chain__,q=!!this.__actions__.length,M=g&&!A,B=_&&!q;if(!g&&S){m=B?m:new ee(this);var z=e.apply(m,v);return z.__actions__.push({func:_s,args:[R],thisArg:s}),new ot(z,A)}return M&&B?e.apply(this,v):(z=this.thru(R),M?h?z.value()[0]:z.value():z)})}),st(["pop","push","shift","sort","splice","unshift"],function(e){var t=Br[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",h=/^(?:pop|shift)$/.test(e);d.prototype[e]=function(){var p=arguments;if(h&&!this.__chain__){var g=this.value();return t.apply(K(g)?g:[],p)}return this[o](function(m){return t.apply(K(m)?m:[],p)})}}),Et(ee.prototype,function(e,t){var o=d[t];if(o){var h=o.name+"";oe.call(qi,h)||(qi[h]=[]),qi[h].push({name:t,func:o})}}),qi[ds(s,ae).name]=[{name:"wrapper",func:s}],ee.prototype.clone=Oy,ee.prototype.reverse=Ny,ee.prototype.value=Ay,d.prototype.at=o_,d.prototype.chain=a_,d.prototype.commit=c_,d.prototype.next=u_,d.prototype.plant=l_,d.prototype.reverse=p_,d.prototype.toJSON=d.prototype.valueOf=d.prototype.value=d_,d.prototype.first=d.prototype.head,or&&(d.prototype[or]=h_),d},Di=cy();oi?((oi.exports=Di)._=Di,Cn._=Di):Ne._=Di}).call(Qi)})(rn,rn.exports);var Lg=Object.defineProperty,Mg=Object.defineProperties,zg=Object.getOwnPropertyDescriptors,Xa=Object.getOwnPropertySymbols,kg=Object.prototype.hasOwnProperty,Vg=Object.prototype.propertyIsEnumerable,ec=(u,r,s)=>r in u?Lg(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Dr=(u,r)=>{for(var s in r||(r={}))kg.call(r,s)&&ec(u,s,r[s]);if(Xa)for(var s of Xa(r))Vg.call(r,s)&&ec(u,s,r[s]);return u},Kg=(u,r)=>Mg(u,zg(r));function Kt(u,r,s){var n;const a=jo(u);return((n=r.rpcMap)==null?void 0:n[a.reference])||`${Ug}?chainId=${a.namespace}:${a.reference}&projectId=${s}`}function si(u){return u.includes(":")?u.split(":")[1]:u}function tc(u){return u.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function Hg(u,r){const s=Object.keys(r.namespaces).filter(a=>a.includes(u));if(!s.length)return[];const n=[];return s.forEach(a=>{const l=r.namespaces[a].accounts;n.push(...l)}),n}function ic(u={},r={}){const s=rc(u),n=rc(r);return rn.exports.merge(s,n)}function rc(u){var r,s,n,a;const l={};if(!Ei(u))return l;for(const[f,y]of Object.entries(u)){const b=Pr(f)?[f]:y.chains,I=y.methods||[],C=y.events||[],O=y.rpcMap||{},F=bi(f);l[F]=Kg(Dr(Dr({},l[F]),y),{chains:yt(b,(r=l[F])==null?void 0:r.chains),methods:yt(I,(s=l[F])==null?void 0:s.methods),events:yt(C,(n=l[F])==null?void 0:n.events),rpcMap:Dr(Dr({},O),(a=l[F])==null?void 0:a.rpcMap)})}return l}function Bg(u){return u.includes(":")?u.split(":")[2]:u}function Gg(u){const r={};for(const[s,n]of Object.entries(u)){const a=n.methods||[],l=n.events||[],f=n.accounts||[],y=Pr(s)?[s]:n.chains?n.chains:tc(n.accounts);r[s]={chains:y,methods:a,events:l,accounts:f}}return r}function sn(u){return typeof u=="number"?u:u.includes("0x")?parseInt(u,16):(u=u.includes(":")?u.split(":")[1]:u,isNaN(Number(u))?u:Number(u))}const sc={},ge=u=>sc[u],nn=(u,r)=>{sc[u]=r};class Jg{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var n;const a=si(s);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const n=this.createHttpProvider(r,s);n&&(this.httpProviders[r]=n)}createHttpProvider(r,s){const n=s||Kt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new St.r(new Vt.Z(n,ge("disableProviderPing")))}}class Wg{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=ge("events"),this.client=ge("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(parseInt(r),s),this.chainId=parseInt(r),this.events.emit(Nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,s){const n=s||Kt(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new St.r(new Vt.k(n,ge("disableProviderPing")))}setHttpProvider(r,s){const n=this.createHttpProvider(r,s);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var n;const a=parseInt(si(s));r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[s])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}async handleSwitchChain(r){var s,n;let a=r.request.params?(s=r.request.params[0])==null?void 0:s.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const l=parseInt(a,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class Qg{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var n;const a=si(s);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const n=this.createHttpProvider(r,s);n&&(this.httpProviders[r]=n)}createHttpProvider(r,s){const n=s||Kt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new St.r(new Vt.Z(n,ge("disableProviderPing")))}}class Yg{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var n;const a=si(s);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const n=this.createHttpProvider(r,s);n&&(this.httpProviders[r]=n)}createHttpProvider(r,s){const n=s||Kt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new St.r(new Vt.Z(n,ge("disableProviderPing")))}}class Zg{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{const n=this.getCardanoRPCUrl(s),a=si(s);r[a]=this.createHttpProvider(a,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}getCardanoRPCUrl(r){const s=this.namespace.rpcMap;if(s)return s[r]}setHttpProvider(r,s){const n=this.createHttpProvider(r,s);n&&(this.httpProviders[r]=n)}createHttpProvider(r,s){const n=s||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new St.r(new Vt.Z(n,ge("disableProviderPing")))}}class Xg{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var n;const a=si(s);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const n=this.createHttpProvider(r,s);n&&(this.httpProviders[r]=n)}createHttpProvider(r,s){const n=s||Kt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new St.r(new Vt.Z(n,ge("disableProviderPing")))}}class em{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var n;const a=si(s);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const n=this.createHttpProvider(r,s);n&&(this.httpProviders[r]=n)}createHttpProvider(r,s){const n=s||Kt(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new St.r(new Vt.Z(n,ge("disableProviderPing")))}}class tm{constructor(r){this.name="near",this.namespace=r.namespace,this.events=ge("events"),this.client=ge("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){if(this.chainId=r,!this.httpProviders[r]){const n=s||Kt(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(Nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var n;r[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const n=this.createHttpProvider(r,s);n&&(this.httpProviders[r]=n)}createHttpProvider(r,s){const n=s||Kt(r,this.namespace);return typeof n>"u"?void 0:new St.r(new Vt.Z(n,ge("disableProviderPing")))}}var im=Object.defineProperty,rm=Object.defineProperties,sm=Object.getOwnPropertyDescriptors,nc=Object.getOwnPropertySymbols,nm=Object.prototype.hasOwnProperty,om=Object.prototype.propertyIsEnumerable,oc=(u,r,s)=>r in u?im(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Fr=(u,r)=>{for(var s in r||(r={}))nm.call(r,s)&&oc(u,s,r[s]);if(nc)for(var s of nc(r))om.call(r,s)&&oc(u,s,r[s]);return u},on=(u,r)=>rm(u,sm(r));class an{constructor(r){this.events=new(Cs()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:(0,te.pino)((0,te.getDefaultLoggerOptions)({level:(r==null?void 0:r.logger)||Ya})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const s=new an(r);return await s.initialize(),s}async request(r,s,n){const[a,l]=this.validateChain(s);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:Fr({},r),chainId:`${a}:${l}`,topic:this.session.topic,expiry:n})}sendAsync(r,s,n,a){const l=new Date().getTime();this.request(r,n,a).then(f=>s(null,(0,Z.formatJsonRpcResult)(l,f))).catch(f=>s(f,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:fe("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,s){this.events.on(r,s)}once(r,s){this.events.once(r,s)}removeListener(r,s){this.events.removeListener(r,s)}off(r,s){this.events.off(r,s)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let s=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(s>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(l=>{this.session=l;const f=Gg(l.namespaces);this.namespaces=ic(this.namespaces,f),this.persist("namespaces",this.namespaces)}).catch(l=>{if(l.message!==Ja)throw l;s++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,s){try{if(!this.session)return;const[n,a]=this.validateChain(r);this.getProvider(n).setDefaultChain(a,s)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const s=this.client.pairing.getAll();if(wt(s)){for(const n of s)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${s.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await tn.init({logger:this.providerOpts.logger||Ya,relayUrl:this.providerOpts.relayUrl||qg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(s=>bi(s)))];nn("client",this.client),nn("events",this.events),nn("disableProviderPing",this.disableProviderPing),r.forEach(s=>{if(!this.session)return;const n=Hg(s,this.session),a=tc(n),l=ic(this.namespaces,this.optionalNamespaces),f=on(Fr({},l[s]),{accounts:n,chains:a});switch(s){case"eip155":this.rpcProviders[s]=new Wg({namespace:f});break;case"solana":this.rpcProviders[s]=new Qg({namespace:f});break;case"cosmos":this.rpcProviders[s]=new Yg({namespace:f});break;case"polkadot":this.rpcProviders[s]=new Jg({namespace:f});break;case"cip34":this.rpcProviders[s]=new Zg({namespace:f});break;case"elrond":this.rpcProviders[s]=new Xg({namespace:f});break;case"multiversx":this.rpcProviders[s]=new em({namespace:f});break;case"near":this.rpcProviders[s]=new tm({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:s}=r,{event:n}=s;if(n.name==="accountsChanged"){const a=n.data;a&&wt(a)&&this.events.emit("accountsChanged",a.map(Bg))}else if(n.name==="chainChanged"){const a=s.chainId,l=s.event.data,f=bi(a),y=sn(a)!==sn(l)?`${f}:${sn(l)}`:a;this.onChainChanged(y)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:s})=>{var n;const{namespaces:a}=s,l=(n=this.client)==null?void 0:n.session.get(r);this.session=on(Fr({},l),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:s})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",on(Fr({},fe("USER_DISCONNECTED")),{data:r.topic}))}),this.on(Nt.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var s;this.getProvider(r).updateNamespace((s=this.session)==null?void 0:s.namespaces[r])})}setNamespaces(r){const{namespaces:s,optionalNamespaces:n,sessionProperties:a}=r;s&&Object.keys(s).length&&(this.namespaces=s),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",s),this.persist("optionalNamespaces",n)}validateChain(r){const[s,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[s,n];if(s&&!Object.keys(this.namespaces||{}).map(f=>bi(f)).includes(s))throw new Error(`Namespace '${s}' is not configured. Please call connect() first with namespace config.`);if(s&&n)return[s,n];const a=bi(Object.keys(this.namespaces)[0]),l=this.rpcProviders[a].getDefaultChain();return[a,l]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,s=!1){if(!this.namespaces)return;const[n,a]=this.validateChain(r);a&&(s||this.getProvider(n).setDefaultChain(a),this.namespaces[n]?this.namespaces[n].defaultChain=a:this.namespaces[`${n}:${a}`]?this.namespaces[`${n}:${a}`].defaultChain=a:this.namespaces[`${n}:${a}`]={defaultChain:a},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,s){this.client.core.storage.setItem(`${Za}/${r}`,s)}async getFromStore(r){return await this.client.core.storage.getItem(`${Za}/${r}`)}}const am=an,cm="wc",um="ethereum_provider",hm=`${cm}@2:${um}:`,lm="https://rpc.walletconnect.com/v1/",cn=["eth_sendTransaction","personal_sign"],pm=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],un=["chainChanged","accountsChanged"],dm=["chainChanged","accountsChanged","message","disconnect","connect"];var fm=Object.defineProperty,gm=Object.defineProperties,mm=Object.getOwnPropertyDescriptors,ac=Object.getOwnPropertySymbols,vm=Object.prototype.hasOwnProperty,ym=Object.prototype.propertyIsEnumerable,cc=(u,r,s)=>r in u?fm(u,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[r]=s,Yi=(u,r)=>{for(var s in r||(r={}))vm.call(r,s)&&cc(u,s,r[s]);if(ac)for(var s of ac(r))ym.call(r,s)&&cc(u,s,r[s]);return u},uc=(u,r)=>gm(u,mm(r));function Tr(u){return Number(u[0].split(":")[1])}function hn(u){return`0x${u.toString(16)}`}function wm(u){const{chains:r,optionalChains:s,methods:n,optionalMethods:a,events:l,optionalEvents:f,rpcMap:y}=u;if(!wt(r))throw new Error("Invalid chains");const b={chains:r,methods:n||cn,events:l||un,rpcMap:Yi({},r.length?{[Tr(r)]:y[Tr(r)]}:{})},I=l==null?void 0:l.filter(Q=>!un.includes(Q)),C=n==null?void 0:n.filter(Q=>!cn.includes(Q));if(!s&&!f&&!a&&!(I!=null&&I.length)&&!(C!=null&&C.length))return{required:r.length?b:void 0};const O=(I==null?void 0:I.length)&&(C==null?void 0:C.length)||!s,F={chains:[...new Set(O?b.chains.concat(s||[]):s)],methods:[...new Set(b.methods.concat(a!=null&&a.length?a:pm))],events:[...new Set(b.events.concat(f!=null&&f.length?f:dm))],rpcMap:y};return{required:r.length?b:void 0,optional:s.length?F:void 0}}class ln{constructor(){this.events=new xt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=hm,this.on=(r,s)=>(this.events.on(r,s),this),this.once=(r,s)=>(this.events.once(r,s),this),this.removeListener=(r,s)=>(this.events.removeListener(r,s),this),this.off=(r,s)=>(this.events.off(r,s),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const s=new ln;return await s.initialize(r),s}async request(r,s){return await this.signer.request(r,this.formatChainId(this.chainId),s)}sendAsync(r,s,n){this.signer.sendAsync(r,s,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:s,optional:n}=wm(this.rpc);try{const a=await new Promise(async(f,y)=>{var b;this.rpc.showQrModal&&((b=this.modal)==null||b.subscribeModal(I=>{!I.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(uc(Yi({namespaces:Yi({},s&&{[this.namespace]:s})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(I=>{f(I)}).catch(I=>{y(new Error(I.message))})});if(!a)return;const l=Zh(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:l),this.setAccounts(l),this.events.emit("connect",{chainId:hn(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:s}=r,{event:n}=s;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const s=parseInt(r);this.chainId=s,this.events.emit("chainChanged",hn(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",uc(Yi({},fe("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var s,n;this.rpc.showQrModal&&((s=this.modal)==null||s.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const s=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));s.length&&(this.chainId=s[0],this.events.emit("chainChanged",hn(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const s=this.parseChainId(r);this.chainId=s,this.switchEthereumChain(s)}}parseAccountId(r){const[s,n,a]=r.split(":");return{chainId:`${s}:${n}`,address:a}}setAccounts(r){this.accounts=r.filter(s=>this.parseChainId(this.parseAccountId(s).chainId)===this.chainId).map(s=>this.parseAccountId(s).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var s,n;const a=(s=r==null?void 0:r.chains)!=null?s:[],l=(n=r==null?void 0:r.optionalChains)!=null?n:[],f=a.concat(l);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=a.length?(r==null?void 0:r.methods)||cn:[],b=a.length?(r==null?void 0:r.events)||un:[],I=(r==null?void 0:r.optionalMethods)||[],C=(r==null?void 0:r.optionalEvents)||[],O=(r==null?void 0:r.rpcMap)||this.buildRpcMap(f,r.projectId),F=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(Q=>this.formatChainId(Q)),optionalChains:l.map(Q=>this.formatChainId(Q)),methods:y,events:b,optionalMethods:I,optionalEvents:C,rpcMap:O,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:F,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,s){const n={};return r.forEach(a=>{n[a]=this.getRpcUrl(a,s)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?Tr(this.rpc.chains):Tr(this.rpc.optionalChains),this.signer=await am.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let s;try{const{WalletConnectModal:n}=await $.e(5707).then($.bind($,5707));s=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(s)try{this.modal=new s(Yi({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:s,optionalChains:n,rpcMap:a}=r;s&&wt(s)&&(this.rpc.chains=s.map(l=>this.formatChainId(l)),s.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)})),n&&wt(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(l=>this.formatChainId(l)),n.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)}))}getRpcUrl(r,s){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${lm}?chainId=eip155:${r}&projectId=${s||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),s=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:s==null?void 0:s.accounts),this.setAccounts(s==null?void 0:s.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(s=>this.parseAccount(s))}}const _m=ln}}]);
