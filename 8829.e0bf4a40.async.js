(self.webpackChunk_ant_design_web3_docs=self.webpackChunk_ant_design_web3_docs||[]).push([[8829],{22982:function(Di,At,Y){"use strict";Y.d(At,{EthereumProvider:function(){return Rg}});var Te=Y(72100),ci=Y.n(Te),d=Y(71586),fe=Y(53070),Ut=Y(19994),se=Y(56526),Ht=Y(36900);class Ms extends Ht.q{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class Do{constructor(r,s,o){this.core=r,this.logger=s}}class Ls extends Ht.q{constructor(r,s){super(),this.core=r,this.logger=s,this.records=new Map}}class $s{constructor(r,s){this.logger=r,this.core=s}}class js extends Ht.q{constructor(r,s){super(),this.relayer=r,this.logger=s}}class zs extends Ht.q{constructor(r){super()}}class zr{constructor(r,s,o,a){this.core=r,this.logger=s,this.name=o}}class Fo{constructor(){this.map=new Map}}class Ur extends Ht.q{constructor(r,s){super(),this.relayer=r,this.logger=s}}class ko{constructor(r,s){this.core=r,this.logger=s}}class Us extends Ht.q{constructor(r,s){super(),this.core=r,this.logger=s}}class q{constructor(r,s){this.logger=r,this.core=s}}class N{constructor(r,s,o){this.core=r,this.logger=s,this.store=o}}class k{constructor(r,s){this.projectId=r,this.logger=s}}class K{constructor(r,s,o){this.core=r,this.logger=s,this.telemetryEnabled=o}}class X extends null{constructor(){super()}}class we{constructor(r){this.opts=r,this.protocol="wc",this.version=2}}class he extends null{constructor(){super()}}class Xe{constructor(r){this.client=r}}var Kt=Y(41926),Vt=Y(70083),Hr=Y(90032),L=Y(46196),mt=Y(56390),W=Y(23700),wu=Y(66865),_u=Y(5899),bu=Y.n(_u);function Eu(y,r){if(y.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),o=0;o<s.length;o++)s[o]=255;for(var a=0;a<y.length;a++){var u=y.charAt(a),l=u.charCodeAt(0);if(s[l]!==255)throw new TypeError(u+" is ambiguous");s[l]=a}var v=y.length,_=y.charAt(0),I=Math.log(v)/Math.log(256),O=Math.log(256)/Math.log(v);function T(M){if(M instanceof Uint8Array||(ArrayBuffer.isView(M)?M=new Uint8Array(M.buffer,M.byteOffset,M.byteLength):Array.isArray(M)&&(M=Uint8Array.from(M))),!(M instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(M.length===0)return"";for(var U=0,j=0,z=0,ee=M.length;z!==ee&&M[z]===0;)z++,U++;for(var pe=(ee-z)*O+1>>>0,Q=new Uint8Array(pe);z!==ee;){for(var Z=M[z],Ie=0,be=pe-1;(Z!==0||Ie<j)&&be!==-1;be--,Ie++)Z+=256*Q[be]>>>0,Q[be]=Z%v>>>0,Z=Z/v>>>0;if(Z!==0)throw new Error("Non-zero carry");j=Ie,z++}for(var de=pe-j;de!==pe&&Q[de]===0;)de++;for(var Pt=_.repeat(U);de<pe;++de)Pt+=y.charAt(Q[de]);return Pt}function D(M){if(typeof M!="string")throw new TypeError("Expected String");if(M.length===0)return new Uint8Array;var U=0;if(M[U]!==" "){for(var j=0,z=0;M[U]===_;)j++,U++;for(var ee=(M.length-U)*I+1>>>0,pe=new Uint8Array(ee);M[U];){var Q=s[M.charCodeAt(U)];if(Q===255)return;for(var Z=0,Ie=ee-1;(Q!==0||Z<z)&&Ie!==-1;Ie--,Z++)Q+=v*pe[Ie]>>>0,pe[Ie]=Q%256>>>0,Q=Q/256>>>0;if(Q!==0)throw new Error("Non-zero carry");z=Z,U++}if(M[U]!==" "){for(var be=ee-z;be!==ee&&pe[be]===0;)be++;for(var de=new Uint8Array(j+(ee-be)),Pt=j;be!==ee;)de[Pt++]=pe[be++];return de}}}function A(M){var U=D(M);if(U)return U;throw new Error(`Non-${r} character`)}return{encode:T,decodeUnsafe:D,decode:A}}var Iu=Eu,Pu=Iu;const Mo=y=>{if(y instanceof Uint8Array&&y.constructor.name==="Uint8Array")return y;if(y instanceof ArrayBuffer)return new Uint8Array(y);if(ArrayBuffer.isView(y))return new Uint8Array(y.buffer,y.byteOffset,y.byteLength);throw new Error("Unknown type, must be binary type")},Cu=y=>new TextEncoder().encode(y),xu=y=>new TextDecoder().decode(y);class Su{constructor(r,s,o){this.name=r,this.prefix=s,this.baseEncode=o}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Ru{constructor(r,s,o){if(this.name=r,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=o}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return Lo(this,r)}}class Ou{constructor(r){this.decoders=r}or(r){return Lo(this,r)}decode(r){const s=r[0],o=this.decoders[s];if(o)return o.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Lo=(y,r)=>new Ou({...y.decoders||{[y.prefix]:y},...r.decoders||{[r.prefix]:r}});class Tu{constructor(r,s,o,a){this.name=r,this.prefix=s,this.baseEncode=o,this.baseDecode=a,this.encoder=new Su(r,s,o),this.decoder=new Ru(r,s,a)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const Hs=({name:y,prefix:r,encode:s,decode:o})=>new Tu(y,r,s,o),as=({prefix:y,name:r,alphabet:s})=>{const{encode:o,decode:a}=Pu(s,r);return Hs({prefix:y,name:r,encode:o,decode:u=>Mo(a(u))})},Au=(y,r,s,o)=>{const a={};for(let O=0;O<r.length;++O)a[r[O]]=O;let u=y.length;for(;y[u-1]==="=";)--u;const l=new Uint8Array(u*s/8|0);let v=0,_=0,I=0;for(let O=0;O<u;++O){const T=a[y[O]];if(T===void 0)throw new SyntaxError(`Non-${o} character`);_=_<<s|T,v+=s,v>=8&&(v-=8,l[I++]=255&_>>v)}if(v>=s||255&_<<8-v)throw new SyntaxError("Unexpected end of data");return l},Nu=(y,r,s)=>{const o=r[r.length-1]==="=",a=(1<<s)-1;let u="",l=0,v=0;for(let _=0;_<y.length;++_)for(v=v<<8|y[_],l+=8;l>s;)l-=s,u+=r[a&v>>l];if(l&&(u+=r[a&v<<s-l]),o)for(;u.length*s&7;)u+="=";return u},je=({name:y,prefix:r,bitsPerChar:s,alphabet:o})=>Hs({prefix:r,name:y,encode(a){return Nu(a,o,s)},decode(a){return Au(a,o,s,y)}}),qu=Hs({prefix:"\0",name:"identity",encode:y=>xu(y),decode:y=>Cu(y)});var Du=Object.freeze({__proto__:null,identity:qu});const Fu=je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ku=Object.freeze({__proto__:null,base2:Fu});const Mu=je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Lu=Object.freeze({__proto__:null,base8:Mu});const $u=as({prefix:"9",name:"base10",alphabet:"0123456789"});var ju=Object.freeze({__proto__:null,base10:$u});const zu=je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Uu=je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Hu=Object.freeze({__proto__:null,base16:zu,base16upper:Uu});const Ku=je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Vu=je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Bu=je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ju=je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Gu=je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Wu=je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Qu=je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Yu=je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Zu=je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Xu=Object.freeze({__proto__:null,base32:Ku,base32upper:Vu,base32pad:Bu,base32padupper:Ju,base32hex:Gu,base32hexupper:Wu,base32hexpad:Qu,base32hexpadupper:Yu,base32z:Zu});const el=as({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),tl=as({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var il=Object.freeze({__proto__:null,base36:el,base36upper:tl});const sl=as({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),rl=as({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var nl=Object.freeze({__proto__:null,base58btc:sl,base58flickr:rl});const ol=je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),al=je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),cl=je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hl=je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ul=Object.freeze({__proto__:null,base64:ol,base64pad:al,base64url:cl,base64urlpad:hl});const $o=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ll=$o.reduce((y,r,s)=>(y[s]=r,y),[]),pl=$o.reduce((y,r,s)=>(y[r.codePointAt(0)]=s,y),[]);function dl(y){return y.reduce((r,s)=>(r+=ll[s],r),"")}function gl(y){const r=[];for(const s of y){const o=pl[s.codePointAt(0)];if(o===void 0)throw new Error(`Non-base256emoji character: ${s}`);r.push(o)}return new Uint8Array(r)}const fl=Hs({prefix:"\u{1F680}",name:"base256emoji",encode:dl,decode:gl});var yl=Object.freeze({__proto__:null,base256emoji:fl}),vl=zo,jo=128,ml=127,wl=~ml,_l=Math.pow(2,31);function zo(y,r,s){r=r||[],s=s||0;for(var o=s;y>=_l;)r[s++]=y&255|jo,y/=128;for(;y&wl;)r[s++]=y&255|jo,y>>>=7;return r[s]=y|0,zo.bytes=s-o+1,r}var bl=Kr,El=128,Uo=127;function Kr(y,o){var s=0,o=o||0,a=0,u=o,l,v=y.length;do{if(u>=v)throw Kr.bytes=0,new RangeError("Could not decode varint");l=y[u++],s+=a<28?(l&Uo)<<a:(l&Uo)*Math.pow(2,a),a+=7}while(l>=El);return Kr.bytes=u-o,s}var Il=Math.pow(2,7),Pl=Math.pow(2,14),Cl=Math.pow(2,21),xl=Math.pow(2,28),Sl=Math.pow(2,35),Rl=Math.pow(2,42),Ol=Math.pow(2,49),Tl=Math.pow(2,56),Al=Math.pow(2,63),Nl=function(y){return y<Il?1:y<Pl?2:y<Cl?3:y<xl?4:y<Sl?5:y<Rl?6:y<Ol?7:y<Tl?8:y<Al?9:10},ql={encode:vl,decode:bl,encodingLength:Nl},Ho=ql;const Ko=(y,r,s=0)=>(Ho.encode(y,r,s),r),Vo=y=>Ho.encodingLength(y),Vr=(y,r)=>{const s=r.byteLength,o=Vo(y),a=o+Vo(s),u=new Uint8Array(a+s);return Ko(y,u,0),Ko(s,u,o),u.set(r,a),new Dl(y,s,r,u)};class Dl{constructor(r,s,o,a){this.code=r,this.size=s,this.digest=o,this.bytes=a}}const Bo=({name:y,code:r,encode:s})=>new Fl(y,r,s);class Fl{constructor(r,s,o){this.name=r,this.code=s,this.encode=o}digest(r){if(r instanceof Uint8Array){const s=this.encode(r);return s instanceof Uint8Array?Vr(this.code,s):s.then(o=>Vr(this.code,o))}else throw Error("Unknown type, must be binary type")}}const Jo=y=>async r=>new Uint8Array(await crypto.subtle.digest(y,r)),kl=Bo({name:"sha2-256",code:18,encode:Jo("SHA-256")}),Ml=Bo({name:"sha2-512",code:19,encode:Jo("SHA-512")});var Ll=Object.freeze({__proto__:null,sha256:kl,sha512:Ml});const Go=0,$l="identity",Wo=Mo;var jl=Object.freeze({__proto__:null,identity:{code:Go,name:$l,encode:Wo,digest:y=>Vr(Go,Wo(y))}});new TextEncoder,new TextDecoder;const Qo={...Du,...ku,...Lu,...ju,...Hu,...Xu,...il,...nl,...ul,...yl};({...Ll,...jl});function zl(y=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(y):new Uint8Array(y)}function Yo(y,r,s,o){return{name:y,prefix:r,encoder:{name:y,prefix:r,encode:s},decoder:{decode:o}}}const Zo=Yo("utf8","u",y=>"u"+new TextDecoder("utf8").decode(y),y=>new TextEncoder().encode(y.substring(1))),Br=Yo("ascii","a",y=>{let r="a";for(let s=0;s<y.length;s++)r+=String.fromCharCode(y[s]);return r},y=>{y=y.substring(1);const r=zl(y.length);for(let s=0;s<y.length;s++)r[s]=y.charCodeAt(s);return r}),Ul={utf8:Zo,"utf-8":Zo,hex:Qo.base16,latin1:Br,ascii:Br,binary:Br,...Qo};function Hl(y,r="utf8"){const s=Ul[r];if(!s)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(y,"utf8"):s.decoder.decode(`${s.prefix}${y}`)}const Xo="wc",ea=2,Jr="core",Nt=`${Xo}@2:${Jr}:`,Kl={name:Jr,logger:"error"},Vl={database:":memory:"},Bl="crypto",ta="client_ed25519_seed",Jl=L.ONE_DAY,Gl="keychain",Wl="0.3",Ql="messages",Yl="0.3",Zl=L.SIX_HOURS,Xl="publisher",ia="irn",ep="error",sa="wss://relay.walletconnect.org",tp="relayer",Ve={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ip="_subscription",ct={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},sp=.1,fb={database:":memory:"},ra="2.16.1",yb=1e4,_e={link_mode:"link_mode",relay:"relay"},rp="0.3",np="WALLETCONNECT_CLIENT_ID",na="WALLETCONNECT_LINK_MODE_APPS",qt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},vb=null,op="subscription",ap="0.3",cp=L.FIVE_SECONDS*1e3,hp="pairing",up="0.3",mb=null,cs={wc_pairingDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:L.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:L.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:L.ONE_DAY,prompt:!1,tag:0},res:{ttl:L.ONE_DAY,prompt:!1,tag:0}}},Fi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},wt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},lp="history",pp="0.3",dp="expirer",ht={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},gp="0.3",wb=null,fp="verify-api",yp="https://verify.walletconnect.com",oa="https://verify.walletconnect.org",hs=oa,vp=`${hs}/v3`,mp=[yp,oa],wp="echo",_p="https://echo.walletconnect.com",_b="event-client",Dt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Bt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},_t={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},mi={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},wi={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},us={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},bp=.1,Ep="event-client",Ip=86400,Pp="https://pulse.walletconnect.com/batch";class Cp{constructor(r,s){this.core=r,this.logger=s,this.keychain=new Map,this.name=Gl,this.version=Wl,this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{if(!this.initialized){const o=await this.getKeyChain();typeof o<"u"&&(this.keychain=o),this.initialized=!0}},this.has=o=>(this.isInitialized(),this.keychain.has(o)),this.set=async(o,a)=>{this.isInitialized(),this.keychain.set(o,a),await this.persist()},this.get=o=>{this.isInitialized();const a=this.keychain.get(o);if(typeof a>"u"){const{message:u}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${o}`);throw new Error(u)}return a},this.del=async o=>{this.isInitialized(),this.keychain.delete(o),await this.persist()},this.core=r,this.logger=(0,se.Ep)(s,this.name)}get context(){return(0,se.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,(0,d.KCv)(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?(0,d.IPd)(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class xp{constructor(r,s,o){this.core=r,this.logger=s,this.name=Bl,this.randomSessionIdentifier=(0,d.jdp)(),this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=Vt.generateKeyPair(a);return Vt.encodeIss(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=(0,d.Au2)();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),l=Vt.generateKeyPair(u),v=this.randomSessionIdentifier,_=Jl;return await Vt.signJWT(v,a,_,l)},this.generateSharedKey=(a,u,l)=>{this.isInitialized();const v=this.getPrivateKey(a),_=(0,d.m$A)(v,u);return this.setSymKey(_,l)},this.setSymKey=async(a,u)=>{this.isInitialized();const l=u||(0,d.YmJ)(a);return await this.keychain.set(l,a),l},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,l)=>{this.isInitialized();const v=(0,d.ENt)(l),_=(0,Kt.u)(u);if((0,d.Hs$)(v))return(0,d.Spz)(_,l==null?void 0:l.encoding);if((0,d.Q8x)(v)){const D=v.senderPublicKey,A=v.receiverPublicKey;a=await this.generateSharedKey(D,A)}const I=this.getSymKey(a),{type:O,senderPublicKey:T}=v;return(0,d.HIp)({type:O,symKey:I,message:_,senderPublicKey:T,encoding:l==null?void 0:l.encoding})},this.decode=async(a,u,l)=>{this.isInitialized();const v=(0,d.Llj)(u,l);if((0,d.Hs$)(v)){const _=(0,d.xQU)(u,l==null?void 0:l.encoding);return(0,Kt.D)(_)}if((0,d.Q8x)(v)){const _=v.receiverPublicKey,I=v.senderPublicKey;a=await this.generateSharedKey(_,I)}try{const _=this.getSymKey(a),I=(0,d.peR)({symKey:_,encoded:u,encoding:l==null?void 0:l.encoding});return(0,Kt.D)(I)}catch(_){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(_)}},this.getPayloadType=(a,u=d.$dT)=>{const l=(0,d.vBi)({encoded:a,encoding:u});return(0,d.WGe)(l.type)},this.getPayloadSenderPublicKey=(a,u=d.$dT)=>{const l=(0,d.vBi)({encoded:a,encoding:u});return l.senderPublicKey?(0,Hr.BB)(l.senderPublicKey,d.AWt):void 0},this.core=r,this.logger=(0,se.Ep)(s,this.name),this.keychain=o||new Cp(this.core,this.logger)}get context(){return(0,se.Fd)(this.logger)}async setPrivateKey(r,s){return await this.keychain.set(r,s),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(ta)}catch{r=(0,d.jdp)(),await this.keychain.set(ta,r)}return Hl(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Sp extends $s{constructor(r,s){super(r,s),this.logger=r,this.core=s,this.messages=new Map,this.name=Ql,this.version=Yl,this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const o=await this.getRelayerMessages();typeof o<"u"&&(this.messages=o),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(o){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(o)}finally{this.initialized=!0}}},this.set=async(o,a)=>{this.isInitialized();const u=(0,d.rjm)(a);let l=this.messages.get(o);return typeof l>"u"&&(l={}),typeof l[u]<"u"||(l[u]=a,this.messages.set(o,l),await this.persist()),u},this.get=o=>{this.isInitialized();let a=this.messages.get(o);return typeof a>"u"&&(a={}),a},this.has=(o,a)=>{this.isInitialized();const u=this.get(o),l=(0,d.rjm)(a);return typeof u[l]<"u"},this.del=async o=>{this.isInitialized(),this.messages.delete(o),await this.persist()},this.logger=(0,se.Ep)(r,this.name),this.core=s}get context(){return(0,se.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,(0,d.KCv)(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?(0,d.IPd)(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Rp extends js{constructor(r,s){super(r,s),this.relayer=r,this.logger=s,this.events=new Te.EventEmitter,this.name=Xl,this.queue=new Map,this.publishTimeout=(0,L.toMiliseconds)(L.ONE_MINUTE),this.failedPublishTimeout=(0,L.toMiliseconds)(L.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(o,a,u)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:u}});const v=(u==null?void 0:u.ttl)||Zl,_=(0,d._HE)(u),I=(u==null?void 0:u.prompt)||!1,O=(u==null?void 0:u.tag)||0,T=(u==null?void 0:u.id)||(0,W.getBigIntRpcId)().toString(),D={topic:o,message:a,opts:{ttl:v,relay:_,prompt:I,tag:O,id:T,attestation:u==null?void 0:u.attestation}},A=`Failed to publish payload, please try again. id:${T} tag:${O}`,M=Date.now();let U,j=1;try{for(;U===void 0;){if(Date.now()-M>this.publishTimeout)throw new Error(A);this.logger.trace({id:T,attempts:j},`publisher.publish - attempt ${j}`),U=await await(0,d.hFY)(this.rpcPublish(o,a,v,_,I,O,T,u==null?void 0:u.attestation).catch(z=>this.logger.warn(z)),this.publishTimeout,A),j++,U||await new Promise(z=>setTimeout(z,this.failedPublishTimeout))}this.relayer.events.emit(Ve.publish,D),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:T,topic:o,message:a,opts:u}})}catch(z){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(z),(l=u==null?void 0:u.internal)!=null&&l.throwOnFailedPublish)throw z;this.queue.set(T,D)}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.relayer=r,this.logger=(0,se.Ep)(s,this.name),this.registerEventListeners()}get context(){return(0,se.Fd)(this.logger)}rpcPublish(r,s,o,a,u,l,v,_){var I,O,T,D;const A={method:(0,d.cOS)(a.protocol).publish,params:{topic:r,message:s,ttl:o,prompt:u,tag:l,attestation:_},id:v};return(0,d.o8e)((I=A.params)==null?void 0:I.prompt)&&((O=A.params)==null||delete O.prompt),(0,d.o8e)((T=A.params)==null?void 0:T.tag)&&((D=A.params)==null||delete D.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:A}),this.relayer.request(A)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:s,message:o,opts:a}=r;await this.publish(s,o,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ut.Lx.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ve.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ve.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class Op{constructor(){this.map=new Map,this.set=(r,s)=>{const o=this.get(r);this.exists(r,s)||this.map.set(r,[...o,s])},this.get=r=>this.map.get(r)||[],this.exists=(r,s)=>this.get(r).includes(s),this.delete=(r,s)=>{if(typeof s>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const o=this.get(r);if(!this.exists(r,s))return;const a=o.filter(u=>u!==s);if(!a.length){this.map.delete(r);return}this.map.set(r,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Tp=Object.defineProperty,Ap=Object.defineProperties,Np=Object.getOwnPropertyDescriptors,aa=Object.getOwnPropertySymbols,qp=Object.prototype.hasOwnProperty,Dp=Object.prototype.propertyIsEnumerable,ca=(y,r,s)=>r in y?Tp(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,ls=(y,r)=>{for(var s in r||(r={}))qp.call(r,s)&&ca(y,s,r[s]);if(aa)for(var s of aa(r))Dp.call(r,s)&&ca(y,s,r[s]);return y},Gr=(y,r)=>Ap(y,Np(r));class Fp extends Ur{constructor(r,s){super(r,s),this.relayer=r,this.logger=s,this.subscriptions=new Map,this.topicMap=new Op,this.events=new Te.EventEmitter,this.name=op,this.version=ap,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Nt,this.subscribeTimeout=(0,L.toMiliseconds)(L.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.pendingBatchMessages=[],this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId(),await this.restore()),this.initialized=!0},this.subscribe=async(o,a)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const u=(0,d._HE)(a),l={topic:o,relay:u,transportType:a==null?void 0:a.transportType};this.pending.set(o,l);const v=await this.rpcSubscribe(o,u,a==null?void 0:a.transportType);return typeof v=="string"&&(this.onSubscribe(v,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}})),v}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(o,a.id,a):await this.unsubscribeByTopic(o,a)},this.isSubscribed=async o=>{if(this.topics.includes(o))return!0;const a=`${this.pendingSubscriptionWatchLabel}_${o}`;return await new Promise((u,l)=>{const v=new L.Watch;v.start(a);const _=setInterval(()=>{!this.pending.has(o)&&this.topics.includes(o)&&(clearInterval(_),v.stop(a),u(!0)),v.elapsed(a)>=cp&&(clearInterval(_),v.stop(a),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=(0,se.Ep)(s,this.name),this.clientId=""}get context(){return(0,se.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,s){let o=!1;try{o=this.getSubscription(r).topic===s}catch{}return o}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,s){const o=this.topicMap.get(r);await Promise.all(o.map(async a=>await this.unsubscribeById(r,a,s)))}async unsubscribeById(r,s,o){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:s,opts:o}});try{const a=(0,d._HE)(o);await this.rpcUnsubscribe(r,s,a);const u=(0,d.D6H)("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,s,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:s,opts:o}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(r,s,o=_e.relay){o===_e.relay&&await this.restartToComplete();const a={method:(0,d.cOS)(s.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});try{const u=(0,d.rjm)(r+this.clientId);return o===_e.link_mode?(setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(l=>this.logger.warn(l))},(0,L.toMiliseconds)(L.ONE_SECOND)),u):await await(0,d.hFY)(this.relayer.request(a).catch(l=>this.logger.warn(l)),this.subscribeTimeout)?u:null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ve.connection_stalled)}return null}async rpcBatchSubscribe(r){if(!r.length)return;const s=r[0].relay,o={method:(0,d.cOS)(s.protocol).batchSubscribe,params:{topics:r.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await(0,d.hFY)(this.relayer.request(o).catch(a=>this.logger.warn(a)),this.subscribeTimeout)}catch{this.relayer.events.emit(Ve.connection_stalled)}}async rpcBatchFetchMessages(r){if(!r.length)return;const s=r[0].relay,o={method:(0,d.cOS)(s.protocol).batchFetchMessages,params:{topics:r.map(u=>u.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});let a;try{a=await await(0,d.hFY)(this.relayer.request(o).catch(u=>this.logger.warn(u)),this.subscribeTimeout)}catch{this.relayer.events.emit(Ve.connection_stalled)}return a}rpcUnsubscribe(r,s,o){const a={method:(0,d.cOS)(o.protocol).unsubscribe,params:{topic:r,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(r,s){this.setSubscription(r,Gr(ls({},s),{id:r})),this.pending.delete(s.topic)}onBatchSubscribe(r){r.length&&r.forEach(s=>{this.setSubscription(s.id,ls({},s)),this.pending.delete(s.topic)})}async onUnsubscribe(r,s,o){this.events.removeAllListeners(s),this.hasSubscription(s,r)&&this.deleteSubscription(s,o),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,s){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:s}),this.addSubscription(r,s)}addSubscription(r,s){this.subscriptions.set(r,ls({},s)),this.topicMap.set(s.topic,r),this.events.emit(qt.created,s)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const s=this.subscriptions.get(r);if(!s){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s}deleteSubscription(r,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:s});const o=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(o.topic,r),this.events.emit(qt.deleted,Gr(ls({},o),{reason:s}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(qt.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<r;s++){const o=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchFetchMessages(o),await this.batchSubscribe(o)}}this.events.emit(qt.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:s}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const s=await this.rpcBatchSubscribe(r);(0,d.qt8)(s)&&this.onBatchSubscribe(s.map((o,a)=>Gr(ls({},r[a]),{id:o})))}async batchFetchMessages(r){if(!r.length)return;this.logger.trace(`Fetching batch messages for ${r.length} subscriptions`);const s=await this.rpcBatchFetchMessages(r);s&&s.messages&&(this.pendingBatchMessages=this.pendingBatchMessages.concat(s.messages))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const r=[];this.pending.forEach(s=>{r.push(s)}),await this.batchSubscribe(r),this.pendingBatchMessages.length&&(await this.relayer.handleBatchMessageEvents(this.pendingBatchMessages),this.pendingBatchMessages=[])}registerEventListeners(){this.relayer.core.heartbeat.on(Ut.Lx.pulse,async()=>{await this.checkPending()}),this.events.on(qt.created,async r=>{const s=qt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()}),this.events.on(qt.deleted,async r=>{const s=qt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){!this.relayer.connected&&!this.relayer.connecting&&await this.relayer.transportOpen(),this.restartInProgress&&await new Promise(r=>{const s=setInterval(()=>{this.restartInProgress||(clearInterval(s),r())},this.pollingInterval)})}}var kp=Object.defineProperty,ha=Object.getOwnPropertySymbols,Mp=Object.prototype.hasOwnProperty,Lp=Object.prototype.propertyIsEnumerable,ua=(y,r,s)=>r in y?kp(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,$p=(y,r)=>{for(var s in r||(r={}))Mp.call(r,s)&&ua(y,s,r[s]);if(ha)for(var s of ha(r))Lp.call(r,s)&&ua(y,s,r[s]);return y};class jp extends zs{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Te.EventEmitter,this.name=tp,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=(0,L.toMiliseconds)(L.THIRTY_SECONDS+L.ONE_SECOND),this.request=async s=>{var o,a;this.logger.debug("Publishing Request Payload");const u=s.id||(0,W.getBigIntRpcId)().toString();await this.toEstablishConnection();try{const l=this.provider.request(s);this.requestsInFlight.set(u,{promise:l,request:s}),this.logger.trace({id:u,method:s.method,topic:(o=s.params)==null?void 0:o.topic},"relayer.request - attempt to publish...");const v=await new Promise(async(_,I)=>{const O=()=>{I(new Error(`relayer.request - publish interrupted, id: ${u}`))};this.provider.on(ct.disconnect,O);const T=await l;this.provider.off(ct.disconnect,O),_(T)});return this.logger.trace({id:u,method:s.method,topic:(a=s.params)==null?void 0:a.topic},"relayer.request - published"),v}catch(l){throw this.logger.debug(`Failed to Publish Request: ${u}`),l}finally{this.requestsInFlight.delete(u)}},this.resetPingTimeout=()=>{if((0,d.UGU)())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var s,o,a;(a=(o=(s=this.provider)==null?void 0:s.connection)==null?void 0:o.socket)==null||a.terminate()},this.heartBeatTimeout)}catch(s){this.logger.warn(s)}},this.onPayloadHandler=s=>{this.onProviderPayload(s),this.resetPingTimeout()},this.onConnectHandler=()=>{this.logger.trace("relayer connected"),this.startPingTimeout(),this.events.emit(Ve.connect)},this.onDisconnectHandler=()=>{this.logger.trace("relayer disconnected"),this.onProviderDisconnect()},this.onProviderErrorHandler=s=>{this.logger.error(s),this.events.emit(Ve.error,s),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ct.payload,this.onPayloadHandler),this.provider.on(ct.connect,this.onConnectHandler),this.provider.on(ct.disconnect,this.onDisconnectHandler),this.provider.on(ct.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?(0,se.Ep)(r.logger,this.name):(0,se.gw)((0,se.jI)({level:r.logger||ep})),this.messages=new Sp(this.logger,r.core),this.subscriber=new Fp(this,this.logger),this.publisher=new Rp(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||sa,this.projectId=r.projectId,this.bundleId=(0,d.X_B)(),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.cached.length>0)try{await this.transportOpen()}catch(r){this.logger.warn(r)}}get context(){return(0,se.Fd)(this.logger)}get connected(){var r,s,o;return((o=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null?void 0:o.readyState)===1}get connecting(){var r,s,o;return((o=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null?void 0:o.readyState)===0}async publish(r,s,o){this.isInitialized(),await this.publisher.publish(r,s,o),await this.recordMessageEvent({topic:r,message:s,publishedAt:Date.now(),transportType:_e.relay})}async subscribe(r,s){var o;this.isInitialized(),(s==null?void 0:s.transportType)==="relay"&&await this.toEstablishConnection();let a=((o=this.subscriber.topicMap.get(r))==null?void 0:o[0])||"",u;const l=v=>{v.topic===r&&(this.subscriber.off(qt.created,l),u())};return await Promise.all([new Promise(v=>{u=v,this.subscriber.on(qt.created,l)}),new Promise(async v=>{a=await this.subscriber.subscribe(r,s)||a,v()})]),a}async unsubscribe(r,s){this.isInitialized(),await this.subscriber.unsubscribe(r,s)}on(r,s){this.events.on(r,s)}once(r,s){this.events.once(r,s)}off(r,s){this.events.off(r,s)}removeListener(r,s){this.events.removeListener(r,s)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(r=>r.promise))}catch(r){this.logger.warn(r)}this.hasExperiencedNetworkDisruption||this.connected?await(0,d.hFY)(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(r){await this.confirmOnlineStateOrThrow(),r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportDisconnect()),await this.createProvider(),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(s,o)=>{const a=()=>{this.provider.off(ct.disconnect,a),o(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(ct.disconnect,a),await(0,d.hFY)(this.provider.connect(),(0,L.toMiliseconds)(L.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(u=>{o(u)}).finally(()=>{clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0}),this.subscriber.start().catch(u=>{this.logger.error(u),this.onDisconnectHandler()}),this.hasExperiencedNetworkDisruption=!1,s()})}catch(s){this.logger.error(s);const o=s;if(this.hasExperiencedNetworkDisruption=!0,!this.isConnectionStalled(o.message))throw s}finally{this.connectionAttemptInProgress=!1}}async restartTransport(r){this.connectionAttemptInProgress||(this.relayUrl=r||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await(0,d.Ggh)())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(r){if((r==null?void 0:r.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const s=r.sort((o,a)=>o.publishedAt-a.publishedAt);this.logger.trace(`Batch of ${s.length} message events sorted`);for(const o of s)try{await this.onMessageEvent(o)}catch(a){this.logger.warn(a)}this.logger.trace(`Batch of ${s.length} message events processed`)}async onLinkMessageEvent(r,s){const{topic:o}=r;if(!s.sessionExists){const a=(0,d.gn4)(L.FIVE_MINUTES),u={topic:o,expiry:a,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(o,u)}this.events.emit(Ve.message,r),await this.recordMessageEvent(r)}startPingTimeout(){var r,s,o,a,u;if((0,d.UGU)())try{(s=(r=this.provider)==null?void 0:r.connection)!=null&&s.socket&&((u=(a=(o=this.provider)==null?void 0:o.connection)==null?void 0:a.socket)==null||u.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(l){this.logger.warn(l)}}isConnectionStalled(r){return this.staleConnectionErrors.some(s=>r.includes(s))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new mt.r(new wu.Z((0,d.$0m)({sdkVersion:ra,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:s,message:o}=r;await this.messages.set(s,o)}async shouldIgnoreMessageEvent(r){const{topic:s,message:o}=r;if(!o||o.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${o}`),!0;if(!await this.subscriber.isSubscribed(s))return this.logger.debug(`Ignoring message for non-subscribed topic ${s}`),!0;const a=this.messages.has(s,o);return a&&this.logger.debug(`Ignoring duplicate message: ${o}`),a}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),(0,W.isJsonRpcRequest)(r)){if(!r.method.endsWith(ip))return;const s=r.params,{topic:o,message:a,publishedAt:u,attestation:l}=s.data,v={topic:o,message:a,publishedAt:u,transportType:_e.relay,attestation:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace($p({type:"event",event:s.id},v)),this.events.emit(s.id,v),await this.acknowledgePayload(r),await this.onMessageEvent(v)}else(0,W.isJsonRpcResponse)(r)&&this.events.emit(Ve.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Ve.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const s=(0,W.formatJsonRpcResult)(r.id,!0);await this.provider.connection.send(s)}unregisterProviderListeners(){this.provider.off(ct.payload,this.onPayloadHandler),this.provider.off(ct.connect,this.onConnectHandler),this.provider.off(ct.disconnect,this.onDisconnectHandler),this.provider.off(ct.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let r=await(0,d.Ggh)();(0,d.uwg)(async s=>{r!==s&&(r=s,s?await this.restartTransport().catch(o=>this.logger.error(o)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.requestsInFlight.clear(),clearTimeout(this.pingTimeout),this.events.emit(Ve.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&(this.reconnectTimeout||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(r=>this.logger.error(r))},(0,L.toMiliseconds)(sp))))}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(r=>{const s=setInterval(()=>{this.connected&&(clearInterval(s),r())},this.connectionStatusPollingInterval)}),await this.transportOpen())}}var zp=Object.defineProperty,la=Object.getOwnPropertySymbols,Up=Object.prototype.hasOwnProperty,Hp=Object.prototype.propertyIsEnumerable,pa=(y,r,s)=>r in y?zp(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,da=(y,r)=>{for(var s in r||(r={}))Up.call(r,s)&&pa(y,s,r[s]);if(la)for(var s of la(r))Hp.call(r,s)&&pa(y,s,r[s]);return y};class _i extends zr{constructor(r,s,o,a=Nt,u=void 0){super(r,s,o,a),this.core=r,this.logger=s,this.name=o,this.map=new Map,this.version=rp,this.cached=[],this.initialized=!1,this.storagePrefix=Nt,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!(0,d.o8e)(l)?this.map.set(this.getKey(l),l):(0,d.xWS)(l)?this.map.set(l.id,l):(0,d.h1R)(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,v)=>{this.isInitialized(),this.map.has(l)?await this.update(l,v):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:v}),this.map.set(l,v),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(v=>Object.keys(l).every(_=>bu()(v[_],l[_]))):this.values),this.update=async(l,v)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:v});const _=da(da({},this.getData(l)),v);this.map.set(l,_),await this.persist()},this.delete=async(l,v)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:v}),this.map.delete(l),this.addToRecentlyDeleted(l),await this.persist())},this.logger=(0,se.Ep)(s,this.name),this.storagePrefix=a,this.getKey=u}get context(){return(0,se.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(r){this.recentlyDeleted.push(r),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const s=this.map.get(r);if(!s){if(this.recentlyDeleted.includes(r)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${r}`);throw this.logger.error(a),new Error(a)}const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(o),new Error(o)}return s}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:s}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Kp{constructor(r,s){this.core=r,this.logger=s,this.name=hp,this.version=up,this.events=new(ci()),this.initialized=!1,this.storagePrefix=Nt,this.ignoredPayloadTypes=[d.rVF],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:o})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...o])]},this.create=async o=>{this.isInitialized();const a=(0,d.jdp)(),u=await this.core.crypto.setSymKey(a),l=(0,d.gn4)(L.FIVE_MINUTES),v={protocol:ia},_={topic:u,expiry:l,relay:v,active:!1},I=(0,d.Bvr)({protocol:this.core.protocol,version:this.core.version,topic:u,symKey:a,relay:v,expiryTimestamp:l,methods:o==null?void 0:o.methods});return this.core.expirer.set(u,l),await this.pairings.set(u,_),await this.core.relayer.subscribe(u,{transportType:o==null?void 0:o.transportType}),{topic:u,uri:I}},this.pair=async o=>{this.isInitialized();const a=this.core.eventClient.createEvent({properties:{topic:o==null?void 0:o.uri,trace:[Dt.pairing_started]}});this.isValidPair(o,a);const{topic:u,symKey:l,relay:v,expiryTimestamp:_,methods:I}=(0,d.heJ)(o.uri);a.props.properties.topic=u,a.addTrace(Dt.pairing_uri_validation_success),a.addTrace(Dt.pairing_uri_not_expired);let O;if(this.pairings.keys.includes(u)){if(O=this.pairings.get(u),a.addTrace(Dt.existing_pairing),O.active)throw a.setError(Bt.active_pairing_already_exists),new Error(`Pairing already exists: ${u}. Please try again with a new connection URI.`);a.addTrace(Dt.pairing_not_expired)}const T=_||(0,d.gn4)(L.FIVE_MINUTES),D={topic:u,relay:v,expiry:T,active:!1,methods:I};this.core.expirer.set(u,T),await this.pairings.set(u,D),a.addTrace(Dt.store_new_pairing),o.activatePairing&&await this.activate({topic:u}),this.events.emit(Fi.create,D),a.addTrace(Dt.emit_inactive_pairing),this.core.crypto.keychain.has(u)||await this.core.crypto.setSymKey(l,u),a.addTrace(Dt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{a.setError(Bt.no_internet_connection)}try{await this.core.relayer.subscribe(u,{relay:v})}catch(A){throw a.setError(Bt.subscribe_pairing_topic_failure),A}return a.addTrace(Dt.subscribe_pairing_topic_success),D},this.activate=async({topic:o})=>{this.isInitialized();const a=(0,d.gn4)(L.THIRTY_DAYS);this.core.expirer.set(o,a),await this.pairings.update(o,{active:!0,expiry:a})},this.ping=async o=>{this.isInitialized(),await this.isValidPing(o);const{topic:a}=o;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:l,resolve:v,reject:_}=(0,d.H1S)();this.events.once((0,d.E0T)("pairing_ping",u),({error:I})=>{I?_(I):v()}),await l()}},this.updateExpiry=async({topic:o,expiry:a})=>{this.isInitialized(),await this.pairings.update(o,{expiry:a})},this.updateMetadata=async({topic:o,metadata:a})=>{this.isInitialized(),await this.pairings.update(o,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async o=>{this.isInitialized(),await this.isValidDisconnect(o);const{topic:a}=o;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",(0,d.D6H)("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(o,a,u)=>{const l=(0,W.formatJsonRpcRequest)(a,u),v=await this.core.crypto.encode(o,l),_=cs[a].req;return this.core.history.set(o,l),this.core.relayer.publish(o,v,_),l.id},this.sendResult=async(o,a,u)=>{const l=(0,W.formatJsonRpcResult)(o,u),v=await this.core.crypto.encode(a,l),_=await this.core.history.get(a,o),I=cs[_.request.method].res;await this.core.relayer.publish(a,v,I),await this.core.history.resolve(l)},this.sendError=async(o,a,u)=>{const l=(0,W.formatJsonRpcError)(o,u),v=await this.core.crypto.encode(a,l),_=await this.core.history.get(a,o),I=cs[_.request.method]?cs[_.request.method].res:cs.unregistered_method.res;await this.core.relayer.publish(a,v,I),await this.core.history.resolve(l)},this.deletePairing=async(o,a)=>{await this.core.relayer.unsubscribe(o),await Promise.all([this.pairings.delete(o,(0,d.D6H)("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(o),a?Promise.resolve():this.core.expirer.del(o)])},this.cleanup=async()=>{const o=this.pairings.getAll().filter(a=>(0,d.BwD)(a.expiry));await Promise.all(o.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=o=>{const{topic:a,payload:u}=o;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async o=>{const{topic:a,payload:u}=o,l=(await this.core.history.get(a,u.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(o,a)=>{const{id:u}=a;try{this.isValidPing({topic:o}),await this.sendResult(u,o,!0),this.events.emit(Fi.ping,{id:u,topic:o})}catch(l){await this.sendError(u,o,l),this.logger.error(l)}},this.onPairingPingResponse=(o,a)=>{const{id:u}=a;setTimeout(()=>{(0,W.isJsonRpcResult)(a)?this.events.emit((0,d.E0T)("pairing_ping",u),{}):(0,W.isJsonRpcError)(a)&&this.events.emit((0,d.E0T)("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(o,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:o}),await this.deletePairing(o),this.events.emit(Fi.delete,{id:u,topic:o})}catch(l){await this.sendError(u,o,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(o,a)=>{const{id:u,method:l}=a;try{if(this.registeredMethods.includes(l))return;const v=(0,d.D6H)("WC_METHOD_UNSUPPORTED",l);await this.sendError(u,o,v),this.logger.error(v)}catch(v){await this.sendError(u,o,v),this.logger.error(v)}},this.onUnknownRpcMethodResponse=o=>{this.registeredMethods.includes(o)||this.logger.error((0,d.D6H)("WC_METHOD_UNSUPPORTED",o))},this.isValidPair=(o,a)=>{var u;if(!(0,d.EJd)(o)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`pair() params: ${o}`);throw a.setError(Bt.malformed_pairing_uri),new Error(v)}if(!(0,d.jvJ)(o.uri)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`pair() uri: ${o.uri}`);throw a.setError(Bt.malformed_pairing_uri),new Error(v)}const l=(0,d.heJ)(o==null?void 0:o.uri);if(!((u=l==null?void 0:l.relay)!=null&&u.protocol)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID","pair() uri#relay-protocol");throw a.setError(Bt.malformed_pairing_uri),new Error(v)}if(!(l!=null&&l.symKey)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID","pair() uri#symKey");throw a.setError(Bt.malformed_pairing_uri),new Error(v)}if(l!=null&&l.expiryTimestamp&&(0,L.toMiliseconds)(l==null?void 0:l.expiryTimestamp)<Date.now()){a.setError(Bt.pairing_expired);const{message:v}=(0,d.kCb)("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(v)}},this.isValidPing=async o=>{if(!(0,d.EJd)(o)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(u)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidDisconnect=async o=>{if(!(0,d.EJd)(o)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(u)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async o=>{if(!(0,d.M_r)(o,!1)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!this.pairings.keys.includes(o)){const{message:a}=(0,d.kCb)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if((0,d.BwD)(this.pairings.get(o).expiry)){await this.deletePairing(o);const{message:a}=(0,d.kCb)("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}},this.core=r,this.logger=(0,se.Ep)(s,this.name),this.pairings=new _i(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,se.Fd)(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Ve.message,async r=>{const{topic:s,message:o,transportType:a}=r;if(!this.pairings.keys.includes(s)||a===_e.link_mode||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(o)))return;const u=await this.core.crypto.decode(s,o);try{(0,W.isJsonRpcRequest)(u)?(this.core.history.set(s,u),this.onRelayEventRequest({topic:s,payload:u})):(0,W.isJsonRpcResponse)(u)&&(await this.core.history.resolve(u),await this.onRelayEventResponse({topic:s,payload:u}),this.core.history.delete(s,u.id))}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(ht.expired,async r=>{const{topic:s}=(0,d.iPz)(r.target);s&&this.pairings.keys.includes(s)&&(await this.deletePairing(s,!0),this.events.emit(Fi.expire,{topic:s}))})}}class Vp extends Ls{constructor(r,s){super(r,s),this.core=r,this.logger=s,this.records=new Map,this.events=new Te.EventEmitter,this.name=lp,this.version=pp,this.cached=[],this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.records.set(o.id,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(o,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:o,request:a,chainId:u}),this.records.has(a.id))return;const l={id:a.id,topic:o,request:{method:a.method,params:a.params||null},chainId:u,expiry:(0,d.gn4)(L.THIRTY_DAYS)};this.records.set(l.id,l),this.persist(),this.events.emit(wt.created,l)},this.resolve=async o=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:o}),!this.records.has(o.id))return;const a=await this.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,W.isJsonRpcError)(o)?{error:o.error}:{result:o.result},this.records.set(a.id,a),this.persist(),this.events.emit(wt.updated,a))},this.get=async(o,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:o,id:a}),await this.getRecord(a)),this.delete=(o,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===o){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(wt.deleted,u)}}),this.persist()},this.exists=async(o,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===o:!1),this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,se.Ep)(s,this.name)}get context(){return(0,se.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;const o={topic:s.topic,request:(0,W.formatJsonRpcRequest)(s.request.method,s.request.params,s.id),chainId:s.chainId};return r.push(o)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const s=this.records.get(r);if(!s){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(wt.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:s}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(wt.created,r=>{const s=wt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r})}),this.events.on(wt.updated,r=>{const s=wt.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r})}),this.events.on(wt.deleted,r=>{const s=wt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:r})}),this.core.heartbeat.on(Ut.Lx.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let r=!1;this.records.forEach(s=>{(0,L.toMiliseconds)(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.records.delete(s.id),this.events.emit(wt.deleted,s,!1),r=!0)}),r&&this.persist()}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Bp extends Us{constructor(r,s){super(r,s),this.core=r,this.logger=s,this.expirations=new Map,this.events=new Te.EventEmitter,this.name=dp,this.version=gp,this.cached=[],this.initialized=!1,this.storagePrefix=Nt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.expirations.set(o.target,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=o=>{try{const a=this.formatTarget(o);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(o,a)=>{this.isInitialized();const u=this.formatTarget(o),l={target:u,expiry:a};this.expirations.set(u,l),this.checkExpiry(u,l),this.events.emit(ht.created,{target:u,expiration:l})},this.get=o=>{this.isInitialized();const a=this.formatTarget(o);return this.getExpiration(a)},this.del=o=>{if(this.isInitialized(),this.has(o)){const a=this.formatTarget(o),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(ht.deleted,{target:a,expiration:u})}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,se.Ep)(s,this.name)}get context(){return(0,se.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return(0,d.Z42)(r);if(typeof r=="number")return(0,d.GqV)(r);const{message:s}=(0,d.kCb)("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(s)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ht.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:s}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const s=this.expirations.get(r);if(!s){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.warn(o),new Error(o)}return s}checkExpiry(r,s){const{expiry:o}=s;(0,L.toMiliseconds)(o)-Date.now()<=0&&this.expire(r,s)}expire(r,s){this.expirations.delete(r),this.events.emit(ht.expired,{target:r,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,s)=>this.checkExpiry(s,r))}registerEventListeners(){this.core.heartbeat.on(Ut.Lx.pulse,()=>this.checkExpirations()),this.events.on(ht.created,r=>{const s=ht.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()}),this.events.on(ht.expired,r=>{const s=ht.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()}),this.events.on(ht.deleted,r=>{const s=ht.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}}var Ce={};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.getLocalStorage=Ce.getLocalStorageOrThrow=Ce.getCrypto=Ce.getCryptoOrThrow=Ce.getLocation=Ce.getLocationOrThrow=Ce.getNavigator=Ce.getNavigatorOrThrow=ga=Ce.getDocument=Ce.getDocumentOrThrow=Ce.getFromWindowOrThrow=Ce.getFromWindow=void 0;function bi(y){let r;return typeof window<"u"&&typeof window[y]<"u"&&(r=window[y]),r}Ce.getFromWindow=bi;function ki(y){const r=bi(y);if(!r)throw new Error(`${y} is not defined in Window`);return r}Ce.getFromWindowOrThrow=ki;function Jp(){return ki("document")}Ce.getDocumentOrThrow=Jp;function Gp(){return bi("document")}var ga=Ce.getDocument=Gp;function Wp(){return ki("navigator")}Ce.getNavigatorOrThrow=Wp;function Qp(){return bi("navigator")}Ce.getNavigator=Qp;function Yp(){return ki("location")}Ce.getLocationOrThrow=Yp;function Zp(){return bi("location")}Ce.getLocation=Zp;function Xp(){return ki("crypto")}Ce.getCryptoOrThrow=Xp;function ed(){return bi("crypto")}Ce.getCrypto=ed;function td(){return ki("localStorage")}Ce.getLocalStorageOrThrow=td;function id(){return bi("localStorage")}Ce.getLocalStorage=id;class sd extends N{constructor(r,s,o){super(r,s,o),this.core=r,this.logger=s,this.store=o,this.name=fp,this.verifyUrlV3=vp,this.storagePrefix=Nt,this.version=ea,this.init=async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,L.toMiliseconds)((a=this.publicKey)==null?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))},this.register=async a=>{if(!(0,d.jUY)()||this.isDevEnv)return;const u=window.location.origin,{id:l,decryptedId:v}=a,_=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${u}&id=${l}&decryptedId=${v}`;try{const I=ga(),O=this.startAbortTimer(L.ONE_SECOND*5),T=await new Promise((D,A)=>{const M=()=>{window.removeEventListener("message",j),I.body.removeChild(U),A("attestation aborted")};this.abortController.signal.addEventListener("abort",M);const U=I.createElement("iframe");U.src=_,U.style.display="none",U.addEventListener("error",M,{signal:this.abortController.signal});const j=z=>{if(!z.data)return;const ee=JSON.parse(z.data);if(ee.type==="verify_attestation"){if((0,Vt.decodeJWT)(ee.attestation).payload.id!==l)return;clearInterval(O),I.body.removeChild(U),this.abortController.signal.removeEventListener("abort",M),window.removeEventListener("message",j),D(ee.attestation===null?"":ee.attestation)}};I.body.appendChild(U),window.addEventListener("message",j,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",T),T}catch(I){this.logger.warn(I)}return""},this.resolve=async a=>{if(this.isDevEnv)return"";const{attestationId:u,hash:l,encryptedId:v}=a;if(u===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(u){if((0,Vt.decodeJWT)(u).payload.id!==v)return;const I=await this.isValidJwtAttestation(u);if(I){if(!I.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return I}}if(!l)return;const _=this.getVerifyUrl(a==null?void 0:a.verifyUrl);return this.fetchAttestation(l,_)},this.fetchAttestation=async(a,u)=>{this.logger.debug(`resolving attestation: ${a} from url: ${u}`);const l=this.startAbortTimer(L.ONE_SECOND*5),v=await fetch(`${u}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(l),v.status===200?await v.json():void 0},this.getVerifyUrl=a=>{let u=a||hs;return mp.includes(u)||(this.logger.info(`verify url: ${u}, not included in trusted list, assigning default: ${hs}`),u=hs),u},this.fetchPublicKey=async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const a=this.startAbortTimer(L.FIVE_SECONDS),u=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await u.json()}catch(a){this.logger.warn(a)}},this.persistPublicKey=async a=>{this.logger.debug("persisting public key to local storage",a),await this.store.setItem(this.storeKey,a),this.publicKey=a},this.removePublicKey=async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0},this.isValidJwtAttestation=async a=>{const u=await this.getPublicKey();try{if(u)return this.validateAttestation(a,u)}catch(v){this.logger.error(v),this.logger.warn("error validating attestation")}const l=await this.fetchAndPersistPublicKey();try{if(l)return this.validateAttestation(a,l)}catch(v){this.logger.error(v),this.logger.warn("error validating attestation")}},this.getPublicKey=async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey(),this.fetchAndPersistPublicKey=async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async u=>{const l=await this.fetchPublicKey();l&&(await this.persistPublicKey(l),u(l))});const a=await this.fetchPromise;return this.fetchPromise=void 0,a},this.validateAttestation=(a,u)=>{const l=(0,d.NbI)(a,u.publicKey),v={hasExpired:(0,L.toMiliseconds)(l.exp)<Date.now(),payload:l};if(v.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:v.payload.origin,isScam:v.payload.isScam,isVerified:v.payload.isVerified}},this.logger=(0,se.Ep)(s,this.name),this.abortController=new AbortController,this.isDevEnv=(0,d.UGU)()&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST,this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,se.Fd)(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,L.toMiliseconds)(r))}}class rd extends k{constructor(r,s){super(r,s),this.projectId=r,this.logger=s,this.context=wp,this.registerDeviceToken=async o=>{const{clientId:a,token:u,notificationType:l,enableEncrypted:v=!1}=o,_=`${_p}/${this.projectId}/clients`;await fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:l,token:u,always_raw:v})})},this.logger=(0,se.Ep)(s,this.context)}}var nd=Object.defineProperty,fa=Object.getOwnPropertySymbols,od=Object.prototype.hasOwnProperty,ad=Object.prototype.propertyIsEnumerable,ya=(y,r,s)=>r in y?nd(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,ps=(y,r)=>{for(var s in r||(r={}))od.call(r,s)&&ya(y,s,r[s]);if(fa)for(var s of fa(r))ad.call(r,s)&&ya(y,s,r[s]);return y};class cd extends K{constructor(r,s,o=!0){super(r,s,o),this.core=r,this.logger=s,this.context=Ep,this.storagePrefix=Nt,this.storageVersion=bp,this.events=new Map,this.shouldPersist=!1,this.createEvent=a=>{const{event:u="ERROR",type:l="",properties:{topic:v,trace:_}}=a,I=(0,d.k$y)(),O=this.core.projectId||"",T=Date.now(),D=ps({eventId:I,bundleId:O,timestamp:T,props:{event:u,type:l,properties:{topic:v,trace:_}}},this.setMethods(I));return this.telemetryEnabled&&(this.events.set(I,D),this.shouldPersist=!0),D},this.getEvent=a=>{const{eventId:u,topic:l}=a;if(u)return this.events.get(u);const v=Array.from(this.events.values()).find(_=>_.props.properties.topic===l);if(v)return ps(ps({},v),this.setMethods(v.eventId))},this.deleteEvent=a=>{const{eventId:u}=a;this.events.delete(u),this.shouldPersist=!0},this.setEventListeners=()=>{this.core.heartbeat.on(Ut.Lx.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,L.fromMiliseconds)(Date.now())-(0,L.fromMiliseconds)(a.timestamp)>Ip&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})},this.setMethods=a=>({addTrace:u=>this.addTrace(a,u),setError:u=>this.setError(a,u)}),this.addTrace=(a,u)=>{const l=this.events.get(a);l&&(l.props.properties.trace.push(u),this.events.set(a,l),this.shouldPersist=!0)},this.setError=(a,u)=>{const l=this.events.get(a);l&&(l.props.type=u,l.timestamp=Date.now(),this.events.set(a,l),this.shouldPersist=!0)},this.persist=async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1},this.restore=async()=>{try{const a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(u=>{this.events.set(u.eventId,ps(ps({},u),this.setMethods(u.eventId)))})}catch(a){this.logger.warn(a)}},this.submit=async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const a=[];for(const[u,l]of this.events)l.props.type&&a.push(l);if(a.length!==0)try{if((await fetch(`${Pp}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${ra}`,{method:"POST",body:JSON.stringify(a)})).ok)for(const u of a)this.events.delete(u.eventId),this.shouldPersist=!0}catch(u){this.logger.warn(u)}},this.logger=(0,se.Ep)(s,this.context),o?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var hd=Object.defineProperty,va=Object.getOwnPropertySymbols,ud=Object.prototype.hasOwnProperty,ld=Object.prototype.propertyIsEnumerable,ma=(y,r,s)=>r in y?hd(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,wa=(y,r)=>{for(var s in r||(r={}))ud.call(r,s)&&ma(y,s,r[s]);if(va)for(var s of va(r))ld.call(r,s)&&ma(y,s,r[s]);return y};class Wr extends Ms{constructor(r){var s;super(r),this.protocol=Xo,this.version=ea,this.name=Jr,this.events=new Te.EventEmitter,this.initialized=!1,this.on=(l,v)=>this.events.on(l,v),this.once=(l,v)=>this.events.once(l,v),this.off=(l,v)=>this.events.off(l,v),this.removeListener=(l,v)=>this.events.removeListener(l,v),this.dispatchEnvelope=({topic:l,message:v,sessionExists:_})=>{if(!l||!v)return;const I={topic:l,message:v,publishedAt:Date.now(),transportType:_e.link_mode};this.relayer.onLinkMessageEvent(I,{sessionExists:_})},this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||sa,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const o=(0,se.jI)({level:typeof(r==null?void 0:r.logger)=="string"&&r.logger?r.logger:Kl.logger}),{logger:a,chunkLoggerController:u}=(0,se.Rt)({opts:o,maxSizeInBytes:r==null?void 0:r.maxLogBlobSizeInBytes,loggerOverride:r==null?void 0:r.logger});this.logChunkController=u,(s=this.logChunkController)!=null&&s.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var l,v;(l=this.logChunkController)!=null&&l.downloadLogsBlobInBrowser&&((v=this.logChunkController)==null||v.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,se.Ep)(a,this.name),this.heartbeat=new Ut.C$,this.crypto=new xp(this,this.logger,r==null?void 0:r.keychain),this.history=new Vp(this,this.logger),this.expirer=new Bp(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new fe.Z(wa(wa({},Vl),r==null?void 0:r.storageOptions)),this.relayer=new jp({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Kp(this,this.logger),this.verify=new sd(this,this.logger,this.storage),this.echoClient=new rd(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new cd(this,this.logger,r==null?void 0:r.telemetryEnabled)}static async init(r){const s=new Wr(r);await s.initialize();const o=await s.crypto.getClientId();return await s.storage.setItem(np,o),s}get context(){return(0,se.Fd)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var r;return(r=this.logChunkController)==null?void 0:r.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(r){this.linkModeSupportedApps.includes(r)||(this.linkModeSupportedApps.push(r),await this.storage.setItem(na,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(na)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const pd=Wr;var dd=Y(14224);const _a="wc",ba=2,Ea="client",Qr=`${_a}@${ba}:${Ea}:`,Yr={name:Ea,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},bb={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire"},Eb={database:":memory:"},Ia="WALLETCONNECT_DEEPLINK_CHOICE",Ib={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Pb="history",Cb="0.3",gd="proposal",xb=null,Pa="Proposal expired",fd="session",Mi=L.SEVEN_DAYS,yd="engine",Le={wc_sessionPropose:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1104},res:{ttl:L.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1106},res:{ttl:L.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:L.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1112},res:{ttl:L.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:L.ONE_DAY,prompt:!1,tag:1114},res:{ttl:L.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:L.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:L.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:L.FIVE_MINUTES,prompt:!1,tag:1119}}},Zr={min:L.FIVE_MINUTES,max:L.SEVEN_DAYS},Ft={idle:"IDLE",active:"ACTIVE"},vd="request",md=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],wd="wc",Sb=1.5,_d="auth",bd="authKeys",Ed="pairingTopics",Id="requests",Ks=`${wd}@${1.5}:${_d}:`,Vs=`${Ks}:PUB_KEY`;var Pd=Object.defineProperty,Cd=Object.defineProperties,xd=Object.getOwnPropertyDescriptors,Ca=Object.getOwnPropertySymbols,Sd=Object.prototype.hasOwnProperty,Rd=Object.prototype.propertyIsEnumerable,xa=(y,r,s)=>r in y?Pd(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,Ae=(y,r)=>{for(var s in r||(r={}))Sd.call(r,s)&&xa(y,s,r[s]);if(Ca)for(var s of Ca(r))Rd.call(r,s)&&xa(y,s,r[s]);return y},bt=(y,r)=>Cd(y,xd(r));class Od extends Xe{constructor(r){super(r),this.name=yd,this.events=new(ci()),this.initialized=!1,this.requestQueue={state:Ft.idle,queue:[]},this.sessionRequestQueue={state:Ft.idle,queue:[]},this.requestQueueDelay=L.ONE_SECOND,this.expectedPairingMethodMap=new Map,this.recentlyDeletedMap=new Map,this.recentlyDeletedLimit=200,this.relayMessageCache=[],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Le)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,L.toMiliseconds)(this.requestQueueDelay)))},this.connect=async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const o=bt(Ae({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});await this.isValidConnect(o);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:l,sessionProperties:v,relays:_}=o;let I=a,O,T=!1;try{I&&(T=this.client.core.pairing.pairings.get(I).active)}catch(Q){throw this.client.logger.error(`connect() -> pairing.get(${I}) failed`),Q}if(!I||!T){const{topic:Q,uri:Z}=await this.client.core.pairing.create();I=Q,O=Z}if(!I){const{message:Q}=(0,d.kCb)("NO_MATCHING_KEY",`connect() pairing topic: ${I}`);throw new Error(Q)}const D=await this.client.core.crypto.generateKeyPair(),A=Le.wc_sessionPropose.req.ttl||L.FIVE_MINUTES,M=(0,d.gn4)(A),U=Ae({requiredNamespaces:u,optionalNamespaces:l,relays:_??[{protocol:ia}],proposer:{publicKey:D,metadata:this.client.metadata},expiryTimestamp:M,pairingTopic:I},v&&{sessionProperties:v}),{reject:j,resolve:z,done:ee}=(0,d.H1S)(A,Pa);this.events.once((0,d.E0T)("session_connect"),async({error:Q,session:Z})=>{if(Q)j(Q);else if(Z){Z.self.publicKey=D;const Ie=bt(Ae({},Z),{pairingTopic:U.pairingTopic,requiredNamespaces:U.requiredNamespaces,optionalNamespaces:U.optionalNamespaces,transportType:_e.relay});await this.client.session.set(Z.topic,Ie),await this.setExpiry(Z.topic,Z.expiry),I&&await this.client.core.pairing.updateMetadata({topic:I,metadata:Z.peer.metadata}),this.cleanupDuplicatePairings(Ie),z(Ie)}});const pe=await this.sendRequest({topic:I,method:"wc_sessionPropose",params:U,throwOnFailedPublish:!0});return await this.setProposal(pe,Ae({id:pe},U)),{uri:O,approval:ee}},this.pair=async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(s)}catch(o){throw this.client.logger.error("pair() failed"),o}},this.approve=async s=>{var o,a,u;const l=this.client.core.eventClient.createEvent({properties:{topic:(o=s==null?void 0:s.id)==null?void 0:o.toString(),trace:[_t.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(de){throw l.setError(mi.no_internet_connection),de}try{await this.isValidProposalId(s==null?void 0:s.id)}catch(de){throw this.client.logger.error(`approve() -> proposal.get(${s==null?void 0:s.id}) failed`),l.setError(mi.proposal_not_found),de}try{await this.isValidApprove(s)}catch(de){throw this.client.logger.error("approve() -> isValidApprove() failed"),l.setError(mi.session_approve_namespace_validation_failure),de}const{id:v,relayProtocol:_,namespaces:I,sessionProperties:O,sessionConfig:T}=s,D=this.client.proposal.get(v);this.client.core.eventClient.deleteEvent({eventId:l.eventId});const{pairingTopic:A,proposer:M,requiredNamespaces:U,optionalNamespaces:j}=D;let z=(a=this.client.core.eventClient)==null?void 0:a.getEvent({topic:A});z||(z=(u=this.client.core.eventClient)==null?void 0:u.createEvent({type:_t.session_approve_started,properties:{topic:A,trace:[_t.session_approve_started,_t.session_namespaces_validation_success]}}));const ee=await this.client.core.crypto.generateKeyPair(),pe=M.publicKey,Q=await this.client.core.crypto.generateSharedKey(ee,pe),Z=Ae(Ae({relay:{protocol:_??"irn"},namespaces:I,controller:{publicKey:ee,metadata:this.client.metadata},expiry:(0,d.gn4)(Mi)},O&&{sessionProperties:O}),T&&{sessionConfig:T}),Ie=_e.relay;z.addTrace(_t.subscribing_session_topic);try{await this.client.core.relayer.subscribe(Q,{transportType:Ie})}catch(de){throw z.setError(mi.subscribe_session_topic_failure),de}z.addTrace(_t.subscribe_session_topic_success);const be=bt(Ae({},Z),{topic:Q,requiredNamespaces:U,optionalNamespaces:j,pairingTopic:A,acknowledged:!1,self:Z.controller,peer:{publicKey:M.publicKey,metadata:M.metadata},controller:ee,transportType:_e.relay});await this.client.session.set(Q,be),z.addTrace(_t.store_session);try{z.addTrace(_t.publishing_session_settle),await this.sendRequest({topic:Q,method:"wc_sessionSettle",params:Z,throwOnFailedPublish:!0}).catch(de=>{throw z==null||z.setError(mi.session_settle_publish_failure),de}),z.addTrace(_t.session_settle_publish_success),z.addTrace(_t.publishing_session_approve),await this.sendResult({id:v,topic:A,result:{relay:{protocol:_??"irn"},responderPublicKey:ee},throwOnFailedPublish:!0}).catch(de=>{throw z==null||z.setError(mi.session_approve_publish_failure),de}),z.addTrace(_t.session_approve_publish_success)}catch(de){throw this.client.logger.error(de),this.client.session.delete(Q,(0,d.D6H)("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(Q),de}return this.client.core.eventClient.deleteEvent({eventId:z.eventId}),await this.client.core.pairing.updateMetadata({topic:A,metadata:M.metadata}),await this.client.proposal.delete(v,(0,d.D6H)("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:A}),await this.setExpiry(Q,(0,d.gn4)(Mi)),{topic:Q,acknowledged:()=>Promise.resolve(this.client.session.get(Q))}},this.reject=async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(s)}catch(l){throw this.client.logger.error("reject() -> isValidReject() failed"),l}const{id:o,reason:a}=s;let u;try{u=this.client.proposal.get(o).pairingTopic}catch(l){throw this.client.logger.error(`reject() -> proposal.get(${o}) failed`),l}u&&(await this.sendError({id:o,topic:u,error:a,rpcOpts:Le.wc_sessionPropose.reject}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED")))},this.update=async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(s)}catch(T){throw this.client.logger.error("update() -> isValidUpdate() failed"),T}const{topic:o,namespaces:a}=s,{done:u,resolve:l,reject:v}=(0,d.H1S)(),_=(0,W.payloadId)(),I=(0,W.getBigIntRpcId)().toString(),O=this.client.session.get(o).namespaces;return this.events.once((0,d.E0T)("session_update",_),({error:T})=>{T?v(T):l()}),await this.client.session.update(o,{namespaces:a}),await this.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a},throwOnFailedPublish:!0,clientRpcId:_,relayRpcId:I}).catch(T=>{this.client.logger.error(T),this.client.session.update(o,{namespaces:O}),v(T)}),{acknowledged:u}},this.extend=async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(s)}catch(_){throw this.client.logger.error("extend() -> isValidExtend() failed"),_}const{topic:o}=s,a=(0,W.payloadId)(),{done:u,resolve:l,reject:v}=(0,d.H1S)();return this.events.once((0,d.E0T)("session_extend",a),({error:_})=>{_?v(_):l()}),await this.setExpiry(o,(0,d.gn4)(Mi)),this.sendRequest({topic:o,method:"wc_sessionExtend",params:{},clientRpcId:a,throwOnFailedPublish:!0}).catch(_=>{v(_)}),{acknowledged:u}},this.request=async s=>{this.isInitialized();try{await this.isValidRequest(s)}catch(M){throw this.client.logger.error("request() -> isValidRequest() failed"),M}const{chainId:o,request:a,topic:u,expiry:l=Le.wc_sessionRequest.req.ttl}=s,v=this.client.session.get(u);(v==null?void 0:v.transportType)===_e.relay&&await this.confirmOnlineStateOrThrow();const _=(0,W.payloadId)(),I=(0,W.getBigIntRpcId)().toString(),{done:O,resolve:T,reject:D}=(0,d.H1S)(l,"Request expired. Please try again.");this.events.once((0,d.E0T)("session_request",_),({error:M,result:U})=>{M?D(M):T(U)});const A=this.getAppLinkIfEnabled(v.peer.metadata,v.transportType);return A?(await this.sendRequest({clientRpcId:_,relayRpcId:I,topic:u,method:"wc_sessionRequest",params:{request:bt(Ae({},a),{expiryTimestamp:(0,d.gn4)(l)}),chainId:o},expiry:l,throwOnFailedPublish:!0,appLink:A}).catch(M=>D(M)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:o,id:_}),await O()):await Promise.all([new Promise(async M=>{await this.sendRequest({clientRpcId:_,relayRpcId:I,topic:u,method:"wc_sessionRequest",params:{request:bt(Ae({},a),{expiryTimestamp:(0,d.gn4)(l)}),chainId:o},expiry:l,throwOnFailedPublish:!0}).catch(U=>D(U)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:o,id:_}),M()}),new Promise(async M=>{var U;if(!((U=v.sessionConfig)!=null&&U.disableDeepLink)){const j=await(0,d.bW6)(this.client.core.storage,Ia);(0,d.HhN)({id:_,topic:u,wcDeepLink:j})}M()}),O()]).then(M=>M[2])},this.respond=async s=>{this.isInitialized(),await this.isValidRespond(s);const{topic:o,response:a}=s,{id:u}=a,l=this.client.session.get(o);l.transportType===_e.relay&&await this.confirmOnlineStateOrThrow();const v=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);(0,W.isJsonRpcResult)(a)?await this.sendResult({id:u,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:v}):(0,W.isJsonRpcError)(a)&&await this.sendError({id:u,topic:o,error:a.error,appLink:v}),this.cleanupAfterResponse(s)},this.ping=async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(s)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}const{topic:o}=s;if(this.client.session.keys.includes(o)){const a=(0,W.payloadId)(),u=(0,W.getBigIntRpcId)().toString(),{done:l,resolve:v,reject:_}=(0,d.H1S)();this.events.once((0,d.E0T)("session_ping",a),({error:I})=>{I?_(I):v()}),await Promise.all([this.sendRequest({topic:o,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:u}),l()])}else this.client.core.pairing.pairings.keys.includes(o)&&await this.client.core.pairing.ping({topic:o})},this.emit=async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(s);const{topic:o,event:a,chainId:u}=s,l=(0,W.getBigIntRpcId)().toString();await this.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:u},throwOnFailedPublish:!0,relayRpcId:l})},this.disconnect=async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(s);const{topic:o}=s;if(this.client.session.keys.includes(o))await this.sendRequest({topic:o,method:"wc_sessionDelete",params:(0,d.D6H)("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:o,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(o))await this.client.core.pairing.disconnect({topic:o});else{const{message:a}=(0,d.kCb)("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}},this.find=s=>(this.isInitialized(),this.client.session.getAll().filter(o=>(0,d.Ih8)(o,s))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.authenticate=async(s,o)=>{var a;this.isInitialized(),this.isValidAuthenticate(s);const u=o&&this.client.core.linkModeSupportedApps.includes(o)&&((a=this.client.metadata.redirect)==null?void 0:a.linkMode),l=u?_e.link_mode:_e.relay;l===_e.relay&&await this.confirmOnlineStateOrThrow();const{chains:v,statement:_="",uri:I,domain:O,nonce:T,type:D,exp:A,nbf:M,methods:U=[],expiry:j}=s,z=[...s.resources||[]],{topic:ee,uri:pe}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:l});this.client.logger.info({message:"Generated new pairing",pairing:{topic:ee,uri:pe}});const Q=await this.client.core.crypto.generateKeyPair(),Z=(0,d.YmJ)(Q);if(await Promise.all([this.client.auth.authKeys.set(Vs,{responseTopic:Z,publicKey:Q}),this.client.auth.pairingTopics.set(Z,{topic:Z,pairingTopic:ee})]),await this.client.core.relayer.subscribe(Z,{transportType:l}),this.client.logger.info(`sending request to new pairing topic: ${ee}`),U.length>0){const{namespace:Re}=(0,d.DQe)(v[0]);let Fe=(0,d.IkP)(Re,"request",U);(0,d.hA9)(z)&&(Fe=(0,d.qJM)(Fe,z.pop())),z.push(Fe)}const Ie=j&&j>Le.wc_sessionAuthenticate.req.ttl?j:Le.wc_sessionAuthenticate.req.ttl,be={authPayload:{type:D??"caip122",chains:v,statement:_,aud:I,domain:O,version:"1",nonce:T,iat:new Date().toISOString(),exp:A,nbf:M,resources:z},requester:{publicKey:Q,metadata:this.client.metadata},expiryTimestamp:(0,d.gn4)(Ie)},de={eip155:{chains:v,methods:[...new Set(["personal_sign",...U])],events:["chainChanged","accountsChanged"]}},Pt={requiredNamespaces:{},optionalNamespaces:de,relays:[{protocol:"irn"}],pairingTopic:ee,proposer:{publicKey:Q,metadata:this.client.metadata},expiryTimestamp:(0,d.gn4)(Le.wc_sessionPropose.req.ttl)},{done:ln,resolve:Qs,reject:gs}=(0,d.H1S)(Ie,"Request expired"),ji=async({error:Re,session:Fe})=>{if(this.events.off((0,d.E0T)("session_request",Jt),zi),Re)gs(Re);else if(Fe){Fe.self.publicKey=Q,await this.client.session.set(Fe.topic,Fe),await this.setExpiry(Fe.topic,Fe.expiry),ee&&await this.client.core.pairing.updateMetadata({topic:ee,metadata:Fe.peer.metadata});const Gt=this.client.session.get(Fe.topic);await this.deleteProposal(Ii),Qs({session:Gt})}},zi=async Re=>{var Fe,Gt,et;if(await this.deletePendingAuthRequest(Jt,{message:"fulfilled",code:0}),Re.error){const Ct=(0,d.D6H)("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return Re.error.code===Ct.code?void 0:(this.events.off((0,d.E0T)("session_connect"),ji),gs(Re.error.message))}await this.deleteProposal(Ii),this.events.off((0,d.E0T)("session_connect"),ji);const{cacaos:Ys,responder:Wt}=Re.result,fs=[],Qt=[];for(const Ct of Ys){await(0,d.c4l)({cacao:Ct,projectId:this.client.core.projectId})||(this.client.logger.error(Ct,"Signature verification failed"),gs((0,d.D6H)("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Yt}=Ct,ys=(0,d.hA9)(Yt.resources),Pi=[(0,d.DJo)(Yt.iss)],Hi=(0,d.NmC)(Yt.iss);if(ys){const Ki=(0,d.Y31)(ys),tt=(0,d.ouN)(ys);fs.push(...Ki),Pi.push(...tt)}for(const Ki of Pi)Qt.push(`${Ki}:${Hi}`)}const Lt=await this.client.core.crypto.generateSharedKey(Q,Wt.publicKey);let Ui;fs.length>0&&(Ui={topic:Lt,acknowledged:!0,self:{publicKey:Q,metadata:this.client.metadata},peer:Wt,controller:Wt.publicKey,expiry:(0,d.gn4)(Mi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:ee,namespaces:(0,d.E12)([...new Set(fs)],[...new Set(Qt)]),transportType:l},await this.client.core.relayer.subscribe(Lt,{transportType:l}),await this.client.session.set(Lt,Ui),ee&&await this.client.core.pairing.updateMetadata({topic:ee,metadata:Wt.metadata}),Ui=this.client.session.get(Lt)),(Fe=this.client.metadata.redirect)!=null&&Fe.linkMode&&(Gt=Wt.metadata.redirect)!=null&&Gt.linkMode&&(et=Wt.metadata.redirect)!=null&&et.universal&&o&&(this.client.core.addLinkModeSupportedApp(Wt.metadata.redirect.universal),this.client.session.update(Lt,{transportType:_e.link_mode})),Qs({auths:Ys,session:Ui})},Jt=(0,W.payloadId)(),Ii=(0,W.payloadId)();this.events.once((0,d.E0T)("session_connect"),ji),this.events.once((0,d.E0T)("session_request",Jt),zi);let Mt;try{if(u){const Re=(0,W.formatJsonRpcRequest)("wc_sessionAuthenticate",be,Jt);this.client.core.history.set(ee,Re);const Fe=await this.client.core.crypto.encode("",Re,{type:d.FpL,encoding:d.zl_});Mt=(0,d.L9d)(o,ee,Fe)}else await Promise.all([this.sendRequest({topic:ee,method:"wc_sessionAuthenticate",params:be,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:Jt}),this.sendRequest({topic:ee,method:"wc_sessionPropose",params:Pt,expiry:Le.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:Ii})])}catch(Re){throw this.events.off((0,d.E0T)("session_connect"),ji),this.events.off((0,d.E0T)("session_request",Jt),zi),Re}return await this.setProposal(Ii,Ae({id:Ii},Pt)),await this.setAuthRequest(Jt,{request:bt(Ae({},be),{verifyContext:{}}),pairingTopic:ee,transportType:l}),{uri:Mt??pe,response:ln}},this.approveSessionAuthenticate=async s=>{const{id:o,auths:a}=s,u=this.client.core.eventClient.createEvent({properties:{topic:o.toString(),trace:[wi.authenticated_session_approve_started]}});try{this.isInitialized()}catch(j){throw u.setError(us.no_internet_connection),j}const l=this.getPendingAuthRequest(o);if(!l)throw u.setError(us.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${o}`);const v=l.transportType||_e.relay;v===_e.relay&&await this.confirmOnlineStateOrThrow();const _=l.requester.publicKey,I=await this.client.core.crypto.generateKeyPair(),O=(0,d.YmJ)(_),T={type:d.rVF,receiverPublicKey:_,senderPublicKey:I},D=[],A=[];for(const j of a){if(!await(0,d.c4l)({cacao:j,projectId:this.client.core.projectId})){u.setError(us.invalid_cacao);const Z=(0,d.D6H)("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:o,topic:O,error:Z,encodeOpts:T}),new Error(Z.message)}u.addTrace(wi.cacaos_verified);const{p:z}=j,ee=(0,d.hA9)(z.resources),pe=[(0,d.DJo)(z.iss)],Q=(0,d.NmC)(z.iss);if(ee){const Z=(0,d.Y31)(ee),Ie=(0,d.ouN)(ee);D.push(...Z),pe.push(...Ie)}for(const Z of pe)A.push(`${Z}:${Q}`)}const M=await this.client.core.crypto.generateSharedKey(I,_);u.addTrace(wi.create_authenticated_session_topic);let U;if((D==null?void 0:D.length)>0){U={topic:M,acknowledged:!0,self:{publicKey:I,metadata:this.client.metadata},peer:{publicKey:_,metadata:l.requester.metadata},controller:_,expiry:(0,d.gn4)(Mi),authentication:a,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:l.pairingTopic,namespaces:(0,d.E12)([...new Set(D)],[...new Set(A)]),transportType:v},u.addTrace(wi.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(M,{transportType:v})}catch(j){throw u.setError(us.subscribe_authenticated_session_topic_failure),j}u.addTrace(wi.subscribe_authenticated_session_topic_success),await this.client.session.set(M,U),u.addTrace(wi.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:l.pairingTopic,metadata:l.requester.metadata})}u.addTrace(wi.publishing_authenticated_session_approve);try{await this.sendResult({topic:O,id:o,result:{cacaos:a,responder:{publicKey:I,metadata:this.client.metadata}},encodeOpts:T,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(l.requester.metadata,v)})}catch(j){throw u.setError(us.authenticated_session_approve_publish_failure),j}return await this.client.auth.requests.delete(o,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:l.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:u.eventId}),{session:U}},this.rejectSessionAuthenticate=async s=>{this.isInitialized();const{id:o,reason:a}=s,u=this.getPendingAuthRequest(o);if(!u)throw new Error(`Could not find pending auth request with id ${o}`);u.transportType===_e.relay&&await this.confirmOnlineStateOrThrow();const l=u.requester.publicKey,v=await this.client.core.crypto.generateKeyPair(),_=(0,d.YmJ)(l),I={type:d.rVF,receiverPublicKey:l,senderPublicKey:v};await this.sendError({id:o,topic:_,error:a,encodeOpts:I,rpcOpts:Le.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(u.requester.metadata,u.transportType)}),await this.client.auth.requests.delete(o,{message:"rejected",code:0}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED"))},this.formatAuthMessage=s=>{this.isInitialized();const{request:o,iss:a}=s;return(0,d.wvx)(o,a)},this.processRelayMessageCache=()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const s=this.relayMessageCache.shift();s&&await this.onRelayMessage(s)}catch(s){this.client.logger.error(s)}},50)},this.cleanupDuplicatePairings=async s=>{if(s.pairingTopic)try{const o=this.client.core.pairing.pairings.get(s.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var l,v;return((l=u.peerMetadata)==null?void 0:l.url)&&((v=u.peerMetadata)==null?void 0:v.url)===s.peer.metadata.url&&u.topic&&u.topic!==o.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(o){this.client.logger.error(o)}},this.deleteSession=async s=>{var o;const{topic:a,expirerHasDeleted:u=!1,emitEvent:l=!0,id:v=0}=s,{self:_}=this.client.session.get(a);await this.client.core.relayer.unsubscribe(a),await this.client.session.delete(a,(0,d.D6H)("USER_DISCONNECTED")),this.addToRecentlyDeleted(a,"session"),this.client.core.crypto.keychain.has(_.publicKey)&&await this.client.core.crypto.deleteKeyPair(_.publicKey),this.client.core.crypto.keychain.has(a)&&await this.client.core.crypto.deleteSymKey(a),u||this.client.core.expirer.del(a),this.client.core.storage.removeItem(Ia).catch(I=>this.client.logger.warn(I)),this.getPendingSessionRequests().forEach(I=>{I.topic===a&&this.deletePendingSessionRequest(I.id,(0,d.D6H)("USER_DISCONNECTED"))}),a===((o=this.sessionRequestQueue.queue[0])==null?void 0:o.topic)&&(this.sessionRequestQueue.state=Ft.idle),l&&this.client.events.emit("session_delete",{id:v,topic:a})},this.deleteProposal=async(s,o)=>{if(o)try{const a=this.client.proposal.get(s),u=this.client.core.eventClient.getEvent({topic:a.pairingTopic});u==null||u.setError(mi.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(s,(0,d.D6H)("USER_DISCONNECTED")),o?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"proposal")},this.deletePendingSessionRequest=async(s,o,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(s,o),a?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==s),a&&(this.sessionRequestQueue.state=Ft.idle,this.client.events.emit("session_request_expire",{id:s}))},this.deletePendingAuthRequest=async(s,o,a=!1)=>{await Promise.all([this.client.auth.requests.delete(s,o),a?Promise.resolve():this.client.core.expirer.del(s)])},this.setExpiry=async(s,o)=>{this.client.session.keys.includes(s)&&(this.client.core.expirer.set(s,o),await this.client.session.update(s,{expiry:o}))},this.setProposal=async(s,o)=>{this.client.core.expirer.set(s,(0,d.gn4)(Le.wc_sessionPropose.req.ttl)),await this.client.proposal.set(s,o)},this.setAuthRequest=async(s,o)=>{const{request:a,pairingTopic:u,transportType:l=_e.relay}=o;this.client.core.expirer.set(s,a.expiryTimestamp),await this.client.auth.requests.set(s,{authPayload:a.authPayload,requester:a.requester,expiryTimestamp:a.expiryTimestamp,id:s,pairingTopic:u,verifyContext:a.verifyContext,transportType:l})},this.setPendingSessionRequest=async s=>{const{id:o,topic:a,params:u,verifyContext:l}=s,v=u.request.expiryTimestamp||(0,d.gn4)(Le.wc_sessionRequest.req.ttl);this.client.core.expirer.set(o,v),await this.client.pendingRequest.set(o,{id:o,topic:a,params:u,verifyContext:l})},this.sendRequest=async s=>{const{topic:o,method:a,params:u,expiry:l,relayRpcId:v,clientRpcId:_,throwOnFailedPublish:I,appLink:O}=s,T=(0,W.formatJsonRpcRequest)(a,u,_);let D;const A=!!O;try{const j=A?d.zl_:d.$dT;D=await this.client.core.crypto.encode(o,T,{encoding:j})}catch(j){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${o} failed`),j}let M;if(md.includes(a)){const j=(0,d.rjm)(JSON.stringify(T)),z=(0,d.rjm)(D);M=await this.client.core.verify.register({id:z,decryptedId:j})}const U=Le[a].req;if(U.attestation=M,l&&(U.ttl=l),v&&(U.id=v),this.client.core.history.set(o,T),A){const j=(0,d.L9d)(O,o,D);await Y.g.Linking.openURL(j,this.client.name)}else{const j=Le[a].req;l&&(j.ttl=l),v&&(j.id=v),I?(j.internal=bt(Ae({},j.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,D,j)):this.client.core.relayer.publish(o,D,j).catch(z=>this.client.logger.error(z))}return T.id},this.sendResult=async s=>{const{id:o,topic:a,result:u,throwOnFailedPublish:l,encodeOpts:v,appLink:_}=s,I=(0,W.formatJsonRpcResult)(o,u);let O;const T=_&&typeof(Y.g==null?void 0:Y.g.Linking)<"u";try{const A=T?d.zl_:d.$dT;O=await this.client.core.crypto.encode(a,I,bt(Ae({},v||{}),{encoding:A}))}catch(A){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),A}let D;try{D=await this.client.core.history.get(a,o)}catch(A){throw this.client.logger.error(`sendResult() -> history.get(${a}, ${o}) failed`),A}if(T){const A=(0,d.L9d)(_,a,O);await Y.g.Linking.openURL(A,this.client.name)}else{const A=Le[D.request.method].res;l?(A.internal=bt(Ae({},A.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,O,A)):this.client.core.relayer.publish(a,O,A).catch(M=>this.client.logger.error(M))}await this.client.core.history.resolve(I)},this.sendError=async s=>{const{id:o,topic:a,error:u,encodeOpts:l,rpcOpts:v,appLink:_}=s,I=(0,W.formatJsonRpcError)(o,u);let O;const T=_&&typeof(Y.g==null?void 0:Y.g.Linking)<"u";try{const A=T?d.zl_:d.$dT;O=await this.client.core.crypto.encode(a,I,bt(Ae({},l||{}),{encoding:A}))}catch(A){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${a} failed`),A}let D;try{D=await this.client.core.history.get(a,o)}catch(A){throw this.client.logger.error(`sendError() -> history.get(${a}, ${o}) failed`),A}if(T){const A=(0,d.L9d)(_,a,O);await Y.g.Linking.openURL(A,this.client.name)}else{const A=v||Le[D.request.method].res;this.client.core.relayer.publish(a,O,A)}await this.client.core.history.resolve(I)},this.cleanup=async()=>{const s=[],o=[];this.client.session.getAll().forEach(a=>{let u=!1;(0,d.BwD)(a.expiry)&&(u=!0),this.client.core.crypto.keychain.has(a.topic)||(u=!0),u&&s.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{(0,d.BwD)(a.expiryTimestamp)&&o.push(a.id)}),await Promise.all([...s.map(a=>this.deleteSession({topic:a})),...o.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async s=>{this.requestQueue.queue.push(s),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Ft.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ft.active;const s=this.requestQueue.queue.shift();if(s)try{await this.processRequest(s)}catch(o){this.client.logger.warn(o)}}this.requestQueue.state=Ft.idle},this.processRequest=async s=>{const{topic:o,payload:a,attestation:u,transportType:l,encryptedId:v}=s,_=a.method;if(!this.shouldIgnorePairingRequest({topic:o,requestMethod:_}))switch(_){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:o,payload:a,attestation:u,encryptedId:v});case"wc_sessionSettle":return await this.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return await this.onSessionExtendRequest(o,a);case"wc_sessionPing":return await this.onSessionPingRequest(o,a);case"wc_sessionDelete":return await this.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return await this.onSessionRequest({topic:o,payload:a,attestation:u,encryptedId:v,transportType:l});case"wc_sessionEvent":return await this.onSessionEventRequest(o,a);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:o,payload:a,attestation:u,encryptedId:v,transportType:l});default:return this.client.logger.info(`Unsupported request method ${_}`)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:a,transportType:u}=s,l=(await this.client.core.history.get(o,a.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(o,a,u);case"wc_sessionSettle":return this.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return this.onSessionExtendResponse(o,a);case"wc_sessionPing":return this.onSessionPingResponse(o,a);case"wc_sessionRequest":return this.onSessionRequestResponse(o,a);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(o,a);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=s=>{const{topic:o}=s,{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Decoded payload on topic ${o} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.shouldIgnorePairingRequest=s=>{const{topic:o,requestMethod:a}=s,u=this.expectedPairingMethodMap.get(o);return!u||u.includes(a)?!1:!!(u.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)},this.onSessionProposeRequest=async s=>{const{topic:o,payload:a,attestation:u,encryptedId:l}=s,{params:v,id:_}=a;try{const I=this.client.core.eventClient.getEvent({topic:o});this.isValidConnect(Ae({},a.params));const O=v.expiryTimestamp||(0,d.gn4)(Le.wc_sessionPropose.req.ttl),T=Ae({id:_,pairingTopic:o,expiryTimestamp:O},v);await this.setProposal(_,T);const D=await this.getVerifyContext({attestationId:u,hash:(0,d.rjm)(JSON.stringify(a)),encryptedId:l,metadata:T.proposer.metadata});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),I==null||I.setError(Bt.proposal_listener_not_found)),I==null||I.addTrace(Dt.emit_session_proposal),this.client.events.emit("session_proposal",{id:_,params:T,verifyContext:D})}catch(I){await this.sendError({id:_,topic:o,error:I,rpcOpts:Le.wc_sessionPropose.autoReject}),this.client.logger.error(I)}},this.onSessionProposeResponse=async(s,o,a)=>{const{id:u}=o;if((0,W.isJsonRpcResult)(o)){const{result:l}=o;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const v=this.client.proposal.get(u);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:v});const _=v.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:_});const I=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:I});const O=await this.client.core.crypto.generateSharedKey(_,I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:O});const T=await this.client.core.relayer.subscribe(O,{transportType:a});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:T}),await this.client.core.pairing.activate({topic:s})}else if((0,W.isJsonRpcError)(o)){await this.client.proposal.delete(u,(0,d.D6H)("USER_DISCONNECTED"));const l=(0,d.E0T)("session_connect");if(this.events.listenerCount(l)===0)throw new Error(`emitting ${l} without any listeners, 954`);this.events.emit((0,d.E0T)("session_connect"),{error:o.error})}},this.onSessionSettleRequest=async(s,o)=>{const{id:a,params:u}=o;try{this.isValidSessionSettleRequest(u);const{relay:l,controller:v,expiry:_,namespaces:I,sessionProperties:O,sessionConfig:T}=o.params,D=bt(Ae(Ae({topic:s,relay:l,expiry:_,namespaces:I,acknowledged:!0,pairingTopic:"",requiredNamespaces:{},optionalNamespaces:{},controller:v.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:v.publicKey,metadata:v.metadata}},O&&{sessionProperties:O}),T&&{sessionConfig:T}),{transportType:_e.relay}),A=(0,d.E0T)("session_connect");if(this.events.listenerCount(A)===0)throw new Error(`emitting ${A} without any listeners 997`);this.events.emit((0,d.E0T)("session_connect"),{session:D}),await this.sendResult({id:o.id,topic:s,result:!0,throwOnFailedPublish:!0})}catch(l){await this.sendError({id:a,topic:s,error:l}),this.client.logger.error(l)}},this.onSessionSettleResponse=async(s,o)=>{const{id:a}=o;(0,W.isJsonRpcResult)(o)?(await this.client.session.update(s,{acknowledged:!0}),this.events.emit((0,d.E0T)("session_approve",a),{})):(0,W.isJsonRpcError)(o)&&(await this.client.session.delete(s,(0,d.D6H)("USER_DISCONNECTED")),this.events.emit((0,d.E0T)("session_approve",a),{error:o.error}))},this.onSessionUpdateRequest=async(s,o)=>{const{params:a,id:u}=o;try{const l=`${s}_session_update`,v=d.O6B.get(l);if(v&&this.isRequestOutOfSync(v,u)){this.client.logger.info(`Discarding out of sync request - ${u}`),this.sendError({id:u,topic:s,error:(0,d.D6H)("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Ae({topic:s},a));try{d.O6B.set(l,u),await this.client.session.update(s,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:s,result:!0,throwOnFailedPublish:!0})}catch(_){throw d.O6B.delete(l),_}this.client.events.emit("session_update",{id:u,topic:s,params:a})}catch(l){await this.sendError({id:u,topic:s,error:l}),this.client.logger.error(l)}},this.isRequestOutOfSync=(s,o)=>parseInt(o.toString().slice(0,-3))<=parseInt(s.toString().slice(0,-3)),this.onSessionUpdateResponse=(s,o)=>{const{id:a}=o,u=(0,d.E0T)("session_update",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,W.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_update",a),{}):(0,W.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_update",a),{error:o.error})},this.onSessionExtendRequest=async(s,o)=>{const{id:a}=o;try{this.isValidExtend({topic:s}),await this.setExpiry(s,(0,d.gn4)(Mi)),await this.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:a,topic:s})}catch(u){await this.sendError({id:a,topic:s,error:u}),this.client.logger.error(u)}},this.onSessionExtendResponse=(s,o)=>{const{id:a}=o,u=(0,d.E0T)("session_extend",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,W.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_extend",a),{}):(0,W.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_extend",a),{error:o.error})},this.onSessionPingRequest=async(s,o)=>{const{id:a}=o;try{this.isValidPing({topic:s}),await this.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:a,topic:s})}catch(u){await this.sendError({id:a,topic:s,error:u}),this.client.logger.error(u)}},this.onSessionPingResponse=(s,o)=>{const{id:a}=o,u=(0,d.E0T)("session_ping",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);setTimeout(()=>{(0,W.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_ping",a),{}):(0,W.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_ping",a),{error:o.error})},500)},this.onSessionDeleteRequest=async(s,o)=>{const{id:a}=o;try{this.isValidDisconnect({topic:s,reason:o.params}),Promise.all([new Promise(u=>{this.client.core.relayer.once(Ve.publish,async()=>{u(await this.deleteSession({topic:s,id:a}))})}),this.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:s,error:(0,d.D6H)("USER_DISCONNECTED")})]).catch(u=>this.client.logger.error(u))}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async s=>{var o,a,u;const{topic:l,payload:v,attestation:_,encryptedId:I,transportType:O}=s,{id:T,params:D}=v;try{await this.isValidRequest(Ae({topic:l},D));const A=this.client.session.get(l),M=await this.getVerifyContext({attestationId:_,hash:(0,d.rjm)(JSON.stringify((0,W.formatJsonRpcRequest)("wc_sessionRequest",D,T))),encryptedId:I,metadata:A.peer.metadata,transportType:O}),U={id:T,topic:l,params:D,verifyContext:M};await this.setPendingSessionRequest(U),O===_e.link_mode&&(o=A.peer.metadata.redirect)!=null&&o.universal&&this.client.core.addLinkModeSupportedApp((a=A.peer.metadata.redirect)==null?void 0:a.universal),(u=this.client.signConfig)!=null&&u.disableRequestQueue?this.emitSessionRequest(U):(this.addSessionRequestToSessionRequestQueue(U),this.processSessionRequestQueue())}catch(A){await this.sendError({id:T,topic:l,error:A}),this.client.logger.error(A)}},this.onSessionRequestResponse=(s,o)=>{const{id:a}=o,u=(0,d.E0T)("session_request",a);if(this.events.listenerCount(u)===0)throw new Error(`emitting ${u} without any listeners`);(0,W.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_request",a),{result:o.result}):(0,W.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_request",a),{error:o.error})},this.onSessionEventRequest=async(s,o)=>{const{id:a,params:u}=o;try{const l=`${s}_session_event_${u.event.name}`,v=d.O6B.get(l);if(v&&this.isRequestOutOfSync(v,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(Ae({topic:s},u)),this.client.events.emit("session_event",{id:a,topic:s,params:u}),d.O6B.set(l,a)}catch(l){await this.sendError({id:a,topic:s,error:l}),this.client.logger.error(l)}},this.onSessionAuthenticateResponse=(s,o)=>{const{id:a}=o;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:s,payload:o}),(0,W.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_request",a),{result:o.result}):(0,W.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_request",a),{error:o.error})},this.onSessionAuthenticateRequest=async s=>{var o;const{topic:a,payload:u,attestation:l,encryptedId:v,transportType:_}=s;try{const{requester:I,authPayload:O,expiryTimestamp:T}=u.params,D=await this.getVerifyContext({attestationId:l,hash:(0,d.rjm)(JSON.stringify(u)),encryptedId:v,metadata:I.metadata,transportType:_}),A={requester:I,pairingTopic:a,id:u.id,authPayload:O,verifyContext:D,expiryTimestamp:T};await this.setAuthRequest(u.id,{request:A,pairingTopic:a,transportType:_}),_===_e.link_mode&&(o=I.metadata.redirect)!=null&&o.universal&&this.client.core.addLinkModeSupportedApp(I.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:a,params:u.params,id:u.id,verifyContext:D})}catch(I){this.client.logger.error(I);const O=u.params.requester.publicKey,T=await this.client.core.crypto.generateKeyPair(),D=this.getAppLinkIfEnabled(u.params.requester.metadata,_),A={type:d.rVF,receiverPublicKey:O,senderPublicKey:T};await this.sendError({id:u.id,topic:a,error:I,encodeOpts:A,rpcOpts:Le.wc_sessionAuthenticate.autoReject,appLink:D})}},this.addSessionRequestToSessionRequestQueue=s=>{this.sessionRequestQueue.queue.push(s)},this.cleanupAfterResponse=s=>{this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ft.idle,this.processSessionRequestQueue()},(0,L.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:s,error:o})=>{const a=this.client.core.history.pending;a.length>0&&a.filter(u=>u.topic===s&&u.request.method==="wc_sessionRequest").forEach(u=>{const l=u.request.id,v=(0,d.E0T)("session_request",l);if(this.events.listenerCount(v)===0)throw new Error(`emitting ${v} without any listeners`);this.events.emit((0,d.E0T)("session_request",u.request.id),{error:o})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Ft.active){this.client.logger.info("session request queue is already active.");return}const s=this.sessionRequestQueue.queue[0];if(!s){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ft.active,this.emitSessionRequest(s)}catch(o){this.client.logger.error(o)}},this.emitSessionRequest=s=>{this.client.events.emit("session_request",s)},this.onPairingCreated=s=>{if(s.methods&&this.expectedPairingMethodMap.set(s.topic,s.methods),s.active)return;const o=this.client.proposal.getAll().find(a=>a.pairingTopic===s.topic);o&&this.onSessionProposeRequest({topic:s.topic,payload:(0,W.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,relays:o.relays,proposer:o.proposer,sessionProperties:o.sessionProperties},o.id)})},this.isValidConnect=async s=>{if(!(0,d.EJd)(s)){const{message:_}=(0,d.kCb)("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(_)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:l,relays:v}=s;if((0,d.o8e)(o)||await this.isValidPairingTopic(o),!(0,d.PMr)(v,!0)){const{message:_}=(0,d.kCb)("MISSING_OR_INVALID",`connect() relays: ${v}`);throw new Error(_)}!(0,d.o8e)(a)&&(0,d.L5o)(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!(0,d.o8e)(u)&&(0,d.L5o)(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),(0,d.o8e)(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(s,o)=>{const a=(0,d.naP)(s,"connect()",o);if(a)throw new Error(a.message)},this.isValidApprove=async s=>{if(!(0,d.EJd)(s))throw new Error((0,d.kCb)("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:o,namespaces:a,relayProtocol:u,sessionProperties:l}=s;this.checkRecentlyDeleted(o),await this.isValidProposalId(o);const v=this.client.proposal.get(o),_=(0,d.ing)(a,"approve()");if(_)throw new Error(_.message);const I=(0,d.rFo)(v.requiredNamespaces,a,"approve()");if(I)throw new Error(I.message);if(!(0,d.M_r)(u,!0)){const{message:O}=(0,d.kCb)("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(O)}(0,d.o8e)(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async s=>{if(!(0,d.EJd)(s)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(u)}const{id:o,reason:a}=s;if(this.checkRecentlyDeleted(o),await this.isValidProposalId(o),!(0,d.H4H)(a)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=s=>{if(!(0,d.EJd)(s)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(I)}const{relay:o,controller:a,namespaces:u,expiry:l}=s;if(!(0,d.Z26)(o)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(I)}const v=(0,d.DdM)(a,"onSessionSettleRequest()");if(v)throw new Error(v.message);const _=(0,d.ing)(u,"onSessionSettleRequest()");if(_)throw new Error(_.message);if((0,d.BwD)(l)){const{message:I}=(0,d.kCb)("EXPIRED","onSessionSettleRequest()");throw new Error(I)}},this.isValidUpdate=async s=>{if(!(0,d.EJd)(s)){const{message:_}=(0,d.kCb)("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(_)}const{topic:o,namespaces:a}=s;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o);const u=this.client.session.get(o),l=(0,d.ing)(a,"update()");if(l)throw new Error(l.message);const v=(0,d.rFo)(u.requiredNamespaces,a,"update()");if(v)throw new Error(v.message)},this.isValidExtend=async s=>{if(!(0,d.EJd)(s)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(a)}const{topic:o}=s;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o)},this.isValidRequest=async s=>{if(!(0,d.EJd)(s)){const{message:_}=(0,d.kCb)("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(_)}const{topic:o,request:a,chainId:u,expiry:l}=s;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o);const{namespaces:v}=this.client.session.get(o);if(!(0,d.p8o)(v,u)){const{message:_}=(0,d.kCb)("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(_)}if(!(0,d.hHR)(a)){const{message:_}=(0,d.kCb)("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(_)}if(!(0,d.alS)(v,u,a.method)){const{message:_}=(0,d.kCb)("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(_)}if(l&&!(0,d.ONw)(l,Zr)){const{message:_}=(0,d.kCb)("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${Zr.min} and ${Zr.max}`);throw new Error(_)}},this.isValidRespond=async s=>{var o;if(!(0,d.EJd)(s)){const{message:l}=(0,d.kCb)("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(l)}const{topic:a,response:u}=s;try{await this.isValidSessionTopic(a)}catch(l){throw(o=s==null?void 0:s.response)!=null&&o.id&&this.cleanupAfterResponse(s),l}if(!(0,d.JTI)(u)){const{message:l}=(0,d.kCb)("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(l)}},this.isValidPing=async s=>{if(!(0,d.EJd)(s)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(a)}const{topic:o}=s;await this.isValidSessionOrPairingTopic(o)},this.isValidEmit=async s=>{if(!(0,d.EJd)(s)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(v)}const{topic:o,event:a,chainId:u}=s;await this.isValidSessionTopic(o);const{namespaces:l}=this.client.session.get(o);if(!(0,d.p8o)(l,u)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(v)}if(!(0,d.nfW)(a)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}if(!(0,d.B95)(l,u,a.name)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}},this.isValidDisconnect=async s=>{if(!(0,d.EJd)(s)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(a)}const{topic:o}=s;await this.isValidSessionOrPairingTopic(o)},this.isValidAuthenticate=s=>{const{chains:o,uri:a,domain:u,nonce:l}=s;if(!Array.isArray(o)||o.length===0)throw new Error("chains is required and must be a non-empty array");if(!(0,d.M_r)(a,!1))throw new Error("uri is required parameter");if(!(0,d.M_r)(u,!1))throw new Error("domain is required parameter");if(!(0,d.M_r)(l,!1))throw new Error("nonce is required parameter");if([...new Set(o.map(_=>(0,d.DQe)(_).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:v}=(0,d.DQe)(o[0]);if(v!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")},this.getVerifyContext=async s=>{const{attestationId:o,hash:a,encryptedId:u,metadata:l,transportType:v}=s,_={verified:{verifyUrl:l.verifyUrl||hs,validation:"UNKNOWN",origin:l.url||""}};try{if(v===_e.link_mode){const O=this.getAppLinkIfEnabled(l,v);return _.verified.validation=O&&new URL(O).origin===new URL(l.url).origin?"VALID":"INVALID",_}const I=await this.client.core.verify.resolve({attestationId:o,hash:a,encryptedId:u,verifyUrl:l.verifyUrl});I&&(_.verified.origin=I.origin,_.verified.isScam=I.isScam,_.verified.validation=I.origin===new URL(l.url).origin?"VALID":"INVALID")}catch(I){this.client.logger.warn(I)}return this.client.logger.debug(`Verify context: ${JSON.stringify(_)}`),_},this.validateSessionProps=(s,o)=>{Object.values(s).forEach(a=>{if(!(0,d.M_r)(a,!1)){const{message:u}=(0,d.kCb)("MISSING_OR_INVALID",`${o} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})},this.getPendingAuthRequest=s=>{const o=this.client.auth.requests.get(s);return typeof o=="object"?o:void 0},this.addToRecentlyDeleted=(s,o)=>{if(this.recentlyDeletedMap.set(s,o),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0;const u=this.recentlyDeletedLimit/2;for(const l of this.recentlyDeletedMap.keys()){if(a++>=u)break;this.recentlyDeletedMap.delete(l)}}},this.checkRecentlyDeleted=s=>{const o=this.recentlyDeletedMap.get(s);if(o){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Record was recently deleted - ${o}: ${s}`);throw new Error(a)}},this.isLinkModeEnabled=(s,o)=>{var a,u,l,v,_,I,O,T,D;return!s||o!==_e.link_mode?!1:((u=(a=this.client.metadata)==null?void 0:a.redirect)==null?void 0:u.linkMode)===!0&&((v=(l=this.client.metadata)==null?void 0:l.redirect)==null?void 0:v.universal)!==void 0&&((I=(_=this.client.metadata)==null?void 0:_.redirect)==null?void 0:I.universal)!==""&&((O=s==null?void 0:s.redirect)==null?void 0:O.universal)!==void 0&&((T=s==null?void 0:s.redirect)==null?void 0:T.universal)!==""&&((D=s==null?void 0:s.redirect)==null?void 0:D.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(s.redirect.universal)&&typeof(Y.g==null?void 0:Y.g.Linking)<"u"},this.getAppLinkIfEnabled=(s,o)=>{var a;return this.isLinkModeEnabled(s,o)?(a=s==null?void 0:s.redirect)==null?void 0:a.universal:void 0},this.handleLinkModeMessage=({url:s})=>{if(!s||!s.includes("wc_ev")||!s.includes("topic"))return;const o=(0,d.waw)(s,"topic")||"",a=decodeURIComponent((0,d.waw)(s,"wc_ev")||""),u=this.client.session.keys.includes(o);u&&this.client.session.update(o,{transportType:_e.link_mode}),this.client.core.dispatchEnvelope({topic:o,message:a,sessionExists:u})},this.registerLinkModeListeners=async()=>{var s;if(typeof dd<"u"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST||(0,d.b$m)()&&(s=this.client.metadata.redirect)!=null&&s.linkMode){const o=Y.g==null?void 0:Y.g.Linking;if(typeof o<"u"){o.addEventListener("url",this.handleLinkModeMessage,this.client.name);const a=await o.getInitialURL();a&&setTimeout(()=>{this.handleLinkModeMessage({url:a})},50)}}}}isInitialized(){if(!this.initialized){const{message:r}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(r)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ve.message,r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):this.onRelayMessage(r)})}async onRelayMessage(r){const{topic:s,message:o,attestation:a,transportType:u}=r,{publicKey:l}=this.client.auth.authKeys.keys.includes(Vs)?this.client.auth.authKeys.get(Vs):{responseTopic:void 0,publicKey:void 0},v=await this.client.core.crypto.decode(s,o,{receiverPublicKey:l,encoding:u===_e.link_mode?d.zl_:d.$dT});try{(0,W.isJsonRpcRequest)(v)?(this.client.core.history.set(s,v),this.onRelayEventRequest({topic:s,payload:v,attestation:a,transportType:u,encryptedId:(0,d.rjm)(o)})):(0,W.isJsonRpcResponse)(v)?(await this.client.core.history.resolve(v),await this.onRelayEventResponse({topic:s,payload:v,transportType:u}),this.client.core.history.delete(s,v.id)):this.onRelayEventUnknownPayload({topic:s,payload:v,transportType:u})}catch(_){this.client.logger.error(_)}}registerExpirerEvents(){this.client.core.expirer.on(ht.expired,async r=>{const{topic:s,id:o}=(0,d.iPz)(r.target);if(o&&this.client.pendingRequest.keys.includes(o))return await this.deletePendingSessionRequest(o,(0,d.kCb)("EXPIRED"),!0);if(o&&this.client.auth.requests.keys.includes(o))return await this.deletePendingAuthRequest(o,(0,d.kCb)("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(await this.deleteSession({topic:s,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:s})):o&&(await this.deleteProposal(o,!0),this.client.events.emit("proposal_expire",{id:o}))})}registerPairingEvents(){this.client.core.pairing.events.on(Fi.create,r=>this.onPairingCreated(r)),this.client.core.pairing.events.on(Fi.delete,r=>{this.addToRecentlyDeleted(r.topic,"pairing")})}isValidPairingTopic(r){if(!(0,d.M_r)(r,!1)){const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:s}=(0,d.kCb)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if((0,d.BwD)(this.client.core.pairing.pairings.get(r).expiry)){const{message:s}=(0,d.kCb)("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}}async isValidSessionTopic(r){if(!(0,d.M_r)(r,!1)){const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(s)}if(this.checkRecentlyDeleted(r),!this.client.session.keys.includes(r)){const{message:s}=(0,d.kCb)("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(s)}if((0,d.BwD)(this.client.session.get(r).expiry)){await this.deleteSession({topic:r});const{message:s}=(0,d.kCb)("EXPIRED",`session topic: ${r}`);throw new Error(s)}if(!this.client.core.crypto.keychain.has(r)){const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`session topic does not exist in keychain: ${r}`);throw await this.deleteSession({topic:r}),new Error(s)}}async isValidSessionOrPairingTopic(r){if(this.checkRecentlyDeleted(r),this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if((0,d.M_r)(r,!1)){const{message:s}=(0,d.kCb)("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(s)}else{const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(s)}}async isValidProposalId(r){if(!(0,d.Q01)(r)){const{message:s}=(0,d.kCb)("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(s)}if(!this.client.proposal.keys.includes(r)){const{message:s}=(0,d.kCb)("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(s)}if((0,d.BwD)(this.client.proposal.get(r).expiryTimestamp)){await this.deleteProposal(r);const{message:s}=(0,d.kCb)("EXPIRED",`proposal id: ${r}`);throw new Error(s)}}}class Td extends _i{constructor(r,s){super(r,s,gd,Qr),this.core=r,this.logger=s}}class Ad extends _i{constructor(r,s){super(r,s,fd,Qr),this.core=r,this.logger=s}}class Nd extends _i{constructor(r,s){super(r,s,vd,Qr,o=>o.id),this.core=r,this.logger=s}}class qd extends _i{constructor(r,s){super(r,s,bd,Ks,()=>Vs),this.core=r,this.logger=s}}class Dd extends _i{constructor(r,s){super(r,s,Ed,Ks),this.core=r,this.logger=s}}class Fd extends _i{constructor(r,s){super(r,s,Id,Ks,o=>o.id),this.core=r,this.logger=s}}class kd{constructor(r,s){this.core=r,this.logger=s,this.authKeys=new qd(this.core,this.logger),this.pairingTopics=new Dd(this.core,this.logger),this.requests=new Fd(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}class Xr extends we{constructor(r){super(r),this.protocol=_a,this.version=ba,this.name=Yr.name,this.events=new Te.EventEmitter,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.removeAllListeners=o=>this.events.removeAllListeners(o),this.connect=async o=>{try{return await this.engine.connect(o)}catch(a){throw this.logger.error(a.message),a}},this.pair=async o=>{try{return await this.engine.pair(o)}catch(a){throw this.logger.error(a.message),a}},this.approve=async o=>{try{return await this.engine.approve(o)}catch(a){throw this.logger.error(a.message),a}},this.reject=async o=>{try{return await this.engine.reject(o)}catch(a){throw this.logger.error(a.message),a}},this.update=async o=>{try{return await this.engine.update(o)}catch(a){throw this.logger.error(a.message),a}},this.extend=async o=>{try{return await this.engine.extend(o)}catch(a){throw this.logger.error(a.message),a}},this.request=async o=>{try{return await this.engine.request(o)}catch(a){throw this.logger.error(a.message),a}},this.respond=async o=>{try{return await this.engine.respond(o)}catch(a){throw this.logger.error(a.message),a}},this.ping=async o=>{try{return await this.engine.ping(o)}catch(a){throw this.logger.error(a.message),a}},this.emit=async o=>{try{return await this.engine.emit(o)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async o=>{try{return await this.engine.disconnect(o)}catch(a){throw this.logger.error(a.message),a}},this.find=o=>{try{return this.engine.find(o)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(o){throw this.logger.error(o.message),o}},this.authenticate=async(o,a)=>{try{return await this.engine.authenticate(o,a)}catch(u){throw this.logger.error(u.message),u}},this.formatAuthMessage=o=>{try{return this.engine.formatAuthMessage(o)}catch(a){throw this.logger.error(a.message),a}},this.approveSessionAuthenticate=async o=>{try{return await this.engine.approveSessionAuthenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.rejectSessionAuthenticate=async o=>{try{return await this.engine.rejectSessionAuthenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.name=(r==null?void 0:r.name)||Yr.name,this.metadata=(r==null?void 0:r.metadata)||(0,d.DaH)(),this.signConfig=r==null?void 0:r.signConfig;const s=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:(0,se.gw)((0,se.jI)({level:(r==null?void 0:r.logger)||Yr.logger}));this.core=(r==null?void 0:r.core)||new pd(r),this.logger=(0,se.Ep)(s,this.name),this.session=new Ad(this.core,this.logger),this.proposal=new Td(this.core,this.logger),this.pendingRequest=new Nd(this.core,this.logger),this.engine=new Od(this),this.auth=new kd(this.core,this.logger)}static async init(r){const s=new Xr(r);return await s.initialize(),s}get context(){return(0,se.Fd)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),this.engine.processRelayMessageCache()}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}}const Rb=null,Ob=null;var kt=Y(51916);const Sa="error",Md="wss://relay.walletconnect.com",Ld="wc",$d="universal_provider",Ra=`${Ld}@2:${$d}:`,jd="https://rpc.walletconnect.com/v1/",Li="generic",Et={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var ds=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Y.g<"u"?Y.g:typeof self<"u"?self:{},en={exports:{}};(function(y,r){(function(){var s,o="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",v="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",I=500,O="__lodash_placeholder__",T=1,D=2,A=4,M=1,U=2,j=1,z=2,ee=4,pe=8,Q=16,Z=32,Ie=64,be=128,de=256,Pt=512,ln=30,Qs="...",gs=800,ji=16,zi=1,Jt=2,Ii=3,Mt=1/0,Re=9007199254740991,Fe=17976931348623157e292,Gt=NaN,et=4294967295,Ys=et-1,Wt=et>>>1,fs=[["ary",be],["bind",j],["bindKey",z],["curry",pe],["curryRight",Q],["flip",Pt],["partial",Z],["partialRight",Ie],["rearg",de]],Qt="[object Arguments]",Lt="[object Array]",Ui="[object AsyncFunction]",Ct="[object Boolean]",Yt="[object Date]",ys="[object DOMException]",Pi="[object Error]",Hi="[object Function]",Ki="[object GeneratorFunction]",tt="[object Map]",vs="[object Number]",Og="[object Null]",Zt="[object Object]",Ha="[object Promise]",Tg="[object Proxy]",ms="[object RegExp]",xt="[object Set]",ws="[object String]",Zs="[object Symbol]",Ag="[object Undefined]",_s="[object WeakMap]",Ng="[object WeakSet]",bs="[object ArrayBuffer]",Vi="[object DataView]",pn="[object Float32Array]",dn="[object Float64Array]",gn="[object Int8Array]",fn="[object Int16Array]",yn="[object Int32Array]",vn="[object Uint8Array]",mn="[object Uint8ClampedArray]",wn="[object Uint16Array]",_n="[object Uint32Array]",qg=/\b__p \+= '';/g,Dg=/\b(__p \+=) '' \+/g,Fg=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ka=/&(?:amp|lt|gt|quot|#39);/g,Va=/[&<>"']/g,kg=RegExp(Ka.source),Mg=RegExp(Va.source),Lg=/<%-([\s\S]+?)%>/g,$g=/<%([\s\S]+?)%>/g,Ba=/<%=([\s\S]+?)%>/g,jg=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zg=/^\w*$/,Ug=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bn=/[\\^$.*+?()[\]{}|]/g,Hg=RegExp(bn.source),En=/^\s+/,Kg=/\s/,Vg=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Bg=/\{\n\/\* \[wrapped with (.+)\] \*/,Jg=/,? & /,Gg=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Wg=/[()=,{}\[\]\/\s]/,Qg=/\\(\\)?/g,Yg=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ja=/\w*$/,Zg=/^[-+]0x[0-9a-f]+$/i,Xg=/^0b[01]+$/i,ef=/^\[object .+?Constructor\]$/,tf=/^0o[0-7]+$/i,sf=/^(?:0|[1-9]\d*)$/,rf=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Xs=/($^)/,nf=/['\n\r\u2028\u2029\\]/g,er="\\ud800-\\udfff",of="\\u0300-\\u036f",af="\\ufe20-\\ufe2f",cf="\\u20d0-\\u20ff",Ga=of+af+cf,Wa="\\u2700-\\u27bf",Qa="a-z\\xdf-\\xf6\\xf8-\\xff",hf="\\xac\\xb1\\xd7\\xf7",uf="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",lf="\\u2000-\\u206f",pf=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ya="A-Z\\xc0-\\xd6\\xd8-\\xde",Za="\\ufe0e\\ufe0f",Xa=hf+uf+lf+pf,In="['\u2019]",df="["+er+"]",ec="["+Xa+"]",tr="["+Ga+"]",tc="\\d+",gf="["+Wa+"]",ic="["+Qa+"]",sc="[^"+er+Xa+tc+Wa+Qa+Ya+"]",Pn="\\ud83c[\\udffb-\\udfff]",ff="(?:"+tr+"|"+Pn+")",rc="[^"+er+"]",Cn="(?:\\ud83c[\\udde6-\\uddff]){2}",xn="[\\ud800-\\udbff][\\udc00-\\udfff]",Bi="["+Ya+"]",nc="\\u200d",oc="(?:"+ic+"|"+sc+")",yf="(?:"+Bi+"|"+sc+")",ac="(?:"+In+"(?:d|ll|m|re|s|t|ve))?",cc="(?:"+In+"(?:D|LL|M|RE|S|T|VE))?",hc=ff+"?",uc="["+Za+"]?",vf="(?:"+nc+"(?:"+[rc,Cn,xn].join("|")+")"+uc+hc+")*",mf="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",wf="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",lc=uc+hc+vf,_f="(?:"+[gf,Cn,xn].join("|")+")"+lc,bf="(?:"+[rc+tr+"?",tr,Cn,xn,df].join("|")+")",Ef=RegExp(In,"g"),If=RegExp(tr,"g"),Sn=RegExp(Pn+"(?="+Pn+")|"+bf+lc,"g"),Pf=RegExp([Bi+"?"+ic+"+"+ac+"(?="+[ec,Bi,"$"].join("|")+")",yf+"+"+cc+"(?="+[ec,Bi+oc,"$"].join("|")+")",Bi+"?"+oc+"+"+ac,Bi+"+"+cc,wf,mf,tc,_f].join("|"),"g"),Cf=RegExp("["+nc+er+Ga+Za+"]"),xf=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Sf=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Rf=-1,xe={};xe[pn]=xe[dn]=xe[gn]=xe[fn]=xe[yn]=xe[vn]=xe[mn]=xe[wn]=xe[_n]=!0,xe[Qt]=xe[Lt]=xe[bs]=xe[Ct]=xe[Vi]=xe[Yt]=xe[Pi]=xe[Hi]=xe[tt]=xe[vs]=xe[Zt]=xe[ms]=xe[xt]=xe[ws]=xe[_s]=!1;var Pe={};Pe[Qt]=Pe[Lt]=Pe[bs]=Pe[Vi]=Pe[Ct]=Pe[Yt]=Pe[pn]=Pe[dn]=Pe[gn]=Pe[fn]=Pe[yn]=Pe[tt]=Pe[vs]=Pe[Zt]=Pe[ms]=Pe[xt]=Pe[ws]=Pe[Zs]=Pe[vn]=Pe[mn]=Pe[wn]=Pe[_n]=!0,Pe[Pi]=Pe[Hi]=Pe[_s]=!1;var Of={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Tf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Af={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Nf={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qf=parseFloat,Df=parseInt,pc=typeof ds=="object"&&ds&&ds.Object===Object&&ds,Ff=typeof self=="object"&&self&&self.Object===Object&&self,ze=pc||Ff||Function("return this")(),Rn=r&&!r.nodeType&&r,Ci=Rn&&!0&&y&&!y.nodeType&&y,dc=Ci&&Ci.exports===Rn,On=dc&&pc.process,ut=function(){try{var b=Ci&&Ci.require&&Ci.require("util").types;return b||On&&On.binding&&On.binding("util")}catch{}}(),gc=ut&&ut.isArrayBuffer,fc=ut&&ut.isDate,yc=ut&&ut.isMap,vc=ut&&ut.isRegExp,mc=ut&&ut.isSet,wc=ut&&ut.isTypedArray;function it(b,C,P){switch(P.length){case 0:return b.call(C);case 1:return b.call(C,P[0]);case 2:return b.call(C,P[0],P[1]);case 3:return b.call(C,P[0],P[1],P[2])}return b.apply(C,P)}function kf(b,C,P,$){for(var te=-1,ge=b==null?0:b.length;++te<ge;){var ke=b[te];C($,ke,P(ke),b)}return $}function lt(b,C){for(var P=-1,$=b==null?0:b.length;++P<$&&C(b[P],P,b)!==!1;);return b}function Mf(b,C){for(var P=b==null?0:b.length;P--&&C(b[P],P,b)!==!1;);return b}function _c(b,C){for(var P=-1,$=b==null?0:b.length;++P<$;)if(!C(b[P],P,b))return!1;return!0}function hi(b,C){for(var P=-1,$=b==null?0:b.length,te=0,ge=[];++P<$;){var ke=b[P];C(ke,P,b)&&(ge[te++]=ke)}return ge}function ir(b,C){var P=b==null?0:b.length;return!!P&&Ji(b,C,0)>-1}function Tn(b,C,P){for(var $=-1,te=b==null?0:b.length;++$<te;)if(P(C,b[$]))return!0;return!1}function Se(b,C){for(var P=-1,$=b==null?0:b.length,te=Array($);++P<$;)te[P]=C(b[P],P,b);return te}function ui(b,C){for(var P=-1,$=C.length,te=b.length;++P<$;)b[te+P]=C[P];return b}function An(b,C,P,$){var te=-1,ge=b==null?0:b.length;for($&&ge&&(P=b[++te]);++te<ge;)P=C(P,b[te],te,b);return P}function Lf(b,C,P,$){var te=b==null?0:b.length;for($&&te&&(P=b[--te]);te--;)P=C(P,b[te],te,b);return P}function Nn(b,C){for(var P=-1,$=b==null?0:b.length;++P<$;)if(C(b[P],P,b))return!0;return!1}var $f=qn("length");function jf(b){return b.split("")}function zf(b){return b.match(Gg)||[]}function bc(b,C,P){var $;return P(b,function(te,ge,ke){if(C(te,ge,ke))return $=ge,!1}),$}function sr(b,C,P,$){for(var te=b.length,ge=P+($?1:-1);$?ge--:++ge<te;)if(C(b[ge],ge,b))return ge;return-1}function Ji(b,C,P){return C===C?Xf(b,C,P):sr(b,Ec,P)}function Uf(b,C,P,$){for(var te=P-1,ge=b.length;++te<ge;)if($(b[te],C))return te;return-1}function Ec(b){return b!==b}function Ic(b,C){var P=b==null?0:b.length;return P?Fn(b,C)/P:Gt}function qn(b){return function(C){return C==null?s:C[b]}}function Dn(b){return function(C){return b==null?s:b[C]}}function Pc(b,C,P,$,te){return te(b,function(ge,ke,Ee){P=$?($=!1,ge):C(P,ge,ke,Ee)}),P}function Hf(b,C){var P=b.length;for(b.sort(C);P--;)b[P]=b[P].value;return b}function Fn(b,C){for(var P,$=-1,te=b.length;++$<te;){var ge=C(b[$]);ge!==s&&(P=P===s?ge:P+ge)}return P}function kn(b,C){for(var P=-1,$=Array(b);++P<b;)$[P]=C(P);return $}function Kf(b,C){return Se(C,function(P){return[P,b[P]]})}function Cc(b){return b&&b.slice(0,Oc(b)+1).replace(En,"")}function st(b){return function(C){return b(C)}}function Mn(b,C){return Se(C,function(P){return b[P]})}function Es(b,C){return b.has(C)}function xc(b,C){for(var P=-1,$=b.length;++P<$&&Ji(C,b[P],0)>-1;);return P}function Sc(b,C){for(var P=b.length;P--&&Ji(C,b[P],0)>-1;);return P}function Vf(b,C){for(var P=b.length,$=0;P--;)b[P]===C&&++$;return $}var Bf=Dn(Of),Jf=Dn(Tf);function Gf(b){return"\\"+Nf[b]}function Wf(b,C){return b==null?s:b[C]}function Gi(b){return Cf.test(b)}function Qf(b){return xf.test(b)}function Yf(b){for(var C,P=[];!(C=b.next()).done;)P.push(C.value);return P}function Ln(b){var C=-1,P=Array(b.size);return b.forEach(function($,te){P[++C]=[te,$]}),P}function Rc(b,C){return function(P){return b(C(P))}}function li(b,C){for(var P=-1,$=b.length,te=0,ge=[];++P<$;){var ke=b[P];(ke===C||ke===O)&&(b[P]=O,ge[te++]=P)}return ge}function rr(b){var C=-1,P=Array(b.size);return b.forEach(function($){P[++C]=$}),P}function Zf(b){var C=-1,P=Array(b.size);return b.forEach(function($){P[++C]=[$,$]}),P}function Xf(b,C,P){for(var $=P-1,te=b.length;++$<te;)if(b[$]===C)return $;return-1}function ey(b,C,P){for(var $=P+1;$--;)if(b[$]===C)return $;return $}function Wi(b){return Gi(b)?iy(b):$f(b)}function St(b){return Gi(b)?sy(b):jf(b)}function Oc(b){for(var C=b.length;C--&&Kg.test(b.charAt(C)););return C}var ty=Dn(Af);function iy(b){for(var C=Sn.lastIndex=0;Sn.test(b);)++C;return C}function sy(b){return b.match(Sn)||[]}function ry(b){return b.match(Pf)||[]}var ny=function b(C){C=C==null?ze:Qi.defaults(ze.Object(),C,Qi.pick(ze,Sf));var P=C.Array,$=C.Date,te=C.Error,ge=C.Function,ke=C.Math,Ee=C.Object,$n=C.RegExp,oy=C.String,pt=C.TypeError,nr=P.prototype,ay=ge.prototype,Yi=Ee.prototype,or=C["__core-js_shared__"],ar=ay.toString,me=Yi.hasOwnProperty,cy=0,Tc=function(){var e=/[^.]+$/.exec(or&&or.keys&&or.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),cr=Yi.toString,hy=ar.call(Ee),uy=ze._,ly=$n("^"+ar.call(me).replace(bn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hr=dc?C.Buffer:s,pi=C.Symbol,ur=C.Uint8Array,Ac=hr?hr.allocUnsafe:s,lr=Rc(Ee.getPrototypeOf,Ee),Nc=Ee.create,qc=Yi.propertyIsEnumerable,pr=nr.splice,Dc=pi?pi.isConcatSpreadable:s,Is=pi?pi.iterator:s,xi=pi?pi.toStringTag:s,dr=function(){try{var e=Ai(Ee,"defineProperty");return e({},"",{}),e}catch{}}(),py=C.clearTimeout!==ze.clearTimeout&&C.clearTimeout,dy=$&&$.now!==ze.Date.now&&$.now,gy=C.setTimeout!==ze.setTimeout&&C.setTimeout,gr=ke.ceil,fr=ke.floor,jn=Ee.getOwnPropertySymbols,fy=hr?hr.isBuffer:s,Fc=C.isFinite,yy=nr.join,vy=Rc(Ee.keys,Ee),Me=ke.max,He=ke.min,my=$.now,wy=C.parseInt,kc=ke.random,_y=nr.reverse,zn=Ai(C,"DataView"),Ps=Ai(C,"Map"),Un=Ai(C,"Promise"),Zi=Ai(C,"Set"),Cs=Ai(C,"WeakMap"),xs=Ai(Ee,"create"),yr=Cs&&new Cs,Xi={},by=Ni(zn),Ey=Ni(Ps),Iy=Ni(Un),Py=Ni(Zi),Cy=Ni(Cs),vr=pi?pi.prototype:s,Ss=vr?vr.valueOf:s,Mc=vr?vr.toString:s;function g(e){if(Ne(e)&&!ie(e)&&!(e instanceof ue)){if(e instanceof dt)return e;if(me.call(e,"__wrapped__"))return Lh(e)}return new dt(e)}var es=function(){function e(){}return function(t){if(!Oe(t))return{};if(Nc)return Nc(t);e.prototype=t;var n=new e;return e.prototype=s,n}}();function mr(){}function dt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=s}g.templateSettings={escape:Lg,evaluate:$g,interpolate:Ba,variable:"",imports:{_:g}},g.prototype=mr.prototype,g.prototype.constructor=g,dt.prototype=es(mr.prototype),dt.prototype.constructor=dt;function ue(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=et,this.__views__=[]}function xy(){var e=new ue(this.__wrapped__);return e.__actions__=We(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=We(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=We(this.__views__),e}function Sy(){if(this.__filtered__){var e=new ue(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Ry(){var e=this.__wrapped__.value(),t=this.__dir__,n=ie(e),h=t<0,p=n?e.length:0,f=jv(0,p,this.__views__),m=f.start,w=f.end,E=w-m,x=h?w:m-1,S=this.__iteratees__,R=S.length,F=0,H=He(E,this.__takeCount__);if(!n||!h&&p==E&&H==E)return ah(e,this.__actions__);var J=[];e:for(;E--&&F<H;){x+=t;for(var oe=-1,G=e[x];++oe<R;){var ce=S[oe],le=ce.iteratee,ot=ce.type,Ge=le(G);if(ot==Jt)G=Ge;else if(!Ge){if(ot==zi)continue e;break e}}J[F++]=G}return J}ue.prototype=es(mr.prototype),ue.prototype.constructor=ue;function Si(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Oy(){this.__data__=xs?xs(null):{},this.size=0}function Ty(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Ay(e){var t=this.__data__;if(xs){var n=t[e];return n===_?s:n}return me.call(t,e)?t[e]:s}function Ny(e){var t=this.__data__;return xs?t[e]!==s:me.call(t,e)}function qy(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=xs&&t===s?_:t,this}Si.prototype.clear=Oy,Si.prototype.delete=Ty,Si.prototype.get=Ay,Si.prototype.has=Ny,Si.prototype.set=qy;function Xt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function Dy(){this.__data__=[],this.size=0}function Fy(e){var t=this.__data__,n=wr(t,e);if(n<0)return!1;var h=t.length-1;return n==h?t.pop():pr.call(t,n,1),--this.size,!0}function ky(e){var t=this.__data__,n=wr(t,e);return n<0?s:t[n][1]}function My(e){return wr(this.__data__,e)>-1}function Ly(e,t){var n=this.__data__,h=wr(n,e);return h<0?(++this.size,n.push([e,t])):n[h][1]=t,this}Xt.prototype.clear=Dy,Xt.prototype.delete=Fy,Xt.prototype.get=ky,Xt.prototype.has=My,Xt.prototype.set=Ly;function ei(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var h=e[t];this.set(h[0],h[1])}}function $y(){this.size=0,this.__data__={hash:new Si,map:new(Ps||Xt),string:new Si}}function jy(e){var t=Ar(this,e).delete(e);return this.size-=t?1:0,t}function zy(e){return Ar(this,e).get(e)}function Uy(e){return Ar(this,e).has(e)}function Hy(e,t){var n=Ar(this,e),h=n.size;return n.set(e,t),this.size+=n.size==h?0:1,this}ei.prototype.clear=$y,ei.prototype.delete=jy,ei.prototype.get=zy,ei.prototype.has=Uy,ei.prototype.set=Hy;function Ri(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new ei;++t<n;)this.add(e[t])}function Ky(e){return this.__data__.set(e,_),this}function Vy(e){return this.__data__.has(e)}Ri.prototype.add=Ri.prototype.push=Ky,Ri.prototype.has=Vy;function Rt(e){var t=this.__data__=new Xt(e);this.size=t.size}function By(){this.__data__=new Xt,this.size=0}function Jy(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Gy(e){return this.__data__.get(e)}function Wy(e){return this.__data__.has(e)}function Qy(e,t){var n=this.__data__;if(n instanceof Xt){var h=n.__data__;if(!Ps||h.length<a-1)return h.push([e,t]),this.size=++n.size,this;n=this.__data__=new ei(h)}return n.set(e,t),this.size=n.size,this}Rt.prototype.clear=By,Rt.prototype.delete=Jy,Rt.prototype.get=Gy,Rt.prototype.has=Wy,Rt.prototype.set=Qy;function Lc(e,t){var n=ie(e),h=!n&&qi(e),p=!n&&!h&&vi(e),f=!n&&!h&&!p&&ns(e),m=n||h||p||f,w=m?kn(e.length,oy):[],E=w.length;for(var x in e)(t||me.call(e,x))&&!(m&&(x=="length"||p&&(x=="offset"||x=="parent")||f&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||ri(x,E)))&&w.push(x);return w}function $c(e){var t=e.length;return t?e[Xn(0,t-1)]:s}function Yy(e,t){return Nr(We(e),Oi(t,0,e.length))}function Zy(e){return Nr(We(e))}function Hn(e,t,n){(n!==s&&!Ot(e[t],n)||n===s&&!(t in e))&&ti(e,t,n)}function Rs(e,t,n){var h=e[t];(!(me.call(e,t)&&Ot(h,n))||n===s&&!(t in e))&&ti(e,t,n)}function wr(e,t){for(var n=e.length;n--;)if(Ot(e[n][0],t))return n;return-1}function Xy(e,t,n,h){return di(e,function(p,f,m){t(h,p,n(p),m)}),h}function jc(e,t){return e&&jt(t,$e(t),e)}function ev(e,t){return e&&jt(t,Ye(t),e)}function ti(e,t,n){t=="__proto__"&&dr?dr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Kn(e,t){for(var n=-1,h=t.length,p=P(h),f=e==null;++n<h;)p[n]=f?s:Co(e,t[n]);return p}function Oi(e,t,n){return e===e&&(n!==s&&(e=e<=n?e:n),t!==s&&(e=e>=t?e:t)),e}function gt(e,t,n,h,p,f){var m,w=t&T,E=t&D,x=t&A;if(n&&(m=p?n(e,h,p,f):n(e)),m!==s)return m;if(!Oe(e))return e;var S=ie(e);if(S){if(m=Uv(e),!w)return We(e,m)}else{var R=Ke(e),F=R==Hi||R==Ki;if(vi(e))return uh(e,w);if(R==Zt||R==Qt||F&&!p){if(m=E||F?{}:Oh(e),!w)return E?Av(e,ev(m,e)):Tv(e,jc(m,e))}else{if(!Pe[R])return p?e:{};m=Hv(e,R,w)}}f||(f=new Rt);var H=f.get(e);if(H)return H;f.set(e,m),ru(e)?e.forEach(function(G){m.add(gt(G,t,n,G,e,f))}):iu(e)&&e.forEach(function(G,ce){m.set(ce,gt(G,t,n,ce,e,f))});var J=x?E?uo:ho:E?Ye:$e,oe=S?s:J(e);return lt(oe||e,function(G,ce){oe&&(ce=G,G=e[ce]),Rs(m,ce,gt(G,t,n,ce,e,f))}),m}function tv(e){var t=$e(e);return function(n){return zc(n,e,t)}}function zc(e,t,n){var h=n.length;if(e==null)return!h;for(e=Ee(e);h--;){var p=n[h],f=t[p],m=e[p];if(m===s&&!(p in e)||!f(m))return!1}return!0}function Uc(e,t,n){if(typeof e!="function")throw new pt(l);return Fs(function(){e.apply(s,n)},t)}function Os(e,t,n,h){var p=-1,f=ir,m=!0,w=e.length,E=[],x=t.length;if(!w)return E;n&&(t=Se(t,st(n))),h?(f=Tn,m=!1):t.length>=a&&(f=Es,m=!1,t=new Ri(t));e:for(;++p<w;){var S=e[p],R=n==null?S:n(S);if(S=h||S!==0?S:0,m&&R===R){for(var F=x;F--;)if(t[F]===R)continue e;E.push(S)}else f(t,R,h)||E.push(S)}return E}var di=fh($t),Hc=fh(Bn,!0);function iv(e,t){var n=!0;return di(e,function(h,p,f){return n=!!t(h,p,f),n}),n}function _r(e,t,n){for(var h=-1,p=e.length;++h<p;){var f=e[h],m=t(f);if(m!=null&&(w===s?m===m&&!nt(m):n(m,w)))var w=m,E=f}return E}function sv(e,t,n,h){var p=e.length;for(n=ne(n),n<0&&(n=-n>p?0:p+n),h=h===s||h>p?p:ne(h),h<0&&(h+=p),h=n>h?0:ou(h);n<h;)e[n++]=t;return e}function Kc(e,t){var n=[];return di(e,function(h,p,f){t(h,p,f)&&n.push(h)}),n}function Ue(e,t,n,h,p){var f=-1,m=e.length;for(n||(n=Vv),p||(p=[]);++f<m;){var w=e[f];t>0&&n(w)?t>1?Ue(w,t-1,n,h,p):ui(p,w):h||(p[p.length]=w)}return p}var Vn=yh(),Vc=yh(!0);function $t(e,t){return e&&Vn(e,t,$e)}function Bn(e,t){return e&&Vc(e,t,$e)}function br(e,t){return hi(t,function(n){return ni(e[n])})}function Ti(e,t){t=fi(t,e);for(var n=0,h=t.length;e!=null&&n<h;)e=e[zt(t[n++])];return n&&n==h?e:s}function Bc(e,t,n){var h=t(e);return ie(e)?h:ui(h,n(e))}function Be(e){return e==null?e===s?Ag:Og:xi&&xi in Ee(e)?$v(e):Zv(e)}function Jn(e,t){return e>t}function rv(e,t){return e!=null&&me.call(e,t)}function nv(e,t){return e!=null&&t in Ee(e)}function ov(e,t,n){return e>=He(t,n)&&e<Me(t,n)}function Gn(e,t,n){for(var h=n?Tn:ir,p=e[0].length,f=e.length,m=f,w=P(f),E=1/0,x=[];m--;){var S=e[m];m&&t&&(S=Se(S,st(t))),E=He(S.length,E),w[m]=!n&&(t||p>=120&&S.length>=120)?new Ri(m&&S):s}S=e[0];var R=-1,F=w[0];e:for(;++R<p&&x.length<E;){var H=S[R],J=t?t(H):H;if(H=n||H!==0?H:0,!(F?Es(F,J):h(x,J,n))){for(m=f;--m;){var oe=w[m];if(!(oe?Es(oe,J):h(e[m],J,n)))continue e}F&&F.push(J),x.push(H)}}return x}function av(e,t,n,h){return $t(e,function(p,f,m){t(h,n(p),f,m)}),h}function Ts(e,t,n){t=fi(t,e),e=qh(e,t);var h=e==null?e:e[zt(yt(t))];return h==null?s:it(h,e,n)}function Jc(e){return Ne(e)&&Be(e)==Qt}function cv(e){return Ne(e)&&Be(e)==bs}function hv(e){return Ne(e)&&Be(e)==Yt}function As(e,t,n,h,p){return e===t?!0:e==null||t==null||!Ne(e)&&!Ne(t)?e!==e&&t!==t:uv(e,t,n,h,As,p)}function uv(e,t,n,h,p,f){var m=ie(e),w=ie(t),E=m?Lt:Ke(e),x=w?Lt:Ke(t);E=E==Qt?Zt:E,x=x==Qt?Zt:x;var S=E==Zt,R=x==Zt,F=E==x;if(F&&vi(e)){if(!vi(t))return!1;m=!0,S=!1}if(F&&!S)return f||(f=new Rt),m||ns(e)?xh(e,t,n,h,p,f):Mv(e,t,E,n,h,p,f);if(!(n&M)){var H=S&&me.call(e,"__wrapped__"),J=R&&me.call(t,"__wrapped__");if(H||J){var oe=H?e.value():e,G=J?t.value():t;return f||(f=new Rt),p(oe,G,n,h,f)}}return F?(f||(f=new Rt),Lv(e,t,n,h,p,f)):!1}function lv(e){return Ne(e)&&Ke(e)==tt}function Wn(e,t,n,h){var p=n.length,f=p,m=!h;if(e==null)return!f;for(e=Ee(e);p--;){var w=n[p];if(m&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++p<f;){w=n[p];var E=w[0],x=e[E],S=w[1];if(m&&w[2]){if(x===s&&!(E in e))return!1}else{var R=new Rt;if(h)var F=h(x,S,E,e,t,R);if(!(F===s?As(S,x,M|U,h,R):F))return!1}}return!0}function Gc(e){if(!Oe(e)||Jv(e))return!1;var t=ni(e)?ly:ef;return t.test(Ni(e))}function pv(e){return Ne(e)&&Be(e)==ms}function dv(e){return Ne(e)&&Ke(e)==xt}function gv(e){return Ne(e)&&Lr(e.length)&&!!xe[Be(e)]}function Wc(e){return typeof e=="function"?e:e==null?Ze:typeof e=="object"?ie(e)?Zc(e[0],e[1]):Yc(e):vu(e)}function Qn(e){if(!Ds(e))return vy(e);var t=[];for(var n in Ee(e))me.call(e,n)&&n!="constructor"&&t.push(n);return t}function fv(e){if(!Oe(e))return Yv(e);var t=Ds(e),n=[];for(var h in e)h=="constructor"&&(t||!me.call(e,h))||n.push(h);return n}function Yn(e,t){return e<t}function Qc(e,t){var n=-1,h=Qe(e)?P(e.length):[];return di(e,function(p,f,m){h[++n]=t(p,f,m)}),h}function Yc(e){var t=po(e);return t.length==1&&t[0][2]?Ah(t[0][0],t[0][1]):function(n){return n===e||Wn(n,e,t)}}function Zc(e,t){return fo(e)&&Th(t)?Ah(zt(e),t):function(n){var h=Co(n,e);return h===s&&h===t?xo(n,e):As(t,h,M|U)}}function Er(e,t,n,h,p){e!==t&&Vn(t,function(f,m){if(p||(p=new Rt),Oe(f))yv(e,t,m,n,Er,h,p);else{var w=h?h(vo(e,m),f,m+"",e,t,p):s;w===s&&(w=f),Hn(e,m,w)}},Ye)}function yv(e,t,n,h,p,f,m){var w=vo(e,n),E=vo(t,n),x=m.get(E);if(x){Hn(e,n,x);return}var S=f?f(w,E,n+"",e,t,m):s,R=S===s;if(R){var F=ie(E),H=!F&&vi(E),J=!F&&!H&&ns(E);S=E,F||H||J?ie(w)?S=w:qe(w)?S=We(w):H?(R=!1,S=uh(E,!0)):J?(R=!1,S=lh(E,!0)):S=[]:ks(E)||qi(E)?(S=w,qi(w)?S=au(w):(!Oe(w)||ni(w))&&(S=Oh(E))):R=!1}R&&(m.set(E,S),p(S,E,h,f,m),m.delete(E)),Hn(e,n,S)}function Xc(e,t){var n=e.length;if(n)return t+=t<0?n:0,ri(t,n)?e[t]:s}function eh(e,t,n){t.length?t=Se(t,function(f){return ie(f)?function(m){return Ti(m,f.length===1?f[0]:f)}:f}):t=[Ze];var h=-1;t=Se(t,st(B()));var p=Qc(e,function(f,m,w){var E=Se(t,function(x){return x(f)});return{criteria:E,index:++h,value:f}});return Hf(p,function(f,m){return Ov(f,m,n)})}function vv(e,t){return th(e,t,function(n,h){return xo(e,h)})}function th(e,t,n){for(var h=-1,p=t.length,f={};++h<p;){var m=t[h],w=Ti(e,m);n(w,m)&&Ns(f,fi(m,e),w)}return f}function mv(e){return function(t){return Ti(t,e)}}function Zn(e,t,n,h){var p=h?Uf:Ji,f=-1,m=t.length,w=e;for(e===t&&(t=We(t)),n&&(w=Se(e,st(n)));++f<m;)for(var E=0,x=t[f],S=n?n(x):x;(E=p(w,S,E,h))>-1;)w!==e&&pr.call(w,E,1),pr.call(e,E,1);return e}function ih(e,t){for(var n=e?t.length:0,h=n-1;n--;){var p=t[n];if(n==h||p!==f){var f=p;ri(p)?pr.call(e,p,1):io(e,p)}}return e}function Xn(e,t){return e+fr(kc()*(t-e+1))}function wv(e,t,n,h){for(var p=-1,f=Me(gr((t-e)/(n||1)),0),m=P(f);f--;)m[h?f:++p]=e,e+=n;return m}function eo(e,t){var n="";if(!e||t<1||t>Re)return n;do t%2&&(n+=e),t=fr(t/2),t&&(e+=e);while(t);return n}function ae(e,t){return mo(Nh(e,t,Ze),e+"")}function _v(e){return $c(os(e))}function bv(e,t){var n=os(e);return Nr(n,Oi(t,0,n.length))}function Ns(e,t,n,h){if(!Oe(e))return e;t=fi(t,e);for(var p=-1,f=t.length,m=f-1,w=e;w!=null&&++p<f;){var E=zt(t[p]),x=n;if(E==="__proto__"||E==="constructor"||E==="prototype")return e;if(p!=m){var S=w[E];x=h?h(S,E,w):s,x===s&&(x=Oe(S)?S:ri(t[p+1])?[]:{})}Rs(w,E,x),w=w[E]}return e}var sh=yr?function(e,t){return yr.set(e,t),e}:Ze,Ev=dr?function(e,t){return dr(e,"toString",{configurable:!0,enumerable:!1,value:Ro(t),writable:!0})}:Ze;function Iv(e){return Nr(os(e))}function ft(e,t,n){var h=-1,p=e.length;t<0&&(t=-t>p?0:p+t),n=n>p?p:n,n<0&&(n+=p),p=t>n?0:n-t>>>0,t>>>=0;for(var f=P(p);++h<p;)f[h]=e[h+t];return f}function Pv(e,t){var n;return di(e,function(h,p,f){return n=t(h,p,f),!n}),!!n}function Ir(e,t,n){var h=0,p=e==null?h:e.length;if(typeof t=="number"&&t===t&&p<=Wt){for(;h<p;){var f=h+p>>>1,m=e[f];m!==null&&!nt(m)&&(n?m<=t:m<t)?h=f+1:p=f}return p}return to(e,t,Ze,n)}function to(e,t,n,h){var p=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var m=t!==t,w=t===null,E=nt(t),x=t===s;p<f;){var S=fr((p+f)/2),R=n(e[S]),F=R!==s,H=R===null,J=R===R,oe=nt(R);if(m)var G=h||J;else x?G=J&&(h||F):w?G=J&&F&&(h||!H):E?G=J&&F&&!H&&(h||!oe):H||oe?G=!1:G=h?R<=t:R<t;G?p=S+1:f=S}return He(f,Ys)}function rh(e,t){for(var n=-1,h=e.length,p=0,f=[];++n<h;){var m=e[n],w=t?t(m):m;if(!n||!Ot(w,E)){var E=w;f[p++]=m===0?0:m}}return f}function nh(e){return typeof e=="number"?e:nt(e)?Gt:+e}function rt(e){if(typeof e=="string")return e;if(ie(e))return Se(e,rt)+"";if(nt(e))return Mc?Mc.call(e):"";var t=e+"";return t=="0"&&1/e==-Mt?"-0":t}function gi(e,t,n){var h=-1,p=ir,f=e.length,m=!0,w=[],E=w;if(n)m=!1,p=Tn;else if(f>=a){var x=t?null:Fv(e);if(x)return rr(x);m=!1,p=Es,E=new Ri}else E=t?[]:w;e:for(;++h<f;){var S=e[h],R=t?t(S):S;if(S=n||S!==0?S:0,m&&R===R){for(var F=E.length;F--;)if(E[F]===R)continue e;t&&E.push(R),w.push(S)}else p(E,R,n)||(E!==w&&E.push(R),w.push(S))}return w}function io(e,t){return t=fi(t,e),e=qh(e,t),e==null||delete e[zt(yt(t))]}function oh(e,t,n,h){return Ns(e,t,n(Ti(e,t)),h)}function Pr(e,t,n,h){for(var p=e.length,f=h?p:-1;(h?f--:++f<p)&&t(e[f],f,e););return n?ft(e,h?0:f,h?f+1:p):ft(e,h?f+1:0,h?p:f)}function ah(e,t){var n=e;return n instanceof ue&&(n=n.value()),An(t,function(h,p){return p.func.apply(p.thisArg,ui([h],p.args))},n)}function so(e,t,n){var h=e.length;if(h<2)return h?gi(e[0]):[];for(var p=-1,f=P(h);++p<h;)for(var m=e[p],w=-1;++w<h;)w!=p&&(f[p]=Os(f[p]||m,e[w],t,n));return gi(Ue(f,1),t,n)}function ch(e,t,n){for(var h=-1,p=e.length,f=t.length,m={};++h<p;){var w=h<f?t[h]:s;n(m,e[h],w)}return m}function ro(e){return qe(e)?e:[]}function no(e){return typeof e=="function"?e:Ze}function fi(e,t){return ie(e)?e:fo(e,t)?[e]:Mh(ve(e))}var Cv=ae;function yi(e,t,n){var h=e.length;return n=n===s?h:n,!t&&n>=h?e:ft(e,t,n)}var hh=py||function(e){return ze.clearTimeout(e)};function uh(e,t){if(t)return e.slice();var n=e.length,h=Ac?Ac(n):new e.constructor(n);return e.copy(h),h}function oo(e){var t=new e.constructor(e.byteLength);return new ur(t).set(new ur(e)),t}function xv(e,t){var n=t?oo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Sv(e){var t=new e.constructor(e.source,Ja.exec(e));return t.lastIndex=e.lastIndex,t}function Rv(e){return Ss?Ee(Ss.call(e)):{}}function lh(e,t){var n=t?oo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ph(e,t){if(e!==t){var n=e!==s,h=e===null,p=e===e,f=nt(e),m=t!==s,w=t===null,E=t===t,x=nt(t);if(!w&&!x&&!f&&e>t||f&&m&&E&&!w&&!x||h&&m&&E||!n&&E||!p)return 1;if(!h&&!f&&!x&&e<t||x&&n&&p&&!h&&!f||w&&n&&p||!m&&p||!E)return-1}return 0}function Ov(e,t,n){for(var h=-1,p=e.criteria,f=t.criteria,m=p.length,w=n.length;++h<m;){var E=ph(p[h],f[h]);if(E){if(h>=w)return E;var x=n[h];return E*(x=="desc"?-1:1)}}return e.index-t.index}function dh(e,t,n,h){for(var p=-1,f=e.length,m=n.length,w=-1,E=t.length,x=Me(f-m,0),S=P(E+x),R=!h;++w<E;)S[w]=t[w];for(;++p<m;)(R||p<f)&&(S[n[p]]=e[p]);for(;x--;)S[w++]=e[p++];return S}function gh(e,t,n,h){for(var p=-1,f=e.length,m=-1,w=n.length,E=-1,x=t.length,S=Me(f-w,0),R=P(S+x),F=!h;++p<S;)R[p]=e[p];for(var H=p;++E<x;)R[H+E]=t[E];for(;++m<w;)(F||p<f)&&(R[H+n[m]]=e[p++]);return R}function We(e,t){var n=-1,h=e.length;for(t||(t=P(h));++n<h;)t[n]=e[n];return t}function jt(e,t,n,h){var p=!n;n||(n={});for(var f=-1,m=t.length;++f<m;){var w=t[f],E=h?h(n[w],e[w],w,n,e):s;E===s&&(E=e[w]),p?ti(n,w,E):Rs(n,w,E)}return n}function Tv(e,t){return jt(e,go(e),t)}function Av(e,t){return jt(e,Sh(e),t)}function Cr(e,t){return function(n,h){var p=ie(n)?kf:Xy,f=t?t():{};return p(n,e,B(h,2),f)}}function is(e){return ae(function(t,n){var h=-1,p=n.length,f=p>1?n[p-1]:s,m=p>2?n[2]:s;for(f=e.length>3&&typeof f=="function"?(p--,f):s,m&&Je(n[0],n[1],m)&&(f=p<3?s:f,p=1),t=Ee(t);++h<p;){var w=n[h];w&&e(t,w,h,f)}return t})}function fh(e,t){return function(n,h){if(n==null)return n;if(!Qe(n))return e(n,h);for(var p=n.length,f=t?p:-1,m=Ee(n);(t?f--:++f<p)&&h(m[f],f,m)!==!1;);return n}}function yh(e){return function(t,n,h){for(var p=-1,f=Ee(t),m=h(t),w=m.length;w--;){var E=m[e?w:++p];if(n(f[E],E,f)===!1)break}return t}}function Nv(e,t,n){var h=t&j,p=qs(e);function f(){var m=this&&this!==ze&&this instanceof f?p:e;return m.apply(h?n:this,arguments)}return f}function vh(e){return function(t){t=ve(t);var n=Gi(t)?St(t):s,h=n?n[0]:t.charAt(0),p=n?yi(n,1).join(""):t.slice(1);return h[e]()+p}}function ss(e){return function(t){return An(fu(gu(t).replace(Ef,"")),e,"")}}function qs(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=es(e.prototype),h=e.apply(n,t);return Oe(h)?h:n}}function qv(e,t,n){var h=qs(e);function p(){for(var f=arguments.length,m=P(f),w=f,E=rs(p);w--;)m[w]=arguments[w];var x=f<3&&m[0]!==E&&m[f-1]!==E?[]:li(m,E);if(f-=x.length,f<n)return Eh(e,t,xr,p.placeholder,s,m,x,s,s,n-f);var S=this&&this!==ze&&this instanceof p?h:e;return it(S,this,m)}return p}function mh(e){return function(t,n,h){var p=Ee(t);if(!Qe(t)){var f=B(n,3);t=$e(t),n=function(w){return f(p[w],w,p)}}var m=e(t,n,h);return m>-1?p[f?t[m]:m]:s}}function wh(e){return si(function(t){var n=t.length,h=n,p=dt.prototype.thru;for(e&&t.reverse();h--;){var f=t[h];if(typeof f!="function")throw new pt(l);if(p&&!m&&Tr(f)=="wrapper")var m=new dt([],!0)}for(h=m?h:n;++h<n;){f=t[h];var w=Tr(f),E=w=="wrapper"?lo(f):s;E&&yo(E[0])&&E[1]==(be|pe|Z|de)&&!E[4].length&&E[9]==1?m=m[Tr(E[0])].apply(m,E[3]):m=f.length==1&&yo(f)?m[w]():m.thru(f)}return function(){var x=arguments,S=x[0];if(m&&x.length==1&&ie(S))return m.plant(S).value();for(var R=0,F=n?t[R].apply(this,x):S;++R<n;)F=t[R].call(this,F);return F}})}function xr(e,t,n,h,p,f,m,w,E,x){var S=t&be,R=t&j,F=t&z,H=t&(pe|Q),J=t&Pt,oe=F?s:qs(e);function G(){for(var ce=arguments.length,le=P(ce),ot=ce;ot--;)le[ot]=arguments[ot];if(H)var Ge=rs(G),at=Vf(le,Ge);if(h&&(le=dh(le,h,p,H)),f&&(le=gh(le,f,m,H)),ce-=at,H&&ce<x){var De=li(le,Ge);return Eh(e,t,xr,G.placeholder,n,le,De,w,E,x-ce)}var Tt=R?n:this,ai=F?Tt[e]:e;return ce=le.length,w?le=Xv(le,w):J&&ce>1&&le.reverse(),S&&E<ce&&(le.length=E),this&&this!==ze&&this instanceof G&&(ai=oe||qs(ai)),ai.apply(Tt,le)}return G}function _h(e,t){return function(n,h){return av(n,e,t(h),{})}}function Sr(e,t){return function(n,h){var p;if(n===s&&h===s)return t;if(n!==s&&(p=n),h!==s){if(p===s)return h;typeof n=="string"||typeof h=="string"?(n=rt(n),h=rt(h)):(n=nh(n),h=nh(h)),p=e(n,h)}return p}}function ao(e){return si(function(t){return t=Se(t,st(B())),ae(function(n){var h=this;return e(t,function(p){return it(p,h,n)})})})}function Rr(e,t){t=t===s?" ":rt(t);var n=t.length;if(n<2)return n?eo(t,e):t;var h=eo(t,gr(e/Wi(t)));return Gi(t)?yi(St(h),0,e).join(""):h.slice(0,e)}function Dv(e,t,n,h){var p=t&j,f=qs(e);function m(){for(var w=-1,E=arguments.length,x=-1,S=h.length,R=P(S+E),F=this&&this!==ze&&this instanceof m?f:e;++x<S;)R[x]=h[x];for(;E--;)R[x++]=arguments[++w];return it(F,p?n:this,R)}return m}function bh(e){return function(t,n,h){return h&&typeof h!="number"&&Je(t,n,h)&&(n=h=s),t=oi(t),n===s?(n=t,t=0):n=oi(n),h=h===s?t<n?1:-1:oi(h),wv(t,n,h,e)}}function Or(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=vt(t),n=vt(n)),e(t,n)}}function Eh(e,t,n,h,p,f,m,w,E,x){var S=t&pe,R=S?m:s,F=S?s:m,H=S?f:s,J=S?s:f;t|=S?Z:Ie,t&=~(S?Ie:Z),t&ee||(t&=~(j|z));var oe=[e,t,p,H,R,J,F,w,E,x],G=n.apply(s,oe);return yo(e)&&Dh(G,oe),G.placeholder=h,Fh(G,e,t)}function co(e){var t=ke[e];return function(n,h){if(n=vt(n),h=h==null?0:He(ne(h),292),h&&Fc(n)){var p=(ve(n)+"e").split("e"),f=t(p[0]+"e"+(+p[1]+h));return p=(ve(f)+"e").split("e"),+(p[0]+"e"+(+p[1]-h))}return t(n)}}var Fv=Zi&&1/rr(new Zi([,-0]))[1]==Mt?function(e){return new Zi(e)}:Ao;function Ih(e){return function(t){var n=Ke(t);return n==tt?Ln(t):n==xt?Zf(t):Kf(t,e(t))}}function ii(e,t,n,h,p,f,m,w){var E=t&z;if(!E&&typeof e!="function")throw new pt(l);var x=h?h.length:0;if(x||(t&=~(Z|Ie),h=p=s),m=m===s?m:Me(ne(m),0),w=w===s?w:ne(w),x-=p?p.length:0,t&Ie){var S=h,R=p;h=p=s}var F=E?s:lo(e),H=[e,t,n,h,p,S,R,f,m,w];if(F&&Qv(H,F),e=H[0],t=H[1],n=H[2],h=H[3],p=H[4],w=H[9]=H[9]===s?E?0:e.length:Me(H[9]-x,0),!w&&t&(pe|Q)&&(t&=~(pe|Q)),!t||t==j)var J=Nv(e,t,n);else t==pe||t==Q?J=qv(e,t,w):(t==Z||t==(j|Z))&&!p.length?J=Dv(e,t,n,h):J=xr.apply(s,H);var oe=F?sh:Dh;return Fh(oe(J,H),e,t)}function Ph(e,t,n,h){return e===s||Ot(e,Yi[n])&&!me.call(h,n)?t:e}function Ch(e,t,n,h,p,f){return Oe(e)&&Oe(t)&&(f.set(t,e),Er(e,t,s,Ch,f),f.delete(t)),e}function kv(e){return ks(e)?s:e}function xh(e,t,n,h,p,f){var m=n&M,w=e.length,E=t.length;if(w!=E&&!(m&&E>w))return!1;var x=f.get(e),S=f.get(t);if(x&&S)return x==t&&S==e;var R=-1,F=!0,H=n&U?new Ri:s;for(f.set(e,t),f.set(t,e);++R<w;){var J=e[R],oe=t[R];if(h)var G=m?h(oe,J,R,t,e,f):h(J,oe,R,e,t,f);if(G!==s){if(G)continue;F=!1;break}if(H){if(!Nn(t,function(ce,le){if(!Es(H,le)&&(J===ce||p(J,ce,n,h,f)))return H.push(le)})){F=!1;break}}else if(!(J===oe||p(J,oe,n,h,f))){F=!1;break}}return f.delete(e),f.delete(t),F}function Mv(e,t,n,h,p,f,m){switch(n){case Vi:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case bs:return!(e.byteLength!=t.byteLength||!f(new ur(e),new ur(t)));case Ct:case Yt:case vs:return Ot(+e,+t);case Pi:return e.name==t.name&&e.message==t.message;case ms:case ws:return e==t+"";case tt:var w=Ln;case xt:var E=h&M;if(w||(w=rr),e.size!=t.size&&!E)return!1;var x=m.get(e);if(x)return x==t;h|=U,m.set(e,t);var S=xh(w(e),w(t),h,p,f,m);return m.delete(e),S;case Zs:if(Ss)return Ss.call(e)==Ss.call(t)}return!1}function Lv(e,t,n,h,p,f){var m=n&M,w=ho(e),E=w.length,x=ho(t),S=x.length;if(E!=S&&!m)return!1;for(var R=E;R--;){var F=w[R];if(!(m?F in t:me.call(t,F)))return!1}var H=f.get(e),J=f.get(t);if(H&&J)return H==t&&J==e;var oe=!0;f.set(e,t),f.set(t,e);for(var G=m;++R<E;){F=w[R];var ce=e[F],le=t[F];if(h)var ot=m?h(le,ce,F,t,e,f):h(ce,le,F,e,t,f);if(!(ot===s?ce===le||p(ce,le,n,h,f):ot)){oe=!1;break}G||(G=F=="constructor")}if(oe&&!G){var Ge=e.constructor,at=t.constructor;Ge!=at&&"constructor"in e&&"constructor"in t&&!(typeof Ge=="function"&&Ge instanceof Ge&&typeof at=="function"&&at instanceof at)&&(oe=!1)}return f.delete(e),f.delete(t),oe}function si(e){return mo(Nh(e,s,zh),e+"")}function ho(e){return Bc(e,$e,go)}function uo(e){return Bc(e,Ye,Sh)}var lo=yr?function(e){return yr.get(e)}:Ao;function Tr(e){for(var t=e.name+"",n=Xi[t],h=me.call(Xi,t)?n.length:0;h--;){var p=n[h],f=p.func;if(f==null||f==e)return p.name}return t}function rs(e){var t=me.call(g,"placeholder")?g:e;return t.placeholder}function B(){var e=g.iteratee||Oo;return e=e===Oo?Wc:e,arguments.length?e(arguments[0],arguments[1]):e}function Ar(e,t){var n=e.__data__;return Bv(t)?n[typeof t=="string"?"string":"hash"]:n.map}function po(e){for(var t=$e(e),n=t.length;n--;){var h=t[n],p=e[h];t[n]=[h,p,Th(p)]}return t}function Ai(e,t){var n=Wf(e,t);return Gc(n)?n:s}function $v(e){var t=me.call(e,xi),n=e[xi];try{e[xi]=s;var h=!0}catch{}var p=cr.call(e);return h&&(t?e[xi]=n:delete e[xi]),p}var go=jn?function(e){return e==null?[]:(e=Ee(e),hi(jn(e),function(t){return qc.call(e,t)}))}:No,Sh=jn?function(e){for(var t=[];e;)ui(t,go(e)),e=lr(e);return t}:No,Ke=Be;(zn&&Ke(new zn(new ArrayBuffer(1)))!=Vi||Ps&&Ke(new Ps)!=tt||Un&&Ke(Un.resolve())!=Ha||Zi&&Ke(new Zi)!=xt||Cs&&Ke(new Cs)!=_s)&&(Ke=function(e){var t=Be(e),n=t==Zt?e.constructor:s,h=n?Ni(n):"";if(h)switch(h){case by:return Vi;case Ey:return tt;case Iy:return Ha;case Py:return xt;case Cy:return _s}return t});function jv(e,t,n){for(var h=-1,p=n.length;++h<p;){var f=n[h],m=f.size;switch(f.type){case"drop":e+=m;break;case"dropRight":t-=m;break;case"take":t=He(t,e+m);break;case"takeRight":e=Me(e,t-m);break}}return{start:e,end:t}}function zv(e){var t=e.match(Bg);return t?t[1].split(Jg):[]}function Rh(e,t,n){t=fi(t,e);for(var h=-1,p=t.length,f=!1;++h<p;){var m=zt(t[h]);if(!(f=e!=null&&n(e,m)))break;e=e[m]}return f||++h!=p?f:(p=e==null?0:e.length,!!p&&Lr(p)&&ri(m,p)&&(ie(e)||qi(e)))}function Uv(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&me.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Oh(e){return typeof e.constructor=="function"&&!Ds(e)?es(lr(e)):{}}function Hv(e,t,n){var h=e.constructor;switch(t){case bs:return oo(e);case Ct:case Yt:return new h(+e);case Vi:return xv(e,n);case pn:case dn:case gn:case fn:case yn:case vn:case mn:case wn:case _n:return lh(e,n);case tt:return new h;case vs:case ws:return new h(e);case ms:return Sv(e);case xt:return new h;case Zs:return Rv(e)}}function Kv(e,t){var n=t.length;if(!n)return e;var h=n-1;return t[h]=(n>1?"& ":"")+t[h],t=t.join(n>2?", ":" "),e.replace(Vg,`{
/* [wrapped with `+t+`] */
`)}function Vv(e){return ie(e)||qi(e)||!!(Dc&&e&&e[Dc])}function ri(e,t){var n=typeof e;return t=t??Re,!!t&&(n=="number"||n!="symbol"&&sf.test(e))&&e>-1&&e%1==0&&e<t}function Je(e,t,n){if(!Oe(n))return!1;var h=typeof t;return(h=="number"?Qe(n)&&ri(t,n.length):h=="string"&&t in n)?Ot(n[t],e):!1}function fo(e,t){if(ie(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||nt(e)?!0:zg.test(e)||!jg.test(e)||t!=null&&e in Ee(t)}function Bv(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function yo(e){var t=Tr(e),n=g[t];if(typeof n!="function"||!(t in ue.prototype))return!1;if(e===n)return!0;var h=lo(n);return!!h&&e===h[0]}function Jv(e){return!!Tc&&Tc in e}var Gv=or?ni:qo;function Ds(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Yi;return e===n}function Th(e){return e===e&&!Oe(e)}function Ah(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==s||e in Ee(n))}}function Wv(e){var t=kr(e,function(h){return n.size===I&&n.clear(),h}),n=t.cache;return t}function Qv(e,t){var n=e[1],h=t[1],p=n|h,f=p<(j|z|be),m=h==be&&n==pe||h==be&&n==de&&e[7].length<=t[8]||h==(be|de)&&t[7].length<=t[8]&&n==pe;if(!(f||m))return e;h&j&&(e[2]=t[2],p|=n&j?0:ee);var w=t[3];if(w){var E=e[3];e[3]=E?dh(E,w,t[4]):w,e[4]=E?li(e[3],O):t[4]}return w=t[5],w&&(E=e[5],e[5]=E?gh(E,w,t[6]):w,e[6]=E?li(e[5],O):t[6]),w=t[7],w&&(e[7]=w),h&be&&(e[8]=e[8]==null?t[8]:He(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=p,e}function Yv(e){var t=[];if(e!=null)for(var n in Ee(e))t.push(n);return t}function Zv(e){return cr.call(e)}function Nh(e,t,n){return t=Me(t===s?e.length-1:t,0),function(){for(var h=arguments,p=-1,f=Me(h.length-t,0),m=P(f);++p<f;)m[p]=h[t+p];p=-1;for(var w=P(t+1);++p<t;)w[p]=h[p];return w[t]=n(m),it(e,this,w)}}function qh(e,t){return t.length<2?e:Ti(e,ft(t,0,-1))}function Xv(e,t){for(var n=e.length,h=He(t.length,n),p=We(e);h--;){var f=t[h];e[h]=ri(f,n)?p[f]:s}return e}function vo(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Dh=kh(sh),Fs=gy||function(e,t){return ze.setTimeout(e,t)},mo=kh(Ev);function Fh(e,t,n){var h=t+"";return mo(e,Kv(h,em(zv(h),n)))}function kh(e){var t=0,n=0;return function(){var h=my(),p=ji-(h-n);if(n=h,p>0){if(++t>=gs)return arguments[0]}else t=0;return e.apply(s,arguments)}}function Nr(e,t){var n=-1,h=e.length,p=h-1;for(t=t===s?h:t;++n<t;){var f=Xn(n,p),m=e[f];e[f]=e[n],e[n]=m}return e.length=t,e}var Mh=Wv(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Ug,function(n,h,p,f){t.push(p?f.replace(Qg,"$1"):h||n)}),t});function zt(e){if(typeof e=="string"||nt(e))return e;var t=e+"";return t=="0"&&1/e==-Mt?"-0":t}function Ni(e){if(e!=null){try{return ar.call(e)}catch{}try{return e+""}catch{}}return""}function em(e,t){return lt(fs,function(n){var h="_."+n[0];t&n[1]&&!ir(e,h)&&e.push(h)}),e.sort()}function Lh(e){if(e instanceof ue)return e.clone();var t=new dt(e.__wrapped__,e.__chain__);return t.__actions__=We(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function tm(e,t,n){(n?Je(e,t,n):t===s)?t=1:t=Me(ne(t),0);var h=e==null?0:e.length;if(!h||t<1)return[];for(var p=0,f=0,m=P(gr(h/t));p<h;)m[f++]=ft(e,p,p+=t);return m}function im(e){for(var t=-1,n=e==null?0:e.length,h=0,p=[];++t<n;){var f=e[t];f&&(p[h++]=f)}return p}function sm(){var e=arguments.length;if(!e)return[];for(var t=P(e-1),n=arguments[0],h=e;h--;)t[h-1]=arguments[h];return ui(ie(n)?We(n):[n],Ue(t,1))}var rm=ae(function(e,t){return qe(e)?Os(e,Ue(t,1,qe,!0)):[]}),nm=ae(function(e,t){var n=yt(t);return qe(n)&&(n=s),qe(e)?Os(e,Ue(t,1,qe,!0),B(n,2)):[]}),om=ae(function(e,t){var n=yt(t);return qe(n)&&(n=s),qe(e)?Os(e,Ue(t,1,qe,!0),s,n):[]});function am(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===s?1:ne(t),ft(e,t<0?0:t,h)):[]}function cm(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===s?1:ne(t),t=h-t,ft(e,0,t<0?0:t)):[]}function hm(e,t){return e&&e.length?Pr(e,B(t,3),!0,!0):[]}function um(e,t){return e&&e.length?Pr(e,B(t,3),!0):[]}function lm(e,t,n,h){var p=e==null?0:e.length;return p?(n&&typeof n!="number"&&Je(e,t,n)&&(n=0,h=p),sv(e,t,n,h)):[]}function $h(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var p=n==null?0:ne(n);return p<0&&(p=Me(h+p,0)),sr(e,B(t,3),p)}function jh(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var p=h-1;return n!==s&&(p=ne(n),p=n<0?Me(h+p,0):He(p,h-1)),sr(e,B(t,3),p,!0)}function zh(e){var t=e==null?0:e.length;return t?Ue(e,1):[]}function pm(e){var t=e==null?0:e.length;return t?Ue(e,Mt):[]}function dm(e,t){var n=e==null?0:e.length;return n?(t=t===s?1:ne(t),Ue(e,t)):[]}function gm(e){for(var t=-1,n=e==null?0:e.length,h={};++t<n;){var p=e[t];h[p[0]]=p[1]}return h}function Uh(e){return e&&e.length?e[0]:s}function fm(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var p=n==null?0:ne(n);return p<0&&(p=Me(h+p,0)),Ji(e,t,p)}function ym(e){var t=e==null?0:e.length;return t?ft(e,0,-1):[]}var vm=ae(function(e){var t=Se(e,ro);return t.length&&t[0]===e[0]?Gn(t):[]}),mm=ae(function(e){var t=yt(e),n=Se(e,ro);return t===yt(n)?t=s:n.pop(),n.length&&n[0]===e[0]?Gn(n,B(t,2)):[]}),wm=ae(function(e){var t=yt(e),n=Se(e,ro);return t=typeof t=="function"?t:s,t&&n.pop(),n.length&&n[0]===e[0]?Gn(n,s,t):[]});function _m(e,t){return e==null?"":yy.call(e,t)}function yt(e){var t=e==null?0:e.length;return t?e[t-1]:s}function bm(e,t,n){var h=e==null?0:e.length;if(!h)return-1;var p=h;return n!==s&&(p=ne(n),p=p<0?Me(h+p,0):He(p,h-1)),t===t?ey(e,t,p):sr(e,Ec,p,!0)}function Em(e,t){return e&&e.length?Xc(e,ne(t)):s}var Im=ae(Hh);function Hh(e,t){return e&&e.length&&t&&t.length?Zn(e,t):e}function Pm(e,t,n){return e&&e.length&&t&&t.length?Zn(e,t,B(n,2)):e}function Cm(e,t,n){return e&&e.length&&t&&t.length?Zn(e,t,s,n):e}var xm=si(function(e,t){var n=e==null?0:e.length,h=Kn(e,t);return ih(e,Se(t,function(p){return ri(p,n)?+p:p}).sort(ph)),h});function Sm(e,t){var n=[];if(!(e&&e.length))return n;var h=-1,p=[],f=e.length;for(t=B(t,3);++h<f;){var m=e[h];t(m,h,e)&&(n.push(m),p.push(h))}return ih(e,p),n}function wo(e){return e==null?e:_y.call(e)}function Rm(e,t,n){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Je(e,t,n)?(t=0,n=h):(t=t==null?0:ne(t),n=n===s?h:ne(n)),ft(e,t,n)):[]}function Om(e,t){return Ir(e,t)}function Tm(e,t,n){return to(e,t,B(n,2))}function Am(e,t){var n=e==null?0:e.length;if(n){var h=Ir(e,t);if(h<n&&Ot(e[h],t))return h}return-1}function Nm(e,t){return Ir(e,t,!0)}function qm(e,t,n){return to(e,t,B(n,2),!0)}function Dm(e,t){var n=e==null?0:e.length;if(n){var h=Ir(e,t,!0)-1;if(Ot(e[h],t))return h}return-1}function Fm(e){return e&&e.length?rh(e):[]}function km(e,t){return e&&e.length?rh(e,B(t,2)):[]}function Mm(e){var t=e==null?0:e.length;return t?ft(e,1,t):[]}function Lm(e,t,n){return e&&e.length?(t=n||t===s?1:ne(t),ft(e,0,t<0?0:t)):[]}function $m(e,t,n){var h=e==null?0:e.length;return h?(t=n||t===s?1:ne(t),t=h-t,ft(e,t<0?0:t,h)):[]}function jm(e,t){return e&&e.length?Pr(e,B(t,3),!1,!0):[]}function zm(e,t){return e&&e.length?Pr(e,B(t,3)):[]}var Um=ae(function(e){return gi(Ue(e,1,qe,!0))}),Hm=ae(function(e){var t=yt(e);return qe(t)&&(t=s),gi(Ue(e,1,qe,!0),B(t,2))}),Km=ae(function(e){var t=yt(e);return t=typeof t=="function"?t:s,gi(Ue(e,1,qe,!0),s,t)});function Vm(e){return e&&e.length?gi(e):[]}function Bm(e,t){return e&&e.length?gi(e,B(t,2)):[]}function Jm(e,t){return t=typeof t=="function"?t:s,e&&e.length?gi(e,s,t):[]}function _o(e){if(!(e&&e.length))return[];var t=0;return e=hi(e,function(n){if(qe(n))return t=Me(n.length,t),!0}),kn(t,function(n){return Se(e,qn(n))})}function Kh(e,t){if(!(e&&e.length))return[];var n=_o(e);return t==null?n:Se(n,function(h){return it(t,s,h)})}var Gm=ae(function(e,t){return qe(e)?Os(e,t):[]}),Wm=ae(function(e){return so(hi(e,qe))}),Qm=ae(function(e){var t=yt(e);return qe(t)&&(t=s),so(hi(e,qe),B(t,2))}),Ym=ae(function(e){var t=yt(e);return t=typeof t=="function"?t:s,so(hi(e,qe),s,t)}),Zm=ae(_o);function Xm(e,t){return ch(e||[],t||[],Rs)}function e0(e,t){return ch(e||[],t||[],Ns)}var t0=ae(function(e){var t=e.length,n=t>1?e[t-1]:s;return n=typeof n=="function"?(e.pop(),n):s,Kh(e,n)});function Vh(e){var t=g(e);return t.__chain__=!0,t}function i0(e,t){return t(e),e}function qr(e,t){return t(e)}var s0=si(function(e){var t=e.length,n=t?e[0]:0,h=this.__wrapped__,p=function(f){return Kn(f,e)};return t>1||this.__actions__.length||!(h instanceof ue)||!ri(n)?this.thru(p):(h=h.slice(n,+n+(t?1:0)),h.__actions__.push({func:qr,args:[p],thisArg:s}),new dt(h,this.__chain__).thru(function(f){return t&&!f.length&&f.push(s),f}))});function r0(){return Vh(this)}function n0(){return new dt(this.value(),this.__chain__)}function o0(){this.__values__===s&&(this.__values__=nu(this.value()));var e=this.__index__>=this.__values__.length,t=e?s:this.__values__[this.__index__++];return{done:e,value:t}}function a0(){return this}function c0(e){for(var t,n=this;n instanceof mr;){var h=Lh(n);h.__index__=0,h.__values__=s,t?p.__wrapped__=h:t=h;var p=h;n=n.__wrapped__}return p.__wrapped__=e,t}function h0(){var e=this.__wrapped__;if(e instanceof ue){var t=e;return this.__actions__.length&&(t=new ue(this)),t=t.reverse(),t.__actions__.push({func:qr,args:[wo],thisArg:s}),new dt(t,this.__chain__)}return this.thru(wo)}function u0(){return ah(this.__wrapped__,this.__actions__)}var l0=Cr(function(e,t,n){me.call(e,n)?++e[n]:ti(e,n,1)});function p0(e,t,n){var h=ie(e)?_c:iv;return n&&Je(e,t,n)&&(t=s),h(e,B(t,3))}function d0(e,t){var n=ie(e)?hi:Kc;return n(e,B(t,3))}var g0=mh($h),f0=mh(jh);function y0(e,t){return Ue(Dr(e,t),1)}function v0(e,t){return Ue(Dr(e,t),Mt)}function m0(e,t,n){return n=n===s?1:ne(n),Ue(Dr(e,t),n)}function Bh(e,t){var n=ie(e)?lt:di;return n(e,B(t,3))}function Jh(e,t){var n=ie(e)?Mf:Hc;return n(e,B(t,3))}var w0=Cr(function(e,t,n){me.call(e,n)?e[n].push(t):ti(e,n,[t])});function _0(e,t,n,h){e=Qe(e)?e:os(e),n=n&&!h?ne(n):0;var p=e.length;return n<0&&(n=Me(p+n,0)),$r(e)?n<=p&&e.indexOf(t,n)>-1:!!p&&Ji(e,t,n)>-1}var b0=ae(function(e,t,n){var h=-1,p=typeof t=="function",f=Qe(e)?P(e.length):[];return di(e,function(m){f[++h]=p?it(t,m,n):Ts(m,t,n)}),f}),E0=Cr(function(e,t,n){ti(e,n,t)});function Dr(e,t){var n=ie(e)?Se:Qc;return n(e,B(t,3))}function I0(e,t,n,h){return e==null?[]:(ie(t)||(t=t==null?[]:[t]),n=h?s:n,ie(n)||(n=n==null?[]:[n]),eh(e,t,n))}var P0=Cr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function C0(e,t,n){var h=ie(e)?An:Pc,p=arguments.length<3;return h(e,B(t,4),n,p,di)}function x0(e,t,n){var h=ie(e)?Lf:Pc,p=arguments.length<3;return h(e,B(t,4),n,p,Hc)}function S0(e,t){var n=ie(e)?hi:Kc;return n(e,Mr(B(t,3)))}function R0(e){var t=ie(e)?$c:_v;return t(e)}function O0(e,t,n){(n?Je(e,t,n):t===s)?t=1:t=ne(t);var h=ie(e)?Yy:bv;return h(e,t)}function T0(e){var t=ie(e)?Zy:Iv;return t(e)}function A0(e){if(e==null)return 0;if(Qe(e))return $r(e)?Wi(e):e.length;var t=Ke(e);return t==tt||t==xt?e.size:Qn(e).length}function N0(e,t,n){var h=ie(e)?Nn:Pv;return n&&Je(e,t,n)&&(t=s),h(e,B(t,3))}var q0=ae(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Je(e,t[0],t[1])?t=[]:n>2&&Je(t[0],t[1],t[2])&&(t=[t[0]]),eh(e,Ue(t,1),[])}),Fr=dy||function(){return ze.Date.now()};function D0(e,t){if(typeof t!="function")throw new pt(l);return e=ne(e),function(){if(--e<1)return t.apply(this,arguments)}}function Gh(e,t,n){return t=n?s:t,t=e&&t==null?e.length:t,ii(e,be,s,s,s,s,t)}function Wh(e,t){var n;if(typeof t!="function")throw new pt(l);return e=ne(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=s),n}}var bo=ae(function(e,t,n){var h=j;if(n.length){var p=li(n,rs(bo));h|=Z}return ii(e,h,t,n,p)}),Qh=ae(function(e,t,n){var h=j|z;if(n.length){var p=li(n,rs(Qh));h|=Z}return ii(t,h,e,n,p)});function Yh(e,t,n){t=n?s:t;var h=ii(e,pe,s,s,s,s,s,t);return h.placeholder=Yh.placeholder,h}function Zh(e,t,n){t=n?s:t;var h=ii(e,Q,s,s,s,s,s,t);return h.placeholder=Zh.placeholder,h}function Xh(e,t,n){var h,p,f,m,w,E,x=0,S=!1,R=!1,F=!0;if(typeof e!="function")throw new pt(l);t=vt(t)||0,Oe(n)&&(S=!!n.leading,R="maxWait"in n,f=R?Me(vt(n.maxWait)||0,t):f,F="trailing"in n?!!n.trailing:F);function H(De){var Tt=h,ai=p;return h=p=s,x=De,m=e.apply(ai,Tt),m}function J(De){return x=De,w=Fs(ce,t),S?H(De):m}function oe(De){var Tt=De-E,ai=De-x,mu=t-Tt;return R?He(mu,f-ai):mu}function G(De){var Tt=De-E,ai=De-x;return E===s||Tt>=t||Tt<0||R&&ai>=f}function ce(){var De=Fr();if(G(De))return le(De);w=Fs(ce,oe(De))}function le(De){return w=s,F&&h?H(De):(h=p=s,m)}function ot(){w!==s&&hh(w),x=0,h=E=p=w=s}function Ge(){return w===s?m:le(Fr())}function at(){var De=Fr(),Tt=G(De);if(h=arguments,p=this,E=De,Tt){if(w===s)return J(E);if(R)return hh(w),w=Fs(ce,t),H(E)}return w===s&&(w=Fs(ce,t)),m}return at.cancel=ot,at.flush=Ge,at}var F0=ae(function(e,t){return Uc(e,1,t)}),k0=ae(function(e,t,n){return Uc(e,vt(t)||0,n)});function M0(e){return ii(e,Pt)}function kr(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new pt(l);var n=function(){var h=arguments,p=t?t.apply(this,h):h[0],f=n.cache;if(f.has(p))return f.get(p);var m=e.apply(this,h);return n.cache=f.set(p,m)||f,m};return n.cache=new(kr.Cache||ei),n}kr.Cache=ei;function Mr(e){if(typeof e!="function")throw new pt(l);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function L0(e){return Wh(2,e)}var $0=Cv(function(e,t){t=t.length==1&&ie(t[0])?Se(t[0],st(B())):Se(Ue(t,1),st(B()));var n=t.length;return ae(function(h){for(var p=-1,f=He(h.length,n);++p<f;)h[p]=t[p].call(this,h[p]);return it(e,this,h)})}),Eo=ae(function(e,t){var n=li(t,rs(Eo));return ii(e,Z,s,t,n)}),eu=ae(function(e,t){var n=li(t,rs(eu));return ii(e,Ie,s,t,n)}),j0=si(function(e,t){return ii(e,de,s,s,s,t)});function z0(e,t){if(typeof e!="function")throw new pt(l);return t=t===s?t:ne(t),ae(e,t)}function U0(e,t){if(typeof e!="function")throw new pt(l);return t=t==null?0:Me(ne(t),0),ae(function(n){var h=n[t],p=yi(n,0,t);return h&&ui(p,h),it(e,this,p)})}function H0(e,t,n){var h=!0,p=!0;if(typeof e!="function")throw new pt(l);return Oe(n)&&(h="leading"in n?!!n.leading:h,p="trailing"in n?!!n.trailing:p),Xh(e,t,{leading:h,maxWait:t,trailing:p})}function K0(e){return Gh(e,1)}function V0(e,t){return Eo(no(t),e)}function B0(){if(!arguments.length)return[];var e=arguments[0];return ie(e)?e:[e]}function J0(e){return gt(e,A)}function G0(e,t){return t=typeof t=="function"?t:s,gt(e,A,t)}function W0(e){return gt(e,T|A)}function Q0(e,t){return t=typeof t=="function"?t:s,gt(e,T|A,t)}function Y0(e,t){return t==null||zc(e,t,$e(t))}function Ot(e,t){return e===t||e!==e&&t!==t}var Z0=Or(Jn),X0=Or(function(e,t){return e>=t}),qi=Jc(function(){return arguments}())?Jc:function(e){return Ne(e)&&me.call(e,"callee")&&!qc.call(e,"callee")},ie=P.isArray,ew=gc?st(gc):cv;function Qe(e){return e!=null&&Lr(e.length)&&!ni(e)}function qe(e){return Ne(e)&&Qe(e)}function tw(e){return e===!0||e===!1||Ne(e)&&Be(e)==Ct}var vi=fy||qo,iw=fc?st(fc):hv;function sw(e){return Ne(e)&&e.nodeType===1&&!ks(e)}function rw(e){if(e==null)return!0;if(Qe(e)&&(ie(e)||typeof e=="string"||typeof e.splice=="function"||vi(e)||ns(e)||qi(e)))return!e.length;var t=Ke(e);if(t==tt||t==xt)return!e.size;if(Ds(e))return!Qn(e).length;for(var n in e)if(me.call(e,n))return!1;return!0}function nw(e,t){return As(e,t)}function ow(e,t,n){n=typeof n=="function"?n:s;var h=n?n(e,t):s;return h===s?As(e,t,s,n):!!h}function Io(e){if(!Ne(e))return!1;var t=Be(e);return t==Pi||t==ys||typeof e.message=="string"&&typeof e.name=="string"&&!ks(e)}function aw(e){return typeof e=="number"&&Fc(e)}function ni(e){if(!Oe(e))return!1;var t=Be(e);return t==Hi||t==Ki||t==Ui||t==Tg}function tu(e){return typeof e=="number"&&e==ne(e)}function Lr(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Re}function Oe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ne(e){return e!=null&&typeof e=="object"}var iu=yc?st(yc):lv;function cw(e,t){return e===t||Wn(e,t,po(t))}function hw(e,t,n){return n=typeof n=="function"?n:s,Wn(e,t,po(t),n)}function uw(e){return su(e)&&e!=+e}function lw(e){if(Gv(e))throw new te(u);return Gc(e)}function pw(e){return e===null}function dw(e){return e==null}function su(e){return typeof e=="number"||Ne(e)&&Be(e)==vs}function ks(e){if(!Ne(e)||Be(e)!=Zt)return!1;var t=lr(e);if(t===null)return!0;var n=me.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&ar.call(n)==hy}var Po=vc?st(vc):pv;function gw(e){return tu(e)&&e>=-Re&&e<=Re}var ru=mc?st(mc):dv;function $r(e){return typeof e=="string"||!ie(e)&&Ne(e)&&Be(e)==ws}function nt(e){return typeof e=="symbol"||Ne(e)&&Be(e)==Zs}var ns=wc?st(wc):gv;function fw(e){return e===s}function yw(e){return Ne(e)&&Ke(e)==_s}function vw(e){return Ne(e)&&Be(e)==Ng}var mw=Or(Yn),ww=Or(function(e,t){return e<=t});function nu(e){if(!e)return[];if(Qe(e))return $r(e)?St(e):We(e);if(Is&&e[Is])return Yf(e[Is]());var t=Ke(e),n=t==tt?Ln:t==xt?rr:os;return n(e)}function oi(e){if(!e)return e===0?e:0;if(e=vt(e),e===Mt||e===-Mt){var t=e<0?-1:1;return t*Fe}return e===e?e:0}function ne(e){var t=oi(e),n=t%1;return t===t?n?t-n:t:0}function ou(e){return e?Oi(ne(e),0,et):0}function vt(e){if(typeof e=="number")return e;if(nt(e))return Gt;if(Oe(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Oe(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Cc(e);var n=Xg.test(e);return n||tf.test(e)?Df(e.slice(2),n?2:8):Zg.test(e)?Gt:+e}function au(e){return jt(e,Ye(e))}function _w(e){return e?Oi(ne(e),-Re,Re):e===0?e:0}function ve(e){return e==null?"":rt(e)}var bw=is(function(e,t){if(Ds(t)||Qe(t)){jt(t,$e(t),e);return}for(var n in t)me.call(t,n)&&Rs(e,n,t[n])}),cu=is(function(e,t){jt(t,Ye(t),e)}),jr=is(function(e,t,n,h){jt(t,Ye(t),e,h)}),Ew=is(function(e,t,n,h){jt(t,$e(t),e,h)}),Iw=si(Kn);function Pw(e,t){var n=es(e);return t==null?n:jc(n,t)}var Cw=ae(function(e,t){e=Ee(e);var n=-1,h=t.length,p=h>2?t[2]:s;for(p&&Je(t[0],t[1],p)&&(h=1);++n<h;)for(var f=t[n],m=Ye(f),w=-1,E=m.length;++w<E;){var x=m[w],S=e[x];(S===s||Ot(S,Yi[x])&&!me.call(e,x))&&(e[x]=f[x])}return e}),xw=ae(function(e){return e.push(s,Ch),it(hu,s,e)});function Sw(e,t){return bc(e,B(t,3),$t)}function Rw(e,t){return bc(e,B(t,3),Bn)}function Ow(e,t){return e==null?e:Vn(e,B(t,3),Ye)}function Tw(e,t){return e==null?e:Vc(e,B(t,3),Ye)}function Aw(e,t){return e&&$t(e,B(t,3))}function Nw(e,t){return e&&Bn(e,B(t,3))}function qw(e){return e==null?[]:br(e,$e(e))}function Dw(e){return e==null?[]:br(e,Ye(e))}function Co(e,t,n){var h=e==null?s:Ti(e,t);return h===s?n:h}function Fw(e,t){return e!=null&&Rh(e,t,rv)}function xo(e,t){return e!=null&&Rh(e,t,nv)}var kw=_h(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=cr.call(t)),e[t]=n},Ro(Ze)),Mw=_h(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=cr.call(t)),me.call(e,t)?e[t].push(n):e[t]=[n]},B),Lw=ae(Ts);function $e(e){return Qe(e)?Lc(e):Qn(e)}function Ye(e){return Qe(e)?Lc(e,!0):fv(e)}function $w(e,t){var n={};return t=B(t,3),$t(e,function(h,p,f){ti(n,t(h,p,f),h)}),n}function jw(e,t){var n={};return t=B(t,3),$t(e,function(h,p,f){ti(n,p,t(h,p,f))}),n}var zw=is(function(e,t,n){Er(e,t,n)}),hu=is(function(e,t,n,h){Er(e,t,n,h)}),Uw=si(function(e,t){var n={};if(e==null)return n;var h=!1;t=Se(t,function(f){return f=fi(f,e),h||(h=f.length>1),f}),jt(e,uo(e),n),h&&(n=gt(n,T|D|A,kv));for(var p=t.length;p--;)io(n,t[p]);return n});function Hw(e,t){return uu(e,Mr(B(t)))}var Kw=si(function(e,t){return e==null?{}:vv(e,t)});function uu(e,t){if(e==null)return{};var n=Se(uo(e),function(h){return[h]});return t=B(t),th(e,n,function(h,p){return t(h,p[0])})}function Vw(e,t,n){t=fi(t,e);var h=-1,p=t.length;for(p||(p=1,e=s);++h<p;){var f=e==null?s:e[zt(t[h])];f===s&&(h=p,f=n),e=ni(f)?f.call(e):f}return e}function Bw(e,t,n){return e==null?e:Ns(e,t,n)}function Jw(e,t,n,h){return h=typeof h=="function"?h:s,e==null?e:Ns(e,t,n,h)}var lu=Ih($e),pu=Ih(Ye);function Gw(e,t,n){var h=ie(e),p=h||vi(e)||ns(e);if(t=B(t,4),n==null){var f=e&&e.constructor;p?n=h?new f:[]:Oe(e)?n=ni(f)?es(lr(e)):{}:n={}}return(p?lt:$t)(e,function(m,w,E){return t(n,m,w,E)}),n}function Ww(e,t){return e==null?!0:io(e,t)}function Qw(e,t,n){return e==null?e:oh(e,t,no(n))}function Yw(e,t,n,h){return h=typeof h=="function"?h:s,e==null?e:oh(e,t,no(n),h)}function os(e){return e==null?[]:Mn(e,$e(e))}function Zw(e){return e==null?[]:Mn(e,Ye(e))}function Xw(e,t,n){return n===s&&(n=t,t=s),n!==s&&(n=vt(n),n=n===n?n:0),t!==s&&(t=vt(t),t=t===t?t:0),Oi(vt(e),t,n)}function e_(e,t,n){return t=oi(t),n===s?(n=t,t=0):n=oi(n),e=vt(e),ov(e,t,n)}function t_(e,t,n){if(n&&typeof n!="boolean"&&Je(e,t,n)&&(t=n=s),n===s&&(typeof t=="boolean"?(n=t,t=s):typeof e=="boolean"&&(n=e,e=s)),e===s&&t===s?(e=0,t=1):(e=oi(e),t===s?(t=e,e=0):t=oi(t)),e>t){var h=e;e=t,t=h}if(n||e%1||t%1){var p=kc();return He(e+p*(t-e+qf("1e-"+((p+"").length-1))),t)}return Xn(e,t)}var i_=ss(function(e,t,n){return t=t.toLowerCase(),e+(n?du(t):t)});function du(e){return So(ve(e).toLowerCase())}function gu(e){return e=ve(e),e&&e.replace(rf,Bf).replace(If,"")}function s_(e,t,n){e=ve(e),t=rt(t);var h=e.length;n=n===s?h:Oi(ne(n),0,h);var p=n;return n-=t.length,n>=0&&e.slice(n,p)==t}function r_(e){return e=ve(e),e&&Mg.test(e)?e.replace(Va,Jf):e}function n_(e){return e=ve(e),e&&Hg.test(e)?e.replace(bn,"\\$&"):e}var o_=ss(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),a_=ss(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),c_=vh("toLowerCase");function h_(e,t,n){e=ve(e),t=ne(t);var h=t?Wi(e):0;if(!t||h>=t)return e;var p=(t-h)/2;return Rr(fr(p),n)+e+Rr(gr(p),n)}function u_(e,t,n){e=ve(e),t=ne(t);var h=t?Wi(e):0;return t&&h<t?e+Rr(t-h,n):e}function l_(e,t,n){e=ve(e),t=ne(t);var h=t?Wi(e):0;return t&&h<t?Rr(t-h,n)+e:e}function p_(e,t,n){return n||t==null?t=0:t&&(t=+t),wy(ve(e).replace(En,""),t||0)}function d_(e,t,n){return(n?Je(e,t,n):t===s)?t=1:t=ne(t),eo(ve(e),t)}function g_(){var e=arguments,t=ve(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var f_=ss(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function y_(e,t,n){return n&&typeof n!="number"&&Je(e,t,n)&&(t=n=s),n=n===s?et:n>>>0,n?(e=ve(e),e&&(typeof t=="string"||t!=null&&!Po(t))&&(t=rt(t),!t&&Gi(e))?yi(St(e),0,n):e.split(t,n)):[]}var v_=ss(function(e,t,n){return e+(n?" ":"")+So(t)});function m_(e,t,n){return e=ve(e),n=n==null?0:Oi(ne(n),0,e.length),t=rt(t),e.slice(n,n+t.length)==t}function w_(e,t,n){var h=g.templateSettings;n&&Je(e,t,n)&&(t=s),e=ve(e),t=jr({},t,h,Ph);var p=jr({},t.imports,h.imports,Ph),f=$e(p),m=Mn(p,f),w,E,x=0,S=t.interpolate||Xs,R="__p += '",F=$n((t.escape||Xs).source+"|"+S.source+"|"+(S===Ba?Yg:Xs).source+"|"+(t.evaluate||Xs).source+"|$","g"),H="//# sourceURL="+(me.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Rf+"]")+`
`;e.replace(F,function(G,ce,le,ot,Ge,at){return le||(le=ot),R+=e.slice(x,at).replace(nf,Gf),ce&&(w=!0,R+=`' +
__e(`+ce+`) +
'`),Ge&&(E=!0,R+=`';
`+Ge+`;
__p += '`),le&&(R+=`' +
((__t = (`+le+`)) == null ? '' : __t) +
'`),x=at+G.length,G}),R+=`';
`;var J=me.call(t,"variable")&&t.variable;if(!J)R=`with (obj) {
`+R+`
}
`;else if(Wg.test(J))throw new te(v);R=(E?R.replace(qg,""):R).replace(Dg,"$1").replace(Fg,"$1;"),R="function("+(J||"obj")+`) {
`+(J?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(E?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var oe=yu(function(){return ge(f,H+"return "+R).apply(s,m)});if(oe.source=R,Io(oe))throw oe;return oe}function __(e){return ve(e).toLowerCase()}function b_(e){return ve(e).toUpperCase()}function E_(e,t,n){if(e=ve(e),e&&(n||t===s))return Cc(e);if(!e||!(t=rt(t)))return e;var h=St(e),p=St(t),f=xc(h,p),m=Sc(h,p)+1;return yi(h,f,m).join("")}function I_(e,t,n){if(e=ve(e),e&&(n||t===s))return e.slice(0,Oc(e)+1);if(!e||!(t=rt(t)))return e;var h=St(e),p=Sc(h,St(t))+1;return yi(h,0,p).join("")}function P_(e,t,n){if(e=ve(e),e&&(n||t===s))return e.replace(En,"");if(!e||!(t=rt(t)))return e;var h=St(e),p=xc(h,St(t));return yi(h,p).join("")}function C_(e,t){var n=ln,h=Qs;if(Oe(t)){var p="separator"in t?t.separator:p;n="length"in t?ne(t.length):n,h="omission"in t?rt(t.omission):h}e=ve(e);var f=e.length;if(Gi(e)){var m=St(e);f=m.length}if(n>=f)return e;var w=n-Wi(h);if(w<1)return h;var E=m?yi(m,0,w).join(""):e.slice(0,w);if(p===s)return E+h;if(m&&(w+=E.length-w),Po(p)){if(e.slice(w).search(p)){var x,S=E;for(p.global||(p=$n(p.source,ve(Ja.exec(p))+"g")),p.lastIndex=0;x=p.exec(S);)var R=x.index;E=E.slice(0,R===s?w:R)}}else if(e.indexOf(rt(p),w)!=w){var F=E.lastIndexOf(p);F>-1&&(E=E.slice(0,F))}return E+h}function x_(e){return e=ve(e),e&&kg.test(e)?e.replace(Ka,ty):e}var S_=ss(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),So=vh("toUpperCase");function fu(e,t,n){return e=ve(e),t=n?s:t,t===s?Qf(e)?ry(e):zf(e):e.match(t)||[]}var yu=ae(function(e,t){try{return it(e,s,t)}catch(n){return Io(n)?n:new te(n)}}),R_=si(function(e,t){return lt(t,function(n){n=zt(n),ti(e,n,bo(e[n],e))}),e});function O_(e){var t=e==null?0:e.length,n=B();return e=t?Se(e,function(h){if(typeof h[1]!="function")throw new pt(l);return[n(h[0]),h[1]]}):[],ae(function(h){for(var p=-1;++p<t;){var f=e[p];if(it(f[0],this,h))return it(f[1],this,h)}})}function T_(e){return tv(gt(e,T))}function Ro(e){return function(){return e}}function A_(e,t){return e==null||e!==e?t:e}var N_=wh(),q_=wh(!0);function Ze(e){return e}function Oo(e){return Wc(typeof e=="function"?e:gt(e,T))}function D_(e){return Yc(gt(e,T))}function F_(e,t){return Zc(e,gt(t,T))}var k_=ae(function(e,t){return function(n){return Ts(n,e,t)}}),M_=ae(function(e,t){return function(n){return Ts(e,n,t)}});function To(e,t,n){var h=$e(t),p=br(t,h);n==null&&!(Oe(t)&&(p.length||!h.length))&&(n=t,t=e,e=this,p=br(t,$e(t)));var f=!(Oe(n)&&"chain"in n)||!!n.chain,m=ni(e);return lt(p,function(w){var E=t[w];e[w]=E,m&&(e.prototype[w]=function(){var x=this.__chain__;if(f||x){var S=e(this.__wrapped__),R=S.__actions__=We(this.__actions__);return R.push({func:E,args:arguments,thisArg:e}),S.__chain__=x,S}return E.apply(e,ui([this.value()],arguments))})}),e}function L_(){return ze._===this&&(ze._=uy),this}function Ao(){}function $_(e){return e=ne(e),ae(function(t){return Xc(t,e)})}var j_=ao(Se),z_=ao(_c),U_=ao(Nn);function vu(e){return fo(e)?qn(zt(e)):mv(e)}function H_(e){return function(t){return e==null?s:Ti(e,t)}}var K_=bh(),V_=bh(!0);function No(){return[]}function qo(){return!1}function B_(){return{}}function J_(){return""}function G_(){return!0}function W_(e,t){if(e=ne(e),e<1||e>Re)return[];var n=et,h=He(e,et);t=B(t),e-=et;for(var p=kn(h,t);++n<e;)t(n);return p}function Q_(e){return ie(e)?Se(e,zt):nt(e)?[e]:We(Mh(ve(e)))}function Y_(e){var t=++cy;return ve(e)+t}var Z_=Sr(function(e,t){return e+t},0),X_=co("ceil"),eb=Sr(function(e,t){return e/t},1),tb=co("floor");function ib(e){return e&&e.length?_r(e,Ze,Jn):s}function sb(e,t){return e&&e.length?_r(e,B(t,2),Jn):s}function rb(e){return Ic(e,Ze)}function nb(e,t){return Ic(e,B(t,2))}function ob(e){return e&&e.length?_r(e,Ze,Yn):s}function ab(e,t){return e&&e.length?_r(e,B(t,2),Yn):s}var cb=Sr(function(e,t){return e*t},1),hb=co("round"),ub=Sr(function(e,t){return e-t},0);function lb(e){return e&&e.length?Fn(e,Ze):0}function pb(e,t){return e&&e.length?Fn(e,B(t,2)):0}return g.after=D0,g.ary=Gh,g.assign=bw,g.assignIn=cu,g.assignInWith=jr,g.assignWith=Ew,g.at=Iw,g.before=Wh,g.bind=bo,g.bindAll=R_,g.bindKey=Qh,g.castArray=B0,g.chain=Vh,g.chunk=tm,g.compact=im,g.concat=sm,g.cond=O_,g.conforms=T_,g.constant=Ro,g.countBy=l0,g.create=Pw,g.curry=Yh,g.curryRight=Zh,g.debounce=Xh,g.defaults=Cw,g.defaultsDeep=xw,g.defer=F0,g.delay=k0,g.difference=rm,g.differenceBy=nm,g.differenceWith=om,g.drop=am,g.dropRight=cm,g.dropRightWhile=hm,g.dropWhile=um,g.fill=lm,g.filter=d0,g.flatMap=y0,g.flatMapDeep=v0,g.flatMapDepth=m0,g.flatten=zh,g.flattenDeep=pm,g.flattenDepth=dm,g.flip=M0,g.flow=N_,g.flowRight=q_,g.fromPairs=gm,g.functions=qw,g.functionsIn=Dw,g.groupBy=w0,g.initial=ym,g.intersection=vm,g.intersectionBy=mm,g.intersectionWith=wm,g.invert=kw,g.invertBy=Mw,g.invokeMap=b0,g.iteratee=Oo,g.keyBy=E0,g.keys=$e,g.keysIn=Ye,g.map=Dr,g.mapKeys=$w,g.mapValues=jw,g.matches=D_,g.matchesProperty=F_,g.memoize=kr,g.merge=zw,g.mergeWith=hu,g.method=k_,g.methodOf=M_,g.mixin=To,g.negate=Mr,g.nthArg=$_,g.omit=Uw,g.omitBy=Hw,g.once=L0,g.orderBy=I0,g.over=j_,g.overArgs=$0,g.overEvery=z_,g.overSome=U_,g.partial=Eo,g.partialRight=eu,g.partition=P0,g.pick=Kw,g.pickBy=uu,g.property=vu,g.propertyOf=H_,g.pull=Im,g.pullAll=Hh,g.pullAllBy=Pm,g.pullAllWith=Cm,g.pullAt=xm,g.range=K_,g.rangeRight=V_,g.rearg=j0,g.reject=S0,g.remove=Sm,g.rest=z0,g.reverse=wo,g.sampleSize=O0,g.set=Bw,g.setWith=Jw,g.shuffle=T0,g.slice=Rm,g.sortBy=q0,g.sortedUniq=Fm,g.sortedUniqBy=km,g.split=y_,g.spread=U0,g.tail=Mm,g.take=Lm,g.takeRight=$m,g.takeRightWhile=jm,g.takeWhile=zm,g.tap=i0,g.throttle=H0,g.thru=qr,g.toArray=nu,g.toPairs=lu,g.toPairsIn=pu,g.toPath=Q_,g.toPlainObject=au,g.transform=Gw,g.unary=K0,g.union=Um,g.unionBy=Hm,g.unionWith=Km,g.uniq=Vm,g.uniqBy=Bm,g.uniqWith=Jm,g.unset=Ww,g.unzip=_o,g.unzipWith=Kh,g.update=Qw,g.updateWith=Yw,g.values=os,g.valuesIn=Zw,g.without=Gm,g.words=fu,g.wrap=V0,g.xor=Wm,g.xorBy=Qm,g.xorWith=Ym,g.zip=Zm,g.zipObject=Xm,g.zipObjectDeep=e0,g.zipWith=t0,g.entries=lu,g.entriesIn=pu,g.extend=cu,g.extendWith=jr,To(g,g),g.add=Z_,g.attempt=yu,g.camelCase=i_,g.capitalize=du,g.ceil=X_,g.clamp=Xw,g.clone=J0,g.cloneDeep=W0,g.cloneDeepWith=Q0,g.cloneWith=G0,g.conformsTo=Y0,g.deburr=gu,g.defaultTo=A_,g.divide=eb,g.endsWith=s_,g.eq=Ot,g.escape=r_,g.escapeRegExp=n_,g.every=p0,g.find=g0,g.findIndex=$h,g.findKey=Sw,g.findLast=f0,g.findLastIndex=jh,g.findLastKey=Rw,g.floor=tb,g.forEach=Bh,g.forEachRight=Jh,g.forIn=Ow,g.forInRight=Tw,g.forOwn=Aw,g.forOwnRight=Nw,g.get=Co,g.gt=Z0,g.gte=X0,g.has=Fw,g.hasIn=xo,g.head=Uh,g.identity=Ze,g.includes=_0,g.indexOf=fm,g.inRange=e_,g.invoke=Lw,g.isArguments=qi,g.isArray=ie,g.isArrayBuffer=ew,g.isArrayLike=Qe,g.isArrayLikeObject=qe,g.isBoolean=tw,g.isBuffer=vi,g.isDate=iw,g.isElement=sw,g.isEmpty=rw,g.isEqual=nw,g.isEqualWith=ow,g.isError=Io,g.isFinite=aw,g.isFunction=ni,g.isInteger=tu,g.isLength=Lr,g.isMap=iu,g.isMatch=cw,g.isMatchWith=hw,g.isNaN=uw,g.isNative=lw,g.isNil=dw,g.isNull=pw,g.isNumber=su,g.isObject=Oe,g.isObjectLike=Ne,g.isPlainObject=ks,g.isRegExp=Po,g.isSafeInteger=gw,g.isSet=ru,g.isString=$r,g.isSymbol=nt,g.isTypedArray=ns,g.isUndefined=fw,g.isWeakMap=yw,g.isWeakSet=vw,g.join=_m,g.kebabCase=o_,g.last=yt,g.lastIndexOf=bm,g.lowerCase=a_,g.lowerFirst=c_,g.lt=mw,g.lte=ww,g.max=ib,g.maxBy=sb,g.mean=rb,g.meanBy=nb,g.min=ob,g.minBy=ab,g.stubArray=No,g.stubFalse=qo,g.stubObject=B_,g.stubString=J_,g.stubTrue=G_,g.multiply=cb,g.nth=Em,g.noConflict=L_,g.noop=Ao,g.now=Fr,g.pad=h_,g.padEnd=u_,g.padStart=l_,g.parseInt=p_,g.random=t_,g.reduce=C0,g.reduceRight=x0,g.repeat=d_,g.replace=g_,g.result=Vw,g.round=hb,g.runInContext=b,g.sample=R0,g.size=A0,g.snakeCase=f_,g.some=N0,g.sortedIndex=Om,g.sortedIndexBy=Tm,g.sortedIndexOf=Am,g.sortedLastIndex=Nm,g.sortedLastIndexBy=qm,g.sortedLastIndexOf=Dm,g.startCase=v_,g.startsWith=m_,g.subtract=ub,g.sum=lb,g.sumBy=pb,g.template=w_,g.times=W_,g.toFinite=oi,g.toInteger=ne,g.toLength=ou,g.toLower=__,g.toNumber=vt,g.toSafeInteger=_w,g.toString=ve,g.toUpper=b_,g.trim=E_,g.trimEnd=I_,g.trimStart=P_,g.truncate=C_,g.unescape=x_,g.uniqueId=Y_,g.upperCase=S_,g.upperFirst=So,g.each=Bh,g.eachRight=Jh,g.first=Uh,To(g,function(){var e={};return $t(g,function(t,n){me.call(g.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),g.VERSION=o,lt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){g[e].placeholder=g}),lt(["drop","take"],function(e,t){ue.prototype[e]=function(n){n=n===s?1:Me(ne(n),0);var h=this.__filtered__&&!t?new ue(this):this.clone();return h.__filtered__?h.__takeCount__=He(n,h.__takeCount__):h.__views__.push({size:He(n,et),type:e+(h.__dir__<0?"Right":"")}),h},ue.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),lt(["filter","map","takeWhile"],function(e,t){var n=t+1,h=n==zi||n==Ii;ue.prototype[e]=function(p){var f=this.clone();return f.__iteratees__.push({iteratee:B(p,3),type:n}),f.__filtered__=f.__filtered__||h,f}}),lt(["head","last"],function(e,t){var n="take"+(t?"Right":"");ue.prototype[e]=function(){return this[n](1).value()[0]}}),lt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");ue.prototype[e]=function(){return this.__filtered__?new ue(this):this[n](1)}}),ue.prototype.compact=function(){return this.filter(Ze)},ue.prototype.find=function(e){return this.filter(e).head()},ue.prototype.findLast=function(e){return this.reverse().find(e)},ue.prototype.invokeMap=ae(function(e,t){return typeof e=="function"?new ue(this):this.map(function(n){return Ts(n,e,t)})}),ue.prototype.reject=function(e){return this.filter(Mr(B(e)))},ue.prototype.slice=function(e,t){e=ne(e);var n=this;return n.__filtered__&&(e>0||t<0)?new ue(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==s&&(t=ne(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},ue.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ue.prototype.toArray=function(){return this.take(et)},$t(ue.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),h=/^(?:head|last)$/.test(t),p=g[h?"take"+(t=="last"?"Right":""):t],f=h||/^find/.test(t);p&&(g.prototype[t]=function(){var m=this.__wrapped__,w=h?[1]:arguments,E=m instanceof ue,x=w[0],S=E||ie(m),R=function(ce){var le=p.apply(g,ui([ce],w));return h&&F?le[0]:le};S&&n&&typeof x=="function"&&x.length!=1&&(E=S=!1);var F=this.__chain__,H=!!this.__actions__.length,J=f&&!F,oe=E&&!H;if(!f&&S){m=oe?m:new ue(this);var G=e.apply(m,w);return G.__actions__.push({func:qr,args:[R],thisArg:s}),new dt(G,F)}return J&&oe?e.apply(this,w):(G=this.thru(R),J?h?G.value()[0]:G.value():G)})}),lt(["pop","push","shift","sort","splice","unshift"],function(e){var t=nr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",h=/^(?:pop|shift)$/.test(e);g.prototype[e]=function(){var p=arguments;if(h&&!this.__chain__){var f=this.value();return t.apply(ie(f)?f:[],p)}return this[n](function(m){return t.apply(ie(m)?m:[],p)})}}),$t(ue.prototype,function(e,t){var n=g[t];if(n){var h=n.name+"";me.call(Xi,h)||(Xi[h]=[]),Xi[h].push({name:t,func:n})}}),Xi[xr(s,z).name]=[{name:"wrapper",func:s}],ue.prototype.clone=xy,ue.prototype.reverse=Sy,ue.prototype.value=Ry,g.prototype.at=s0,g.prototype.chain=r0,g.prototype.commit=n0,g.prototype.next=o0,g.prototype.plant=c0,g.prototype.reverse=h0,g.prototype.toJSON=g.prototype.valueOf=g.prototype.value=u0,g.prototype.first=g.prototype.head,Is&&(g.prototype[Is]=a0),g},Qi=ny();Ci?((Ci.exports=Qi)._=Qi,Rn._=Qi):ze._=Qi}).call(ds)})(en,en.exports);var zd=Object.defineProperty,Ud=Object.defineProperties,Hd=Object.getOwnPropertyDescriptors,Oa=Object.getOwnPropertySymbols,Kd=Object.prototype.hasOwnProperty,Vd=Object.prototype.propertyIsEnumerable,Ta=(y,r,s)=>r in y?zd(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,Bs=(y,r)=>{for(var s in r||(r={}))Kd.call(r,s)&&Ta(y,s,r[s]);if(Oa)for(var s of Oa(r))Vd.call(r,s)&&Ta(y,s,r[s]);return y},Bd=(y,r)=>Ud(y,Hd(r));function It(y,r,s){var o;const a=(0,d.DQe)(y);return((o=r.rpcMap)==null?void 0:o[a.reference])||`${jd}?chainId=${a.namespace}:${a.reference}&projectId=${s}`}function Ei(y){return y.includes(":")?y.split(":")[1]:y}function Aa(y){return y.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function Jd(y,r){const s=Object.keys(r.namespaces).filter(a=>a.includes(y));if(!s.length)return[];const o=[];return s.forEach(a=>{const u=r.namespaces[a].accounts;o.push(...u)}),o}function tn(y={},r={}){const s=Na(y),o=Na(r);return en.exports.merge(s,o)}function Na(y){var r,s,o,a;const u={};if(!(0,d.L5o)(y))return u;for(const[l,v]of Object.entries(y)){const _=(0,d.gpE)(l)?[l]:v.chains,I=v.methods||[],O=v.events||[],T=v.rpcMap||{},D=(0,d.Maj)(l);u[D]=Bd(Bs(Bs({},u[D]),v),{chains:(0,d.eGA)(_,(r=u[D])==null?void 0:r.chains),methods:(0,d.eGA)(I,(s=u[D])==null?void 0:s.methods),events:(0,d.eGA)(O,(o=u[D])==null?void 0:o.events),rpcMap:Bs(Bs({},T),(a=u[D])==null?void 0:a.rpcMap)})}return u}function Gd(y){return y.includes(":")?y.split(":")[2]:y}function qa(y){const r={};for(const[s,o]of Object.entries(y)){const a=o.methods||[],u=o.events||[],l=o.accounts||[],v=(0,d.gpE)(s)?[s]:o.chains?o.chains:Aa(o.accounts);r[s]={chains:v,methods:a,events:u,accounts:l}}return r}function sn(y){return typeof y=="number"?y:y.includes("0x")?parseInt(y,16):(y=y.includes(":")?y.split(":")[1]:y,isNaN(Number(y))?y:Number(y))}const Da={},ye=y=>Da[y],rn=(y,r)=>{Da[y]=r};class Wd{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Ei(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||It(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new mt.r(new kt.Z(o,ye("disableProviderPing")))}}var Qd=Object.defineProperty,Yd=Object.defineProperties,Zd=Object.getOwnPropertyDescriptors,Fa=Object.getOwnPropertySymbols,Xd=Object.prototype.hasOwnProperty,eg=Object.prototype.propertyIsEnumerable,ka=(y,r,s)=>r in y?Qd(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,Ma=(y,r)=>{for(var s in r||(r={}))Xd.call(r,s)&&ka(y,s,r[s]);if(Fa)for(var s of Fa(r))eg.call(r,s)&&ka(y,s,r[s]);return y},La=(y,r)=>Yd(y,Zd(r));class tg{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(r)}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(parseInt(r),s),this.chainId=parseInt(r),this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,s){const o=s||It(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new mt.r(new kt.k(o,ye("disableProviderPing")))}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=parseInt(Ei(s));r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}async handleSwitchChain(r){var s,o;let a=r.request.params?(s=r.request.params[0])==null?void 0:s.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:a}]},chainId:(o=this.namespace.chains)==null?void 0:o[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}async getCapabilities(r){var s,o,a;const u=(o=(s=r.request)==null?void 0:s.params)==null?void 0:o[0];if(!u)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(r.topic),v=((a=l==null?void 0:l.sessionProperties)==null?void 0:a.capabilities)||{};if(v!=null&&v[u])return v==null?void 0:v[u];const _=await this.client.request(r);try{await this.client.session.update(r.topic,{sessionProperties:La(Ma({},l.sessionProperties||{}),{capabilities:La(Ma({},v||{}),{[u]:_})})})}catch(I){console.warn("Failed to update session with capabilities",I)}return _}}class ig{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Ei(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||It(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new mt.r(new kt.Z(o,ye("disableProviderPing")))}}class sg{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Ei(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||It(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new mt.r(new kt.Z(o,ye("disableProviderPing")))}}class rg{constructor(r){this.name="algorand",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){if(!this.httpProviders[r]){const o=s||It(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,o)}this.chainId=r,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;r[s]=this.createHttpProvider(s,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||It(r,this.namespace,this.client.core.projectId);return typeof o>"u"?void 0:new mt.r(new kt.Z(o,ye("disableProviderPing")))}}class ng{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{const o=this.getCardanoRPCUrl(s),a=Ei(s);r[a]=this.createHttpProvider(a,o)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}getCardanoRPCUrl(r){const s=this.namespace.rpcMap;if(s)return s[r]}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||this.getCardanoRPCUrl(r);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new mt.r(new kt.Z(o,ye("disableProviderPing")))}}class og{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Ei(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||It(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new mt.r(new kt.Z(o,ye("disableProviderPing")))}}class ag{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;const a=Ei(s);r[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||It(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new mt.r(new kt.Z(o,ye("disableProviderPing")))}}class cg{constructor(r){this.name="near",this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,s){if(this.chainId=r,!this.httpProviders[r]){const o=s||It(`${this.name}:${r}`,this.namespace);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,o)}this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(s=>{var o;r[s]=this.createHttpProvider(s,(o=this.namespace.rpcMap)==null?void 0:o[s])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||It(r,this.namespace);return typeof o>"u"?void 0:new mt.r(new kt.Z(o,ye("disableProviderPing")))}}class hg{constructor(r){this.name=Li,this.namespace=r.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(r.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(r.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(r.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(r.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider(r.chainId).request(r.request)}setDefaultChain(r,s){this.httpProviders[r]||this.setHttpProvider(r,s),this.chainId=r,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){var r,s;const o={};return(s=(r=this.namespace)==null?void 0:r.accounts)==null||s.forEach(a=>{const u=(0,d.DQe)(a);o[`${u.namespace}:${u.reference}`]=this.createHttpProvider(a)}),o}getHttpProvider(r){const s=this.httpProviders[r];if(typeof s>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return s}setHttpProvider(r,s){const o=this.createHttpProvider(r,s);o&&(this.httpProviders[r]=o)}createHttpProvider(r,s){const o=s||It(r,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${r}`);return new mt.r(new kt.Z(o,ye("disableProviderPing")))}}var ug=Object.defineProperty,lg=Object.defineProperties,pg=Object.getOwnPropertyDescriptors,$a=Object.getOwnPropertySymbols,dg=Object.prototype.hasOwnProperty,gg=Object.prototype.propertyIsEnumerable,ja=(y,r,s)=>r in y?ug(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,Js=(y,r)=>{for(var s in r||(r={}))dg.call(r,s)&&ja(y,s,r[s]);if($a)for(var s of $a(r))gg.call(r,s)&&ja(y,s,r[s]);return y},nn=(y,r)=>lg(y,pg(r));class on{constructor(r){this.events=new(ci()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:(0,se.gw)((0,se.jI)({level:(r==null?void 0:r.logger)||Sa})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const s=new on(r);return await s.initialize(),s}async request(r,s,o){const[a,u]=this.validateChain(s);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:Js({},r),chainId:`${a}:${u}`,topic:this.session.topic,expiry:o})}sendAsync(r,s,o,a){const u=new Date().getTime();this.request(r,o,a).then(l=>s(null,(0,W.formatJsonRpcResult)(u,l))).catch(l=>s(l,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:(0,d.D6H)("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}async authenticate(r,s){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(r),await this.cleanupPendingPairings();const{uri:o,response:a}=await this.client.authenticate(r,s);o&&(this.uri=o,this.events.emit("display_uri",o));const u=await a();if(this.session=u.session,this.session){const l=qa(this.session.namespaces);this.namespaces=tn(this.namespaces,l),this.persist("namespaces",this.namespaces),this.onConnect()}return u}on(r,s){this.events.on(r,s)}once(r,s){this.events.once(r,s)}removeListener(r,s){this.events.removeListener(r,s)}off(r,s){this.events.off(r,s)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let s=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(s>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:o,approval:a}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});o&&(this.uri=o,this.events.emit("display_uri",o)),await a().then(u=>{this.session=u;const l=qa(u.namespaces);this.namespaces=tn(this.namespaces,l),this.persist("namespaces",this.namespaces)}).catch(u=>{if(u.message!==Pa)throw u;s++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,s){try{if(!this.session)return;const[o,a]=this.validateChain(r),u=this.getProvider(o);u.name===Li?u.setDefaultChain(`${o}:${a}`,s):u.setDefaultChain(a,s)}catch(o){if(!/Please call connect/.test(o.message))throw o}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const s=this.client.pairing.getAll();if((0,d.qt8)(s)){for(const o of s)r.deletePairings?this.client.core.expirer.set(o.topic,0):await this.client.core.relayer.subscriber.unsubscribe(o.topic);this.logger.info(`Inactive pairings cleared: ${s.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Xr.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Sa,relayUrl:this.providerOpts.relayUrl||Md,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(s=>(0,d.Maj)(s)))];rn("client",this.client),rn("events",this.events),rn("disableProviderPing",this.disableProviderPing),r.forEach(s=>{if(!this.session)return;const o=Jd(s,this.session),a=Aa(o),u=tn(this.namespaces,this.optionalNamespaces),l=nn(Js({},u[s]),{accounts:o,chains:a});switch(s){case"eip155":this.rpcProviders[s]=new tg({namespace:l});break;case"algorand":this.rpcProviders[s]=new rg({namespace:l});break;case"solana":this.rpcProviders[s]=new ig({namespace:l});break;case"cosmos":this.rpcProviders[s]=new sg({namespace:l});break;case"polkadot":this.rpcProviders[s]=new Wd({namespace:l});break;case"cip34":this.rpcProviders[s]=new ng({namespace:l});break;case"elrond":this.rpcProviders[s]=new og({namespace:l});break;case"multiversx":this.rpcProviders[s]=new ag({namespace:l});break;case"near":this.rpcProviders[s]=new cg({namespace:l});break;default:this.rpcProviders[Li]?this.rpcProviders[Li].updateNamespace(l):this.rpcProviders[Li]=new hg({namespace:l})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:s}=r,{event:o}=s;if(o.name==="accountsChanged"){const a=o.data;a&&(0,d.qt8)(a)&&this.events.emit("accountsChanged",a.map(Gd))}else if(o.name==="chainChanged"){const a=s.chainId,u=s.event.data,l=(0,d.Maj)(a),v=sn(a)!==sn(u)?`${l}:${sn(u)}`:a;this.onChainChanged(v)}else this.events.emit(o.name,o.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:s})=>{var o;const{namespaces:a}=s,u=(o=this.client)==null?void 0:o.session.get(r);this.session=nn(Js({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:s})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",nn(Js({},(0,d.D6H)("USER_DISCONNECTED")),{data:r.topic}))}),this.on(Et.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){return this.rpcProviders[r]||this.rpcProviders[Li]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var s;this.getProvider(r).updateNamespace((s=this.session)==null?void 0:s.namespaces[r])})}setNamespaces(r){const{namespaces:s,optionalNamespaces:o,sessionProperties:a}=r;s&&Object.keys(s).length&&(this.namespaces=s),o&&Object.keys(o).length&&(this.optionalNamespaces=o),this.sessionProperties=a,this.persist("namespaces",s),this.persist("optionalNamespaces",o)}validateChain(r){const[s,o]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[s,o];if(s&&!Object.keys(this.namespaces||{}).map(l=>(0,d.Maj)(l)).includes(s))throw new Error(`Namespace '${s}' is not configured. Please call connect() first with namespace config.`);if(s&&o)return[s,o];const a=(0,d.Maj)(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,s=!1){if(!this.namespaces)return;const[o,a]=this.validateChain(r);a&&(s||this.getProvider(o).setDefaultChain(a),this.namespaces[o]?this.namespaces[o].defaultChain=a:this.namespaces[`${o}:${a}`]?this.namespaces[`${o}:${a}`].defaultChain=a:this.namespaces[`${o}:${a}`]={defaultChain:a},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,s){this.client.core.storage.setItem(`${Ra}/${r}`,s)}async getFromStore(r){return await this.client.core.storage.getItem(`${Ra}/${r}`)}}const fg=on,yg="wc",vg="ethereum_provider",mg=`${yg}@2:${vg}:`,wg="https://rpc.walletconnect.com/v1/",an=["eth_sendTransaction","personal_sign"],_g=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],cn=["chainChanged","accountsChanged"],bg=["chainChanged","accountsChanged","message","disconnect","connect"];var Eg=Object.defineProperty,Ig=Object.defineProperties,Pg=Object.getOwnPropertyDescriptors,za=Object.getOwnPropertySymbols,Cg=Object.prototype.hasOwnProperty,xg=Object.prototype.propertyIsEnumerable,Ua=(y,r,s)=>r in y?Eg(y,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):y[r]=s,$i=(y,r)=>{for(var s in r||(r={}))Cg.call(r,s)&&Ua(y,s,r[s]);if(za)for(var s of za(r))xg.call(r,s)&&Ua(y,s,r[s]);return y},hn=(y,r)=>Ig(y,Pg(r));function Gs(y){return Number(y[0].split(":")[1])}function Ws(y){return`0x${y.toString(16)}`}function Sg(y){const{chains:r,optionalChains:s,methods:o,optionalMethods:a,events:u,optionalEvents:l,rpcMap:v}=y;if(!(0,d.qt8)(r))throw new Error("Invalid chains");const _={chains:r,methods:o||an,events:u||cn,rpcMap:$i({},r.length?{[Gs(r)]:v[Gs(r)]}:{})},I=u==null?void 0:u.filter(A=>!cn.includes(A)),O=o==null?void 0:o.filter(A=>!an.includes(A));if(!s&&!l&&!a&&!(I!=null&&I.length)&&!(O!=null&&O.length))return{required:r.length?_:void 0};const T=(I==null?void 0:I.length)&&(O==null?void 0:O.length)||!s,D={chains:[...new Set(T?_.chains.concat(s||[]):s)],methods:[...new Set(_.methods.concat(a!=null&&a.length?a:_g))],events:[...new Set(_.events.concat(l!=null&&l.length?l:bg))],rpcMap:v};return{required:r.length?_:void 0,optional:s.length?D:void 0}}class un{constructor(){this.events=new Te.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=mg,this.on=(r,s)=>(this.events.on(r,s),this),this.once=(r,s)=>(this.events.once(r,s),this),this.removeListener=(r,s)=>(this.events.removeListener(r,s),this),this.off=(r,s)=>(this.events.off(r,s),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const s=new un;return await s.initialize(r),s}async request(r,s){return await this.signer.request(r,this.formatChainId(this.chainId),s)}sendAsync(r,s,o){this.signer.sendAsync(r,s,this.formatChainId(this.chainId),o)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:s,optional:o}=Sg(this.rpc);try{const a=await new Promise(async(l,v)=>{var _;this.rpc.showQrModal&&((_=this.modal)==null||_.subscribeModal(I=>{!I.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),v(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(hn($i({namespaces:$i({},s&&{[this.namespace]:s})},o&&{optionalNamespaces:{[this.namespace]:o}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(I=>{l(I)}).catch(I=>{v(new Error(I.message))})});if(!a)return;const u=(0,d.guN)(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:Ws(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async authenticate(r,s){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:r==null?void 0:r.chains});try{const o=await new Promise(async(u,l)=>{var v;this.rpc.showQrModal&&((v=this.modal)==null||v.subscribeModal(_=>{!_.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),l(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(hn($i({},r),{chains:this.rpc.chains}),s).then(_=>{u(_)}).catch(_=>{l(new Error(_.message))})}),a=o.session;if(a){const u=(0,d.guN)(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:Ws(this.chainId)})}return o}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:s}=r,{event:o}=s;o.name==="accountsChanged"?(this.accounts=this.parseAccounts(o.data),this.events.emit("accountsChanged",this.accounts)):o.name==="chainChanged"?this.setChainId(this.formatChainId(o.data)):this.events.emit(o.name,o.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const s=parseInt(r);this.chainId=s,this.events.emit("chainChanged",Ws(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",hn($i({},(0,d.D6H)("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var s,o;this.rpc.showQrModal&&((s=this.modal)==null||s.closeModal(),(o=this.modal)==null||o.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const s=r.filter(o=>this.isCompatibleChainId(o)).map(o=>this.parseChainId(o));s.length&&(this.chainId=s[0],this.events.emit("chainChanged",Ws(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const s=this.parseChainId(r);this.chainId=s,this.switchEthereumChain(s)}}parseAccountId(r){const[s,o,a]=r.split(":");return{chainId:`${s}:${o}`,address:a}}setAccounts(r){this.accounts=r.filter(s=>this.parseChainId(this.parseAccountId(s).chainId)===this.chainId).map(s=>this.parseAccountId(s).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var s,o;const a=(s=r==null?void 0:r.chains)!=null?s:[],u=(o=r==null?void 0:r.optionalChains)!=null?o:[],l=a.concat(u);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const v=a.length?(r==null?void 0:r.methods)||an:[],_=a.length?(r==null?void 0:r.events)||cn:[],I=(r==null?void 0:r.optionalMethods)||[],O=(r==null?void 0:r.optionalEvents)||[],T=(r==null?void 0:r.rpcMap)||this.buildRpcMap(l,r.projectId),D=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(A=>this.formatChainId(A)),optionalChains:u.map(A=>this.formatChainId(A)),methods:v,events:_,optionalMethods:I,optionalEvents:O,rpcMap:T,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:D,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,s){const o={};return r.forEach(a=>{o[a]=this.getRpcUrl(a,s)}),o}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?Gs(this.rpc.chains):Gs(this.rpc.optionalChains),this.signer=await fg.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions,customStoragePrefix:r.customStoragePrefix,telemetryEnabled:r.telemetryEnabled}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let s;try{const{WalletConnectModal:o}=await Y.e(2217).then(Y.bind(Y,22217));s=o}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(s)try{this.modal=new s($i({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(o){throw this.signer.logger.error(o),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:s,optionalChains:o,rpcMap:a}=r;s&&(0,d.qt8)(s)&&(this.rpc.chains=s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),o&&(0,d.qt8)(o)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=o==null?void 0:o.map(u=>this.formatChainId(u)),o.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(r,s){var o;return((o=this.rpc.rpcMap)==null?void 0:o[r])||`${wg}?chainId=eip155:${r}&projectId=${s||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),s=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:s==null?void 0:s.accounts),this.setAccounts(s==null?void 0:s.accounts)}catch(r){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(r),await this.disconnect().catch(s=>this.signer.logger.warn(s))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(s=>this.parseAccount(s))}}const Rg=un},72100:function(Di){"use strict";var At=typeof Reflect=="object"?Reflect:null,Y=At&&typeof At.apply=="function"?At.apply:function(N,k,K){return Function.prototype.apply.call(N,k,K)},Te;At&&typeof At.ownKeys=="function"?Te=At.ownKeys:Object.getOwnPropertySymbols?Te=function(N){return Object.getOwnPropertyNames(N).concat(Object.getOwnPropertySymbols(N))}:Te=function(N){return Object.getOwnPropertyNames(N)};function ci(q){console&&console.warn&&console.warn(q)}var d=Number.isNaN||function(N){return N!==N};function fe(){fe.init.call(this)}Di.exports=fe,Di.exports.once=Ur,fe.EventEmitter=fe,fe.prototype._events=void 0,fe.prototype._eventsCount=0,fe.prototype._maxListeners=void 0;var Ut=10;function se(q){if(typeof q!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof q)}Object.defineProperty(fe,"defaultMaxListeners",{enumerable:!0,get:function(){return Ut},set:function(q){if(typeof q!="number"||q<0||d(q))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+q+".");Ut=q}}),fe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},fe.prototype.setMaxListeners=function(N){if(typeof N!="number"||N<0||d(N))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+N+".");return this._maxListeners=N,this};function Ht(q){return q._maxListeners===void 0?fe.defaultMaxListeners:q._maxListeners}fe.prototype.getMaxListeners=function(){return Ht(this)},fe.prototype.emit=function(N){for(var k=[],K=1;K<arguments.length;K++)k.push(arguments[K]);var X=N==="error",we=this._events;if(we!==void 0)X=X&&we.error===void 0;else if(!X)return!1;if(X){var he;if(k.length>0&&(he=k[0]),he instanceof Error)throw he;var Xe=new Error("Unhandled error."+(he?" ("+he.message+")":""));throw Xe.context=he,Xe}var Kt=we[N];if(Kt===void 0)return!1;if(typeof Kt=="function")Y(Kt,this,k);else for(var Vt=Kt.length,Hr=zs(Kt,Vt),K=0;K<Vt;++K)Y(Hr[K],this,k);return!0};function Ms(q,N,k,K){var X,we,he;if(se(k),we=q._events,we===void 0?(we=q._events=Object.create(null),q._eventsCount=0):(we.newListener!==void 0&&(q.emit("newListener",N,k.listener?k.listener:k),we=q._events),he=we[N]),he===void 0)he=we[N]=k,++q._eventsCount;else if(typeof he=="function"?he=we[N]=K?[k,he]:[he,k]:K?he.unshift(k):he.push(k),X=Ht(q),X>0&&he.length>X&&!he.warned){he.warned=!0;var Xe=new Error("Possible EventEmitter memory leak detected. "+he.length+" "+String(N)+" listeners added. Use emitter.setMaxListeners() to increase limit");Xe.name="MaxListenersExceededWarning",Xe.emitter=q,Xe.type=N,Xe.count=he.length,ci(Xe)}return q}fe.prototype.addListener=function(N,k){return Ms(this,N,k,!1)},fe.prototype.on=fe.prototype.addListener,fe.prototype.prependListener=function(N,k){return Ms(this,N,k,!0)};function Do(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ls(q,N,k){var K={fired:!1,wrapFn:void 0,target:q,type:N,listener:k},X=Do.bind(K);return X.listener=k,K.wrapFn=X,X}fe.prototype.once=function(N,k){return se(k),this.on(N,Ls(this,N,k)),this},fe.prototype.prependOnceListener=function(N,k){return se(k),this.prependListener(N,Ls(this,N,k)),this},fe.prototype.removeListener=function(N,k){var K,X,we,he,Xe;if(se(k),X=this._events,X===void 0)return this;if(K=X[N],K===void 0)return this;if(K===k||K.listener===k)--this._eventsCount===0?this._events=Object.create(null):(delete X[N],X.removeListener&&this.emit("removeListener",N,K.listener||k));else if(typeof K!="function"){for(we=-1,he=K.length-1;he>=0;he--)if(K[he]===k||K[he].listener===k){Xe=K[he].listener,we=he;break}if(we<0)return this;we===0?K.shift():zr(K,we),K.length===1&&(X[N]=K[0]),X.removeListener!==void 0&&this.emit("removeListener",N,Xe||k)}return this},fe.prototype.off=fe.prototype.removeListener,fe.prototype.removeAllListeners=function(N){var k,K,X;if(K=this._events,K===void 0)return this;if(K.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):K[N]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete K[N]),this;if(arguments.length===0){var we=Object.keys(K),he;for(X=0;X<we.length;++X)he=we[X],he!=="removeListener"&&this.removeAllListeners(he);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(k=K[N],typeof k=="function")this.removeListener(N,k);else if(k!==void 0)for(X=k.length-1;X>=0;X--)this.removeListener(N,k[X]);return this};function $s(q,N,k){var K=q._events;if(K===void 0)return[];var X=K[N];return X===void 0?[]:typeof X=="function"?k?[X.listener||X]:[X]:k?Fo(X):zs(X,X.length)}fe.prototype.listeners=function(N){return $s(this,N,!0)},fe.prototype.rawListeners=function(N){return $s(this,N,!1)},fe.listenerCount=function(q,N){return typeof q.listenerCount=="function"?q.listenerCount(N):js.call(q,N)},fe.prototype.listenerCount=js;function js(q){var N=this._events;if(N!==void 0){var k=N[q];if(typeof k=="function")return 1;if(k!==void 0)return k.length}return 0}fe.prototype.eventNames=function(){return this._eventsCount>0?Te(this._events):[]};function zs(q,N){for(var k=new Array(N),K=0;K<N;++K)k[K]=q[K];return k}function zr(q,N){for(;N+1<q.length;N++)q[N]=q[N+1];q.pop()}function Fo(q){for(var N=new Array(q.length),k=0;k<N.length;++k)N[k]=q[k].listener||q[k];return N}function Ur(q,N){return new Promise(function(k,K){function X(he){q.removeListener(N,we),K(he)}function we(){typeof q.removeListener=="function"&&q.removeListener("error",X),k([].slice.call(arguments))}Us(q,N,we,{once:!0}),N!=="error"&&ko(q,X,{once:!0})})}function ko(q,N,k){typeof q.on=="function"&&Us(q,"error",N,k)}function Us(q,N,k,K){if(typeof q.on=="function")K.once?q.once(N,k):q.on(N,k);else if(typeof q.addEventListener=="function")q.addEventListener(N,function X(we){K.once&&q.removeEventListener(N,X),k(we)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof q)}},2937:function(Di){typeof Object.create=="function"?Di.exports=function(Y,Te){Te&&(Y.super_=Te,Y.prototype=Object.create(Te.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}))}:Di.exports=function(Y,Te){if(Te){Y.super_=Te;var ci=function(){};ci.prototype=Te.prototype,Y.prototype=new ci,Y.prototype.constructor=Y}}}}]);
