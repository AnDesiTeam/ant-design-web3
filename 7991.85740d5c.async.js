"use strict";(self.webpackChunk_ant_design_web3_docs=self.webpackChunk_ant_design_web3_docs||[]).push([[7991],{77991:function(i1,Kn,fe){fe.r(Kn),fe.d(Kn,{UniversalProvider:function(){return fd},default:function(){return pr}});var Nt=fe(72100),ns=fe.n(Nt),Pu=fe(53070),Fi=fe(19994),ee=fe(56526),ui=fe(36900);class Su extends ui.q{constructor(s){super(),this.opts=s,this.protocol="wc",this.version=2}}class r1{constructor(s,r,o){this.core=s,this.logger=r}}class Ru extends ui.q{constructor(s,r){super(),this.core=s,this.logger=r,this.records=new Map}}class xu{constructor(s,r){this.logger=s,this.core=r}}class Cu extends ui.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class qu extends ui.q{constructor(s){super()}}class Fu{constructor(s,r,o,a){this.core=s,this.logger=r,this.name=o}}class s1{constructor(){this.map=new Map}}class Au extends ui.q{constructor(s,r){super(),this.relayer=s,this.logger=r}}class n1{constructor(s,r){this.core=s,this.logger=r}}class Du extends ui.q{constructor(s,r){super(),this.core=s,this.logger=r}}class o1{constructor(s,r){this.logger=s,this.core=r}}class Ou{constructor(s,r){this.projectId=s,this.logger=r}}class Tu{constructor(s,r){this.projectId=s,this.logger=r}}class a1 extends null{constructor(){super()}}class Nu{constructor(s){this.opts=s,this.protocol="wc",this.version=2}}class c1 extends null{constructor(){super()}}class ku{constructor(s){this.client=s}}var Jn=fe(41926),or=fe(70083),d=fe(85769),$u=fe(90032),O=fe(46196),It=fe(56390),L=fe(23700),ju=fe(66865),Mu=fe(5899),zu=fe.n(Mu),Uu=fe(51538),Lu=fe.n(Uu);function Hu(y,s){if(y.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),o=0;o<r.length;o++)r[o]=255;for(var a=0;a<y.length;a++){var h=y.charAt(a),g=h.charCodeAt(0);if(r[g]!==255)throw new TypeError(h+" is ambiguous");r[g]=a}var v=y.length,I=y.charAt(0),C=Math.log(v)/Math.log(256),F=Math.log(256)/Math.log(v);function A(k){if(k instanceof Uint8Array||(ArrayBuffer.isView(k)?k=new Uint8Array(k.buffer,k.byteOffset,k.byteLength):Array.isArray(k)&&(k=Uint8Array.from(k))),!(k instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(k.length===0)return"";for(var H=0,K=0,Y=0,ae=k.length;Y!==ae&&k[Y]===0;)Y++,H++;for(var ie=(ae-Y)*F+1>>>0,se=new Uint8Array(ie);Y!==ae;){for(var re=k[Y],ve=0,de=ie-1;(re!==0||ve<K)&&de!==-1;de--,ve++)re+=256*se[de]>>>0,se[de]=re%v>>>0,re=re/v>>>0;if(re!==0)throw new Error("Non-zero carry");K=ve,Y++}for(var Ee=ie-K;Ee!==ie&&se[Ee]===0;)Ee++;for(var Le=I.repeat(H);Ee<ie;++Ee)Le+=y.charAt(se[Ee]);return Le}function N(k){if(typeof k!="string")throw new TypeError("Expected String");if(k.length===0)return new Uint8Array;var H=0;if(k[H]!==" "){for(var K=0,Y=0;k[H]===I;)K++,H++;for(var ae=(k.length-H)*C+1>>>0,ie=new Uint8Array(ae);k[H];){var se=r[k.charCodeAt(H)];if(se===255)return;for(var re=0,ve=ae-1;(se!==0||re<Y)&&ve!==-1;ve--,re++)se+=v*ie[ve]>>>0,ie[ve]=se%256>>>0,se=se/256>>>0;if(se!==0)throw new Error("Non-zero carry");Y=re,H++}if(k[H]!==" "){for(var de=ae-Y;de!==ae&&ie[de]===0;)de++;for(var Ee=new Uint8Array(K+(ae-de)),Le=K;de!==ae;)Ee[Le++]=ie[de++];return Ee}}}function M(k){var H=N(k);if(H)return H;throw new Error(`Non-${s} character`)}return{encode:A,decodeUnsafe:N,decode:M}}var Vu=Hu,Bu=Vu;const Gn=y=>{if(y instanceof Uint8Array&&y.constructor.name==="Uint8Array")return y;if(y instanceof ArrayBuffer)return new Uint8Array(y);if(ArrayBuffer.isView(y))return new Uint8Array(y.buffer,y.byteOffset,y.byteLength);throw new Error("Unknown type, must be binary type")},Ku=y=>new TextEncoder().encode(y),Ju=y=>new TextDecoder().decode(y);class Gu{constructor(s,r,o){this.name=s,this.prefix=r,this.baseEncode=o}encode(s){if(s instanceof Uint8Array)return`${this.prefix}${this.baseEncode(s)}`;throw Error("Unknown type, must be binary type")}}class Wu{constructor(s,r,o){if(this.name=s,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=o}decode(s){if(typeof s=="string"){if(s.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(s)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(s.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(s){return Wn(this,s)}}class Qu{constructor(s){this.decoders=s}or(s){return Wn(this,s)}decode(s){const r=s[0],o=this.decoders[r];if(o)return o.decode(s);throw RangeError(`Unable to decode multibase string ${JSON.stringify(s)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Wn=(y,s)=>new Qu({...y.decoders||{[y.prefix]:y},...s.decoders||{[s.prefix]:s}});class Yu{constructor(s,r,o,a){this.name=s,this.prefix=r,this.baseEncode=o,this.baseDecode=a,this.encoder=new Gu(s,r,o),this.decoder=new Wu(s,r,a)}encode(s){return this.encoder.encode(s)}decode(s){return this.decoder.decode(s)}}const ar=({name:y,prefix:s,encode:r,decode:o})=>new Yu(y,s,r,o),Ai=({prefix:y,name:s,alphabet:r})=>{const{encode:o,decode:a}=Bu(r,s);return ar({prefix:y,name:s,encode:o,decode:h=>Gn(a(h))})},Zu=(y,s,r,o)=>{const a={};for(let F=0;F<s.length;++F)a[s[F]]=F;let h=y.length;for(;y[h-1]==="=";)--h;const g=new Uint8Array(h*r/8|0);let v=0,I=0,C=0;for(let F=0;F<h;++F){const A=a[y[F]];if(A===void 0)throw new SyntaxError(`Non-${o} character`);I=I<<r|A,v+=r,v>=8&&(v-=8,g[C++]=255&I>>v)}if(v>=r||255&I<<8-v)throw new SyntaxError("Unexpected end of data");return g},Xu=(y,s,r)=>{const o=s[s.length-1]==="=",a=(1<<r)-1;let h="",g=0,v=0;for(let I=0;I<y.length;++I)for(v=v<<8|y[I],g+=8;g>r;)g-=r,h+=s[a&v>>g];if(g&&(h+=s[a&v<<r-g]),o)for(;h.length*r&7;)h+="=";return h},xe=({name:y,prefix:s,bitsPerChar:r,alphabet:o})=>ar({prefix:s,name:y,encode(a){return Xu(a,o,r)},decode(a){return Zu(a,o,r,y)}}),eh=ar({prefix:"\0",name:"identity",encode:y=>Ju(y),decode:y=>Ku(y)});var th=Object.freeze({__proto__:null,identity:eh});const ih=xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var rh=Object.freeze({__proto__:null,base2:ih});const sh=xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var nh=Object.freeze({__proto__:null,base8:sh});const oh=Ai({prefix:"9",name:"base10",alphabet:"0123456789"});var ah=Object.freeze({__proto__:null,base10:oh});const ch=xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uh=xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var hh=Object.freeze({__proto__:null,base16:ch,base16upper:uh});const lh=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ph=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dh=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gh=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),fh=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yh=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mh=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),vh=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),wh=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var _h=Object.freeze({__proto__:null,base32:lh,base32upper:ph,base32pad:dh,base32padupper:gh,base32hex:fh,base32hexupper:yh,base32hexpad:mh,base32hexpadupper:vh,base32z:wh});const bh=Ai({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Eh=Ai({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ih=Object.freeze({__proto__:null,base36:bh,base36upper:Eh});const Ph=Ai({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Sh=Ai({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Rh=Object.freeze({__proto__:null,base58btc:Ph,base58flickr:Sh});const xh=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ch=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),qh=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Fh=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ah=Object.freeze({__proto__:null,base64:xh,base64pad:Ch,base64url:qh,base64urlpad:Fh});const Qn=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Dh=Qn.reduce((y,s,r)=>(y[r]=s,y),[]),Oh=Qn.reduce((y,s,r)=>(y[s.codePointAt(0)]=r,y),[]);function Th(y){return y.reduce((s,r)=>(s+=Dh[r],s),"")}function Nh(y){const s=[];for(const r of y){const o=Oh[r.codePointAt(0)];if(o===void 0)throw new Error(`Non-base256emoji character: ${r}`);s.push(o)}return new Uint8Array(s)}const kh=ar({prefix:"\u{1F680}",name:"base256emoji",encode:Th,decode:Nh});var $h=Object.freeze({__proto__:null,base256emoji:kh}),jh=Zn,Yn=128,Mh=127,zh=~Mh,Uh=Math.pow(2,31);function Zn(y,s,r){s=s||[],r=r||0;for(var o=r;y>=Uh;)s[r++]=y&255|Yn,y/=128;for(;y&zh;)s[r++]=y&255|Yn,y>>>=7;return s[r]=y|0,Zn.bytes=r-o+1,s}var Lh=os,Hh=128,Xn=127;function os(y,o){var r=0,o=o||0,a=0,h=o,g,v=y.length;do{if(h>=v)throw os.bytes=0,new RangeError("Could not decode varint");g=y[h++],r+=a<28?(g&Xn)<<a:(g&Xn)*Math.pow(2,a),a+=7}while(g>=Hh);return os.bytes=h-o,r}var Vh=Math.pow(2,7),Bh=Math.pow(2,14),Kh=Math.pow(2,21),Jh=Math.pow(2,28),Gh=Math.pow(2,35),Wh=Math.pow(2,42),Qh=Math.pow(2,49),Yh=Math.pow(2,56),Zh=Math.pow(2,63),Xh=function(y){return y<Vh?1:y<Bh?2:y<Kh?3:y<Jh?4:y<Gh?5:y<Wh?6:y<Qh?7:y<Yh?8:y<Zh?9:10},el={encode:jh,decode:Lh,encodingLength:Xh},eo=el;const to=(y,s,r=0)=>(eo.encode(y,s,r),s),io=y=>eo.encodingLength(y),as=(y,s)=>{const r=s.byteLength,o=io(y),a=o+io(r),h=new Uint8Array(a+r);return to(y,h,0),to(r,h,o),h.set(s,a),new tl(y,r,s,h)};class tl{constructor(s,r,o,a){this.code=s,this.size=r,this.digest=o,this.bytes=a}}const ro=({name:y,code:s,encode:r})=>new il(y,s,r);class il{constructor(s,r,o){this.name=s,this.code=r,this.encode=o}digest(s){if(s instanceof Uint8Array){const r=this.encode(s);return r instanceof Uint8Array?as(this.code,r):r.then(o=>as(this.code,o))}else throw Error("Unknown type, must be binary type")}}const so=y=>async s=>new Uint8Array(await crypto.subtle.digest(y,s)),rl=ro({name:"sha2-256",code:18,encode:so("SHA-256")}),sl=ro({name:"sha2-512",code:19,encode:so("SHA-512")});var nl=Object.freeze({__proto__:null,sha256:rl,sha512:sl});const no=0,ol="identity",oo=Gn;var al=Object.freeze({__proto__:null,identity:{code:no,name:ol,encode:oo,digest:y=>as(no,oo(y))}});new TextEncoder,new TextDecoder;const ao={...th,...rh,...nh,...ah,...hh,..._h,...Ih,...Rh,...Ah,...$h};({...nl,...al});function cl(y=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(y):new Uint8Array(y)}function co(y,s,r,o){return{name:y,prefix:s,encoder:{name:y,prefix:s,encode:r},decoder:{decode:o}}}const uo=co("utf8","u",y=>"u"+new TextDecoder("utf8").decode(y),y=>new TextEncoder().encode(y.substring(1))),cs=co("ascii","a",y=>{let s="a";for(let r=0;r<y.length;r++)s+=String.fromCharCode(y[r]);return s},y=>{y=y.substring(1);const s=cl(y.length);for(let r=0;r<y.length;r++)s[r]=y.charCodeAt(r);return s}),ul={utf8:uo,"utf-8":uo,hex:ao.base16,latin1:cs,ascii:cs,binary:cs,...ao};function hl(y,s="utf8"){const r=ul[s];if(!r)throw new Error(`Unsupported encoding "${s}"`);return(s==="utf8"||s==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(y,"utf8"):r.decoder.decode(`${r.prefix}${y}`)}const ho="wc",ll=2,us="core",kt=`${ho}@2:${us}:`,pl={name:us,logger:"error"},dl={database:":memory:"},gl="crypto",lo="client_ed25519_seed",fl=O.ONE_DAY,yl="keychain",ml="0.3",vl="messages",wl="0.3",_l=O.SIX_HOURS,bl="publisher",po="irn",El="error",go="wss://relay.walletconnect.com",fo="wss://relay.walletconnect.org",Il="relayer",ke={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Pl="_subscription",Ye={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Sl=O.ONE_SECOND,l1={database:":memory:"},Rl="2.13.3",xl=1e4,Cl="0.3",ql="WALLETCONNECT_CLIENT_ID",gt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},p1=null,Fl="subscription",Al="0.3",Dl=O.FIVE_SECONDS*1e3,Ol="pairing",Tl="0.3",d1=null,Di={wc_pairingDelete:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:O.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:O.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:O.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:O.ONE_DAY,prompt:!1,tag:0},res:{ttl:O.ONE_DAY,prompt:!1,tag:0}}},hi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},at={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Nl="history",kl="0.3",$l="expirer",Ze={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},jl="0.3",g1=null,hs="verify-api",li="https://verify.walletconnect.com",ls="https://verify.walletconnect.org",Ml=[li,ls],zl="echo",Ul="https://echo.walletconnect.com";class Ll{constructor(s,r){this.core=s,this.logger=r,this.keychain=new Map,this.name=yl,this.version=ml,this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{if(!this.initialized){const o=await this.getKeyChain();typeof o<"u"&&(this.keychain=o),this.initialized=!0}},this.has=o=>(this.isInitialized(),this.keychain.has(o)),this.set=async(o,a)=>{this.isInitialized(),this.keychain.set(o,a),await this.persist()},this.get=o=>{this.isInitialized();const a=this.keychain.get(o);if(typeof a>"u"){const{message:h}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${o}`);throw new Error(h)}return a},this.del=async o=>{this.isInitialized(),this.keychain.delete(o),await this.persist()},this.core=s,this.logger=(0,ee.Ep)(r,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(s){await this.core.storage.setItem(this.storageKey,(0,d.KCv)(s))}async getKeyChain(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?(0,d.IPd)(s):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Hl{constructor(s,r,o){this.core=s,this.logger=r,this.name=gl,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),h=or.generateKeyPair(a);return or.encodeIss(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=(0,d.Au2)();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const h=await this.getClientSeed(),g=or.generateKeyPair(h),v=(0,d.jdp)(),I=fl;return await or.signJWT(v,a,I,g)},this.generateSharedKey=(a,h,g)=>{this.isInitialized();const v=this.getPrivateKey(a),I=(0,d.m$A)(v,h);return this.setSymKey(I,g)},this.setSymKey=async(a,h)=>{this.isInitialized();const g=h||(0,d.YmJ)(a);return await this.keychain.set(g,a),g},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,h,g)=>{this.isInitialized();const v=(0,d.ENt)(g),I=(0,Jn.u)(h);if((0,d.Q8x)(v)){const N=v.senderPublicKey,M=v.receiverPublicKey;a=await this.generateSharedKey(N,M)}const C=this.getSymKey(a),{type:F,senderPublicKey:A}=v;return(0,d.HIp)({type:F,symKey:C,message:I,senderPublicKey:A})},this.decode=async(a,h,g)=>{this.isInitialized();const v=(0,d.Llj)(h,g);if((0,d.Q8x)(v)){const I=v.receiverPublicKey,C=v.senderPublicKey;a=await this.generateSharedKey(I,C)}try{const I=this.getSymKey(a),C=(0,d.peR)({symKey:I,encoded:h});return(0,Jn.D)(C)}catch(I){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(I)}},this.getPayloadType=a=>{const h=(0,d.vBi)(a);return(0,d.WGe)(h.type)},this.getPayloadSenderPublicKey=a=>{const h=(0,d.vBi)(a);return h.senderPublicKey?(0,$u.BB)(h.senderPublicKey,d.AWt):void 0},this.core=s,this.logger=(0,ee.Ep)(r,this.name),this.keychain=o||new Ll(this.core,this.logger)}get context(){return(0,ee.Fd)(this.logger)}async setPrivateKey(s,r){return await this.keychain.set(s,r),s}getPrivateKey(s){return this.keychain.get(s)}async getClientSeed(){let s="";try{s=this.keychain.get(lo)}catch{s=(0,d.jdp)(),await this.keychain.set(lo,s)}return hl(s,"base16")}getSymKey(s){return this.keychain.get(s)}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Vl extends xu{constructor(s,r){super(s,r),this.logger=s,this.core=r,this.messages=new Map,this.name=vl,this.version=wl,this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const o=await this.getRelayerMessages();typeof o<"u"&&(this.messages=o),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(o){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(o)}finally{this.initialized=!0}}},this.set=async(o,a)=>{this.isInitialized();const h=(0,d.rjm)(a);let g=this.messages.get(o);return typeof g>"u"&&(g={}),typeof g[h]<"u"||(g[h]=a,this.messages.set(o,g),await this.persist()),h},this.get=o=>{this.isInitialized();let a=this.messages.get(o);return typeof a>"u"&&(a={}),a},this.has=(o,a)=>{this.isInitialized();const h=this.get(o),g=(0,d.rjm)(a);return typeof h[g]<"u"},this.del=async o=>{this.isInitialized(),this.messages.delete(o),await this.persist()},this.logger=(0,ee.Ep)(s,this.name),this.core=r}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(s){await this.core.storage.setItem(this.storageKey,(0,d.KCv)(s))}async getRelayerMessages(){const s=await this.core.storage.getItem(this.storageKey);return typeof s<"u"?(0,d.IPd)(s):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class Bl extends Cu{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.events=new Nt.EventEmitter,this.name=bl,this.queue=new Map,this.publishTimeout=(0,O.toMiliseconds)(O.ONE_MINUTE),this.failedPublishTimeout=(0,O.toMiliseconds)(O.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(o,a,h)=>{var g;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:h}});const v=(h==null?void 0:h.ttl)||_l,I=(0,d._HE)(h),C=(h==null?void 0:h.prompt)||!1,F=(h==null?void 0:h.tag)||0,A=(h==null?void 0:h.id)||(0,L.getBigIntRpcId)().toString(),N={topic:o,message:a,opts:{ttl:v,relay:I,prompt:C,tag:F,id:A}},M=`Failed to publish payload, please try again. id:${A} tag:${F}`,k=Date.now();let H,K=1;try{for(;H===void 0;){if(Date.now()-k>this.publishTimeout)throw new Error(M);this.logger.trace({id:A,attempts:K},`publisher.publish - attempt ${K}`),H=await await(0,d.hFY)(this.rpcPublish(o,a,v,I,C,F,A).catch(Y=>this.logger.warn(Y)),this.publishTimeout,M),K++,H||await new Promise(Y=>setTimeout(Y,this.failedPublishTimeout))}this.relayer.events.emit(ke.publish,N),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:A,topic:o,message:a,opts:h}})}catch(Y){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(Y),(g=h==null?void 0:h.internal)!=null&&g.throwOnFailedPublish)throw Y;this.queue.set(A,N)}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.relayer=s,this.logger=(0,ee.Ep)(r,this.name),this.registerEventListeners()}get context(){return(0,ee.Fd)(this.logger)}rpcPublish(s,r,o,a,h,g,v){var I,C,F,A;const N={method:(0,d.cOS)(a.protocol).publish,params:{topic:s,message:r,ttl:o,prompt:h,tag:g},id:v};return(0,d.o8e)((I=N.params)==null?void 0:I.prompt)&&((C=N.params)==null||delete C.prompt),(0,d.o8e)((F=N.params)==null?void 0:F.tag)&&((A=N.params)==null||delete A.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}removeRequestFromQueue(s){this.queue.delete(s)}checkQueue(){this.queue.forEach(async s=>{const{topic:r,message:o,opts:a}=s;await this.publish(r,o,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Fi.Lx.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ke.connection_stalled);return}this.checkQueue()}),this.relayer.on(ke.message_ack,s=>{this.removeRequestFromQueue(s.id.toString())})}}class Kl{constructor(){this.map=new Map,this.set=(s,r)=>{const o=this.get(s);this.exists(s,r)||this.map.set(s,[...o,r])},this.get=s=>this.map.get(s)||[],this.exists=(s,r)=>this.get(s).includes(r),this.delete=(s,r)=>{if(typeof r>"u"){this.map.delete(s);return}if(!this.map.has(s))return;const o=this.get(s);if(!this.exists(s,r))return;const a=o.filter(h=>h!==r);if(!a.length){this.map.delete(s);return}this.map.set(s,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Jl=Object.defineProperty,Gl=Object.defineProperties,Wl=Object.getOwnPropertyDescriptors,yo=Object.getOwnPropertySymbols,Ql=Object.prototype.hasOwnProperty,Yl=Object.prototype.propertyIsEnumerable,mo=(y,s,r)=>s in y?Jl(y,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[s]=r,Oi=(y,s)=>{for(var r in s||(s={}))Ql.call(s,r)&&mo(y,r,s[r]);if(yo)for(var r of yo(s))Yl.call(s,r)&&mo(y,r,s[r]);return y},ps=(y,s)=>Gl(y,Wl(s));class Zl extends Au{constructor(s,r){super(s,r),this.relayer=s,this.logger=r,this.subscriptions=new Map,this.topicMap=new Kl,this.events=new Nt.EventEmitter,this.name=Fl,this.version=Al,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=kt,this.subscribeTimeout=(0,O.toMiliseconds)(O.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.pendingBatchMessages=[],this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const h=(0,d._HE)(a),g={topic:o,relay:h};this.pending.set(o,g);const v=await this.rpcSubscribe(o,h);return typeof v=="string"&&(this.onSubscribe(v,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}})),v}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(o,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(o,a.id,a):await this.unsubscribeByTopic(o,a)},this.isSubscribed=async o=>{if(this.topics.includes(o))return!0;const a=`${this.pendingSubscriptionWatchLabel}_${o}`;return await new Promise((h,g)=>{const v=new O.Watch;v.start(a);const I=setInterval(()=>{!this.pending.has(o)&&this.topics.includes(o)&&(clearInterval(I),v.stop(a),h(!0)),v.elapsed(a)>=Dl&&(clearInterval(I),v.stop(a),g(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=s,this.logger=(0,ee.Ep)(r,this.name),this.clientId=""}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(s,r){let o=!1;try{o=this.getSubscription(s).topic===r}catch{}return o}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(s,r){const o=this.topicMap.get(s);await Promise.all(o.map(async a=>await this.unsubscribeById(s,a,r)))}async unsubscribeById(s,r,o){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}});try{const a=(0,d._HE)(o);await this.rpcUnsubscribe(s,r,a);const h=(0,d.D6H)("USER_DISCONNECTED",`${this.name}, ${s}`);await this.onUnsubscribe(s,r,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:s,id:r,opts:o}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(s,r){const o={method:(0,d.cOS)(r.protocol).subscribe,params:{topic:s}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await(0,d.hFY)(this.relayer.request(o).catch(a=>this.logger.warn(a)),this.subscribeTimeout)?(0,d.rjm)(s+this.clientId):null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ke.connection_stalled)}return null}async rpcBatchSubscribe(s){if(!s.length)return;const r=s[0].relay,o={method:(0,d.cOS)(r.protocol).batchSubscribe,params:{topics:s.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});try{return await await(0,d.hFY)(this.relayer.request(o).catch(a=>this.logger.warn(a)),this.subscribeTimeout)}catch{this.relayer.events.emit(ke.connection_stalled)}}async rpcBatchFetchMessages(s){if(!s.length)return;const r=s[0].relay,o={method:(0,d.cOS)(r.protocol).batchFetchMessages,params:{topics:s.map(h=>h.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});let a;try{a=await await(0,d.hFY)(this.relayer.request(o).catch(h=>this.logger.warn(h)),this.subscribeTimeout)}catch{this.relayer.events.emit(ke.connection_stalled)}return a}rpcUnsubscribe(s,r,o){const a={method:(0,d.cOS)(o.protocol).unsubscribe,params:{topic:s,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(s,r){this.setSubscription(s,ps(Oi({},r),{id:s})),this.pending.delete(r.topic)}onBatchSubscribe(s){s.length&&s.forEach(r=>{this.setSubscription(r.id,Oi({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(s,r,o){this.events.removeAllListeners(r),this.hasSubscription(r,s)&&this.deleteSubscription(r,o),await this.relayer.messages.del(s)}async setRelayerSubscriptions(s){await this.relayer.core.storage.setItem(this.storageKey,s)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(s,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:s,subscription:r}),this.addSubscription(s,r)}addSubscription(s,r){this.subscriptions.set(s,Oi({},r)),this.topicMap.set(r.topic,s),this.events.emit(gt.created,r)}getSubscription(s){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:s});const r=this.subscriptions.get(s);if(!r){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}deleteSubscription(s,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:s,reason:r});const o=this.getSubscription(s);this.subscriptions.delete(s),this.topicMap.delete(o.topic,s),this.events.emit(gt.deleted,ps(Oi({},o),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(gt.sync)}async reset(){if(this.cached.length){const s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<s;r++){const o=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchFetchMessages(o),await this.batchSubscribe(o)}}this.events.emit(gt.resubscribed)}async restore(){try{const s=await this.getRelayerSubscriptions();if(typeof s>"u"||!s.length)return;if(this.subscriptions.size){const{message:r}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(s){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(s)}}async batchSubscribe(s){if(!s.length)return;const r=await this.rpcBatchSubscribe(s);(0,d.qt8)(r)&&this.onBatchSubscribe(r.map((o,a)=>ps(Oi({},s[a]),{id:o})))}async batchFetchMessages(s){if(!s.length)return;this.logger.trace(`Fetching batch messages for ${s.length} subscriptions`);const r=await this.rpcBatchFetchMessages(s);r&&r.messages&&(this.pendingBatchMessages=this.pendingBatchMessages.concat(r.messages))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const s=[];this.pending.forEach(r=>{s.push(r)}),await this.batchSubscribe(s),this.pendingBatchMessages.length&&(await this.relayer.handleBatchMessageEvents(this.pendingBatchMessages),this.pendingBatchMessages=[])}registerEventListeners(){this.relayer.core.heartbeat.on(Fi.Lx.pulse,async()=>{await this.checkPending()}),this.events.on(gt.created,async s=>{const r=gt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()}),this.events.on(gt.deleted,async s=>{const r=gt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}async restartToComplete(){this.restartInProgress&&await new Promise(s=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),s())},this.pollingInterval)})}}var Xl=Object.defineProperty,vo=Object.getOwnPropertySymbols,ep=Object.prototype.hasOwnProperty,tp=Object.prototype.propertyIsEnumerable,wo=(y,s,r)=>s in y?Xl(y,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[s]=r,ip=(y,s)=>{for(var r in s||(s={}))ep.call(s,r)&&wo(y,r,s[r]);if(vo)for(var r of vo(s))tp.call(s,r)&&wo(y,r,s[r]);return y};class rp extends qu{constructor(s){super(s),this.protocol="wc",this.version=2,this.events=new Nt.EventEmitter,this.name=Il,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=(0,O.toMiliseconds)(O.THIRTY_SECONDS+O.ONE_SECOND),this.request=async r=>{var o,a;this.logger.debug("Publishing Request Payload");const h=r.id||(0,L.getBigIntRpcId)().toString();await this.toEstablishConnection();try{const g=this.provider.request(r);this.requestsInFlight.set(h,{promise:g,request:r}),this.logger.trace({id:h,method:r.method,topic:(o=r.params)==null?void 0:o.topic},"relayer.request - attempt to publish...");const v=await new Promise(async(I,C)=>{const F=()=>{C(new Error(`relayer.request - publish interrupted, id: ${h}`))};this.provider.on(Ye.disconnect,F);const A=await g;this.provider.off(Ye.disconnect,F),I(A)});return this.logger.trace({id:h,method:r.method,topic:(a=r.params)==null?void 0:a.topic},"relayer.request - published"),v}catch(g){throw this.logger.debug(`Failed to Publish Request: ${h}`),g}finally{this.requestsInFlight.delete(h)}},this.resetPingTimeout=()=>{if((0,d.UGU)())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,o,a;(a=(o=(r=this.provider)==null?void 0:r.connection)==null?void 0:o.socket)==null||a.terminate()},this.heartBeatTimeout)}catch(r){this.logger.warn(r)}},this.onPayloadHandler=r=>{this.onProviderPayload(r),this.resetPingTimeout()},this.onConnectHandler=()=>{this.startPingTimeout(),this.events.emit(ke.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(ke.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Ye.payload,this.onPayloadHandler),this.provider.on(Ye.connect,this.onConnectHandler),this.provider.on(Ye.disconnect,this.onDisconnectHandler),this.provider.on(Ye.error,this.onProviderErrorHandler)},this.core=s.core,this.logger=typeof s.logger<"u"&&typeof s.logger!="string"?(0,ee.Ep)(s.logger,this.name):(0,ee.gw)((0,ee.jI)({level:s.logger||El})),this.messages=new Vl(this.logger,s.core),this.subscriber=new Zl(this,this.logger),this.publisher=new Bl(this,this.logger),this.relayUrl=(s==null?void 0:s.relayUrl)||go,this.projectId=s.projectId,this.bundleId=(0,d.X_B)(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${fo}...`),await this.restartTransport(fo)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&this.subscriber.pending.size===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},xl)}get context(){return(0,ee.Fd)(this.logger)}get connected(){var s,r,o;return((o=(r=(s=this.provider)==null?void 0:s.connection)==null?void 0:r.socket)==null?void 0:o.readyState)===1}get connecting(){var s,r,o;return((o=(r=(s=this.provider)==null?void 0:s.connection)==null?void 0:r.socket)==null?void 0:o.readyState)===0}async publish(s,r,o){this.isInitialized(),await this.publisher.publish(s,r,o),await this.recordMessageEvent({topic:s,message:r,publishedAt:Date.now()})}async subscribe(s,r){var o;this.isInitialized();let a=((o=this.subscriber.topicMap.get(s))==null?void 0:o[0])||"",h;const g=v=>{v.topic===s&&(this.subscriber.off(gt.created,g),h())};return await Promise.all([new Promise(v=>{h=v,this.subscriber.on(gt.created,g)}),new Promise(async v=>{a=await this.subscriber.subscribe(s,r)||a,v()})]),a}async unsubscribe(s,r){this.isInitialized(),await this.subscriber.unsubscribe(s,r)}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}off(s,r){this.events.off(s,r)}removeListener(s,r){this.events.removeListener(s,r)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(s=>s.promise))}catch(s){this.logger.warn(s)}this.hasExperiencedNetworkDisruption||this.connected?await(0,d.hFY)(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(s){await this.confirmOnlineStateOrThrow(),s&&s!==this.relayUrl&&(this.relayUrl=s,await this.transportDisconnect()),await this.createProvider(),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(r,o)=>{const a=()=>{this.provider.off(Ye.disconnect,a),o(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(Ye.disconnect,a),await(0,d.hFY)(this.provider.connect(),(0,O.toMiliseconds)(O.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(h=>{o(h)}),await this.subscriber.start(),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){this.logger.error(r);const o=r;if(this.hasExperiencedNetworkDisruption=!0,!this.isConnectionStalled(o.message))throw r}finally{this.connectionAttemptInProgress=!1}}async restartTransport(s){this.connectionAttemptInProgress||(this.relayUrl=s||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await(0,d.Ggh)())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(s){if((s==null?void 0:s.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=s.sort((o,a)=>o.publishedAt-a.publishedAt);this.logger.trace(`Batch of ${r.length} message events sorted`);for(const o of r)try{await this.onMessageEvent(o)}catch(a){this.logger.warn(a)}this.logger.trace(`Batch of ${r.length} message events processed`)}startPingTimeout(){var s,r,o,a,h;if((0,d.UGU)())try{(r=(s=this.provider)==null?void 0:s.connection)!=null&&r.socket&&((h=(a=(o=this.provider)==null?void 0:o.connection)==null?void 0:a.socket)==null||h.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(g){this.logger.warn(g)}}isConnectionStalled(s){return this.staleConnectionErrors.some(r=>s.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const s=await this.core.crypto.signJWT(this.relayUrl);this.provider=new It.r(new ju.Z((0,d.$0m)({sdkVersion:Rl,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:s,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(s){const{topic:r,message:o}=s;await this.messages.set(r,o)}async shouldIgnoreMessageEvent(s){const{topic:r,message:o}=s;if(!o||o.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${o}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,o);return a&&this.logger.debug(`Ignoring duplicate message: ${o}`),a}async onProviderPayload(s){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:s}),(0,L.isJsonRpcRequest)(s)){if(!s.method.endsWith(Pl))return;const r=s.params,{topic:o,message:a,publishedAt:h}=r.data,g={topic:o,message:a,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ip({type:"event",event:r.id},g)),this.events.emit(r.id,g),await this.acknowledgePayload(s),await this.onMessageEvent(g)}else(0,L.isJsonRpcResponse)(s)&&this.events.emit(ke.message_ack,s)}async onMessageEvent(s){await this.shouldIgnoreMessageEvent(s)||(this.events.emit(ke.message,s),await this.recordMessageEvent(s))}async acknowledgePayload(s){const r=(0,L.formatJsonRpcResult)(s.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Ye.payload,this.onPayloadHandler),this.provider.off(Ye.connect,this.onConnectHandler),this.provider.off(Ye.disconnect,this.onDisconnectHandler),this.provider.off(Ye.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let s=await(0,d.Ggh)();(0,d.uwg)(async r=>{s!==r&&(s=r,r?await this.restartTransport().catch(o=>this.logger.error(o)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.requestsInFlight.clear(),clearTimeout(this.pingTimeout),this.events.emit(ke.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&setTimeout(async()=>{await this.transportOpen().catch(s=>this.logger.error(s))},(0,O.toMiliseconds)(Sl))}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(s=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),s())},this.connectionStatusPollingInterval)}),await this.transportOpen())}}var sp=Object.defineProperty,_o=Object.getOwnPropertySymbols,np=Object.prototype.hasOwnProperty,op=Object.prototype.propertyIsEnumerable,bo=(y,s,r)=>s in y?sp(y,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[s]=r,Eo=(y,s)=>{for(var r in s||(s={}))np.call(s,r)&&bo(y,r,s[r]);if(_o)for(var r of _o(s))op.call(s,r)&&bo(y,r,s[r]);return y};class Wt extends Fu{constructor(s,r,o,a=kt,h=void 0){super(s,r,o,a),this.core=s,this.logger=r,this.name=o,this.map=new Map,this.version=Cl,this.cached=[],this.initialized=!1,this.storagePrefix=kt,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!(0,d.o8e)(g)?this.map.set(this.getKey(g),g):(0,d.xWS)(g)?this.map.set(g.id,g):(0,d.h1R)(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,v)=>{this.isInitialized(),this.map.has(g)?await this.update(g,v):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:v}),this.map.set(g,v),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(v=>Object.keys(g).every(I=>zu()(v[I],g[I]))):this.values),this.update=async(g,v)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:v});const I=Eo(Eo({},this.getData(g)),v);this.map.set(g,I),await this.persist()},this.delete=async(g,v)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:v}),this.map.delete(g),this.addToRecentlyDeleted(g),await this.persist())},this.logger=(0,ee.Ep)(r,this.name),this.storagePrefix=a,this.getKey=h}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(s){this.recentlyDeleted.push(s),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(s){await this.core.storage.setItem(this.storageKey,s)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(s){const r=this.map.get(s);if(!r){if(this.recentlyDeleted.includes(s)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${s}`);throw this.logger.error(a),new Error(a)}const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.error(o),new Error(o)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const s=await this.getDataStore();if(typeof s>"u"||!s.length)return;if(this.map.size){const{message:r}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(s){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(s)}}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class ap{constructor(s,r){this.core=s,this.logger=r,this.name=Ol,this.version=Tl,this.events=new(ns()),this.initialized=!1,this.storagePrefix=kt,this.ignoredPayloadTypes=[d.rVF],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:o})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...o])]},this.create=async o=>{this.isInitialized();const a=(0,d.jdp)(),h=await this.core.crypto.setSymKey(a),g=(0,d.gn4)(O.FIVE_MINUTES),v={protocol:po},I={topic:h,expiry:g,relay:v,active:!1},C=(0,d.Bvr)({protocol:this.core.protocol,version:this.core.version,topic:h,symKey:a,relay:v,expiryTimestamp:g,methods:o==null?void 0:o.methods});return this.core.expirer.set(h,g),await this.pairings.set(h,I),await this.core.relayer.subscribe(h),{topic:h,uri:C}},this.pair=async o=>{this.isInitialized(),this.isValidPair(o);const{topic:a,symKey:h,relay:g,expiryTimestamp:v,methods:I}=(0,d.heJ)(o.uri);let C;if(this.pairings.keys.includes(a)&&(C=this.pairings.get(a),C.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const F=v||(0,d.gn4)(O.FIVE_MINUTES),A={topic:a,relay:g,expiry:F,active:!1,methods:I};return this.core.expirer.set(a,F),await this.pairings.set(a,A),o.activatePairing&&await this.activate({topic:a}),this.events.emit(hi.create,A),this.core.crypto.keychain.has(a)||await this.core.crypto.setSymKey(h,a),await this.core.relayer.subscribe(a,{relay:g}),A},this.activate=async({topic:o})=>{this.isInitialized();const a=(0,d.gn4)(O.THIRTY_DAYS);this.core.expirer.set(o,a),await this.pairings.update(o,{active:!0,expiry:a})},this.ping=async o=>{this.isInitialized(),await this.isValidPing(o);const{topic:a}=o;if(this.pairings.keys.includes(a)){const h=await this.sendRequest(a,"wc_pairingPing",{}),{done:g,resolve:v,reject:I}=(0,d.H1S)();this.events.once((0,d.E0T)("pairing_ping",h),({error:C})=>{C?I(C):v()}),await g()}},this.updateExpiry=async({topic:o,expiry:a})=>{this.isInitialized(),await this.pairings.update(o,{expiry:a})},this.updateMetadata=async({topic:o,metadata:a})=>{this.isInitialized(),await this.pairings.update(o,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async o=>{this.isInitialized(),await this.isValidDisconnect(o);const{topic:a}=o;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",(0,d.D6H)("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(o,a,h)=>{const g=(0,L.formatJsonRpcRequest)(a,h),v=await this.core.crypto.encode(o,g),I=Di[a].req;return this.core.history.set(o,g),this.core.relayer.publish(o,v,I),g.id},this.sendResult=async(o,a,h)=>{const g=(0,L.formatJsonRpcResult)(o,h),v=await this.core.crypto.encode(a,g),I=await this.core.history.get(a,o),C=Di[I.request.method].res;await this.core.relayer.publish(a,v,C),await this.core.history.resolve(g)},this.sendError=async(o,a,h)=>{const g=(0,L.formatJsonRpcError)(o,h),v=await this.core.crypto.encode(a,g),I=await this.core.history.get(a,o),C=Di[I.request.method]?Di[I.request.method].res:Di.unregistered_method.res;await this.core.relayer.publish(a,v,C),await this.core.history.resolve(g)},this.deletePairing=async(o,a)=>{await this.core.relayer.unsubscribe(o),await Promise.all([this.pairings.delete(o,(0,d.D6H)("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(o),a?Promise.resolve():this.core.expirer.del(o)])},this.cleanup=async()=>{const o=this.pairings.getAll().filter(a=>(0,d.BwD)(a.expiry));await Promise.all(o.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=o=>{const{topic:a,payload:h}=o;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(a,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,h);default:return this.onUnknownRpcMethodRequest(a,h)}},this.onRelayEventResponse=async o=>{const{topic:a,payload:h}=o,g=(await this.core.history.get(a,h.id)).request.method;switch(g){case"wc_pairingPing":return this.onPairingPingResponse(a,h);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(o,a)=>{const{id:h}=a;try{this.isValidPing({topic:o}),await this.sendResult(h,o,!0),this.events.emit(hi.ping,{id:h,topic:o})}catch(g){await this.sendError(h,o,g),this.logger.error(g)}},this.onPairingPingResponse=(o,a)=>{const{id:h}=a;setTimeout(()=>{(0,L.isJsonRpcResult)(a)?this.events.emit((0,d.E0T)("pairing_ping",h),{}):(0,L.isJsonRpcError)(a)&&this.events.emit((0,d.E0T)("pairing_ping",h),{error:a.error})},500)},this.onPairingDeleteRequest=async(o,a)=>{const{id:h}=a;try{this.isValidDisconnect({topic:o}),await this.deletePairing(o),this.events.emit(hi.delete,{id:h,topic:o})}catch(g){await this.sendError(h,o,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(o,a)=>{const{id:h,method:g}=a;try{if(this.registeredMethods.includes(g))return;const v=(0,d.D6H)("WC_METHOD_UNSUPPORTED",g);await this.sendError(h,o,v),this.logger.error(v)}catch(v){await this.sendError(h,o,v),this.logger.error(v)}},this.onUnknownRpcMethodResponse=o=>{this.registeredMethods.includes(o)||this.logger.error((0,d.D6H)("WC_METHOD_UNSUPPORTED",o))},this.isValidPair=o=>{var a;if(!(0,d.EJd)(o)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`pair() params: ${o}`);throw new Error(g)}if(!(0,d.jvJ)(o.uri)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`pair() uri: ${o.uri}`);throw new Error(g)}const h=(0,d.heJ)(o.uri);if(!((a=h==null?void 0:h.relay)!=null&&a.protocol)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(g)}if(!(h!=null&&h.symKey)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(g)}if(h!=null&&h.expiryTimestamp&&(0,O.toMiliseconds)(h==null?void 0:h.expiryTimestamp)<Date.now()){const{message:g}=(0,d.kCb)("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(g)}},this.isValidPing=async o=>{if(!(0,d.EJd)(o)){const{message:h}=(0,d.kCb)("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(h)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidDisconnect=async o=>{if(!(0,d.EJd)(o)){const{message:h}=(0,d.kCb)("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(h)}const{topic:a}=o;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async o=>{if(!(0,d.M_r)(o,!1)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!this.pairings.keys.includes(o)){const{message:a}=(0,d.kCb)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if((0,d.BwD)(this.pairings.get(o).expiry)){await this.deletePairing(o);const{message:a}=(0,d.kCb)("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}},this.core=s,this.logger=(0,ee.Ep)(r,this.name),this.pairings=new Wt(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,ee.Fd)(this.logger)}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}registerRelayerEvents(){this.core.relayer.on(ke.message,async s=>{const{topic:r,message:o}=s;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(o)))return;const a=await this.core.crypto.decode(r,o);try{(0,L.isJsonRpcRequest)(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):(0,L.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Ze.expired,async s=>{const{topic:r}=(0,d.iPz)(s.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(hi.expire,{topic:r}))})}}class cp extends Ru{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.records=new Map,this.events=new Nt.EventEmitter,this.name=Nl,this.version=kl,this.cached=[],this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.records.set(o.id,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(o,a,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:o,request:a,chainId:h}),this.records.has(a.id))return;const g={id:a.id,topic:o,request:{method:a.method,params:a.params||null},chainId:h,expiry:(0,d.gn4)(O.THIRTY_DAYS)};this.records.set(g.id,g),this.persist(),this.events.emit(at.created,g)},this.resolve=async o=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:o}),!this.records.has(o.id))return;const a=await this.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,L.isJsonRpcError)(o)?{error:o.error}:{result:o.result},this.records.set(a.id,a),this.persist(),this.events.emit(at.updated,a))},this.get=async(o,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:o,id:a}),await this.getRecord(a)),this.delete=(o,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(h=>{if(h.topic===o){if(typeof a<"u"&&h.id!==a)return;this.records.delete(h.id),this.events.emit(at.deleted,h)}}),this.persist()},this.exists=async(o,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===o:!1),this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,ee.Ep)(r,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const s=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const o={topic:r.topic,request:(0,L.formatJsonRpcRequest)(r.request.method,r.request.params,r.id),chainId:r.chainId};return s.push(o)}),s}async setJsonRpcRecords(s){await this.core.storage.setItem(this.storageKey,s)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(s){this.isInitialized();const r=this.records.get(s);if(!r){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(o)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(at.sync)}async restore(){try{const s=await this.getJsonRpcRecords();if(typeof s>"u"||!s.length)return;if(this.records.size){const{message:r}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}}registerEventListeners(){this.events.on(at.created,s=>{const r=at.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s})}),this.events.on(at.updated,s=>{const r=at.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s})}),this.events.on(at.deleted,s=>{const r=at.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:s})}),this.core.heartbeat.on(Fi.Lx.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let s=!1;this.records.forEach(r=>{(0,O.toMiliseconds)(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(at.deleted,r,!1),s=!0)}),s&&this.persist()}catch(s){this.logger.warn(s)}}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class up extends Du{constructor(s,r){super(s,r),this.core=s,this.logger=r,this.expirations=new Map,this.events=new Nt.EventEmitter,this.name=$l,this.version=jl,this.cached=[],this.initialized=!1,this.storagePrefix=kt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>this.expirations.set(o.target,o)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=o=>{try{const a=this.formatTarget(o);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(o,a)=>{this.isInitialized();const h=this.formatTarget(o),g={target:h,expiry:a};this.expirations.set(h,g),this.checkExpiry(h,g),this.events.emit(Ze.created,{target:h,expiration:g})},this.get=o=>{this.isInitialized();const a=this.formatTarget(o);return this.getExpiration(a)},this.del=o=>{if(this.isInitialized(),this.has(o)){const a=this.formatTarget(o),h=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ze.deleted,{target:a,expiration:h})}},this.on=(o,a)=>{this.events.on(o,a)},this.once=(o,a)=>{this.events.once(o,a)},this.off=(o,a)=>{this.events.off(o,a)},this.removeListener=(o,a)=>{this.events.removeListener(o,a)},this.logger=(0,ee.Ep)(r,this.name)}get context(){return(0,ee.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(s){if(typeof s=="string")return(0,d.Z42)(s);if(typeof s=="number")return(0,d.GqV)(s);const{message:r}=(0,d.kCb)("UNKNOWN_TYPE",`Target type: ${typeof s}`);throw new Error(r)}async setExpirations(s){await this.core.storage.setItem(this.storageKey,s)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ze.sync)}async restore(){try{const s=await this.getExpirations();if(typeof s>"u"||!s.length)return;if(this.expirations.size){const{message:r}=(0,d.kCb)("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=s,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(s){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(s)}}getExpiration(s){const r=this.expirations.get(s);if(!r){const{message:o}=(0,d.kCb)("NO_MATCHING_KEY",`${this.name}: ${s}`);throw this.logger.warn(o),new Error(o)}return r}checkExpiry(s,r){const{expiry:o}=r;(0,O.toMiliseconds)(o)-Date.now()<=0&&this.expire(s,r)}expire(s,r){this.expirations.delete(s),this.events.emit(Ze.expired,{target:s,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((s,r)=>this.checkExpiry(r,s))}registerEventListeners(){this.core.heartbeat.on(Fi.Lx.pulse,()=>this.checkExpirations()),this.events.on(Ze.created,s=>{const r=Ze.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(Ze.expired,s=>{const r=Ze.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()}),this.events.on(Ze.deleted,s=>{const r=Ze.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),this.persist()})}isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}}}class hp extends Ou{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.name=hs,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async o=>{if(this.verifyDisabled||(0,d.b$m)()||!(0,d.jUY)())return;const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ls;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async o=>{this.initialized?this.sendPost(o.attestationId):(this.addToQueue(o.attestationId),await this.init())},this.resolve=async o=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(o==null?void 0:o.verifyUrl);let h;try{h=await this.fetchAttestation(o.attestationId,a)}catch(g){this.logger.info(`failed to resolve attestation: ${o.attestationId} from url: ${a}`),this.logger.info(g),h=await this.fetchAttestation(o.attestationId,ls)}return h},this.fetchAttestation=async(o,a)=>{this.logger.info(`resolving attestation: ${o} from url: ${a}`);const h=this.startAbortTimer(O.ONE_SECOND*2),g=await fetch(`${a}/attestation/${o}`,{signal:this.abortController.signal});return clearTimeout(h),g.status===200?await g.json():void 0},this.addToQueue=o=>{this.queue.push(o)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(o=>this.sendPost(o)),this.queue=[])},this.sendPost=o=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(o,"*"),this.logger.info(`postMessage sent: ${o} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let o;const a=h=>{h.data==="verify_ready"&&(this.onInit(),window.removeEventListener("message",a),o())};await Promise.race([new Promise(h=>{const g=document.getElementById(hs);if(g)return this.iframe=g,this.onInit(),h();window.addEventListener("message",a);const v=document.createElement("iframe");v.id=hs,v.src=`${this.verifyUrl}/${this.projectId}`,v.style.display="none",document.body.append(v),this.iframe=v,o=h}),new Promise((h,g)=>setTimeout(()=>{window.removeEventListener("message",a),g("verify iframe load timeout")},(0,O.toMiliseconds)(O.FIVE_SECONDS)))])},this.onInit=()=>{this.initialized=!0,this.processQueue()},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=o=>{let a=o||li;return Ml.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${li}`),a=li),a},this.logger=(0,ee.Ep)(r,this.name),this.verifyUrl=li,this.abortController=new AbortController,this.isDevEnv=(0,d.UGU)()&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.IS_VITEST}get context(){return(0,ee.Fd)(this.logger)}startAbortTimer(s){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,O.toMiliseconds)(s))}}class lp extends Tu{constructor(s,r){super(s,r),this.projectId=s,this.logger=r,this.context=zl,this.registerDeviceToken=async o=>{const{clientId:a,token:h,notificationType:g,enableEncrypted:v=!1}=o,I=`${Ul}/${this.projectId}/clients`;await Lu()(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:g,token:h,always_raw:v})})},this.logger=(0,ee.Ep)(r,this.context)}}var pp=Object.defineProperty,Io=Object.getOwnPropertySymbols,dp=Object.prototype.hasOwnProperty,gp=Object.prototype.propertyIsEnumerable,Po=(y,s,r)=>s in y?pp(y,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[s]=r,So=(y,s)=>{for(var r in s||(s={}))dp.call(s,r)&&Po(y,r,s[r]);if(Io)for(var r of Io(s))gp.call(s,r)&&Po(y,r,s[r]);return y};class ds extends Su{constructor(s){var r;super(s),this.protocol=ho,this.version=ll,this.name=us,this.events=new Nt.EventEmitter,this.initialized=!1,this.on=(g,v)=>this.events.on(g,v),this.once=(g,v)=>this.events.once(g,v),this.off=(g,v)=>this.events.off(g,v),this.removeListener=(g,v)=>this.events.removeListener(g,v),this.projectId=s==null?void 0:s.projectId,this.relayUrl=(s==null?void 0:s.relayUrl)||go,this.customStoragePrefix=s!=null&&s.customStoragePrefix?`:${s.customStoragePrefix}`:"";const o=(0,ee.jI)({level:typeof(s==null?void 0:s.logger)=="string"&&s.logger?s.logger:pl.logger}),{logger:a,chunkLoggerController:h}=(0,ee.Rt)({opts:o,maxSizeInBytes:s==null?void 0:s.maxLogBlobSizeInBytes,loggerOverride:s==null?void 0:s.logger});this.logChunkController=h,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var g,v;(g=this.logChunkController)!=null&&g.downloadLogsBlobInBrowser&&((v=this.logChunkController)==null||v.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,ee.Ep)(a,this.name),this.heartbeat=new Fi.C$,this.crypto=new Hl(this,this.logger,s==null?void 0:s.keychain),this.history=new cp(this,this.logger),this.expirer=new up(this,this.logger),this.storage=s!=null&&s.storage?s.storage:new Pu.Z(So(So({},dl),s==null?void 0:s.storageOptions)),this.relayer=new rp({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ap(this,this.logger),this.verify=new hp(this.projectId||"",this.logger),this.echoClient=new lp(this.projectId||"",this.logger)}static async init(s){const r=new ds(s);await r.initialize();const o=await r.crypto.getClientId();return await r.storage.setItem(ql,o),r}get context(){return(0,ee.Fd)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var s;return(s=this.logChunkController)==null?void 0:s.logsToBlob({clientId:await this.crypto.getClientId()})}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(s){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,s),this.logger.error(s.message),s}}}const fp=ds,Ro="wc",xo=2,Co="client",gs=`${Ro}@${xo}:${Co}:`,fs={name:Co,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},f1={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire"},y1={database:":memory:"},qo="WALLETCONNECT_DEEPLINK_CHOICE",m1={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},v1="history",w1="0.3",yp="proposal",_1=null,Fo="Proposal expired",mp="session",pi=O.SEVEN_DAYS,vp="engine",Ce={wc_sessionPropose:{req:{ttl:O.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1104},res:{ttl:O.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1106},res:{ttl:O.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:O.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:O.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1112},res:{ttl:O.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1114},res:{ttl:O.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:O.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:O.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1119}}},ys={min:O.FIVE_MINUTES,max:O.SEVEN_DAYS},ft={idle:"IDLE",active:"ACTIVE"},wp="request",_p=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"],bp="wc",b1=1.5,Ep="auth",Ip="authKeys",Pp="pairingTopics",Sp="requests",cr=`${bp}@${1.5}:${Ep}:`,ur=`${cr}:PUB_KEY`;var Rp=Object.defineProperty,xp=Object.defineProperties,Cp=Object.getOwnPropertyDescriptors,Ao=Object.getOwnPropertySymbols,qp=Object.prototype.hasOwnProperty,Fp=Object.prototype.propertyIsEnumerable,Do=(y,s,r)=>s in y?Rp(y,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[s]=r,be=(y,s)=>{for(var r in s||(s={}))qp.call(s,r)&&Do(y,r,s[r]);if(Ao)for(var r of Ao(s))Fp.call(s,r)&&Do(y,r,s[r]);return y},Qt=(y,s)=>xp(y,Cp(s));class Ap extends ku{constructor(s){super(s),this.name=vp,this.events=new(ns()),this.initialized=!1,this.requestQueue={state:ft.idle,queue:[]},this.sessionRequestQueue={state:ft.idle,queue:[]},this.requestQueueDelay=O.ONE_SECOND,this.expectedPairingMethodMap=new Map,this.recentlyDeletedMap=new Map,this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ce)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,O.toMiliseconds)(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const o=Qt(be({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(o);const{pairingTopic:a,requiredNamespaces:h,optionalNamespaces:g,sessionProperties:v,relays:I}=o;let C=a,F,A=!1;try{C&&(A=this.client.core.pairing.pairings.get(C).active)}catch(se){throw this.client.logger.error(`connect() -> pairing.get(${C}) failed`),se}if(!C||!A){const{topic:se,uri:re}=await this.client.core.pairing.create();C=se,F=re}if(!C){const{message:se}=(0,d.kCb)("NO_MATCHING_KEY",`connect() pairing topic: ${C}`);throw new Error(se)}const N=await this.client.core.crypto.generateKeyPair(),M=Ce.wc_sessionPropose.req.ttl||O.FIVE_MINUTES,k=(0,d.gn4)(M),H=be({requiredNamespaces:h,optionalNamespaces:g,relays:I??[{protocol:po}],proposer:{publicKey:N,metadata:this.client.metadata},expiryTimestamp:k,pairingTopic:C},v&&{sessionProperties:v}),{reject:K,resolve:Y,done:ae}=(0,d.H1S)(M,Fo);this.events.once((0,d.E0T)("session_connect"),async({error:se,session:re})=>{if(se)K(se);else if(re){re.self.publicKey=N;const ve=Qt(be({},re),{pairingTopic:H.pairingTopic,requiredNamespaces:H.requiredNamespaces,optionalNamespaces:H.optionalNamespaces});await this.client.session.set(re.topic,ve),await this.setExpiry(re.topic,re.expiry),C&&await this.client.core.pairing.updateMetadata({topic:C,metadata:re.peer.metadata}),this.cleanupDuplicatePairings(ve),Y(ve)}});const ie=await this.sendRequest({topic:C,method:"wc_sessionPropose",params:H,throwOnFailedPublish:!0});return await this.setProposal(ie,be({id:ie},H)),{uri:F,approval:ae}},this.pair=async r=>{await this.isInitialized();try{return await this.client.core.pairing.pair(r)}catch(o){throw this.client.logger.error("pair() failed"),o}},this.approve=async r=>{await this.isInitialized();try{await this.isValidApprove(r)}catch(ae){throw this.client.logger.error("approve() -> isValidApprove() failed"),ae}const{id:o,relayProtocol:a,namespaces:h,sessionProperties:g,sessionConfig:v}=r;let I;try{I=this.client.proposal.get(o)}catch(ae){throw this.client.logger.error(`approve() -> proposal.get(${o}) failed`),ae}const{pairingTopic:C,proposer:F,requiredNamespaces:A,optionalNamespaces:N}=I,M=await this.client.core.crypto.generateKeyPair(),k=F.publicKey,H=await this.client.core.crypto.generateSharedKey(M,k),K=be(be({relay:{protocol:a??"irn"},namespaces:h,controller:{publicKey:M,metadata:this.client.metadata},expiry:(0,d.gn4)(pi)},g&&{sessionProperties:g}),v&&{sessionConfig:v});await this.client.core.relayer.subscribe(H);const Y=Qt(be({},K),{topic:H,requiredNamespaces:A,optionalNamespaces:N,pairingTopic:C,acknowledged:!1,self:K.controller,peer:{publicKey:F.publicKey,metadata:F.metadata},controller:M});await this.client.session.set(H,Y);try{await this.sendResult({id:o,topic:C,result:{relay:{protocol:a??"irn"},responderPublicKey:M},throwOnFailedPublish:!0}),await this.sendRequest({topic:H,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0})}catch(ae){throw this.client.logger.error(ae),this.client.session.delete(H,(0,d.D6H)("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(H),ae}return await this.client.core.pairing.updateMetadata({topic:C,metadata:F.metadata}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:C}),await this.setExpiry(H,(0,d.gn4)(pi)),{topic:H,acknowledged:()=>new Promise(ae=>setTimeout(()=>ae(this.client.session.get(H)),500))}},this.reject=async r=>{await this.isInitialized();try{await this.isValidReject(r)}catch(g){throw this.client.logger.error("reject() -> isValidReject() failed"),g}const{id:o,reason:a}=r;let h;try{h=this.client.proposal.get(o).pairingTopic}catch(g){throw this.client.logger.error(`reject() -> proposal.get(${o}) failed`),g}h&&(await this.sendError({id:o,topic:h,error:a,rpcOpts:Ce.wc_sessionPropose.reject}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized();try{await this.isValidUpdate(r)}catch(A){throw this.client.logger.error("update() -> isValidUpdate() failed"),A}const{topic:o,namespaces:a}=r,{done:h,resolve:g,reject:v}=(0,d.H1S)(),I=(0,L.payloadId)(),C=(0,L.getBigIntRpcId)().toString(),F=this.client.session.get(o).namespaces;return this.events.once((0,d.E0T)("session_update",I),({error:A})=>{A?v(A):g()}),await this.client.session.update(o,{namespaces:a}),await this.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a},throwOnFailedPublish:!0,clientRpcId:I,relayRpcId:C}).catch(A=>{this.client.logger.error(A),this.client.session.update(o,{namespaces:F}),v(A)}),{acknowledged:h}},this.extend=async r=>{await this.isInitialized();try{await this.isValidExtend(r)}catch(I){throw this.client.logger.error("extend() -> isValidExtend() failed"),I}const{topic:o}=r,a=(0,L.payloadId)(),{done:h,resolve:g,reject:v}=(0,d.H1S)();return this.events.once((0,d.E0T)("session_extend",a),({error:I})=>{I?v(I):g()}),await this.setExpiry(o,(0,d.gn4)(pi)),this.sendRequest({topic:o,method:"wc_sessionExtend",params:{},clientRpcId:a,throwOnFailedPublish:!0}).catch(I=>{v(I)}),{acknowledged:h}},this.request=async r=>{await this.isInitialized();try{await this.isValidRequest(r)}catch(M){throw this.client.logger.error("request() -> isValidRequest() failed"),M}const{chainId:o,request:a,topic:h,expiry:g=Ce.wc_sessionRequest.req.ttl}=r,v=this.client.session.get(h),I=(0,L.payloadId)(),C=(0,L.getBigIntRpcId)().toString(),{done:F,resolve:A,reject:N}=(0,d.H1S)(g,"Request expired. Please try again.");return this.events.once((0,d.E0T)("session_request",I),({error:M,result:k})=>{M?N(M):A(k)}),await Promise.all([new Promise(async M=>{await this.sendRequest({clientRpcId:I,relayRpcId:C,topic:h,method:"wc_sessionRequest",params:{request:Qt(be({},a),{expiryTimestamp:(0,d.gn4)(g)}),chainId:o},expiry:g,throwOnFailedPublish:!0}).catch(k=>N(k)),this.client.events.emit("session_request_sent",{topic:h,request:a,chainId:o,id:I}),M()}),new Promise(async M=>{var k;if(!((k=v.sessionConfig)!=null&&k.disableDeepLink)){const H=await(0,d.bW6)(this.client.core.storage,qo);(0,d.HhN)({id:I,topic:h,wcDeepLink:H})}M()}),F()]).then(M=>M[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:o,response:a}=r,{id:h}=a;(0,L.isJsonRpcResult)(a)?await this.sendResult({id:h,topic:o,result:a.result,throwOnFailedPublish:!0}):(0,L.isJsonRpcError)(a)&&await this.sendError({id:h,topic:o,error:a.error}),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized();try{await this.isValidPing(r)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}const{topic:o}=r;if(this.client.session.keys.includes(o)){const a=(0,L.payloadId)(),h=(0,L.getBigIntRpcId)().toString(),{done:g,resolve:v,reject:I}=(0,d.H1S)();this.events.once((0,d.E0T)("session_ping",a),({error:C})=>{C?I(C):v()}),await Promise.all([this.sendRequest({topic:o,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:h}),g()])}else this.client.core.pairing.pairings.keys.includes(o)&&await this.client.core.pairing.ping({topic:o})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:o,event:a,chainId:h}=r,g=(0,L.getBigIntRpcId)().toString();await this.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:h},throwOnFailedPublish:!0,relayRpcId:g})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:o}=r;if(this.client.session.keys.includes(o))await this.sendRequest({topic:o,method:"wc_sessionDelete",params:(0,d.D6H)("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:o,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(o))await this.client.core.pairing.disconnect({topic:o});else{const{message:a}=(0,d.kCb)("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(o=>(0,d.Ih8)(o,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.authenticate=async r=>{this.isInitialized(),this.isValidAuthenticate(r);const{chains:o,statement:a="",uri:h,domain:g,nonce:v,type:I,exp:C,nbf:F,methods:A=[],expiry:N}=r,M=[...r.resources||[]],{topic:k,uri:H}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"]});this.client.logger.info({message:"Generated new pairing",pairing:{topic:k,uri:H}});const K=await this.client.core.crypto.generateKeyPair(),Y=(0,d.YmJ)(K);if(await Promise.all([this.client.auth.authKeys.set(ur,{responseTopic:Y,publicKey:K}),this.client.auth.pairingTopics.set(Y,{topic:Y,pairingTopic:k})]),await this.client.core.relayer.subscribe(Y),this.client.logger.info(`sending request to new pairing topic: ${k}`),A.length>0){const{namespace:He}=(0,d.DQe)(o[0]);let Se=(0,d.IkP)(He,"request",A);(0,d.hA9)(M)&&(Se=(0,d.qJM)(Se,M.pop())),M.push(Se)}const ae=N&&N>Ce.wc_sessionAuthenticate.req.ttl?N:Ce.wc_sessionAuthenticate.req.ttl,ie={authPayload:{type:I??"caip122",chains:o,statement:a,aud:h,domain:g,version:"1",nonce:v,iat:new Date().toISOString(),exp:C,nbf:F,resources:M},requester:{publicKey:K,metadata:this.client.metadata},expiryTimestamp:(0,d.gn4)(ae)},se={eip155:{chains:o,methods:[...new Set(["personal_sign",...A])],events:["chainChanged","accountsChanged"]}},re={requiredNamespaces:{},optionalNamespaces:se,relays:[{protocol:"irn"}],pairingTopic:k,proposer:{publicKey:K,metadata:this.client.metadata},expiryTimestamp:(0,d.gn4)(Ce.wc_sessionPropose.req.ttl)},{done:ve,resolve:de,reject:Ee}=(0,d.H1S)(ae,"Request expired"),Le=async({error:He,session:Se})=>{if(this.events.off((0,d.E0T)("session_request",Mt),Ni),He)Ee(He);else if(Se){Se.self.publicKey=K,await this.client.session.set(Se.topic,Se),await this.setExpiry(Se.topic,Se.expiry),k&&await this.client.core.pairing.updateMetadata({topic:k,metadata:Se.peer.metadata});const Xt=this.client.session.get(Se.topic);await this.deleteProposal(Zt),de({session:Xt})}},Ni=async He=>{if(await this.deletePendingAuthRequest(Mt,{message:"fulfilled",code:0}),He.error){const mt=(0,d.D6H)("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return He.error.code===mt.code?void 0:(this.events.off((0,d.E0T)("session_connect"),Le),Ee(He.error.message))}await this.deleteProposal(Zt),this.events.off((0,d.E0T)("session_connect"),Le);const{cacaos:Se,responder:Xt}=He.result,ki=[],yt=[];for(const mt of Se){await(0,d.c4l)({cacao:mt,projectId:this.client.core.projectId})||(this.client.logger.error(mt,"Signature verification failed"),Ee((0,d.D6H)("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:$e}=mt,$i=(0,d.hA9)($e.resources),dr=[(0,d.DJo)($e.iss)],Is=(0,d.NmC)($e.iss);if($i){const vt=(0,d.Y31)($i),gi=(0,d.ouN)($i);ki.push(...vt),dr.push(...gi)}for(const vt of dr)yt.push(`${vt}:${Is}`)}const Ve=await this.client.core.crypto.generateSharedKey(K,Xt.publicKey);let di;ki.length>0&&(di={topic:Ve,acknowledged:!0,self:{publicKey:K,metadata:this.client.metadata},peer:Xt,controller:Xt.publicKey,expiry:(0,d.gn4)(pi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:k,namespaces:(0,d.E12)([...new Set(ki)],[...new Set(yt)])},await this.client.core.relayer.subscribe(Ve),await this.client.session.set(Ve,di),di=this.client.session.get(Ve)),de({auths:Se,session:di})},Mt=(0,L.payloadId)(),Zt=(0,L.payloadId)();this.events.once((0,d.E0T)("session_connect"),Le),this.events.once((0,d.E0T)("session_request",Mt),Ni);try{await Promise.all([this.sendRequest({topic:k,method:"wc_sessionAuthenticate",params:ie,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:Mt}),this.sendRequest({topic:k,method:"wc_sessionPropose",params:re,expiry:Ce.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:Zt})])}catch(He){throw this.events.off((0,d.E0T)("session_connect"),Le),this.events.off((0,d.E0T)("session_request",Mt),Ni),He}return await this.setProposal(Zt,be({id:Zt},re)),await this.setAuthRequest(Mt,{request:Qt(be({},ie),{verifyContext:{}}),pairingTopic:k}),{uri:H,response:ve}},this.approveSessionAuthenticate=async r=>{this.isInitialized();const{id:o,auths:a}=r,h=this.getPendingAuthRequest(o);if(!h)throw new Error(`Could not find pending auth request with id ${o}`);const g=h.requester.publicKey,v=await this.client.core.crypto.generateKeyPair(),I=(0,d.YmJ)(g),C={type:d.rVF,receiverPublicKey:g,senderPublicKey:v},F=[],A=[];for(const k of a){if(!await(0,d.c4l)({cacao:k,projectId:this.client.core.projectId})){const ie=(0,d.D6H)("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:o,topic:I,error:ie,encodeOpts:C}),new Error(ie.message)}const{p:H}=k,K=(0,d.hA9)(H.resources),Y=[(0,d.DJo)(H.iss)],ae=(0,d.NmC)(H.iss);if(K){const ie=(0,d.Y31)(K),se=(0,d.ouN)(K);F.push(...ie),Y.push(...se)}for(const ie of Y)A.push(`${ie}:${ae}`)}const N=await this.client.core.crypto.generateSharedKey(v,g);let M;return(F==null?void 0:F.length)>0&&(M={topic:N,acknowledged:!0,self:{publicKey:v,metadata:this.client.metadata},peer:{publicKey:g,metadata:h.requester.metadata},controller:g,expiry:(0,d.gn4)(pi),authentication:a,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:"",namespaces:(0,d.E12)([...new Set(F)],[...new Set(A)])},await this.client.core.relayer.subscribe(N),await this.client.session.set(N,M)),await this.sendResult({topic:I,id:o,result:{cacaos:a,responder:{publicKey:v,metadata:this.client.metadata}},encodeOpts:C,throwOnFailedPublish:!0}),await this.client.auth.requests.delete(o,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:h.pairingTopic}),{session:M}},this.rejectSessionAuthenticate=async r=>{await this.isInitialized();const{id:o,reason:a}=r,h=this.getPendingAuthRequest(o);if(!h)throw new Error(`Could not find pending auth request with id ${o}`);const g=h.requester.publicKey,v=await this.client.core.crypto.generateKeyPair(),I=(0,d.YmJ)(g),C={type:d.rVF,receiverPublicKey:g,senderPublicKey:v};await this.sendError({id:o,topic:I,error:a,encodeOpts:C,rpcOpts:Ce.wc_sessionAuthenticate.reject}),await this.client.auth.requests.delete(o,{message:"rejected",code:0}),await this.client.proposal.delete(o,(0,d.D6H)("USER_DISCONNECTED"))},this.formatAuthMessage=r=>{this.isInitialized();const{request:o,iss:a}=r;return(0,d.wvx)(o,a)},this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const o=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(h=>{var g,v;return((g=h.peerMetadata)==null?void 0:g.url)&&((v=h.peerMetadata)==null?void 0:v.url)===r.peer.metadata.url&&h.topic&&h.topic!==o.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(o){this.client.logger.error(o)}},this.deleteSession=async r=>{var o;const{topic:a,expirerHasDeleted:h=!1,emitEvent:g=!0,id:v=0}=r,{self:I}=this.client.session.get(a);await this.client.core.relayer.unsubscribe(a),await this.client.session.delete(a,(0,d.D6H)("USER_DISCONNECTED")),this.addToRecentlyDeleted(a,"session"),this.client.core.crypto.keychain.has(I.publicKey)&&await this.client.core.crypto.deleteKeyPair(I.publicKey),this.client.core.crypto.keychain.has(a)&&await this.client.core.crypto.deleteSymKey(a),h||this.client.core.expirer.del(a),this.client.core.storage.removeItem(qo).catch(C=>this.client.logger.warn(C)),this.getPendingSessionRequests().forEach(C=>{C.topic===a&&this.deletePendingSessionRequest(C.id,(0,d.D6H)("USER_DISCONNECTED"))}),a===((o=this.sessionRequestQueue.queue[0])==null?void 0:o.topic)&&(this.sessionRequestQueue.state=ft.idle),g&&this.client.events.emit("session_delete",{id:v,topic:a})},this.deleteProposal=async(r,o)=>{await Promise.all([this.client.proposal.delete(r,(0,d.D6H)("USER_DISCONNECTED")),o?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")},this.deletePendingSessionRequest=async(r,o,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,o),a?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==r),a&&(this.sessionRequestQueue.state=ft.idle,this.client.events.emit("session_request_expire",{id:r}))},this.deletePendingAuthRequest=async(r,o,a=!1)=>{await Promise.all([this.client.auth.requests.delete(r,o),a?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,o)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,o),await this.client.session.update(r,{expiry:o}))},this.setProposal=async(r,o)=>{this.client.core.expirer.set(r,(0,d.gn4)(Ce.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,o)},this.setAuthRequest=async(r,o)=>{const{request:a,pairingTopic:h}=o;this.client.core.expirer.set(r,a.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:a.authPayload,requester:a.requester,expiryTimestamp:a.expiryTimestamp,id:r,pairingTopic:h,verifyContext:a.verifyContext})},this.setPendingSessionRequest=async r=>{const{id:o,topic:a,params:h,verifyContext:g}=r,v=h.request.expiryTimestamp||(0,d.gn4)(Ce.wc_sessionRequest.req.ttl);this.client.core.expirer.set(o,v),await this.client.pendingRequest.set(o,{id:o,topic:a,params:h,verifyContext:g})},this.sendRequest=async r=>{const{topic:o,method:a,params:h,expiry:g,relayRpcId:v,clientRpcId:I,throwOnFailedPublish:C}=r,F=(0,L.formatJsonRpcRequest)(a,h,I);if((0,d.jUY)()&&_p.includes(a)){const M=(0,d.rjm)(JSON.stringify(F));this.client.core.verify.register({attestationId:M})}let A;try{A=await this.client.core.crypto.encode(o,F)}catch(M){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${o} failed`),M}const N=Ce[a].req;return g&&(N.ttl=g),v&&(N.id=v),this.client.core.history.set(o,F),C?(N.internal=Qt(be({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,A,N)):this.client.core.relayer.publish(o,A,N).catch(M=>this.client.logger.error(M)),F.id},this.sendResult=async r=>{const{id:o,topic:a,result:h,throwOnFailedPublish:g,encodeOpts:v}=r,I=(0,L.formatJsonRpcResult)(o,h);let C;try{C=await this.client.core.crypto.encode(a,I,v)}catch(N){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),N}let F;try{F=await this.client.core.history.get(a,o)}catch(N){throw this.client.logger.error(`sendResult() -> history.get(${a}, ${o}) failed`),N}const A=Ce[F.request.method].res;g?(A.internal=Qt(be({},A.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,C,A)):this.client.core.relayer.publish(a,C,A).catch(N=>this.client.logger.error(N)),await this.client.core.history.resolve(I)},this.sendError=async r=>{const{id:o,topic:a,error:h,encodeOpts:g,rpcOpts:v}=r,I=(0,L.formatJsonRpcError)(o,h);let C;try{C=await this.client.core.crypto.encode(a,I,g)}catch(N){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${a} failed`),N}let F;try{F=await this.client.core.history.get(a,o)}catch(N){throw this.client.logger.error(`sendError() -> history.get(${a}, ${o}) failed`),N}const A=v||Ce[F.request.method].res;this.client.core.relayer.publish(a,C,A),await this.client.core.history.resolve(I)},this.cleanup=async()=>{const r=[],o=[];this.client.session.getAll().forEach(a=>{let h=!1;(0,d.BwD)(a.expiry)&&(h=!0),this.client.core.crypto.keychain.has(a.topic)||(h=!0),h&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{(0,d.BwD)(a.expiryTimestamp)&&o.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession({topic:a})),...o.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ft.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ft.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(o=>setTimeout(o,300))}catch(o){this.client.logger.warn(o)}}this.requestQueue.state=ft.idle},this.processRequest=r=>{const{topic:o,payload:a}=r,h=a.method;if(!this.shouldIgnorePairingRequest({topic:o,requestMethod:h}))switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(o,a);case"wc_sessionSettle":return this.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return this.onSessionExtendRequest(o,a);case"wc_sessionPing":return this.onSessionPingRequest(o,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return this.onSessionRequest(o,a);case"wc_sessionEvent":return this.onSessionEventRequest(o,a);case"wc_sessionAuthenticate":return this.onSessionAuthenticateRequest(o,a);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async r=>{const{topic:o,payload:a}=r,h=(await this.client.core.history.get(o,a.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(o,a);case"wc_sessionSettle":return this.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return this.onSessionExtendResponse(o,a);case"wc_sessionPing":return this.onSessionPingResponse(o,a);case"wc_sessionRequest":return this.onSessionRequestResponse(o,a);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(o,a);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:o}=r,{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Decoded payload on topic ${o} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.shouldIgnorePairingRequest=r=>{const{topic:o,requestMethod:a}=r,h=this.expectedPairingMethodMap.get(o);return!h||h.includes(a)?!1:!!(h.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)},this.onSessionProposeRequest=async(r,o)=>{const{params:a,id:h}=o;try{this.isValidConnect(be({},o.params));const g=a.expiryTimestamp||(0,d.gn4)(Ce.wc_sessionPropose.req.ttl),v=be({id:h,pairingTopic:r,expiryTimestamp:g},a);await this.setProposal(h,v);const I=(0,d.rjm)(JSON.stringify(o)),C=await this.getVerifyContext(I,v.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:v,verifyContext:C})}catch(g){await this.sendError({id:h,topic:r,error:g,rpcOpts:Ce.wc_sessionPropose.autoReject}),this.client.logger.error(g)}},this.onSessionProposeResponse=async(r,o)=>{const{id:a}=o;if((0,L.isJsonRpcResult)(o)){const{result:h}=o;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const g=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const v=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:v});const I=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:I});const C=await this.client.core.crypto.generateSharedKey(v,I);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:C});const F=await this.client.core.relayer.subscribe(C);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:F}),await this.client.core.pairing.activate({topic:r})}else if((0,L.isJsonRpcError)(o)){await this.client.proposal.delete(a,(0,d.D6H)("USER_DISCONNECTED"));const h=(0,d.E0T)("session_connect");if(this.events.listenerCount(h)===0)throw new Error(`emitting ${h} without any listeners, 954`);this.events.emit((0,d.E0T)("session_connect"),{error:o.error})}},this.onSessionSettleRequest=async(r,o)=>{const{id:a,params:h}=o;try{this.isValidSessionSettleRequest(h);const{relay:g,controller:v,expiry:I,namespaces:C,sessionProperties:F,sessionConfig:A}=o.params,N=be(be({topic:r,relay:g,expiry:I,namespaces:C,acknowledged:!0,pairingTopic:"",requiredNamespaces:{},optionalNamespaces:{},controller:v.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:v.publicKey,metadata:v.metadata}},F&&{sessionProperties:F}),A&&{sessionConfig:A});await this.sendResult({id:o.id,topic:r,result:!0,throwOnFailedPublish:!0});const M=(0,d.E0T)("session_connect");if(this.events.listenerCount(M)===0)throw new Error(`emitting ${M} without any listeners 997`);this.events.emit((0,d.E0T)("session_connect"),{session:N})}catch(g){await this.sendError({id:a,topic:r,error:g}),this.client.logger.error(g)}},this.onSessionSettleResponse=async(r,o)=>{const{id:a}=o;(0,L.isJsonRpcResult)(o)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit((0,d.E0T)("session_approve",a),{})):(0,L.isJsonRpcError)(o)&&(await this.client.session.delete(r,(0,d.D6H)("USER_DISCONNECTED")),this.events.emit((0,d.E0T)("session_approve",a),{error:o.error}))},this.onSessionUpdateRequest=async(r,o)=>{const{params:a,id:h}=o;try{const g=`${r}_session_update`,v=d.O6B.get(g);if(v&&this.isRequestOutOfSync(v,h)){this.client.logger.info(`Discarding out of sync request - ${h}`),this.sendError({id:h,topic:r,error:(0,d.D6H)("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(be({topic:r},a));try{d.O6B.set(g,h),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:h,topic:r,result:!0,throwOnFailedPublish:!0})}catch(I){throw d.O6B.delete(g),I}this.client.events.emit("session_update",{id:h,topic:r,params:a})}catch(g){await this.sendError({id:h,topic:r,error:g}),this.client.logger.error(g)}},this.isRequestOutOfSync=(r,o)=>parseInt(o.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,o)=>{const{id:a}=o,h=(0,d.E0T)("session_update",a);if(this.events.listenerCount(h)===0)throw new Error(`emitting ${h} without any listeners`);(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_update",a),{}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_update",a),{error:o.error})},this.onSessionExtendRequest=async(r,o)=>{const{id:a}=o;try{this.isValidExtend({topic:r}),await this.setExpiry(r,(0,d.gn4)(pi)),await this.sendResult({id:a,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(h){await this.sendError({id:a,topic:r,error:h}),this.client.logger.error(h)}},this.onSessionExtendResponse=(r,o)=>{const{id:a}=o,h=(0,d.E0T)("session_extend",a);if(this.events.listenerCount(h)===0)throw new Error(`emitting ${h} without any listeners`);(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_extend",a),{}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_extend",a),{error:o.error})},this.onSessionPingRequest=async(r,o)=>{const{id:a}=o;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(h){await this.sendError({id:a,topic:r,error:h}),this.client.logger.error(h)}},this.onSessionPingResponse=(r,o)=>{const{id:a}=o,h=(0,d.E0T)("session_ping",a);if(this.events.listenerCount(h)===0)throw new Error(`emitting ${h} without any listeners`);setTimeout(()=>{(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_ping",a),{}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_ping",a),{error:o.error})},500)},this.onSessionDeleteRequest=async(r,o)=>{const{id:a}=o;try{this.isValidDisconnect({topic:r,reason:o.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(ke.publish,async()=>{h(await this.deleteSession({topic:r,id:a}))})}),this.sendResult({id:a,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:(0,d.D6H)("USER_DISCONNECTED")})])}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(r,o)=>{var a;const{id:h,params:g}=o;try{await this.isValidRequest(be({topic:r},g));const v=(0,d.rjm)(JSON.stringify((0,L.formatJsonRpcRequest)("wc_sessionRequest",g,h))),I=this.client.session.get(r),C=await this.getVerifyContext(v,I.peer.metadata),F={id:h,topic:r,params:g,verifyContext:C};await this.setPendingSessionRequest(F),(a=this.client.signConfig)!=null&&a.disableRequestQueue?this.emitSessionRequest(F):(this.addSessionRequestToSessionRequestQueue(F),this.processSessionRequestQueue())}catch(v){await this.sendError({id:h,topic:r,error:v}),this.client.logger.error(v)}},this.onSessionRequestResponse=(r,o)=>{const{id:a}=o,h=(0,d.E0T)("session_request",a);if(this.events.listenerCount(h)===0)throw new Error(`emitting ${h} without any listeners`);(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_request",a),{result:o.result}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_request",a),{error:o.error})},this.onSessionEventRequest=async(r,o)=>{const{id:a,params:h}=o;try{const g=`${r}_session_event_${h.event.name}`,v=d.O6B.get(g);if(v&&this.isRequestOutOfSync(v,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(be({topic:r},h)),this.client.events.emit("session_event",{id:a,topic:r,params:h}),d.O6B.set(g,a)}catch(g){await this.sendError({id:a,topic:r,error:g}),this.client.logger.error(g)}},this.onSessionAuthenticateResponse=(r,o)=>{const{id:a}=o;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:o}),(0,L.isJsonRpcResult)(o)?this.events.emit((0,d.E0T)("session_request",a),{result:o.result}):(0,L.isJsonRpcError)(o)&&this.events.emit((0,d.E0T)("session_request",a),{error:o.error})},this.onSessionAuthenticateRequest=async(r,o)=>{try{const{requester:a,authPayload:h,expiryTimestamp:g}=o.params,v=(0,d.rjm)(JSON.stringify(o)),I=await this.getVerifyContext(v,this.client.metadata),C={requester:a,pairingTopic:r,id:o.id,authPayload:h,verifyContext:I,expiryTimestamp:g};await this.setAuthRequest(o.id,{request:C,pairingTopic:r}),this.client.events.emit("session_authenticate",{topic:r,params:o.params,id:o.id})}catch(a){this.client.logger.error(a);const h=o.params.requester.publicKey,g=await this.client.core.crypto.generateKeyPair(),v={type:d.rVF,receiverPublicKey:h,senderPublicKey:g};await this.sendError({id:o.id,topic:r,error:a,encodeOpts:v,rpcOpts:Ce.wc_sessionAuthenticate.autoReject})}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ft.idle,this.processSessionRequestQueue()},(0,O.toMiliseconds)(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:o})=>{const a=this.client.core.history.pending;a.length>0&&a.filter(h=>h.topic===r&&h.request.method==="wc_sessionRequest").forEach(h=>{const g=h.request.id,v=(0,d.E0T)("session_request",g);if(this.events.listenerCount(v)===0)throw new Error(`emitting ${v} without any listeners`);this.events.emit((0,d.E0T)("session_request",h.request.id),{error:o})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ft.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ft.active,this.emitSessionRequest(r)}catch(o){this.client.logger.error(o)}},this.emitSessionRequest=r=>{this.client.events.emit("session_request",r)},this.onPairingCreated=r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const o=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);o&&this.onSessionProposeRequest(r.topic,(0,L.formatJsonRpcRequest)("wc_sessionPropose",{requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,relays:o.relays,proposer:o.proposer,sessionProperties:o.sessionProperties},o.id))},this.isValidConnect=async r=>{if(!(0,d.EJd)(r)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(I)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:h,sessionProperties:g,relays:v}=r;if((0,d.o8e)(o)||await this.isValidPairingTopic(o),!(0,d.PMr)(v,!0)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`connect() relays: ${v}`);throw new Error(I)}!(0,d.o8e)(a)&&(0,d.L5o)(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!(0,d.o8e)(h)&&(0,d.L5o)(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),(0,d.o8e)(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(r,o)=>{const a=(0,d.naP)(r,"connect()",o);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!(0,d.EJd)(r))throw new Error((0,d.kCb)("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:o,namespaces:a,relayProtocol:h,sessionProperties:g}=r;this.checkRecentlyDeleted(o),await this.isValidProposalId(o);const v=this.client.proposal.get(o),I=(0,d.ing)(a,"approve()");if(I)throw new Error(I.message);const C=(0,d.rFo)(v.requiredNamespaces,a,"approve()");if(C)throw new Error(C.message);if(!(0,d.M_r)(h,!0)){const{message:F}=(0,d.kCb)("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(F)}(0,d.o8e)(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async r=>{if(!(0,d.EJd)(r)){const{message:h}=(0,d.kCb)("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(h)}const{id:o,reason:a}=r;if(this.checkRecentlyDeleted(o),await this.isValidProposalId(o),!(0,d.H4H)(a)){const{message:h}=(0,d.kCb)("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidSessionSettleRequest=r=>{if(!(0,d.EJd)(r)){const{message:C}=(0,d.kCb)("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(C)}const{relay:o,controller:a,namespaces:h,expiry:g}=r;if(!(0,d.Z26)(o)){const{message:C}=(0,d.kCb)("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(C)}const v=(0,d.DdM)(a,"onSessionSettleRequest()");if(v)throw new Error(v.message);const I=(0,d.ing)(h,"onSessionSettleRequest()");if(I)throw new Error(I.message);if((0,d.BwD)(g)){const{message:C}=(0,d.kCb)("EXPIRED","onSessionSettleRequest()");throw new Error(C)}},this.isValidUpdate=async r=>{if(!(0,d.EJd)(r)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(I)}const{topic:o,namespaces:a}=r;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o);const h=this.client.session.get(o),g=(0,d.ing)(a,"update()");if(g)throw new Error(g.message);const v=(0,d.rFo)(h.requiredNamespaces,a,"update()");if(v)throw new Error(v.message)},this.isValidExtend=async r=>{if(!(0,d.EJd)(r)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:o}=r;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o)},this.isValidRequest=async r=>{if(!(0,d.EJd)(r)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(I)}const{topic:o,request:a,chainId:h,expiry:g}=r;this.checkRecentlyDeleted(o),await this.isValidSessionTopic(o);const{namespaces:v}=this.client.session.get(o);if(!(0,d.p8o)(v,h)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(I)}if(!(0,d.hHR)(a)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(I)}if(!(0,d.alS)(v,h,a.method)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(I)}if(g&&!(0,d.ONw)(g,ys)){const{message:I}=(0,d.kCb)("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${ys.min} and ${ys.max}`);throw new Error(I)}},this.isValidRespond=async r=>{var o;if(!(0,d.EJd)(r)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(g)}const{topic:a,response:h}=r;try{await this.isValidSessionTopic(a)}catch(g){throw(o=r==null?void 0:r.response)!=null&&o.id&&this.cleanupAfterResponse(r),g}if(!(0,d.JTI)(h)){const{message:g}=(0,d.kCb)("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(h)}`);throw new Error(g)}},this.isValidPing=async r=>{if(!(0,d.EJd)(r)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.isValidEmit=async r=>{if(!(0,d.EJd)(r)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(v)}const{topic:o,event:a,chainId:h}=r;await this.isValidSessionTopic(o);const{namespaces:g}=this.client.session.get(o);if(!(0,d.p8o)(g,h)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(v)}if(!(0,d.nfW)(a)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}if(!(0,d.B95)(g,h,a.name)){const{message:v}=(0,d.kCb)("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(v)}},this.isValidDisconnect=async r=>{if(!(0,d.EJd)(r)){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:o}=r;await this.isValidSessionOrPairingTopic(o)},this.isValidAuthenticate=r=>{const{chains:o,uri:a,domain:h,nonce:g}=r;if(!Array.isArray(o)||o.length===0)throw new Error("chains is required and must be a non-empty array");if(!(0,d.M_r)(a,!1))throw new Error("uri is required parameter");if(!(0,d.M_r)(h,!1))throw new Error("domain is required parameter");if(!(0,d.M_r)(g,!1))throw new Error("nonce is required parameter");if([...new Set(o.map(I=>(0,d.DQe)(I).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:v}=(0,d.DQe)(o[0]);if(v!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")},this.getVerifyContext=async(r,o)=>{const a={verified:{verifyUrl:o.verifyUrl||li,validation:"UNKNOWN",origin:o.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:r,verifyUrl:o.verifyUrl});h&&(a.verified.origin=h.origin,a.verified.isScam=h.isScam,a.verified.validation=h.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,o)=>{Object.values(r).forEach(a=>{if(!(0,d.M_r)(a,!1)){const{message:h}=(0,d.kCb)("MISSING_OR_INVALID",`${o} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(h)}})},this.getPendingAuthRequest=r=>{const o=this.client.auth.requests.get(r);return typeof o=="object"?o:void 0},this.addToRecentlyDeleted=(r,o)=>{if(this.recentlyDeletedMap.set(r,o),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0;const h=this.recentlyDeletedLimit/2;for(const g of this.recentlyDeletedMap.keys()){if(a++>=h)break;this.recentlyDeletedMap.delete(g)}}},this.checkRecentlyDeleted=r=>{const o=this.recentlyDeletedMap.get(r);if(o){const{message:a}=(0,d.kCb)("MISSING_OR_INVALID",`Record was recently deleted - ${o}: ${r}`);throw new Error(a)}}}async isInitialized(){if(!this.initialized){const{message:s}=(0,d.kCb)("NOT_INITIALIZED",this.name);throw new Error(s)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ke.message,async s=>{const{topic:r,message:o}=s,{publicKey:a}=this.client.auth.authKeys.keys.includes(ur)?this.client.auth.authKeys.get(ur):{responseTopic:void 0,publicKey:void 0},h=await this.client.core.crypto.decode(r,o,{receiverPublicKey:a});try{(0,L.isJsonRpcRequest)(h)?(this.client.core.history.set(r,h),this.onRelayEventRequest({topic:r,payload:h})):(0,L.isJsonRpcResponse)(h)?(await this.client.core.history.resolve(h),await this.onRelayEventResponse({topic:r,payload:h}),this.client.core.history.delete(r,h.id)):this.onRelayEventUnknownPayload({topic:r,payload:h})}catch(g){this.client.logger.error(g)}})}registerExpirerEvents(){this.client.core.expirer.on(Ze.expired,async s=>{const{topic:r,id:o}=(0,d.iPz)(s.target);if(o&&this.client.pendingRequest.keys.includes(o))return await this.deletePendingSessionRequest(o,(0,d.kCb)("EXPIRED"),!0);if(o&&this.client.auth.requests.keys.includes(o))return await this.deletePendingAuthRequest(o,(0,d.kCb)("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):o&&(await this.deleteProposal(o,!0),this.client.events.emit("proposal_expire",{id:o}))})}registerPairingEvents(){this.client.core.pairing.events.on(hi.create,s=>this.onPairingCreated(s)),this.client.core.pairing.events.on(hi.delete,s=>{this.addToRecentlyDeleted(s.topic,"pairing")})}isValidPairingTopic(s){if(!(0,d.M_r)(s,!1)){const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(s)){const{message:r}=(0,d.kCb)("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if((0,d.BwD)(this.client.core.pairing.pairings.get(s).expiry)){const{message:r}=(0,d.kCb)("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}}async isValidSessionTopic(s){if(!(0,d.M_r)(s,!1)){const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`session topic should be a string: ${s}`);throw new Error(r)}if(this.checkRecentlyDeleted(s),!this.client.session.keys.includes(s)){const{message:r}=(0,d.kCb)("NO_MATCHING_KEY",`session topic doesn't exist: ${s}`);throw new Error(r)}if((0,d.BwD)(this.client.session.get(s).expiry)){await this.deleteSession({topic:s});const{message:r}=(0,d.kCb)("EXPIRED",`session topic: ${s}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(s)){const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`session topic does not exist in keychain: ${s}`);throw await this.deleteSession({topic:s}),new Error(r)}}async isValidSessionOrPairingTopic(s){if(this.checkRecentlyDeleted(s),this.client.session.keys.includes(s))await this.isValidSessionTopic(s);else if(this.client.core.pairing.pairings.keys.includes(s))this.isValidPairingTopic(s);else if((0,d.M_r)(s,!1)){const{message:r}=(0,d.kCb)("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${s}`);throw new Error(r)}else{const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`session or pairing topic should be a string: ${s}`);throw new Error(r)}}async isValidProposalId(s){if(!(0,d.Q01)(s)){const{message:r}=(0,d.kCb)("MISSING_OR_INVALID",`proposal id should be a number: ${s}`);throw new Error(r)}if(!this.client.proposal.keys.includes(s)){const{message:r}=(0,d.kCb)("NO_MATCHING_KEY",`proposal id doesn't exist: ${s}`);throw new Error(r)}if((0,d.BwD)(this.client.proposal.get(s).expiryTimestamp)){await this.deleteProposal(s);const{message:r}=(0,d.kCb)("EXPIRED",`proposal id: ${s}`);throw new Error(r)}}}class Dp extends Wt{constructor(s,r){super(s,r,yp,gs),this.core=s,this.logger=r}}class Op extends Wt{constructor(s,r){super(s,r,mp,gs),this.core=s,this.logger=r}}class Tp extends Wt{constructor(s,r){super(s,r,wp,gs,o=>o.id),this.core=s,this.logger=r}}class Np extends Wt{constructor(s,r){super(s,r,Ip,cr,()=>ur),this.core=s,this.logger=r}}class kp extends Wt{constructor(s,r){super(s,r,Pp,cr),this.core=s,this.logger=r}}class $p extends Wt{constructor(s,r){super(s,r,Sp,cr,o=>o.id),this.core=s,this.logger=r}}class jp{constructor(s,r){this.core=s,this.logger=r,this.authKeys=new Np(this.core,this.logger),this.pairingTopics=new kp(this.core,this.logger),this.requests=new $p(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}class ms extends Nu{constructor(s){super(s),this.protocol=Ro,this.version=xo,this.name=fs.name,this.events=new Nt.EventEmitter,this.on=(o,a)=>this.events.on(o,a),this.once=(o,a)=>this.events.once(o,a),this.off=(o,a)=>this.events.off(o,a),this.removeListener=(o,a)=>this.events.removeListener(o,a),this.removeAllListeners=o=>this.events.removeAllListeners(o),this.connect=async o=>{try{return await this.engine.connect(o)}catch(a){throw this.logger.error(a.message),a}},this.pair=async o=>{try{return await this.engine.pair(o)}catch(a){throw this.logger.error(a.message),a}},this.approve=async o=>{try{return await this.engine.approve(o)}catch(a){throw this.logger.error(a.message),a}},this.reject=async o=>{try{return await this.engine.reject(o)}catch(a){throw this.logger.error(a.message),a}},this.update=async o=>{try{return await this.engine.update(o)}catch(a){throw this.logger.error(a.message),a}},this.extend=async o=>{try{return await this.engine.extend(o)}catch(a){throw this.logger.error(a.message),a}},this.request=async o=>{try{return await this.engine.request(o)}catch(a){throw this.logger.error(a.message),a}},this.respond=async o=>{try{return await this.engine.respond(o)}catch(a){throw this.logger.error(a.message),a}},this.ping=async o=>{try{return await this.engine.ping(o)}catch(a){throw this.logger.error(a.message),a}},this.emit=async o=>{try{return await this.engine.emit(o)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async o=>{try{return await this.engine.disconnect(o)}catch(a){throw this.logger.error(a.message),a}},this.find=o=>{try{return this.engine.find(o)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(o){throw this.logger.error(o.message),o}},this.authenticate=async o=>{try{return await this.engine.authenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.formatAuthMessage=o=>{try{return this.engine.formatAuthMessage(o)}catch(a){throw this.logger.error(a.message),a}},this.approveSessionAuthenticate=async o=>{try{return await this.engine.approveSessionAuthenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.rejectSessionAuthenticate=async o=>{try{return await this.engine.rejectSessionAuthenticate(o)}catch(a){throw this.logger.error(a.message),a}},this.name=(s==null?void 0:s.name)||fs.name,this.metadata=(s==null?void 0:s.metadata)||(0,d.DaH)(),this.signConfig=s==null?void 0:s.signConfig;const r=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ee.gw)((0,ee.jI)({level:(s==null?void 0:s.logger)||fs.logger}));this.core=(s==null?void 0:s.core)||new fp(s),this.logger=(0,ee.Ep)(r,this.name),this.session=new Op(this.core,this.logger),this.proposal=new Dp(this.core,this.logger),this.pendingRequest=new Tp(this.core,this.logger),this.engine=new Ap(this),this.auth=new jp(this.core,this.logger)}static async init(s){const r=new ms(s);return await r.initialize(),r}get context(){return(0,ee.Fd)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),await this.auth.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(s){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(s.message),s}}}const E1=null,I1=null;var $t=fe(51916);const Oo="error",Mp="wss://relay.walletconnect.com",zp="wc",Up="universal_provider",To=`${zp}@2:${Up}:`,Lp="https://rpc.walletconnect.com/v1/",Pt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof fe.g<"u"?fe.g:typeof self<"u"?self:{},vs={exports:{}};(function(y,s){(function(){var r,o="4.17.21",a=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",v="Invalid `variable` option passed into `_.template`",I="__lodash_hash_undefined__",C=500,F="__lodash_placeholder__",A=1,N=2,M=4,k=1,H=2,K=1,Y=2,ae=4,ie=8,se=16,re=32,ve=64,de=128,Ee=256,Le=512,Ni=30,Mt="...",Zt=800,He=16,Se=1,Xt=2,ki=3,yt=1/0,Ve=9007199254740991,di=17976931348623157e292,mt=NaN,$e=4294967295,$i=$e-1,dr=$e>>>1,Is=[["ary",de],["bind",K],["bindKey",Y],["curry",ie],["curryRight",se],["flip",Le],["partial",re],["partialRight",ve],["rearg",Ee]],vt="[object Arguments]",gi="[object Array]",yd="[object AsyncFunction]",ji="[object Boolean]",Mi="[object Date]",md="[object DOMException]",gr="[object Error]",fr="[object Function]",Jo="[object GeneratorFunction]",ct="[object Map]",zi="[object Number]",vd="[object Null]",St="[object Object]",Go="[object Promise]",wd="[object Proxy]",Ui="[object RegExp]",ut="[object Set]",Li="[object String]",yr="[object Symbol]",_d="[object Undefined]",Hi="[object WeakMap]",bd="[object WeakSet]",Vi="[object ArrayBuffer]",fi="[object DataView]",Ps="[object Float32Array]",Ss="[object Float64Array]",Rs="[object Int8Array]",xs="[object Int16Array]",Cs="[object Int32Array]",qs="[object Uint8Array]",Fs="[object Uint8ClampedArray]",As="[object Uint16Array]",Ds="[object Uint32Array]",Ed=/\b__p \+= '';/g,Id=/\b(__p \+=) '' \+/g,Pd=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Wo=/&(?:amp|lt|gt|quot|#39);/g,Qo=/[&<>"']/g,Sd=RegExp(Wo.source),Rd=RegExp(Qo.source),xd=/<%-([\s\S]+?)%>/g,Cd=/<%([\s\S]+?)%>/g,Yo=/<%=([\s\S]+?)%>/g,qd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Fd=/^\w*$/,Ad=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Os=/[\\^$.*+?()[\]{}|]/g,Dd=RegExp(Os.source),Ts=/^\s+/,Od=/\s/,Td=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Nd=/\{\n\/\* \[wrapped with (.+)\] \*/,kd=/,? & /,$d=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,jd=/[()=,{}\[\]\/\s]/,Md=/\\(\\)?/g,zd=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Zo=/\w*$/,Ud=/^[-+]0x[0-9a-f]+$/i,Ld=/^0b[01]+$/i,Hd=/^\[object .+?Constructor\]$/,Vd=/^0o[0-7]+$/i,Bd=/^(?:0|[1-9]\d*)$/,Kd=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,mr=/($^)/,Jd=/['\n\r\u2028\u2029\\]/g,vr="\\ud800-\\udfff",Gd="\\u0300-\\u036f",Wd="\\ufe20-\\ufe2f",Qd="\\u20d0-\\u20ff",Xo=Gd+Wd+Qd,ea="\\u2700-\\u27bf",ta="a-z\\xdf-\\xf6\\xf8-\\xff",Yd="\\xac\\xb1\\xd7\\xf7",Zd="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Xd="\\u2000-\\u206f",eg=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ia="A-Z\\xc0-\\xd6\\xd8-\\xde",ra="\\ufe0e\\ufe0f",sa=Yd+Zd+Xd+eg,Ns="['\u2019]",tg="["+vr+"]",na="["+sa+"]",wr="["+Xo+"]",oa="\\d+",ig="["+ea+"]",aa="["+ta+"]",ca="[^"+vr+sa+oa+ea+ta+ia+"]",ks="\\ud83c[\\udffb-\\udfff]",rg="(?:"+wr+"|"+ks+")",ua="[^"+vr+"]",$s="(?:\\ud83c[\\udde6-\\uddff]){2}",js="[\\ud800-\\udbff][\\udc00-\\udfff]",yi="["+ia+"]",ha="\\u200d",la="(?:"+aa+"|"+ca+")",sg="(?:"+yi+"|"+ca+")",pa="(?:"+Ns+"(?:d|ll|m|re|s|t|ve))?",da="(?:"+Ns+"(?:D|LL|M|RE|S|T|VE))?",ga=rg+"?",fa="["+ra+"]?",ng="(?:"+ha+"(?:"+[ua,$s,js].join("|")+")"+fa+ga+")*",og="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ag="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ya=fa+ga+ng,cg="(?:"+[ig,$s,js].join("|")+")"+ya,ug="(?:"+[ua+wr+"?",wr,$s,js,tg].join("|")+")",hg=RegExp(Ns,"g"),lg=RegExp(wr,"g"),Ms=RegExp(ks+"(?="+ks+")|"+ug+ya,"g"),pg=RegExp([yi+"?"+aa+"+"+pa+"(?="+[na,yi,"$"].join("|")+")",sg+"+"+da+"(?="+[na,yi+la,"$"].join("|")+")",yi+"?"+la+"+"+pa,yi+"+"+da,ag,og,oa,cg].join("|"),"g"),dg=RegExp("["+ha+vr+Xo+ra+"]"),gg=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,fg=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],yg=-1,le={};le[Ps]=le[Ss]=le[Rs]=le[xs]=le[Cs]=le[qs]=le[Fs]=le[As]=le[Ds]=!0,le[vt]=le[gi]=le[Vi]=le[ji]=le[fi]=le[Mi]=le[gr]=le[fr]=le[ct]=le[zi]=le[St]=le[Ui]=le[ut]=le[Li]=le[Hi]=!1;var he={};he[vt]=he[gi]=he[Vi]=he[fi]=he[ji]=he[Mi]=he[Ps]=he[Ss]=he[Rs]=he[xs]=he[Cs]=he[ct]=he[zi]=he[St]=he[Ui]=he[ut]=he[Li]=he[yr]=he[qs]=he[Fs]=he[As]=he[Ds]=!0,he[gr]=he[fr]=he[Hi]=!1;var mg={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},vg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},wg={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},_g={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},bg=parseFloat,Eg=parseInt,ma=typeof Ti=="object"&&Ti&&Ti.Object===Object&&Ti,Ig=typeof self=="object"&&self&&self.Object===Object&&self,qe=ma||Ig||Function("return this")(),zs=s&&!s.nodeType&&s,ei=zs&&!0&&y&&!y.nodeType&&y,va=ei&&ei.exports===zs,Us=va&&ma.process,Xe=function(){try{var _=ei&&ei.require&&ei.require("util").types;return _||Us&&Us.binding&&Us.binding("util")}catch{}}(),wa=Xe&&Xe.isArrayBuffer,_a=Xe&&Xe.isDate,ba=Xe&&Xe.isMap,Ea=Xe&&Xe.isRegExp,Ia=Xe&&Xe.isSet,Pa=Xe&&Xe.isTypedArray;function Be(_,P,E){switch(E.length){case 0:return _.call(P);case 1:return _.call(P,E[0]);case 2:return _.call(P,E[0],E[1]);case 3:return _.call(P,E[0],E[1],E[2])}return _.apply(P,E)}function Pg(_,P,E,D){for(var V=-1,ne=_==null?0:_.length;++V<ne;){var Ie=_[V];P(D,Ie,E(Ie),_)}return D}function et(_,P){for(var E=-1,D=_==null?0:_.length;++E<D&&P(_[E],E,_)!==!1;);return _}function Sg(_,P){for(var E=_==null?0:_.length;E--&&P(_[E],E,_)!==!1;);return _}function Sa(_,P){for(var E=-1,D=_==null?0:_.length;++E<D;)if(!P(_[E],E,_))return!1;return!0}function zt(_,P){for(var E=-1,D=_==null?0:_.length,V=0,ne=[];++E<D;){var Ie=_[E];P(Ie,E,_)&&(ne[V++]=Ie)}return ne}function _r(_,P){var E=_==null?0:_.length;return!!E&&mi(_,P,0)>-1}function Ls(_,P,E){for(var D=-1,V=_==null?0:_.length;++D<V;)if(E(P,_[D]))return!0;return!1}function ge(_,P){for(var E=-1,D=_==null?0:_.length,V=Array(D);++E<D;)V[E]=P(_[E],E,_);return V}function Ut(_,P){for(var E=-1,D=P.length,V=_.length;++E<D;)_[V+E]=P[E];return _}function Hs(_,P,E,D){var V=-1,ne=_==null?0:_.length;for(D&&ne&&(E=_[++V]);++V<ne;)E=P(E,_[V],V,_);return E}function Rg(_,P,E,D){var V=_==null?0:_.length;for(D&&V&&(E=_[--V]);V--;)E=P(E,_[V],V,_);return E}function Vs(_,P){for(var E=-1,D=_==null?0:_.length;++E<D;)if(P(_[E],E,_))return!0;return!1}var xg=Bs("length");function Cg(_){return _.split("")}function qg(_){return _.match($d)||[]}function Ra(_,P,E){var D;return E(_,function(V,ne,Ie){if(P(V,ne,Ie))return D=ne,!1}),D}function br(_,P,E,D){for(var V=_.length,ne=E+(D?1:-1);D?ne--:++ne<V;)if(P(_[ne],ne,_))return ne;return-1}function mi(_,P,E){return P===P?Ug(_,P,E):br(_,xa,E)}function Fg(_,P,E,D){for(var V=E-1,ne=_.length;++V<ne;)if(D(_[V],P))return V;return-1}function xa(_){return _!==_}function Ca(_,P){var E=_==null?0:_.length;return E?Js(_,P)/E:mt}function Bs(_){return function(P){return P==null?r:P[_]}}function Ks(_){return function(P){return _==null?r:_[P]}}function qa(_,P,E,D,V){return V(_,function(ne,Ie,ue){E=D?(D=!1,ne):P(E,ne,Ie,ue)}),E}function Ag(_,P){var E=_.length;for(_.sort(P);E--;)_[E]=_[E].value;return _}function Js(_,P){for(var E,D=-1,V=_.length;++D<V;){var ne=P(_[D]);ne!==r&&(E=E===r?ne:E+ne)}return E}function Gs(_,P){for(var E=-1,D=Array(_);++E<_;)D[E]=P(E);return D}function Dg(_,P){return ge(P,function(E){return[E,_[E]]})}function Fa(_){return _&&_.slice(0,Ta(_)+1).replace(Ts,"")}function Ke(_){return function(P){return _(P)}}function Ws(_,P){return ge(P,function(E){return _[E]})}function Bi(_,P){return _.has(P)}function Aa(_,P){for(var E=-1,D=_.length;++E<D&&mi(P,_[E],0)>-1;);return E}function Da(_,P){for(var E=_.length;E--&&mi(P,_[E],0)>-1;);return E}function Og(_,P){for(var E=_.length,D=0;E--;)_[E]===P&&++D;return D}var Tg=Ks(mg),Ng=Ks(vg);function kg(_){return"\\"+_g[_]}function $g(_,P){return _==null?r:_[P]}function vi(_){return dg.test(_)}function jg(_){return gg.test(_)}function Mg(_){for(var P,E=[];!(P=_.next()).done;)E.push(P.value);return E}function Qs(_){var P=-1,E=Array(_.size);return _.forEach(function(D,V){E[++P]=[V,D]}),E}function Oa(_,P){return function(E){return _(P(E))}}function Lt(_,P){for(var E=-1,D=_.length,V=0,ne=[];++E<D;){var Ie=_[E];(Ie===P||Ie===F)&&(_[E]=F,ne[V++]=E)}return ne}function Er(_){var P=-1,E=Array(_.size);return _.forEach(function(D){E[++P]=D}),E}function zg(_){var P=-1,E=Array(_.size);return _.forEach(function(D){E[++P]=[D,D]}),E}function Ug(_,P,E){for(var D=E-1,V=_.length;++D<V;)if(_[D]===P)return D;return-1}function Lg(_,P,E){for(var D=E+1;D--;)if(_[D]===P)return D;return D}function wi(_){return vi(_)?Vg(_):xg(_)}function ht(_){return vi(_)?Bg(_):Cg(_)}function Ta(_){for(var P=_.length;P--&&Od.test(_.charAt(P)););return P}var Hg=Ks(wg);function Vg(_){for(var P=Ms.lastIndex=0;Ms.test(_);)++P;return P}function Bg(_){return _.match(Ms)||[]}function Kg(_){return _.match(pg)||[]}var Jg=function _(P){P=P==null?qe:_i.defaults(qe.Object(),P,_i.pick(qe,fg));var E=P.Array,D=P.Date,V=P.Error,ne=P.Function,Ie=P.Math,ue=P.Object,Ys=P.RegExp,Gg=P.String,tt=P.TypeError,Ir=E.prototype,Wg=ne.prototype,bi=ue.prototype,Pr=P["__core-js_shared__"],Sr=Wg.toString,ce=bi.hasOwnProperty,Qg=0,Na=function(){var e=/[^.]+$/.exec(Pr&&Pr.keys&&Pr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Rr=bi.toString,Yg=Sr.call(ue),Zg=qe._,Xg=Ys("^"+Sr.call(ce).replace(Os,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xr=va?P.Buffer:r,Ht=P.Symbol,Cr=P.Uint8Array,ka=xr?xr.allocUnsafe:r,qr=Oa(ue.getPrototypeOf,ue),$a=ue.create,ja=bi.propertyIsEnumerable,Fr=Ir.splice,Ma=Ht?Ht.isConcatSpreadable:r,Ki=Ht?Ht.iterator:r,ti=Ht?Ht.toStringTag:r,Ar=function(){try{var e=oi(ue,"defineProperty");return e({},"",{}),e}catch{}}(),ef=P.clearTimeout!==qe.clearTimeout&&P.clearTimeout,tf=D&&D.now!==qe.Date.now&&D.now,rf=P.setTimeout!==qe.setTimeout&&P.setTimeout,Dr=Ie.ceil,Or=Ie.floor,Zs=ue.getOwnPropertySymbols,sf=xr?xr.isBuffer:r,za=P.isFinite,nf=Ir.join,of=Oa(ue.keys,ue),Pe=Ie.max,Ae=Ie.min,af=D.now,cf=P.parseInt,Ua=Ie.random,uf=Ir.reverse,Xs=oi(P,"DataView"),Ji=oi(P,"Map"),en=oi(P,"Promise"),Ei=oi(P,"Set"),Gi=oi(P,"WeakMap"),Wi=oi(ue,"create"),Tr=Gi&&new Gi,Ii={},hf=ai(Xs),lf=ai(Ji),pf=ai(en),df=ai(Ei),gf=ai(Gi),Nr=Ht?Ht.prototype:r,Qi=Nr?Nr.valueOf:r,La=Nr?Nr.toString:r;function p(e){if(me(e)&&!B(e)&&!(e instanceof X)){if(e instanceof it)return e;if(ce.call(e,"__wrapped__"))return Hc(e)}return new it(e)}var Pi=function(){function e(){}return function(t){if(!ye(t))return{};if($a)return $a(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function kr(){}function it(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}p.templateSettings={escape:xd,evaluate:Cd,interpolate:Yo,variable:"",imports:{_:p}},p.prototype=kr.prototype,p.prototype.constructor=p,it.prototype=Pi(kr.prototype),it.prototype.constructor=it;function X(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=$e,this.__views__=[]}function ff(){var e=new X(this.__wrapped__);return e.__actions__=je(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=je(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=je(this.__views__),e}function yf(){if(this.__filtered__){var e=new X(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function mf(){var e=this.__wrapped__.value(),t=this.__dir__,n=B(e),u=t<0,l=n?e.length:0,f=qy(0,l,this.__views__),m=f.start,w=f.end,b=w-m,S=u?w:m-1,R=this.__iteratees__,x=R.length,q=0,T=Ae(b,this.__takeCount__);if(!n||!u&&l==b&&T==b)return pc(e,this.__actions__);var z=[];e:for(;b--&&q<T;){S+=t;for(var G=-1,U=e[S];++G<x;){var Z=R[G],te=Z.iteratee,We=Z.type,Ne=te(U);if(We==Xt)U=Ne;else if(!Ne){if(We==Se)continue e;break e}}z[q++]=U}return z}X.prototype=Pi(kr.prototype),X.prototype.constructor=X;function ii(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var u=e[t];this.set(u[0],u[1])}}function vf(){this.__data__=Wi?Wi(null):{},this.size=0}function wf(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function _f(e){var t=this.__data__;if(Wi){var n=t[e];return n===I?r:n}return ce.call(t,e)?t[e]:r}function bf(e){var t=this.__data__;return Wi?t[e]!==r:ce.call(t,e)}function Ef(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Wi&&t===r?I:t,this}ii.prototype.clear=vf,ii.prototype.delete=wf,ii.prototype.get=_f,ii.prototype.has=bf,ii.prototype.set=Ef;function Rt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var u=e[t];this.set(u[0],u[1])}}function If(){this.__data__=[],this.size=0}function Pf(e){var t=this.__data__,n=$r(t,e);if(n<0)return!1;var u=t.length-1;return n==u?t.pop():Fr.call(t,n,1),--this.size,!0}function Sf(e){var t=this.__data__,n=$r(t,e);return n<0?r:t[n][1]}function Rf(e){return $r(this.__data__,e)>-1}function xf(e,t){var n=this.__data__,u=$r(n,e);return u<0?(++this.size,n.push([e,t])):n[u][1]=t,this}Rt.prototype.clear=If,Rt.prototype.delete=Pf,Rt.prototype.get=Sf,Rt.prototype.has=Rf,Rt.prototype.set=xf;function xt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var u=e[t];this.set(u[0],u[1])}}function Cf(){this.size=0,this.__data__={hash:new ii,map:new(Ji||Rt),string:new ii}}function qf(e){var t=Wr(this,e).delete(e);return this.size-=t?1:0,t}function Ff(e){return Wr(this,e).get(e)}function Af(e){return Wr(this,e).has(e)}function Df(e,t){var n=Wr(this,e),u=n.size;return n.set(e,t),this.size+=n.size==u?0:1,this}xt.prototype.clear=Cf,xt.prototype.delete=qf,xt.prototype.get=Ff,xt.prototype.has=Af,xt.prototype.set=Df;function ri(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new xt;++t<n;)this.add(e[t])}function Of(e){return this.__data__.set(e,I),this}function Tf(e){return this.__data__.has(e)}ri.prototype.add=ri.prototype.push=Of,ri.prototype.has=Tf;function lt(e){var t=this.__data__=new Rt(e);this.size=t.size}function Nf(){this.__data__=new Rt,this.size=0}function kf(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function $f(e){return this.__data__.get(e)}function jf(e){return this.__data__.has(e)}function Mf(e,t){var n=this.__data__;if(n instanceof Rt){var u=n.__data__;if(!Ji||u.length<a-1)return u.push([e,t]),this.size=++n.size,this;n=this.__data__=new xt(u)}return n.set(e,t),this.size=n.size,this}lt.prototype.clear=Nf,lt.prototype.delete=kf,lt.prototype.get=$f,lt.prototype.has=jf,lt.prototype.set=Mf;function Ha(e,t){var n=B(e),u=!n&&ci(e),l=!n&&!u&&Gt(e),f=!n&&!u&&!l&&Ci(e),m=n||u||l||f,w=m?Gs(e.length,Gg):[],b=w.length;for(var S in e)(t||ce.call(e,S))&&!(m&&(S=="length"||l&&(S=="offset"||S=="parent")||f&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||At(S,b)))&&w.push(S);return w}function Va(e){var t=e.length;return t?e[pn(0,t-1)]:r}function zf(e,t){return Qr(je(e),si(t,0,e.length))}function Uf(e){return Qr(je(e))}function tn(e,t,n){(n!==r&&!pt(e[t],n)||n===r&&!(t in e))&&Ct(e,t,n)}function Yi(e,t,n){var u=e[t];(!(ce.call(e,t)&&pt(u,n))||n===r&&!(t in e))&&Ct(e,t,n)}function $r(e,t){for(var n=e.length;n--;)if(pt(e[n][0],t))return n;return-1}function Lf(e,t,n,u){return Vt(e,function(l,f,m){t(u,l,n(l),m)}),u}function Ba(e,t){return e&&_t(t,Re(t),e)}function Hf(e,t){return e&&_t(t,ze(t),e)}function Ct(e,t,n){t=="__proto__"&&Ar?Ar(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function rn(e,t){for(var n=-1,u=t.length,l=E(u),f=e==null;++n<u;)l[n]=f?r:$n(e,t[n]);return l}function si(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function rt(e,t,n,u,l,f){var m,w=t&A,b=t&N,S=t&M;if(n&&(m=l?n(e,u,l,f):n(e)),m!==r)return m;if(!ye(e))return e;var R=B(e);if(R){if(m=Ay(e),!w)return je(e,m)}else{var x=De(e),q=x==fr||x==Jo;if(Gt(e))return fc(e,w);if(x==St||x==vt||q&&!l){if(m=b||q?{}:Tc(e),!w)return b?_y(e,Hf(m,e)):wy(e,Ba(m,e))}else{if(!he[x])return l?e:{};m=Dy(e,x,w)}}f||(f=new lt);var T=f.get(e);if(T)return T;f.set(e,m),uu(e)?e.forEach(function(U){m.add(rt(U,t,n,U,e,f))}):au(e)&&e.forEach(function(U,Z){m.set(Z,rt(U,t,n,Z,e,f))});var z=S?b?In:En:b?ze:Re,G=R?r:z(e);return et(G||e,function(U,Z){G&&(Z=U,U=e[Z]),Yi(m,Z,rt(U,t,n,Z,e,f))}),m}function Vf(e){var t=Re(e);return function(n){return Ka(n,e,t)}}function Ka(e,t,n){var u=n.length;if(e==null)return!u;for(e=ue(e);u--;){var l=n[u],f=t[l],m=e[l];if(m===r&&!(l in e)||!f(m))return!1}return!0}function Ja(e,t,n){if(typeof e!="function")throw new tt(g);return sr(function(){e.apply(r,n)},t)}function Zi(e,t,n,u){var l=-1,f=_r,m=!0,w=e.length,b=[],S=t.length;if(!w)return b;n&&(t=ge(t,Ke(n))),u?(f=Ls,m=!1):t.length>=a&&(f=Bi,m=!1,t=new ri(t));e:for(;++l<w;){var R=e[l],x=n==null?R:n(R);if(R=u||R!==0?R:0,m&&x===x){for(var q=S;q--;)if(t[q]===x)continue e;b.push(R)}else f(t,x,u)||b.push(R)}return b}var Vt=_c(wt),Ga=_c(nn,!0);function Bf(e,t){var n=!0;return Vt(e,function(u,l,f){return n=!!t(u,l,f),n}),n}function jr(e,t,n){for(var u=-1,l=e.length;++u<l;){var f=e[u],m=t(f);if(m!=null&&(w===r?m===m&&!Ge(m):n(m,w)))var w=m,b=f}return b}function Kf(e,t,n,u){var l=e.length;for(n=J(n),n<0&&(n=-n>l?0:l+n),u=u===r||u>l?l:J(u),u<0&&(u+=l),u=n>u?0:lu(u);n<u;)e[n++]=t;return e}function Wa(e,t){var n=[];return Vt(e,function(u,l,f){t(u,l,f)&&n.push(u)}),n}function Fe(e,t,n,u,l){var f=-1,m=e.length;for(n||(n=Ty),l||(l=[]);++f<m;){var w=e[f];t>0&&n(w)?t>1?Fe(w,t-1,n,u,l):Ut(l,w):u||(l[l.length]=w)}return l}var sn=bc(),Qa=bc(!0);function wt(e,t){return e&&sn(e,t,Re)}function nn(e,t){return e&&Qa(e,t,Re)}function Mr(e,t){return zt(t,function(n){return Dt(e[n])})}function ni(e,t){t=Kt(t,e);for(var n=0,u=t.length;e!=null&&n<u;)e=e[Et(t[n++])];return n&&n==u?e:r}function Ya(e,t,n){var u=t(e);return B(e)?u:Ut(u,n(e))}function Oe(e){return e==null?e===r?_d:vd:ti&&ti in ue(e)?Cy(e):Uy(e)}function on(e,t){return e>t}function Jf(e,t){return e!=null&&ce.call(e,t)}function Gf(e,t){return e!=null&&t in ue(e)}function Wf(e,t,n){return e>=Ae(t,n)&&e<Pe(t,n)}function an(e,t,n){for(var u=n?Ls:_r,l=e[0].length,f=e.length,m=f,w=E(f),b=1/0,S=[];m--;){var R=e[m];m&&t&&(R=ge(R,Ke(t))),b=Ae(R.length,b),w[m]=!n&&(t||l>=120&&R.length>=120)?new ri(m&&R):r}R=e[0];var x=-1,q=w[0];e:for(;++x<l&&S.length<b;){var T=R[x],z=t?t(T):T;if(T=n||T!==0?T:0,!(q?Bi(q,z):u(S,z,n))){for(m=f;--m;){var G=w[m];if(!(G?Bi(G,z):u(e[m],z,n)))continue e}q&&q.push(z),S.push(T)}}return S}function Qf(e,t,n,u){return wt(e,function(l,f,m){t(u,n(l),f,m)}),u}function Xi(e,t,n){t=Kt(t,e),e=jc(e,t);var u=e==null?e:e[Et(nt(t))];return u==null?r:Be(u,e,n)}function Za(e){return me(e)&&Oe(e)==vt}function Yf(e){return me(e)&&Oe(e)==Vi}function Zf(e){return me(e)&&Oe(e)==Mi}function er(e,t,n,u,l){return e===t?!0:e==null||t==null||!me(e)&&!me(t)?e!==e&&t!==t:Xf(e,t,n,u,er,l)}function Xf(e,t,n,u,l,f){var m=B(e),w=B(t),b=m?gi:De(e),S=w?gi:De(t);b=b==vt?St:b,S=S==vt?St:S;var R=b==St,x=S==St,q=b==S;if(q&&Gt(e)){if(!Gt(t))return!1;m=!0,R=!1}if(q&&!R)return f||(f=new lt),m||Ci(e)?Ac(e,t,n,u,l,f):Ry(e,t,b,n,u,l,f);if(!(n&k)){var T=R&&ce.call(e,"__wrapped__"),z=x&&ce.call(t,"__wrapped__");if(T||z){var G=T?e.value():e,U=z?t.value():t;return f||(f=new lt),l(G,U,n,u,f)}}return q?(f||(f=new lt),xy(e,t,n,u,l,f)):!1}function ey(e){return me(e)&&De(e)==ct}function cn(e,t,n,u){var l=n.length,f=l,m=!u;if(e==null)return!f;for(e=ue(e);l--;){var w=n[l];if(m&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++l<f;){w=n[l];var b=w[0],S=e[b],R=w[1];if(m&&w[2]){if(S===r&&!(b in e))return!1}else{var x=new lt;if(u)var q=u(S,R,b,e,t,x);if(!(q===r?er(R,S,k|H,u,x):q))return!1}}return!0}function Xa(e){if(!ye(e)||ky(e))return!1;var t=Dt(e)?Xg:Hd;return t.test(ai(e))}function ty(e){return me(e)&&Oe(e)==Ui}function iy(e){return me(e)&&De(e)==ut}function ry(e){return me(e)&&is(e.length)&&!!le[Oe(e)]}function ec(e){return typeof e=="function"?e:e==null?Ue:typeof e=="object"?B(e)?rc(e[0],e[1]):ic(e):Eu(e)}function un(e){if(!rr(e))return of(e);var t=[];for(var n in ue(e))ce.call(e,n)&&n!="constructor"&&t.push(n);return t}function sy(e){if(!ye(e))return zy(e);var t=rr(e),n=[];for(var u in e)u=="constructor"&&(t||!ce.call(e,u))||n.push(u);return n}function hn(e,t){return e<t}function tc(e,t){var n=-1,u=Me(e)?E(e.length):[];return Vt(e,function(l,f,m){u[++n]=t(l,f,m)}),u}function ic(e){var t=Sn(e);return t.length==1&&t[0][2]?kc(t[0][0],t[0][1]):function(n){return n===e||cn(n,e,t)}}function rc(e,t){return xn(e)&&Nc(t)?kc(Et(e),t):function(n){var u=$n(n,e);return u===r&&u===t?jn(n,e):er(t,u,k|H)}}function zr(e,t,n,u,l){e!==t&&sn(t,function(f,m){if(l||(l=new lt),ye(f))ny(e,t,m,n,zr,u,l);else{var w=u?u(qn(e,m),f,m+"",e,t,l):r;w===r&&(w=f),tn(e,m,w)}},ze)}function ny(e,t,n,u,l,f,m){var w=qn(e,n),b=qn(t,n),S=m.get(b);if(S){tn(e,n,S);return}var R=f?f(w,b,n+"",e,t,m):r,x=R===r;if(x){var q=B(b),T=!q&&Gt(b),z=!q&&!T&&Ci(b);R=b,q||T||z?B(w)?R=w:we(w)?R=je(w):T?(x=!1,R=fc(b,!0)):z?(x=!1,R=yc(b,!0)):R=[]:nr(b)||ci(b)?(R=w,ci(w)?R=pu(w):(!ye(w)||Dt(w))&&(R=Tc(b))):x=!1}x&&(m.set(b,R),l(R,b,u,f,m),m.delete(b)),tn(e,n,R)}function sc(e,t){var n=e.length;if(n)return t+=t<0?n:0,At(t,n)?e[t]:r}function nc(e,t,n){t.length?t=ge(t,function(f){return B(f)?function(m){return ni(m,f.length===1?f[0]:f)}:f}):t=[Ue];var u=-1;t=ge(t,Ke(j()));var l=tc(e,function(f,m,w){var b=ge(t,function(S){return S(f)});return{criteria:b,index:++u,value:f}});return Ag(l,function(f,m){return vy(f,m,n)})}function oy(e,t){return oc(e,t,function(n,u){return jn(e,u)})}function oc(e,t,n){for(var u=-1,l=t.length,f={};++u<l;){var m=t[u],w=ni(e,m);n(w,m)&&tr(f,Kt(m,e),w)}return f}function ay(e){return function(t){return ni(t,e)}}function ln(e,t,n,u){var l=u?Fg:mi,f=-1,m=t.length,w=e;for(e===t&&(t=je(t)),n&&(w=ge(e,Ke(n)));++f<m;)for(var b=0,S=t[f],R=n?n(S):S;(b=l(w,R,b,u))>-1;)w!==e&&Fr.call(w,b,1),Fr.call(e,b,1);return e}function ac(e,t){for(var n=e?t.length:0,u=n-1;n--;){var l=t[n];if(n==u||l!==f){var f=l;At(l)?Fr.call(e,l,1):fn(e,l)}}return e}function pn(e,t){return e+Or(Ua()*(t-e+1))}function cy(e,t,n,u){for(var l=-1,f=Pe(Dr((t-e)/(n||1)),0),m=E(f);f--;)m[u?f:++l]=e,e+=n;return m}function dn(e,t){var n="";if(!e||t<1||t>Ve)return n;do t%2&&(n+=e),t=Or(t/2),t&&(e+=e);while(t);return n}function Q(e,t){return Fn($c(e,t,Ue),e+"")}function uy(e){return Va(qi(e))}function hy(e,t){var n=qi(e);return Qr(n,si(t,0,n.length))}function tr(e,t,n,u){if(!ye(e))return e;t=Kt(t,e);for(var l=-1,f=t.length,m=f-1,w=e;w!=null&&++l<f;){var b=Et(t[l]),S=n;if(b==="__proto__"||b==="constructor"||b==="prototype")return e;if(l!=m){var R=w[b];S=u?u(R,b,w):r,S===r&&(S=ye(R)?R:At(t[l+1])?[]:{})}Yi(w,b,S),w=w[b]}return e}var cc=Tr?function(e,t){return Tr.set(e,t),e}:Ue,ly=Ar?function(e,t){return Ar(e,"toString",{configurable:!0,enumerable:!1,value:zn(t),writable:!0})}:Ue;function py(e){return Qr(qi(e))}function st(e,t,n){var u=-1,l=e.length;t<0&&(t=-t>l?0:l+t),n=n>l?l:n,n<0&&(n+=l),l=t>n?0:n-t>>>0,t>>>=0;for(var f=E(l);++u<l;)f[u]=e[u+t];return f}function dy(e,t){var n;return Vt(e,function(u,l,f){return n=t(u,l,f),!n}),!!n}function Ur(e,t,n){var u=0,l=e==null?u:e.length;if(typeof t=="number"&&t===t&&l<=dr){for(;u<l;){var f=u+l>>>1,m=e[f];m!==null&&!Ge(m)&&(n?m<=t:m<t)?u=f+1:l=f}return l}return gn(e,t,Ue,n)}function gn(e,t,n,u){var l=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var m=t!==t,w=t===null,b=Ge(t),S=t===r;l<f;){var R=Or((l+f)/2),x=n(e[R]),q=x!==r,T=x===null,z=x===x,G=Ge(x);if(m)var U=u||z;else S?U=z&&(u||q):w?U=z&&q&&(u||!T):b?U=z&&q&&!T&&(u||!G):T||G?U=!1:U=u?x<=t:x<t;U?l=R+1:f=R}return Ae(f,$i)}function uc(e,t){for(var n=-1,u=e.length,l=0,f=[];++n<u;){var m=e[n],w=t?t(m):m;if(!n||!pt(w,b)){var b=w;f[l++]=m===0?0:m}}return f}function hc(e){return typeof e=="number"?e:Ge(e)?mt:+e}function Je(e){if(typeof e=="string")return e;if(B(e))return ge(e,Je)+"";if(Ge(e))return La?La.call(e):"";var t=e+"";return t=="0"&&1/e==-yt?"-0":t}function Bt(e,t,n){var u=-1,l=_r,f=e.length,m=!0,w=[],b=w;if(n)m=!1,l=Ls;else if(f>=a){var S=t?null:Py(e);if(S)return Er(S);m=!1,l=Bi,b=new ri}else b=t?[]:w;e:for(;++u<f;){var R=e[u],x=t?t(R):R;if(R=n||R!==0?R:0,m&&x===x){for(var q=b.length;q--;)if(b[q]===x)continue e;t&&b.push(x),w.push(R)}else l(b,x,n)||(b!==w&&b.push(x),w.push(R))}return w}function fn(e,t){return t=Kt(t,e),e=jc(e,t),e==null||delete e[Et(nt(t))]}function lc(e,t,n,u){return tr(e,t,n(ni(e,t)),u)}function Lr(e,t,n,u){for(var l=e.length,f=u?l:-1;(u?f--:++f<l)&&t(e[f],f,e););return n?st(e,u?0:f,u?f+1:l):st(e,u?f+1:0,u?l:f)}function pc(e,t){var n=e;return n instanceof X&&(n=n.value()),Hs(t,function(u,l){return l.func.apply(l.thisArg,Ut([u],l.args))},n)}function yn(e,t,n){var u=e.length;if(u<2)return u?Bt(e[0]):[];for(var l=-1,f=E(u);++l<u;)for(var m=e[l],w=-1;++w<u;)w!=l&&(f[l]=Zi(f[l]||m,e[w],t,n));return Bt(Fe(f,1),t,n)}function dc(e,t,n){for(var u=-1,l=e.length,f=t.length,m={};++u<l;){var w=u<f?t[u]:r;n(m,e[u],w)}return m}function mn(e){return we(e)?e:[]}function vn(e){return typeof e=="function"?e:Ue}function Kt(e,t){return B(e)?e:xn(e,t)?[e]:Lc(oe(e))}var gy=Q;function Jt(e,t,n){var u=e.length;return n=n===r?u:n,!t&&n>=u?e:st(e,t,n)}var gc=ef||function(e){return qe.clearTimeout(e)};function fc(e,t){if(t)return e.slice();var n=e.length,u=ka?ka(n):new e.constructor(n);return e.copy(u),u}function wn(e){var t=new e.constructor(e.byteLength);return new Cr(t).set(new Cr(e)),t}function fy(e,t){var n=t?wn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function yy(e){var t=new e.constructor(e.source,Zo.exec(e));return t.lastIndex=e.lastIndex,t}function my(e){return Qi?ue(Qi.call(e)):{}}function yc(e,t){var n=t?wn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function mc(e,t){if(e!==t){var n=e!==r,u=e===null,l=e===e,f=Ge(e),m=t!==r,w=t===null,b=t===t,S=Ge(t);if(!w&&!S&&!f&&e>t||f&&m&&b&&!w&&!S||u&&m&&b||!n&&b||!l)return 1;if(!u&&!f&&!S&&e<t||S&&n&&l&&!u&&!f||w&&n&&l||!m&&l||!b)return-1}return 0}function vy(e,t,n){for(var u=-1,l=e.criteria,f=t.criteria,m=l.length,w=n.length;++u<m;){var b=mc(l[u],f[u]);if(b){if(u>=w)return b;var S=n[u];return b*(S=="desc"?-1:1)}}return e.index-t.index}function vc(e,t,n,u){for(var l=-1,f=e.length,m=n.length,w=-1,b=t.length,S=Pe(f-m,0),R=E(b+S),x=!u;++w<b;)R[w]=t[w];for(;++l<m;)(x||l<f)&&(R[n[l]]=e[l]);for(;S--;)R[w++]=e[l++];return R}function wc(e,t,n,u){for(var l=-1,f=e.length,m=-1,w=n.length,b=-1,S=t.length,R=Pe(f-w,0),x=E(R+S),q=!u;++l<R;)x[l]=e[l];for(var T=l;++b<S;)x[T+b]=t[b];for(;++m<w;)(q||l<f)&&(x[T+n[m]]=e[l++]);return x}function je(e,t){var n=-1,u=e.length;for(t||(t=E(u));++n<u;)t[n]=e[n];return t}function _t(e,t,n,u){var l=!n;n||(n={});for(var f=-1,m=t.length;++f<m;){var w=t[f],b=u?u(n[w],e[w],w,n,e):r;b===r&&(b=e[w]),l?Ct(n,w,b):Yi(n,w,b)}return n}function wy(e,t){return _t(e,Rn(e),t)}function _y(e,t){return _t(e,Dc(e),t)}function Hr(e,t){return function(n,u){var l=B(n)?Pg:Lf,f=t?t():{};return l(n,e,j(u,2),f)}}function Si(e){return Q(function(t,n){var u=-1,l=n.length,f=l>1?n[l-1]:r,m=l>2?n[2]:r;for(f=e.length>3&&typeof f=="function"?(l--,f):r,m&&Te(n[0],n[1],m)&&(f=l<3?r:f,l=1),t=ue(t);++u<l;){var w=n[u];w&&e(t,w,u,f)}return t})}function _c(e,t){return function(n,u){if(n==null)return n;if(!Me(n))return e(n,u);for(var l=n.length,f=t?l:-1,m=ue(n);(t?f--:++f<l)&&u(m[f],f,m)!==!1;);return n}}function bc(e){return function(t,n,u){for(var l=-1,f=ue(t),m=u(t),w=m.length;w--;){var b=m[e?w:++l];if(n(f[b],b,f)===!1)break}return t}}function by(e,t,n){var u=t&K,l=ir(e);function f(){var m=this&&this!==qe&&this instanceof f?l:e;return m.apply(u?n:this,arguments)}return f}function Ec(e){return function(t){t=oe(t);var n=vi(t)?ht(t):r,u=n?n[0]:t.charAt(0),l=n?Jt(n,1).join(""):t.slice(1);return u[e]()+l}}function Ri(e){return function(t){return Hs(_u(wu(t).replace(hg,"")),e,"")}}function ir(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Pi(e.prototype),u=e.apply(n,t);return ye(u)?u:n}}function Ey(e,t,n){var u=ir(e);function l(){for(var f=arguments.length,m=E(f),w=f,b=xi(l);w--;)m[w]=arguments[w];var S=f<3&&m[0]!==b&&m[f-1]!==b?[]:Lt(m,b);if(f-=S.length,f<n)return xc(e,t,Vr,l.placeholder,r,m,S,r,r,n-f);var R=this&&this!==qe&&this instanceof l?u:e;return Be(R,this,m)}return l}function Ic(e){return function(t,n,u){var l=ue(t);if(!Me(t)){var f=j(n,3);t=Re(t),n=function(w){return f(l[w],w,l)}}var m=e(t,n,u);return m>-1?l[f?t[m]:m]:r}}function Pc(e){return Ft(function(t){var n=t.length,u=n,l=it.prototype.thru;for(e&&t.reverse();u--;){var f=t[u];if(typeof f!="function")throw new tt(g);if(l&&!m&&Gr(f)=="wrapper")var m=new it([],!0)}for(u=m?u:n;++u<n;){f=t[u];var w=Gr(f),b=w=="wrapper"?Pn(f):r;b&&Cn(b[0])&&b[1]==(de|ie|re|Ee)&&!b[4].length&&b[9]==1?m=m[Gr(b[0])].apply(m,b[3]):m=f.length==1&&Cn(f)?m[w]():m.thru(f)}return function(){var S=arguments,R=S[0];if(m&&S.length==1&&B(R))return m.plant(R).value();for(var x=0,q=n?t[x].apply(this,S):R;++x<n;)q=t[x].call(this,q);return q}})}function Vr(e,t,n,u,l,f,m,w,b,S){var R=t&de,x=t&K,q=t&Y,T=t&(ie|se),z=t&Le,G=q?r:ir(e);function U(){for(var Z=arguments.length,te=E(Z),We=Z;We--;)te[We]=arguments[We];if(T)var Ne=xi(U),Qe=Og(te,Ne);if(u&&(te=vc(te,u,l,T)),f&&(te=wc(te,f,m,T)),Z-=Qe,T&&Z<S){var _e=Lt(te,Ne);return xc(e,t,Vr,U.placeholder,n,te,_e,w,b,S-Z)}var dt=x?n:this,Tt=q?dt[e]:e;return Z=te.length,w?te=Ly(te,w):z&&Z>1&&te.reverse(),R&&b<Z&&(te.length=b),this&&this!==qe&&this instanceof U&&(Tt=G||ir(Tt)),Tt.apply(dt,te)}return U}function Sc(e,t){return function(n,u){return Qf(n,e,t(u),{})}}function Br(e,t){return function(n,u){var l;if(n===r&&u===r)return t;if(n!==r&&(l=n),u!==r){if(l===r)return u;typeof n=="string"||typeof u=="string"?(n=Je(n),u=Je(u)):(n=hc(n),u=hc(u)),l=e(n,u)}return l}}function _n(e){return Ft(function(t){return t=ge(t,Ke(j())),Q(function(n){var u=this;return e(t,function(l){return Be(l,u,n)})})})}function Kr(e,t){t=t===r?" ":Je(t);var n=t.length;if(n<2)return n?dn(t,e):t;var u=dn(t,Dr(e/wi(t)));return vi(t)?Jt(ht(u),0,e).join(""):u.slice(0,e)}function Iy(e,t,n,u){var l=t&K,f=ir(e);function m(){for(var w=-1,b=arguments.length,S=-1,R=u.length,x=E(R+b),q=this&&this!==qe&&this instanceof m?f:e;++S<R;)x[S]=u[S];for(;b--;)x[S++]=arguments[++w];return Be(q,l?n:this,x)}return m}function Rc(e){return function(t,n,u){return u&&typeof u!="number"&&Te(t,n,u)&&(n=u=r),t=Ot(t),n===r?(n=t,t=0):n=Ot(n),u=u===r?t<n?1:-1:Ot(u),cy(t,n,u,e)}}function Jr(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=ot(t),n=ot(n)),e(t,n)}}function xc(e,t,n,u,l,f,m,w,b,S){var R=t&ie,x=R?m:r,q=R?r:m,T=R?f:r,z=R?r:f;t|=R?re:ve,t&=~(R?ve:re),t&ae||(t&=~(K|Y));var G=[e,t,l,T,x,z,q,w,b,S],U=n.apply(r,G);return Cn(e)&&Mc(U,G),U.placeholder=u,zc(U,e,t)}function bn(e){var t=Ie[e];return function(n,u){if(n=ot(n),u=u==null?0:Ae(J(u),292),u&&za(n)){var l=(oe(n)+"e").split("e"),f=t(l[0]+"e"+(+l[1]+u));return l=(oe(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-u))}return t(n)}}var Py=Ei&&1/Er(new Ei([,-0]))[1]==yt?function(e){return new Ei(e)}:Hn;function Cc(e){return function(t){var n=De(t);return n==ct?Qs(t):n==ut?zg(t):Dg(t,e(t))}}function qt(e,t,n,u,l,f,m,w){var b=t&Y;if(!b&&typeof e!="function")throw new tt(g);var S=u?u.length:0;if(S||(t&=~(re|ve),u=l=r),m=m===r?m:Pe(J(m),0),w=w===r?w:J(w),S-=l?l.length:0,t&ve){var R=u,x=l;u=l=r}var q=b?r:Pn(e),T=[e,t,n,u,l,R,x,f,m,w];if(q&&My(T,q),e=T[0],t=T[1],n=T[2],u=T[3],l=T[4],w=T[9]=T[9]===r?b?0:e.length:Pe(T[9]-S,0),!w&&t&(ie|se)&&(t&=~(ie|se)),!t||t==K)var z=by(e,t,n);else t==ie||t==se?z=Ey(e,t,w):(t==re||t==(K|re))&&!l.length?z=Iy(e,t,n,u):z=Vr.apply(r,T);var G=q?cc:Mc;return zc(G(z,T),e,t)}function qc(e,t,n,u){return e===r||pt(e,bi[n])&&!ce.call(u,n)?t:e}function Fc(e,t,n,u,l,f){return ye(e)&&ye(t)&&(f.set(t,e),zr(e,t,r,Fc,f),f.delete(t)),e}function Sy(e){return nr(e)?r:e}function Ac(e,t,n,u,l,f){var m=n&k,w=e.length,b=t.length;if(w!=b&&!(m&&b>w))return!1;var S=f.get(e),R=f.get(t);if(S&&R)return S==t&&R==e;var x=-1,q=!0,T=n&H?new ri:r;for(f.set(e,t),f.set(t,e);++x<w;){var z=e[x],G=t[x];if(u)var U=m?u(G,z,x,t,e,f):u(z,G,x,e,t,f);if(U!==r){if(U)continue;q=!1;break}if(T){if(!Vs(t,function(Z,te){if(!Bi(T,te)&&(z===Z||l(z,Z,n,u,f)))return T.push(te)})){q=!1;break}}else if(!(z===G||l(z,G,n,u,f))){q=!1;break}}return f.delete(e),f.delete(t),q}function Ry(e,t,n,u,l,f,m){switch(n){case fi:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Vi:return!(e.byteLength!=t.byteLength||!f(new Cr(e),new Cr(t)));case ji:case Mi:case zi:return pt(+e,+t);case gr:return e.name==t.name&&e.message==t.message;case Ui:case Li:return e==t+"";case ct:var w=Qs;case ut:var b=u&k;if(w||(w=Er),e.size!=t.size&&!b)return!1;var S=m.get(e);if(S)return S==t;u|=H,m.set(e,t);var R=Ac(w(e),w(t),u,l,f,m);return m.delete(e),R;case yr:if(Qi)return Qi.call(e)==Qi.call(t)}return!1}function xy(e,t,n,u,l,f){var m=n&k,w=En(e),b=w.length,S=En(t),R=S.length;if(b!=R&&!m)return!1;for(var x=b;x--;){var q=w[x];if(!(m?q in t:ce.call(t,q)))return!1}var T=f.get(e),z=f.get(t);if(T&&z)return T==t&&z==e;var G=!0;f.set(e,t),f.set(t,e);for(var U=m;++x<b;){q=w[x];var Z=e[q],te=t[q];if(u)var We=m?u(te,Z,q,t,e,f):u(Z,te,q,e,t,f);if(!(We===r?Z===te||l(Z,te,n,u,f):We)){G=!1;break}U||(U=q=="constructor")}if(G&&!U){var Ne=e.constructor,Qe=t.constructor;Ne!=Qe&&"constructor"in e&&"constructor"in t&&!(typeof Ne=="function"&&Ne instanceof Ne&&typeof Qe=="function"&&Qe instanceof Qe)&&(G=!1)}return f.delete(e),f.delete(t),G}function Ft(e){return Fn($c(e,r,Kc),e+"")}function En(e){return Ya(e,Re,Rn)}function In(e){return Ya(e,ze,Dc)}var Pn=Tr?function(e){return Tr.get(e)}:Hn;function Gr(e){for(var t=e.name+"",n=Ii[t],u=ce.call(Ii,t)?n.length:0;u--;){var l=n[u],f=l.func;if(f==null||f==e)return l.name}return t}function xi(e){var t=ce.call(p,"placeholder")?p:e;return t.placeholder}function j(){var e=p.iteratee||Un;return e=e===Un?ec:e,arguments.length?e(arguments[0],arguments[1]):e}function Wr(e,t){var n=e.__data__;return Ny(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Sn(e){for(var t=Re(e),n=t.length;n--;){var u=t[n],l=e[u];t[n]=[u,l,Nc(l)]}return t}function oi(e,t){var n=$g(e,t);return Xa(n)?n:r}function Cy(e){var t=ce.call(e,ti),n=e[ti];try{e[ti]=r;var u=!0}catch{}var l=Rr.call(e);return u&&(t?e[ti]=n:delete e[ti]),l}var Rn=Zs?function(e){return e==null?[]:(e=ue(e),zt(Zs(e),function(t){return ja.call(e,t)}))}:Vn,Dc=Zs?function(e){for(var t=[];e;)Ut(t,Rn(e)),e=qr(e);return t}:Vn,De=Oe;(Xs&&De(new Xs(new ArrayBuffer(1)))!=fi||Ji&&De(new Ji)!=ct||en&&De(en.resolve())!=Go||Ei&&De(new Ei)!=ut||Gi&&De(new Gi)!=Hi)&&(De=function(e){var t=Oe(e),n=t==St?e.constructor:r,u=n?ai(n):"";if(u)switch(u){case hf:return fi;case lf:return ct;case pf:return Go;case df:return ut;case gf:return Hi}return t});function qy(e,t,n){for(var u=-1,l=n.length;++u<l;){var f=n[u],m=f.size;switch(f.type){case"drop":e+=m;break;case"dropRight":t-=m;break;case"take":t=Ae(t,e+m);break;case"takeRight":e=Pe(e,t-m);break}}return{start:e,end:t}}function Fy(e){var t=e.match(Nd);return t?t[1].split(kd):[]}function Oc(e,t,n){t=Kt(t,e);for(var u=-1,l=t.length,f=!1;++u<l;){var m=Et(t[u]);if(!(f=e!=null&&n(e,m)))break;e=e[m]}return f||++u!=l?f:(l=e==null?0:e.length,!!l&&is(l)&&At(m,l)&&(B(e)||ci(e)))}function Ay(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&ce.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Tc(e){return typeof e.constructor=="function"&&!rr(e)?Pi(qr(e)):{}}function Dy(e,t,n){var u=e.constructor;switch(t){case Vi:return wn(e);case ji:case Mi:return new u(+e);case fi:return fy(e,n);case Ps:case Ss:case Rs:case xs:case Cs:case qs:case Fs:case As:case Ds:return yc(e,n);case ct:return new u;case zi:case Li:return new u(e);case Ui:return yy(e);case ut:return new u;case yr:return my(e)}}function Oy(e,t){var n=t.length;if(!n)return e;var u=n-1;return t[u]=(n>1?"& ":"")+t[u],t=t.join(n>2?", ":" "),e.replace(Td,`{
/* [wrapped with `+t+`] */
`)}function Ty(e){return B(e)||ci(e)||!!(Ma&&e&&e[Ma])}function At(e,t){var n=typeof e;return t=t??Ve,!!t&&(n=="number"||n!="symbol"&&Bd.test(e))&&e>-1&&e%1==0&&e<t}function Te(e,t,n){if(!ye(n))return!1;var u=typeof t;return(u=="number"?Me(n)&&At(t,n.length):u=="string"&&t in n)?pt(n[t],e):!1}function xn(e,t){if(B(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Ge(e)?!0:Fd.test(e)||!qd.test(e)||t!=null&&e in ue(t)}function Ny(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Cn(e){var t=Gr(e),n=p[t];if(typeof n!="function"||!(t in X.prototype))return!1;if(e===n)return!0;var u=Pn(n);return!!u&&e===u[0]}function ky(e){return!!Na&&Na in e}var $y=Pr?Dt:Bn;function rr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||bi;return e===n}function Nc(e){return e===e&&!ye(e)}function kc(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in ue(n))}}function jy(e){var t=es(e,function(u){return n.size===C&&n.clear(),u}),n=t.cache;return t}function My(e,t){var n=e[1],u=t[1],l=n|u,f=l<(K|Y|de),m=u==de&&n==ie||u==de&&n==Ee&&e[7].length<=t[8]||u==(de|Ee)&&t[7].length<=t[8]&&n==ie;if(!(f||m))return e;u&K&&(e[2]=t[2],l|=n&K?0:ae);var w=t[3];if(w){var b=e[3];e[3]=b?vc(b,w,t[4]):w,e[4]=b?Lt(e[3],F):t[4]}return w=t[5],w&&(b=e[5],e[5]=b?wc(b,w,t[6]):w,e[6]=b?Lt(e[5],F):t[6]),w=t[7],w&&(e[7]=w),u&de&&(e[8]=e[8]==null?t[8]:Ae(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function zy(e){var t=[];if(e!=null)for(var n in ue(e))t.push(n);return t}function Uy(e){return Rr.call(e)}function $c(e,t,n){return t=Pe(t===r?e.length-1:t,0),function(){for(var u=arguments,l=-1,f=Pe(u.length-t,0),m=E(f);++l<f;)m[l]=u[t+l];l=-1;for(var w=E(t+1);++l<t;)w[l]=u[l];return w[t]=n(m),Be(e,this,w)}}function jc(e,t){return t.length<2?e:ni(e,st(t,0,-1))}function Ly(e,t){for(var n=e.length,u=Ae(t.length,n),l=je(e);u--;){var f=t[u];e[u]=At(f,n)?l[f]:r}return e}function qn(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Mc=Uc(cc),sr=rf||function(e,t){return qe.setTimeout(e,t)},Fn=Uc(ly);function zc(e,t,n){var u=t+"";return Fn(e,Oy(u,Hy(Fy(u),n)))}function Uc(e){var t=0,n=0;return function(){var u=af(),l=He-(u-n);if(n=u,l>0){if(++t>=Zt)return arguments[0]}else t=0;return e.apply(r,arguments)}}function Qr(e,t){var n=-1,u=e.length,l=u-1;for(t=t===r?u:t;++n<t;){var f=pn(n,l),m=e[f];e[f]=e[n],e[n]=m}return e.length=t,e}var Lc=jy(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Ad,function(n,u,l,f){t.push(l?f.replace(Md,"$1"):u||n)}),t});function Et(e){if(typeof e=="string"||Ge(e))return e;var t=e+"";return t=="0"&&1/e==-yt?"-0":t}function ai(e){if(e!=null){try{return Sr.call(e)}catch{}try{return e+""}catch{}}return""}function Hy(e,t){return et(Is,function(n){var u="_."+n[0];t&n[1]&&!_r(e,u)&&e.push(u)}),e.sort()}function Hc(e){if(e instanceof X)return e.clone();var t=new it(e.__wrapped__,e.__chain__);return t.__actions__=je(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Vy(e,t,n){(n?Te(e,t,n):t===r)?t=1:t=Pe(J(t),0);var u=e==null?0:e.length;if(!u||t<1)return[];for(var l=0,f=0,m=E(Dr(u/t));l<u;)m[f++]=st(e,l,l+=t);return m}function By(e){for(var t=-1,n=e==null?0:e.length,u=0,l=[];++t<n;){var f=e[t];f&&(l[u++]=f)}return l}function Ky(){var e=arguments.length;if(!e)return[];for(var t=E(e-1),n=arguments[0],u=e;u--;)t[u-1]=arguments[u];return Ut(B(n)?je(n):[n],Fe(t,1))}var Jy=Q(function(e,t){return we(e)?Zi(e,Fe(t,1,we,!0)):[]}),Gy=Q(function(e,t){var n=nt(t);return we(n)&&(n=r),we(e)?Zi(e,Fe(t,1,we,!0),j(n,2)):[]}),Wy=Q(function(e,t){var n=nt(t);return we(n)&&(n=r),we(e)?Zi(e,Fe(t,1,we,!0),r,n):[]});function Qy(e,t,n){var u=e==null?0:e.length;return u?(t=n||t===r?1:J(t),st(e,t<0?0:t,u)):[]}function Yy(e,t,n){var u=e==null?0:e.length;return u?(t=n||t===r?1:J(t),t=u-t,st(e,0,t<0?0:t)):[]}function Zy(e,t){return e&&e.length?Lr(e,j(t,3),!0,!0):[]}function Xy(e,t){return e&&e.length?Lr(e,j(t,3),!0):[]}function e0(e,t,n,u){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Te(e,t,n)&&(n=0,u=l),Kf(e,t,n,u)):[]}function Vc(e,t,n){var u=e==null?0:e.length;if(!u)return-1;var l=n==null?0:J(n);return l<0&&(l=Pe(u+l,0)),br(e,j(t,3),l)}function Bc(e,t,n){var u=e==null?0:e.length;if(!u)return-1;var l=u-1;return n!==r&&(l=J(n),l=n<0?Pe(u+l,0):Ae(l,u-1)),br(e,j(t,3),l,!0)}function Kc(e){var t=e==null?0:e.length;return t?Fe(e,1):[]}function t0(e){var t=e==null?0:e.length;return t?Fe(e,yt):[]}function i0(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:J(t),Fe(e,t)):[]}function r0(e){for(var t=-1,n=e==null?0:e.length,u={};++t<n;){var l=e[t];u[l[0]]=l[1]}return u}function Jc(e){return e&&e.length?e[0]:r}function s0(e,t,n){var u=e==null?0:e.length;if(!u)return-1;var l=n==null?0:J(n);return l<0&&(l=Pe(u+l,0)),mi(e,t,l)}function n0(e){var t=e==null?0:e.length;return t?st(e,0,-1):[]}var o0=Q(function(e){var t=ge(e,mn);return t.length&&t[0]===e[0]?an(t):[]}),a0=Q(function(e){var t=nt(e),n=ge(e,mn);return t===nt(n)?t=r:n.pop(),n.length&&n[0]===e[0]?an(n,j(t,2)):[]}),c0=Q(function(e){var t=nt(e),n=ge(e,mn);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?an(n,r,t):[]});function u0(e,t){return e==null?"":nf.call(e,t)}function nt(e){var t=e==null?0:e.length;return t?e[t-1]:r}function h0(e,t,n){var u=e==null?0:e.length;if(!u)return-1;var l=u;return n!==r&&(l=J(n),l=l<0?Pe(u+l,0):Ae(l,u-1)),t===t?Lg(e,t,l):br(e,xa,l,!0)}function l0(e,t){return e&&e.length?sc(e,J(t)):r}var p0=Q(Gc);function Gc(e,t){return e&&e.length&&t&&t.length?ln(e,t):e}function d0(e,t,n){return e&&e.length&&t&&t.length?ln(e,t,j(n,2)):e}function g0(e,t,n){return e&&e.length&&t&&t.length?ln(e,t,r,n):e}var f0=Ft(function(e,t){var n=e==null?0:e.length,u=rn(e,t);return ac(e,ge(t,function(l){return At(l,n)?+l:l}).sort(mc)),u});function y0(e,t){var n=[];if(!(e&&e.length))return n;var u=-1,l=[],f=e.length;for(t=j(t,3);++u<f;){var m=e[u];t(m,u,e)&&(n.push(m),l.push(u))}return ac(e,l),n}function An(e){return e==null?e:uf.call(e)}function m0(e,t,n){var u=e==null?0:e.length;return u?(n&&typeof n!="number"&&Te(e,t,n)?(t=0,n=u):(t=t==null?0:J(t),n=n===r?u:J(n)),st(e,t,n)):[]}function v0(e,t){return Ur(e,t)}function w0(e,t,n){return gn(e,t,j(n,2))}function _0(e,t){var n=e==null?0:e.length;if(n){var u=Ur(e,t);if(u<n&&pt(e[u],t))return u}return-1}function b0(e,t){return Ur(e,t,!0)}function E0(e,t,n){return gn(e,t,j(n,2),!0)}function I0(e,t){var n=e==null?0:e.length;if(n){var u=Ur(e,t,!0)-1;if(pt(e[u],t))return u}return-1}function P0(e){return e&&e.length?uc(e):[]}function S0(e,t){return e&&e.length?uc(e,j(t,2)):[]}function R0(e){var t=e==null?0:e.length;return t?st(e,1,t):[]}function x0(e,t,n){return e&&e.length?(t=n||t===r?1:J(t),st(e,0,t<0?0:t)):[]}function C0(e,t,n){var u=e==null?0:e.length;return u?(t=n||t===r?1:J(t),t=u-t,st(e,t<0?0:t,u)):[]}function q0(e,t){return e&&e.length?Lr(e,j(t,3),!1,!0):[]}function F0(e,t){return e&&e.length?Lr(e,j(t,3)):[]}var A0=Q(function(e){return Bt(Fe(e,1,we,!0))}),D0=Q(function(e){var t=nt(e);return we(t)&&(t=r),Bt(Fe(e,1,we,!0),j(t,2))}),O0=Q(function(e){var t=nt(e);return t=typeof t=="function"?t:r,Bt(Fe(e,1,we,!0),r,t)});function T0(e){return e&&e.length?Bt(e):[]}function N0(e,t){return e&&e.length?Bt(e,j(t,2)):[]}function k0(e,t){return t=typeof t=="function"?t:r,e&&e.length?Bt(e,r,t):[]}function Dn(e){if(!(e&&e.length))return[];var t=0;return e=zt(e,function(n){if(we(n))return t=Pe(n.length,t),!0}),Gs(t,function(n){return ge(e,Bs(n))})}function Wc(e,t){if(!(e&&e.length))return[];var n=Dn(e);return t==null?n:ge(n,function(u){return Be(t,r,u)})}var $0=Q(function(e,t){return we(e)?Zi(e,t):[]}),j0=Q(function(e){return yn(zt(e,we))}),M0=Q(function(e){var t=nt(e);return we(t)&&(t=r),yn(zt(e,we),j(t,2))}),z0=Q(function(e){var t=nt(e);return t=typeof t=="function"?t:r,yn(zt(e,we),r,t)}),U0=Q(Dn);function L0(e,t){return dc(e||[],t||[],Yi)}function H0(e,t){return dc(e||[],t||[],tr)}var V0=Q(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Wc(e,n)});function Qc(e){var t=p(e);return t.__chain__=!0,t}function B0(e,t){return t(e),e}function Yr(e,t){return t(e)}var K0=Ft(function(e){var t=e.length,n=t?e[0]:0,u=this.__wrapped__,l=function(f){return rn(f,e)};return t>1||this.__actions__.length||!(u instanceof X)||!At(n)?this.thru(l):(u=u.slice(n,+n+(t?1:0)),u.__actions__.push({func:Yr,args:[l],thisArg:r}),new it(u,this.__chain__).thru(function(f){return t&&!f.length&&f.push(r),f}))});function J0(){return Qc(this)}function G0(){return new it(this.value(),this.__chain__)}function W0(){this.__values__===r&&(this.__values__=hu(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Q0(){return this}function Y0(e){for(var t,n=this;n instanceof kr;){var u=Hc(n);u.__index__=0,u.__values__=r,t?l.__wrapped__=u:t=u;var l=u;n=n.__wrapped__}return l.__wrapped__=e,t}function Z0(){var e=this.__wrapped__;if(e instanceof X){var t=e;return this.__actions__.length&&(t=new X(this)),t=t.reverse(),t.__actions__.push({func:Yr,args:[An],thisArg:r}),new it(t,this.__chain__)}return this.thru(An)}function X0(){return pc(this.__wrapped__,this.__actions__)}var em=Hr(function(e,t,n){ce.call(e,n)?++e[n]:Ct(e,n,1)});function tm(e,t,n){var u=B(e)?Sa:Bf;return n&&Te(e,t,n)&&(t=r),u(e,j(t,3))}function im(e,t){var n=B(e)?zt:Wa;return n(e,j(t,3))}var rm=Ic(Vc),sm=Ic(Bc);function nm(e,t){return Fe(Zr(e,t),1)}function om(e,t){return Fe(Zr(e,t),yt)}function am(e,t,n){return n=n===r?1:J(n),Fe(Zr(e,t),n)}function Yc(e,t){var n=B(e)?et:Vt;return n(e,j(t,3))}function Zc(e,t){var n=B(e)?Sg:Ga;return n(e,j(t,3))}var cm=Hr(function(e,t,n){ce.call(e,n)?e[n].push(t):Ct(e,n,[t])});function um(e,t,n,u){e=Me(e)?e:qi(e),n=n&&!u?J(n):0;var l=e.length;return n<0&&(n=Pe(l+n,0)),rs(e)?n<=l&&e.indexOf(t,n)>-1:!!l&&mi(e,t,n)>-1}var hm=Q(function(e,t,n){var u=-1,l=typeof t=="function",f=Me(e)?E(e.length):[];return Vt(e,function(m){f[++u]=l?Be(t,m,n):Xi(m,t,n)}),f}),lm=Hr(function(e,t,n){Ct(e,n,t)});function Zr(e,t){var n=B(e)?ge:tc;return n(e,j(t,3))}function pm(e,t,n,u){return e==null?[]:(B(t)||(t=t==null?[]:[t]),n=u?r:n,B(n)||(n=n==null?[]:[n]),nc(e,t,n))}var dm=Hr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function gm(e,t,n){var u=B(e)?Hs:qa,l=arguments.length<3;return u(e,j(t,4),n,l,Vt)}function fm(e,t,n){var u=B(e)?Rg:qa,l=arguments.length<3;return u(e,j(t,4),n,l,Ga)}function ym(e,t){var n=B(e)?zt:Wa;return n(e,ts(j(t,3)))}function mm(e){var t=B(e)?Va:uy;return t(e)}function vm(e,t,n){(n?Te(e,t,n):t===r)?t=1:t=J(t);var u=B(e)?zf:hy;return u(e,t)}function wm(e){var t=B(e)?Uf:py;return t(e)}function _m(e){if(e==null)return 0;if(Me(e))return rs(e)?wi(e):e.length;var t=De(e);return t==ct||t==ut?e.size:un(e).length}function bm(e,t,n){var u=B(e)?Vs:dy;return n&&Te(e,t,n)&&(t=r),u(e,j(t,3))}var Em=Q(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Te(e,t[0],t[1])?t=[]:n>2&&Te(t[0],t[1],t[2])&&(t=[t[0]]),nc(e,Fe(t,1),[])}),Xr=tf||function(){return qe.Date.now()};function Im(e,t){if(typeof t!="function")throw new tt(g);return e=J(e),function(){if(--e<1)return t.apply(this,arguments)}}function Xc(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,qt(e,de,r,r,r,r,t)}function eu(e,t){var n;if(typeof t!="function")throw new tt(g);return e=J(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var On=Q(function(e,t,n){var u=K;if(n.length){var l=Lt(n,xi(On));u|=re}return qt(e,u,t,n,l)}),tu=Q(function(e,t,n){var u=K|Y;if(n.length){var l=Lt(n,xi(tu));u|=re}return qt(t,u,e,n,l)});function iu(e,t,n){t=n?r:t;var u=qt(e,ie,r,r,r,r,r,t);return u.placeholder=iu.placeholder,u}function ru(e,t,n){t=n?r:t;var u=qt(e,se,r,r,r,r,r,t);return u.placeholder=ru.placeholder,u}function su(e,t,n){var u,l,f,m,w,b,S=0,R=!1,x=!1,q=!0;if(typeof e!="function")throw new tt(g);t=ot(t)||0,ye(n)&&(R=!!n.leading,x="maxWait"in n,f=x?Pe(ot(n.maxWait)||0,t):f,q="trailing"in n?!!n.trailing:q);function T(_e){var dt=u,Tt=l;return u=l=r,S=_e,m=e.apply(Tt,dt),m}function z(_e){return S=_e,w=sr(Z,t),R?T(_e):m}function G(_e){var dt=_e-b,Tt=_e-S,Iu=t-dt;return x?Ae(Iu,f-Tt):Iu}function U(_e){var dt=_e-b,Tt=_e-S;return b===r||dt>=t||dt<0||x&&Tt>=f}function Z(){var _e=Xr();if(U(_e))return te(_e);w=sr(Z,G(_e))}function te(_e){return w=r,q&&u?T(_e):(u=l=r,m)}function We(){w!==r&&gc(w),S=0,u=b=l=w=r}function Ne(){return w===r?m:te(Xr())}function Qe(){var _e=Xr(),dt=U(_e);if(u=arguments,l=this,b=_e,dt){if(w===r)return z(b);if(x)return gc(w),w=sr(Z,t),T(b)}return w===r&&(w=sr(Z,t)),m}return Qe.cancel=We,Qe.flush=Ne,Qe}var Pm=Q(function(e,t){return Ja(e,1,t)}),Sm=Q(function(e,t,n){return Ja(e,ot(t)||0,n)});function Rm(e){return qt(e,Le)}function es(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new tt(g);var n=function(){var u=arguments,l=t?t.apply(this,u):u[0],f=n.cache;if(f.has(l))return f.get(l);var m=e.apply(this,u);return n.cache=f.set(l,m)||f,m};return n.cache=new(es.Cache||xt),n}es.Cache=xt;function ts(e){if(typeof e!="function")throw new tt(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function xm(e){return eu(2,e)}var Cm=gy(function(e,t){t=t.length==1&&B(t[0])?ge(t[0],Ke(j())):ge(Fe(t,1),Ke(j()));var n=t.length;return Q(function(u){for(var l=-1,f=Ae(u.length,n);++l<f;)u[l]=t[l].call(this,u[l]);return Be(e,this,u)})}),Tn=Q(function(e,t){var n=Lt(t,xi(Tn));return qt(e,re,r,t,n)}),nu=Q(function(e,t){var n=Lt(t,xi(nu));return qt(e,ve,r,t,n)}),qm=Ft(function(e,t){return qt(e,Ee,r,r,r,t)});function Fm(e,t){if(typeof e!="function")throw new tt(g);return t=t===r?t:J(t),Q(e,t)}function Am(e,t){if(typeof e!="function")throw new tt(g);return t=t==null?0:Pe(J(t),0),Q(function(n){var u=n[t],l=Jt(n,0,t);return u&&Ut(l,u),Be(e,this,l)})}function Dm(e,t,n){var u=!0,l=!0;if(typeof e!="function")throw new tt(g);return ye(n)&&(u="leading"in n?!!n.leading:u,l="trailing"in n?!!n.trailing:l),su(e,t,{leading:u,maxWait:t,trailing:l})}function Om(e){return Xc(e,1)}function Tm(e,t){return Tn(vn(t),e)}function Nm(){if(!arguments.length)return[];var e=arguments[0];return B(e)?e:[e]}function km(e){return rt(e,M)}function $m(e,t){return t=typeof t=="function"?t:r,rt(e,M,t)}function jm(e){return rt(e,A|M)}function Mm(e,t){return t=typeof t=="function"?t:r,rt(e,A|M,t)}function zm(e,t){return t==null||Ka(e,t,Re(t))}function pt(e,t){return e===t||e!==e&&t!==t}var Um=Jr(on),Lm=Jr(function(e,t){return e>=t}),ci=Za(function(){return arguments}())?Za:function(e){return me(e)&&ce.call(e,"callee")&&!ja.call(e,"callee")},B=E.isArray,Hm=wa?Ke(wa):Yf;function Me(e){return e!=null&&is(e.length)&&!Dt(e)}function we(e){return me(e)&&Me(e)}function Vm(e){return e===!0||e===!1||me(e)&&Oe(e)==ji}var Gt=sf||Bn,Bm=_a?Ke(_a):Zf;function Km(e){return me(e)&&e.nodeType===1&&!nr(e)}function Jm(e){if(e==null)return!0;if(Me(e)&&(B(e)||typeof e=="string"||typeof e.splice=="function"||Gt(e)||Ci(e)||ci(e)))return!e.length;var t=De(e);if(t==ct||t==ut)return!e.size;if(rr(e))return!un(e).length;for(var n in e)if(ce.call(e,n))return!1;return!0}function Gm(e,t){return er(e,t)}function Wm(e,t,n){n=typeof n=="function"?n:r;var u=n?n(e,t):r;return u===r?er(e,t,r,n):!!u}function Nn(e){if(!me(e))return!1;var t=Oe(e);return t==gr||t==md||typeof e.message=="string"&&typeof e.name=="string"&&!nr(e)}function Qm(e){return typeof e=="number"&&za(e)}function Dt(e){if(!ye(e))return!1;var t=Oe(e);return t==fr||t==Jo||t==yd||t==wd}function ou(e){return typeof e=="number"&&e==J(e)}function is(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Ve}function ye(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function me(e){return e!=null&&typeof e=="object"}var au=ba?Ke(ba):ey;function Ym(e,t){return e===t||cn(e,t,Sn(t))}function Zm(e,t,n){return n=typeof n=="function"?n:r,cn(e,t,Sn(t),n)}function Xm(e){return cu(e)&&e!=+e}function ev(e){if($y(e))throw new V(h);return Xa(e)}function tv(e){return e===null}function iv(e){return e==null}function cu(e){return typeof e=="number"||me(e)&&Oe(e)==zi}function nr(e){if(!me(e)||Oe(e)!=St)return!1;var t=qr(e);if(t===null)return!0;var n=ce.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Sr.call(n)==Yg}var kn=Ea?Ke(Ea):ty;function rv(e){return ou(e)&&e>=-Ve&&e<=Ve}var uu=Ia?Ke(Ia):iy;function rs(e){return typeof e=="string"||!B(e)&&me(e)&&Oe(e)==Li}function Ge(e){return typeof e=="symbol"||me(e)&&Oe(e)==yr}var Ci=Pa?Ke(Pa):ry;function sv(e){return e===r}function nv(e){return me(e)&&De(e)==Hi}function ov(e){return me(e)&&Oe(e)==bd}var av=Jr(hn),cv=Jr(function(e,t){return e<=t});function hu(e){if(!e)return[];if(Me(e))return rs(e)?ht(e):je(e);if(Ki&&e[Ki])return Mg(e[Ki]());var t=De(e),n=t==ct?Qs:t==ut?Er:qi;return n(e)}function Ot(e){if(!e)return e===0?e:0;if(e=ot(e),e===yt||e===-yt){var t=e<0?-1:1;return t*di}return e===e?e:0}function J(e){var t=Ot(e),n=t%1;return t===t?n?t-n:t:0}function lu(e){return e?si(J(e),0,$e):0}function ot(e){if(typeof e=="number")return e;if(Ge(e))return mt;if(ye(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ye(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Fa(e);var n=Ld.test(e);return n||Vd.test(e)?Eg(e.slice(2),n?2:8):Ud.test(e)?mt:+e}function pu(e){return _t(e,ze(e))}function uv(e){return e?si(J(e),-Ve,Ve):e===0?e:0}function oe(e){return e==null?"":Je(e)}var hv=Si(function(e,t){if(rr(t)||Me(t)){_t(t,Re(t),e);return}for(var n in t)ce.call(t,n)&&Yi(e,n,t[n])}),du=Si(function(e,t){_t(t,ze(t),e)}),ss=Si(function(e,t,n,u){_t(t,ze(t),e,u)}),lv=Si(function(e,t,n,u){_t(t,Re(t),e,u)}),pv=Ft(rn);function dv(e,t){var n=Pi(e);return t==null?n:Ba(n,t)}var gv=Q(function(e,t){e=ue(e);var n=-1,u=t.length,l=u>2?t[2]:r;for(l&&Te(t[0],t[1],l)&&(u=1);++n<u;)for(var f=t[n],m=ze(f),w=-1,b=m.length;++w<b;){var S=m[w],R=e[S];(R===r||pt(R,bi[S])&&!ce.call(e,S))&&(e[S]=f[S])}return e}),fv=Q(function(e){return e.push(r,Fc),Be(gu,r,e)});function yv(e,t){return Ra(e,j(t,3),wt)}function mv(e,t){return Ra(e,j(t,3),nn)}function vv(e,t){return e==null?e:sn(e,j(t,3),ze)}function wv(e,t){return e==null?e:Qa(e,j(t,3),ze)}function _v(e,t){return e&&wt(e,j(t,3))}function bv(e,t){return e&&nn(e,j(t,3))}function Ev(e){return e==null?[]:Mr(e,Re(e))}function Iv(e){return e==null?[]:Mr(e,ze(e))}function $n(e,t,n){var u=e==null?r:ni(e,t);return u===r?n:u}function Pv(e,t){return e!=null&&Oc(e,t,Jf)}function jn(e,t){return e!=null&&Oc(e,t,Gf)}var Sv=Sc(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Rr.call(t)),e[t]=n},zn(Ue)),Rv=Sc(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Rr.call(t)),ce.call(e,t)?e[t].push(n):e[t]=[n]},j),xv=Q(Xi);function Re(e){return Me(e)?Ha(e):un(e)}function ze(e){return Me(e)?Ha(e,!0):sy(e)}function Cv(e,t){var n={};return t=j(t,3),wt(e,function(u,l,f){Ct(n,t(u,l,f),u)}),n}function qv(e,t){var n={};return t=j(t,3),wt(e,function(u,l,f){Ct(n,l,t(u,l,f))}),n}var Fv=Si(function(e,t,n){zr(e,t,n)}),gu=Si(function(e,t,n,u){zr(e,t,n,u)}),Av=Ft(function(e,t){var n={};if(e==null)return n;var u=!1;t=ge(t,function(f){return f=Kt(f,e),u||(u=f.length>1),f}),_t(e,In(e),n),u&&(n=rt(n,A|N|M,Sy));for(var l=t.length;l--;)fn(n,t[l]);return n});function Dv(e,t){return fu(e,ts(j(t)))}var Ov=Ft(function(e,t){return e==null?{}:oy(e,t)});function fu(e,t){if(e==null)return{};var n=ge(In(e),function(u){return[u]});return t=j(t),oc(e,n,function(u,l){return t(u,l[0])})}function Tv(e,t,n){t=Kt(t,e);var u=-1,l=t.length;for(l||(l=1,e=r);++u<l;){var f=e==null?r:e[Et(t[u])];f===r&&(u=l,f=n),e=Dt(f)?f.call(e):f}return e}function Nv(e,t,n){return e==null?e:tr(e,t,n)}function kv(e,t,n,u){return u=typeof u=="function"?u:r,e==null?e:tr(e,t,n,u)}var yu=Cc(Re),mu=Cc(ze);function $v(e,t,n){var u=B(e),l=u||Gt(e)||Ci(e);if(t=j(t,4),n==null){var f=e&&e.constructor;l?n=u?new f:[]:ye(e)?n=Dt(f)?Pi(qr(e)):{}:n={}}return(l?et:wt)(e,function(m,w,b){return t(n,m,w,b)}),n}function jv(e,t){return e==null?!0:fn(e,t)}function Mv(e,t,n){return e==null?e:lc(e,t,vn(n))}function zv(e,t,n,u){return u=typeof u=="function"?u:r,e==null?e:lc(e,t,vn(n),u)}function qi(e){return e==null?[]:Ws(e,Re(e))}function Uv(e){return e==null?[]:Ws(e,ze(e))}function Lv(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=ot(n),n=n===n?n:0),t!==r&&(t=ot(t),t=t===t?t:0),si(ot(e),t,n)}function Hv(e,t,n){return t=Ot(t),n===r?(n=t,t=0):n=Ot(n),e=ot(e),Wf(e,t,n)}function Vv(e,t,n){if(n&&typeof n!="boolean"&&Te(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Ot(e),t===r?(t=e,e=0):t=Ot(t)),e>t){var u=e;e=t,t=u}if(n||e%1||t%1){var l=Ua();return Ae(e+l*(t-e+bg("1e-"+((l+"").length-1))),t)}return pn(e,t)}var Bv=Ri(function(e,t,n){return t=t.toLowerCase(),e+(n?vu(t):t)});function vu(e){return Mn(oe(e).toLowerCase())}function wu(e){return e=oe(e),e&&e.replace(Kd,Tg).replace(lg,"")}function Kv(e,t,n){e=oe(e),t=Je(t);var u=e.length;n=n===r?u:si(J(n),0,u);var l=n;return n-=t.length,n>=0&&e.slice(n,l)==t}function Jv(e){return e=oe(e),e&&Rd.test(e)?e.replace(Qo,Ng):e}function Gv(e){return e=oe(e),e&&Dd.test(e)?e.replace(Os,"\\$&"):e}var Wv=Ri(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Qv=Ri(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Yv=Ec("toLowerCase");function Zv(e,t,n){e=oe(e),t=J(t);var u=t?wi(e):0;if(!t||u>=t)return e;var l=(t-u)/2;return Kr(Or(l),n)+e+Kr(Dr(l),n)}function Xv(e,t,n){e=oe(e),t=J(t);var u=t?wi(e):0;return t&&u<t?e+Kr(t-u,n):e}function ew(e,t,n){e=oe(e),t=J(t);var u=t?wi(e):0;return t&&u<t?Kr(t-u,n)+e:e}function tw(e,t,n){return n||t==null?t=0:t&&(t=+t),cf(oe(e).replace(Ts,""),t||0)}function iw(e,t,n){return(n?Te(e,t,n):t===r)?t=1:t=J(t),dn(oe(e),t)}function rw(){var e=arguments,t=oe(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var sw=Ri(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function nw(e,t,n){return n&&typeof n!="number"&&Te(e,t,n)&&(t=n=r),n=n===r?$e:n>>>0,n?(e=oe(e),e&&(typeof t=="string"||t!=null&&!kn(t))&&(t=Je(t),!t&&vi(e))?Jt(ht(e),0,n):e.split(t,n)):[]}var ow=Ri(function(e,t,n){return e+(n?" ":"")+Mn(t)});function aw(e,t,n){return e=oe(e),n=n==null?0:si(J(n),0,e.length),t=Je(t),e.slice(n,n+t.length)==t}function cw(e,t,n){var u=p.templateSettings;n&&Te(e,t,n)&&(t=r),e=oe(e),t=ss({},t,u,qc);var l=ss({},t.imports,u.imports,qc),f=Re(l),m=Ws(l,f),w,b,S=0,R=t.interpolate||mr,x="__p += '",q=Ys((t.escape||mr).source+"|"+R.source+"|"+(R===Yo?zd:mr).source+"|"+(t.evaluate||mr).source+"|$","g"),T="//# sourceURL="+(ce.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++yg+"]")+`
`;e.replace(q,function(U,Z,te,We,Ne,Qe){return te||(te=We),x+=e.slice(S,Qe).replace(Jd,kg),Z&&(w=!0,x+=`' +
__e(`+Z+`) +
'`),Ne&&(b=!0,x+=`';
`+Ne+`;
__p += '`),te&&(x+=`' +
((__t = (`+te+`)) == null ? '' : __t) +
'`),S=Qe+U.length,U}),x+=`';
`;var z=ce.call(t,"variable")&&t.variable;if(!z)x=`with (obj) {
`+x+`
}
`;else if(jd.test(z))throw new V(v);x=(b?x.replace(Ed,""):x).replace(Id,"$1").replace(Pd,"$1;"),x="function("+(z||"obj")+`) {
`+(z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(b?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+x+`return __p
}`;var G=bu(function(){return ne(f,T+"return "+x).apply(r,m)});if(G.source=x,Nn(G))throw G;return G}function uw(e){return oe(e).toLowerCase()}function hw(e){return oe(e).toUpperCase()}function lw(e,t,n){if(e=oe(e),e&&(n||t===r))return Fa(e);if(!e||!(t=Je(t)))return e;var u=ht(e),l=ht(t),f=Aa(u,l),m=Da(u,l)+1;return Jt(u,f,m).join("")}function pw(e,t,n){if(e=oe(e),e&&(n||t===r))return e.slice(0,Ta(e)+1);if(!e||!(t=Je(t)))return e;var u=ht(e),l=Da(u,ht(t))+1;return Jt(u,0,l).join("")}function dw(e,t,n){if(e=oe(e),e&&(n||t===r))return e.replace(Ts,"");if(!e||!(t=Je(t)))return e;var u=ht(e),l=Aa(u,ht(t));return Jt(u,l).join("")}function gw(e,t){var n=Ni,u=Mt;if(ye(t)){var l="separator"in t?t.separator:l;n="length"in t?J(t.length):n,u="omission"in t?Je(t.omission):u}e=oe(e);var f=e.length;if(vi(e)){var m=ht(e);f=m.length}if(n>=f)return e;var w=n-wi(u);if(w<1)return u;var b=m?Jt(m,0,w).join(""):e.slice(0,w);if(l===r)return b+u;if(m&&(w+=b.length-w),kn(l)){if(e.slice(w).search(l)){var S,R=b;for(l.global||(l=Ys(l.source,oe(Zo.exec(l))+"g")),l.lastIndex=0;S=l.exec(R);)var x=S.index;b=b.slice(0,x===r?w:x)}}else if(e.indexOf(Je(l),w)!=w){var q=b.lastIndexOf(l);q>-1&&(b=b.slice(0,q))}return b+u}function fw(e){return e=oe(e),e&&Sd.test(e)?e.replace(Wo,Hg):e}var yw=Ri(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Mn=Ec("toUpperCase");function _u(e,t,n){return e=oe(e),t=n?r:t,t===r?jg(e)?Kg(e):qg(e):e.match(t)||[]}var bu=Q(function(e,t){try{return Be(e,r,t)}catch(n){return Nn(n)?n:new V(n)}}),mw=Ft(function(e,t){return et(t,function(n){n=Et(n),Ct(e,n,On(e[n],e))}),e});function vw(e){var t=e==null?0:e.length,n=j();return e=t?ge(e,function(u){if(typeof u[1]!="function")throw new tt(g);return[n(u[0]),u[1]]}):[],Q(function(u){for(var l=-1;++l<t;){var f=e[l];if(Be(f[0],this,u))return Be(f[1],this,u)}})}function ww(e){return Vf(rt(e,A))}function zn(e){return function(){return e}}function _w(e,t){return e==null||e!==e?t:e}var bw=Pc(),Ew=Pc(!0);function Ue(e){return e}function Un(e){return ec(typeof e=="function"?e:rt(e,A))}function Iw(e){return ic(rt(e,A))}function Pw(e,t){return rc(e,rt(t,A))}var Sw=Q(function(e,t){return function(n){return Xi(n,e,t)}}),Rw=Q(function(e,t){return function(n){return Xi(e,n,t)}});function Ln(e,t,n){var u=Re(t),l=Mr(t,u);n==null&&!(ye(t)&&(l.length||!u.length))&&(n=t,t=e,e=this,l=Mr(t,Re(t)));var f=!(ye(n)&&"chain"in n)||!!n.chain,m=Dt(e);return et(l,function(w){var b=t[w];e[w]=b,m&&(e.prototype[w]=function(){var S=this.__chain__;if(f||S){var R=e(this.__wrapped__),x=R.__actions__=je(this.__actions__);return x.push({func:b,args:arguments,thisArg:e}),R.__chain__=S,R}return b.apply(e,Ut([this.value()],arguments))})}),e}function xw(){return qe._===this&&(qe._=Zg),this}function Hn(){}function Cw(e){return e=J(e),Q(function(t){return sc(t,e)})}var qw=_n(ge),Fw=_n(Sa),Aw=_n(Vs);function Eu(e){return xn(e)?Bs(Et(e)):ay(e)}function Dw(e){return function(t){return e==null?r:ni(e,t)}}var Ow=Rc(),Tw=Rc(!0);function Vn(){return[]}function Bn(){return!1}function Nw(){return{}}function kw(){return""}function $w(){return!0}function jw(e,t){if(e=J(e),e<1||e>Ve)return[];var n=$e,u=Ae(e,$e);t=j(t),e-=$e;for(var l=Gs(u,t);++n<e;)t(n);return l}function Mw(e){return B(e)?ge(e,Et):Ge(e)?[e]:je(Lc(oe(e)))}function zw(e){var t=++Qg;return oe(e)+t}var Uw=Br(function(e,t){return e+t},0),Lw=bn("ceil"),Hw=Br(function(e,t){return e/t},1),Vw=bn("floor");function Bw(e){return e&&e.length?jr(e,Ue,on):r}function Kw(e,t){return e&&e.length?jr(e,j(t,2),on):r}function Jw(e){return Ca(e,Ue)}function Gw(e,t){return Ca(e,j(t,2))}function Ww(e){return e&&e.length?jr(e,Ue,hn):r}function Qw(e,t){return e&&e.length?jr(e,j(t,2),hn):r}var Yw=Br(function(e,t){return e*t},1),Zw=bn("round"),Xw=Br(function(e,t){return e-t},0);function e1(e){return e&&e.length?Js(e,Ue):0}function t1(e,t){return e&&e.length?Js(e,j(t,2)):0}return p.after=Im,p.ary=Xc,p.assign=hv,p.assignIn=du,p.assignInWith=ss,p.assignWith=lv,p.at=pv,p.before=eu,p.bind=On,p.bindAll=mw,p.bindKey=tu,p.castArray=Nm,p.chain=Qc,p.chunk=Vy,p.compact=By,p.concat=Ky,p.cond=vw,p.conforms=ww,p.constant=zn,p.countBy=em,p.create=dv,p.curry=iu,p.curryRight=ru,p.debounce=su,p.defaults=gv,p.defaultsDeep=fv,p.defer=Pm,p.delay=Sm,p.difference=Jy,p.differenceBy=Gy,p.differenceWith=Wy,p.drop=Qy,p.dropRight=Yy,p.dropRightWhile=Zy,p.dropWhile=Xy,p.fill=e0,p.filter=im,p.flatMap=nm,p.flatMapDeep=om,p.flatMapDepth=am,p.flatten=Kc,p.flattenDeep=t0,p.flattenDepth=i0,p.flip=Rm,p.flow=bw,p.flowRight=Ew,p.fromPairs=r0,p.functions=Ev,p.functionsIn=Iv,p.groupBy=cm,p.initial=n0,p.intersection=o0,p.intersectionBy=a0,p.intersectionWith=c0,p.invert=Sv,p.invertBy=Rv,p.invokeMap=hm,p.iteratee=Un,p.keyBy=lm,p.keys=Re,p.keysIn=ze,p.map=Zr,p.mapKeys=Cv,p.mapValues=qv,p.matches=Iw,p.matchesProperty=Pw,p.memoize=es,p.merge=Fv,p.mergeWith=gu,p.method=Sw,p.methodOf=Rw,p.mixin=Ln,p.negate=ts,p.nthArg=Cw,p.omit=Av,p.omitBy=Dv,p.once=xm,p.orderBy=pm,p.over=qw,p.overArgs=Cm,p.overEvery=Fw,p.overSome=Aw,p.partial=Tn,p.partialRight=nu,p.partition=dm,p.pick=Ov,p.pickBy=fu,p.property=Eu,p.propertyOf=Dw,p.pull=p0,p.pullAll=Gc,p.pullAllBy=d0,p.pullAllWith=g0,p.pullAt=f0,p.range=Ow,p.rangeRight=Tw,p.rearg=qm,p.reject=ym,p.remove=y0,p.rest=Fm,p.reverse=An,p.sampleSize=vm,p.set=Nv,p.setWith=kv,p.shuffle=wm,p.slice=m0,p.sortBy=Em,p.sortedUniq=P0,p.sortedUniqBy=S0,p.split=nw,p.spread=Am,p.tail=R0,p.take=x0,p.takeRight=C0,p.takeRightWhile=q0,p.takeWhile=F0,p.tap=B0,p.throttle=Dm,p.thru=Yr,p.toArray=hu,p.toPairs=yu,p.toPairsIn=mu,p.toPath=Mw,p.toPlainObject=pu,p.transform=$v,p.unary=Om,p.union=A0,p.unionBy=D0,p.unionWith=O0,p.uniq=T0,p.uniqBy=N0,p.uniqWith=k0,p.unset=jv,p.unzip=Dn,p.unzipWith=Wc,p.update=Mv,p.updateWith=zv,p.values=qi,p.valuesIn=Uv,p.without=$0,p.words=_u,p.wrap=Tm,p.xor=j0,p.xorBy=M0,p.xorWith=z0,p.zip=U0,p.zipObject=L0,p.zipObjectDeep=H0,p.zipWith=V0,p.entries=yu,p.entriesIn=mu,p.extend=du,p.extendWith=ss,Ln(p,p),p.add=Uw,p.attempt=bu,p.camelCase=Bv,p.capitalize=vu,p.ceil=Lw,p.clamp=Lv,p.clone=km,p.cloneDeep=jm,p.cloneDeepWith=Mm,p.cloneWith=$m,p.conformsTo=zm,p.deburr=wu,p.defaultTo=_w,p.divide=Hw,p.endsWith=Kv,p.eq=pt,p.escape=Jv,p.escapeRegExp=Gv,p.every=tm,p.find=rm,p.findIndex=Vc,p.findKey=yv,p.findLast=sm,p.findLastIndex=Bc,p.findLastKey=mv,p.floor=Vw,p.forEach=Yc,p.forEachRight=Zc,p.forIn=vv,p.forInRight=wv,p.forOwn=_v,p.forOwnRight=bv,p.get=$n,p.gt=Um,p.gte=Lm,p.has=Pv,p.hasIn=jn,p.head=Jc,p.identity=Ue,p.includes=um,p.indexOf=s0,p.inRange=Hv,p.invoke=xv,p.isArguments=ci,p.isArray=B,p.isArrayBuffer=Hm,p.isArrayLike=Me,p.isArrayLikeObject=we,p.isBoolean=Vm,p.isBuffer=Gt,p.isDate=Bm,p.isElement=Km,p.isEmpty=Jm,p.isEqual=Gm,p.isEqualWith=Wm,p.isError=Nn,p.isFinite=Qm,p.isFunction=Dt,p.isInteger=ou,p.isLength=is,p.isMap=au,p.isMatch=Ym,p.isMatchWith=Zm,p.isNaN=Xm,p.isNative=ev,p.isNil=iv,p.isNull=tv,p.isNumber=cu,p.isObject=ye,p.isObjectLike=me,p.isPlainObject=nr,p.isRegExp=kn,p.isSafeInteger=rv,p.isSet=uu,p.isString=rs,p.isSymbol=Ge,p.isTypedArray=Ci,p.isUndefined=sv,p.isWeakMap=nv,p.isWeakSet=ov,p.join=u0,p.kebabCase=Wv,p.last=nt,p.lastIndexOf=h0,p.lowerCase=Qv,p.lowerFirst=Yv,p.lt=av,p.lte=cv,p.max=Bw,p.maxBy=Kw,p.mean=Jw,p.meanBy=Gw,p.min=Ww,p.minBy=Qw,p.stubArray=Vn,p.stubFalse=Bn,p.stubObject=Nw,p.stubString=kw,p.stubTrue=$w,p.multiply=Yw,p.nth=l0,p.noConflict=xw,p.noop=Hn,p.now=Xr,p.pad=Zv,p.padEnd=Xv,p.padStart=ew,p.parseInt=tw,p.random=Vv,p.reduce=gm,p.reduceRight=fm,p.repeat=iw,p.replace=rw,p.result=Tv,p.round=Zw,p.runInContext=_,p.sample=mm,p.size=_m,p.snakeCase=sw,p.some=bm,p.sortedIndex=v0,p.sortedIndexBy=w0,p.sortedIndexOf=_0,p.sortedLastIndex=b0,p.sortedLastIndexBy=E0,p.sortedLastIndexOf=I0,p.startCase=ow,p.startsWith=aw,p.subtract=Xw,p.sum=e1,p.sumBy=t1,p.template=cw,p.times=jw,p.toFinite=Ot,p.toInteger=J,p.toLength=lu,p.toLower=uw,p.toNumber=ot,p.toSafeInteger=uv,p.toString=oe,p.toUpper=hw,p.trim=lw,p.trimEnd=pw,p.trimStart=dw,p.truncate=gw,p.unescape=fw,p.uniqueId=zw,p.upperCase=yw,p.upperFirst=Mn,p.each=Yc,p.eachRight=Zc,p.first=Jc,Ln(p,function(){var e={};return wt(p,function(t,n){ce.call(p.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),p.VERSION=o,et(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),et(["drop","take"],function(e,t){X.prototype[e]=function(n){n=n===r?1:Pe(J(n),0);var u=this.__filtered__&&!t?new X(this):this.clone();return u.__filtered__?u.__takeCount__=Ae(n,u.__takeCount__):u.__views__.push({size:Ae(n,$e),type:e+(u.__dir__<0?"Right":"")}),u},X.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),et(["filter","map","takeWhile"],function(e,t){var n=t+1,u=n==Se||n==ki;X.prototype[e]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:j(l,3),type:n}),f.__filtered__=f.__filtered__||u,f}}),et(["head","last"],function(e,t){var n="take"+(t?"Right":"");X.prototype[e]=function(){return this[n](1).value()[0]}}),et(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");X.prototype[e]=function(){return this.__filtered__?new X(this):this[n](1)}}),X.prototype.compact=function(){return this.filter(Ue)},X.prototype.find=function(e){return this.filter(e).head()},X.prototype.findLast=function(e){return this.reverse().find(e)},X.prototype.invokeMap=Q(function(e,t){return typeof e=="function"?new X(this):this.map(function(n){return Xi(n,e,t)})}),X.prototype.reject=function(e){return this.filter(ts(j(e)))},X.prototype.slice=function(e,t){e=J(e);var n=this;return n.__filtered__&&(e>0||t<0)?new X(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=J(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},X.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},X.prototype.toArray=function(){return this.take($e)},wt(X.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),u=/^(?:head|last)$/.test(t),l=p[u?"take"+(t=="last"?"Right":""):t],f=u||/^find/.test(t);l&&(p.prototype[t]=function(){var m=this.__wrapped__,w=u?[1]:arguments,b=m instanceof X,S=w[0],R=b||B(m),x=function(Z){var te=l.apply(p,Ut([Z],w));return u&&q?te[0]:te};R&&n&&typeof S=="function"&&S.length!=1&&(b=R=!1);var q=this.__chain__,T=!!this.__actions__.length,z=f&&!q,G=b&&!T;if(!f&&R){m=G?m:new X(this);var U=e.apply(m,w);return U.__actions__.push({func:Yr,args:[x],thisArg:r}),new it(U,q)}return z&&G?e.apply(this,w):(U=this.thru(x),z?u?U.value()[0]:U.value():U)})}),et(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ir[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(u&&!this.__chain__){var f=this.value();return t.apply(B(f)?f:[],l)}return this[n](function(m){return t.apply(B(m)?m:[],l)})}}),wt(X.prototype,function(e,t){var n=p[t];if(n){var u=n.name+"";ce.call(Ii,u)||(Ii[u]=[]),Ii[u].push({name:t,func:n})}}),Ii[Vr(r,Y).name]=[{name:"wrapper",func:r}],X.prototype.clone=ff,X.prototype.reverse=yf,X.prototype.value=mf,p.prototype.at=K0,p.prototype.chain=J0,p.prototype.commit=G0,p.prototype.next=W0,p.prototype.plant=Y0,p.prototype.reverse=Z0,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=X0,p.prototype.first=p.prototype.head,Ki&&(p.prototype[Ki]=Q0),p},_i=Jg();ei?((ei.exports=_i)._=_i,zs._=_i):qe._=_i}).call(Ti)})(vs,vs.exports);var Hp=Object.defineProperty,Vp=Object.defineProperties,Bp=Object.getOwnPropertyDescriptors,No=Object.getOwnPropertySymbols,Kp=Object.prototype.hasOwnProperty,Jp=Object.prototype.propertyIsEnumerable,ko=(y,s,r)=>s in y?Hp(y,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[s]=r,hr=(y,s)=>{for(var r in s||(s={}))Kp.call(s,r)&&ko(y,r,s[r]);if(No)for(var r of No(s))Jp.call(s,r)&&ko(y,r,s[r]);return y},Gp=(y,s)=>Vp(y,Bp(s));function jt(y,s,r){var o;const a=(0,d.DQe)(y);return((o=s.rpcMap)==null?void 0:o[a.reference])||`${Lp}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Yt(y){return y.includes(":")?y.split(":")[1]:y}function $o(y){return y.map(s=>`${s.split(":")[0]}:${s.split(":")[1]}`)}function Wp(y,s){const r=Object.keys(s.namespaces).filter(a=>a.includes(y));if(!r.length)return[];const o=[];return r.forEach(a=>{const h=s.namespaces[a].accounts;o.push(...h)}),o}function ws(y={},s={}){const r=jo(y),o=jo(s);return vs.exports.merge(r,o)}function jo(y){var s,r,o,a;const h={};if(!(0,d.L5o)(y))return h;for(const[g,v]of Object.entries(y)){const I=(0,d.gpE)(g)?[g]:v.chains,C=v.methods||[],F=v.events||[],A=v.rpcMap||{},N=(0,d.Maj)(g);h[N]=Gp(hr(hr({},h[N]),v),{chains:(0,d.eGA)(I,(s=h[N])==null?void 0:s.chains),methods:(0,d.eGA)(C,(r=h[N])==null?void 0:r.methods),events:(0,d.eGA)(F,(o=h[N])==null?void 0:o.events),rpcMap:hr(hr({},A),(a=h[N])==null?void 0:a.rpcMap)})}return h}function Qp(y){return y.includes(":")?y.split(":")[2]:y}function Mo(y){const s={};for(const[r,o]of Object.entries(y)){const a=o.methods||[],h=o.events||[],g=o.accounts||[],v=(0,d.gpE)(r)?[r]:o.chains?o.chains:$o(o.accounts);s[r]={chains:v,methods:a,events:h,accounts:g}}return s}function _s(y){return typeof y=="number"?y:y.includes("0x")?parseInt(y,16):(y=y.includes(":")?y.split(":")[1]:y,isNaN(Number(y))?y:Number(y))}const zo={},pe=y=>zo[y],bs=(y,s)=>{zo[y]=s};class Yp{constructor(s){this.name="polkadot",this.namespace=s.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=Yt(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||jt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new It.r(new $t.Z(o,pe("disableProviderPing")))}}var Zp=Object.defineProperty,Xp=Object.defineProperties,ed=Object.getOwnPropertyDescriptors,Uo=Object.getOwnPropertySymbols,td=Object.prototype.hasOwnProperty,id=Object.prototype.propertyIsEnumerable,Lo=(y,s,r)=>s in y?Zp(y,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[s]=r,Ho=(y,s)=>{for(var r in s||(s={}))td.call(s,r)&&Lo(y,r,s[r]);if(Uo)for(var r of Uo(s))id.call(s,r)&&Lo(y,r,s[r]);return y},Vo=(y,s)=>Xp(y,ed(s));class rd{constructor(s){this.name="eip155",this.namespace=s.namespace,this.events=pe("events"),this.client=pe("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(s){switch(s.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(s);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(s)}return this.namespace.methods.includes(s.request.method)?await this.client.request(s):this.getHttpProvider().request(s.request)}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(parseInt(s),r),this.chainId=parseInt(s),this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}createHttpProvider(s,r){const o=r||jt(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new It.r(new $t.k(o,pe("disableProviderPing")))}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=parseInt(Yt(r));s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const s=this.chainId,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}async handleSwitchChain(s){var r,o;let a=s.request.params?(r=s.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const h=parseInt(a,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:s.topic,request:{method:s.request.method,params:[{chainId:a}]},chainId:(o=this.namespace.chains)==null?void 0:o[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(s){return this.namespace.chains.includes(`${this.name}:${s}`)}async getCapabilities(s){var r,o,a;const h=(o=(r=s.request)==null?void 0:r.params)==null?void 0:o[0];if(!h)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const g=this.client.session.get(s.topic),v=((a=g==null?void 0:g.sessionProperties)==null?void 0:a.capabilities)||{};if(v!=null&&v[h])return v==null?void 0:v[h];const I=await this.client.request(s);try{await this.client.session.update(s.topic,{sessionProperties:Vo(Ho({},g.sessionProperties||{}),{capabilities:Vo(Ho({},v||{}),{[h]:I})})})}catch(C){console.warn("Failed to update session with capabilities",C)}return I}}class sd{constructor(s){this.name="solana",this.namespace=s.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=Yt(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||jt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new It.r(new $t.Z(o,pe("disableProviderPing")))}}class nd{constructor(s){this.name="cosmos",this.namespace=s.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=Yt(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||jt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new It.r(new $t.Z(o,pe("disableProviderPing")))}}class od{constructor(s){this.name="cip34",this.namespace=s.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{const o=this.getCardanoRPCUrl(r),a=Yt(r);s[a]=this.createHttpProvider(a,o)}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}getCardanoRPCUrl(s){const r=this.namespace.rpcMap;if(r)return r[s]}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||this.getCardanoRPCUrl(s);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new It.r(new $t.Z(o,pe("disableProviderPing")))}}class ad{constructor(s){this.name="elrond",this.namespace=s.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=Yt(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||jt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new It.r(new $t.Z(o,pe("disableProviderPing")))}}class cd{constructor(s){this.name="multiversx",this.namespace=s.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){this.httpProviders[s]||this.setHttpProvider(s,r),this.chainId=s,this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}getAccounts(){const s=this.namespace.accounts;return s?[...new Set(s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;const a=Yt(r);s[a]=this.createHttpProvider(a,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||jt(s,this.namespace,this.client.core.projectId);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);return new It.r(new $t.Z(o,pe("disableProviderPing")))}}class ud{constructor(s){this.name="near",this.namespace=s.namespace,this.events=pe("events"),this.client=pe("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(s){this.namespace=Object.assign(this.namespace,s)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const s=this.namespace.chains[0];if(!s)throw new Error("ChainId not found");return s.split(":")[1]}request(s){return this.namespace.methods.includes(s.request.method)?this.client.request(s):this.getHttpProvider().request(s.request)}setDefaultChain(s,r){if(this.chainId=s,!this.httpProviders[s]){const o=r||jt(`${this.name}:${s}`,this.namespace);if(!o)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,o)}this.events.emit(Pt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const s=this.namespace.accounts;return s?s.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const s={};return this.namespace.chains.forEach(r=>{var o;s[r]=this.createHttpProvider(r,(o=this.namespace.rpcMap)==null?void 0:o[r])}),s}getHttpProvider(){const s=`${this.name}:${this.chainId}`,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${s} not found`);return r}setHttpProvider(s,r){const o=this.createHttpProvider(s,r);o&&(this.httpProviders[s]=o)}createHttpProvider(s,r){const o=r||jt(s,this.namespace);return typeof o>"u"?void 0:new It.r(new $t.Z(o,pe("disableProviderPing")))}}var hd=Object.defineProperty,ld=Object.defineProperties,pd=Object.getOwnPropertyDescriptors,Bo=Object.getOwnPropertySymbols,dd=Object.prototype.hasOwnProperty,gd=Object.prototype.propertyIsEnumerable,Ko=(y,s,r)=>s in y?hd(y,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):y[s]=r,lr=(y,s)=>{for(var r in s||(s={}))dd.call(s,r)&&Ko(y,r,s[r]);if(Bo)for(var r of Bo(s))gd.call(s,r)&&Ko(y,r,s[r]);return y},Es=(y,s)=>ld(y,pd(s));class pr{constructor(s){this.events=new(ns()),this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=s,this.logger=typeof(s==null?void 0:s.logger)<"u"&&typeof(s==null?void 0:s.logger)!="string"?s.logger:(0,ee.gw)((0,ee.jI)({level:(s==null?void 0:s.logger)||Oo})),this.disableProviderPing=(s==null?void 0:s.disableProviderPing)||!1}static async init(s){const r=new pr(s);return await r.initialize(),r}async request(s,r,o){const[a,h]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(a).request({request:lr({},s),chainId:`${a}:${h}`,topic:this.session.topic,expiry:o})}sendAsync(s,r,o,a){const h=new Date().getTime();this.request(s,o,a).then(g=>r(null,(0,L.formatJsonRpcResult)(h,g))).catch(g=>r(g,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var s;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(s=this.session)==null?void 0:s.topic,reason:(0,d.D6H)("USER_DISCONNECTED")}),await this.cleanup()}async connect(s){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(s),await this.cleanupPendingPairings(),!s.skipPairing)return await this.pair(s.pairingTopic)}async authenticate(s){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(s),await this.cleanupPendingPairings();const{uri:r,response:o}=await this.client.authenticate(s);r&&(this.uri=r,this.events.emit("display_uri",r));const a=await o();if(this.session=a.session,this.session){const h=Mo(this.session.namespaces);this.namespaces=ws(this.namespaces,h),this.persist("namespaces",this.namespaces),this.onConnect()}return a}on(s,r){this.events.on(s,r)}once(s,r){this.events.once(s,r)}removeListener(s,r){this.events.removeListener(s,r)}off(s,r){this.events.off(s,r)}get isWalletConnect(){return!0}async pair(s){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:o,approval:a}=await this.client.connect({pairingTopic:s,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});o&&(this.uri=o,this.events.emit("display_uri",o)),await a().then(h=>{this.session=h;const g=Mo(h.namespaces);this.namespaces=ws(this.namespaces,g),this.persist("namespaces",this.namespaces)}).catch(h=>{if(h.message!==Fo)throw h;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(s,r){try{if(!this.session)return;const[o,a]=this.validateChain(s);this.getProvider(o).setDefaultChain(a,r)}catch(o){if(!/Please call connect/.test(o.message))throw o}}async cleanupPendingPairings(s={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if((0,d.qt8)(r)){for(const o of r)s.deletePairings?this.client.core.expirer.set(o.topic,0):await this.client.core.relayer.subscriber.unsubscribe(o.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const s=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[s]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ms.init({logger:this.providerOpts.logger||Oo,relayUrl:this.providerOpts.relayUrl||Mp,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const s=[...new Set(Object.keys(this.session.namespaces).map(r=>(0,d.Maj)(r)))];bs("client",this.client),bs("events",this.events),bs("disableProviderPing",this.disableProviderPing),s.forEach(r=>{if(!this.session)return;const o=Wp(r,this.session),a=$o(o),h=ws(this.namespaces,this.optionalNamespaces),g=Es(lr({},h[r]),{accounts:o,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new rd({namespace:g});break;case"solana":this.rpcProviders[r]=new sd({namespace:g});break;case"cosmos":this.rpcProviders[r]=new nd({namespace:g});break;case"polkadot":this.rpcProviders[r]=new Yp({namespace:g});break;case"cip34":this.rpcProviders[r]=new od({namespace:g});break;case"elrond":this.rpcProviders[r]=new ad({namespace:g});break;case"multiversx":this.rpcProviders[r]=new cd({namespace:g});break;case"near":this.rpcProviders[r]=new ud({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",s=>{this.events.emit("session_ping",s)}),this.client.on("session_event",s=>{const{params:r}=s,{event:o}=r;if(o.name==="accountsChanged"){const a=o.data;a&&(0,d.qt8)(a)&&this.events.emit("accountsChanged",a.map(Qp))}else if(o.name==="chainChanged"){const a=r.chainId,h=r.event.data,g=(0,d.Maj)(a),v=_s(a)!==_s(h)?`${g}:${_s(h)}`:a;this.onChainChanged(v)}else this.events.emit(o.name,o.data);this.events.emit("session_event",s)}),this.client.on("session_update",({topic:s,params:r})=>{var o;const{namespaces:a}=r,h=(o=this.client)==null?void 0:o.session.get(s);this.session=Es(lr({},h),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:s,params:r})}),this.client.on("session_delete",async s=>{await this.cleanup(),this.events.emit("session_delete",s),this.events.emit("disconnect",Es(lr({},(0,d.D6H)("USER_DISCONNECTED")),{data:s.topic}))}),this.on(Pt.DEFAULT_CHAIN_CHANGED,s=>{this.onChainChanged(s,!0)})}getProvider(s){if(!this.rpcProviders[s])throw new Error(`Provider not found: ${s}`);return this.rpcProviders[s]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(s=>{var r;this.getProvider(s).updateNamespace((r=this.session)==null?void 0:r.namespaces[s])})}setNamespaces(s){const{namespaces:r,optionalNamespaces:o,sessionProperties:a}=s;r&&Object.keys(r).length&&(this.namespaces=r),o&&Object.keys(o).length&&(this.optionalNamespaces=o),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",o)}validateChain(s){const[r,o]=(s==null?void 0:s.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,o];if(r&&!Object.keys(this.namespaces||{}).map(g=>(0,d.Maj)(g)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&o)return[r,o];const a=(0,d.Maj)(Object.keys(this.namespaces)[0]),h=this.rpcProviders[a].getDefaultChain();return[a,h]}async requestAccounts(){const[s]=this.validateChain();return await this.getProvider(s).requestAccounts()}onChainChanged(s,r=!1){if(!this.namespaces)return;const[o,a]=this.validateChain(s);a&&(r||this.getProvider(o).setDefaultChain(a),this.namespaces[o]?this.namespaces[o].defaultChain=a:this.namespaces[`${o}:${a}`]?this.namespaces[`${o}:${a}`].defaultChain=a:this.namespaces[`${o}:${a}`]={defaultChain:a},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",a))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(s,r){this.client.core.storage.setItem(`${To}/${s}`,r)}async getFromStore(s){return await this.client.core.storage.getItem(`${To}/${s}`)}}const fd=pr}}]);
